<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><title>What are the rules for JavaScript&#x27;s automatic semicolon insertion (ASI)? | Solutions Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="Well, first I should probably ask if this is browser dependent.

I&#x27;ve read that if an invalid token is found, but the section of code is valid until that invalid token, a semicolon is inserted before the token if it is preceded by a line break.

However, the common example cited for bugs caused by semicolon insertion is:

return
  _a+b;


..which doesn&#x27;t seem to follow this rule, since _a would be a valid token.

On the other hand, breaking up call chains works as expected:

$(&#x27;#myButton&#x27;)
  .click(function(){alert(&quot;Hello!&quot;)});


Does anyone have a more in-depth description of the rules?
    "/><meta property="og:title" content="What are the rules for JavaScript&#x27;s automatic semicolon insertion (ASI)? | Solutions Checker"/><meta property="og:description" content="Well, first I should probably ask if this is browser dependent.

I&#x27;ve read that if an invalid token is found, but the section of code is valid until that invalid token, a semicolon is inserted before the token if it is preceded by a line break.

However, the common example cited for bugs caused by semicolon insertion is:

return
  _a+b;


..which doesn&#x27;t seem to follow this rule, since _a would be a valid token.

On the other hand, breaking up call chains works as expected:

$(&#x27;#myButton&#x27;)
  .click(function(){alert(&quot;Hello!&quot;)});


Does anyone have a more in-depth description of the rules?
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"What are the rules for JavaScript&apos;s automatic semicolon insertion (ASI)?","text":"Well, first I should probably ask if this is browser dependent.\n\nI&apos;ve read that if an invalid token is found, but the section of code is valid until that invalid token, a semicolon is inserted before the token if it is preceded by a line break.\n\nHowever, the common example cited for bugs caused by semicolon insertion is:\n\nreturn\n  _a+b;\n\n\n..which doesn&apos;t seem to follow this rule, since _a would be a valid token.\n\nOn the other hand, breaking up call chains works as expected:\n\n$(&apos;#myButton&apos;)\n  .click(function(){alert(&quot;Hello!&quot;)});\n\n\nDoes anyone have a more in-depth description of the rules?\n    ","answerCount":6,"upVoteCount":500,"suggestedAnswer":[{"text":"First of all you should know which statements are affected by the automatic semicolon insertion (also known as ASI for brevity):\n\nempty statement\nvar statement\nexpression statement\ndo-while statement\ncontinue statement\nbreak statement\nreturn statement\nthrow statement\n\nThe concrete rules of ASI, are described in the specification ยง11.9.1 Rules of Automatic Semicolon Insertion\nThree cases are described:\n\nWhen an offending token is encountered that is not allowed by the grammar, a semicolon is inserted before it if:\n\n\nThe token is separated from the previous token by at least one LineTerminator.\nThe token is }\n\ne.g.:\n    { 1\n    2 } 3\n\nis transformed to\n    { 1\n    ;2 ;} 3;\n\nThe NumericLiteral 1 meets the first condition, the following token is a line terminator.\nThe 2 meets the second condition, the following token is }.\n\nWhen the end of the input stream of tokens is encountered and the parser is unable to parse the input token stream as a single complete Program, then a semicolon is automatically inserted at the end of the input stream.\n\ne.g.:\n    a = b\n    ++c\n\nis transformed to:\n    a = b;\n    ++c;\n\n\nThis case occurs when a token is allowed by some production of the grammar, but the production is a restricted production, a semicolon is automatically inserted before the restricted token.\n\nRestricted productions:\n    UpdateExpression :\n        LeftHandSideExpression [no LineTerminator here] ++\n        LeftHandSideExpression [no LineTerminator here] --\n    \n    ContinueStatement :\n        continue ;\n        continue [no LineTerminator here] LabelIdentifier ;\n    \n    BreakStatement :\n        break ;\n        break [no LineTerminator here] LabelIdentifier ;\n    \n    ReturnStatement :\n        return ;\n        return [no LineTerminator here] Expression ;\n    \n    ThrowStatement :\n        throw [no LineTerminator here] Expression ; \n\n    ArrowFunction :\n        ArrowParameters [no LineTerminator here] =&gt; ConciseBody\n\n    YieldExpression :\n        yield [no LineTerminator here] * AssignmentExpression\n        yield [no LineTerminator here] AssignmentExpression\n\nThe classic example, with the ReturnStatement:\n    return \n      &quot;something&quot;;\n\nis transformed to\n    return;\n      &quot;something&quot;;\n\n    ","url":"/questions/[slug]#solution1","@type":"Answer","upvoteCount":0},{"text":"I could not understand those 3 rules in the specs too well -- hope to have something that is more plain English -- but here is what I gathered from JavaScript: The Definitive Guide, 6th Edition, David Flanagan, O&apos;Reilly, 2011:\nQuote:\n\nJavaScript does not treat every line break as a semicolon: it usually treats line breaks as semicolons only if it cant parse the code without the semicolons.\n\nAnother quote: for the code\nvar a\na\n=\n3 console.log(a)\n\n\nJavaScript does not treat the second line break as a semicolon because it can continue parsing the longer statement a = 3;\n\nand:\n\ntwo exceptions to the general rule that JavaScript interprets line breaks as semicolons when it cannot parse the second line as a continuation of the statement on the first line. The first exception involves the return, break, and continue statements\n... If a line break appears after any of these words ... JavaScript will always interpret that line break as a semicolon.\n... The second exception involves the ++ and  operators ... If you want to use either of these operators as postfix operators, they must appear on the same line as the expression they apply to. Otherwise, the line break will be treated as a semicolon, and the ++ or -- will be parsed as a prefix operator applied to the code that follows. Consider this code, for example:\n\nx \n++ \ny\n\n\nIt is parsed as x; ++y;, not as x++; y\n\nSo I think to simplify it, that means:\nIn general, JavaScript will treat it as continuation of code as long as it makes sense -- except 2 cases:  (1) after some keywords like return, break, continue, and (2) if it sees ++ or -- on a new line, then it will add the ; at the end of the previous line.\nThe part about &quot;treat it as continuation of code as long as it makes sense&quot; makes it feel like regular expression&apos;s greedy matching.\nWith the above said, that means for return with a line break, the JavaScript interpreter will insert a ;\n(quoted again: If a line break appears after any of these words [such as return] ... JavaScript will always interpret that line break as a semicolon)\nand due to this reason, the classic example of\nreturn\n{ \n  foo: 1\n}\n\nwill not work as expected, because the JavaScript interpreter will treat it as:\nreturn;   // returning nothing\n{\n  foo: 1\n}\n\nThere has to be no line-break immediately after the return:\nreturn { \n  foo: 1\n}\n\nfor it to work properly.  And you may insert a ; yourself if you were to follow the rule of using a ; after any statement:\nreturn { \n  foo: 1\n};\n\n    ","url":"/questions/[slug]#solution2","@type":"Answer","upvoteCount":0},{"text":"Straight from the ECMA-262, Fifth Edition ECMAScript Specification:\n\n\n  7.9.1 Rules of Automatic Semicolon Insertion\n  \n  There are three basic rules of semicolon insertion:\n  \n  \n  When, as the program is parsed from left to right, a token (called the offending token) is encountered that is not allowed by any production of the grammar,  then a semicolon is automatically inserted before the offending token if one or more of the following conditions is true:\n  \n  \n  The offending token is separated from the previous token by at least one LineTerminator.\n  The offending token is }.\n  \n  When, as the program is parsed from left to right,  the end of the input stream of tokens is encountered and the parser is unable to parse the input token stream as a single complete ECMAScript Program, then a semicolon is automatically inserted at the end of the input stream.\n  When, as the program is parsed from left to right, a token is encountered that is allowed by some production of the grammar, but the production is a restricted production and the token would be the first token for a terminal or nonterminal immediately following the annotation &quot;[no LineTerminator here]&quot; within the restricted production (and therefore such a token is called a restricted token), and the restricted token is separated from the previous token by at least one LineTerminator, then a semicolon is automatically inserted before the restricted token.\n  \n  \n  However, there is an additional overriding condition on  the preceding rules: a semicolon is never inserted automatically if the semicolon would then be parsed as an empty statement or if that semicolon would become one of the two semicolons in the header of a for statement (see 12.6.3).\n\n    ","url":"/questions/[slug]#solution3","@type":"Answer","upvoteCount":0},{"text":"Regarding semicolon insertion and the var statement, beware forgetting the comma when using var but spanning multiple lines.  Somebody found this in my code yesterday:\n\n    var srcRecords = src.records\n        srcIds = [];\n\n\nIt ran but the effect was that the srcIds declaration/assignment was global because the local declaration with var on the previous line no longer applied as that statement was considered finished due to automatic semi-colon insertion.\n    ","url":"/questions/[slug]#solution4","@type":"Answer","upvoteCount":0},{"text":"The most contextual description of JavaScript&apos;s Automatic Semicolon Insertion I have found comes from a book about Crafting Interpreters.\n\n\n  JavaScripts automatic semicolon insertion rule is the odd one. Where other languages assume most newlines are meaningful and only a few should be ignored in multi-line statements, JS assumes the opposite. It treats all of your newlines as meaningless whitespace unless it encounters a parse error. If it does, it goes back and tries turning the previous newline into a semicolon to get something grammatically valid.\n\n\nHe goes on to describe it as you would code smell.\n\n\n  This design note would turn into a design diatribe if I went into complete detail about how that even works, much less all the various ways that that is a bad idea. Its a mess. JavaScript is the only language I know where many style guides demand explicit semicolons after every statement even though the language theoretically lets you elide them.\n\n    ","url":"/questions/[slug]#solution5","@type":"Answer","upvoteCount":0},{"text":"Just to add,\n\nconst foo = function(){ return &quot;foo&quot; } //this doesn&apos;t add a semicolon here.\n(function (){\n    console.log(&quot;aa&quot;);\n})()\n\n\nsee this, using immediately invoked function expression(IIFE)\n    ","url":"/questions/[slug]#solution6","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/9fb80f4eb9e2d3c9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9fb80f4eb9e2d3c9.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-18d80dcb3110b1ad.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/532-fec3344a80918110.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/817-363561828babdd16.js" defer=""></script><script src="/_next/static/chunks/81-89fd2eaadd8354ed.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-16d8c84aea765d4e.js" defer=""></script><script src="/_next/static/D-Vv5KfwuaE883xCdWfex/_buildManifest.js" defer=""></script><script src="/_next/static/D-Vv5KfwuaE883xCdWfex/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">.dlbxiY code{padding:5px;color:hsl(210deg 8% 15%);background-color:hsl(210deg 8% 90%);border-radius:3px;}/*!sc*/
data-styled.g5[id="sc-344134f6-0"]{content:"dlbxiY,"}/*!sc*/
</style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo.svg" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h4 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h4></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/what-are-the-rules-for-javascript&#x27;s-automatic-semicolon-insertion-(asi)-1657387472789#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="sc-344134f6-0 dlbxiY flex question-header items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/what-are-the-rules-for-javascript&#x27;s-automatic-semicolon-insertion-(asi)-1657387472789">What are the rules for JavaScript&#x27;s automatic semicolon insertion (ASI)?</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/automatic-semicolon-insertion">automatic-semicolon-insertion</a></div></div><div class="question-content mt-5">
                
<p>Well, first I should probably ask if this is browser dependent.</p>

<p>I've read that if an invalid token is found, but the section of code is valid until that invalid token, a semicolon is inserted before the token if it is preceded by a line break.</p>

<p><strong>However, the common example cited for bugs caused by semicolon insertion is:</strong></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">return</span>
  _a+b;
</code></pre>

<p>..which doesn't seem to follow this rule, since _a would be a valid token.</p>

<p><strong>On the other hand, breaking up call chains works as expected:</strong></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">$(<span class="hljs-string">'#myButton'</span>)
  .<span class="hljs-title function_">click</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-title function_">alert</span>(<span class="hljs-string">"Hello!"</span>)});
</code></pre>

<p>Does anyone have a more in-depth description of the rules?</p>
    </div></div></div><div class="sc-344134f6-2 EUowZ"><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>First of all you should know which statements are affected by the automatic semicolon insertion (also known as ASI for brevity):</p>
<ul>
<li>empty statement</li>
<li><code>var</code> statement</li>
<li>expression statement</li>
<li><code>do-while</code> statement</li>
<li><code>continue</code> statement</li>
<li><code>break</code> statement</li>
<li><code>return</code> statement</li>
<li><code>throw</code> statement</li>
</ul>
<p>The concrete rules of ASI, are described in the specification <a href="http://www.ecma-international.org/ecma-262/7.0/index.html#sec-rules-of-automatic-semicolon-insertion" rel="noreferrer">ยง11.9.1 Rules of Automatic Semicolon Insertion</a></p>
<p>Three cases are described:</p>
<ol>
<li>When an offending token is encountered that is not allowed by the grammar, a semicolon is inserted before it if:</li>
</ol>
<ul>
<li>The token is separated from the previous token by at least one <code>LineTerminator</code>.</li>
<li>The token is <code>}</code></li>
</ul>
<p><em>e.g.</em>:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">    { <span class="hljs-number">1</span>
    <span class="hljs-number">2</span> } <span class="hljs-number">3</span>
</code></pre>
<p>is transformed to</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">    { <span class="hljs-number">1</span>
    ;<span class="hljs-number">2</span> ;} <span class="hljs-number">3</span>;
</code></pre>
<p>The <code>NumericLiteral</code> <code>1</code> meets the first condition, the following token is a line terminator.<br>
The <code>2</code> meets the second condition, the following token is <code>}</code>.</p>
<ol start="2">
<li>When the end of the input stream of tokens is encountered and the parser is unable to parse the input token stream as a single complete Program, then a semicolon is automatically inserted at the end of the input stream.</li>
</ol>
<p><em>e.g.</em>:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">    a = b
    ++c
</code></pre>
<p>is transformed to:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">    a = b;
    ++c;
</code></pre>
<ol start="3">
<li>This case occurs when a token is allowed by some production of the grammar, but the production is a <em>restricted production</em>, a semicolon is automatically inserted before the restricted token.</li>
</ol>
<p>Restricted productions:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">    <span class="hljs-title class_">UpdateExpression</span> :
        <span class="hljs-title class_">LeftHandSideExpression</span> [no <span class="hljs-title class_">LineTerminator</span> here] ++
        <span class="hljs-title class_">LeftHandSideExpression</span> [no <span class="hljs-title class_">LineTerminator</span> here] --
    
    <span class="hljs-title class_">ContinueStatement</span> :
        <span class="hljs-keyword">continue</span> ;
        <span class="hljs-keyword">continue</span> [no <span class="hljs-title class_">LineTerminator</span> here] <span class="hljs-title class_">LabelIdentifier</span> ;
    
    <span class="hljs-title class_">BreakStatement</span> :
        <span class="hljs-keyword">break</span> ;
        <span class="hljs-keyword">break</span> [no <span class="hljs-title class_">LineTerminator</span> here] <span class="hljs-title class_">LabelIdentifier</span> ;
    
    <span class="hljs-title class_">ReturnStatement</span> :
        <span class="hljs-keyword">return</span> ;
        <span class="hljs-keyword">return</span> [no <span class="hljs-title class_">LineTerminator</span> here] <span class="hljs-title class_">Expression</span> ;
    
    <span class="hljs-title class_">ThrowStatement</span> :
        <span class="hljs-keyword">throw</span> [no <span class="hljs-title class_">LineTerminator</span> here] <span class="hljs-title class_">Expression</span> ; 

    <span class="hljs-title class_">ArrowFunction</span> :
        <span class="hljs-title class_">ArrowParameters</span> [no <span class="hljs-title class_">LineTerminator</span> here] =&gt; <span class="hljs-title class_">ConciseBody</span>

    <span class="hljs-title class_">YieldExpression</span> :
        <span class="hljs-keyword">yield</span> [no <span class="hljs-title class_">LineTerminator</span> here] * <span class="hljs-title class_">AssignmentExpression</span>
        <span class="hljs-keyword">yield</span> [no <span class="hljs-title class_">LineTerminator</span> here] <span class="hljs-title class_">AssignmentExpression</span>
</code></pre>
<p>The classic example, with the <code>ReturnStatement</code>:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">    <span class="hljs-keyword">return</span> 
      <span class="hljs-string">"something"</span>;
</code></pre>
<p>is transformed to</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">    <span class="hljs-keyword">return</span>;
      <span class="hljs-string">"something"</span>;
</code></pre>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I could not understand those 3 rules in the specs too well -- hope to have something that is more plain English -- but here is what I gathered from JavaScript: The Definitive Guide, 6th Edition, David Flanagan, O'Reilly, 2011:</p>
<p>Quote:</p>
<blockquote>
<p>JavaScript does not treat every line break as a semicolon: it usually treats line breaks as semicolons only if it cant parse the code without the semicolons.</p>
</blockquote>
<p>Another quote: for the code</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> a
a
=
<span class="hljs-number">3</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a)
</code></pre>
<blockquote>
<p>JavaScript does not treat the second line break as a semicolon because it can continue parsing the longer statement a = 3;</p>
</blockquote>
<p>and:</p>
<blockquote>
<p>two exceptions to the general rule that JavaScript interprets line breaks as semicolons when it cannot parse the second line as a continuation of the statement on the first line. The first exception involves the return, break, and continue statements</p>
<p>... If a line break appears after any of these words ... JavaScript will always interpret that line break as a semicolon.</p>
<p>... The second exception involves the ++ and  operators ... If you want to use either of these operators as postfix operators, they must appear on the same line as the expression they apply to. Otherwise, the line break will be treated as a semicolon, and the ++ or -- will be parsed as a prefix operator applied to the code that follows. Consider this code, for example:</p>
</blockquote>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">x 
++ 
y
</code></pre>
<blockquote>
<p>It is parsed as <code>x; ++y;</code>, not as <code>x++; y</code></p>
</blockquote>
<p>So I think to simplify it, that means:</p>
<p><strong>In general, JavaScript will treat it as continuation of code as long as it makes sense -- except 2 cases:  (1) after some keywords like <code>return</code>, <code>break</code>, <code>continue</code>, and (2) if it sees <code>++</code> or <code>--</code> on a new line, then it will add the <code>;</code> at the end of the previous line.</strong></p>
<p><strong>The part about "treat it as continuation of code as long as it makes sense" makes it feel like regular expression's greedy matching.</strong></p>
<p>With the above said, that means for <code>return</code> with a line break, the JavaScript interpreter will insert a <code>;</code></p>
<p>(quoted again: If a line break appears after any of these words [such as <code>return</code>] ... JavaScript will always interpret that line break as a semicolon)</p>
<p>and due to this reason, the classic example of</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">return</span>
{ 
  <span class="hljs-attr">foo</span>: <span class="hljs-number">1</span>
}
</code></pre>
<p>will not work as expected, because the JavaScript interpreter will treat it as:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">return</span>;   <span class="hljs-comment">// returning nothing</span>
{
  <span class="hljs-attr">foo</span>: <span class="hljs-number">1</span>
}
</code></pre>
<p>There has to be no line-break immediately after the <code>return</code>:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">return</span> { 
  <span class="hljs-attr">foo</span>: <span class="hljs-number">1</span>
}
</code></pre>
<p>for it to work properly.  And you may insert a <code>;</code> yourself if you were to follow the rule of using a <code>;</code> after any statement:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">return</span> { 
  <span class="hljs-attr">foo</span>: <span class="hljs-number">1</span>
};
</code></pre>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Straight from the <a href="http://WWW.ECMA-International.Org/publications/standards/Ecma-262.htm" rel="noreferrer">ECMA-262, Fifth Edition ECMAScript Specification</a>:</p>

<blockquote>
  <h1>7.9.1 Rules of Automatic Semicolon Insertion</h1>
  
  <p>There are three basic rules of semicolon insertion:</p>
  
  <ol>
  <li>When, as the program is parsed from left to right, a token (called the <em>offending token</em>) is encountered that is not allowed by any production of the grammar,  then a semicolon is automatically inserted before the offending token if one or more of the following conditions is true:
  
  <ul>
  <li>The offending token is separated from the previous token by at least one <code>LineTerminator</code>.</li>
  <li>The offending token is <kbd>}</kbd>.</li>
  </ul></li>
  <li>When, as the program is parsed from left to right,  the end of the input stream of tokens is encountered and the parser is unable to parse the input token stream as a single complete ECMAScript <code>Program</code>, then a semicolon is automatically inserted at the end of the input stream.</li>
  <li>When, as the program is parsed from left to right, a token is encountered that is allowed by some production of the grammar, but the production is a <em>restricted production</em> and the token would be the first token for a terminal or nonterminal immediately following the annotation "<sub>[no <code>LineTerminator</code> here]</sub>" within the restricted production (and therefore such a token is called a restricted token), and the restricted token is separated from the previous token by at least one <strong>LineTerminator</strong>, then a semicolon is automatically inserted before the restricted token.</li>
  </ol>
  
  <p>However, there is an additional overriding condition on  the preceding rules: a semicolon is never inserted automatically if the semicolon would then be parsed as an empty statement or if that semicolon would become one of the two semicolons in the header of a <kbd>for</kbd> statement (see 12.6.3).</p>
</blockquote>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Regarding semicolon insertion and the var statement, beware forgetting the comma when using var but spanning multiple lines.  Somebody found this in my code yesterday:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">    <span class="hljs-keyword">var</span> srcRecords = src.<span class="hljs-property">records</span>
        srcIds = [];
</code></pre>

<p>It ran but the effect was that the srcIds declaration/assignment was global because the local declaration with var on the previous line no longer applied as that statement was considered finished due to automatic semi-colon insertion.</p>
    </div></div></div></div><div id="solution5" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The most contextual description of JavaScript's <a href="http://www.ecma-international.org/ecma-262/10.0/index.html#sec-automatic-semicolon-insertion" rel="noreferrer">Automatic Semicolon Insertion</a> I have found comes from a book about <a href="http://www.craftinginterpreters.com/scanning.html" rel="noreferrer">Crafting Interpreters</a>.</p>

<blockquote>
  <p>JavaScripts automatic semicolon insertion rule is the odd one. Where other languages assume most newlines are meaningful and only a few should be ignored in multi-line statements, JS assumes the opposite. It treats all of your newlines as meaningless whitespace unless it encounters a parse error. If it does, it goes back and tries turning the previous newline into a semicolon to get something grammatically valid.</p>
</blockquote>

<p>He goes on to describe it as you would <a href="http://wiki.c2.com/?CodeSmell" rel="noreferrer">code smell</a>.</p>

<blockquote>
  <p>This design note would turn into a design diatribe if I went into complete detail about how that even works, much less all the various ways that that is a bad idea. Its a mess. JavaScript is the only language I know where many style guides demand explicit semicolons after every statement even though the language theoretically lets you elide them.</p>
</blockquote>
    </div></div></div></div><div id="solution6" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Just to add,</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> foo = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){ <span class="hljs-keyword">return</span> <span class="hljs-string">"foo"</span> } <span class="hljs-comment">//this doesn't add a semicolon here.</span>
(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>){
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"aa"</span>);
})()
</code></pre>

<p>see this, <a href="https://stackoverflow.com/questions/59208059/using-immediately-invoked-function-expressioniife">using immediately invoked function expression(IIFE)</a></p>
    </div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;First of all you should know which statements are affected by the automatic semicolon insertion (also known as ASI for brevity):\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;empty statement\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;var\u0026lt;/code\u0026gt; statement\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;expression statement\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;do-while\u0026lt;/code\u0026gt; statement\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;continue\u0026lt;/code\u0026gt; statement\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;break\u0026lt;/code\u0026gt; statement\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;return\u0026lt;/code\u0026gt; statement\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;throw\u0026lt;/code\u0026gt; statement\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;p\u0026gt;The concrete rules of ASI, are described in the specification \u0026lt;a href=\u0026quot;http://www.ecma-international.org/ecma-262/7.0/index.html#sec-rules-of-automatic-semicolon-insertion\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;ยง11.9.1 Rules of Automatic Semicolon Insertion\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Three cases are described:\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;When an offending token is encountered that is not allowed by the grammar, a semicolon is inserted before it if:\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The token is separated from the previous token by at least one \u0026lt;code\u0026gt;LineTerminator\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;The token is \u0026lt;code\u0026gt;}\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;e.g.\u0026lt;/em\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    { \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt; } \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;is transformed to\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    { \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n    ;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt; ;} \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;The \u0026lt;code\u0026gt;NumericLiteral\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;1\u0026lt;/code\u0026gt; meets the first condition, the following token is a line terminator.\u0026lt;br\u0026gt;\nThe \u0026lt;code\u0026gt;2\u0026lt;/code\u0026gt; meets the second condition, the following token is \u0026lt;code\u0026gt;}\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;ol start=\u0026quot;2\u0026quot;\u0026gt;\n\u0026lt;li\u0026gt;When the end of the input stream of tokens is encountered and the parser is unable to parse the input token stream as a single complete Program, then a semicolon is automatically inserted at the end of the input stream.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;e.g.\u0026lt;/em\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    a = b\n    ++c\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;is transformed to:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    a = b;\n    ++c;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;ol start=\u0026quot;3\u0026quot;\u0026gt;\n\u0026lt;li\u0026gt;This case occurs when a token is allowed by some production of the grammar, but the production is a \u0026lt;em\u0026gt;restricted production\u0026lt;/em\u0026gt;, a semicolon is automatically inserted before the restricted token.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;Restricted productions:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;UpdateExpression\u0026lt;/span\u0026gt; :\n        \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LeftHandSideExpression\u0026lt;/span\u0026gt; [no \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LineTerminator\u0026lt;/span\u0026gt; here] ++\n        \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LeftHandSideExpression\u0026lt;/span\u0026gt; [no \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LineTerminator\u0026lt;/span\u0026gt; here] --\n    \n    \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ContinueStatement\u0026lt;/span\u0026gt; :\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;continue\u0026lt;/span\u0026gt; ;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;continue\u0026lt;/span\u0026gt; [no \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LineTerminator\u0026lt;/span\u0026gt; here] \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LabelIdentifier\u0026lt;/span\u0026gt; ;\n    \n    \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;BreakStatement\u0026lt;/span\u0026gt; :\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;break\u0026lt;/span\u0026gt; ;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;break\u0026lt;/span\u0026gt; [no \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LineTerminator\u0026lt;/span\u0026gt; here] \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LabelIdentifier\u0026lt;/span\u0026gt; ;\n    \n    \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ReturnStatement\u0026lt;/span\u0026gt; :\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; ;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; [no \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LineTerminator\u0026lt;/span\u0026gt; here] \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Expression\u0026lt;/span\u0026gt; ;\n    \n    \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ThrowStatement\u0026lt;/span\u0026gt; :\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;throw\u0026lt;/span\u0026gt; [no \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LineTerminator\u0026lt;/span\u0026gt; here] \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Expression\u0026lt;/span\u0026gt; ; \n\n    \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrowFunction\u0026lt;/span\u0026gt; :\n        \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrowParameters\u0026lt;/span\u0026gt; [no \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LineTerminator\u0026lt;/span\u0026gt; here] =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ConciseBody\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;YieldExpression\u0026lt;/span\u0026gt; :\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;yield\u0026lt;/span\u0026gt; [no \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LineTerminator\u0026lt;/span\u0026gt; here] * \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;AssignmentExpression\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;yield\u0026lt;/span\u0026gt; [no \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LineTerminator\u0026lt;/span\u0026gt; here] \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;AssignmentExpression\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;The classic example, with the \u0026lt;code\u0026gt;ReturnStatement\u0026lt;/code\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \n      \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;something\u0026quot;\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;is transformed to\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt;;\n      \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;something\u0026quot;\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I could not understand those 3 rules in the specs too well -- hope to have something that is more plain English -- but here is what I gathered from JavaScript: The Definitive Guide, 6th Edition, David Flanagan, O\u0026apos;Reilly, 2011:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Quote:\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;JavaScript does not treat every line break as a semicolon: it usually treats line breaks as semicolons only if it cant parse the code without the semicolons.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;Another quote: for the code\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; a\na\n=\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(a)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;JavaScript does not treat the second line break as a semicolon because it can continue parsing the longer statement a = 3;\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;and:\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;two exceptions to the general rule that JavaScript interprets line breaks as semicolons when it cannot parse the second line as a continuation of the statement on the first line. The first exception involves the return, break, and continue statements\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;... If a line break appears after any of these words ... JavaScript will always interpret that line break as a semicolon.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;... The second exception involves the ++ and  operators ... If you want to use either of these operators as postfix operators, they must appear on the same line as the expression they apply to. Otherwise, the line break will be treated as a semicolon, and the ++ or -- will be parsed as a prefix operator applied to the code that follows. Consider this code, for example:\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;x \n++ \ny\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;It is parsed as \u0026lt;code\u0026gt;x; ++y;\u0026lt;/code\u0026gt;, not as \u0026lt;code\u0026gt;x++; y\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;So I think to simplify it, that means:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;In general, JavaScript will treat it as continuation of code as long as it makes sense -- except 2 cases:  (1) after some keywords like \u0026lt;code\u0026gt;return\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;break\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;continue\u0026lt;/code\u0026gt;, and (2) if it sees \u0026lt;code\u0026gt;++\u0026lt;/code\u0026gt; or \u0026lt;code\u0026gt;--\u0026lt;/code\u0026gt; on a new line, then it will add the \u0026lt;code\u0026gt;;\u0026lt;/code\u0026gt; at the end of the previous line.\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;The part about \u0026quot;treat it as continuation of code as long as it makes sense\u0026quot; makes it feel like regular expression\u0026apos;s greedy matching.\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;With the above said, that means for \u0026lt;code\u0026gt;return\u0026lt;/code\u0026gt; with a line break, the JavaScript interpreter will insert a \u0026lt;code\u0026gt;;\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;(quoted again: If a line break appears after any of these words [such as \u0026lt;code\u0026gt;return\u0026lt;/code\u0026gt;] ... JavaScript will always interpret that line break as a semicolon)\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;and due to this reason, the classic example of\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt;\n{ \n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;will not work as expected, because the JavaScript interpreter will treat it as:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt;;   \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// returning nothing\u0026lt;/span\u0026gt;\n{\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;There has to be no line-break immediately after the \u0026lt;code\u0026gt;return\u0026lt;/code\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; { \n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;for it to work properly.  And you may insert a \u0026lt;code\u0026gt;;\u0026lt;/code\u0026gt; yourself if you were to follow the rule of using a \u0026lt;code\u0026gt;;\u0026lt;/code\u0026gt; after any statement:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; { \n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Straight from the \u0026lt;a href=\u0026quot;http://WWW.ECMA-International.Org/publications/standards/Ecma-262.htm\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;ECMA-262, Fifth Edition ECMAScript Specification\u0026lt;/a\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;h1\u0026gt;7.9.1 Rules of Automatic Semicolon Insertion\u0026lt;/h1\u0026gt;\n  \n  \u0026lt;p\u0026gt;There are three basic rules of semicolon insertion:\u0026lt;/p\u0026gt;\n  \n  \u0026lt;ol\u0026gt;\n  \u0026lt;li\u0026gt;When, as the program is parsed from left to right, a token (called the \u0026lt;em\u0026gt;offending token\u0026lt;/em\u0026gt;) is encountered that is not allowed by any production of the grammar,  then a semicolon is automatically inserted before the offending token if one or more of the following conditions is true:\n  \n  \u0026lt;ul\u0026gt;\n  \u0026lt;li\u0026gt;The offending token is separated from the previous token by at least one \u0026lt;code\u0026gt;LineTerminator\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n  \u0026lt;li\u0026gt;The offending token is \u0026lt;kbd\u0026gt;}\u0026lt;/kbd\u0026gt;.\u0026lt;/li\u0026gt;\n  \u0026lt;/ul\u0026gt;\u0026lt;/li\u0026gt;\n  \u0026lt;li\u0026gt;When, as the program is parsed from left to right,  the end of the input stream of tokens is encountered and the parser is unable to parse the input token stream as a single complete ECMAScript \u0026lt;code\u0026gt;Program\u0026lt;/code\u0026gt;, then a semicolon is automatically inserted at the end of the input stream.\u0026lt;/li\u0026gt;\n  \u0026lt;li\u0026gt;When, as the program is parsed from left to right, a token is encountered that is allowed by some production of the grammar, but the production is a \u0026lt;em\u0026gt;restricted production\u0026lt;/em\u0026gt; and the token would be the first token for a terminal or nonterminal immediately following the annotation \u0026quot;\u0026lt;sub\u0026gt;[no \u0026lt;code\u0026gt;LineTerminator\u0026lt;/code\u0026gt; here]\u0026lt;/sub\u0026gt;\u0026quot; within the restricted production (and therefore such a token is called a restricted token), and the restricted token is separated from the previous token by at least one \u0026lt;strong\u0026gt;LineTerminator\u0026lt;/strong\u0026gt;, then a semicolon is automatically inserted before the restricted token.\u0026lt;/li\u0026gt;\n  \u0026lt;/ol\u0026gt;\n  \n  \u0026lt;p\u0026gt;However, there is an additional overriding condition on  the preceding rules: a semicolon is never inserted automatically if the semicolon would then be parsed as an empty statement or if that semicolon would become one of the two semicolons in the header of a \u0026lt;kbd\u0026gt;for\u0026lt;/kbd\u0026gt; statement (see 12.6.3).\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Regarding semicolon insertion and the var statement, beware forgetting the comma when using var but spanning multiple lines.  Somebody found this in my code yesterday:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; srcRecords = src.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;records\u0026lt;/span\u0026gt;\n        srcIds = [];\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;It ran but the effect was that the srcIds declaration/assignment was global because the local declaration with var on the previous line no longer applied as that statement was considered finished due to automatic semi-colon insertion.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The most contextual description of JavaScript\u0026apos;s \u0026lt;a href=\u0026quot;http://www.ecma-international.org/ecma-262/10.0/index.html#sec-automatic-semicolon-insertion\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Automatic Semicolon Insertion\u0026lt;/a\u0026gt; I have found comes from a book about \u0026lt;a href=\u0026quot;http://www.craftinginterpreters.com/scanning.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Crafting Interpreters\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;JavaScripts automatic semicolon insertion rule is the odd one. Where other languages assume most newlines are meaningful and only a few should be ignored in multi-line statements, JS assumes the opposite. It treats all of your newlines as meaningless whitespace unless it encounters a parse error. If it does, it goes back and tries turning the previous newline into a semicolon to get something grammatically valid.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;He goes on to describe it as you would \u0026lt;a href=\u0026quot;http://wiki.c2.com/?CodeSmell\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;code smell\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;This design note would turn into a design diatribe if I went into complete detail about how that even works, much less all the various ways that that is a bad idea. Its a mess. JavaScript is the only language I know where many style guides demand explicit semicolons after every statement even though the language theoretically lets you elide them.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Just to add,\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; foo = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){ \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;foo\u0026quot;\u0026lt;/span\u0026gt; } \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//this doesn\u0026apos;t add a semicolon here.\u0026lt;/span\u0026gt;\n(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;aa\u0026quot;\u0026lt;/span\u0026gt;);\n})()\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;see this, \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/59208059/using-immediately-invoked-function-expressioniife\u0026quot;\u0026gt;using immediately invoked function expression(IIFE)\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    "],"id":272,"title":"What are the rules for JavaScript's automatic semicolon insertion (ASI)?","content":"\n                \n\u0026lt;p\u0026gt;Well, first I should probably ask if this is browser dependent.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I\u0026apos;ve read that if an invalid token is found, but the section of code is valid until that invalid token, a semicolon is inserted before the token if it is preceded by a line break.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;However, the common example cited for bugs caused by semicolon insertion is:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt;\n  _a+b;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;..which doesn\u0026apos;t seem to follow this rule, since _a would be a valid token.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;On the other hand, breaking up call chains works as expected:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;$(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;#myButton\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;click\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;alert\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Hello!\u0026quot;\u0026lt;/span\u0026gt;)});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Does anyone have a more in-depth description of the rules?\u0026lt;/p\u0026gt;\n    ","slug":"what-are-the-rules-for-javascript's-automatic-semicolon-insertion-(asi)-1657387472789","postType":"QUESTION","createdAt":"2022-07-09T17:24:32.000Z","updatedAt":"2022-07-09T17:24:32.000Z","tags":[{"id":1703,"name":"automatic-semicolon-insertion","slug":"automatic-semicolon-insertion","createdAt":"2022-07-09T17:24:32.000Z","updatedAt":"2022-07-09T17:24:32.000Z","Questions_Tags":{"questionId":272,"tagId":1703}}]}},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"what-are-the-rules-for-javascript's-automatic-semicolon-insertion-(asi)-1657387472789"},"buildId":"D-Vv5KfwuaE883xCdWfex","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>