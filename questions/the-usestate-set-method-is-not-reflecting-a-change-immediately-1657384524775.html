<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><title>The useState set method is not reflecting a change immediately | Solutions Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="I am trying to learn hooks and the useState method has made me confused. I am assigning an initial value to a state in the form of an array. The set method in useState is not working for me, both with and without the spread syntax.
I have made an API on another PC that I am calling and fetching the data which I want to set into the state.
Here is my code:


&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;

&lt;script type=&quot;text/babel&quot; defer&gt;
// import React, { useState, useEffect } from &quot;react&quot;;
// import ReactDOM from &quot;react-dom&quot;;
const { useState, useEffect } = React; // web-browser variant

const StateSelector = () =&gt; {
  const initialValue = [
    {
      category: &quot;&quot;,
      photo: &quot;&quot;,
      description: &quot;&quot;,
      id: 0,
      name: &quot;&quot;,
      rating: 0
    }
  ];

  const [movies, setMovies] = useState(initialValue);

  useEffect(() =&gt; {
    (async function() {
      try {
        // const response = await fetch(&quot;http://192.168.1.164:5000/movies/display&quot;);
        // const json = await response.json();
        // const result = json.data.result;
        const result = [
          {
            category: &quot;cat1&quot;,
            description: &quot;desc1&quot;,
            id: &quot;1546514491119&quot;,
            name: &quot;randomname2&quot;,
            photo: null,
            rating: &quot;3&quot;
          },
          {
            category: &quot;cat2&quot;,
            description: &quot;desc1&quot;,
            id: &quot;1546837819818&quot;,
            name: &quot;randomname1&quot;,
            rating: &quot;5&quot;
          }
        ];
        console.log(&quot;result =&quot;, result);
        setMovies(result);
        console.log(&quot;movies =&quot;, movies);
      } catch (e) {
        console.error(e);
      }
    })();
  }, []);

  return &lt;p&gt;hello&lt;/p&gt;;
};

const rootElement = document.getElementById(&quot;root&quot;);
ReactDOM.render(&lt;StateSelector /&gt;, rootElement);
&lt;/script&gt;

&lt;script src=&quot;https://unpkg.com/@babel/standalone@7/babel.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/react@17/umd/react.production.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/react-dom@17/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;
 Run code snippetHide resultsExpand snippet


Neither setMovies(result) nor setMovies(...result) works.
I expect the result variable to be pushed into the movies array.
    "/><meta property="og:title" content="The useState set method is not reflecting a change immediately | Solutions Checker"/><meta property="og:description" content="I am trying to learn hooks and the useState method has made me confused. I am assigning an initial value to a state in the form of an array. The set method in useState is not working for me, both with and without the spread syntax.
I have made an API on another PC that I am calling and fetching the data which I want to set into the state.
Here is my code:


&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;

&lt;script type=&quot;text/babel&quot; defer&gt;
// import React, { useState, useEffect } from &quot;react&quot;;
// import ReactDOM from &quot;react-dom&quot;;
const { useState, useEffect } = React; // web-browser variant

const StateSelector = () =&gt; {
  const initialValue = [
    {
      category: &quot;&quot;,
      photo: &quot;&quot;,
      description: &quot;&quot;,
      id: 0,
      name: &quot;&quot;,
      rating: 0
    }
  ];

  const [movies, setMovies] = useState(initialValue);

  useEffect(() =&gt; {
    (async function() {
      try {
        // const response = await fetch(&quot;http://192.168.1.164:5000/movies/display&quot;);
        // const json = await response.json();
        // const result = json.data.result;
        const result = [
          {
            category: &quot;cat1&quot;,
            description: &quot;desc1&quot;,
            id: &quot;1546514491119&quot;,
            name: &quot;randomname2&quot;,
            photo: null,
            rating: &quot;3&quot;
          },
          {
            category: &quot;cat2&quot;,
            description: &quot;desc1&quot;,
            id: &quot;1546837819818&quot;,
            name: &quot;randomname1&quot;,
            rating: &quot;5&quot;
          }
        ];
        console.log(&quot;result =&quot;, result);
        setMovies(result);
        console.log(&quot;movies =&quot;, movies);
      } catch (e) {
        console.error(e);
      }
    })();
  }, []);

  return &lt;p&gt;hello&lt;/p&gt;;
};

const rootElement = document.getElementById(&quot;root&quot;);
ReactDOM.render(&lt;StateSelector /&gt;, rootElement);
&lt;/script&gt;

&lt;script src=&quot;https://unpkg.com/@babel/standalone@7/babel.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/react@17/umd/react.production.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://unpkg.com/react-dom@17/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;
 Run code snippetHide resultsExpand snippet


Neither setMovies(result) nor setMovies(...result) works.
I expect the result variable to be pushed into the movies array.
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"The useState set method is not reflecting a change immediately","text":"I am trying to learn hooks and the useState method has made me confused. I am assigning an initial value to a state in the form of an array. The set method in useState is not working for me, both with and without the spread syntax.\nI have made an API on another PC that I am calling and fetching the data which I want to set into the state.\nHere is my code:\n\n\n&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;\n\n&lt;script type=&quot;text/babel&quot; defer&gt;\n// import React, { useState, useEffect } from &quot;react&quot;;\n// import ReactDOM from &quot;react-dom&quot;;\nconst { useState, useEffect } = React; // web-browser variant\n\nconst StateSelector = () =&gt; {\n  const initialValue = [\n    {\n      category: &quot;&quot;,\n      photo: &quot;&quot;,\n      description: &quot;&quot;,\n      id: 0,\n      name: &quot;&quot;,\n      rating: 0\n    }\n  ];\n\n  const [movies, setMovies] = useState(initialValue);\n\n  useEffect(() =&gt; {\n    (async function() {\n      try {\n        // const response = await fetch(&quot;http://192.168.1.164:5000/movies/display&quot;);\n        // const json = await response.json();\n        // const result = json.data.result;\n        const result = [\n          {\n            category: &quot;cat1&quot;,\n            description: &quot;desc1&quot;,\n            id: &quot;1546514491119&quot;,\n            name: &quot;randomname2&quot;,\n            photo: null,\n            rating: &quot;3&quot;\n          },\n          {\n            category: &quot;cat2&quot;,\n            description: &quot;desc1&quot;,\n            id: &quot;1546837819818&quot;,\n            name: &quot;randomname1&quot;,\n            rating: &quot;5&quot;\n          }\n        ];\n        console.log(&quot;result =&quot;, result);\n        setMovies(result);\n        console.log(&quot;movies =&quot;, movies);\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, []);\n\n  return &lt;p&gt;hello&lt;/p&gt;;\n};\n\nconst rootElement = document.getElementById(&quot;root&quot;);\nReactDOM.render(&lt;StateSelector /&gt;, rootElement);\n&lt;/script&gt;\n\n&lt;script src=&quot;https://unpkg.com/@babel/standalone@7/babel.min.js&quot;&gt;&lt;/script&gt;\n&lt;script src=&quot;https://unpkg.com/react@17/umd/react.production.min.js&quot;&gt;&lt;/script&gt;\n&lt;script src=&quot;https://unpkg.com/react-dom@17/umd/react-dom.production.min.js&quot;&gt;&lt;/script&gt;\n Run code snippetHide resultsExpand snippet\n\n\nNeither setMovies(result) nor setMovies(...result) works.\nI expect the result variable to be pushed into the movies array.\n    ","answerCount":15,"upVoteCount":500,"suggestedAnswer":[{"text":"Much like .setState() in class components created by extending React.Component or React.PureComponent, the state update using the updater provided by useState hook is also asynchronous, and will not be reflected immediately.\nAlso, the main issue here is not just the asynchronous nature but the fact that state values are used by functions based on their current closures, and state updates will reflect in the next re-render by which the existing closures are not affected, but new ones are created. Now in the current state, the values within hooks are obtained by existing closures, and when a re-render happens, the closures are updated based on whether the function is recreated again or not.\nEven if you add a setTimeout the function, though the timeout will run after some time by which the re-render would have happened, the setTimeout will still use the value from its previous closure and not the updated one.\nsetMovies(result);\nconsole.log(movies) // movies here will not be updated\n\nIf you want to perform an action on state update, you need to use the useEffect hook, much like using componentDidUpdate in class components since the setter returned by useState doesn&apos;t have a callback pattern\nuseEffect(() =&gt; {\n    // action on update of movies\n}, [movies]);\n\nAs far as the syntax to update state is concerned, setMovies(result) will replace the previous movies value in the state with those available from the async request.\nHowever, if you want to merge the response with the previously existing values, you must use the callback syntax of state updation along with the correct use of spread syntax like\nsetMovies(prevMovies =&gt; ([...prevMovies, ...result]));\n\n    ","url":"/questions/[slug]#solution1","@type":"Answer","upvoteCount":0},{"text":"Additional details to the previous answer:\nWhile React&apos;s setState is asynchronous (both classes and hooks), and it&apos;s tempting to use that fact to explain the observed behavior, it is not the reason why it happens.\nTLDR: The reason is a closure scope around an immutable const value.\n\nSolutions:\n\nread the value in render function (not inside nested functions):\n  useEffect(() =&gt; { setMovies(result) }, [])\n  console.log(movies)\n\n\nadd the variable into dependencies (and use the react-hooks/exhaustive-deps eslint rule):\n  useEffect(() =&gt; { setMovies(result) }, [])\n  useEffect(() =&gt; { console.log(movies) }, [movies])\n\n\nuse a temporary variable:\n  useEffect(() =&gt; {\n    const newMovies = result\n    console.log(newMovies)\n    setMovies(newMovies)\n  }, [])\n\n\nuse a mutable reference (if we don&apos;t need a state and only want to remember the value - updating a ref doesn&apos;t trigger re-render):\n  const moviesRef = useRef(initialValue)\n  useEffect(() =&gt; {\n    moviesRef.current = result\n    console.log(moviesRef.current)\n  }, [])\n\n\n\n\nExplanation why it happens:\nIf async was the only reason, it would be possible to await setState().\nHowever, both props and state are assumed to be unchanging during 1 render.\n\nTreat this.state as if it were immutable.\n\nWith hooks, this assumption is enhanced by using constant values with the const keyword:\nconst [state, setState] = useState(&apos;initial&apos;)\n\nThe value might be different between 2 renders, but remains a constant inside the render itself and inside any closures (functions that live longer even after render is finished, e.g. useEffect, event handlers, inside any Promise or  setTimeout).\nConsider following fake, but synchronous, React-like implementation:\n\n\n// sync implementation:\n\nlet internalState\nlet renderAgain\n\nconst setState = (updateFn) =&gt; {\n  internalState = updateFn(internalState)\n  renderAgain()\n}\n\nconst useState = (defaultState) =&gt; {\n  if (!internalState) {\n    internalState = defaultState\n  }\n  return [internalState, setState]\n}\n\nconst render = (component, node) =&gt; {\n  const {html, handleClick} = component()\n  node.innerHTML = html\n  renderAgain = () =&gt; render(component, node)\n  return handleClick\n}\n\n// test:\n\nconst MyComponent = () =&gt; {\n  const [x, setX] = useState(1)\n  console.log(&apos;in render:&apos;, x) // \n  \n  const handleClick = () =&gt; {\n    setX(current =&gt; current + 1)\n    console.log(&apos;in handler/effect/Promise/setTimeout:&apos;, x) //  NOT updated\n  }\n  \n  return {\n    html: `&lt;button&gt;${x}&lt;/button&gt;`,\n    handleClick\n  }\n}\n\nconst triggerClick = render(MyComponent, document.getElementById(&apos;root&apos;))\ntriggerClick()\ntriggerClick()\ntriggerClick()\n&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;\n Run code snippetHide resultsExpand snippet\n\n\n    ","url":"/questions/[slug]#solution2","@type":"Answer","upvoteCount":0},{"text":"I know that there are already very good answers. But I want to give another idea how to solve the same issue, and access the latest &apos;movie&apos; state, using my module react-useStateRef.\nAs you understand by using React state you can render the page every time the state change. But by using React ref, you can always get the latest values.\nSo the module react-useStateRef let you use state&apos;s and ref&apos;s together. It&apos;s backward compatible with React.useState, so you can just replace the import statement\nconst { useEffect } = React\nimport { useState } from &apos;react-usestateref&apos;\n\n  const [movies, setMovies] = useState(initialValue);\n\n  useEffect(() =&gt; {\n    (async function() {\n      try {\n\n        const result = [\n          {\n            id: &quot;1546514491119&quot;,\n          },\n        ];\n        console.log(&quot;result =&quot;, result);\n        setMovies(result);\n        console.log(&quot;movies =&quot;, movies.current); // will give you the latest results\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, []);\n\nMore information:\n\nreact-usestsateref\n\n    ","url":"/questions/[slug]#solution3","@type":"Answer","upvoteCount":0},{"text":"I just finished a rewrite with useReducer, following @kentcdobs article (ref below) which really gave me a solid result that suffers not one bit from these closure problems.\nSee: https://kentcdodds.com/blog/how-to-use-react-context-effectively\nI condensed his readable boilerplate to my preferred level of DRYness -- reading his sandbox implementation will show you how it actually works.\nimport React from &apos;react&apos;\n\n// ref: https://kentcdodds.com/blog/how-to-use-react-context-effectively\n\nconst ApplicationDispatch = React.createContext()\nconst ApplicationContext = React.createContext()\n\nfunction stateReducer(state, action) {\n  if (state.hasOwnProperty(action.type)) {\n    return { ...state, [action.type]: state[action.type] = action.newValue };\n  }\n  throw new Error(`Unhandled action type: ${action.type}`);\n}\n\nconst initialState = {\n  keyCode: &apos;&apos;,\n  testCode: &apos;&apos;,\n  testMode: false,\n  phoneNumber: &apos;&apos;,\n  resultCode: null,\n  mobileInfo: &apos;&apos;,\n  configName: &apos;&apos;,\n  appConfig: {},\n};\n\nfunction DispatchProvider({ children }) {\n  const [state, dispatch] = React.useReducer(stateReducer, initialState);\n  return (\n    &lt;ApplicationDispatch.Provider value={dispatch}&gt;\n      &lt;ApplicationContext.Provider value={state}&gt;\n        {children}\n      &lt;/ApplicationContext.Provider&gt;\n    &lt;/ApplicationDispatch.Provider&gt;\n  )\n}\n\nfunction useDispatchable(stateName) {\n  const context = React.useContext(ApplicationContext);\n  const dispatch = React.useContext(ApplicationDispatch);\n  return [context[stateName], newValue =&gt; dispatch({ type: stateName, newValue })];\n}\n\nfunction useKeyCode() { return useDispatchable(&apos;keyCode&apos;); }\nfunction useTestCode() { return useDispatchable(&apos;testCode&apos;); }\nfunction useTestMode() { return useDispatchable(&apos;testMode&apos;); }\nfunction usePhoneNumber() { return useDispatchable(&apos;phoneNumber&apos;); }\nfunction useResultCode() { return useDispatchable(&apos;resultCode&apos;); }\nfunction useMobileInfo() { return useDispatchable(&apos;mobileInfo&apos;); }\nfunction useConfigName() { return useDispatchable(&apos;configName&apos;); }\nfunction useAppConfig() { return useDispatchable(&apos;appConfig&apos;); }\n\nexport {\n  DispatchProvider,\n  useKeyCode,\n  useTestCode,\n  useTestMode,\n  usePhoneNumber,\n  useResultCode,\n  useMobileInfo,\n  useConfigName,\n  useAppConfig,\n}\n\nWith a usage similar to this:\nimport { useHistory } from &quot;react-router-dom&quot;;\n\n// https://react-bootstrap.github.io/components/alerts\nimport { Container, Row } from &apos;react-bootstrap&apos;;\n\nimport { useAppConfig, useKeyCode, usePhoneNumber } from &apos;../../ApplicationDispatchProvider&apos;;\n\nimport { ControlSet } from &apos;../../components/control-set&apos;;\nimport { keypadClass } from &apos;../../utils/style-utils&apos;;\nimport { MaskedEntry } from &apos;../../components/masked-entry&apos;;\nimport { Messaging } from &apos;../../components/messaging&apos;;\nimport { SimpleKeypad, HandleKeyPress, ALT_ID } from &apos;../../components/simple-keypad&apos;;\n\nexport const AltIdPage = () =&gt; {\n  const history = useHistory();\n  const [keyCode, setKeyCode] = useKeyCode();\n  const [phoneNumber, setPhoneNumber] = usePhoneNumber();\n  const [appConfig, setAppConfig] = useAppConfig();\n\n  const keyPressed = btn =&gt; {\n    const maxLen = appConfig.phoneNumberEntry.entryLen;\n    const newValue = HandleKeyPress(btn, phoneNumber).slice(0, maxLen);\n    setPhoneNumber(newValue);\n  }\n\n  const doSubmit = () =&gt; {\n    history.push(&apos;s&apos;);\n  }\n\n  const disableBtns = phoneNumber.length &lt; appConfig.phoneNumberEntry.entryLen;\n\n  return (\n    &lt;Container fluid className=&quot;text-center&quot;&gt;\n      &lt;Row&gt;\n        &lt;Messaging {...{ msgColors: appConfig.pageColors, msgLines: appConfig.entryMsgs.altIdMsgs }} /&gt;\n      &lt;/Row&gt;\n      &lt;Row&gt;\n        &lt;MaskedEntry {...{ ...appConfig.phoneNumberEntry, entryColors: appConfig.pageColors, entryLine: phoneNumber }} /&gt;\n      &lt;/Row&gt;\n      &lt;Row&gt;\n        &lt;SimpleKeypad {...{ keyboardName: ALT_ID, themeName: appConfig.keyTheme, keyPressed, styleClass: keypadClass }} /&gt;\n      &lt;/Row&gt;\n      &lt;Row&gt;\n        &lt;ControlSet {...{ btnColors: appConfig.buttonColors, disabled: disableBtns, btns: [{ text: &apos;Submit&apos;, click: doSubmit }] }} /&gt;\n      &lt;/Row&gt;\n    &lt;/Container&gt;\n  );\n};\n\nAltIdPage.propTypes = {};\n\nNow everything persists smoothly everywhere across all my pages\n    ","url":"/questions/[slug]#solution4","@type":"Answer","upvoteCount":0},{"text":"React&apos;s useEffect has its own state/lifecycle. It&apos;s related to mutation of state, and it will not update the state until the effect is destroyed.\nJust pass a single argument in parameters state or leave it a black array and it will work perfectly.\nReact.useEffect(() =&gt; {\n    console.log(&quot;effect&quot;);\n    (async () =&gt; {\n        try {\n            let result = await fetch(&quot;/query/countries&quot;);\n            const res = await result.json();\n            let result1 = await fetch(&quot;/query/projects&quot;);\n            const res1 = await result1.json();\n            let result11 = await fetch(&quot;/query/regions&quot;);\n            const res11 = await result11.json();\n            setData({\n                countries: res,\n                projects: res1,\n                regions: res11\n            });\n        } catch {}\n    })(data)\n}, [setData])\n# or use this\nuseEffect(() =&gt; {\n    (async () =&gt; {\n        try {\n            await Promise.all([\n                fetch(&quot;/query/countries&quot;).then((response) =&gt; response.json()),\n                fetch(&quot;/query/projects&quot;).then((response) =&gt; response.json()),\n                fetch(&quot;/query/regions&quot;).then((response) =&gt; response.json())\n            ]).then(([country, project, region]) =&gt; {\n                // console.log(country, project, region);\n                setData({\n                    countries: country,\n                    projects: project,\n                    regions: region\n                });\n            })\n        } catch {\n            console.log(&quot;data fetch error&quot;)\n        }\n    })()\n}, [setData]);\n\nAlternatively, you can try React.useRef() for instant change in the React hook.\nconst movies = React.useRef(null);\nuseEffect(() =&gt; {\nmovies.current=&apos;values&apos;;\nconsole.log(movies.current)\n}, [])\n\n    ","url":"/questions/[slug]#solution5","@type":"Answer","upvoteCount":0},{"text":"The closure is not the only reason.\nBased on the source code of useState (simplified below). Seems to me the value is never assigned right away.\nWhat happens is that an update action is queued when you invoke setValue. And after the schedule kicks in and only when you get to the next render, these update action then is applied to that state.\nWhich means even we don&apos;t have closure issue, react version of useState is not going to give you the new value right away. The new value doesn&apos;t even exist until next render.\n  function useState(initialState) {\n    let hook;\n    ...\n\n    let baseState = hook.memoizedState;\n    if (hook.queue.pending) {\n      let firstUpdate = hook.queue.pending.next;\n\n      do {\n        const action = firstUpdate.action;\n        baseState = action(baseState);            // setValue HERE\n        firstUpdate = firstUpdate.next;\n      } while (firstUpdate !== hook.queue.pending);\n\n      hook.queue.pending = null;\n    }\n    hook.memoizedState = baseState;\n\n    return [baseState, dispatchAction.bind(null, hook.queue)];\n  }\n\nfunction dispatchAction(queue, action) {\n  const update = {\n    action,\n    next: null\n  };\n  if (queue.pending === null) {\n    update.next = update;\n  } else {\n    update.next = queue.pending.next;\n    queue.pending.next = update;\n  }\n  queue.pending = update;\n\n  isMount = false;\n  workInProgressHook = fiber.memoizedState;\n  schedule();\n}\n\n\nThere&apos;s also an article explaining the above in the similar way, https://dev.to/adamklein/we-don-t-know-how-react-state-hook-works-1lp8\n    ","url":"/questions/[slug]#solution6","@type":"Answer","upvoteCount":0},{"text":"I found this to be good. Instead of defining state (approach 1) as, example,\nconst initialValue = 1;\n\nconst [state,setState] = useState(initialValue)\n\n\nTry this approach (approach 2),\nconst [state = initialValue,setState] = useState()\n\n\nThis resolved the rerender issue without using useEffect since we are not concerned with its internal closure approach with this case.\nP.S.: If you are concerned with using old state for any use case then useState with useEffect needs to be used since it will need to have that state, so approach 1 shall be used in this situation.\n    ","url":"/questions/[slug]#solution7","@type":"Answer","upvoteCount":0},{"text":"I too was stuck with the same problem. As other answers above have clarified the error here, which is that useState is asynchronous and you are trying to use the value just after setState. It is not updating on the console.log() part because of the asynchronous nature of setState, it lets your further code to execute, while the value updating happens on the background. Thus you are getting the previous value. When the setState is completed on the background it will update the value and you will have access to that value on the next render.\nIf anyone is interested to understand this in detail. Here is a really good Conference talk on the topic.\nhttps://www.youtube.com/watch?v=8aGhZQkoFbQ\n    ","url":"/questions/[slug]#solution8","@type":"Answer","upvoteCount":0},{"text":"If we have to update state only, then a better way can be if we use the push method to do so.\nHere is my code. I want to store URLs from Firebase in state.\nconst [imageUrl, setImageUrl] = useState([]);\nconst [reload, setReload] = useState(0);\n\nuseEffect(() =&gt; {\n    if (reload === 4) {\n        downloadUrl1();\n    }\n}, [reload]);\n\n\nconst downloadUrl = async () =&gt; {\n    setImages([]);\n    try {\n        for (let i = 0; i &lt; images.length; i++) {\n            let url = await storage().ref(urls[i].path).getDownloadURL();\n            imageUrl.push(url);\n            setImageUrl([...imageUrl]);\n\n            console.log(url, &apos;check&apos;, urls.length, &apos;length&apos;, imageUrl.length);\n        }\n    }\n    catch (e) {\n        console.log(e);\n    }\n};\n\nconst handleSubmit = async () =&gt; {\n    setReload(4);\n    await downloadUrl();\n    console.log(imageUrl);\n    console.log(&apos;post submitted&apos;);\n};\n\nThis code works to put URLs in state as an array. This might also work for you.\n    ","url":"/questions/[slug]#solution9","@type":"Answer","upvoteCount":0},{"text":"With custom hooks from my library, you can wait for the state values to update:\n\nuseAsyncWatcher(...values):watcherFn(peekPrevValue: boolean)=&gt;Promise - is a promise wrapper around useEffect that can wait for updates and return a new value and possibly a previous one if the optional peekPrevValue argument is set to true.\n\n(Live Demo)\n    import React, { useState, useEffect, useCallback } from &quot;react&quot;;\n    import { useAsyncWatcher } from &quot;use-async-effect2&quot;;\n    \n    function TestComponent(props) {\n      const [counter, setCounter] = useState(0);\n      const [text, setText] = useState(&quot;&quot;);\n    \n      const textWatcher = useAsyncWatcher(text);\n    \n      useEffect(() =&gt; {\n        setText(`Counter: ${counter}`);\n      }, [counter]);\n    \n      const inc = useCallback(() =&gt; {\n        (async () =&gt; {\n          await new Promise((resolve) =&gt; setTimeout(resolve, 1000));\n          setCounter((counter) =&gt; counter + 1);\n          const updatedText = await textWatcher();\n          console.log(updatedText);\n        })();\n      }, []);\n    \n      return (\n        &lt;div className=&quot;component&quot;&gt;\n          &lt;div className=&quot;caption&quot;&gt;useAsyncEffect demo&lt;/div&gt;\n          &lt;div&gt;{counter}&lt;/div&gt;\n          &lt;button onClick={inc}&gt;Inc counter&lt;/button&gt;\n        &lt;/div&gt;\n      );\n    }\n    \n    export default TestComponent;\n\n\nuseAsyncDeepState is a deep state implementation (similar to this.setState (patchObject)) whose setter can return a promise synchronized with the internal effect. If the setter is called with no arguments, it does not change the state values, but simply subscribes to state updates. In this case, you can get the state value from anywhere inside your component, since function closures are no longer a hindrance.\n\n(Live Demo)\nimport React, { useCallback, useEffect } from &quot;react&quot;;\nimport { useAsyncDeepState } from &quot;use-async-effect2&quot;;\n\nfunction TestComponent(props) {\n  const [state, setState] = useAsyncDeepState({\n    counter: 0,\n    computedCounter: 0\n  });\n\n  useEffect(() =&gt; {\n    setState(({ counter }) =&gt; ({\n      computedCounter: counter * 2\n    }));\n  }, [state.counter]);\n\n  const inc = useCallback(() =&gt; {\n    (async () =&gt; {\n      await new Promise((resolve) =&gt; setTimeout(resolve, 1000));\n      await setState(({ counter }) =&gt; ({ counter: counter + 1 }));\n      console.log(&quot;computedCounter=&quot;, state.computedCounter);\n    })();\n  });\n\n  return (\n    &lt;div className=&quot;component&quot;&gt;\n      &lt;div className=&quot;caption&quot;&gt;useAsyncDeepState demo&lt;/div&gt;\n      &lt;div&gt;state.counter : {state.counter}&lt;/div&gt;\n      &lt;div&gt;state.computedCounter : {state.computedCounter}&lt;/div&gt;\n      &lt;button onClick={() =&gt; inc()}&gt;Inc counter&lt;/button&gt;\n    &lt;/div&gt;\n  );\n}\n\n    ","url":"/questions/[slug]#solution10","@type":"Answer","upvoteCount":0},{"text":"var [state,setState]=useState(defaultValue)\n\nuseEffect(()=&gt;{\n   var updatedState\n   setState(currentState=&gt;{    // Do not change the state by get the updated state\n      updateState=currentState\n      return currentState\n   })\n   alert(updateState) // the current state.\n})\n\n    ","url":"/questions/[slug]#solution11","@type":"Answer","upvoteCount":0},{"text":"Without any addtional NPM package\n//...\nconst BackendPageListing = () =&gt; {\n    \n    const [ myData, setMyData] = useState( {\n        id: 1,\n        content: &quot;abc&quot;\n    })\n\n    const myFunction = ( x ) =&gt; {\n        \n        setPagenateInfo({\n        ...myData,\n        content: x\n        })\n\n        console.log(myData) // not reflecting change immediately\n\n        let myDataNew = {...myData, content: x };\n        \n        console.log(myDataNew) // Reflecting change immediately\n\n    }\n\n    return (\n        &lt;&gt;\n            &lt;button onClick={()=&gt;{ myFunction(&quot;New Content&quot;)} }&gt;Update MyData&lt;/button&gt;\n        &lt;/&gt;\n    )\n\n    ","url":"/questions/[slug]#solution12","@type":"Answer","upvoteCount":0},{"text":"Not saying to do this, but it isn&apos;t hard to do what the OP asked without useEffect.\nUse a promise to resolve the new state in the body of the setter function:\nconst getState = &lt;T&gt;(\n  setState: React.Dispatch&lt;React.SetStateAction&lt;T&gt;&gt;\n): Promise&lt;T&gt; =&gt; {\n  return new Promise((resolve) =&gt; {\n    setState((currentState: T) =&gt; {\n      resolve(currentState);\n      return currentState;\n    });\n  });\n};\n\nAnd this is how you use it (example shows the comparison between count and outOfSyncCount/syncCount in the UI rendering):\nconst App: React.FC = () =&gt; {\n  const [count, setCount] = useState(0);\n  const [outOfSyncCount, setOutOfSyncCount] = useState(0);\n  const [syncCount, setSyncCount] = useState(0);\n\n  const handleOnClick = async () =&gt; {\n    setCount(count + 1);\n\n    // Doesn&apos;t work\n    setOutOfSyncCount(count);\n\n    // Works\n    const newCount = await getState(setCount);\n    setSyncCount(newCount);\n  };\n\n  return (\n    &lt;&gt;\n      &lt;h2&gt;Count = {count}&lt;/h2&gt;\n      &lt;h2&gt;Synced count = {syncCount}&lt;/h2&gt;\n      &lt;h2&gt;Out of sync count = {outOfSyncCount}&lt;/h2&gt;\n      &lt;button onClick={handleOnClick}&gt;Increment&lt;/button&gt;\n    &lt;/&gt;\n  );\n};\n\n    ","url":"/questions/[slug]#solution13","@type":"Answer","upvoteCount":0},{"text":"Use the Background Timer library. It solved my problem.\nconst timeoutId = BackgroundTimer.setTimeout(() =&gt; {\n    // This will be executed once after 1 seconds\n    // even when the application is the background\n    console.log(&apos;tac&apos;);\n}, 1000);\n\n    ","url":"/questions/[slug]#solution14","@type":"Answer","upvoteCount":0},{"text":"// replace\nreturn &lt;p&gt;hello&lt;/p&gt;;\n// with\nreturn &lt;p&gt;{JSON.stringify(movies)}&lt;/p&gt;;\n\n\nNow you should see, that your code actually does work. What does not work is the console.log(movies). This is because movies points to the old state. If you move your console.log(movies) outside of useEffect, right above the return, you will see the updated movies object.\n    ","url":"/questions/[slug]#solution15","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/9fb80f4eb9e2d3c9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9fb80f4eb9e2d3c9.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-18d80dcb3110b1ad.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/532-fec3344a80918110.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/817-363561828babdd16.js" defer=""></script><script src="/_next/static/chunks/81-89fd2eaadd8354ed.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-16d8c84aea765d4e.js" defer=""></script><script src="/_next/static/D-Vv5KfwuaE883xCdWfex/_buildManifest.js" defer=""></script><script src="/_next/static/D-Vv5KfwuaE883xCdWfex/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">.dlbxiY code{padding:5px;color:hsl(210deg 8% 15%);background-color:hsl(210deg 8% 90%);border-radius:3px;}/*!sc*/
data-styled.g5[id="sc-344134f6-0"]{content:"dlbxiY,"}/*!sc*/
</style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo.svg" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h4 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h4></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/the-usestate-set-method-is-not-reflecting-a-change-immediately-1657384524775#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="sc-344134f6-0 dlbxiY flex question-header items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/the-usestate-set-method-is-not-reflecting-a-change-immediately-1657384524775">The useState set method is not reflecting a change immediately</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/reactjs">reactjs</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/react-hooks">react-hooks</a></div></div><div class="question-content mt-5">
                
<p>I am trying to learn hooks and the <code>useState</code> method has made me confused. I am assigning an initial value to a state in the form of an array. The set method in <code>useState</code> is not working for me, both with and without the spread syntax.</p>
<p>I have made an API on another PC that I am calling and fetching the data which I want to set into the state.</p>
<p>Here is my code:</p>
<p></p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
<div class="snippet-code">
<pre class="snippet-code-html lang-html s-code-block"><code class="hljs language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"root"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/babel"</span> <span class="hljs-attr">defer</span>&gt;</span><span class="language-javascript">
<span class="hljs-comment">// import React, { useState, useEffect } from "react";</span>
<span class="hljs-comment">// import ReactDOM from "react-dom";</span>
<span class="hljs-keyword">const</span> { useState, useEffect } = <span class="hljs-title class_">React</span>; <span class="hljs-comment">// web-browser variant</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">StateSelector</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> initialValue = [
    {
      <span class="hljs-attr">category</span>: <span class="hljs-string">""</span>,
      <span class="hljs-attr">photo</span>: <span class="hljs-string">""</span>,
      <span class="hljs-attr">description</span>: <span class="hljs-string">""</span>,
      <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">""</span>,
      <span class="hljs-attr">rating</span>: <span class="hljs-number">0</span>
    }
  ];

  <span class="hljs-keyword">const</span> [movies, setMovies] = <span class="hljs-title function_">useState</span>(initialValue);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    (<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// const response = await fetch("http://192.168.1.164:5000/movies/display");</span>
        <span class="hljs-comment">// const json = await response.json();</span>
        <span class="hljs-comment">// const result = json.data.result;</span>
        <span class="hljs-keyword">const</span> result = [
          {
            <span class="hljs-attr">category</span>: <span class="hljs-string">"cat1"</span>,
            <span class="hljs-attr">description</span>: <span class="hljs-string">"desc1"</span>,
            <span class="hljs-attr">id</span>: <span class="hljs-string">"1546514491119"</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-string">"randomname2"</span>,
            <span class="hljs-attr">photo</span>: <span class="hljs-literal">null</span>,
            <span class="hljs-attr">rating</span>: <span class="hljs-string">"3"</span>
          },
          {
            <span class="hljs-attr">category</span>: <span class="hljs-string">"cat2"</span>,
            <span class="hljs-attr">description</span>: <span class="hljs-string">"desc1"</span>,
            <span class="hljs-attr">id</span>: <span class="hljs-string">"1546837819818"</span>,
            <span class="hljs-attr">name</span>: <span class="hljs-string">"randomname1"</span>,
            <span class="hljs-attr">rating</span>: <span class="hljs-string">"5"</span>
          }
        ];
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"result ="</span>, result);
        <span class="hljs-title function_">setMovies</span>(result);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"movies ="</span>, movies);
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);
      }
    })();
  }, []);

  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
};

<span class="hljs-keyword">const</span> rootElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"root"</span>);
<span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">StateSelector</span> /&gt;</span></span>, rootElement);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/@babel/standalone@7/babel.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/react@17/umd/react.production.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre>
<div class="snippet-result"><div class="snippet-ctas"><button type="button" class="s-btn s-btn__primary"><span class="icon-play-white _hover"></span><span> Run code snippet</span></button><input class="copySnippet s-btn s-btn__filled" type="button" value="Copy snippet to answer" style="display: none;"><button type="button" class="s-btn hideResults" style="display: none;">Hide results</button><div class="popout-code"><a class="snippet-expand-link">Expand snippet</a></div></div><div class="snippet-result-code" style="display: none;"><iframe name="sif1" sandbox="allow-forms allow-modals allow-scripts" class="snippet-box-edit snippet-box-result" frameborder="0"></iframe></div></div></div>
</div>
<p></p>
<p>Neither <code>setMovies(result)</code> nor <code>setMovies(...result)</code> works.</p>
<p>I expect the <code>result</code> variable to be pushed into the <code>movies</code> array.</p>
    </div></div></div><div class="sc-344134f6-2 EUowZ"><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Much <a href="https://stackoverflow.com/q/30782948/1048572">like <code>.setState()</code> in class components</a> created by extending <code>React.Component</code> or <code>React.PureComponent</code>, the state update using the updater provided by <code>useState</code> hook is also asynchronous, and will not be reflected immediately.</p>
<p><strong>Also, the main issue here is not just the asynchronous nature but the fact that state values are used by functions based on their current closures, and state updates will reflect in the next re-render by which the existing closures are not affected, but new ones are created</strong>. Now in the current state, the values within hooks are obtained by existing closures, and when a re-render happens, the closures are updated based on whether the function is recreated again or not.</p>
<p>Even if you add a <code>setTimeout</code> the function, though the timeout will run after some time by which the re-render would have happened, the <code>setTimeout</code> will still use the value from its previous closure and not the updated one.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title function_">setMovies</span>(result);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(movies) <span class="hljs-comment">// movies here will not be updated</span>
</code></pre>
<p>If you want to perform an action on state update, you need to use the <code>useEffect</code> hook, much like using <code>componentDidUpdate</code> in class components since the setter returned by <code>useState</code> doesn't have a callback pattern</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// action on update of movies</span>
}, [movies]);
</code></pre>
<p>As far as the syntax to update state is concerned, <code>setMovies(result)</code> will replace the previous <code>movies</code> value in the state with those available from the async request.</p>
<p>However, if you want to merge the response with the previously existing values, you must use the callback syntax of state updation along with the correct use of spread syntax like</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title function_">setMovies</span>(<span class="hljs-function"><span class="hljs-params">prevMovies</span> =&gt;</span> ([...prevMovies, ...result]));
</code></pre>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><sub><em>Additional details to the <a href="https://stackoverflow.com/a/54069332/1176601">previous answer</a>:</em></sub></p>
<p>While React's <code>setState</code> <em>is</em> asynchronous (both classes and hooks), and it's tempting to use that fact to explain the observed behavior, it is not the <em><strong>reason why</strong></em> it happens.</p>
<p>TLDR: The reason is a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" rel="noreferrer">closure</a> scope around an immutable <code>const</code> value.</p>
<hr>
<h3><em>Solutions:</em></h3>
<ul>
<li><p>read the value in render function (not inside nested functions):</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-title function_">setMovies</span>(result) }, [])
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(movies)
</code></pre>
</li>
<li><p>add the variable into dependencies (and use the <a href="https://reactjs.org/docs/hooks-rules.html#eslint-plugin" rel="noreferrer">react-hooks/exhaustive-deps</a> eslint rule):</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-title function_">setMovies</span>(result) }, [])
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(movies) }, [movies])
</code></pre>
</li>
<li><p>use a temporary variable:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> newMovies = result
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(newMovies)
    <span class="hljs-title function_">setMovies</span>(newMovies)
  }, [])
</code></pre>
</li>
<li><p>use a mutable reference (if we don't need a state and only want to remember the value - updating a ref doesn't trigger re-render):</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">  <span class="hljs-keyword">const</span> moviesRef = <span class="hljs-title function_">useRef</span>(initialValue)
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    moviesRef.<span class="hljs-property">current</span> = result
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(moviesRef.<span class="hljs-property">current</span>)
  }, [])
</code></pre>
</li>
</ul>
<hr>
<h3><em>Explanation why it happens:</em></h3>
<p>If async was the only reason, it would be possible to <code>await setState()</code>.</p>
<p>However, both <code>props</code> and <code>state</code> are <a href="https://reactjs.org/docs/react-component.html#state" rel="noreferrer">assumed to be unchanging during 1 render</a>.</p>
<blockquote>
<p>Treat <code>this.state</code> as if it were immutable.</p>
</blockquote>
<p>With hooks, this assumption is enhanced by using <strong>constant values</strong> with the <code>const</code> keyword:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'initial'</span>)
</code></pre>
<p>The value might be different between 2 renders, but remains a constant inside the render itself and inside any <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" rel="noreferrer">closures</a> (functions that live longer even after render is finished, e.g. <code>useEffect</code>, event handlers, inside any Promise or  setTimeout).</p>
<p>Consider following fake, but <strong>synchronous</strong>, React-like implementation:</p>
<p></p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
<div class="snippet-code">
<pre class="snippet-code-js lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// sync implementation:</span>

<span class="hljs-keyword">let</span> internalState
<span class="hljs-keyword">let</span> renderAgain

<span class="hljs-keyword">const</span> <span class="hljs-title function_">setState</span> = (<span class="hljs-params">updateFn</span>) =&gt; {
  internalState = <span class="hljs-title function_">updateFn</span>(internalState)
  <span class="hljs-title function_">renderAgain</span>()
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">useState</span> = (<span class="hljs-params">defaultState</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!internalState) {
    internalState = defaultState
  }
  <span class="hljs-keyword">return</span> [internalState, setState]
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">render</span> = (<span class="hljs-params">component, node</span>) =&gt; {
  <span class="hljs-keyword">const</span> {html, handleClick} = <span class="hljs-title function_">component</span>()
  node.<span class="hljs-property">innerHTML</span> = html
  renderAgain = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">render</span>(component, node)
  <span class="hljs-keyword">return</span> handleClick
}

<span class="hljs-comment">// test:</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">MyComponent</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> [x, setX] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">1</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'in render:'</span>, x) <span class="hljs-comment">// </span>
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-title function_">setX</span>(<span class="hljs-function"><span class="hljs-params">current</span> =&gt;</span> current + <span class="hljs-number">1</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'in handler/effect/Promise/setTimeout:'</span>, x) <span class="hljs-comment">//  NOT updated</span>
  }
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">html</span>: <span class="hljs-string">`&lt;button&gt;<span class="hljs-subst">${x}</span>&lt;/button&gt;`</span>,
    handleClick
  }
}

<span class="hljs-keyword">const</span> triggerClick = <span class="hljs-title function_">render</span>(<span class="hljs-title class_">MyComponent</span>, <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>))
<span class="hljs-title function_">triggerClick</span>()
<span class="hljs-title function_">triggerClick</span>()
<span class="hljs-title function_">triggerClick</span>()</code></pre>
<pre class="snippet-code-html lang-html s-code-block"><code class="hljs language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"root"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre>
<div class="snippet-result"><div class="snippet-ctas"><button type="button" class="s-btn s-btn__primary"><span class="icon-play-white _hover"></span><span> Run code snippet</span></button><input class="copySnippet s-btn s-btn__filled" type="button" value="Copy snippet to answer" style="display: none;"><button type="button" class="s-btn hideResults" style="display: none;">Hide results</button><div class="popout-code"><a class="snippet-expand-link">Expand snippet</a></div></div><div class="snippet-result-code" style="display: none;"><iframe name="sif2" sandbox="allow-forms allow-modals allow-scripts" class="snippet-box-edit snippet-box-result" frameborder="0"></iframe></div></div></div>
</div>
<p></p>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I know that there are already very good answers. But I want to give another idea how to solve the same issue, and access the latest 'movie' state, using my module <a href="https://www.npmjs.com/package/react-usestateref" rel="noreferrer">react-useStateRef</a>.</p>
<p>As you understand by using React state you can render the page every time the state change. But by using React ref, you can always get the latest values.</p>
<p>So the module <code>react-useStateRef</code> let you use state's and ref's together. It's backward compatible with <code>React.useState</code>, so you can just replace the <code>import</code> statement</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> { useEffect } = <span class="hljs-title class_">React</span>
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-usestateref'</span>

  <span class="hljs-keyword">const</span> [movies, setMovies] = <span class="hljs-title function_">useState</span>(initialValue);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    (<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
      <span class="hljs-keyword">try</span> {

        <span class="hljs-keyword">const</span> result = [
          {
            <span class="hljs-attr">id</span>: <span class="hljs-string">"1546514491119"</span>,
          },
        ];
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"result ="</span>, result);
        <span class="hljs-title function_">setMovies</span>(result);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"movies ="</span>, movies.<span class="hljs-property">current</span>); <span class="hljs-comment">// will give you the latest results</span>
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);
      }
    })();
  }, []);
</code></pre>
<h2>More information:</h2>
<ul>
<li><a href="https://www.npmjs.com/package/react-usestateref" rel="noreferrer">react-usestsateref</a></li>
</ul>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I just finished a rewrite with useReducer, following @kentcdobs article (ref below) which really gave me a solid result that suffers not one bit from these closure problems.</p>
<p>See: <a href="https://kentcdodds.com/blog/how-to-use-react-context-effectively" rel="nofollow noreferrer">https://kentcdodds.com/blog/how-to-use-react-context-effectively</a></p>
<p>I condensed his readable boilerplate to my preferred level of DRYness -- reading his sandbox implementation will show you how it actually works.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>

<span class="hljs-comment">// ref: https://kentcdodds.com/blog/how-to-use-react-context-effectively</span>

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ApplicationDispatch</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>()
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ApplicationContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>()

<span class="hljs-keyword">function</span> <span class="hljs-title function_">stateReducer</span>(<span class="hljs-params">state, action</span>) {
  <span class="hljs-keyword">if</span> (state.<span class="hljs-title function_">hasOwnProperty</span>(action.<span class="hljs-property">type</span>)) {
    <span class="hljs-keyword">return</span> { ...state, [action.<span class="hljs-property">type</span>]: state[action.<span class="hljs-property">type</span>] = action.<span class="hljs-property">newValue</span> };
  }
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Unhandled action type: <span class="hljs-subst">${action.type}</span>`</span>);
}

<span class="hljs-keyword">const</span> initialState = {
  <span class="hljs-attr">keyCode</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">testCode</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">testMode</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">phoneNumber</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">resultCode</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">mobileInfo</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">configName</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">appConfig</span>: {},
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">DispatchProvider</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useReducer</span>(stateReducer, initialState);
  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ApplicationDispatch.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{dispatch}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ApplicationContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{state}</span>&gt;</span>
        {children}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ApplicationContext.Provider</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ApplicationDispatch.Provider</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">useDispatchable</span>(<span class="hljs-params">stateName</span>) {
  <span class="hljs-keyword">const</span> context = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ApplicationContext</span>);
  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ApplicationDispatch</span>);
  <span class="hljs-keyword">return</span> [context[stateName], <span class="hljs-function"><span class="hljs-params">newValue</span> =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: stateName, newValue })];
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">useKeyCode</span>(<span class="hljs-params"></span>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">useDispatchable</span>(<span class="hljs-string">'keyCode'</span>); }
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useTestCode</span>(<span class="hljs-params"></span>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">useDispatchable</span>(<span class="hljs-string">'testCode'</span>); }
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useTestMode</span>(<span class="hljs-params"></span>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">useDispatchable</span>(<span class="hljs-string">'testMode'</span>); }
<span class="hljs-keyword">function</span> <span class="hljs-title function_">usePhoneNumber</span>(<span class="hljs-params"></span>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">useDispatchable</span>(<span class="hljs-string">'phoneNumber'</span>); }
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useResultCode</span>(<span class="hljs-params"></span>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">useDispatchable</span>(<span class="hljs-string">'resultCode'</span>); }
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useMobileInfo</span>(<span class="hljs-params"></span>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">useDispatchable</span>(<span class="hljs-string">'mobileInfo'</span>); }
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useConfigName</span>(<span class="hljs-params"></span>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">useDispatchable</span>(<span class="hljs-string">'configName'</span>); }
<span class="hljs-keyword">function</span> <span class="hljs-title function_">useAppConfig</span>(<span class="hljs-params"></span>) { <span class="hljs-keyword">return</span> <span class="hljs-title function_">useDispatchable</span>(<span class="hljs-string">'appConfig'</span>); }

<span class="hljs-keyword">export</span> {
  <span class="hljs-title class_">DispatchProvider</span>,
  useKeyCode,
  useTestCode,
  useTestMode,
  usePhoneNumber,
  useResultCode,
  useMobileInfo,
  useConfigName,
  useAppConfig,
}
</code></pre>
<p>With a usage similar to this:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { useHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-router-dom"</span>;

<span class="hljs-comment">// https://react-bootstrap.github.io/components/alerts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Container</span>, <span class="hljs-title class_">Row</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-bootstrap'</span>;

<span class="hljs-keyword">import</span> { useAppConfig, useKeyCode, usePhoneNumber } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../ApplicationDispatchProvider'</span>;

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ControlSet</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../components/control-set'</span>;
<span class="hljs-keyword">import</span> { keypadClass } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../utils/style-utils'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MaskedEntry</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../components/masked-entry'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Messaging</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../components/messaging'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SimpleKeypad</span>, <span class="hljs-title class_">HandleKeyPress</span>, <span class="hljs-variable constant_">ALT_ID</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../components/simple-keypad'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">AltIdPage</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> history = <span class="hljs-title function_">useHistory</span>();
  <span class="hljs-keyword">const</span> [keyCode, setKeyCode] = <span class="hljs-title function_">useKeyCode</span>();
  <span class="hljs-keyword">const</span> [phoneNumber, setPhoneNumber] = <span class="hljs-title function_">usePhoneNumber</span>();
  <span class="hljs-keyword">const</span> [appConfig, setAppConfig] = <span class="hljs-title function_">useAppConfig</span>();

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">keyPressed</span> = btn =&gt; {
    <span class="hljs-keyword">const</span> maxLen = appConfig.<span class="hljs-property">phoneNumberEntry</span>.<span class="hljs-property">entryLen</span>;
    <span class="hljs-keyword">const</span> newValue = <span class="hljs-title class_">HandleKeyPress</span>(btn, phoneNumber).<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, maxLen);
    <span class="hljs-title function_">setPhoneNumber</span>(newValue);
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">doSubmit</span> = (<span class="hljs-params"></span>) =&gt; {
    history.<span class="hljs-title function_">push</span>(<span class="hljs-string">'s'</span>);
  }

  <span class="hljs-keyword">const</span> disableBtns = phoneNumber.<span class="hljs-property">length</span> &lt; appConfig.<span class="hljs-property">phoneNumberEntry</span>.<span class="hljs-property">entryLen</span>;

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Container</span> <span class="hljs-attr">fluid</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-center"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Row</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Messaging</span> {<span class="hljs-attr">...</span>{ <span class="hljs-attr">msgColors:</span> <span class="hljs-attr">appConfig.pageColors</span>, <span class="hljs-attr">msgLines:</span> <span class="hljs-attr">appConfig.entryMsgs.altIdMsgs</span> }} /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Row</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">MaskedEntry</span> {<span class="hljs-attr">...</span>{ <span class="hljs-attr">...appConfig.phoneNumberEntry</span>, <span class="hljs-attr">entryColors:</span> <span class="hljs-attr">appConfig.pageColors</span>, <span class="hljs-attr">entryLine:</span> <span class="hljs-attr">phoneNumber</span> }} /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Row</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">SimpleKeypad</span> {<span class="hljs-attr">...</span>{ <span class="hljs-attr">keyboardName:</span> <span class="hljs-attr">ALT_ID</span>, <span class="hljs-attr">themeName:</span> <span class="hljs-attr">appConfig.keyTheme</span>, <span class="hljs-attr">keyPressed</span>, <span class="hljs-attr">styleClass:</span> <span class="hljs-attr">keypadClass</span> }} /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Row</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ControlSet</span> {<span class="hljs-attr">...</span>{ <span class="hljs-attr">btnColors:</span> <span class="hljs-attr">appConfig.buttonColors</span>, <span class="hljs-attr">disabled:</span> <span class="hljs-attr">disableBtns</span>, <span class="hljs-attr">btns:</span> [{ <span class="hljs-attr">text:</span> '<span class="hljs-attr">Submit</span>', <span class="hljs-attr">click:</span> <span class="hljs-attr">doSubmit</span> }] }} /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Container</span>&gt;</span></span>
  );
};

<span class="hljs-title class_">AltIdPage</span>.<span class="hljs-property">propTypes</span> = {};
</code></pre>
<p>Now everything persists smoothly everywhere across all my pages</p>
    </div></div></div></div><div id="solution5" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>React's useEffect has its own state/lifecycle. It's related to mutation of state, and it will not update the state until the effect is destroyed.</p>
<p>Just pass a single argument in parameters state or leave it a black array and it will work perfectly.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title class_">React</span>.<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"effect"</span>);
    (<span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"/query/countries"</span>);
            <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> result.<span class="hljs-title function_">json</span>();
            <span class="hljs-keyword">let</span> result1 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"/query/projects"</span>);
            <span class="hljs-keyword">const</span> res1 = <span class="hljs-keyword">await</span> result1.<span class="hljs-title function_">json</span>();
            <span class="hljs-keyword">let</span> result11 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"/query/regions"</span>);
            <span class="hljs-keyword">const</span> res11 = <span class="hljs-keyword">await</span> result11.<span class="hljs-title function_">json</span>();
            <span class="hljs-title function_">setData</span>({
                <span class="hljs-attr">countries</span>: res,
                <span class="hljs-attr">projects</span>: res1,
                <span class="hljs-attr">regions</span>: res11
            });
        } <span class="hljs-keyword">catch</span> {}
    })(data)
}, [setData])
# or use <span class="hljs-variable language_">this</span>
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    (<span class="hljs-keyword">async</span> () =&gt; {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
                <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"/query/countries"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>()),
                <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"/query/projects"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>()),
                <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"/query/regions"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-title function_">json</span>())
            ]).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">[country, project, region]</span>) =&gt;</span> {
                <span class="hljs-comment">// console.log(country, project, region);</span>
                <span class="hljs-title function_">setData</span>({
                    <span class="hljs-attr">countries</span>: country,
                    <span class="hljs-attr">projects</span>: project,
                    <span class="hljs-attr">regions</span>: region
                });
            })
        } <span class="hljs-keyword">catch</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"data fetch error"</span>)
        }
    })()
}, [setData]);
</code></pre>
<p>Alternatively, you can try React.useRef() for instant change in the React hook.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> movies = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
movies.<span class="hljs-property">current</span>=<span class="hljs-string">'values'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(movies.<span class="hljs-property">current</span>)
}, [])
</code></pre>
    </div></div></div></div><div id="solution6" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The closure is not the only reason.</p>
<p>Based on the source code of <code>useState</code> (simplified below). Seems to me the value is never assigned right away.</p>
<p>What happens is that an update action is queued when you invoke <code>setValue</code>. And after the schedule kicks in and only when you get to the next render, these update action then is applied to that state.</p>
<p>Which means even we don't have closure issue, react version of <code>useState</code> is not going to give you the new value right away. The new value doesn't even exist until next render.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">  <span class="hljs-keyword">function</span> <span class="hljs-title function_">useState</span>(<span class="hljs-params">initialState</span>) {
    <span class="hljs-keyword">let</span> hook;
    ...

    <span class="hljs-keyword">let</span> baseState = hook.<span class="hljs-property">memoizedState</span>;
    <span class="hljs-keyword">if</span> (hook.<span class="hljs-property">queue</span>.<span class="hljs-property">pending</span>) {
      <span class="hljs-keyword">let</span> firstUpdate = hook.<span class="hljs-property">queue</span>.<span class="hljs-property">pending</span>.<span class="hljs-property">next</span>;

      <span class="hljs-keyword">do</span> {
        <span class="hljs-keyword">const</span> action = firstUpdate.<span class="hljs-property">action</span>;
        baseState = <span class="hljs-title function_">action</span>(baseState);            <span class="hljs-comment">// setValue HERE</span>
        firstUpdate = firstUpdate.<span class="hljs-property">next</span>;
      } <span class="hljs-keyword">while</span> (firstUpdate !== hook.<span class="hljs-property">queue</span>.<span class="hljs-property">pending</span>);

      hook.<span class="hljs-property">queue</span>.<span class="hljs-property">pending</span> = <span class="hljs-literal">null</span>;
    }
    hook.<span class="hljs-property">memoizedState</span> = baseState;

    <span class="hljs-keyword">return</span> [baseState, dispatchAction.<span class="hljs-title function_">bind</span>(<span class="hljs-literal">null</span>, hook.<span class="hljs-property">queue</span>)];
  }

<span class="hljs-keyword">function</span> <span class="hljs-title function_">dispatchAction</span>(<span class="hljs-params">queue, action</span>) {
  <span class="hljs-keyword">const</span> update = {
    action,
    <span class="hljs-attr">next</span>: <span class="hljs-literal">null</span>
  };
  <span class="hljs-keyword">if</span> (queue.<span class="hljs-property">pending</span> === <span class="hljs-literal">null</span>) {
    update.<span class="hljs-property">next</span> = update;
  } <span class="hljs-keyword">else</span> {
    update.<span class="hljs-property">next</span> = queue.<span class="hljs-property">pending</span>.<span class="hljs-property">next</span>;
    queue.<span class="hljs-property">pending</span>.<span class="hljs-property">next</span> = update;
  }
  queue.<span class="hljs-property">pending</span> = update;

  isMount = <span class="hljs-literal">false</span>;
  workInProgressHook = fiber.<span class="hljs-property">memoizedState</span>;
  <span class="hljs-title function_">schedule</span>();
}

</code></pre>
<p>There's also an article explaining the above in the similar way, <a href="https://dev.to/adamklein/we-don-t-know-how-react-state-hook-works-1lp8" rel="noreferrer">https://dev.to/adamklein/we-don-t-know-how-react-state-hook-works-1lp8</a></p>
    </div></div></div></div><div id="solution7" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 7</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I found this to be good. Instead of defining state (approach 1) as, example,</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> initialValue = <span class="hljs-number">1</span>;
</code></pre>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> [state,setState] = <span class="hljs-title function_">useState</span>(initialValue)

</code></pre>
<p>Try this approach (approach 2),</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> [state = initialValue,setState] = <span class="hljs-title function_">useState</span>()

</code></pre>
<p>This resolved the rerender issue without using useEffect since we are not concerned with its internal closure approach with this case.</p>
<p>P.S.: If you are concerned with using old state for any use case then useState with useEffect needs to be used since it will need to have that state, so approach 1 shall be used in this situation.</p>
    </div></div></div></div><div id="solution8" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 8</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I too was stuck with the same problem. As other answers above have clarified the error here, which is that useState is asynchronous and you are trying to use the value just after setState. It is not updating on the console.log() part because of the asynchronous nature of setState, it lets your further code to execute, while the value updating happens on the background. Thus you are getting the previous value. When the setState is completed on the background it will update the value and you will have access to that value on the next render.</p>
<p>If anyone is interested to understand this in detail. Here is a really good Conference talk on the topic.</p>
<p><a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ" rel="nofollow noreferrer">https://www.youtube.com/watch?v=8aGhZQkoFbQ</a></p>
    </div></div></div></div><div id="solution9" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 9</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If we have to update state only, then a better way can be if we use the push method to do so.</p>
<p>Here is my code. I want to store URLs from <a href="https://en.wikipedia.org/wiki/Firebase" rel="nofollow noreferrer">Firebase</a> in state.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> [imageUrl, setImageUrl] = <span class="hljs-title function_">useState</span>([]);
<span class="hljs-keyword">const</span> [reload, setReload] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (reload === <span class="hljs-number">4</span>) {
        <span class="hljs-title function_">downloadUrl1</span>();
    }
}, [reload]);


<span class="hljs-keyword">const</span> <span class="hljs-title function_">downloadUrl</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-title function_">setImages</span>([]);
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; images.<span class="hljs-property">length</span>; i++) {
            <span class="hljs-keyword">let</span> url = <span class="hljs-keyword">await</span> <span class="hljs-title function_">storage</span>().<span class="hljs-title function_">ref</span>(urls[i].<span class="hljs-property">path</span>).<span class="hljs-title function_">getDownloadURL</span>();
            imageUrl.<span class="hljs-title function_">push</span>(url);
            <span class="hljs-title function_">setImageUrl</span>([...imageUrl]);

            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(url, <span class="hljs-string">'check'</span>, urls.<span class="hljs-property">length</span>, <span class="hljs-string">'length'</span>, imageUrl.<span class="hljs-property">length</span>);
        }
    }
    <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e);
    }
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-title function_">setReload</span>(<span class="hljs-number">4</span>);
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">downloadUrl</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(imageUrl);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'post submitted'</span>);
};
</code></pre>
<p>This code works to put URLs in state as an array. This might also work for you.</p>
    </div></div></div></div><div id="solution10" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 10</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>With custom hooks from my library, you can wait for the state values to update:</p>
<ol>
<li><code>useAsyncWatcher(...values):watcherFn(peekPrevValue: boolean)=&gt;Promise</code> - is a promise wrapper around useEffect that can wait for updates and return a new value and possibly a previous one if the optional <code>peekPrevValue</code> argument is set to true.</li>
</ol>
<p>(<a href="https://codesandbox.io/s/use-async-watcher-njuoc?file=/src/TestComponent.js" rel="nofollow noreferrer">Live Demo</a>)</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">    <span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useEffect, useCallback } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
    <span class="hljs-keyword">import</span> { useAsyncWatcher } <span class="hljs-keyword">from</span> <span class="hljs-string">"use-async-effect2"</span>;
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">TestComponent</span>(<span class="hljs-params">props</span>) {
      <span class="hljs-keyword">const</span> [counter, setCounter] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
      <span class="hljs-keyword">const</span> [text, setText] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">""</span>);
    
      <span class="hljs-keyword">const</span> textWatcher = <span class="hljs-title function_">useAsyncWatcher</span>(text);
    
      <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">setText</span>(<span class="hljs-string">`Counter: <span class="hljs-subst">${counter}</span>`</span>);
      }, [counter]);
    
      <span class="hljs-keyword">const</span> inc = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
        (<span class="hljs-keyword">async</span> () =&gt; {
          <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>));
          <span class="hljs-title function_">setCounter</span>(<span class="hljs-function">(<span class="hljs-params">counter</span>) =&gt;</span> counter + <span class="hljs-number">1</span>);
          <span class="hljs-keyword">const</span> updatedText = <span class="hljs-keyword">await</span> <span class="hljs-title function_">textWatcher</span>();
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(updatedText);
        })();
      }, []);
    
      <span class="hljs-keyword">return</span> (
        <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"component"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"caption"</span>&gt;</span>useAsyncEffect demo<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{counter}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{inc}</span>&gt;</span>Inc counter<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
      );
    }
    
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">TestComponent</span>;
</code></pre>
<ol start="2">
<li><code>useAsyncDeepState</code> is a deep state implementation (similar to this.setState (patchObject)) whose setter can return a promise synchronized with the internal effect. If the setter is called with no arguments, it does not change the state values, but simply subscribes to state updates. In this case, you can get the state value from anywhere inside your component, since function closures are no longer a hindrance.</li>
</ol>
<p>(<a href="https://codesandbox.io/s/use-async-deep-state-5c9d0?file=/src/TestComponent.js" rel="nofollow noreferrer">Live Demo</a>)</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useCallback, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> { useAsyncDeepState } <span class="hljs-keyword">from</span> <span class="hljs-string">"use-async-effect2"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">TestComponent</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useAsyncDeepState</span>({
    <span class="hljs-attr">counter</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">computedCounter</span>: <span class="hljs-number">0</span>
  });

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setState</span>(<span class="hljs-function">(<span class="hljs-params">{ counter }</span>) =&gt;</span> ({
      <span class="hljs-attr">computedCounter</span>: counter * <span class="hljs-number">2</span>
    }));
  }, [state.<span class="hljs-property">counter</span>]);

  <span class="hljs-keyword">const</span> inc = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    (<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>));
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">setState</span>(<span class="hljs-function">(<span class="hljs-params">{ counter }</span>) =&gt;</span> ({ <span class="hljs-attr">counter</span>: counter + <span class="hljs-number">1</span> }));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"computedCounter="</span>, state.<span class="hljs-property">computedCounter</span>);
    })();
  });

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"component"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"caption"</span>&gt;</span>useAsyncDeepState demo<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>state.counter : {state.counter}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>state.computedCounter : {state.computedCounter}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> inc()}&gt;Inc counter<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
    </div></div></div></div><div id="solution11" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 11</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> [state,setState]=<span class="hljs-title function_">useState</span>(defaultValue)

<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">()=&gt;</span>{
   <span class="hljs-keyword">var</span> updatedState
   <span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">currentState</span>=&gt;</span>{    <span class="hljs-comment">// Do not change the state by get the updated state</span>
      updateState=currentState
      <span class="hljs-keyword">return</span> currentState
   })
   <span class="hljs-title function_">alert</span>(updateState) <span class="hljs-comment">// the current state.</span>
})
</code></pre>
    </div></div></div></div><div id="solution12" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 12</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><strong>Without any addtional NPM package</strong></p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">//...</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">BackendPageListing</span> = (<span class="hljs-params"></span>) =&gt; {
    
    <span class="hljs-keyword">const</span> [ myData, setMyData] = <span class="hljs-title function_">useState</span>( {
        <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">content</span>: <span class="hljs-string">"abc"</span>
    })

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">myFunction</span> = (<span class="hljs-params"> x </span>) =&gt; {
        
        <span class="hljs-title function_">setPagenateInfo</span>({
        ...myData,
        <span class="hljs-attr">content</span>: x
        })

        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myData) <span class="hljs-comment">// not reflecting change immediately</span>

        <span class="hljs-keyword">let</span> myDataNew = {...myData, <span class="hljs-attr">content</span>: x };
        
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myDataNew) <span class="hljs-comment">// Reflecting change immediately</span>

    }

    <span class="hljs-keyword">return</span> (
        <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span>=&gt;</span>{ myFunction("New Content")} }&gt;Update MyData<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
    )
</code></pre>
    </div></div></div></div><div id="solution13" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 13</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Not saying to do this, but it isn't hard to do what the OP asked without useEffect.</p>
<p>Use a promise to resolve the new state in the body of the setter function:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> getState = &lt;T&gt;(
  <span class="hljs-attr">setState</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">Dispatch</span>&lt;<span class="hljs-title class_">React</span>.<span class="hljs-property">SetStateAction</span>&lt;T&gt;&gt;
): <span class="hljs-title class_">Promise</span>&lt;T&gt; =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-title function_">setState</span>(<span class="hljs-function">(<span class="hljs-params">currentState: T</span>) =&gt;</span> {
      <span class="hljs-title function_">resolve</span>(currentState);
      <span class="hljs-keyword">return</span> currentState;
    });
  });
};
</code></pre>
<p>And this is how you use it (example shows the comparison between <code>count</code> and <code>outOfSyncCount</code>/<code>syncCount</code> in the UI rendering):</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> [outOfSyncCount, setOutOfSyncCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> [syncCount, setSyncCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleOnClick</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>);

    <span class="hljs-comment">// Doesn't work</span>
    <span class="hljs-title function_">setOutOfSyncCount</span>(count);

    <span class="hljs-comment">// Works</span>
    <span class="hljs-keyword">const</span> newCount = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getState</span>(setCount);
    <span class="hljs-title function_">setSyncCount</span>(newCount);
  };

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Count = {count}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Synced count = {syncCount}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Out of sync count = {outOfSyncCount}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleOnClick}</span>&gt;</span>Increment<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
};
</code></pre>
    </div></div></div></div><div id="solution14" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 14</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Use the <a href="https://github.com/ocetnik/react-native-background-timer" rel="nofollow noreferrer">Background Timer</a> library. It solved my problem.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> timeoutId = <span class="hljs-title class_">BackgroundTimer</span>.<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// This will be executed once after 1 seconds</span>
    <span class="hljs-comment">// even when the application is the background</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'tac'</span>);
}, <span class="hljs-number">1000</span>);
</code></pre>
    </div></div></div></div><div id="solution15" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 15</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// replace</span>
<span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>hello<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
<span class="hljs-comment">// with</span>
<span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{JSON.stringify(movies)}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>;
</code></pre>

<p>Now you should see, that your code actually <strong>does</strong> work. What does not work is the <code>console.log(movies)</code>. This is because <code>movies</code> points to the <em>old state</em>. If you move your <code>console.log(movies)</code> outside of <code>useEffect</code>, right above the return, you will see the updated movies object.</p>
    </div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;Much \u0026lt;a href=\u0026quot;https://stackoverflow.com/q/30782948/1048572\u0026quot;\u0026gt;like \u0026lt;code\u0026gt;.setState()\u0026lt;/code\u0026gt; in class components\u0026lt;/a\u0026gt; created by extending \u0026lt;code\u0026gt;React.Component\u0026lt;/code\u0026gt; or \u0026lt;code\u0026gt;React.PureComponent\u0026lt;/code\u0026gt;, the state update using the updater provided by \u0026lt;code\u0026gt;useState\u0026lt;/code\u0026gt; hook is also asynchronous, and will not be reflected immediately.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Also, the main issue here is not just the asynchronous nature but the fact that state values are used by functions based on their current closures, and state updates will reflect in the next re-render by which the existing closures are not affected, but new ones are created\u0026lt;/strong\u0026gt;. Now in the current state, the values within hooks are obtained by existing closures, and when a re-render happens, the closures are updated based on whether the function is recreated again or not.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Even if you add a \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt; the function, though the timeout will run after some time by which the re-render would have happened, the \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt; will still use the value from its previous closure and not the updated one.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setMovies\u0026lt;/span\u0026gt;(result);\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(movies) \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// movies here will not be updated\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;If you want to perform an action on state update, you need to use the \u0026lt;code\u0026gt;useEffect\u0026lt;/code\u0026gt; hook, much like using \u0026lt;code\u0026gt;componentDidUpdate\u0026lt;/code\u0026gt; in class components since the setter returned by \u0026lt;code\u0026gt;useState\u0026lt;/code\u0026gt; doesn\u0026apos;t have a callback pattern\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// action on update of movies\u0026lt;/span\u0026gt;\n}, [movies]);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;As far as the syntax to update state is concerned, \u0026lt;code\u0026gt;setMovies(result)\u0026lt;/code\u0026gt; will replace the previous \u0026lt;code\u0026gt;movies\u0026lt;/code\u0026gt; value in the state with those available from the async request.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;However, if you want to merge the response with the previously existing values, you must use the callback syntax of state updation along with the correct use of spread syntax like\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setMovies\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;prevMovies\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; ([...prevMovies, ...result]));\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;sub\u0026gt;\u0026lt;em\u0026gt;Additional details to the \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/54069332/1176601\u0026quot;\u0026gt;previous answer\u0026lt;/a\u0026gt;:\u0026lt;/em\u0026gt;\u0026lt;/sub\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;While React\u0026apos;s \u0026lt;code\u0026gt;setState\u0026lt;/code\u0026gt; \u0026lt;em\u0026gt;is\u0026lt;/em\u0026gt; asynchronous (both classes and hooks), and it\u0026apos;s tempting to use that fact to explain the observed behavior, it is not the \u0026lt;em\u0026gt;\u0026lt;strong\u0026gt;reason why\u0026lt;/strong\u0026gt;\u0026lt;/em\u0026gt; it happens.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;TLDR: The reason is a \u0026lt;a href=\u0026quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;closure\u0026lt;/a\u0026gt; scope around an immutable \u0026lt;code\u0026gt;const\u0026lt;/code\u0026gt; value.\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;h3\u0026gt;\u0026lt;em\u0026gt;Solutions:\u0026lt;/em\u0026gt;\u0026lt;/h3\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;read the value in render function (not inside nested functions):\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setMovies\u0026lt;/span\u0026gt;(result) }, [])\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(movies)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;add the variable into dependencies (and use the \u0026lt;a href=\u0026quot;https://reactjs.org/docs/hooks-rules.html#eslint-plugin\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;react-hooks/exhaustive-deps\u0026lt;/a\u0026gt; eslint rule):\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setMovies\u0026lt;/span\u0026gt;(result) }, [])\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(movies) }, [movies])\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;use a temporary variable:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; newMovies = result\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(newMovies)\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setMovies\u0026lt;/span\u0026gt;(newMovies)\n  }, [])\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;use a mutable reference (if we don\u0026apos;t need a state and only want to remember the value - updating a ref doesn\u0026apos;t trigger re-render):\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; moviesRef = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useRef\u0026lt;/span\u0026gt;(initialValue)\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    moviesRef.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;current\u0026lt;/span\u0026gt; = result\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(moviesRef.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;current\u0026lt;/span\u0026gt;)\n  }, [])\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;h3\u0026gt;\u0026lt;em\u0026gt;Explanation why it happens:\u0026lt;/em\u0026gt;\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;If async was the only reason, it would be possible to \u0026lt;code\u0026gt;await setState()\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;However, both \u0026lt;code\u0026gt;props\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;state\u0026lt;/code\u0026gt; are \u0026lt;a href=\u0026quot;https://reactjs.org/docs/react-component.html#state\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;assumed to be unchanging during 1 render\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;Treat \u0026lt;code\u0026gt;this.state\u0026lt;/code\u0026gt; as if it were immutable.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;With hooks, this assumption is enhanced by using \u0026lt;strong\u0026gt;constant values\u0026lt;/strong\u0026gt; with the \u0026lt;code\u0026gt;const\u0026lt;/code\u0026gt; keyword:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [state, setState] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;initial\u0026apos;\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;The value might be different between 2 renders, but remains a constant inside the render itself and inside any \u0026lt;a href=\u0026quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;closures\u0026lt;/a\u0026gt; (functions that live longer even after render is finished, e.g. \u0026lt;code\u0026gt;useEffect\u0026lt;/code\u0026gt;, event handlers, inside any Promise or  setTimeout).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Consider following fake, but \u0026lt;strong\u0026gt;synchronous\u0026lt;/strong\u0026gt;, React-like implementation:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\u0026lt;div class=\u0026quot;snippet\u0026quot; data-lang=\u0026quot;js\u0026quot; data-hide=\u0026quot;false\u0026quot; data-console=\u0026quot;true\u0026quot; data-babel=\u0026quot;false\u0026quot;\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-code\u0026quot;\u0026gt;\n\u0026lt;pre class=\u0026quot;snippet-code-js lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// sync implementation:\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; internalState\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; renderAgain\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setState\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;updateFn\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  internalState = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;updateFn\u0026lt;/span\u0026gt;(internalState)\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;renderAgain\u0026lt;/span\u0026gt;()\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;defaultState\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!internalState) {\n    internalState = defaultState\n  }\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; [internalState, setState]\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;render\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;component, node\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; {html, handleClick} = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;component\u0026lt;/span\u0026gt;()\n  node.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;innerHTML\u0026lt;/span\u0026gt; = html\n  renderAgain = \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;render\u0026lt;/span\u0026gt;(component, node)\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; handleClick\n}\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// test:\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;MyComponent\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [x, setX] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;in render:\u0026apos;\u0026lt;/span\u0026gt;, x) \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// \u0026lt;/span\u0026gt;\n  \n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;handleClick\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setX\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;current\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; current + \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;in handler/effect/Promise/setTimeout:\u0026apos;\u0026lt;/span\u0026gt;, x) \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//  NOT updated\u0026lt;/span\u0026gt;\n  }\n  \n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;html\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`\u0026amp;lt;button\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${x}\u0026lt;/span\u0026gt;\u0026amp;lt;/button\u0026amp;gt;`\u0026lt;/span\u0026gt;,\n    handleClick\n  }\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; triggerClick = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;render\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;MyComponent\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getElementById\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;root\u0026apos;\u0026lt;/span\u0026gt;))\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;triggerClick\u0026lt;/span\u0026gt;()\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;triggerClick\u0026lt;/span\u0026gt;()\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;triggerClick\u0026lt;/span\u0026gt;()\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;pre class=\u0026quot;snippet-code-html lang-html s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;root\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-result\u0026quot;\u0026gt;\u0026lt;div class=\u0026quot;snippet-ctas\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn s-btn__primary\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;icon-play-white _hover\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;span\u0026gt; Run code snippet\u0026lt;/span\u0026gt;\u0026lt;/button\u0026gt;\u0026lt;input class=\u0026quot;copySnippet s-btn s-btn__filled\u0026quot; type=\u0026quot;button\u0026quot; value=\u0026quot;Copy snippet to answer\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn hideResults\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;Hide results\u0026lt;/button\u0026gt;\u0026lt;div class=\u0026quot;popout-code\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;snippet-expand-link\u0026quot;\u0026gt;Expand snippet\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;div class=\u0026quot;snippet-result-code\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;iframe name=\u0026quot;sif2\u0026quot; sandbox=\u0026quot;allow-forms allow-modals allow-scripts\u0026quot; class=\u0026quot;snippet-box-edit snippet-box-result\u0026quot; frameborder=\u0026quot;0\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I know that there are already very good answers. But I want to give another idea how to solve the same issue, and access the latest \u0026apos;movie\u0026apos; state, using my module \u0026lt;a href=\u0026quot;https://www.npmjs.com/package/react-usestateref\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;react-useStateRef\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;As you understand by using React state you can render the page every time the state change. But by using React ref, you can always get the latest values.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;So the module \u0026lt;code\u0026gt;react-useStateRef\u0026lt;/code\u0026gt; let you use state\u0026apos;s and ref\u0026apos;s together. It\u0026apos;s backward compatible with \u0026lt;code\u0026gt;React.useState\u0026lt;/code\u0026gt;, so you can just replace the \u0026lt;code\u0026gt;import\u0026lt;/code\u0026gt; statement\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; { useEffect } = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { useState } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;react-usestateref\u0026apos;\u0026lt;/span\u0026gt;\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [movies, setMovies] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;(initialValue);\n\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;try\u0026lt;/span\u0026gt; {\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; result = [\n          {\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;1546514491119\u0026quot;\u0026lt;/span\u0026gt;,\n          },\n        ];\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;result =\u0026quot;\u0026lt;/span\u0026gt;, result);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setMovies\u0026lt;/span\u0026gt;(result);\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;movies =\u0026quot;\u0026lt;/span\u0026gt;, movies.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;current\u0026lt;/span\u0026gt;); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// will give you the latest results\u0026lt;/span\u0026gt;\n      } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt; (e) {\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;(e);\n      }\n    })();\n  }, []);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;h2\u0026gt;More information:\u0026lt;/h2\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;https://www.npmjs.com/package/react-usestateref\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;react-usestsateref\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I just finished a rewrite with useReducer, following @kentcdobs article (ref below) which really gave me a solid result that suffers not one bit from these closure problems.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;See: \u0026lt;a href=\u0026quot;https://kentcdodds.com/blog/how-to-use-react-context-effectively\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;https://kentcdodds.com/blog/how-to-use-react-context-effectively\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I condensed his readable boilerplate to my preferred level of DRYness -- reading his sandbox implementation will show you how it actually works.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;react\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// ref: https://kentcdodds.com/blog/how-to-use-react-context-effectively\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ApplicationDispatch\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;createContext\u0026lt;/span\u0026gt;()\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ApplicationContext\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;createContext\u0026lt;/span\u0026gt;()\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;stateReducer\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;state, action\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (state.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;hasOwnProperty\u0026lt;/span\u0026gt;(action.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;type\u0026lt;/span\u0026gt;)) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; { ...state, [action.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;type\u0026lt;/span\u0026gt;]: state[action.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;type\u0026lt;/span\u0026gt;] = action.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;newValue\u0026lt;/span\u0026gt; };\n  }\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;throw\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`Unhandled action type: \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${action.type}\u0026lt;/span\u0026gt;`\u0026lt;/span\u0026gt;);\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; initialState = {\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;keyCode\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;testCode\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;testMode\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;phoneNumber\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;resultCode\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;mobileInfo\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;configName\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;appConfig\u0026lt;/span\u0026gt;: {},\n};\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;DispatchProvider\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;{ children }\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [state, dispatch] = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useReducer\u0026lt;/span\u0026gt;(stateReducer, initialState);\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; (\n    \u0026lt;span class=\u0026quot;language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;ApplicationDispatch.Provider\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;{dispatch}\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;ApplicationContext.Provider\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;{state}\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n        {children}\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;ApplicationContext.Provider\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;ApplicationDispatch.Provider\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;\n  )\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useDispatchable\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;stateName\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; context = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useContext\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ApplicationContext\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; dispatch = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useContext\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ApplicationDispatch\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; [context[stateName], \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;newValue\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;dispatch\u0026lt;/span\u0026gt;({ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;type\u0026lt;/span\u0026gt;: stateName, newValue })];\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useKeyCode\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useDispatchable\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;keyCode\u0026apos;\u0026lt;/span\u0026gt;); }\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useTestCode\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useDispatchable\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;testCode\u0026apos;\u0026lt;/span\u0026gt;); }\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useTestMode\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useDispatchable\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;testMode\u0026apos;\u0026lt;/span\u0026gt;); }\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;usePhoneNumber\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useDispatchable\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;phoneNumber\u0026apos;\u0026lt;/span\u0026gt;); }\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useResultCode\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useDispatchable\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;resultCode\u0026apos;\u0026lt;/span\u0026gt;); }\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useMobileInfo\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useDispatchable\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;mobileInfo\u0026apos;\u0026lt;/span\u0026gt;); }\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useConfigName\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useDispatchable\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;configName\u0026apos;\u0026lt;/span\u0026gt;); }\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useAppConfig\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useDispatchable\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;appConfig\u0026apos;\u0026lt;/span\u0026gt;); }\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;export\u0026lt;/span\u0026gt; {\n  \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;DispatchProvider\u0026lt;/span\u0026gt;,\n  useKeyCode,\n  useTestCode,\n  useTestMode,\n  usePhoneNumber,\n  useResultCode,\n  useMobileInfo,\n  useConfigName,\n  useAppConfig,\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;With a usage similar to this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { useHistory } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;react-router-dom\u0026quot;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// https://react-bootstrap.github.io/components/alerts\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Container\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Row\u0026lt;/span\u0026gt; } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;react-bootstrap\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { useAppConfig, useKeyCode, usePhoneNumber } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;../../ApplicationDispatchProvider\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ControlSet\u0026lt;/span\u0026gt; } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;../../components/control-set\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { keypadClass } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;../../utils/style-utils\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;MaskedEntry\u0026lt;/span\u0026gt; } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;../../components/masked-entry\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Messaging\u0026lt;/span\u0026gt; } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;../../components/messaging\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;SimpleKeypad\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;HandleKeyPress\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;ALT_ID\u0026lt;/span\u0026gt; } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;../../components/simple-keypad\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;export\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;AltIdPage\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; history = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useHistory\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [keyCode, setKeyCode] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useKeyCode\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [phoneNumber, setPhoneNumber] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;usePhoneNumber\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [appConfig, setAppConfig] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useAppConfig\u0026lt;/span\u0026gt;();\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;keyPressed\u0026lt;/span\u0026gt; = btn =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; maxLen = appConfig.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;phoneNumberEntry\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;entryLen\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; newValue = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;HandleKeyPress\u0026lt;/span\u0026gt;(btn, phoneNumber).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;slice\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, maxLen);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setPhoneNumber\u0026lt;/span\u0026gt;(newValue);\n  }\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;doSubmit\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n    history.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;s\u0026apos;\u0026lt;/span\u0026gt;);\n  }\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; disableBtns = phoneNumber.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt; \u0026amp;lt; appConfig.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;phoneNumberEntry\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;entryLen\u0026lt;/span\u0026gt;;\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; (\n    \u0026lt;span class=\u0026quot;language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;Container\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;fluid\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;className\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;text-center\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;Row\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;Messaging\u0026lt;/span\u0026gt; {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;...\u0026lt;/span\u0026gt;{ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;msgColors:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;appConfig.pageColors\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;msgLines:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;appConfig.entryMsgs.altIdMsgs\u0026lt;/span\u0026gt; }} /\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;Row\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;Row\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;MaskedEntry\u0026lt;/span\u0026gt; {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;...\u0026lt;/span\u0026gt;{ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;...appConfig.phoneNumberEntry\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;entryColors:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;appConfig.pageColors\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;entryLine:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;phoneNumber\u0026lt;/span\u0026gt; }} /\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;Row\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;Row\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;SimpleKeypad\u0026lt;/span\u0026gt; {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;...\u0026lt;/span\u0026gt;{ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;keyboardName:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;ALT_ID\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;themeName:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;appConfig.keyTheme\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;keyPressed\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;styleClass:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;keypadClass\u0026lt;/span\u0026gt; }} /\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;Row\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;Row\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;ControlSet\u0026lt;/span\u0026gt; {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;...\u0026lt;/span\u0026gt;{ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;btnColors:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;appConfig.buttonColors\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;disabled:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;disableBtns\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;btns:\u0026lt;/span\u0026gt; [{ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;text:\u0026lt;/span\u0026gt; \u0026apos;\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;Submit\u0026lt;/span\u0026gt;\u0026apos;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;click:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;doSubmit\u0026lt;/span\u0026gt; }] }} /\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;Row\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;Container\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;\n  );\n};\n\n\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;AltIdPage\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;propTypes\u0026lt;/span\u0026gt; = {};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Now everything persists smoothly everywhere across all my pages\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;React\u0026apos;s useEffect has its own state/lifecycle. It\u0026apos;s related to mutation of state, and it will not update the state until the effect is destroyed.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Just pass a single argument in parameters state or leave it a black array and it will work perfectly.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;effect\u0026quot;\u0026lt;/span\u0026gt;);\n    (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; () =\u0026amp;gt; {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;try\u0026lt;/span\u0026gt; {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; result = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fetch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;/query/countries\u0026quot;\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; res = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; result.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;json\u0026lt;/span\u0026gt;();\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; result1 = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fetch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;/query/projects\u0026quot;\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; res1 = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; result1.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;json\u0026lt;/span\u0026gt;();\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; result11 = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fetch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;/query/regions\u0026quot;\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; res11 = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; result11.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;json\u0026lt;/span\u0026gt;();\n            \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setData\u0026lt;/span\u0026gt;({\n                \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;countries\u0026lt;/span\u0026gt;: res,\n                \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;projects\u0026lt;/span\u0026gt;: res1,\n                \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;regions\u0026lt;/span\u0026gt;: res11\n            });\n        } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt; {}\n    })(data)\n}, [setData])\n# or use \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; () =\u0026amp;gt; {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;try\u0026lt;/span\u0026gt; {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;([\n                \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fetch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;/query/countries\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;response\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; response.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;json\u0026lt;/span\u0026gt;()),\n                \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fetch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;/query/projects\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;response\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; response.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;json\u0026lt;/span\u0026gt;()),\n                \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fetch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;/query/regions\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;response\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; response.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;json\u0026lt;/span\u0026gt;())\n            ]).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;[country, project, region]\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n                \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// console.log(country, project, region);\u0026lt;/span\u0026gt;\n                \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setData\u0026lt;/span\u0026gt;({\n                    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;countries\u0026lt;/span\u0026gt;: country,\n                    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;projects\u0026lt;/span\u0026gt;: project,\n                    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;regions\u0026lt;/span\u0026gt;: region\n                });\n            })\n        } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt; {\n            \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;data fetch error\u0026quot;\u0026lt;/span\u0026gt;)\n        }\n    })()\n}, [setData]);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Alternatively, you can try React.useRef() for instant change in the React hook.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; movies = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useRef\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\nmovies.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;current\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;values\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(movies.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;current\u0026lt;/span\u0026gt;)\n}, [])\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The closure is not the only reason.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Based on the source code of \u0026lt;code\u0026gt;useState\u0026lt;/code\u0026gt; (simplified below). Seems to me the value is never assigned right away.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;What happens is that an update action is queued when you invoke \u0026lt;code\u0026gt;setValue\u0026lt;/code\u0026gt;. And after the schedule kicks in and only when you get to the next render, these update action then is applied to that state.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Which means even we don\u0026apos;t have closure issue, react version of \u0026lt;code\u0026gt;useState\u0026lt;/code\u0026gt; is not going to give you the new value right away. The new value doesn\u0026apos;t even exist until next render.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;initialState\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; hook;\n    ...\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; baseState = hook.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;memoizedState\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (hook.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;queue\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;pending\u0026lt;/span\u0026gt;) {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; firstUpdate = hook.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;queue\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;pending\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;next\u0026lt;/span\u0026gt;;\n\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;do\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; action = firstUpdate.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;action\u0026lt;/span\u0026gt;;\n        baseState = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;action\u0026lt;/span\u0026gt;(baseState);            \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// setValue HERE\u0026lt;/span\u0026gt;\n        firstUpdate = firstUpdate.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;next\u0026lt;/span\u0026gt;;\n      } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt; (firstUpdate !== hook.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;queue\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;pending\u0026lt;/span\u0026gt;);\n\n      hook.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;queue\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;pending\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;;\n    }\n    hook.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;memoizedState\u0026lt;/span\u0026gt; = baseState;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; [baseState, dispatchAction.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;bind\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;, hook.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;queue\u0026lt;/span\u0026gt;)];\n  }\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;dispatchAction\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;queue, action\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; update = {\n    action,\n    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;next\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;\n  };\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (queue.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;pending\u0026lt;/span\u0026gt; === \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;) {\n    update.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;next\u0026lt;/span\u0026gt; = update;\n  } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; {\n    update.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;next\u0026lt;/span\u0026gt; = queue.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;pending\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;next\u0026lt;/span\u0026gt;;\n    queue.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;pending\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;next\u0026lt;/span\u0026gt; = update;\n  }\n  queue.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;pending\u0026lt;/span\u0026gt; = update;\n\n  isMount = \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;;\n  workInProgressHook = fiber.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;memoizedState\u0026lt;/span\u0026gt;;\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;schedule\u0026lt;/span\u0026gt;();\n}\n\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;There\u0026apos;s also an article explaining the above in the similar way, \u0026lt;a href=\u0026quot;https://dev.to/adamklein/we-don-t-know-how-react-state-hook-works-1lp8\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;https://dev.to/adamklein/we-don-t-know-how-react-state-hook-works-1lp8\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I found this to be good. Instead of defining state (approach 1) as, example,\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; initialValue = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [state,setState] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;(initialValue)\n\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Try this approach (approach 2),\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [state = initialValue,setState] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;()\n\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;This resolved the rerender issue without using useEffect since we are not concerned with its internal closure approach with this case.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;P.S.: If you are concerned with using old state for any use case then useState with useEffect needs to be used since it will need to have that state, so approach 1 shall be used in this situation.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I too was stuck with the same problem. As other answers above have clarified the error here, which is that useState is asynchronous and you are trying to use the value just after setState. It is not updating on the console.log() part because of the asynchronous nature of setState, it lets your further code to execute, while the value updating happens on the background. Thus you are getting the previous value. When the setState is completed on the background it will update the value and you will have access to that value on the next render.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;If anyone is interested to understand this in detail. Here is a really good Conference talk on the topic.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://www.youtube.com/watch?v=8aGhZQkoFbQ\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;https://www.youtube.com/watch?v=8aGhZQkoFbQ\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;If we have to update state only, then a better way can be if we use the push method to do so.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Here is my code. I want to store URLs from \u0026lt;a href=\u0026quot;https://en.wikipedia.org/wiki/Firebase\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Firebase\u0026lt;/a\u0026gt; in state.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [imageUrl, setImageUrl] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;([]);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [reload, setReload] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (reload === \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;downloadUrl1\u0026lt;/span\u0026gt;();\n    }\n}, [reload]);\n\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;downloadUrl\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setImages\u0026lt;/span\u0026gt;([]);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;try\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; i = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; images.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;; i++) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; url = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;storage\u0026lt;/span\u0026gt;().\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;ref\u0026lt;/span\u0026gt;(urls[i].\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;path\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getDownloadURL\u0026lt;/span\u0026gt;();\n            imageUrl.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(url);\n            \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setImageUrl\u0026lt;/span\u0026gt;([...imageUrl]);\n\n            \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(url, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;check\u0026apos;\u0026lt;/span\u0026gt;, urls.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;length\u0026apos;\u0026lt;/span\u0026gt;, imageUrl.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;);\n        }\n    }\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt; (e) {\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(e);\n    }\n};\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;handleSubmit\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setReload\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;downloadUrl\u0026lt;/span\u0026gt;();\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(imageUrl);\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;post submitted\u0026apos;\u0026lt;/span\u0026gt;);\n};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;This code works to put URLs in state as an array. This might also work for you.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;With custom hooks from my library, you can wait for the state values to update:\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;useAsyncWatcher(...values):watcherFn(peekPrevValue: boolean)=\u0026amp;gt;Promise\u0026lt;/code\u0026gt; - is a promise wrapper around useEffect that can wait for updates and return a new value and possibly a previous one if the optional \u0026lt;code\u0026gt;peekPrevValue\u0026lt;/code\u0026gt; argument is set to true.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;(\u0026lt;a href=\u0026quot;https://codesandbox.io/s/use-async-watcher-njuoc?file=/src/TestComponent.js\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Live Demo\u0026lt;/a\u0026gt;)\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;, { useState, useEffect, useCallback } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;react\u0026quot;\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { useAsyncWatcher } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;use-async-effect2\u0026quot;\u0026lt;/span\u0026gt;;\n    \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;TestComponent\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;props\u0026lt;/span\u0026gt;) {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [counter, setCounter] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;);\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [text, setText] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026quot;\u0026lt;/span\u0026gt;);\n    \n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; textWatcher = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useAsyncWatcher\u0026lt;/span\u0026gt;(text);\n    \n      \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setText\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`Counter: \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${counter}\u0026lt;/span\u0026gt;`\u0026lt;/span\u0026gt;);\n      }, [counter]);\n    \n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; inc = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useCallback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n        (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; () =\u0026amp;gt; {\n          \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(resolve, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1000\u0026lt;/span\u0026gt;));\n          \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setCounter\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;counter\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; counter + \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;);\n          \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; updatedText = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;textWatcher\u0026lt;/span\u0026gt;();\n          \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(updatedText);\n        })();\n      }, []);\n    \n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; (\n        \u0026lt;span class=\u0026quot;language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;className\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;component\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n          \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;className\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;caption\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;useAsyncEffect demo\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n          \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;{counter}\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n          \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;button\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;onClick\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;{inc}\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;Inc counter\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;button\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;\n      );\n    }\n    \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;export\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;default\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;TestComponent\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;ol start=\u0026quot;2\u0026quot;\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;useAsyncDeepState\u0026lt;/code\u0026gt; is a deep state implementation (similar to this.setState (patchObject)) whose setter can return a promise synchronized with the internal effect. If the setter is called with no arguments, it does not change the state values, but simply subscribes to state updates. In this case, you can get the state value from anywhere inside your component, since function closures are no longer a hindrance.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;(\u0026lt;a href=\u0026quot;https://codesandbox.io/s/use-async-deep-state-5c9d0?file=/src/TestComponent.js\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Live Demo\u0026lt;/a\u0026gt;)\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;, { useCallback, useEffect } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;react\u0026quot;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { useAsyncDeepState } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;use-async-effect2\u0026quot;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;TestComponent\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;props\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [state, setState] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useAsyncDeepState\u0026lt;/span\u0026gt;({\n    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;counter\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;computedCounter\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n  });\n\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setState\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;{ counter }\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; ({\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;computedCounter\u0026lt;/span\u0026gt;: counter * \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;\n    }));\n  }, [state.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;counter\u0026lt;/span\u0026gt;]);\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; inc = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useCallback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; () =\u0026amp;gt; {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(resolve, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1000\u0026lt;/span\u0026gt;));\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setState\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;{ counter }\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; ({ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;counter\u0026lt;/span\u0026gt;: counter + \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; }));\n      \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;computedCounter=\u0026quot;\u0026lt;/span\u0026gt;, state.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;computedCounter\u0026lt;/span\u0026gt;);\n    })();\n  });\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; (\n    \u0026lt;span class=\u0026quot;language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;className\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;component\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;className\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;caption\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;useAsyncDeepState demo\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;state.counter : {state.counter}\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;state.computedCounter : {state.computedCounter}\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;button\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;onClick\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;{()\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; inc()}\u0026amp;gt;Inc counter\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;button\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;\n  );\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; [state,setState]=\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;(defaultValue)\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;()=\u0026amp;gt;\u0026lt;/span\u0026gt;{\n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; updatedState\n   \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setState\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;currentState\u0026lt;/span\u0026gt;=\u0026amp;gt;\u0026lt;/span\u0026gt;{    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Do not change the state by get the updated state\u0026lt;/span\u0026gt;\n      updateState=currentState\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; currentState\n   })\n   \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;alert\u0026lt;/span\u0026gt;(updateState) \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// the current state.\u0026lt;/span\u0026gt;\n})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Without any addtional NPM package\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//...\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;BackendPageListing\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n    \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [ myData, setMyData] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;( {\n        \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;content\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;abc\u0026quot;\u0026lt;/span\u0026gt;\n    })\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;myFunction\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt; x \u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n        \n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setPagenateInfo\u0026lt;/span\u0026gt;({\n        ...myData,\n        \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;content\u0026lt;/span\u0026gt;: x\n        })\n\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(myData) \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// not reflecting change immediately\u0026lt;/span\u0026gt;\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; myDataNew = {...myData, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;content\u0026lt;/span\u0026gt;: x };\n        \n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(myDataNew) \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Reflecting change immediately\u0026lt;/span\u0026gt;\n\n    }\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; (\n        \u0026lt;span class=\u0026quot;language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n            \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;button\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;onClick\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;{()\u0026lt;/span\u0026gt;=\u0026amp;gt;\u0026lt;/span\u0026gt;{ myFunction(\u0026quot;New Content\u0026quot;)} }\u0026amp;gt;Update MyData\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;button\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;\n    )\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Not saying to do this, but it isn\u0026apos;t hard to do what the OP asked without useEffect.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Use a promise to resolve the new state in the body of the setter function:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; getState = \u0026amp;lt;T\u0026amp;gt;(\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;setState\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;Dispatch\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;SetStateAction\u0026lt;/span\u0026gt;\u0026amp;lt;T\u0026amp;gt;\u0026amp;gt;\n): \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;\u0026amp;lt;T\u0026amp;gt; =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setState\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;currentState: T\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n      \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(currentState);\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; currentState;\n    });\n  });\n};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;And this is how you use it (example shows the comparison between \u0026lt;code\u0026gt;count\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;outOfSyncCount\u0026lt;/code\u0026gt;/\u0026lt;code\u0026gt;syncCount\u0026lt;/code\u0026gt; in the UI rendering):\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;App\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;FC\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [count, setCount] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [outOfSyncCount, setOutOfSyncCount] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [syncCount, setSyncCount] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;);\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;handleOnClick\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setCount\u0026lt;/span\u0026gt;(count + \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;);\n\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Doesn\u0026apos;t work\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setOutOfSyncCount\u0026lt;/span\u0026gt;(count);\n\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Works\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; newCount = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getState\u0026lt;/span\u0026gt;(setCount);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setSyncCount\u0026lt;/span\u0026gt;(newCount);\n  };\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; (\n    \u0026lt;span class=\u0026quot;language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;h2\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;Count = {count}\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;h2\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;h2\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;Synced count = {syncCount}\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;h2\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;h2\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;Out of sync count = {outOfSyncCount}\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;h2\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;button\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;onClick\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;{handleOnClick}\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;Increment\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;button\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;\n  );\n};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Use the \u0026lt;a href=\u0026quot;https://github.com/ocetnik/react-native-background-timer\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Background Timer\u0026lt;/a\u0026gt; library. It solved my problem.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timeoutId = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;BackgroundTimer\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// This will be executed once after 1 seconds\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// even when the application is the background\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;tac\u0026apos;\u0026lt;/span\u0026gt;);\n}, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1000\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// replace\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;p\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;hello\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;p\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// with\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;p\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;{JSON.stringify(movies)}\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;p\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Now you should see, that your code actually \u0026lt;strong\u0026gt;does\u0026lt;/strong\u0026gt; work. What does not work is the \u0026lt;code\u0026gt;console.log(movies)\u0026lt;/code\u0026gt;. This is because \u0026lt;code\u0026gt;movies\u0026lt;/code\u0026gt; points to the \u0026lt;em\u0026gt;old state\u0026lt;/em\u0026gt;. If you move your \u0026lt;code\u0026gt;console.log(movies)\u0026lt;/code\u0026gt; outside of \u0026lt;code\u0026gt;useEffect\u0026lt;/code\u0026gt;, right above the return, you will see the updated movies object.\u0026lt;/p\u0026gt;\n    "],"id":82,"title":"The useState set method is not reflecting a change immediately","content":"\n                \n\u0026lt;p\u0026gt;I am trying to learn hooks and the \u0026lt;code\u0026gt;useState\u0026lt;/code\u0026gt; method has made me confused. I am assigning an initial value to a state in the form of an array. The set method in \u0026lt;code\u0026gt;useState\u0026lt;/code\u0026gt; is not working for me, both with and without the spread syntax.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I have made an API on another PC that I am calling and fetching the data which I want to set into the state.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Here is my code:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\u0026lt;div class=\u0026quot;snippet\u0026quot; data-lang=\u0026quot;js\u0026quot; data-hide=\u0026quot;false\u0026quot; data-console=\u0026quot;true\u0026quot; data-babel=\u0026quot;false\u0026quot;\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-code\u0026quot;\u0026gt;\n\u0026lt;pre class=\u0026quot;snippet-code-html lang-html s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;root\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;script\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;type\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;text/babel\u0026quot;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;defer\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;language-javascript\u0026quot;\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// import React, { useState, useEffect } from \u0026quot;react\u0026quot;;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// import ReactDOM from \u0026quot;react-dom\u0026quot;;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; { useState, useEffect } = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;React\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// web-browser variant\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;StateSelector\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; initialValue = [\n    {\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;category\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026quot;\u0026lt;/span\u0026gt;,\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;photo\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026quot;\u0026lt;/span\u0026gt;,\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;description\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026quot;\u0026lt;/span\u0026gt;,\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;name\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026quot;\u0026lt;/span\u0026gt;,\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;rating\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n    }\n  ];\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; [movies, setMovies] = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useState\u0026lt;/span\u0026gt;(initialValue);\n\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;useEffect\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;try\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// const response = await fetch(\u0026quot;http://192.168.1.164:5000/movies/display\u0026quot;);\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// const json = await response.json();\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// const result = json.data.result;\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; result = [\n          {\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;category\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;cat1\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;description\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;desc1\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;1546514491119\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;name\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;randomname2\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;photo\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;rating\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;3\u0026quot;\u0026lt;/span\u0026gt;\n          },\n          {\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;category\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;cat2\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;description\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;desc1\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;1546837819818\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;name\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;randomname1\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;rating\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;5\u0026quot;\u0026lt;/span\u0026gt;\n          }\n        ];\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;result =\u0026quot;\u0026lt;/span\u0026gt;, result);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setMovies\u0026lt;/span\u0026gt;(result);\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;movies =\u0026quot;\u0026lt;/span\u0026gt;, movies);\n      } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt; (e) {\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;(e);\n      }\n    })();\n  }, []);\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;p\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;hello\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;p\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;;\n};\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; rootElement = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getElementById\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;root\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ReactDOM\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;render\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;StateSelector\u0026lt;/span\u0026gt; /\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;, rootElement);\n\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;script\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;script\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;src\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;https://unpkg.com/@babel/standalone@7/babel.min.js\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;script\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;script\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;src\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;https://unpkg.com/react@17/umd/react.production.min.js\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;script\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;script\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;src\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;https://unpkg.com/react-dom@17/umd/react-dom.production.min.js\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;script\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-result\u0026quot;\u0026gt;\u0026lt;div class=\u0026quot;snippet-ctas\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn s-btn__primary\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;icon-play-white _hover\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;span\u0026gt; Run code snippet\u0026lt;/span\u0026gt;\u0026lt;/button\u0026gt;\u0026lt;input class=\u0026quot;copySnippet s-btn s-btn__filled\u0026quot; type=\u0026quot;button\u0026quot; value=\u0026quot;Copy snippet to answer\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn hideResults\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;Hide results\u0026lt;/button\u0026gt;\u0026lt;div class=\u0026quot;popout-code\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;snippet-expand-link\u0026quot;\u0026gt;Expand snippet\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;div class=\u0026quot;snippet-result-code\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;iframe name=\u0026quot;sif1\u0026quot; sandbox=\u0026quot;allow-forms allow-modals allow-scripts\u0026quot; class=\u0026quot;snippet-box-edit snippet-box-result\u0026quot; frameborder=\u0026quot;0\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Neither \u0026lt;code\u0026gt;setMovies(result)\u0026lt;/code\u0026gt; nor \u0026lt;code\u0026gt;setMovies(...result)\u0026lt;/code\u0026gt; works.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I expect the \u0026lt;code\u0026gt;result\u0026lt;/code\u0026gt; variable to be pushed into the \u0026lt;code\u0026gt;movies\u0026lt;/code\u0026gt; array.\u0026lt;/p\u0026gt;\n    ","slug":"the-usestate-set-method-is-not-reflecting-a-change-immediately-1657384524775","postType":"QUESTION","createdAt":"2022-07-09T16:35:24.000Z","updatedAt":"2022-07-09T16:35:24.000Z","tags":[{"id":303,"name":"reactjs","slug":"reactjs","createdAt":"2022-07-09T16:35:24.000Z","updatedAt":"2022-07-09T16:35:24.000Z","Questions_Tags":{"questionId":82,"tagId":303}},{"id":304,"name":"react-hooks","slug":"react-hooks","createdAt":"2022-07-09T16:35:24.000Z","updatedAt":"2022-07-09T16:35:24.000Z","Questions_Tags":{"questionId":82,"tagId":304}}]}},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"the-usestate-set-method-is-not-reflecting-a-change-immediately-1657384524775"},"buildId":"D-Vv5KfwuaE883xCdWfex","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>