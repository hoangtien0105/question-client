{"pageProps":{"data":{"count":610,"rows":[{"id":435,"title":"Daylight saving time and time zone best practices [closed]","slug":"daylight-saving-time-and-time-zone-best-practices-closed-1657387973687","postType":"QUESTION","createdAt":"2022-07-09T17:32:53.000Z","updatedAt":"2022-07-09T17:32:53.000Z","tags":[{"id":2272,"name":"timezone","slug":"timezone","createdAt":"2022-07-09T17:32:53.000Z","updatedAt":"2022-07-09T17:32:53.000Z","Questions_Tags":{"questionId":435,"tagId":2272}},{"id":2273,"name":"dst","slug":"dst","createdAt":"2022-07-09T17:32:53.000Z","updatedAt":"2022-07-09T17:32:53.000Z","Questions_Tags":{"questionId":435,"tagId":2273}},{"id":2274,"name":"utc","slug":"utc","createdAt":"2022-07-09T17:32:53.000Z","updatedAt":"2022-07-09T17:32:53.000Z","Questions_Tags":{"questionId":435,"tagId":2274}},{"id":2275,"name":"datetimeoffset","slug":"datetimeoffset","createdAt":"2022-07-09T17:32:53.000Z","updatedAt":"2022-07-09T17:32:53.000Z","Questions_Tags":{"questionId":435,"tagId":2275}}]},{"id":434,"title":"What is an efficient way to implement a singleton pattern in Java? [closed]","slug":"what-is-an-efficient-way-to-implement-a-singleton-pattern-in-java-closed-1657387970474","postType":"QUESTION","createdAt":"2022-07-09T17:32:50.000Z","updatedAt":"2022-07-09T17:32:50.000Z","tags":[]},{"id":433,"title":"How to manage startActivityForResult on Android","slug":"how-to-manage-startactivityforresult-on-android-1657387967393","postType":"QUESTION","createdAt":"2022-07-09T17:32:47.000Z","updatedAt":"2022-07-09T17:32:47.000Z","tags":[{"id":2267,"name":"startactivityforresult","slug":"startactivityforresult","createdAt":"2022-07-09T17:32:47.000Z","updatedAt":"2022-07-09T17:32:47.000Z","Questions_Tags":{"questionId":433,"tagId":2267}}]},{"id":432,"title":"How do I compose a rotation matrix with human readable angles from scratch?","slug":"how-do-i-compose-a-rotation-matrix-with-human-readable-angles-from-scratch-1657387963457","postType":"QUESTION","createdAt":"2022-07-09T17:32:43.000Z","updatedAt":"2022-07-09T17:32:43.000Z","tags":[{"id":2260,"name":"opengl","slug":"opengl","createdAt":"2022-07-09T17:32:43.000Z","updatedAt":"2022-07-09T17:32:43.000Z","Questions_Tags":{"questionId":432,"tagId":2260}},{"id":2262,"name":"matrix","slug":"matrix","createdAt":"2022-07-09T17:32:43.000Z","updatedAt":"2022-07-09T17:32:43.000Z","Questions_Tags":{"questionId":432,"tagId":2262}},{"id":2263,"name":"3d","slug":"3d","createdAt":"2022-07-09T17:32:43.000Z","updatedAt":"2022-07-09T17:32:43.000Z","Questions_Tags":{"questionId":432,"tagId":2263}}]},{"id":431,"title":"Is there a JavaScript / jQuery DOM change listener?","slug":"is-there-a-javascript-jquery-dom-change-listener-1657387961200","postType":"QUESTION","createdAt":"2022-07-09T17:32:41.000Z","updatedAt":"2022-07-09T17:32:41.000Z","tags":[]}]},"answers":{"431":["\n&lt;p&gt;For a long time, DOM3 mutation events were the best available solution, but they have been deprecated for performance reasons. &lt;a href=&quot;https://dom.spec.whatwg.org/#interface-mutationobserver&quot; rel=&quot;noreferrer&quot;&gt;DOM4 Mutation Observers&lt;/a&gt; are the replacement for deprecated DOM3 mutation events.  They are &lt;a href=&quot;http://caniuse.com/#feat=mutationobserver&quot; rel=&quot;noreferrer&quot;&gt;currently implemented in modern browsers&lt;/a&gt; as &lt;code&gt;MutationObserver&lt;/code&gt; (or as the vendor-prefixed &lt;code&gt;WebKitMutationObserver&lt;/code&gt; in old versions of Chrome):&lt;/p&gt;\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;&lt;span class=&quot;hljs-title class_&quot;&gt;MutationObserver&lt;/span&gt; = &lt;span class=&quot;hljs-variable language_&quot;&gt;window&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;MutationObserver&lt;/span&gt; || &lt;span class=&quot;hljs-variable language_&quot;&gt;window&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;WebKitMutationObserver&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; observer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MutationObserver&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;mutations, observer&lt;/span&gt;) {\n    &lt;span class=&quot;hljs-comment&quot;&gt;// fired when a mutation occurs&lt;/span&gt;\n    &lt;span class=&quot;hljs-variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;log&lt;/span&gt;(mutations, observer);\n    &lt;span class=&quot;hljs-comment&quot;&gt;// ...&lt;/span&gt;\n});\n\n&lt;span class=&quot;hljs-comment&quot;&gt;// define what element should be observed by the observer&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;// and what types of mutations trigger the callback&lt;/span&gt;\nobserver.&lt;span class=&quot;hljs-title function_&quot;&gt;observe&lt;/span&gt;(&lt;span class=&quot;hljs-variable language_&quot;&gt;document&lt;/span&gt;, {\n  &lt;span class=&quot;hljs-attr&quot;&gt;subtree&lt;/span&gt;: &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;,\n  &lt;span class=&quot;hljs-attr&quot;&gt;attributes&lt;/span&gt;: &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;\n  &lt;span class=&quot;hljs-comment&quot;&gt;//...&lt;/span&gt;\n});\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;This example listens for DOM changes on &lt;code&gt;document&lt;/code&gt; and its entire subtree, and it will fire on changes to element attributes as well as structural changes.  The draft spec has a full list of valid &lt;a href=&quot;https://dom.spec.whatwg.org/#interface-mutationobserver&quot; rel=&quot;noreferrer&quot;&gt;mutation listener properties&lt;/a&gt;:&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;&lt;strong&gt;childList&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;Set to &lt;code&gt;true&lt;/code&gt; if mutations to target&apos;s children are to be observed.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;strong&gt;attributes&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;Set to &lt;code&gt;true&lt;/code&gt; if mutations to target&apos;s attributes are to be observed.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;strong&gt;characterData&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;Set to &lt;code&gt;true&lt;/code&gt; if mutations to target&apos;s data are to be observed.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;strong&gt;subtree&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;Set to &lt;code&gt;true&lt;/code&gt; if mutations to not just target, but also target&apos;s descendants are to be observed.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;strong&gt;attributeOldValue&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;Set to &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;attributes&lt;/code&gt; is set to true and target&apos;s attribute value before the mutation needs to be recorded.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;strong&gt;characterDataOldValue&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;Set to &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;characterData&lt;/code&gt; is set to true and target&apos;s data before the mutation needs to be recorded.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;strong&gt;attributeFilter&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;Set to a list of attribute local names (without namespace) if not all attribute mutations need to be observed.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;(This list is current as of April 2014; you may check the specification for any changes.)&lt;/p&gt;\n    ","\n&lt;p&gt;&lt;strong&gt;Edit&lt;/strong&gt;&lt;/p&gt;\n\n&lt;p&gt;This answer is now deprecated. See the answer by &lt;a href=&quot;http://stackoverflow.com/a/11546242/165737&quot;&gt;apsillers&lt;/a&gt;.&lt;/p&gt;\n\n&lt;p&gt;Since this is for a Chrome extension, you might as well use the standard DOM event - &lt;code&gt;DOMSubtreeModified&lt;/code&gt;. See the support for this &lt;a href=&quot;http://www.quirksmode.org/dom/events/#t18&quot; rel=&quot;noreferrer&quot;&gt;event&lt;/a&gt; across browsers. It has been supported in Chrome since 1.0.&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;$(&lt;span class=&quot;hljs-string&quot;&gt;&quot;#someDiv&quot;&lt;/span&gt;).&lt;span class=&quot;hljs-title function_&quot;&gt;bind&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;DOMSubtreeModified&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;/span&gt;) {\n    &lt;span class=&quot;hljs-title function_&quot;&gt;alert&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;tree changed&quot;&lt;/span&gt;);\n});\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;See a working example &lt;a href=&quot;http://jsfiddle.net/eQErD/1/&quot; rel=&quot;noreferrer&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;\n    ","\n&lt;p&gt;Many sites use AJAX/XHR/fetch to add, show, modify content dynamically and window.history API instead of in-site navigation so current URL is changed programmatically. Such sites are called SPA, short for Single Page Application.&lt;/p&gt;\n&lt;hr&gt;\n&lt;h3&gt;Usual JS methods of detecting page changes&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;MutationObserver&lt;/strong&gt; (&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver&quot; rel=&quot;noreferrer&quot;&gt;docs&lt;/a&gt;) to literally detect DOM changes.&lt;/p&gt;\n&lt;p&gt;Info/examples:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/a/39334319&quot;&gt;How to change the HTML content as it&apos;s loading on the page&lt;/a&gt;&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/a/39332340&quot;&gt;Performance of MutationObserver to detect nodes in entire DOM&lt;/a&gt;.&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;Lightweight observer to react to a change only if URL also changed:&lt;/p&gt;\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;let&lt;/span&gt; lastUrl = location.&lt;span class=&quot;hljs-property&quot;&gt;href&lt;/span&gt;; \n&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MutationObserver&lt;/span&gt;(&lt;span class=&quot;hljs-function&quot;&gt;() =&amp;gt;&lt;/span&gt; {\n  &lt;span class=&quot;hljs-keyword&quot;&gt;const&lt;/span&gt; url = location.&lt;span class=&quot;hljs-property&quot;&gt;href&lt;/span&gt;;\n  &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (url !== lastUrl) {\n    lastUrl = url;\n    &lt;span class=&quot;hljs-title function_&quot;&gt;onUrlChange&lt;/span&gt;();\n  }\n}).&lt;span class=&quot;hljs-title function_&quot;&gt;observe&lt;/span&gt;(&lt;span class=&quot;hljs-variable language_&quot;&gt;document&lt;/span&gt;, {&lt;span class=&quot;hljs-attr&quot;&gt;subtree&lt;/span&gt;: &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;hljs-attr&quot;&gt;childList&lt;/span&gt;: &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;});\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onUrlChange&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;/span&gt;) {\n  &lt;span class=&quot;hljs-variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;URL changed!&apos;&lt;/span&gt;, location.&lt;span class=&quot;hljs-property&quot;&gt;href&lt;/span&gt;);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;Event listener&lt;/strong&gt; for sites that signal content change by sending a DOM event:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;code&gt;pjax:end&lt;/code&gt; on &lt;code&gt;document&lt;/code&gt; used by many pjax-based sites e.g. GitHub,&lt;br&gt;\nsee &lt;a href=&quot;https://stackoverflow.com/a/10713622&quot;&gt;How to run jQuery before and after a pjax load?&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;message&lt;/code&gt; on &lt;code&gt;window&lt;/code&gt; used by e.g. Google search in Chrome browser,&lt;br&gt;\nsee &lt;a href=&quot;https://stackoverflow.com/a/39288755&quot;&gt;Chrome extension detect Google search refresh&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;yt-navigate-finish&lt;/code&gt; used by Youtube,&lt;br&gt;\nsee &lt;a href=&quot;https://stackoverflow.com/a/34100952&quot;&gt;How to detect page navigation on YouTube and modify its appearance seamlessly?&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;Periodic checking of DOM via setInterval&lt;/strong&gt;:&lt;br&gt;\nObviously this will work only in cases when you wait for a specific element identified by its id/selector to appear, and it won&apos;t let you universally detect new dynamically added content unless you invent some kind of fingerprinting the existing contents.&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;Cloaking &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/History_API&quot; rel=&quot;noreferrer&quot;&gt;History API&lt;/a&gt;:&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;let&lt;/span&gt; _pushState = &lt;span class=&quot;hljs-title class_&quot;&gt;History&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;prototype&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;pushState&lt;/span&gt;;\n&lt;span class=&quot;hljs-title class_&quot;&gt;History&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;prototype&lt;/span&gt;&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;pushState&lt;/span&gt; = &lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;hljs-params&quot;&gt;state, title, url&lt;/span&gt;) {\n  _pushState.&lt;span class=&quot;hljs-title function_&quot;&gt;call&lt;/span&gt;(&lt;span class=&quot;hljs-variable language_&quot;&gt;this&lt;/span&gt;, state, title, url);\n  &lt;span class=&quot;hljs-variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;URL changed&apos;&lt;/span&gt;, url)\n};\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;Listening to &lt;a href=&quot;https://developer.mozilla.org/docs/Web/API/HashChangeEvent&quot; rel=&quot;noreferrer&quot;&gt;hashchange&lt;/a&gt;, &lt;a href=&quot;https://developer.mozilla.org/docs/Web/Events/popstate&quot; rel=&quot;noreferrer&quot;&gt;popstate&lt;/a&gt; events:&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;&lt;span class=&quot;hljs-variable language_&quot;&gt;window&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;addEventListener&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;hashchange&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-params&quot;&gt;e&lt;/span&gt; =&amp;gt;&lt;/span&gt; {\n  &lt;span class=&quot;hljs-variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;URL hash changed&apos;&lt;/span&gt;, e);\n  &lt;span class=&quot;hljs-title function_&quot;&gt;doSomething&lt;/span&gt;();\n});\n&lt;span class=&quot;hljs-variable language_&quot;&gt;window&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;addEventListener&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;popstate&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-params&quot;&gt;e&lt;/span&gt; =&amp;gt;&lt;/span&gt; {\n  &lt;span class=&quot;hljs-variable language_&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;State changed&apos;&lt;/span&gt;, e);\n  &lt;span class=&quot;hljs-title function_&quot;&gt;doSomething&lt;/span&gt;();\n});\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;P.S. All these methods can be used in a WebExtension&apos;s &lt;a href=&quot;https://stackoverflow.com/a/4532567&quot;&gt;content script&lt;/a&gt;. It&apos;s because the case we&apos;re looking at is where the URL was changed via history.pushState or replaceState so the page itself remained the same with the same content script environment.&lt;/p&gt;\n    ","\n&lt;p&gt;Another approach depending on how you are changing the div.\nIf you are using JQuery to change a div&apos;s contents with its html() method, you can extend that method and call a registration function each time you put html into a div.&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt; $, oldHtmlMethod &lt;/span&gt;){\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Override the core html method in the jQuery object.&lt;/span&gt;\n    $.fn.&lt;span class=&quot;hljs-property&quot;&gt;html&lt;/span&gt; = &lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;/span&gt;){\n        &lt;span class=&quot;hljs-comment&quot;&gt;// Execute the original HTML method using the&lt;/span&gt;\n        &lt;span class=&quot;hljs-comment&quot;&gt;// augmented arguments collection.&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; results = oldHtmlMethod.&lt;span class=&quot;hljs-title function_&quot;&gt;apply&lt;/span&gt;( &lt;span class=&quot;hljs-variable language_&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;hljs-variable language_&quot;&gt;arguments&lt;/span&gt; );\n        com.&lt;span class=&quot;hljs-property&quot;&gt;invisibility&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;elements&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;findAndRegisterElements&lt;/span&gt;(&lt;span class=&quot;hljs-variable language_&quot;&gt;this&lt;/span&gt;);\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; results;\n\n    };\n})( jQuery, jQuery.&lt;span class=&quot;hljs-property&quot;&gt;fn&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;html&lt;/span&gt; );\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;We just intercept the calls to html(), call a registration function with this, which in the context refers to the target element getting new content, then we pass on the call to the original jquery.html() function. Remember to return the results of the original html() method, because JQuery expects it for method chaining.&lt;/p&gt;\n\n&lt;p&gt;For more info on method overriding and extension, check out &lt;a href=&quot;http://www.bennadel.com/blog/2009-Using-Self-Executing-Function-Arguments-To-Override-Core-jQuery-Methods.htm&quot; rel=&quot;noreferrer&quot;&gt;http://www.bennadel.com/blog/2009-Using-Self-Executing-Function-Arguments-To-Override-Core-jQuery-Methods.htm&lt;/a&gt;, which is where I cribbed the closure function. Also check out the plugins tutorial at JQuery&apos;s site.&lt;/p&gt;\n    ","\n&lt;p&gt;In addition to the &quot;raw&quot; tools provided by &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver&quot; rel=&quot;noreferrer&quot;&gt;&lt;code&gt;MutationObserver&lt;/code&gt; API&lt;/a&gt;, there exist &quot;convenience&quot; libraries to work with DOM mutations.&lt;/p&gt;\n\n&lt;p&gt;Consider: MutationObserver represents each DOM change in terms of subtrees. So if you&apos;re, for instance, waiting for a certain element to be inserted, it may be deep inside the children of &lt;code&gt;mutations.mutation[i].addedNodes[j]&lt;/code&gt;.&lt;/p&gt;\n\n&lt;p&gt;Another problem is when your own code, in reaction to mutations, changes DOM - you often want to filter it out.&lt;/p&gt;\n\n&lt;p&gt;A good convenience library that solves such problems is &lt;a href=&quot;https://github.com/rafaelw/mutation-summary&quot; rel=&quot;noreferrer&quot;&gt;&lt;code&gt;mutation-summary&lt;/code&gt;&lt;/a&gt; (disclaimer: I&apos;m not the author, just a satisfied user), which enables you to specify queries of what you&apos;re interested in, and get exactly that.&lt;/p&gt;\n\n&lt;p&gt;Basic usage example from the docs:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; observer = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MutationSummary&lt;/span&gt;({\n  &lt;span class=&quot;hljs-attr&quot;&gt;callback&lt;/span&gt;: updateWidgets,\n  &lt;span class=&quot;hljs-attr&quot;&gt;queries&lt;/span&gt;: [{\n    &lt;span class=&quot;hljs-attr&quot;&gt;element&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&apos;[data-widget]&apos;&lt;/span&gt;\n  }]\n});\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;updateWidgets&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;summaries&lt;/span&gt;) {\n  &lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; widgetSummary = summaries[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;];\n  widgetSummary.&lt;span class=&quot;hljs-property&quot;&gt;added&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;forEach&lt;/span&gt;(buildNewWidget);\n  widgetSummary.&lt;span class=&quot;hljs-property&quot;&gt;removed&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;forEach&lt;/span&gt;(cleanupExistingWidget);\n}\n&lt;/code&gt;&lt;/pre&gt;\n    "],"432":["\n&lt;p&gt;So the question really is &lt;strong&gt;Understanding 4x4 homogenous transform matrices&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;well without the math behind the only thing that left is geometric representation/meaning which is far better for human abstraction/understanding.&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;So what the 4x4 matrix is?&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;It is representation of some Cartesian coordinate system and it is composed of:&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;&lt;code&gt;3&lt;/code&gt; basis vectors (one for each axis) red,green,blue&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;So if the red,green,blue vectors are perpendicular to each other then the coordinate system is &lt;strong&gt;orthogonal&lt;/strong&gt;. If they are also unit vectors then it is &lt;strong&gt;orthonormal&lt;/strong&gt; (like for example unit matrix).&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;origin point gray&lt;/strong&gt;&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;projection and homogenous side (unmarked bottom rest of the matrix)&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;This part is there only for enabling rotation and translation at once, therefore point used must be homogenous that means in form &lt;code&gt;(x,y,z,w=1)&lt;/code&gt; for points and &lt;code&gt;(x,y,z,w=0)&lt;/code&gt; for direction vectors. If it was just &lt;code&gt;(x,y,z)&lt;/code&gt; then the matrix would be &lt;code&gt;3x3&lt;/code&gt; and that is not enough for translation. I will not use any projections they are uneasy to explain geometrically.&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;This layout is from &lt;strong&gt;OpenGL notation&lt;/strong&gt; there are also transposed representation out there (vectors are rows not columns)&lt;/p&gt;\n&lt;p&gt;now how to transform any point to/from this coordinate system:&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;g=M*l;\nl=Inverse(M)*g;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;where:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;code&gt;M&lt;/code&gt; is transform matrix&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;l&lt;/code&gt; is &lt;code&gt;M&lt;/code&gt; local coordinate system point (LCS)&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;g&lt;/code&gt; is global coordinate system point (GCS)&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;for the transposed version (&lt;strong&gt;DirectX&lt;/strong&gt;) it is:&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;l=M*g;\ng=Inverse(M)*l;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;That is because &lt;strong&gt;transposed orthogonal rotation matrix is also inverse of itself&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;for more info see &lt;a href=&quot;https://stackoverflow.com/a/25216549/2521214&quot;&gt;transform matrix anatomy&lt;/a&gt; and &lt;a href=&quot;https://stackoverflow.com/a/21100338/2521214&quot;&gt;3D graphic pipeline&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;img src=&quot;https://i.stack.imgur.com/rayCb.png&quot; alt=&quot;OpenGL transform matrix&quot;&gt;&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;how to visualize it&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;Yes you can draw the matrix numbers but they do not make sense at first look especially if the numbers are changing so draw the axises vectors as on image above. Where each axis is a line from &lt;code&gt;origin&lt;/code&gt; to &lt;code&gt;origin + line_size*axis_vector&lt;/code&gt;&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;how to construct it&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;Just compute axis vectors and origin and put them inside matrix. To ensure orthogonality exploit &lt;strong&gt;cross product&lt;/strong&gt; (but be careful with order of multiplicants to use the right direction) Here &lt;a href=&quot;https://stackoverflow.com/a/41813188/2521214&quot;&gt;example of getting 3 basis vectors from direction&lt;/a&gt;&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;effects&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;rotation is done by rotating the axises so you can compute each axis by parametric circle equation ...&lt;/li&gt;\n&lt;li&gt;scaling is done by multiplying axises by scale factor&lt;/li&gt;\n&lt;li&gt;skewing is just using non perpendicular axises&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;rotation&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;For most cases the incremental rotation is used. There are two types&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;local rotation&lt;/strong&gt; &lt;code&gt;M&apos;=M*rotation_matrix&lt;/code&gt; it rotates around local coordinate axises like you will control plane or car or player ... Most engines/games do not use these and fake it with &lt;strong&gt;euler angles&lt;/strong&gt; instead which is a cheap solution (have many quirks and problems) because most people who using OpenGL do not even know this is possible and rather stack list of &lt;code&gt;glRotate/glTranslate&lt;/code&gt; calls...&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;global rotation&lt;/strong&gt; &lt;code&gt;M&apos;=Inverse(Inverse(M)*rotation_matrix)&lt;/code&gt; it rotates around global coordinate system axises.&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;where &lt;code&gt;rotation_matrix&lt;/code&gt; is any standard rotation transform matrix.&lt;/p&gt;\n&lt;p&gt;If you have different matrix layout (transposed) then the rotations local and global are computed the other way around ...&lt;/p&gt;\n&lt;p&gt;You can also compute your &lt;code&gt;rotation_matrix&lt;/code&gt; from &lt;code&gt;3&lt;/code&gt; angles like:&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;rotation_matrix=rotation_around_x(ax)*rotation_around_y(ay)*rotation_around_z(az);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;see &lt;a href=&quot;http://en.wikipedia.org/wiki/Rotation_matrix&quot; rel=&quot;noreferrer&quot;&gt;Wiki rotation matrices&lt;/a&gt; the 3D &lt;code&gt;Rx,Ry,Rz&lt;/code&gt; from &lt;code&gt;Basic rotations&lt;/code&gt; are what you need. As you can see they are just unit circle parametric equation really. The order of multiplication change how the angles converge to target position. This is called &lt;strong&gt;Euler angles&lt;/strong&gt; and I do not use it (I integrate step changes instead which has no restrictions if done properly not to mention it is simpler).&lt;/p&gt;\n&lt;p&gt;Anyway if you need you can convert transform matrix into euler angles relatively easily see:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/a/56950130/2521214&quot;&gt;Is there a way to calculate 3D rotation on X and Y axis from a 4x4 matrix&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;glRotate&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;If you want &lt;code&gt;glRotate&lt;/code&gt; which is rotation around arbitrary axis not by 3 angles then &lt;a href=&quot;https://stackoverflow.com/a/64389606/2521214&quot;&gt;There is workaround&lt;/a&gt;:&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;create transform matrix &lt;code&gt;N&lt;/code&gt; for that axis&lt;/li&gt;\n&lt;li&gt;then transform your matrix &lt;code&gt;M&lt;/code&gt; to it&lt;/li&gt;\n&lt;li&gt;rotate &lt;code&gt;N&lt;/code&gt; by angle&lt;/li&gt;\n&lt;li&gt;then transform &lt;code&gt;M&lt;/code&gt; back from &lt;code&gt;N&lt;/code&gt; to global coordinates&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;Or you can use &lt;a href=&quot;https://en.wikipedia.org/wiki/Rodrigues%27_rotation_formula&quot; rel=&quot;noreferrer&quot;&gt;Rodrigues_rotation_formula&lt;/a&gt; instead&lt;/p&gt;\n&lt;p&gt;To transform Matrix to/from Matrix in this case just transform axises as points and leave the origin as is but the origin of &lt;code&gt;N&lt;/code&gt; &lt;strong&gt;must be (0,0,0)!!!&lt;/strong&gt; or the vectors transformed must have &lt;code&gt;w=0&lt;/code&gt; instead.&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;&lt;strong&gt;usage&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;Transformations are cumulative that means:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;code&gt;p&apos;=M1*M2*M3*M4*p;&lt;/code&gt; is the same as &lt;code&gt;M=M1*M2*M3*M4; p&apos;=M*p&lt;/code&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;So if you have many points to transform then you precompute all transformations to single matrix and use just it. Do not need to multiply points by all subsequent matrices. OK now the concept:&lt;/p&gt;\n&lt;p&gt;you should have &lt;code&gt;3&lt;/code&gt; coordinate systems:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;camera &lt;code&gt;C&lt;/code&gt;&lt;/li&gt;\n&lt;li&gt;world (usually unit matrix)&lt;/li&gt;\n&lt;li&gt;object &lt;code&gt;O&lt;/code&gt; (each object have its own matrix)&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;so if you have cube with &lt;code&gt;8&lt;/code&gt; vertexes &lt;code&gt;p0,...,p7&lt;/code&gt; then you have to perform transformation on each point from object local coordinates to camera local coordinates. Some gfx api do some of it so you apply only what you have to so you really need:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;code&gt;p(i)&apos;=inverse(C)*unit*M*p(i);&lt;/code&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;the transforms are cumulative and unit matrix does not change anything so:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;code&gt;Q=inverse(C)*M; p(i)&apos;=Q*p(i);&lt;/code&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;so before drawing compute &lt;code&gt;Q&lt;/code&gt; for drawed object then take each point &lt;code&gt;p(i)&lt;/code&gt; of the object and compute the transformed &lt;code&gt;p(i)&apos;&lt;/code&gt; and draw/use the transformed one ... The &lt;code&gt;p(i)&apos;&lt;/code&gt; is in local camera coordinate system (x,y of the screen) but there is no perspective there so before drawing you can also add any of the projection matrices and divide by &lt;code&gt;z&lt;/code&gt; cordinate at the end ... The projection is also cumulative so it can be also inside &lt;code&gt;Q&lt;/code&gt;&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;&lt;strong&gt;[edit1] C++ example&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;//$$---- Form CPP ----&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;// apart from math.h include you can ignore this machine generated VCL related code&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&amp;lt;vcl.h&amp;gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;pragma&lt;/span&gt; hdrstop&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;win_main.h&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&amp;lt;math.h&amp;gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;pragma&lt;/span&gt; package(smart_init)&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;pragma&lt;/span&gt; resource &lt;span class=&quot;hljs-string&quot;&gt;&quot;*.dfm&quot;&lt;/span&gt;&lt;/span&gt;\nTMain *Main; &lt;span class=&quot;hljs-comment&quot;&gt;// pointer to main window ...&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;// Here is the important stuff some math first&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-type&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; deg=M_PI/&lt;span class=&quot;hljs-number&quot;&gt;180.0&lt;/span&gt;;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;divide&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; x,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; y)&lt;/span&gt;&lt;/span&gt;;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;matrix_mul&lt;/span&gt;       &lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *b)&lt;/span&gt;&lt;/span&gt;; &lt;span class=&quot;hljs-comment&quot;&gt;// c[16] = a[16] * b[16]&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;matrix_mul_vector&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *b)&lt;/span&gt;&lt;/span&gt;; &lt;span class=&quot;hljs-comment&quot;&gt;// c[ 4] = a[16] * b[ 4]&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;matrix_subdet&lt;/span&gt;    &lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a)&lt;/span&gt;&lt;/span&gt;;           &lt;span class=&quot;hljs-comment&quot;&gt;// c[16] = all subdets of a[16]&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;matrix_subdet&lt;/span&gt;   &lt;span class=&quot;hljs-params&quot;&gt;(          &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; r,&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; s)&lt;/span&gt;&lt;/span&gt;;&lt;span class=&quot;hljs-comment&quot;&gt;//      = subdet(r,s) of a[16]&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;matrix_det&lt;/span&gt;      &lt;span class=&quot;hljs-params&quot;&gt;(          &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a)&lt;/span&gt;&lt;/span&gt;;           &lt;span class=&quot;hljs-comment&quot;&gt;//       = det of a[16]&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;matrix_det&lt;/span&gt;      &lt;span class=&quot;hljs-params&quot;&gt;(          &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *b)&lt;/span&gt;&lt;/span&gt;; &lt;span class=&quot;hljs-comment&quot;&gt;//       = det of a[16] and subdets b[16]&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;matrix_inv&lt;/span&gt;       &lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a)&lt;/span&gt;&lt;/span&gt;;           &lt;span class=&quot;hljs-comment&quot;&gt;// c[16] = a[16] ^ -1&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;divide&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; x,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; y)&lt;/span&gt;\n        &lt;/span&gt;{\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!y) &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; x/y;\n        }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;matrix_mul&lt;/span&gt;       &lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *b)&lt;/span&gt;\n        &lt;/span&gt;{\n        &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; q[&lt;span class=&quot;hljs-number&quot;&gt;16&lt;/span&gt;];\n        q[ &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;]);\n        q[ &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;9&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;13&lt;/span&gt;]);\n        q[ &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;14&lt;/span&gt;]);\n        q[ &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;15&lt;/span&gt;]);\n        q[ &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;]);\n        q[ &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;9&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;13&lt;/span&gt;]);\n        q[ &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;14&lt;/span&gt;]);\n        q[ &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;15&lt;/span&gt;]);\n        q[ &lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;9&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;]);\n        q[ &lt;span class=&quot;hljs-number&quot;&gt;9&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;9&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;9&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;13&lt;/span&gt;]);\n        q[&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;9&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;14&lt;/span&gt;]);\n        q[&lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;9&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;15&lt;/span&gt;]);\n        q[&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;]=(a[&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;13&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;14&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;15&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;]);\n        q[&lt;span class=&quot;hljs-number&quot;&gt;13&lt;/span&gt;]=(a[&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;13&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;14&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;9&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;15&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;13&lt;/span&gt;]);\n        q[&lt;span class=&quot;hljs-number&quot;&gt;14&lt;/span&gt;]=(a[&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;13&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;14&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;15&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;14&lt;/span&gt;]);\n        q[&lt;span class=&quot;hljs-number&quot;&gt;15&lt;/span&gt;]=(a[&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;13&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;14&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;15&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;15&lt;/span&gt;]);\n        &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;16&lt;/span&gt;;i++) c[i]=q[i];\n        }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;matrix_mul_vector&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *b)&lt;/span&gt;\n        &lt;/span&gt;{\n        &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; q[&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;];\n        q[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]);\n        q[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;]);\n        q[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]=(a[ &lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;])+(a[ &lt;span class=&quot;hljs-number&quot;&gt;9&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;]);\n        &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;;i++) c[i]=q[i];\n        }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;matrix_subdet&lt;/span&gt;    &lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a)&lt;/span&gt;\n        &lt;/span&gt;{\n        &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt;   q[&lt;span class=&quot;hljs-number&quot;&gt;16&lt;/span&gt;];\n        &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt;     i,j;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;;i++)\n         &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (j=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;j&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;;j++)\n          q[j+(i&amp;lt;&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;)]=&lt;span class=&quot;hljs-built_in&quot;&gt;matrix_subdet&lt;/span&gt;(a,i,j);\n        &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;16&lt;/span&gt;;i++) c[i]=q[i];\n        }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;matrix_subdet&lt;/span&gt;    &lt;span class=&quot;hljs-params&quot;&gt;(         &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; r,&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; s)&lt;/span&gt;\n        &lt;/span&gt;{\n        &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt;   c,q[&lt;span class=&quot;hljs-number&quot;&gt;9&lt;/span&gt;];\n        &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt;     i,j,k;\n        k=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;                            &lt;span class=&quot;hljs-comment&quot;&gt;// q = sub matrix&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (j=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;j&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;;j++)\n         &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (j!=s)\n          &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;;i++)\n           &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (i!=r)\n                {\n                q[k]=a[i+(j&amp;lt;&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;)];\n                k++;\n                }\n        c=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n        c+=q[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*q[&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;]*q[&lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;];\n        c+=q[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*q[&lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;]*q[&lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;];\n        c+=q[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*q[&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]*q[&lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;];\n        c-=q[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*q[&lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;]*q[&lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;];\n        c-=q[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*q[&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]*q[&lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;];\n        c-=q[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*q[&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;]*q[&lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;];\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-built_in&quot;&gt;int&lt;/span&gt;((r+s)&amp;amp;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;)) c=-c;       &lt;span class=&quot;hljs-comment&quot;&gt;// add signum&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; c;\n        }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;matrix_det&lt;/span&gt;       &lt;span class=&quot;hljs-params&quot;&gt;(         &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a)&lt;/span&gt;\n        &lt;/span&gt;{\n        &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; c=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n        c+=a[ &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*&lt;span class=&quot;hljs-built_in&quot;&gt;matrix_subdet&lt;/span&gt;(a,&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;);\n        c+=a[ &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;]*&lt;span class=&quot;hljs-built_in&quot;&gt;matrix_subdet&lt;/span&gt;(a,&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;);\n        c+=a[ &lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;]*&lt;span class=&quot;hljs-built_in&quot;&gt;matrix_subdet&lt;/span&gt;(a,&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;);\n        c+=a[&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;]*&lt;span class=&quot;hljs-built_in&quot;&gt;matrix_subdet&lt;/span&gt;(a,&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;);\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; c;\n        }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;matrix_det&lt;/span&gt;       &lt;span class=&quot;hljs-params&quot;&gt;(         &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *b)&lt;/span&gt;\n        &lt;/span&gt;{\n        &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; c=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n        c+=a[ &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;];\n        c+=a[ &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;];\n        c+=a[ &lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;];\n        c+=a[&lt;span class=&quot;hljs-number&quot;&gt;12&lt;/span&gt;]*b[ &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;];\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; c;\n        }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;matrix_inv&lt;/span&gt;       &lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a)&lt;/span&gt;\n        &lt;/span&gt;{\n        &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt;   d[&lt;span class=&quot;hljs-number&quot;&gt;16&lt;/span&gt;],D;\n        &lt;span class=&quot;hljs-built_in&quot;&gt;matrix_subdet&lt;/span&gt;(d,a);\n        D=&lt;span class=&quot;hljs-built_in&quot;&gt;matrix_det&lt;/span&gt;(a,d);\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (D) D=&lt;span class=&quot;hljs-number&quot;&gt;1.0&lt;/span&gt;/D;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;16&lt;/span&gt;;i++) c[i]=d[i]*D;\n        }\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;// now the object representation&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-type&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; pnts=&lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt;;\n&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; pnt[pnts*&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]=     &lt;span class=&quot;hljs-comment&quot;&gt;// Vertexes for 100x100x100 cube centered at (0,0,0)&lt;/span&gt;\n    {\n    &lt;span class=&quot;hljs-number&quot;&gt;-100.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;-100.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;-100.0&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;-100.0&lt;/span&gt;,+&lt;span class=&quot;hljs-number&quot;&gt;100.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;-100.0&lt;/span&gt;,\n    +&lt;span class=&quot;hljs-number&quot;&gt;100.0&lt;/span&gt;,+&lt;span class=&quot;hljs-number&quot;&gt;100.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;-100.0&lt;/span&gt;,\n    +&lt;span class=&quot;hljs-number&quot;&gt;100.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;-100.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;-100.0&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;-100.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;-100.0&lt;/span&gt;,+&lt;span class=&quot;hljs-number&quot;&gt;100.0&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;-100.0&lt;/span&gt;,+&lt;span class=&quot;hljs-number&quot;&gt;100.0&lt;/span&gt;,+&lt;span class=&quot;hljs-number&quot;&gt;100.0&lt;/span&gt;,\n    +&lt;span class=&quot;hljs-number&quot;&gt;100.0&lt;/span&gt;,+&lt;span class=&quot;hljs-number&quot;&gt;100.0&lt;/span&gt;,+&lt;span class=&quot;hljs-number&quot;&gt;100.0&lt;/span&gt;,\n    +&lt;span class=&quot;hljs-number&quot;&gt;100.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;-100.0&lt;/span&gt;,+&lt;span class=&quot;hljs-number&quot;&gt;100.0&lt;/span&gt;,\n    };\n&lt;span class=&quot;hljs-type&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; facs=&lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;;\n&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; fac[facs*&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;]=        &lt;span class=&quot;hljs-comment&quot;&gt;// faces (index of point used) no winding rule&lt;/span&gt;\n    {\n    &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;,\n    };\n&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; rep[&lt;span class=&quot;hljs-number&quot;&gt;16&lt;/span&gt;]=        &lt;span class=&quot;hljs-comment&quot;&gt;// 4x4 transform matrix of object (unit from start) at (0,0,+100)&lt;/span&gt;\n    {\n    &lt;span class=&quot;hljs-number&quot;&gt;1.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,  &lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,  &lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;100.0&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1.0&lt;/span&gt;,\n    };\n&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; eye[&lt;span class=&quot;hljs-number&quot;&gt;16&lt;/span&gt;]=        &lt;span class=&quot;hljs-comment&quot;&gt;// 4x4 transform matrix of camera at (0,0,-150)&lt;/span&gt;\n    {\n    &lt;span class=&quot;hljs-number&quot;&gt;1.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,   &lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,   &lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;-150.0&lt;/span&gt;,\n    &lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1.0&lt;/span&gt;,\n    };\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;// this is how to draw it&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *pnt,&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; pnts,&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; *fac,&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; facs,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *rep,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *ieye)&lt;/span&gt;\n    &lt;/span&gt;{\n    &lt;span class=&quot;hljs-comment&quot;&gt;// variables for drawing&lt;/span&gt;\n    &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i;\n    &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; p0[&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;],p1[&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;],p2[&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;],p3[&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;],m[&lt;span class=&quot;hljs-number&quot;&gt;16&lt;/span&gt;],d;\n    &lt;span class=&quot;hljs-comment&quot;&gt;// gfx api variables (change to your stuff) Main is the main form of this application&lt;/span&gt;\n    TCanvas *scr=Main-&amp;gt;bmp-&amp;gt;Canvas;\n    &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; xs2=Main-&amp;gt;ClientWidth/&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;,ys2=Main-&amp;gt;ClientHeight/&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;;\n    &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; v=xs2*&lt;span class=&quot;hljs-built_in&quot;&gt;tan&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;30.0&lt;/span&gt;*deg); &lt;span class=&quot;hljs-comment&quot;&gt;// 60 degree viewing angle perspective projection&lt;/span&gt;\n\n    &lt;span class=&quot;hljs-built_in&quot;&gt;matrix_mul&lt;/span&gt;(m,ieye,rep);             &lt;span class=&quot;hljs-comment&quot;&gt;// cumulate all needed transforms&lt;/span&gt;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;facs*&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;;)                 &lt;span class=&quot;hljs-comment&quot;&gt;// go through all faces&lt;/span&gt;\n        {\n        &lt;span class=&quot;hljs-comment&quot;&gt;// convert all points of face&lt;/span&gt;\n        &lt;span class=&quot;hljs-built_in&quot;&gt;matrix_mul_vector&lt;/span&gt;(p0,m,&amp;amp;pnt[fac[i]*&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]); i++;\n        &lt;span class=&quot;hljs-built_in&quot;&gt;matrix_mul_vector&lt;/span&gt;(p1,m,&amp;amp;pnt[fac[i]*&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]); i++;\n        &lt;span class=&quot;hljs-built_in&quot;&gt;matrix_mul_vector&lt;/span&gt;(p2,m,&amp;amp;pnt[fac[i]*&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]); i++;\n        &lt;span class=&quot;hljs-built_in&quot;&gt;matrix_mul_vector&lt;/span&gt;(p3,m,&amp;amp;pnt[fac[i]*&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;]); i++;\n        &lt;span class=&quot;hljs-comment&quot;&gt;// here goes perspective divide by z coordinate if needed&lt;/span&gt;\n        d=&lt;span class=&quot;hljs-built_in&quot;&gt;divide&lt;/span&gt;(v,p0[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]); p0[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*=d; p0[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*=d;\n        d=&lt;span class=&quot;hljs-built_in&quot;&gt;divide&lt;/span&gt;(v,p1[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]); p1[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*=d; p1[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*=d;\n        d=&lt;span class=&quot;hljs-built_in&quot;&gt;divide&lt;/span&gt;(v,p2[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]); p2[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*=d; p2[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*=d;\n        d=&lt;span class=&quot;hljs-built_in&quot;&gt;divide&lt;/span&gt;(v,p3[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]); p3[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*=d; p3[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*=d;\n        &lt;span class=&quot;hljs-comment&quot;&gt;// here is viewport transform (just translate (0,0) to middle of screen in this case&lt;/span&gt;\n        p0[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]+=xs2; p0[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]+=ys2;\n        p1[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]+=xs2; p1[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]+=ys2;\n        p2[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]+=xs2; p2[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]+=ys2;\n        p3[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]+=xs2; p3[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]+=ys2;\n        &lt;span class=&quot;hljs-comment&quot;&gt;// draw quad&lt;/span&gt;\n        &lt;span class=&quot;hljs-comment&quot;&gt;// I use VCL GDI TCanvas you use what you have ...&lt;/span&gt;\n        &lt;span class=&quot;hljs-comment&quot;&gt;// and wireframe only to keep this simple (no Z buffer,winding culling,...)&lt;/span&gt;\n        scr-&amp;gt;Pen-&amp;gt;Color=clAqua;     &lt;span class=&quot;hljs-comment&quot;&gt;// perimeter wireframe&lt;/span&gt;\n        scr-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;MoveTo&lt;/span&gt;(p0[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;],p0[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]);\n        scr-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;LineTo&lt;/span&gt;(p1[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;],p1[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]);\n        scr-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;LineTo&lt;/span&gt;(p2[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;],p2[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]);\n        scr-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;LineTo&lt;/span&gt;(p3[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;],p3[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]);\n        scr-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;LineTo&lt;/span&gt;(p0[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;],p0[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]);\n&lt;span class=&quot;hljs-comment&quot;&gt;//      scr-&amp;gt;Pen-&amp;gt;Color=clBlue;     // face cross to visualy check if I correctly generate the fac[]&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;//      scr-&amp;gt;MoveTo(p0[0],p0[1]);&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;//      scr-&amp;gt;LineTo(p2[0],p2[1]);&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;//      scr-&amp;gt;MoveTo(p1[0],p1[1]);&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;//      scr-&amp;gt;LineTo(p3[0],p3[1]);&lt;/span&gt;\n        }\n    }\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;TMain::draw&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;\n    &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!_redraw) &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt;;\n    bmp-&amp;gt;Canvas-&amp;gt;Brush-&amp;gt;Color=clBlack;\n    bmp-&amp;gt;Canvas-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;FillRect&lt;/span&gt;(&lt;span class=&quot;hljs-built_in&quot;&gt;TRect&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,xs,ys));\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// compute inverse of camera need to compute just once for all objects&lt;/span&gt;\n    &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; ieye[&lt;span class=&quot;hljs-number&quot;&gt;16&lt;/span&gt;];\n    &lt;span class=&quot;hljs-built_in&quot;&gt;matrix_inv&lt;/span&gt;(ieye,eye);\n    &lt;span class=&quot;hljs-comment&quot;&gt;// draw all objects&lt;/span&gt;\n    &lt;span class=&quot;hljs-built_in&quot;&gt;obj&lt;/span&gt;(pnt,pnts,fac,facs,rep,ieye);\n\n    Main-&amp;gt;Canvas-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;Draw&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,bmp);\n    _redraw=&lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;;\n    }\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;__fastcall &lt;span class=&quot;hljs-title&quot;&gt;TMain::TMain&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(TComponent* Owner)&lt;/span&gt; : TForm(Owner)\n    {&lt;/span&gt;\n    &lt;span class=&quot;hljs-comment&quot;&gt;// window constructor you can ignore this ... (just create a backbuffer bitmap here)&lt;/span&gt;\n    bmp=&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; Graphics::TBitmap;\n    bmp-&amp;gt;HandleType=bmDIB;\n    bmp-&amp;gt;PixelFormat=pf32bit;\n    pyx=&lt;span class=&quot;hljs-literal&quot;&gt;NULL&lt;/span&gt;;\n    }\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; __fastcall &lt;span class=&quot;hljs-title&quot;&gt;TMain::FormDestroy&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(TObject *Sender)&lt;/span&gt;\n    &lt;/span&gt;{\n    &lt;span class=&quot;hljs-comment&quot;&gt;// window destructor release memory ... also ignoe this&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (pyx) &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; pyx;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; bmp;\n    }\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; __fastcall &lt;span class=&quot;hljs-title&quot;&gt;TMain::FormResize&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(TObject *Sender)&lt;/span&gt;\n    &lt;/span&gt;{\n    &lt;span class=&quot;hljs-comment&quot;&gt;// on resize event ... just resize/redraw backbuffer also can ignore this&lt;/span&gt;\n    xs=ClientWidth;  xs2=xs&amp;gt;&amp;gt;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;\n    ys=ClientHeight; ys2=ys&amp;gt;&amp;gt;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;\n    bmp-&amp;gt;Width=xs;\n    bmp-&amp;gt;Height=ys;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (pyx) &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; pyx;\n    pyx=&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt;*[ys];\n    &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; y=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;y&amp;lt;ys;y++) pyx[y]=(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt;*) bmp-&amp;gt;ScanLine[y];\n    _redraw=&lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\n    }\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; __fastcall &lt;span class=&quot;hljs-title&quot;&gt;TMain::FormPaint&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(TObject *Sender)&lt;/span&gt;\n    &lt;/span&gt;{\n    &lt;span class=&quot;hljs-comment&quot;&gt;// repaint event can ignore&lt;/span&gt;\n    _redraw=&lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\n    }\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; __fastcall &lt;span class=&quot;hljs-title&quot;&gt;TMain::tim_redrawTimer&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(TObject *Sender)&lt;/span&gt;\n    &lt;/span&gt;{\n    &lt;span class=&quot;hljs-comment&quot;&gt;// timer event to animate the cube ...&lt;/span&gt;\n    _redraw=&lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// rotate the object to see it in motion&lt;/span&gt;\n    &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; ang,c,s;\n\n    ang=&lt;span class=&quot;hljs-number&quot;&gt;5.0&lt;/span&gt;*deg; c=&lt;span class=&quot;hljs-built_in&quot;&gt;cos&lt;/span&gt;(ang); s=&lt;span class=&quot;hljs-built_in&quot;&gt;sin&lt;/span&gt;(ang);    &lt;span class=&quot;hljs-comment&quot;&gt;// rotate baround z by 5 degrees per timer step&lt;/span&gt;\n    &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; rz[&lt;span class=&quot;hljs-number&quot;&gt;16&lt;/span&gt;]= { c, s, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,\n                    -s, c, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,\n                     &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,\n                     &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; };\n\n    ang=&lt;span class=&quot;hljs-number&quot;&gt;1.0&lt;/span&gt;*deg; c=&lt;span class=&quot;hljs-built_in&quot;&gt;cos&lt;/span&gt;(ang); s=&lt;span class=&quot;hljs-built_in&quot;&gt;sin&lt;/span&gt;(ang);    &lt;span class=&quot;hljs-comment&quot;&gt;// rotate baround x by 1 degrees per timer step&lt;/span&gt;\n    &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; rx[&lt;span class=&quot;hljs-number&quot;&gt;16&lt;/span&gt;]= { &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,\n                     &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, c, s, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,\n                     &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,-s, c, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,\n                     &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; };\n    &lt;span class=&quot;hljs-built_in&quot;&gt;matrix_mul&lt;/span&gt;(rep,rep,rz);\n    &lt;span class=&quot;hljs-built_in&quot;&gt;matrix_mul&lt;/span&gt;(rep,rep,rx);\n\n    &lt;span class=&quot;hljs-built_in&quot;&gt;draw&lt;/span&gt;();\n    }\n&lt;span class=&quot;hljs-comment&quot;&gt;//---------------------------------------------------------------------------&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;here is how it looks like:&lt;/p&gt;\n&lt;p&gt;&lt;img src=&quot;https://i.stack.imgur.com/lgfsw.png&quot; alt=&quot;cube example&quot;&gt;&lt;/p&gt;\n&lt;p&gt;And GIF animation with back face culling:&lt;/p&gt;\n&lt;p&gt;&lt;a href=&quot;https://i.stack.imgur.com/FGVUb.gif&quot; rel=&quot;noreferrer&quot;&gt;&lt;img src=&quot;https://i.stack.imgur.com/FGVUb.gif&quot; alt=&quot;animation&quot;&gt;&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;[notes]&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;If you have more questions then comment me ...&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;[Edit2] basic 3D vector operations often needed&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;If you do not know how to compute vector operations like cross/dot products or absolute value see:&lt;/p&gt;\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// cross product: W = U x V&lt;/span&gt;\nW.x=(U.y*V.z)-(U.z*V.y)\nW.y=(U.z*V.x)-(U.x*V.z)\nW.z=(U.x*V.y)-(U.y*V.x)\n&lt;span class=&quot;hljs-comment&quot;&gt;// dot product: a = (U.V)&lt;/span&gt;\na=U.x*V.x+U.y*V.y+U.z*V.z\n&lt;span class=&quot;hljs-comment&quot;&gt;// abs of vector a = |U|&lt;/span&gt;\na=&lt;span class=&quot;hljs-built_in&quot;&gt;sqrt&lt;/span&gt;((U.x*U.x)+(U.y*U.y)+(U.z*U.z))\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;here my C++ vector math:&lt;/p&gt;\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; vector_tmp[&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;];\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;divide&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; x,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; y)&lt;/span&gt; &lt;/span&gt;{ &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; ((y&amp;gt;=&lt;span class=&quot;hljs-number&quot;&gt;-1e-30&lt;/span&gt;)&amp;amp;&amp;amp;(y&amp;lt;=+&lt;span class=&quot;hljs-number&quot;&gt;1e-30&lt;/span&gt;)) &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0.0&lt;/span&gt;; &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; x/y; }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt;* &lt;span class=&quot;hljs-title&quot;&gt;vector_ld&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; x,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; y,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; z)&lt;/span&gt;          &lt;/span&gt;{ &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *p=vector_tmp; p[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]=x; p[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]=y; p[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]=z; &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; p;}\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt;* &lt;span class=&quot;hljs-title&quot;&gt;vector_ld&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *p,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; x,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; y,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; z)&lt;/span&gt; &lt;/span&gt;{                      p[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]=x; p[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]=y; p[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]=z; &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; p;}\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;vector_copy&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a)&lt;/span&gt;         &lt;/span&gt;{ &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;;i++) c[i]=a[i];       }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;vector_abs&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a)&lt;/span&gt;          &lt;/span&gt;{ &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;;i++) c[i]=&lt;span class=&quot;hljs-built_in&quot;&gt;fabs&lt;/span&gt;(a[i]); }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;vector_one&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a)&lt;/span&gt;\n        &lt;/span&gt;{\n        &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; l=&lt;span class=&quot;hljs-built_in&quot;&gt;divide&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;1.0&lt;/span&gt;,&lt;span class=&quot;hljs-built_in&quot;&gt;sqrt&lt;/span&gt;((a[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*a[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*a[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*a[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;])));\n        c[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]=a[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*l;\n        c[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]=a[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*l;\n        c[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]=a[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*l;\n        }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;vector_len&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; l)&lt;/span&gt;\n        &lt;/span&gt;{\n        l=&lt;span class=&quot;hljs-built_in&quot;&gt;divide&lt;/span&gt;(l,&lt;span class=&quot;hljs-built_in&quot;&gt;sqrt&lt;/span&gt;((a[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*a[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*a[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*a[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;])));\n        c[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]=a[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*l;\n        c[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]=a[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*l;\n        c[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]=a[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*l;\n        }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;vector_neg&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a)&lt;/span&gt;          &lt;/span&gt;{ &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;;i++) c[i]=-a[i];      }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;vector_add&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *b)&lt;/span&gt; &lt;/span&gt;{ &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;;i++) c[i]=a[i]+b[i]; }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;vector_sub&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *b)&lt;/span&gt; &lt;/span&gt;{ &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;;i++) c[i]=a[i]-b[i]; }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;vector_mul&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *b)&lt;/span&gt; &lt;span class=&quot;hljs-comment&quot;&gt;// cross&lt;/span&gt;\n        &lt;/span&gt;{\n        &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt;   q[&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;];\n        q[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]=(a[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;])-(a[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]);\n        q[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]=(a[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;])-(a[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]);\n        q[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]=(a[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;])-(a[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*b[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]);\n        &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;;i++) c[i]=q[i];\n        }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;vector_mul&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt;  b)&lt;/span&gt; &lt;/span&gt;{ &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;;i++) c[i]=a[i]*b; }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;hljs-title&quot;&gt;vector_mul&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *c,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt;  a,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *b)&lt;/span&gt; &lt;/span&gt;{ &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;;i++) c[i]=a*b[i]; }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;vector_mul&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(         &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a,&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *b)&lt;/span&gt; &lt;/span&gt;{ &lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; c=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;; &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i=&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;;i++) c+=a[i]*b[i]; &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; c; } &lt;span class=&quot;hljs-comment&quot;&gt;// dot&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;vector_len&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a)&lt;/span&gt; &lt;/span&gt;{ &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;sqrt&lt;/span&gt;((a[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*a[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*a[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*a[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;])); }\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;vector_len2&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;double&lt;/span&gt; *a)&lt;/span&gt; &lt;/span&gt;{ &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; (a[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;]*a[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]*a[&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;])+(a[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]*a[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]); }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;[Edit3] local rotations for camera and object control via keyboard&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;As this has been asked a lot lately here some example answers of mine with demos:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/a/40171880/2521214&quot;&gt;stationary camera view control (partial pseudo inverse matrix)&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/a/40104549/2521214&quot;&gt;camera and player control (inverse matrix)&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/a/42293434/2521214&quot;&gt;How to preserve accuracy with cumulative transforms over time (full pseudo inverse matrix)&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/a/52801501/2521214&quot;&gt;rotundus style simple OpenGL/C++/VCL player control example&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n    "],"433":["\n&lt;p&gt;From your &lt;code&gt;FirstActivity&lt;/code&gt;, call the &lt;code&gt;SecondActivity&lt;/code&gt; using the &lt;code&gt;startActivityForResult()&lt;/code&gt; method.&lt;/p&gt;\n&lt;p&gt;For example:&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-csharp&quot;&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;int&lt;/span&gt; LAUNCH_SECOND_ACTIVITY = &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\nIntent i = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; Intent(&lt;span class=&quot;hljs-keyword&quot;&gt;this&lt;/span&gt;, SecondActivity.&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt;);\nstartActivityForResult(i, LAUNCH_SECOND_ACTIVITY);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;In your &lt;code&gt;SecondActivity&lt;/code&gt;, set the data which you want to return back to &lt;code&gt;FirstActivity&lt;/code&gt;. If you don&apos;t want to return back, don&apos;t set any.&lt;/p&gt;\n&lt;p&gt;For example: In &lt;code&gt;SecondActivity&lt;/code&gt; if you want to send back data:&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;returnIntent&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt;();\nreturnIntent.putExtra(&lt;span class=&quot;hljs-string&quot;&gt;&quot;result&quot;&lt;/span&gt;,result);\nsetResult(Activity.RESULT_OK,returnIntent);\nfinish();\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;If you don&apos;t want to return data:&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-lisp&quot;&gt;Intent returnIntent = new Intent()&lt;span class=&quot;hljs-comment&quot;&gt;;&lt;/span&gt;\nsetResult(&lt;span class=&quot;hljs-name&quot;&gt;Activity&lt;/span&gt;.RESULT_CANCELED, returnIntent)&lt;span class=&quot;hljs-comment&quot;&gt;;&lt;/span&gt;\nfinish()&lt;span class=&quot;hljs-comment&quot;&gt;;&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Now in your &lt;code&gt;FirstActivity&lt;/code&gt; class, write the following code for the &lt;code&gt;onActivityResult()&lt;/code&gt; method.&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onActivityResult&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; requestCode, &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; resultCode, Intent data)&lt;/span&gt; {\n    &lt;span class=&quot;hljs-built_in&quot;&gt;super&lt;/span&gt;.onActivityResult(requestCode, resultCode, data);\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (requestCode == LAUNCH_SECOND_ACTIVITY) {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(resultCode == Activity.RESULT_OK){\n            String result=data.getStringExtra(&lt;span class=&quot;hljs-string&quot;&gt;&quot;result&quot;&lt;/span&gt;);\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (resultCode == Activity.RESULT_CANCELED) {\n            &lt;span class=&quot;hljs-comment&quot;&gt;// Write your code if there&apos;s no result&lt;/span&gt;\n        }\n    }\n} &lt;span class=&quot;hljs-comment&quot;&gt;//onActivityResult&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;To implement passing data between two activities in a much better way in Kotlin, please go through &lt;em&gt;&apos;&lt;a href=&quot;https://proandroiddev.com/is-onactivityresult-deprecated-in-activity-results-api-lets-deep-dive-into-it-302d5cf6edd&quot; rel=&quot;noreferrer&quot;&gt;A better way to pass data between Activities&lt;/a&gt;&apos;&lt;/em&gt;.&lt;/p&gt;\n    ","\n&lt;blockquote&gt;\n&lt;p&gt;How to check the result from the main activity?&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;You need to override &lt;a href=&quot;http://developer.android.com/reference/android/app/Activity.html#onActivityResult%28int,%20int,%20android.content.Intent%29&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;code&gt;Activity.onActivityResult()&lt;/code&gt;&lt;/a&gt; and then check its parameters:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;code&gt;requestCode&lt;/code&gt; identifies which app returned these results. This is defined by you when you call &lt;code&gt;startActivityForResult()&lt;/code&gt;.&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;resultCode&lt;/code&gt; informs you whether this app succeeded, failed, or something different&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;data&lt;/code&gt; holds any information returned by this app. This may be &lt;code&gt;null&lt;/code&gt;.&lt;/li&gt;\n&lt;/ul&gt;\n    ","\n&lt;p&gt;&lt;strong&gt;Example&lt;/strong&gt;&lt;/p&gt;\n\n&lt;p&gt;To see the entire process in context, here is a supplemental answer. See &lt;a href=&quot;https://stackoverflow.com/a/40969871/3681880&quot;&gt;my fuller answer&lt;/a&gt; for more explanation.&lt;/p&gt;\n\n&lt;p&gt;&lt;img src=&quot;https://i.stack.imgur.com/Tyhf8.png&quot; alt=&quot;enter image description here&quot;&gt;&lt;/p&gt;\n\n&lt;p&gt;&lt;em&gt;MainActivity.java&lt;/em&gt;&lt;/p&gt;\n\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MainActivity&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;AppCompatActivity&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Add a different request code for every activity you are starting from here&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;SECOND_ACTIVITY_REQUEST_CODE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(Bundle savedInstanceState)&lt;/span&gt; {\n        &lt;span class=&quot;hljs-built_in&quot;&gt;super&lt;/span&gt;.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n    }\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// &quot;Go to Second Activity&quot; button click&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onButtonClick&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(View view)&lt;/span&gt; {\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// Start the SecondActivity&lt;/span&gt;\n        &lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;intent&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt;(&lt;span class=&quot;hljs-built_in&quot;&gt;this&lt;/span&gt;, SecondActivity.class);\n        startActivityForResult(intent, SECOND_ACTIVITY_REQUEST_CODE);\n    }\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// This method is called when the second activity finishes&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onActivityResult&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; requestCode, &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; resultCode, Intent data)&lt;/span&gt; {\n        &lt;span class=&quot;hljs-built_in&quot;&gt;super&lt;/span&gt;.onActivityResult(requestCode, resultCode, data);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// check that it is the SecondActivity with an OK result&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (requestCode == SECOND_ACTIVITY_REQUEST_CODE) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (resultCode == RESULT_OK) { &lt;span class=&quot;hljs-comment&quot;&gt;// Activity.RESULT_OK&lt;/span&gt;\n\n                &lt;span class=&quot;hljs-comment&quot;&gt;// get String data from Intent&lt;/span&gt;\n                &lt;span class=&quot;hljs-type&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;returnString&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; data.getStringExtra(&lt;span class=&quot;hljs-string&quot;&gt;&quot;keyName&quot;&lt;/span&gt;);\n\n                &lt;span class=&quot;hljs-comment&quot;&gt;// set text view with string&lt;/span&gt;\n                &lt;span class=&quot;hljs-type&quot;&gt;TextView&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;textView&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; (TextView) findViewById(R.id.textView);\n                textView.setText(returnString);\n            }\n        }\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;&lt;em&gt;SecondActivity.java&lt;/em&gt;&lt;/p&gt;\n\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-scala&quot;&gt;public &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;SecondActivity&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;AppCompatActivity&lt;/span&gt; &lt;/span&gt;{\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; void onCreate(&lt;span class=&quot;hljs-type&quot;&gt;Bundle&lt;/span&gt; savedInstanceState) {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;super&lt;/span&gt;.onCreate(savedInstanceState);\n        setContentView(&lt;span class=&quot;hljs-type&quot;&gt;R&lt;/span&gt;.layout.activity_second);\n    }\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// &quot;Send text back&quot; button click&lt;/span&gt;\n    public void onButtonClick(&lt;span class=&quot;hljs-type&quot;&gt;View&lt;/span&gt; view) {\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// get the text from the EditText&lt;/span&gt;\n        &lt;span class=&quot;hljs-type&quot;&gt;EditText&lt;/span&gt; editText = (&lt;span class=&quot;hljs-type&quot;&gt;EditText&lt;/span&gt;) findViewById(&lt;span class=&quot;hljs-type&quot;&gt;R&lt;/span&gt;.id.editText);\n        &lt;span class=&quot;hljs-type&quot;&gt;String&lt;/span&gt; stringToPassBack = editText.getText().toString();\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// put the String to pass back into an Intent and close this activity&lt;/span&gt;\n        &lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt; intent = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt;();\n        intent.putExtra(&lt;span class=&quot;hljs-string&quot;&gt;&quot;keyName&quot;&lt;/span&gt;, stringToPassBack);\n        setResult(&lt;span class=&quot;hljs-type&quot;&gt;RESULT_OK&lt;/span&gt;, intent);\n        finish();\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Complementing &lt;a href=&quot;https://stackoverflow.com/questions/10407159/how-to-manage-startactivityforresult-on-android/10407371#10407371&quot;&gt;the answer from Nishant&lt;/a&gt;, the best way to return the activity result is:&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;returnIntent&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; getIntent();\nreturnIntent.putExtra(&lt;span class=&quot;hljs-string&quot;&gt;&quot;result&quot;&lt;/span&gt;,result);\nsetResult(RESULT_OK,returnIntent);\nfinish();\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;I was having a problem with&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-scss&quot;&gt;new &lt;span class=&quot;hljs-built_in&quot;&gt;Intent&lt;/span&gt;();\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Then I found out that the correct way is using&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-scss&quot;&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;getIntent&lt;/span&gt;();\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;to get the current intent.&lt;/p&gt;\n    ","\n&lt;h3&gt;startActivityForResult:  Deprecated in Android X&lt;/h3&gt;\n&lt;p&gt;For the &lt;em&gt;new&lt;/em&gt; way we have &lt;code&gt;registerForActivityResult&lt;/code&gt;.&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;In Java :&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt; &lt;span class=&quot;hljs-comment&quot;&gt;// You need to create a launcher variable inside onAttach or onCreate or global, i.e, before the activity is displayed&lt;/span&gt;\n ActivityResultLauncher&amp;lt;Intent&amp;gt; launchSomeActivity = registerForActivityResult(\n     &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;ActivityResultContracts&lt;/span&gt;.StartActivityForResult(),\n     &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;ActivityResultCallback&lt;/span&gt;&amp;lt;ActivityResult&amp;gt;() {\n              &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n              &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onActivityResult&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(ActivityResult result)&lt;/span&gt; {\n                   &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (result.getResultCode() == Activity.RESULT_OK) {\n                         &lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; result.getData();\n                         &lt;span class=&quot;hljs-comment&quot;&gt;// your operation....&lt;/span&gt;\n                    }\n               }\n      });\n\n      &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;openYourActivity&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n            &lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;intent&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt;(&lt;span class=&quot;hljs-built_in&quot;&gt;this&lt;/span&gt;, SomeActivity.class);\n            launchSomeActivity.launch(intent);\n      }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;In Kotlin :&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-kotlin&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; resultLauncher = registerForActivityResult(StartActivityForResult()) { result -&amp;gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (result.resultCode == Activity.RESULT_OK) {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;data&lt;/span&gt;: Intent? = result.&lt;span class=&quot;hljs-keyword&quot;&gt;data&lt;/span&gt;\n        &lt;span class=&quot;hljs-comment&quot;&gt;// your operation...&lt;/span&gt;\n    }\n}\n\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;openYourActivity&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;val&lt;/span&gt; intent = Intent(&lt;span class=&quot;hljs-keyword&quot;&gt;this&lt;/span&gt;, SomeActivity::&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt;.java)\n    resultLauncher.launch(intent)\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3&gt;Advantage:&lt;/h3&gt;\n&lt;ol&gt;\n&lt;li&gt;The new way is reduce complexity which we faced when we call the activity from a fragment or from another activity&lt;/li&gt;\n&lt;li&gt;Easily ask for any permission and get callback&lt;/li&gt;\n&lt;/ol&gt;\n    ","\n&lt;p&gt;For those who have problem with &lt;a href=&quot;https://stackoverflow.com/questions/10564474/wrong-requestcode-in-onactivityresult&quot;&gt;wrong requestCode in onActivityResult&lt;/a&gt;&lt;/p&gt;\n\n&lt;p&gt;If you are calling &lt;code&gt;startActivityForResult()&lt;/code&gt; from your &lt;code&gt;Fragment&lt;/code&gt;, the requestCode is changed by the Activity that owns the Fragment.&lt;/p&gt;\n\n&lt;p&gt;If you want to get the correct resultCode in your activity try this:&lt;/p&gt;\n\n&lt;p&gt;Change:&lt;/p&gt;\n\n&lt;p&gt;&lt;code&gt;startActivityForResult(intent, 1);&lt;/code&gt; To:&lt;/p&gt;\n\n&lt;p&gt;&lt;code&gt;getActivity().startActivityForResult(intent, 1);&lt;/code&gt;&lt;/p&gt;\n    ","\n&lt;h2&gt;The ActivityResultRegistry is the recommended approach&lt;/h2&gt;\n&lt;p&gt;&lt;code&gt;ComponentActivity&lt;/code&gt; now provides an &lt;code&gt;ActivityResultRegistry&lt;/code&gt; that lets you handle the &lt;code&gt;startActivityForResult()&lt;/code&gt;+&lt;code&gt;onActivityResult()&lt;/code&gt; as well as &lt;code&gt;requestPermissions()&lt;/code&gt;+&lt;code&gt;onRequestPermissionsResult()&lt;/code&gt; flows without overriding methods in your &lt;code&gt;Activity&lt;/code&gt; or &lt;code&gt;Fragment&lt;/code&gt;, brings increased type safety via &lt;code&gt;ActivityResultContract&lt;/code&gt;, and provides hooks for testing these flows.&lt;/p&gt;\n&lt;p&gt;It is strongly recommended to use the Activity Result APIs introduced in Android&amp;nbsp;10 Activity 1.2.0-alpha02 and Fragment 1.3.0-alpha02.&lt;/p&gt;\n&lt;p&gt;Add this to your &lt;code&gt;build.gradle&lt;/code&gt;&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-kotlin&quot;&gt;def activity_version = &lt;span class=&quot;hljs-string&quot;&gt;&quot;1.2.0-beta01&quot;&lt;/span&gt;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;// Java language implementation&lt;/span&gt;\nimplementation &lt;span class=&quot;hljs-string&quot;&gt;&quot;androidx.activity:activity:&lt;span class=&quot;hljs-variable&quot;&gt;$activity_version&lt;/span&gt;&quot;&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;// Kotlin&lt;/span&gt;\nimplementation &lt;span class=&quot;hljs-string&quot;&gt;&quot;androidx.activity:activity-ktx:&lt;span class=&quot;hljs-variable&quot;&gt;$activity_version&lt;/span&gt;&quot;&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2&gt;How to use the pre-built contract&lt;/h2&gt;\n&lt;p&gt;This new API has the following pre-built functionalities&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;TakeVideo&lt;/li&gt;\n&lt;li&gt;PickContact&lt;/li&gt;\n&lt;li&gt;GetContent&lt;/li&gt;\n&lt;li&gt;GetContents&lt;/li&gt;\n&lt;li&gt;OpenDocument&lt;/li&gt;\n&lt;li&gt;OpenDocuments&lt;/li&gt;\n&lt;li&gt;OpenDocumentTree&lt;/li&gt;\n&lt;li&gt;CreateDocument&lt;/li&gt;\n&lt;li&gt;Dial&lt;/li&gt;\n&lt;li&gt;TakePicture&lt;/li&gt;\n&lt;li&gt;RequestPermission&lt;/li&gt;\n&lt;li&gt;RequestPermissions&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;&lt;strong&gt;An example that uses the takePicture contract:&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-kotlin&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;val&lt;/span&gt; takePicture = prepareCall(ActivityResultContracts.TakePicture()) { bitmap: Bitmap? -&amp;gt;\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Do something with the Bitmap, if present&lt;/span&gt;\n}\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(savedInstanceState: &lt;span class=&quot;hljs-type&quot;&gt;Bundle&lt;/span&gt;?)&lt;/span&gt;&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;super&lt;/span&gt;.onCreate(savedInstanceState)\n    setContentView(R.layout.activity_main)\n\n    button.setOnClickListener { takePicture() }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;So whats going on here? Lets break it down slightly. &lt;code&gt;takePicture&lt;/code&gt; is just a callback which returns a nullable Bitmap - whether or not its null depends on whether or not the &lt;code&gt;onActivityResult&lt;/code&gt; process was successful. &lt;code&gt;prepareCall&lt;/code&gt; then registers this call into a new feature on &lt;code&gt;ComponentActivity&lt;/code&gt; called the &lt;code&gt;ActivityResultRegistry&lt;/code&gt; - well come back to this later. &lt;code&gt;ActivityResultContracts.TakePicture()&lt;/code&gt; is one of the built-in helpers which Google have created for us, and finally invoking &lt;code&gt;takePicture&lt;/code&gt; actually triggers the Intent in the same way that you would previously with &lt;code&gt;Activity.startActivityForResult(intent, REQUEST_CODE)&lt;/code&gt;.&lt;/p&gt;\n&lt;h2&gt;How to write a custom contract&lt;/h2&gt;\n&lt;p&gt;A simple contract that takes an Int as an &lt;em&gt;input&lt;/em&gt; and returns a string that the requested Activity returns in the result Intent.&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-kotlin&quot;&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;MyContract&lt;/span&gt; : &lt;span class=&quot;hljs-type&quot;&gt;ActivityResultContract&lt;/span&gt;&amp;lt;&lt;span class=&quot;hljs-type&quot;&gt;Int, String&lt;/span&gt;&amp;gt;&lt;/span&gt;() {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;companion&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;object&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;val&lt;/span&gt; ACTION = &lt;span class=&quot;hljs-string&quot;&gt;&quot;com.myapp.action.MY_ACTION&quot;&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;val&lt;/span&gt; INPUT_INT = &lt;span class=&quot;hljs-string&quot;&gt;&quot;input_int&quot;&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;val&lt;/span&gt; OUTPUT_STRING = &lt;span class=&quot;hljs-string&quot;&gt;&quot;output_string&quot;&lt;/span&gt;\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;createIntent&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(input: &lt;span class=&quot;hljs-type&quot;&gt;Int&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;: Intent {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; Intent(ACTION)\n            .apply { putExtra(INPUT_INT, input) }\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;parseResult&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(resultCode: &lt;span class=&quot;hljs-type&quot;&gt;Int&lt;/span&gt;, intent: &lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt;?)&lt;/span&gt;&lt;/span&gt;: String? {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;when&lt;/span&gt; (resultCode) {\n            Activity.RESULT_OK -&amp;gt; intent?.getStringExtra(OUTPUT_STRING)\n            &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; -&amp;gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;\n        }\n    }\n}\n\n&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;MyActivity&lt;/span&gt; : &lt;span class=&quot;hljs-type&quot;&gt;AppCompatActivity&lt;/span&gt;&lt;/span&gt;() {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;val&lt;/span&gt; myActionCall = prepareCall(MyContract()) { result -&amp;gt;\n        Log.i(&lt;span class=&quot;hljs-string&quot;&gt;&quot;MyActivity&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;Obtained result: &lt;span class=&quot;hljs-variable&quot;&gt;$result&lt;/span&gt;&quot;&lt;/span&gt;)\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(savedInstanceState: &lt;span class=&quot;hljs-type&quot;&gt;Bundle&lt;/span&gt;?)&lt;/span&gt;&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;super&lt;/span&gt;.onCreate(savedInstanceState)\n        ...\n        button.setOnClickListener {\n            myActionCall(&lt;span class=&quot;hljs-number&quot;&gt;500&lt;/span&gt;)\n        }\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Check &lt;a href=&quot;https://developer.android.com/training/basics/intents/result&quot; rel=&quot;nofollow noreferrer&quot;&gt;this official documentation&lt;/a&gt; for more information.&lt;/p&gt;\n    ","\n&lt;p&gt;If you want to update the user interface with the activity result, you can&apos;t to use &lt;code&gt;this.runOnUiThread(new Runnable() {}&lt;/code&gt;. Doing this, the UI won&apos;t refresh with the new value. Instead, you can do this:&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onActivityResult&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; requestCode, &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; resultCode, Intent data)&lt;/span&gt; {\n    &lt;span class=&quot;hljs-built_in&quot;&gt;super&lt;/span&gt;.onActivityResult(requestCode, resultCode, data);\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (resultCode == RESULT_CANCELED) {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt;;\n    }\n\n    global_lat = data.getDoubleExtra(&lt;span class=&quot;hljs-string&quot;&gt;&quot;LATITUDE&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;);\n    global_lng = data.getDoubleExtra(&lt;span class=&quot;hljs-string&quot;&gt;&quot;LONGITUDE&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;);\n    new_latlng = &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\n}\n\n&lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onResume&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n    &lt;span class=&quot;hljs-built_in&quot;&gt;super&lt;/span&gt;.onResume();\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(new_latlng)\n    {\n        PhysicalTagProperties.&lt;span class=&quot;hljs-built_in&quot;&gt;this&lt;/span&gt;.setLocation(global_lat, global_lng);\n        new_latlng=&lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;This seems silly, but it works pretty well.&lt;/p&gt;\n    ","\n&lt;p&gt;I will post the new &quot;way&quot; with &lt;a href=&quot;https://developer.android.com/jetpack/androidx&quot; rel=&quot;nofollow noreferrer&quot;&gt;Android X&lt;/a&gt; in a short answer (because in some case you does not need custom registry or contract). If you want more information, see:  &lt;em&gt;&lt;a href=&quot;https://developer.android.com/training/basics/intents/result&quot; rel=&quot;nofollow noreferrer&quot;&gt;Getting a result from an activity&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;Important&lt;/strong&gt;: there is actually a bug with the backward compatibility of Android X so you have to add &lt;code&gt;fragment_version&lt;/code&gt; in your Gradle file. &lt;strong&gt;Otherwise you will get an exception &quot;New result API error : Can only use lower 16 bits for requestCode&quot;&lt;/strong&gt;.&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-kotlin&quot;&gt;dependencies {\n\n    def activity_version = &lt;span class=&quot;hljs-string&quot;&gt;&quot;1.2.0-beta01&quot;&lt;/span&gt;\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Java language implementation&lt;/span&gt;\n    implementation &lt;span class=&quot;hljs-string&quot;&gt;&quot;androidx.activity:activity:&lt;span class=&quot;hljs-variable&quot;&gt;$activity_version&lt;/span&gt;&quot;&lt;/span&gt;\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Kotlin&lt;/span&gt;\n    implementation &lt;span class=&quot;hljs-string&quot;&gt;&quot;androidx.activity:activity-ktx:&lt;span class=&quot;hljs-variable&quot;&gt;$activity_version&lt;/span&gt;&quot;&lt;/span&gt;\n\n    def fragment_version = &lt;span class=&quot;hljs-string&quot;&gt;&quot;1.3.0-beta02&quot;&lt;/span&gt;\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Java language implementation&lt;/span&gt;\n    implementation &lt;span class=&quot;hljs-string&quot;&gt;&quot;androidx.fragment:fragment:&lt;span class=&quot;hljs-variable&quot;&gt;$fragment_version&lt;/span&gt;&quot;&lt;/span&gt;\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Kotlin&lt;/span&gt;\n    implementation &lt;span class=&quot;hljs-string&quot;&gt;&quot;androidx.fragment:fragment-ktx:&lt;span class=&quot;hljs-variable&quot;&gt;$fragment_version&lt;/span&gt;&quot;&lt;/span&gt;\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Testing Fragments in Isolation&lt;/span&gt;\n    debugImplementation &lt;span class=&quot;hljs-string&quot;&gt;&quot;androidx.fragment:fragment-testing:&lt;span class=&quot;hljs-variable&quot;&gt;$fragment_version&lt;/span&gt;&quot;&lt;/span&gt;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Now you just have to add this member variable of your activity. This use a predefined registry and generic contract.&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-scala&quot;&gt;public &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;MyActivity&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;AppCompatActivity&lt;/span&gt;&lt;/span&gt;{\n\n   ...\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * Activity callback API.\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-comment&quot;&gt;// https://developer.android.com/training/basics/intents/result&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;ActivityResultLauncher&lt;/span&gt;&amp;lt;&lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt;&amp;gt; mStartForResult = registerForActivityResult(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;ActivityResultContracts&lt;/span&gt;.&lt;span class=&quot;hljs-type&quot;&gt;StartActivityForResult&lt;/span&gt;(),\n\n            &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;ActivityResultCallback&lt;/span&gt;&amp;lt;&lt;span class=&quot;hljs-type&quot;&gt;ActivityResult&lt;/span&gt;&amp;gt;() {\n\n                &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n                public void onActivityResult(&lt;span class=&quot;hljs-type&quot;&gt;ActivityResult&lt;/span&gt; result) {\n                    switch (result.getResultCode()) {\n                        &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Activity&lt;/span&gt;.&lt;span class=&quot;hljs-type&quot;&gt;RESULT_OK&lt;/span&gt;:\n                            &lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt; intent = result.getData();\n                            &lt;span class=&quot;hljs-comment&quot;&gt;// Handle the Intent&lt;/span&gt;\n                            &lt;span class=&quot;hljs-type&quot;&gt;Toast&lt;/span&gt;.makeText(&lt;span class=&quot;hljs-type&quot;&gt;MyActivity&lt;/span&gt;.&lt;span class=&quot;hljs-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;Activity returned ok&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-type&quot;&gt;Toast&lt;/span&gt;.&lt;span class=&quot;hljs-type&quot;&gt;LENGTH_SHORT&lt;/span&gt;).show();\n                            &lt;span class=&quot;hljs-keyword&quot;&gt;break&lt;/span&gt;;\n                        &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Activity&lt;/span&gt;.&lt;span class=&quot;hljs-type&quot;&gt;RESULT_CANCELED&lt;/span&gt;:\n                            &lt;span class=&quot;hljs-type&quot;&gt;Toast&lt;/span&gt;.makeText(&lt;span class=&quot;hljs-type&quot;&gt;MyActivity&lt;/span&gt;.&lt;span class=&quot;hljs-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;Activity canceled&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-type&quot;&gt;Toast&lt;/span&gt;.&lt;span class=&quot;hljs-type&quot;&gt;LENGTH_SHORT&lt;/span&gt;).show();\n                            &lt;span class=&quot;hljs-keyword&quot;&gt;break&lt;/span&gt;;\n                    }\n                }\n            });\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Before new API you had :&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;btn.setOnClickListener(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;View&lt;/span&gt;.OnClickListener() {\n\n            &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(View v)&lt;/span&gt; {\n                &lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;intent&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt;(MyActivity .&lt;span class=&quot;hljs-built_in&quot;&gt;this&lt;/span&gt;, EditActivity.class);\n                startActivityForResult(intent, Constants.INTENT_EDIT_REQUEST_CODE);\n            }\n        });\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;You may notice that the request code is now generated (and hold) by the Google framework.&lt;/strong&gt;\nYour code becomes:&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt; btn.setOnClickListener(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;View&lt;/span&gt;.OnClickListener() {\n\n                &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n                &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(View v)&lt;/span&gt; {\n                    &lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;intent&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt;(MyActivity .&lt;span class=&quot;hljs-built_in&quot;&gt;this&lt;/span&gt;, EditActivity.class);\n                    mStartForResult.launch(intent);\n                }\n            });\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;First you use &lt;code&gt;startActivityForResult()&lt;/code&gt; with parameters in the first &lt;code&gt;Activity&lt;/code&gt; and if you want to send data from the second &lt;code&gt;Activity&lt;/code&gt; to first &lt;code&gt;Activity&lt;/code&gt; then pass the value using &lt;code&gt;Intent&lt;/code&gt; with the &lt;code&gt;setResult()&lt;/code&gt; method and get that data inside the &lt;code&gt;onActivityResult()&lt;/code&gt; method in the first &lt;code&gt;Activity&lt;/code&gt;.&lt;/p&gt;\n    ","\n&lt;p&gt;It is a very common problem on Android&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;It can be broken down into three pieces&lt;/strong&gt;&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;Start Activity B (happens in Activity A)&lt;/li&gt;\n&lt;li&gt;Set requested data  (happens in activity B)&lt;/li&gt;\n&lt;li&gt;Receive requested data (happens in activity A)&lt;/li&gt;\n&lt;/ol&gt;\n&lt;blockquote&gt;\n&lt;ol&gt;\n&lt;li&gt;startActivity B&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/blockquote&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-csharp&quot;&gt;Intent i = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; Intent(A.&lt;span class=&quot;hljs-keyword&quot;&gt;this&lt;/span&gt;, B.&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt;);\nstartActivity(i);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;ol start=&quot;2&quot;&gt;\n&lt;li&gt;Set requested data&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;In this part, you decide whether you want to send data back or not when a particular event occurs.&lt;/p&gt;\n&lt;p&gt;E.g.: In activity B there is an EditText and two buttons b1, b2.\nClicking on Button b1 sends data back to activity A.\nClicking on Button b2 does not send any data.&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;Sending data&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;b1......clickListener\n{\n    &lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;resultIntent&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt;();\n    resultIntent.putExtra(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Your_key&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;Your_value&quot;&lt;/span&gt;);\n    setResult(RES_CODE_A, resultIntent);\n    finish();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;Not sending data&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-scss&quot;&gt;b2.....&lt;span class=&quot;hljs-selector-class&quot;&gt;.clickListener&lt;/span&gt;\n{\n   &lt;span class=&quot;hljs-built_in&quot;&gt;setResult&lt;/span&gt;(RES_CODE_B, new Intent());\n   &lt;span class=&quot;hljs-built_in&quot;&gt;finish&lt;/span&gt;();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;The user clicks the back button&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;By default, the result is set with Activity.RESULT_CANCEL response code&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;ol start=&quot;3&quot;&gt;\n&lt;li&gt;Retrieve result&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;For that override onActivityResult method&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onActivityResult&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; requestCode, &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; resultCode, Intent data)&lt;/span&gt; {\n    &lt;span class=&quot;hljs-built_in&quot;&gt;super&lt;/span&gt;.onActivityResult(requestCode, resultCode, data);\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (resultCode == RES_CODE_A) {\n\n       &lt;span class=&quot;hljs-comment&quot;&gt;// b1 was clicked&lt;/span&gt;\n       &lt;span class=&quot;hljs-type&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; data.getStringExtra(&lt;span class=&quot;hljs-string&quot;&gt;&quot;RES_CODE_A&quot;&lt;/span&gt;);\n\n    }\n    &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(resultCode == RES_CODE_B){\n\n       &lt;span class=&quot;hljs-comment&quot;&gt;// b2 was clicked&lt;/span&gt;\n    }\n    &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt;{\n       &lt;span class=&quot;hljs-comment&quot;&gt;// The back button was clicked&lt;/span&gt;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;In &lt;strong&gt;Kotlin&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;Suppose A &amp;amp; B are activities the navigation is from A -&amp;gt; B\nWe need the result back from A &amp;lt;- B&lt;/p&gt;\n&lt;p&gt;in &lt;strong&gt;A&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-typescript&quot;&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// calling the Activity B&lt;/span&gt;\n    resultLauncher.&lt;span class=&quot;hljs-title function_&quot;&gt;launch&lt;/span&gt;(&lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt;(requireContext(), &lt;span class=&quot;hljs-attr&quot;&gt;B&lt;/span&gt;::&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;java&lt;/span&gt;))\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// we get data in here from B&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt; resultLauncher =\n    &lt;span class=&quot;hljs-title function_&quot;&gt;registerForActivityResult&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;ActivityResultContracts.StartActivityForResult()&lt;/span&gt;) { result -&amp;gt;\n        when (result.&lt;span class=&quot;hljs-property&quot;&gt;resultCode&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-title class_&quot;&gt;Activity&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;RESULT_OK&lt;/span&gt; -&amp;gt; {\n                result.&lt;span class=&quot;hljs-property&quot;&gt;data&lt;/span&gt;?.&lt;span class=&quot;hljs-title function_&quot;&gt;getStringExtra&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;VALUE&quot;&lt;/span&gt;)?.&lt;span class=&quot;hljs-property&quot;&gt;let&lt;/span&gt; {\n                    &lt;span class=&quot;hljs-comment&quot;&gt;// data received here&lt;/span&gt;\n                }\n            }\n            &lt;span class=&quot;hljs-title class_&quot;&gt;Activity&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;RESULT_CANCELED&lt;/span&gt; -&amp;gt; {\n                &lt;span class=&quot;hljs-comment&quot;&gt;// cancel or failure&lt;/span&gt;\n            }\n        }\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;In &lt;strong&gt;B&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-scss&quot;&gt;    &lt;span class=&quot;hljs-comment&quot;&gt;// Sending result value back to A&lt;/span&gt;\n    if (success) {\n       &lt;span class=&quot;hljs-built_in&quot;&gt;setResult&lt;/span&gt;(RESULT_OK, Intent()&lt;span class=&quot;hljs-selector-class&quot;&gt;.putExtra&lt;/span&gt;(&quot;VALUE&quot;, value))\n    } else {\n       &lt;span class=&quot;hljs-built_in&quot;&gt;setResult&lt;/span&gt;(RESULT_CANCELED)\n    }\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;In your Main Activity&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-typescript&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onCreate&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;Bundle savedInstanceState&lt;/span&gt;) {\n    &lt;span class=&quot;hljs-variable language_&quot;&gt;super&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;onCreate&lt;/span&gt;(savedInstanceState);\n    &lt;span class=&quot;hljs-title function_&quot;&gt;setContentView&lt;/span&gt;(R.&lt;span class=&quot;hljs-property&quot;&gt;layout&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;activity_main&lt;/span&gt;);\n\n    &lt;span class=&quot;hljs-title function_&quot;&gt;findViewById&lt;/span&gt;(R.&lt;span class=&quot;hljs-property&quot;&gt;id&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;takeCam&lt;/span&gt;).&lt;span class=&quot;hljs-title function_&quot;&gt;setOnClickListener&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;View&lt;/span&gt;.&lt;span class=&quot;hljs-title class_&quot;&gt;OnClickListener&lt;/span&gt;() {\n        &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onClick&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;View view&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt; intent=&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt;(&lt;span class=&quot;hljs-title function_&quot;&gt;getApplicationContext&lt;/span&gt;(),&lt;span class=&quot;hljs-title class_&quot;&gt;TakePhotoActivity&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;class&lt;/span&gt;);\n            intent.&lt;span class=&quot;hljs-title function_&quot;&gt;putExtra&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Mode&quot;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&quot;Take&quot;&lt;/span&gt;);\n            &lt;span class=&quot;hljs-title function_&quot;&gt;startActivity&lt;/span&gt;(intent);\n        }\n    });\n    &lt;span class=&quot;hljs-title function_&quot;&gt;findViewById&lt;/span&gt;(R.&lt;span class=&quot;hljs-property&quot;&gt;id&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;selectGal&lt;/span&gt;).&lt;span class=&quot;hljs-title function_&quot;&gt;setOnClickListener&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;View&lt;/span&gt;.&lt;span class=&quot;hljs-title class_&quot;&gt;OnClickListener&lt;/span&gt;() {\n        &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onClick&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;View view&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt; intent=&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt;(&lt;span class=&quot;hljs-title function_&quot;&gt;getApplicationContext&lt;/span&gt;(),&lt;span class=&quot;hljs-title class_&quot;&gt;TakePhotoActivity&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;class&lt;/span&gt;);\n            intent.&lt;span class=&quot;hljs-title function_&quot;&gt;putExtra&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Mode&quot;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&quot;Gallery&quot;&lt;/span&gt;);\n            &lt;span class=&quot;hljs-title function_&quot;&gt;startActivity&lt;/span&gt;(intent);\n        }\n    });\n}\n\n&lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onActivityResult&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;int requestCode, int resultCode, Intent data&lt;/span&gt;) {\n    &lt;span class=&quot;hljs-variable language_&quot;&gt;super&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;onActivityResult&lt;/span&gt;(requestCode, resultCode, data);\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;In Second Activity to Display&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;CAMERA_REQUEST&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1888&lt;/span&gt;;\n&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; ImageView imageView;\n&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;MY_CAMERA_PERMISSION_CODE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;100&lt;/span&gt;;\n&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;PICK_PHOTO_FOR_AVATAR&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n&lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(Bundle savedInstanceState)&lt;/span&gt; {\n    &lt;span class=&quot;hljs-built_in&quot;&gt;super&lt;/span&gt;.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_take_photo);\n\n    imageView=findViewById(R.id.imageView);\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(getIntent().getStringExtra(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Mode&quot;&lt;/span&gt;).equals(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Gallery&quot;&lt;/span&gt;))\n    {\n        pickImage();\n    }\n    &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (Build.VERSION.SDK_INT &amp;gt;= Build.VERSION_CODES.M) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED) {\n                requestPermissions(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;String&lt;/span&gt;[]{Manifest.permission.CAMERA}, MY_CAMERA_PERMISSION_CODE);\n            } &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; {\n                &lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;cameraIntent&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt;(MediaStore.ACTION_IMAGE_CAPTURE);\n                startActivityForResult(cameraIntent, CAMERA_REQUEST);\n            }\n        }\n    }\n}\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;pickImage&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n    &lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;intent&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt;(Intent.ACTION_PICK);\n    intent.setType(&lt;span class=&quot;hljs-string&quot;&gt;&quot;image/*&quot;&lt;/span&gt;);\n    startActivityForResult(intent, PICK_PHOTO_FOR_AVATAR);\n}\n&lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onRequestPermissionsResult&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; requestCode, &lt;span class=&quot;hljs-meta&quot;&gt;@NonNull&lt;/span&gt; String[] permissions, &lt;span class=&quot;hljs-meta&quot;&gt;@NonNull&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt;[] grantResults)&lt;/span&gt;\n{\n    &lt;span class=&quot;hljs-built_in&quot;&gt;super&lt;/span&gt;.onRequestPermissionsResult(requestCode, permissions, grantResults);\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (requestCode == MY_CAMERA_PERMISSION_CODE)\n    {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (grantResults[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;] == PackageManager.PERMISSION_GRANTED)\n        {\n            &lt;span class=&quot;hljs-type&quot;&gt;Intent&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;cameraIntent&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Intent&lt;/span&gt;(android.provider.MediaStore.ACTION_IMAGE_CAPTURE);\n            startActivityForResult(cameraIntent, CAMERA_REQUEST);\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt;\n        {\n            Toast.makeText(&lt;span class=&quot;hljs-built_in&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;Camera Permission Denied..&quot;&lt;/span&gt;, Toast.LENGTH_LONG).show();\n        }\n    }\n}\n\n&lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onActivityResult&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; requestCode, &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; resultCode, Intent data)&lt;/span&gt; {\n    &lt;span class=&quot;hljs-built_in&quot;&gt;super&lt;/span&gt;.onActivityResult(requestCode, resultCode, data);\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (requestCode == CAMERA_REQUEST &amp;amp;&amp;amp; resultCode == Activity.RESULT_OK) {\n        &lt;span class=&quot;hljs-type&quot;&gt;Bitmap&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;photo&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; (Bitmap) data.getExtras().get(&lt;span class=&quot;hljs-string&quot;&gt;&quot;data&quot;&lt;/span&gt;);\n        imageView.setImageBitmap(photo);\n    }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (requestCode == PICK_PHOTO_FOR_AVATAR &amp;amp;&amp;amp; resultCode == Activity.RESULT_OK) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (data == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n                Log.d(&lt;span class=&quot;hljs-string&quot;&gt;&quot;ABC&quot;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&quot;No Such Image Selected&quot;&lt;/span&gt;);\n                &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt;;\n            }\n            &lt;span class=&quot;hljs-keyword&quot;&gt;try&lt;/span&gt; {\n                Uri selectedData=data.getData();\n                Log.d(&lt;span class=&quot;hljs-string&quot;&gt;&quot;ABC&quot;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&quot;Image Pick-Up&quot;&lt;/span&gt;);\n                imageView.setImageURI(selectedData);\n                &lt;span class=&quot;hljs-type&quot;&gt;InputStream&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;inputStream&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; getApplicationContext().getContentResolver().openInputStream(selectedData);\n                &lt;span class=&quot;hljs-type&quot;&gt;Bitmap&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;bitmap&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; BitmapFactory.decodeStream(inputStream);\n                Bitmap bmp=MediaStore.Images.Media.getBitmap(getContentResolver(),selectedData);\n            } &lt;span class=&quot;hljs-keyword&quot;&gt;catch&lt;/span&gt; (FileNotFoundException e) {\n                e.printStackTrace();\n            } &lt;span class=&quot;hljs-keyword&quot;&gt;catch&lt;/span&gt;(IOException e){\n\n            }\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;You need to override Activity.onActivityResult():&lt;/p&gt;\n&lt;pre class=&quot;default s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;onActivityResult&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; requestCode, &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; resultCode, Intent data)&lt;/span&gt; {\n    &lt;span class=&quot;hljs-built_in&quot;&gt;super&lt;/span&gt;.onActivityResult(requestCode, resultCode, data);\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (resultCode == RESULT_CODE_ONE) {\n\n       &lt;span class=&quot;hljs-type&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; data.getStringExtra(&lt;span class=&quot;hljs-string&quot;&gt;&quot;RESULT_CODE_ONE&quot;&lt;/span&gt;);\n\n    }\n    &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(resultCode == RESULT_CODE_TWO){\n\n       &lt;span class=&quot;hljs-comment&quot;&gt;// b was clicked&lt;/span&gt;\n    }\n    &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt;{\n\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n    "],"434":["\n&lt;p&gt;Use an enum:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; {\n    INSTANCE;\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Joshua Bloch explained this approach in his &lt;a href=&quot;http://sites.google.com/site/io/effective-java-reloaded&quot; rel=&quot;noreferrer&quot;&gt;Effective Java Reloaded&lt;/a&gt; talk at Google I/O 2008: &lt;a href=&quot;http://www.youtube.com/watch?v=pi_I7oD_uGI#t=28m50s&quot; rel=&quot;noreferrer&quot;&gt;link to video&lt;/a&gt;. Also see slides 30-32 of his presentation (&lt;a href=&quot;https://14b1424d-a-62cb3a1a-s-sites.googlegroups.com/site/io/effective-java-reloaded/effective_java_reloaded.pdf?attachauth=ANoY7crKCOet2NEUGW7RV1XfM-Jn4z8YJhs0qJM11OhLRnFW_JbExkJtvJ3UJvTE40dhAciyWcRIeGJ-n3FLGnMOapHShHINh8IY05YViOJoZWzaohMtM-s4HCi5kjREagi8awWtcYD0_6G7GhKr2BndToeqLk5sBhZcQfcYIyAE5A4lGNosDCjODcBAkJn8EuO6572t2wU1LMSEUgjvqcf4I-Fp6VDhDvih_XUEmL9nuVJQynd2DRpxyuNH1SpJspEIdbLw-WWZ&amp;amp;attredirects=0&quot; rel=&quot;noreferrer&quot;&gt;effective_java_reloaded.pdf&lt;/a&gt;):&lt;/p&gt;\n\n&lt;blockquote&gt;\n  &lt;h3&gt;The Right Way to Implement a Serializable Singleton&lt;/h3&gt;\n\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Elvis&lt;/span&gt; {\n    INSTANCE;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; String[] favoriteSongs =\n        { &lt;span class=&quot;hljs-string&quot;&gt;&quot;Hound Dog&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;Heartbreak Hotel&quot;&lt;/span&gt; };\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;printFavorites&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        System.out.println(Arrays.toString(favoriteSongs));\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/blockquote&gt;\n\n&lt;p&gt;&lt;strong&gt;Edit:&lt;/strong&gt; An &lt;a href=&quot;http://www.ddj.com/java/208403883?pgno=3&quot; rel=&quot;noreferrer&quot;&gt;online portion of &quot;Effective Java&quot;&lt;/a&gt; says: &lt;/p&gt;\n\n&lt;blockquote&gt;\n  &lt;p&gt;&quot;This approach is functionally equivalent to the public field approach, except that it is more concise, provides the serialization machinery for free, and provides an ironclad guarantee against multiple instantiation, even in the face of sophisticated serialization or reflection attacks. While this approach has yet to be widely adopted, &lt;strong&gt;a single-element enum type is the best way to implement a singleton&lt;/strong&gt;.&quot;&lt;/p&gt;\n&lt;/blockquote&gt;\n    ","\n&lt;p&gt;Depending on the usage, there are several &quot;correct&quot; answers.&lt;/p&gt;\n&lt;p&gt;Since Java 5, the best way to do it is to use an enum:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; {\n   INSTANCE;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Pre Java 5, the most simple case is:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt;();\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE != &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;IllegalStateException&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Already instantiated&quot;&lt;/span&gt;);\n        }\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Foo &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Object &lt;span class=&quot;hljs-title function_&quot;&gt;clone&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; CloneNotSupportedException{\n        &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;CloneNotSupportedException&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Cannot clone instance of this class&quot;&lt;/span&gt;);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Let&apos;s go over the code. First, you want the class to be final. In this case, I&apos;ve used the &lt;code&gt;final&lt;/code&gt; keyword to let the users know it is final. Then you need to make the constructor private to prevent users to create their own Foo. Throwing an exception from the constructor prevents users to use reflection to create a second Foo. Then you create a &lt;code&gt;private static final Foo&lt;/code&gt; field to hold the only instance, and a &lt;code&gt;public static Foo getInstance()&lt;/code&gt; method to return it. The Java specification makes sure that the constructor is only called when the class is first used.&lt;/p&gt;\n&lt;p&gt;When you have a very large object or heavy construction code &lt;em&gt;and&lt;/em&gt; also have other accessible static methods or fields that might be used before an instance is needed, then and only then you need to use lazy initialization.&lt;/p&gt;\n&lt;p&gt;You can use a &lt;code&gt;private static class&lt;/code&gt; to load the instance. The code would then look like:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;FooLoader&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt;();\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (FooLoader.INSTANCE != &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;IllegalStateException&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Already instantiated&quot;&lt;/span&gt;);\n        }\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Foo &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; FooLoader.INSTANCE;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Since the line &lt;code&gt;private static final Foo INSTANCE = new Foo();&lt;/code&gt; is only executed when the class FooLoader is actually used, this takes care of the lazy instantiation, and is it guaranteed to be thread safe.&lt;/p&gt;\n&lt;p&gt;When you also want to be able to serialize your object you need to make sure that deserialization won&apos;t create a copy.&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Serializable&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;serialVersionUID&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1L&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;FooLoader&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt;();\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (FooLoader.INSTANCE != &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;IllegalStateException&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Already instantiated&quot;&lt;/span&gt;);\n        }\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Foo &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; FooLoader.INSTANCE;\n    }\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@SuppressWarnings(&quot;unused&quot;)&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; Foo &lt;span class=&quot;hljs-title function_&quot;&gt;readResolve&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; FooLoader.INSTANCE;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;The method &lt;code&gt;readResolve()&lt;/code&gt; will make sure the only instance will be returned, even when the object was serialized in a previous run of your program.&lt;/p&gt;\n    ","\n&lt;p&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I have just summarized all of the awesome answers and wrote it in my own words.&lt;/p&gt;\n&lt;hr&gt;\n&lt;p&gt;While implementing Singleton we have two options:&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;Lazy loading&lt;/li&gt;\n&lt;li&gt;Early loading&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;Lazy loading adds bit overhead (lots of to be honest), so use it only when you have a very large object or heavy construction code &lt;em&gt;and&lt;/em&gt; also have other accessible static methods or fields that might be used before an instance is needed, then and only then you need to use lazy initialization. Otherwise, choosing early loading is a good choice.&lt;/p&gt;\n&lt;p&gt;The most simple way of implementing a singleton is:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// It will be our sole hero&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt;();\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE != &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-comment&quot;&gt;// SHOUT&lt;/span&gt;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;IllegalStateException&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Already instantiated&quot;&lt;/span&gt;);\n        }\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Foo &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Everything is good except it&apos;s an early loaded singleton. Lets try lazy loaded singleton&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Our now_null_but_going_to_be sole hero&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE != &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-comment&quot;&gt;// SHOUT&lt;/span&gt;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;IllegalStateException&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Already instantiated&quot;&lt;/span&gt;);\n        }\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Foo &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-comment&quot;&gt;// Creating only  when required.&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n            INSTANCE = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt;();\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;So far so good, but our hero will not survive while fighting alone with multiple evil threads who want many many instance of our hero.\nSo lets protect it from evil multi threading:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// TODO Add private shouting constructor&lt;/span&gt;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Foo &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-comment&quot;&gt;// No more tension of threads&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt; (Foo.class) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n                INSTANCE = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt;();\n            }\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;But it is not enough to protect out hero, really!!! This is the best we can/should do to help our hero:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Pay attention to volatile&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// TODO Add private shouting constructor&lt;/span&gt;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Foo &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) { &lt;span class=&quot;hljs-comment&quot;&gt;// Check 1&lt;/span&gt;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt; (Foo.class) {\n                &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) { &lt;span class=&quot;hljs-comment&quot;&gt;// Check 2&lt;/span&gt;\n                    INSTANCE = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt;();\n                }\n            }\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;This is called the &quot;double-checked locking idiom&quot;. It&apos;s easy to forget the volatile statement and difficult to understand why it is necessary.\nFor details: &lt;em&gt;&lt;a href=&quot;http://www.cs.umd.edu/%7Epugh/java/memoryModel/DoubleCheckedLocking.html&quot; rel=&quot;nofollow noreferrer&quot;&gt;The &quot;Double-Checked Locking is Broken&quot; Declaration&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;\n&lt;p&gt;Now we are sure about evil threads, but what about the cruel serialization? We have to make sure even while de-serialiaztion no new object is created:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Serializable&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;serialVersionUID&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1L&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// The rest of the things are same as above&lt;/span&gt;\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// No more fear of serialization&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@SuppressWarnings(&quot;unused&quot;)&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; Object &lt;span class=&quot;hljs-title function_&quot;&gt;readResolve&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;The method &lt;code&gt;readResolve()&lt;/code&gt; will make sure the only instance will be returned, even when the object was serialized in a previous run of our program.&lt;/p&gt;\n&lt;p&gt;Finally, we have added enough protection against threads and serialization, but our code is looking bulky and ugly. Lets give our hero a makeover:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Serializable&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;serialVersionUID&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1L&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Wrapped in a inner static class so that loaded only when required&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;FooLoader&lt;/span&gt; {\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// And no more fear of threads&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt;();\n    }\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// TODO add private shouting construcor&lt;/span&gt;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Foo &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; FooLoader.INSTANCE;\n    }\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Damn you serialization&lt;/span&gt;\n    &lt;span class=&quot;hljs-meta&quot;&gt;@SuppressWarnings(&quot;unused&quot;)&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; Foo &lt;span class=&quot;hljs-title function_&quot;&gt;readResolve&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; FooLoader.INSTANCE;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Yes, this is our very same hero :)&lt;/p&gt;\n&lt;p&gt;Since the line &lt;code&gt;private static final Foo INSTANCE = new Foo();&lt;/code&gt; is only executed when the class &lt;code&gt;FooLoader&lt;/code&gt; is actually used, this takes care of the lazy instantiation, and is it guaranteed to be thread-safe.&lt;/p&gt;\n&lt;p&gt;And we have come so far. Here is the best way to achieve everything we did is best possible way:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; {\n    INSTANCE;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Which internally will be treated like&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// It will be our sole hero&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Foo&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt;();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;That&apos;s it! No more fear of serialization, threads and ugly code. Also &lt;a href=&quot;https://stackoverflow.com/questions/16771373/singleton-via-enum-way-is-lazy-initialized&quot;&gt;&lt;strong&gt;ENUMS singleton are lazily initialized&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;This approach is functionally equivalent to the public field approach,\nexcept that it is more concise, provides the serialization machinery\nfor free, and provides an  ironclad guarantee against multiple\ninstantiation, even in the face of sophisticated serialization or\nreflection attacks. While this approach has yet to be widely  adopted,\na single-element enum type is the best way to implement a singleton.&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;-Joshua Bloch in &quot;Effective Java&quot;&lt;/p&gt;\n&lt;p&gt;Now you might have realized why ENUMS are considered as best way to implement a singleton and thanks for your patience :)&lt;/p&gt;\n&lt;p&gt;Updated it on my &lt;a href=&quot;http://ajinkyaparakh.blogspot.in/2013/05/implementing-singleton-in-java.html&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;strong&gt;blog&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;\n    ","\n&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/70689/what-is-an-efficient-way-to-implement-a-singleton-pattern-in-java/70835#70835&quot;&gt;The solution posted by Stu Thompson&lt;/a&gt; is valid in Java&amp;nbsp;5.0 and later. But I would prefer not to use it because I think it is error prone.&lt;/p&gt;\n&lt;p&gt;It&apos;s easy to forget the volatile statement and difficult to understand why it is necessary. Without the volatile this code would not be thread safe any more due to the double-checked locking antipattern. See more about this in paragraph 16.2.4 of &lt;a href=&quot;http://jcip.net/&quot; rel=&quot;nofollow noreferrer&quot; title=&quot;Java Concurrency in Practice&quot;&gt;Java Concurrency in Practice&lt;/a&gt;. In short: This pattern (prior to Java&amp;nbsp;5.0 or without the volatile statement) could return a reference to the Bar object that is (still) in an incorrect state.&lt;/p&gt;\n&lt;p&gt;This pattern was invented for performance optimization. But this is really not a real concern any more. The following lazy initialization code is fast and - more importantly - easier to read.&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Bar&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;BarHolder&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Bar&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;bar&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Bar&lt;/span&gt;();\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Bar &lt;span class=&quot;hljs-title function_&quot;&gt;getBar&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; BarHolder.bar;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Thread safe in Java 5+:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Foo&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Bar&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;bar&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Bar &lt;span class=&quot;hljs-title function_&quot;&gt;getBar&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (bar == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt;(Foo.class) {\n                &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (bar == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;)\n                    bar = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Bar&lt;/span&gt;();\n            }\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; bar;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;hr&gt;\n&lt;p&gt;Pay attention to the &lt;code&gt;volatile&lt;/code&gt; modifier here. :) It is important because without it, other threads are not guaranteed by the JMM (Java Memory Model) to see changes to its value.  The synchronization &lt;em&gt;does not&lt;/em&gt; take care of that--it only serializes access to that block of code.&lt;/p&gt;\n&lt;p&gt;@Bno&apos;s answer details the approach recommended by Bill Pugh (FindBugs) and is arguable better.  Go read and vote up his answer too.&lt;/p&gt;\n    ","\n&lt;p&gt;Forget &lt;a href=&quot;https://en.wikipedia.org/wiki/Lazy_initialization&quot; rel=&quot;nofollow noreferrer&quot;&gt;lazy initialization&lt;/a&gt;; it&apos;s too problematic. This is the simplest solution:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;A&lt;/span&gt; {    \n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;A&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;A&lt;/span&gt;();\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {}\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; A &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Make sure that you really need it. Do a google search for &quot;singleton anti-pattern&quot; to see some arguments against it.&lt;/p&gt;\n&lt;p&gt;There&apos;s nothing inherently wrong with it I suppose, but it&apos;s just a mechanism for exposing some global resource/data so make sure that this is the best way. In particular, I&apos;ve found &lt;a href=&quot;https://en.wikipedia.org/wiki/Dependency_injection&quot; rel=&quot;nofollow noreferrer&quot;&gt;dependency injection&lt;/a&gt; (DI) more useful particularly if you are also using unit tests, because DI allows you to use mocked resources for testing purposes.&lt;/p&gt;\n    ","\n&lt;p&gt;I&apos;m mystified by some of the answers that suggest &lt;a href=&quot;https://en.wikipedia.org/wiki/Dependency_injection&quot; rel=&quot;nofollow noreferrer&quot;&gt;dependency injection&lt;/a&gt; (DI) as an alternative to using singletons; these are unrelated concepts. You can use DI to inject either singleton or non-singleton (e.g., per-thread) instances. At least this is true if you use Spring 2.x, I can&apos;t speak for other DI frameworks.&lt;/p&gt;\n&lt;p&gt;So my answer to the OP would be (in all but the most trivial sample code) to:&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;Use a DI framework like &lt;a href=&quot;https://en.wikipedia.org/wiki/Spring_Framework&quot; rel=&quot;nofollow noreferrer&quot;&gt;Spring Framework&lt;/a&gt;, then&lt;/li&gt;\n&lt;li&gt;Make it part of your DI configuration whether your dependencies are singletons, request scoped, session scoped, or whatever.&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;This approach gives you a nice decoupled (and therefore flexible and testable) architecture where whether to use a singleton is an easily reversible implementation detail (provided any singletons you use are threadsafe, of course).&lt;/p&gt;\n    ","\n&lt;p&gt;Really consider why you need a singleton before writing it. There is a quasi-religious debate about using them which you can quite easily stumble over if you google singletons in Java.&lt;/p&gt;\n&lt;p&gt;Personally, I try to avoid singletons as often as possible for many reasons, again most of which can be found by googling singletons. I feel that quite often singletons are abused because they&apos;re easy to understand by everybody. They&apos;re used as a mechanism for getting &quot;global&quot; data into an OO design and they are used because it is easy to circumvent object lifecycle management (or really thinking about how you can do A from inside B). Look at things like &lt;a href=&quot;https://en.wikipedia.org/wiki/Inversion_of_control&quot; rel=&quot;nofollow noreferrer&quot;&gt;inversion of control&lt;/a&gt; (IoC) or &lt;a href=&quot;https://en.wikipedia.org/wiki/Dependency_injection&quot; rel=&quot;nofollow noreferrer&quot;&gt;dependency injection&lt;/a&gt; (DI) for a nice middle ground.&lt;/p&gt;\n&lt;p&gt;If you really need one then Wikipedia has a good example of a proper implementation of a singleton.&lt;/p&gt;\n    ","\n&lt;p&gt;Following are three different approaches&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;p&gt;Enum&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt; &lt;span class=&quot;hljs-comment&quot;&gt;/**\n * Singleton pattern example using Java Enum\n */&lt;/span&gt;\n &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;EasySingleton&lt;/span&gt; {\n     INSTANCE;\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;Double checked locking / lazy loading&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt; &lt;span class=&quot;hljs-comment&quot;&gt;/**\n * Singleton pattern example with Double checked Locking\n */&lt;/span&gt;\n &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;DoubleCheckedLockingSingleton&lt;/span&gt; {\n      &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;volatile&lt;/span&gt; DoubleCheckedLockingSingleton INSTANCE;\n\n      &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;DoubleCheckedLockingSingleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {}\n\n      &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; DoubleCheckedLockingSingleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n          &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(INSTANCE == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n             &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt;(DoubleCheckedLockingSingleton.class) {\n                 &lt;span class=&quot;hljs-comment&quot;&gt;// Double checking Singleton instance&lt;/span&gt;\n                 &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(INSTANCE == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n                     INSTANCE = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;DoubleCheckedLockingSingleton&lt;/span&gt;();\n                 }\n             }\n          }\n          &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n      }\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;Static factory method&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt; &lt;span class=&quot;hljs-comment&quot;&gt;/**\n * Singleton pattern example with static factory method\n */&lt;/span&gt;\n\n &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt; {\n     &lt;span class=&quot;hljs-comment&quot;&gt;// Initialized during class loading&lt;/span&gt;\n     &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Singleton&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt;();\n\n     &lt;span class=&quot;hljs-comment&quot;&gt;// To prevent creating another instance of &apos;Singleton&apos;&lt;/span&gt;\n     &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Singleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {}\n\n     &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Singleton &lt;span class=&quot;hljs-title function_&quot;&gt;getSingleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n         &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n     }\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n    ","\n&lt;p&gt;There is a lot of nuance around implementing a singleton. The holder pattern can not be used in many situations. And IMO when using a volatile - you should also use a local variable. Let&apos;s start at the beginning and iterate on the problem. You&apos;ll see what I mean.&lt;/p&gt;\n&lt;hr&gt;\n&lt;p&gt;The first attempt might look something like this:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MySingleton&lt;/span&gt; {\n\n     &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; MySingleton INSTANCE;\n\n     &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; MySingleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n            INSTANCE = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MySingleton&lt;/span&gt;();\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n    }\n    ...\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Here we have the MySingleton class which has a private static member called &lt;em&gt;INSTANCE&lt;/em&gt;, and a public static method called getInstance(). The first time getInstance() is called, the &lt;em&gt;INSTANCE&lt;/em&gt; member is null. The flow will then fall into the creation condition and create a new instance of the MySingleton class. Subsequent calls to getInstance() will find that the &lt;em&gt;INSTANCE&lt;/em&gt; variable is already set, and therefore not create another MySingleton instance. This ensures there is only one instance of MySingleton which is shared among all callers of getInstance().&lt;/p&gt;\n&lt;p&gt;But this implementation has a problem. Multi-threaded applications will have a race condition on the creation of the single instance. If multiple threads of execution hit the getInstance() method at (or around) the same time, they will each see the &lt;em&gt;INSTANCE&lt;/em&gt; member as null. This will result in each thread creating a new MySingleton instance and subsequently setting the &lt;em&gt;INSTANCE&lt;/em&gt; member.&lt;/p&gt;\n&lt;hr&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; MySingleton INSTANCE;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt; MySingleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n        INSTANCE = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MySingleton&lt;/span&gt;();\n    }\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Here weve used the synchronized keyword in the method signature to synchronize the getInstance() method. This will certainly fix our race condition. Threads will now block and enter the method one at a time. But it also creates a performance problem. Not only does this implementation synchronize the creation of the single instance; it synchronizes all calls to getInstance(), including reads. Reads do not need to be synchronized as they simply return the value of &lt;em&gt;INSTANCE&lt;/em&gt;. Since reads will make up the bulk of our calls (remember, instantiation only happens on the first call), we will incur an unnecessary performance hit by synchronizing the entire method.&lt;/p&gt;\n&lt;hr&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; MySingleton INSTANCE;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; MySingleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n        synchronize(MySingleton.class) {\n            INSTANCE = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MySingleton&lt;/span&gt;();\n        }\n    }\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Here weve moved synchronization from the method signature, to a synchronized block that wraps the creation of the MySingleton instance. But does this solve our problem? Well, we are no longer blocking on reads, but weve also taken a step backward. Multiple threads will hit the getInstance() method at or around the same time and they will all see the &lt;em&gt;INSTANCE&lt;/em&gt; member as null.&lt;/p&gt;\n&lt;p&gt;They will then hit the synchronized block where one will obtain the lock and create the instance. When that thread exits the block, the other threads will contend for the lock, and one by one each thread will fall through the block and create a new instance of our class. So we are right back where we started.&lt;/p&gt;\n&lt;hr&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; MySingleton INSTANCE;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; MySingleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt;(MySingleton.class) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n                INSTANCE = createInstance();\n            }\n        }\n    }\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Here we issue another check from &lt;em&gt;inside&lt;/em&gt; the block. If the &lt;em&gt;INSTANCE&lt;/em&gt; member has already been set, well skip initialization. This is called double-checked locking.&lt;/p&gt;\n&lt;p&gt;This solves our problem of multiple instantiation. But once again, our solution has presented another challenge. Other threads might not see that the &lt;em&gt;INSTANCE&lt;/em&gt; member has been updated. This is because of how Java optimizes memory operations.&lt;/p&gt;\n&lt;p&gt;Threads copy the original values of variables from main memory into the CPUs cache. Changes to values are then written to, and read from, that cache. This is a feature of Java designed to optimize performance. But this creates a problem for our singleton implementation. A second threadbeing processed by a different CPU or core, using a different cachewill not see the changes made by the first. This will cause the second thread to see the &lt;em&gt;INSTANCE&lt;/em&gt; member as null forcing a new instance of our singleton to be created.&lt;/p&gt;\n&lt;hr&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;volatile&lt;/span&gt; MySingleton INSTANCE;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; MySingleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt;(MySingleton.class) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n                INSTANCE = createInstance();\n            }\n        }\n    }\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;We solve this by using the &lt;em&gt;volatile&lt;/em&gt; keyword on the declaration of the &lt;em&gt;INSTANCE&lt;/em&gt; member. This will tell the compiler to always read from, and write to, main memory, and not the CPU cache.&lt;/p&gt;\n&lt;p&gt;But this simple change comes at a cost. Because we are bypassing the CPU cache, we will take a performance hit each time we operate on the volatile &lt;em&gt;INSTANCE&lt;/em&gt; memberwhich we do four times. We double-check existence (1 and 2), set the value (3), and then return the value (4). One could argue that this path is the fringe case as we only create the instance during the first call of the method. Perhaps a performance hit on creation is tolerable. But even our main use-case, reads, will operate on the volatile member twice. Once to check existence, and again to return its value.&lt;/p&gt;\n&lt;hr&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;volatile&lt;/span&gt; MySingleton INSTANCE;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; MySingleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n    &lt;span class=&quot;hljs-type&quot;&gt;MySingleton&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; INSTANCE;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (result == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt;(MySingleton.class) {\n            result = INSTANCE;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (result == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n                INSTANCE = result = createInstance();\n            }\n        }\n    }\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; result;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Since the performance hit is due to operating directly on the volatile member, lets set a local variable to the value of the volatile and operate on the local variable instead. This will decrease the number of times we operate on the volatile, thereby reclaiming some of our lost performance. Note that we have to set our local variable again when we enter the synchronized block. This ensures it is up to date with any changes that occurred while we were waiting for the lock.&lt;/p&gt;\n&lt;p&gt;I wrote an article about this recently. &lt;a href=&quot;https://medium.com/@michael.andrews/deconstructing-the-singleton-b5f881f85f5&quot; rel=&quot;noreferrer&quot;&gt;Deconstructing The Singleton&lt;/a&gt;. You can find more information on these examples and an example of the &quot;holder&quot; pattern there. There is also a real-world example showcasing the double-checked volatile approach.&lt;/p&gt;\n    ","\n&lt;p&gt;I use the &lt;a href=&quot;https://en.wikipedia.org/wiki/Spring_Framework&quot; rel=&quot;nofollow noreferrer&quot;&gt;Spring Framework&lt;/a&gt; to manage my singletons.&lt;/p&gt;\n&lt;p&gt;It doesn&apos;t enforce the &quot;singleton-ness&quot; of the class (which you can&apos;t really do anyway if there are multiple class loaders involved), but it provides a really easy way to build and configure different factories for creating different types of objects.&lt;/p&gt;\n    ","\n&lt;p&gt;Wikipedia has some &lt;a href=&quot;http://en.wikipedia.org/wiki/Singleton_pattern&quot; rel=&quot;noreferrer&quot;&gt;examples&lt;/a&gt; of singletons, also in Java. The Java 5 implementation looks pretty complete, and is thread-safe (double-checked locking applied).&lt;/p&gt;\n    ","\n&lt;p&gt;&lt;strong&gt;Version 1:&lt;/strong&gt;&lt;/p&gt;\n\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MySingleton&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;MySingleton&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;instance&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;MySingleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {}\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt; MySingleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(instance == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n            instance = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MySingleton&lt;/span&gt;();\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; instance;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Lazy loading, thread safe with blocking, low performance because of &lt;code&gt;synchronized&lt;/code&gt;.&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;Version 2:&lt;/strong&gt;&lt;/p&gt;\n\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MySingleton&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;MySingleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {}\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MySingletonHolder&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;MySingleton&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;instance&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MySingleton&lt;/span&gt;();\n    }\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; MySingleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; MySingletonHolder.instance;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Lazy loading, thread safe with non-blocking, high performance.&lt;/p&gt;\n    ","\n&lt;p&gt;If you do not need lazy loading then simply try:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Singleton&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt;();\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Singleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {}\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Singleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; { &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; Singleton.INSTANCE; }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; Object &lt;span class=&quot;hljs-title function_&quot;&gt;clone&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;CloneNotSupportedException&lt;/span&gt;();\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;If you want lazy loading and you want your singleton to be thread-safe, try the double-checking pattern:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Singleton&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;instance&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Singleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {}\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Singleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt; == instance) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt;(Singleton.class) {\n                &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt; == instance) {\n                    instance = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt;();\n                }\n            }\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; instance;\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; Object &lt;span class=&quot;hljs-title function_&quot;&gt;clone&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;CloneNotSupportedException&lt;/span&gt;();\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;As the double checking pattern is not guaranteed to work (due to some issue with compilers, I don&apos;t know anything more about that), you could also try to synchronize the whole getInstance-method or create a registry for all your singletons.&lt;/p&gt;\n    ","\n&lt;p&gt;I would say an enum singleton.&lt;/p&gt;\n&lt;p&gt;Singleton using an enum in Java is generally a way to declare an enum singleton. An enum singleton may contain instance variables and instance methods. For simplicity&apos;s sake, also note that if you are using any instance method then you need to ensure thread safety of that method if at all it affects the state of object.&lt;/p&gt;\n&lt;p&gt;The use of an enum is very easy to implement and has no drawbacks regarding serializable objects, which have to be circumvented in the other ways.&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;/**\n* Singleton pattern example using a Java Enum\n*/&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt; {\n    INSTANCE;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;execute&lt;/span&gt; &lt;span class=&quot;hljs-params&quot;&gt;(String arg)&lt;/span&gt; {\n        &lt;span class=&quot;hljs-comment&quot;&gt;// Perform operation here&lt;/span&gt;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;You can access it by &lt;code&gt;Singleton.INSTANCE&lt;/code&gt;, and it is much easier than calling the &lt;code&gt;getInstance()&lt;/code&gt; method on Singleton.&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;1.12    Serialization of Enum Constants&lt;/p&gt;\n&lt;p&gt;Enum constants are serialized differently than ordinary serializable or externalizable objects. The serialized form of an enum constant consists solely of its name; field values of the constant are not present in the form. To serialize an enum constant, &lt;code&gt;ObjectOutputStream&lt;/code&gt; writes the value returned by the enum constant&apos;s name method. To deserialize an enum constant, &lt;code&gt;ObjectInputStream&lt;/code&gt; reads the constant name from the stream; the deserialized constant is then obtained by calling the &lt;code&gt;java.lang.Enum.valueOf&lt;/code&gt; method, passing the constant&apos;s enum type along with the received constant name as arguments. Like other serializable or externalizable objects, enum constants can function as the targets of back references appearing subsequently in the serialization stream.&lt;/p&gt;\n&lt;p&gt;The process by which enum constants are serialized cannot be customized: any class-specific &lt;code&gt;writeObject&lt;/code&gt;, &lt;code&gt;readObject&lt;/code&gt;, &lt;code&gt;readObjectNoData&lt;/code&gt;, &lt;code&gt;writeReplace&lt;/code&gt;, and &lt;code&gt;readResolve&lt;/code&gt; methods defined by enum types are ignored during serialization and deserialization. Similarly, any &lt;code&gt;serialPersistentFields&lt;/code&gt; or &lt;code&gt;serialVersionUID&lt;/code&gt; field declarations are also ignored--all enum types have a fixed &lt;code&gt;serialVersionUID&lt;/code&gt; of &lt;code&gt;0L&lt;/code&gt;. Documenting serializable fields and data for enum types is unnecessary, since there is no variation in the type of data sent.&lt;/p&gt;\n&lt;p&gt;&lt;a href=&quot;http://docs.oracle.com/javase/1.5.0/docs/guide/serialization/spec/serial-arch.html#enum&quot; rel=&quot;nofollow noreferrer&quot;&gt;Quoted from Oracle documentation&lt;/a&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;Another problem with conventional Singletons are that once you implement the &lt;code&gt;Serializable&lt;/code&gt; interface, they no longer remain singleton because the &lt;code&gt;readObject()&lt;/code&gt; method always return a new instance, like a constructor in Java. This can be avoided by using &lt;code&gt;readResolve()&lt;/code&gt; and discarding the newly created instance by replacing with a singleton like below:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt; &lt;span class=&quot;hljs-comment&quot;&gt;// readResolve to prevent another instance of Singleton&lt;/span&gt;\n &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; Object &lt;span class=&quot;hljs-title function_&quot;&gt;readResolve&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;{\n     &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;This can become even more complex if your &lt;em&gt;singleton class&lt;/em&gt; maintains state, as you need to make them transient, but with in an enum singleton, serialization is guaranteed by the JVM.&lt;/p&gt;\n&lt;hr&gt;\n&lt;p&gt;&lt;strong&gt;Good Read&lt;/strong&gt;&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;a href=&quot;http://www.oodesign.com/singleton-pattern.html&quot; rel=&quot;nofollow noreferrer&quot;&gt;Singleton Pattern&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/13219678/enums-singletons-and-deserialization&quot;&gt;Enums, Singletons and Deserialization&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;http://www.ibm.com/developerworks/java/library/j-dcl/index.html&quot; rel=&quot;nofollow noreferrer&quot;&gt;Double-checked locking and the Singleton pattern&lt;/a&gt;&lt;/li&gt;\n&lt;/ol&gt;\n    ","\n&lt;p&gt;There are four ways to create a singleton in Java.&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;p&gt;Eager initialization singleton&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Test&lt;/span&gt; {\n     &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Test&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Test&lt;/span&gt;();\n\n     &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Test&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n     }\n\n     &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Test &lt;span class=&quot;hljs-title function_&quot;&gt;getTest&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n         &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; test;\n     }\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;Lazy initialization singleton (thread safe)&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Test&lt;/span&gt; {\n      &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;volatile&lt;/span&gt; Test test;\n\n      &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Test&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n      }\n\n      &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Test &lt;span class=&quot;hljs-title function_&quot;&gt;getTest&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n         &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(test == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n             &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt;(Test.class) {\n                 &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(test == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n                     test = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Test&lt;/span&gt;();\n                 }\n             }\n         }\n         &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; test;\n     }\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;Bill Pugh singleton with holder pattern (preferably the best one)&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Test&lt;/span&gt; {\n\n     &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Test&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n     }\n\n     &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;TestHolder&lt;/span&gt; {\n         &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Test&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Test&lt;/span&gt;();\n     }\n\n     &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Test &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n         &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; TestHolder.test;\n     }\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;Enum singleton&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MySingleton&lt;/span&gt; {\n     INSTANCE;\n\n     &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;MySingleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n         System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Here&quot;&lt;/span&gt;);\n     }\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n    ","\n&lt;p&gt;This is how to implement a simple &lt;a href=&quot;https://en.wikipedia.org/wiki/Singleton_pattern&quot; rel=&quot;nofollow noreferrer&quot;&gt;singleton&lt;/a&gt;:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt; {\n    &lt;span class=&quot;hljs-comment&quot;&gt;// It must be static and final to prevent later modification&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Singleton&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt;();\n    &lt;span class=&quot;hljs-comment&quot;&gt;/** The constructor must be private to prevent external instantiation */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Singleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;{}\n    &lt;span class=&quot;hljs-comment&quot;&gt;/** The public static method allowing to get the instance */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Singleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;This is how to properly lazy create your singleton:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt; {\n    &lt;span class=&quot;hljs-comment&quot;&gt;// The constructor must be private to prevent external instantiation&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Singleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;{}\n    &lt;span class=&quot;hljs-comment&quot;&gt;/** The public static method allowing to get the instance */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Singleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; SingletonHolder.INSTANCE;\n    }\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * The static inner class responsible for creating your instance only on demand,\n     * because the static fields of a class are only initialized when the class\n     * is explicitly called and a class initialization is synchronized such that only\n     * one thread can perform it, this rule is also applicable to inner static class\n     * So here INSTANCE will be created only when SingletonHolder.INSTANCE\n     * will be called\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;SingletonHolder&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Singleton&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt;();\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;You need the &lt;a href=&quot;http://en.wikipedia.org/wiki/Double-checked_locking&quot; rel=&quot;nofollow noreferrer&quot;&gt;double-checking&lt;/a&gt; idiom if you need to load the instance variable of a class lazily. If you need to load a static variable or a singleton lazily, you need the &lt;a href=&quot;http://en.wikipedia.org/wiki/Initialization_on_demand_holder_idiom&quot; rel=&quot;nofollow noreferrer&quot;&gt;initialization on demand holder&lt;/a&gt; idiom.&lt;/p&gt;\n&lt;p&gt;In addition, if the singleton needs to be serializable, all other fields need to be transient and readResolve() method needs to be implemented in order to maintain the singleton object invariant. Otherwise, each time the object is deserialized, a new instance of the object will be created. What readResolve() does is replace the new object read by readObject(), which forced that new object to be garbage collected as there is no variable referring to it.&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;= ....\n&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; Object &lt;span class=&quot;hljs-title function_&quot;&gt;readResolve&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n  &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE; &lt;span class=&quot;hljs-comment&quot;&gt;// Original singleton instance.&lt;/span&gt;\n} \n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Various ways to make a singleton object:&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;p&gt;As per &lt;a href=&quot;https://en.wikipedia.org/wiki/Joshua_Bloch&quot; rel=&quot;nofollow noreferrer&quot;&gt;Joshua Bloch&lt;/a&gt; - Enum would be the best.&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;You can use double check locking also.&lt;/p&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;Even an inner static class can be used.&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n    ","\n&lt;p&gt;&lt;strong&gt;Enum singleton&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;The simplest way to implement a singleton that is thread-safe is using an Enum:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;SingletonEnum&lt;/span&gt; {\n  INSTANCE;\n  &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;doSomething&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;{\n    System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;This is a singleton&quot;&lt;/span&gt;);\n  }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;This code works since the introduction of Enum in Java 1.5&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;Double checked locking&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;If you want to code a classic singleton that works in a multithreaded environment (starting from Java 1.5) you should use this one.&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt; {\n\n  &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Singleton&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;instance&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n\n  &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Singleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n  }\n\n  &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Singleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (instance == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n      &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt; (Singleton.class){\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (instance == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n          instance = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt;();\n        }\n      }\n    }\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; instance;\n  }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;This is not thread-safe before 1.5 because the implementation of the volatile keyword was different.&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;Early loading singleton (works even before Java 1.5)&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;This implementation instantiates the singleton when the class is loaded and provides thread safety.&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt; {\n\n  &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Singleton&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;instance&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt;();\n\n  &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Singleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n  }\n\n  &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Singleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; instance;\n  }\n\n  &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;doSomething&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;{\n    System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;This is a singleton&quot;&lt;/span&gt;);\n  }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;For JSE 5.0 and above, take the Enum approach. Otherwise, use the static singleton holder approach ((a lazy loading approach described by Bill Pugh). The latter solution is also thread-safe without requiring special language constructs (i.e., volatile or synchronized).&lt;/p&gt;\n    ","\n&lt;p&gt;Another argument often used against singletons is their testability problems. Singletons are not easily mockable for testing purposes. If this turns out to be a problem, I like to make the following slight modification:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;SingletonImpl&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; SingletonImpl instance;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; SingletonImpl &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (instance == &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n            instance = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;SingletonImpl&lt;/span&gt;();\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; instance;\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;setInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(SingletonImpl impl)&lt;/span&gt; {\n        instance = impl;\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Default Method&quot;&lt;/span&gt;);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;The added &lt;code&gt;setInstance&lt;/code&gt; method allows setting a mockup implementation of the singleton class during testing:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;SingletonMock&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;SingletonImpl&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Mock Method&quot;&lt;/span&gt;);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;This also works with early initialization approaches:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;SingletonImpl&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;SingletonImpl&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;instance&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;SingletonImpl&lt;/span&gt;();\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; SingletonImpl alt;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;setInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(SingletonImpl inst)&lt;/span&gt; {\n        alt = inst;\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; SingletonImpl &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (alt != &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; alt;\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; instance;\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Default Method&quot;&lt;/span&gt;);\n    }\n}\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;SingletonMock&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;SingletonImpl&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Mock Method&quot;&lt;/span&gt;);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;This has the drawback of exposing this functionality to the normal application too. Other developers working on that code could be tempted to use the setInstance method to alter a specific function and thus changing the whole application behaviour, and therefore this method should contain at least a good warning in its javadoc.&lt;/p&gt;\n&lt;p&gt;Still, for the possibility of mockup-testing (when needed), this code exposure may be an acceptable price to pay.&lt;/p&gt;\n    ","\n&lt;p&gt;Simplest singleton class:&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt; {\n  &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Singleton&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;singleInstance&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt;();\n  &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Singleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {}\n  &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Singleton &lt;span class=&quot;hljs-title function_&quot;&gt;getSingleInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; singleInstance;\n  }\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Have a look at this post.&lt;/p&gt;\n&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/1673841/examples-of-gof-design-patterns-in-javas-core-libraries&quot;&gt;Examples of GoF Design Patterns in Java&apos;s core libraries&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;From the best answer&apos;s &quot;Singleton&quot; section,&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;h3&gt;Singleton (recognizeable by creational methods returning the same instance (usually of itself) everytime)&lt;/h3&gt;\n&lt;ul&gt;\n&lt;li&gt;java.lang.Runtime#getRuntime()&lt;/li&gt;\n&lt;li&gt;java.awt.Desktop#getDesktop()&lt;/li&gt;\n&lt;li&gt;java.lang.System#getSecurityManager()&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;You can also learn the example of Singleton from Java native classes themselves.&lt;/p&gt;\n    ","\n&lt;p&gt;The best singleton pattern I&apos;ve ever seen uses the Supplier interface.&lt;/p&gt;\n\n&lt;ul&gt;\n&lt;li&gt;It&apos;s generic and reusable&lt;/li&gt;\n&lt;li&gt;It supports lazy initialization&lt;/li&gt;\n&lt;li&gt;It&apos;s only synchronized until it has been initialized, then the blocking supplier is replaced with a non-blocking supplier.&lt;/li&gt;\n&lt;/ul&gt;\n\n&lt;p&gt;See below:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt;&amp;lt;T&amp;gt; &lt;span class=&quot;hljs-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Supplier&lt;/span&gt;&amp;lt;T&amp;gt; {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;boolean&lt;/span&gt; initialized;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; Supplier&amp;lt;T&amp;gt; singletonSupplier;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Singleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(T singletonValue)&lt;/span&gt; {\n        &lt;span class=&quot;hljs-built_in&quot;&gt;this&lt;/span&gt;.singletonSupplier = () -&amp;gt; singletonValue;\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Singleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(Supplier&amp;lt;T&amp;gt; supplier)&lt;/span&gt; {\n        &lt;span class=&quot;hljs-built_in&quot;&gt;this&lt;/span&gt;.singletonSupplier = () -&amp;gt; {\n            &lt;span class=&quot;hljs-comment&quot;&gt;// The initial supplier is temporary; it will be replaced after initialization&lt;/span&gt;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt; (supplier) {\n                &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!initialized) {\n                    &lt;span class=&quot;hljs-type&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;singletonValue&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; supplier.get();\n                    &lt;span class=&quot;hljs-comment&quot;&gt;// Now that the singleton value has been initialized,&lt;/span&gt;\n                    &lt;span class=&quot;hljs-comment&quot;&gt;// replace the blocking supplier with a non-blocking supplier&lt;/span&gt;\n                    singletonSupplier = () -&amp;gt; singletonValue;\n                    initialized = &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\n                }\n                &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; singletonSupplier.get();\n            }\n        };\n    }\n\n    &lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; T &lt;span class=&quot;hljs-title function_&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; singletonSupplier.get();\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;I still think after Java 1.5, enum is the best available singleton implementation available as it also ensures that, even in the multi threaded environments, only one instance is created.&lt;/p&gt;\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt; {\n    INSTANCE;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;And you are done!&lt;/p&gt;\n    ","\n&lt;p&gt;Sometimes a simple &quot;&lt;strong&gt;&lt;code&gt;static Foo foo = new Foo();&lt;/code&gt;&lt;/strong&gt;&quot; is not enough. Just think of some basic data insertion you want to do.&lt;/p&gt;\n\n&lt;p&gt;On the other hand you would have to synchronize any method that instantiates the singleton variable as such. Synchronisation is not bad as such, but it can lead to performance issues or locking (in very very rare situations using this example. The solution is&lt;/p&gt;\n\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Singleton&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;instance&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; {\n          instance = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt;();\n          &lt;span class=&quot;hljs-comment&quot;&gt;// do some of your instantiation stuff here&lt;/span&gt;\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Singleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n          &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(instance!=&lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;) {\n                  &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;ErrorYouWant&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Singleton double-instantiation, should never happen!&quot;&lt;/span&gt;);\n          }\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;getSingleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n          &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; instance;\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Now what happens? The class is loaded via the class loader. Directly after the class was interpreted from a byte Array, the VM executes the &lt;strong&gt;static { }&lt;/strong&gt; - block. that&apos;s the whole secret: The static-block is only called once, the time the given class (name) of the given package is loaded by this one class loader.&lt;/p&gt;\n    ","\n&lt;pre class=&quot;lang-java s-code-block&quot;&gt;&lt;code class=&quot;hljs language-java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt; {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;Singleton&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;INSTANCE&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Singleton&lt;/span&gt;();\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;Singleton&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (INSTANCE != &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;)\n            &lt;span class=&quot;hljs-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;IllegalStateException&lt;/span&gt;(Already instantiated...);\n        }\n\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; Singleton &lt;span class=&quot;hljs-title function_&quot;&gt;getInstance&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; INSTANCE;\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;As we have added the Synchronized keyword before getInstance, we have avoided the race condition in the case when two threads call the getInstance at the same time.&lt;/p&gt;\n    "],"435":["\n&lt;h2&gt;Summary of answers and other data: (please add yours)&lt;/h2&gt;\n&lt;p&gt;&lt;strong&gt;Do:&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;Whenever you are referring to an exact moment in time, persist the time according to a unified standard that is not affected by daylight savings. (GMT and UTC are equivalent with this regard, but it is preferred to use the term UTC. Notice that UTC is also known as &lt;em&gt;Zulu&lt;/em&gt; or &lt;em&gt;Z&lt;/em&gt; time.)&lt;/li&gt;\n&lt;li&gt;If instead you choose to persist a (past) time using a local time value, include the local time offset for this particular time from UTC (this offset may change throughout the year), such that the timestamp can later be interpreted unambiguously.&lt;/li&gt;\n&lt;li&gt;In some cases, you may need to store &lt;em&gt;both&lt;/em&gt; the UTC time and the equivalent local time.  Often this is done with two separate fields, but some platforms support a &lt;code&gt;datetimeoffset&lt;/code&gt; type that can store both in a single field.&lt;/li&gt;\n&lt;li&gt;When storing timestamps as a numeric value, use &lt;a href=&quot;http://en.wikipedia.org/wiki/Unix_time&quot; rel=&quot;noreferrer&quot;&gt;Unix time&lt;/a&gt; - which is the number of whole seconds since &lt;code&gt;1970-01-01T00:00:00Z&lt;/code&gt; (excluding leap seconds).  If you require higher precision, use milliseconds instead.  This value should always be based on UTC, without any time zone adjustment.&lt;/li&gt;\n&lt;li&gt;If you might later need to modify the timestamp, include the original time zone ID so you can determine if the offset may have changed from the original value recorded.&lt;/li&gt;\n&lt;li&gt;When scheduling future events, usually local time is preferred instead of UTC, as it is common for the offset to change.  &lt;a href=&quot;https://stackoverflow.com/a/19627330/634824&quot;&gt;See answer&lt;/a&gt;, and &lt;a href=&quot;http://www.creativedeletion.com/2015/03/19/persisting_future_datetimes.html&quot; rel=&quot;noreferrer&quot;&gt;blog post&lt;/a&gt;.&lt;/li&gt;\n&lt;li&gt;When storing whole dates, such as birthdays and anniversaries, do not convert to UTC or any other time zone.\n&lt;ul&gt;\n&lt;li&gt;When possible, store in a date-only data type that does not include a time of day.&lt;/li&gt;\n&lt;li&gt;If such a type is not available, be sure to always ignore the time-of-day when interpreting the value.  If you cannot be assured that the time-of-day will be ignored, choose 12:00 Noon, rather than 00:00 Midnight as a more safe representative time on that day.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;Remember that time zone offsets are not always an integer number of hours (for example, Indian Standard Time is UTC+05:30, and Nepal uses UTC+05:45).&lt;/li&gt;\n&lt;li&gt;If using Java, use &lt;a href=&quot;http://docs.oracle.com/javase/8/docs/api/java/time/package-summary.html&quot; rel=&quot;noreferrer&quot;&gt;&lt;em&gt;java.time&lt;/em&gt;&lt;/a&gt; for Java 8 and later.&lt;/li&gt;\n&lt;li&gt;Much of that &lt;em&gt;java.time&lt;/em&gt; functionality is back-ported to Java 6 &amp;amp; 7 in the &lt;a href=&quot;https://www.threeten.org/threetenbp/&quot; rel=&quot;noreferrer&quot;&gt;&lt;em&gt;ThreeTen-Backport&lt;/em&gt;&lt;/a&gt; library.&lt;/li&gt;\n&lt;li&gt;Further adapted for early Android (&amp;lt; 26) in the &lt;a href=&quot;https://github.com/JakeWharton/ThreeTenABP&quot; rel=&quot;noreferrer&quot;&gt;&lt;em&gt;ThreeTenABP&lt;/em&gt;&lt;/a&gt; library.&lt;/li&gt;\n&lt;li&gt;These projects officially supplant the venerable &lt;a href=&quot;https://www.joda.org/joda-time/&quot; rel=&quot;noreferrer&quot;&gt;Joda-Time&lt;/a&gt;, now in &lt;a href=&quot;https://en.wikipedia.org/wiki/Maintenance_mode&quot; rel=&quot;noreferrer&quot;&gt;maintenance-mode&lt;/a&gt;. Joda-Time, ThreeTen-Backport, &lt;a href=&quot;https://www.threeten.org/threeten-extra/&quot; rel=&quot;noreferrer&quot;&gt;ThreeTen-Extra&lt;/a&gt;, &lt;em&gt;java.time&lt;/em&gt; classes, and &lt;a href=&quot;https://jcp.org/en/jsr/detail?id=310&quot; rel=&quot;noreferrer&quot;&gt;JSR 310&lt;/a&gt; are led by the same man, &lt;a href=&quot;https://stackoverflow.com/users/38896/jodastephen&quot;&gt;Stephen Colebourne&lt;/a&gt;.&lt;/li&gt;\n&lt;li&gt;If using &lt;a href=&quot;http://en.wikipedia.org/wiki/.NET_Framework&quot; rel=&quot;noreferrer&quot;&gt;.NET&lt;/a&gt;, consider using &lt;a href=&quot;http://nodatime.org&quot; rel=&quot;noreferrer&quot;&gt;Noda Time&lt;/a&gt;.&lt;/li&gt;\n&lt;li&gt;If using .NET without Noda Time, consider that &lt;code&gt;DateTimeOffset&lt;/code&gt; is often a better choice than &lt;code&gt;DateTime&lt;/code&gt;.&lt;/li&gt;\n&lt;li&gt;If using Perl, use &lt;a href=&quot;https://metacpan.org/module/DateTime&quot; rel=&quot;noreferrer&quot;&gt;DateTime&lt;/a&gt;.&lt;/li&gt;\n&lt;li&gt;If using Python 3.9 or later, use the built-in &lt;a href=&quot;https://docs.python.org/3/library/zoneinfo.html&quot; rel=&quot;noreferrer&quot;&gt;zoneinfo&lt;/a&gt; for working with time zones.  Otherwise, use &lt;a href=&quot;https://dateutil.readthedocs.org/en/latest/&quot; rel=&quot;noreferrer&quot;&gt;dateutil&lt;/a&gt; or &lt;a href=&quot;https://arrow.readthedocs.io&quot; rel=&quot;noreferrer&quot;&gt;arrow&lt;/a&gt;.  The older &lt;a href=&quot;http://pytz.sourceforge.net/&quot; rel=&quot;noreferrer&quot;&gt;pytz&lt;/a&gt; library can generally be avoided.&lt;/li&gt;\n&lt;li&gt;If using JavaScript, avoid using the older &lt;a href=&quot;http://momentjs.com/&quot; rel=&quot;noreferrer&quot;&gt;moment.js&lt;/a&gt; or &lt;a href=&quot;http://momentjs.com/timezone/&quot; rel=&quot;noreferrer&quot;&gt;moment-timezone&lt;/a&gt; libraries, as they are no longer actively maintained.  See the &lt;a href=&quot;https://momentjs.com/docs/#/-project-status/&quot; rel=&quot;noreferrer&quot;&gt;Moment.js project status&lt;/a&gt; for more details.  Instead, consider &lt;a href=&quot;https://moment.github.io/luxon/#/&quot; rel=&quot;noreferrer&quot;&gt;Luxon&lt;/a&gt;, &lt;a href=&quot;https://date-fns.org/&quot; rel=&quot;noreferrer&quot;&gt;date-fns&lt;/a&gt;, &lt;a href=&quot;https://day.js.org/&quot; rel=&quot;noreferrer&quot;&gt;day.js&lt;/a&gt;, or &lt;a href=&quot;https://js-joda.github.io/js-joda/&quot; rel=&quot;noreferrer&quot;&gt;js-joda&lt;/a&gt;.&lt;/li&gt;\n&lt;li&gt;If using PHP &amp;gt; 5.2, use the native time zones conversions provided by &lt;code&gt;DateTime&lt;/code&gt;, and &lt;code&gt;DateTimeZone&lt;/code&gt; classes. Be careful when using &lt;code&gt;DateTimeZone::listAbbreviations()&lt;/code&gt; - &lt;a href=&quot;https://stackoverflow.com/questions/2532729/daylight-saving-time-and-time-zone-best-practices/21198159#21198159&quot;&gt;see answer&lt;/a&gt;. To keep PHP with up to date Olson data, install periodically &lt;a href=&quot;http://pecl.php.net/package/timezonedb&quot; rel=&quot;noreferrer&quot;&gt;the timezonedb&lt;/a&gt; PECL package; &lt;a href=&quot;https://stackoverflow.com/questions/2532729/daylight-saving-time-and-timezone-best-practices/7338519#7338519&quot;&gt;see answer&lt;/a&gt;.&lt;/li&gt;\n&lt;li&gt;If using C++, be sure to use a library that uses the properly implements the &lt;a href=&quot;http://www.iana.org/time-zones&quot; rel=&quot;noreferrer&quot;&gt;IANA timezone database&lt;/a&gt;.  These include &lt;a href=&quot;https://github.com/google/cctz&quot; rel=&quot;noreferrer&quot;&gt;cctz&lt;/a&gt;, &lt;a href=&quot;http://site.icu-project.org/&quot; rel=&quot;noreferrer&quot;&gt;ICU&lt;/a&gt;, and &lt;a href=&quot;http://howardhinnant.github.io/date/tz.html&quot; rel=&quot;noreferrer&quot;&gt;Howard Hinnant&apos;s &quot;tz&quot; library&lt;/a&gt;.  In C++20 the latter is adopted into the standard &lt;code&gt;&amp;lt;chrono&amp;gt;&lt;/code&gt; library.\n&lt;ul&gt;\n&lt;li&gt;Do not use &lt;a href=&quot;http://www.boost.org/&quot; rel=&quot;noreferrer&quot;&gt;Boost&lt;/a&gt; for time zone conversions.  While &lt;a href=&quot;http://www.boost.org/doc/libs/1_44_0/doc/html/date_time/local_time.html#date_time.local_time.tz_database&quot; rel=&quot;noreferrer&quot;&gt;its API&lt;/a&gt; claims to support standard IANA (aka &quot;zoneinfo&quot;) identifiers, it &lt;a href=&quot;https://github.com/boost-vault/date_time/blob/master/date_time_zonespec.csv&quot; rel=&quot;noreferrer&quot;&gt;crudely maps them&lt;/a&gt; to POSIX-style data, without considering the rich history of changes each zone may have had.  (Also, the file has fallen out of maintenance.)&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;If using Rust, use &lt;a href=&quot;https://github.com/chronotope/chrono&quot; rel=&quot;noreferrer&quot;&gt;chrono&lt;/a&gt;.&lt;/li&gt;\n&lt;li&gt;Most business rules use civil time, rather than UTC or GMT.  Therefore, plan to convert UTC timestamps to a local time zone before applying application logic.&lt;/li&gt;\n&lt;li&gt;Remember that time zones and offsets are not fixed and may change. For instance, historically US and UK used the same dates to &apos;spring forward&apos; and &apos;fall back&apos;. However, in 2007 the US changed the dates that the clocks get changed on. This now means that for 48 weeks of the year the difference between London time and New York time is 5 hours and for 4 weeks (3 in the spring, 1 in the autumn) it is 4 hours. Be aware of items like this in any calculations that involve multiple zones.&lt;/li&gt;\n&lt;li&gt;Consider the type of time (actual event time, broadcast time, relative time, historical time, recurring time) what elements (timestamp, time zone offset and time zone name) you need to store for correct retrieval - see &quot;Types of Time&quot; in &lt;a href=&quot;https://stackoverflow.com/questions/2532729/daylight-saving-time-and-timezone-best-practices/3269325#3269325&quot;&gt;this answer&lt;/a&gt;.&lt;/li&gt;\n&lt;li&gt;Keep your OS, database and application tzdata files in sync, between themselves and the rest of the world.&lt;/li&gt;\n&lt;li&gt;On servers, set hardware clocks and OS clocks to UTC rather than a local time zone.&lt;/li&gt;\n&lt;li&gt;&lt;em&gt;Regardless of the previous bullet point,&lt;/em&gt; server-side code, including web sites, should &lt;em&gt;never&lt;/em&gt; expect the local time zone of the server to be anything in particular.  &lt;a href=&quot;https://stackoverflow.com/a/30897258/634824&quot;&gt;see answer&lt;/a&gt;.&lt;/li&gt;\n&lt;li&gt;Prefer working with time zones on a case-by-case basis in your application code, rather than globally through config file settings or defaults.&lt;/li&gt;\n&lt;li&gt;Use &lt;a href=&quot;http://en.wikipedia.org/wiki/Network_Time_Protocol&quot; rel=&quot;noreferrer&quot;&gt;NTP&lt;/a&gt; services on all servers.&lt;/li&gt;\n&lt;li&gt;If using &lt;a href=&quot;http://en.wikipedia.org/wiki/File_Allocation_Table#FAT32&quot; rel=&quot;noreferrer&quot;&gt;FAT32&lt;/a&gt;, remember that timestamps are stored in local time, not UTC.&lt;/li&gt;\n&lt;li&gt;When dealing with recurring events (weekly TV show, for example), remember that the time changes with DST and will be different across time zones.&lt;/li&gt;\n&lt;li&gt;Always query date-time values as &lt;a href=&quot;https://sqlblog.org/2011/10/19/what-do-between-and-the-devil-have-in-common&quot; rel=&quot;noreferrer&quot;&gt;lower-bound inclusive, upper-bound exclusive&lt;/a&gt; (&lt;code&gt;&amp;gt;=&lt;/code&gt;, &lt;code&gt;&amp;lt;&lt;/code&gt;).&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;strong&gt;Don&apos;t:&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;Do not confuse a &quot;time zone&quot;, such as &lt;code&gt;America/New_York&lt;/code&gt; with a &quot;time zone offset&quot;, such as &lt;code&gt;-05:00&lt;/code&gt;.  They are two different things.  See &lt;a href=&quot;https://stackoverflow.com/tags/timezone/info&quot;&gt;the timezone tag wiki&lt;/a&gt;.&lt;/li&gt;\n&lt;li&gt;Do not use JavaScript&apos;s &lt;code&gt;Date&lt;/code&gt; object to perform date and time calculations in older web browsers, as ECMAScript 5.1 and lower has &lt;a href=&quot;https://stackoverflow.com/a/16951442/634824&quot;&gt;a design flaw&lt;/a&gt; that may use daylight saving time incorrectly.  (This was fixed in ECMAScript 6 / 2015).&lt;/li&gt;\n&lt;li&gt;Never trust the client&apos;s clock. It may very well be incorrect.&lt;/li&gt;\n&lt;li&gt;Don&apos;t tell people to &quot;always use UTC everywhere&quot;.  This widespread advice is shortsighted of several valid scenarios that are described earlier in this document.  Instead, use the appropriate time reference for the data you are working with.  (&lt;em&gt;Timestamping&lt;/em&gt; can use UTC, but future time scheduling and date-only values should not.)&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;strong&gt;Testing:&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;When testing, make sure you test countries in the Western, Eastern, Northern and &lt;a href=&quot;https://www.betaarchive.com/wiki/index.php?title=Microsoft_KB_Archive/913551&quot; rel=&quot;noreferrer&quot;&gt;Southern&lt;/a&gt; hemispheres (in fact in each quarter of the globe, so 4 regions), with both DST in progress and not (gives 8), and a country that does not use DST (another 4 to cover all regions, making 12 in total).&lt;/li&gt;\n&lt;li&gt;Test transition of DST, i.e. when you are currently in summer time, select a time value from winter.&lt;/li&gt;\n&lt;li&gt;Test boundary cases, such as a timezone that is UTC+12, with DST, making the local time &lt;a href=&quot;http://en.wikipedia.org/wiki/UTC%2B13:00&quot; rel=&quot;noreferrer&quot;&gt;UTC+13 in summer and even places that are UTC+13 in winter&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;Test all third-party libraries and applications and make sure they handle time zone data correctly.&lt;/li&gt;\n&lt;li&gt;Test half-hour time zones, at least.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;strong&gt;Reference:&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/tags/timezone/info&quot;&gt;The detailed &lt;code&gt;timezone&lt;/code&gt; tag wiki page on Stack Overflow&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;http://www.iana.org/time-zones&quot; rel=&quot;noreferrer&quot;&gt;Olson database, aka Tz_database&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;https://datatracker.ietf.org/doc/html/draft-lear-iana-timezone-database-02.html&quot; rel=&quot;noreferrer&quot;&gt;IETF draft procedures for maintaining the Olson database&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;http://www.twinsun.com/tz/tz-link.htm&quot; rel=&quot;noreferrer&quot;&gt;Sources for Time Zone and DST&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/ISO_8601&quot; rel=&quot;noreferrer&quot;&gt;ISO format (ISO 8601)&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;http://www.unicode.org/cldr/charts/supplemental/zone_tzid.html&quot; rel=&quot;noreferrer&quot;&gt;Mapping between Olson database and Windows Time Zone Ids, from the Unicode Consortium&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Tz_database&quot; rel=&quot;noreferrer&quot;&gt;Time Zone page on Wikipedia&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/tagged/dst&quot;&gt;StackOverflow questions tagged &lt;code&gt;dst&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/tagged/timezone&quot;&gt;StackOverflow questions tagged &lt;code&gt;timezone&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ms973825.aspx#datetime_topic6&quot; rel=&quot;noreferrer&quot;&gt;Dealing with DST - Microsoft DateTime best practices&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Network_Time_Protocol&quot; rel=&quot;noreferrer&quot;&gt;Network Time Protocol on Wikipedia&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;&lt;strong&gt;Other:&lt;/strong&gt;&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;Lobby your representative to end the abomination that is DST. We can always hope...&lt;/li&gt;\n&lt;li&gt;Lobby for &lt;a href=&quot;http://xkcd.com/1061/&quot; rel=&quot;noreferrer&quot;&gt;Earth Standard Time&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n    ","\n&lt;p&gt;I&apos;m not sure what I can add to the answers above, but here are a few points from me:&lt;/p&gt;\n\n&lt;h2&gt;Types of times&lt;/h2&gt;\n\n&lt;p&gt;There are four different times you should consider:&lt;/p&gt;\n\n&lt;ol&gt;\n&lt;li&gt;Event time: eg, the time when an international sporting event happens, or a coronation/death/etc.  This is dependent on the timezone of the event and not of the viewer.&lt;/li&gt;\n&lt;li&gt;Television time: eg, a particular TV show is broadcast at 9pm local time all around the world.  Important when thinking about publishing the results (of say American Idol) on your website&lt;/li&gt;\n&lt;li&gt;Relative time: eg: This question has an open bounty closing in 21 hours.  This is easy to display&lt;/li&gt;\n&lt;li&gt;Recurring time: eg: A TV show is on every Monday at 9pm, even when DST changes.&lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;p&gt;There is also Historic/alternate time.  These are annoying because they may not map back to standard time.  Eg: Julian dates, dates according to a Lunar calendar on Saturn, The Klingon calendar.&lt;/p&gt;\n\n&lt;p&gt;Storing start/end timestamps in UTC works well.  For 1, you need an event timezone name + offset stored along with the event.  For 2, you need a local time identifier stored with each region and a local timezone name + offset stored for every viewer (it&apos;s possible to derive this from the IP if you&apos;re in a crunch).  For 3, store in UTC seconds and no need for timezones.  4 is a special case of 1 or 2 depending on whether it&apos;s a global or a local event, but you also need to store a &lt;em&gt;created at&lt;/em&gt; timestamp so you can tell if a timezone definition changed before or after this event was created.  This is necessary if you need to show historic data.&lt;/p&gt;\n\n&lt;h2&gt;Storing times&lt;/h2&gt;\n\n&lt;ul&gt;\n&lt;li&gt;Always store time in UTC&lt;/li&gt;\n&lt;li&gt;Convert to local time on display (local being defined by the user looking at the data)&lt;/li&gt;\n&lt;li&gt;When storing a timezone, you need the name, timestamp and the offset.  This is required because governments sometimes change the meanings of their timezones (eg: the US govt changed DST dates), and your application needs to handle things gracefully... eg: The exact timestamp when episodes of LOST showed both before and after DST rules changed.&lt;/li&gt;\n&lt;/ul&gt;\n\n&lt;h3&gt;Offsets and names&lt;/h3&gt;\n\n&lt;p&gt;An example of the above would be:&lt;/p&gt;\n\n&lt;blockquote&gt;\n  &lt;p&gt;The soccer world cup finals game\n  happened in South Africa (UTC+2--SAST)\n  on July 11, 2010 at 19:00 UTC.&lt;/p&gt;\n&lt;/blockquote&gt;\n\n&lt;p&gt;With this information, we can historically determine the exact time when the 2010 WCS finals took place even if the South African timezone definition changes, &lt;strong&gt;and&lt;/strong&gt; be able to display that to viewers in their local timezone at the time when they query the database.&lt;/p&gt;\n\n&lt;h2&gt;System Time&lt;/h2&gt;\n\n&lt;p&gt;You also need to keep your OS, database and application tzdata files in sync, both with each other, and with the rest of the world, and test extensively when you upgrade.  It&apos;s not unheard of that a third party app that you depend on did not handle a TZ change correctly.&lt;/p&gt;\n\n&lt;p&gt;Make sure hardware clocks are set to UTC, and if you&apos;re running servers around the world, make sure their OSes are configured to use UTC as well.  This becomes apparent when you need to copy hourly rotated apache log files from servers in multiple timezones.  Sorting them by filename only works if all files are named with the same timezone.  It also means that you don&apos;t have to do date math in your head when you ssh from one box to another and need to compare timestamps.&lt;/p&gt;\n\n&lt;p&gt;Also, run ntpd on all boxes.&lt;/p&gt;\n\n&lt;h2&gt;Clients&lt;/h2&gt;\n\n&lt;p&gt;Never trust the timestamp you get from a client machine as valid.  For example, the Date: HTTP headers, or a javascript &lt;code&gt;Date.getTime()&lt;/code&gt; call.  These are fine when used as opaque identifiers, or when doing date math during a single session on the same client, but don&apos;t try to cross-reference these values with something you have on the server.  Your clients don&apos;t run NTP, and may not necessarily have a working battery for their BIOS clock.&lt;/p&gt;\n\n&lt;h2&gt;Trivia&lt;/h2&gt;\n\n&lt;p&gt;Finally, governments will sometimes do very weird things:&lt;/p&gt;\n\n&lt;blockquote&gt;\n  &lt;p&gt;Standard time in the Netherlands was\n  exactly 19 minutes and 32.13 seconds\n  ahead of UTC by law from 1909-05-01\n  through 1937-06-30. This time zone\n  cannot be represented exactly using\n  the HH:MM format.&lt;/p&gt;\n&lt;/blockquote&gt;\n\n&lt;p&gt;Ok, I think I&apos;m done.&lt;/p&gt;\n    ","\n&lt;p&gt;This is an important and surprisingly tough issue. The truth is that there is no completely satisfying standard for persisting time. For example, the SQL standard and the ISO format (ISO 8601) are clearly not enough.&lt;/p&gt;\n\n&lt;p&gt;From the conceptual point of view, one usually deals with two types of time-date data, and it&apos;s convenient to distinguish them (the above standards do not) : &quot;&lt;strong&gt;physical time&lt;/strong&gt;&quot; and &quot;&lt;strong&gt;civil time&lt;/strong&gt;&quot;. &lt;/p&gt;\n\n&lt;p&gt;A &quot;physical&quot; instant of time is a point in the continuous universal timeline that physics deal with (ignoring relativity, of course). This concept can be adequately coded-persisted in UTC, for example (if you can ignore leap seconds). &lt;/p&gt;\n\n&lt;p&gt;A &quot;civil&quot; time is a datetime specification that follows civil norms: a point of time here is fully specified by a set of datetime fields (Y,M,D,H,MM,S,FS) plus a TZ (timezone specification) (also a &quot;calendar&quot;, actually; but lets assume we restrict the discussion to Gregorian calendar). A timezone and a calendar jointly allow (in principle) to map from one representation to another. But civil and physical time instants are fundamentally different types of magnitudes, and they should be kept conceptually separated and treated differently  (an analogy: arrays of bytes and character strings).&lt;/p&gt;\n\n&lt;p&gt;The issue is confusing because we speak of these types events interchangeably, and because the civil times are subject to political changes. The problem (and the need to distinguish these concepts) becomes more evident for events in the future. Example (taken from my discussion &lt;a href=&quot;http://www.mail-archive.com/pgsql-hackers@postgresql.org/msg139634.html&quot; rel=&quot;noreferrer&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;\n\n&lt;p&gt;John records in his calendar a reminder for some event at datetime\n&lt;code&gt;2019-Jul-27, 10:30:00&lt;/code&gt;, TZ=&lt;code&gt;Chile/Santiago&lt;/code&gt;,  (which has offset GMT-4,\nhence it corresponds to  UTC &lt;code&gt;2019-Jul-27 14:30:00&lt;/code&gt;). But some day\nin the future, the country decides to change the TZ offset to GMT-5.&lt;/p&gt;\n\n&lt;p&gt;Now, when the day comes... should that reminder trigger at&lt;/p&gt;\n\n&lt;p&gt;A) &lt;code&gt;2019-Jul-27 10:30:00  Chile/Santiago&lt;/code&gt;  = &lt;code&gt;UTC time  2019-Jul-27 15:30:00&lt;/code&gt; ?&lt;/p&gt;\n\n&lt;p&gt;or&lt;/p&gt;\n\n&lt;p&gt;B) &lt;code&gt;2019-Jul-27  9:30:00  Chile/Santiago&lt;/code&gt;  = &lt;code&gt;UTC time  2019-Jul-27 14:30:00&lt;/code&gt; ?&lt;/p&gt;\n\n&lt;p&gt;There is no correct answer, unless one knows what John conceptually meant\nwhen he told the calendar &quot;Please ring me at &lt;code&gt;2019-Jul-27, 10:30:00\nTZ=Chile/Santiago&lt;/code&gt;&quot;.&lt;/p&gt;\n\n&lt;p&gt;Did he mean a &quot;civil date-time&quot; (&quot;when the clocks in my city tell\n10:30&quot;)? In that case, A) is the correct answer.&lt;/p&gt;\n\n&lt;p&gt;Or did he mean a  &quot;physical instant of time&quot;, a point in the continuus\nline of time of our universe, say, &quot;when the next solar eclipse\nhappens&quot;. In that case, answer B) is the correct one.&lt;/p&gt;\n\n&lt;p&gt;A few Date/Time APIs get this distinction right: among them, &lt;a href=&quot;http://www.joda.org/joda-time/&quot; rel=&quot;noreferrer&quot;&gt;Jodatime&lt;/a&gt;, which is the foundation of the next (third!) Java DateTime API (JSR  310).&lt;/p&gt;\n    ","\n&lt;p&gt;Make clear architectural separation of concerns - to know exactly which tier interacts with users, and has to change date-time for/from canonical representation (UTC). &lt;strong&gt;Non-UTC date-time is presentation&lt;/strong&gt; (follows users local timezone), &lt;strong&gt;UTC time is model&lt;/strong&gt; (remains unique for back-end and mid tiers).&lt;/p&gt;\n\n&lt;p&gt;Also, &lt;strong&gt;decide what&apos;s your actual audience, what you don&apos;t have to serve and where do you draw the line&lt;/strong&gt;. Don&apos;t touch exotic calendars unless you actually have important customers there and then consider separate user-facing server(s) just for that region.&lt;/p&gt;\n\n&lt;p&gt;If you can acquire and maintain user&apos;s location, use location for systematic date-time conversion (say .NET culture or a SQL table) but provide a way for end-user to choose overrides if date-time is critical for your users.&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;If there are historical audit obligations&lt;/strong&gt; involved (like telling exactly when Jo in AZ paid a bill 2 yrs ago in September) &lt;strong&gt;then keep both UTC and local time&lt;/strong&gt; for the record (your conversion tables will change in a course of time).&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;Define the time referential time zone for data that comes in bulk&lt;/strong&gt; - like files, web services etc. Say East Coast company has data center in CA - you need to ask and know what they use as a standard instead of assuming one or the other.&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;Don&apos;t trust time-zone offsets embedded in textual representation of the date-time and&lt;/strong&gt; don&apos;t accept to parse and follow them. &lt;strong&gt;Instead always request that time zone and/or reference zone have to be explicitly defined&lt;/strong&gt;. You can easily receive time with PST offset but the time is actually EST since that&apos;s the client&apos;s reference time and records were just exported at a server which is in PST.&lt;/p&gt;\n    ","\n&lt;p&gt;You need to know about the Olson &lt;a href=&quot;https://en.wikipedia.org/wiki/Tz_database&quot; rel=&quot;noreferrer&quot;&gt;tz database&lt;/a&gt;, which is available from &lt;s&gt;&lt;a href=&quot;ftp://elsie.nci.nih.gov/pub&quot; rel=&quot;noreferrer&quot;&gt;ftp://elsie.nci.nih.gov/pub&lt;/a&gt;&lt;/s&gt; &lt;a href=&quot;http://iana.org/time-zones/&quot; rel=&quot;noreferrer&quot;&gt;http://iana.org/time-zones/&lt;/a&gt;.  It is updated multiple times per year to deal with the often last-minute changes in when (and whether) to switch between winter and summer (standard and daylight saving) time in different countries around the world.  In 2009, the last release was 2009s; in 2010, it was 2010n; in 2011, it was 2011n; at the end of May 2012, the release was 2012c.  Note that there is a set of code to manage the data and the actual time zone data itself, in two separate archives (tzcode20xxy.tar.gz and tzdata20xxy.tar.gz).  Both code and data are in the public domain.&lt;/p&gt;\n\n&lt;p&gt;This is the source of time zone names such as America/Los_Angeles (and synonyms such as US/Pacific).&lt;/p&gt;\n\n&lt;p&gt;If you need to keep track of different zones, then you need the Olson database.  As others have advised, you also want to store the data in a fixed format  UTC is normally the one chosen  along with a record of the time zone in which the data was generated.  You may want to distinguish between the offset from UTC at the time and the time zone name; that can make a difference later.  Also, knowing that it is currently 2010-03-28T23:47:00-07:00 (US/Pacific) may or may not help you with interpreting the value 2010-11-15T12:30  which is presumably specified in PST (Pacific Standard Time) rather than PDT (Pacific Daylight Saving Time).&lt;/p&gt;\n\n&lt;p&gt;The standard C library interfaces are not dreadfully helpful with this sort of stuff.&lt;/p&gt;\n\n&lt;hr&gt;\n\n&lt;p&gt;The Olson data has moved, in part because A D Olson will be retiring soon, and in part because there was a (now dismissed) law suit against the maintainers for copyright infringement.  The time zone database is now managed under the auspices of &lt;a href=&quot;http://iana.org/&quot; rel=&quot;noreferrer&quot;&gt;IANA&lt;/a&gt;, the Internet Assigned Numbers Authority, and there&apos;s a link on the front page to &lt;a href=&quot;http://www.iana.org/time-zones&quot; rel=&quot;noreferrer&quot;&gt;&apos;Time Zone Database&apos;&lt;/a&gt;.  The discussion mailing list is now &lt;code&gt;tz@iana.org&lt;/code&gt;; the announcement list is &lt;code&gt;tz-announce@iana.org&lt;/code&gt;.&lt;/p&gt;\n    ","\n&lt;p&gt;In general, &lt;strong&gt;include the local time offset (including DST offset)&lt;/strong&gt; in stored timestamps: UTC alone is not enough if you later want to display the timestamp in its original timezone (and DST setting).&lt;/p&gt;\n\n&lt;p&gt;Keep in mind that the offset is not always an integer number of hours (e.g. Indian Standard Time is UTC+05:30).&lt;/p&gt;\n\n&lt;p&gt;For example, suitable formats are a tuple (unix time, offset in minutes) or &lt;a href=&quot;http://en.wikipedia.org/wiki/ISO_8601&quot; rel=&quot;noreferrer&quot;&gt;ISO 8601&lt;/a&gt;.&lt;/p&gt;\n    ","\n&lt;p&gt;Crossing the boundary of &quot;computer time&quot; and &quot;people time&quot; is a nightmare. The main one being that there is no sort of standard for the rules governing timezones and daylight saving times. Countries are free to change their timezone and DST rules at any time, and they do.&lt;/p&gt;\n\n&lt;p&gt;Some countries e.g. Israel, Brazil, decide each year when to have their daylight saving times, so it is impossible to know in advance when (if) DST will be in effect. Others have fixed(ish)  rules as to when DST is in effect. Other countries do not use DST as all.&lt;/p&gt;\n\n&lt;p&gt;Timezones do not have to be full hour differences from GMT. Nepal is +5.45. There are even timezones that are +13. That means that:&lt;/p&gt;\n\n&lt;pre&gt;&lt;code&gt;SUN 23:00 in Howland Island (-12)\nMON 11:00 GMT \nTUE 00:00 in Tonga (+13)\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;are all the same time, yet 3 different days!&lt;/p&gt;\n\n&lt;p&gt;There is also no clear standard on the abbreviations for timezones, and how they change when in DST so you end up with things like this:&lt;/p&gt;\n\n&lt;pre&gt;&lt;code&gt;AST Arab Standard Time     UTC+03\nAST Arabian Standard Time  UTC+04\nAST Arabic Standard Time   UTC+03\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;The best advice is to stay away from local times as much as possible and stick to UTC where you can. Only convert to local times at the last possible moment.&lt;/p&gt;\n\n&lt;p&gt;When testing make sure you test countries in the Western and Eastern hemispheres, with both DST in progress and not and a country that does not use DST (6 in total).&lt;/p&gt;\n    ","\n&lt;p&gt;For PHP:&lt;/p&gt;\n\n&lt;p&gt;The DateTimeZone class in PHP &amp;gt; 5.2 is already based on the Olson DB which others mention, so if you are doing timezone conversions in PHP and not in the DB, you are exempt of working with (the hard-to-understand) Olson files. &lt;/p&gt;\n\n&lt;p&gt;However, PHP is not updated as frequently as the Olson DB, so just using PHPs time zone conversions may leave you with outdated DST information and influence the correctness of your data. While this is not expected to happen frequently, it may happen, and &lt;em&gt;will&lt;/em&gt; happen if you have a large base of users worldwide. &lt;/p&gt;\n\n&lt;p&gt;To cope with the above issue, use the &lt;a href=&quot;https://pecl.php.net/package/timezonedb&quot; rel=&quot;nofollow noreferrer&quot;&gt;timezonedb pecl package&lt;/a&gt;.  Its function is to update PHP&apos;s timezone data. Install this package as frequently as it is updated. (I&apos;m not sure if the updates to this package follow Olson updates exactly, but it seems to be updated at a frequency which is at least very close to the frequency of Olson updates.)&lt;/p&gt;\n    ","\n&lt;p&gt;If your design can accommodate it, &lt;strong&gt;avoid local time conversion all together!&lt;/strong&gt; &lt;/p&gt;\n\n&lt;p&gt;I know to some this might sound insane but think about UX: users process near, relative dates (today, yesterday, next Monday) faster than absolute dates (2010.09.17, Friday Sept 17) on glance. And when you think about it more, the accuracy of timezones (and DST) is more important the closer the date is to &lt;code&gt;now()&lt;/code&gt;, so if you can express dates/datetimes in a relative format for +/- 1 or 2 weeks, the rest of the dates can be UTC and it wont matter too much to 95% of users.&lt;/p&gt;\n\n&lt;p&gt;This way you can store all dates in UTC and do the relative comparisons in UTC and simply show the user UTC dates outside of your Relative Date Threshold.&lt;/p&gt;\n\n&lt;p&gt;This can also apply to user input too (but generally in a more limited fashion). Selecting from a drop down that only has { Yesterday, Today, Tomorrow, Next Monday, Next Thursday } is so much simpler and easier for the user than a date picker. Date pickers are some of the most pain inducing components of form filling. Of course this will not work for all cases but you can see that it only takes a little clever design to make it very powerful.&lt;/p&gt;\n    ","\n&lt;p&gt;I recently had a problem in a web application where on an Ajax post-back the datetime coming back to my server-side code was different from the datetime served out.&lt;/p&gt;\n\n&lt;p&gt;It most likely had to do with my JavaScript code on the client that built up the date for posting back to the client as string, because JavaScript was adjusting for time zone and daylight savings, and in some browsers the calculation for when to apply daylight savings seemed to be different than in others.&lt;/p&gt;\n\n&lt;p&gt;In the end I opted to remove date and time calculations on the client entirely, and posted back to my server on an integer key which then got translated to date time on the server, to allow for consistent transformations.&lt;/p&gt;\n\n&lt;p&gt;My learning from this:\nDo not use JavaScript date and time calculations in web applications unless you ABSOLUTELY have to.&lt;/p&gt;\n    ","\n&lt;p&gt;While I haven&apos;t tried it, an approach to time zone adjustments I would find compelling would be as follows:&lt;/p&gt;\n\n&lt;ol&gt;\n&lt;li&gt;&lt;p&gt;Store everything in UTC.&lt;/p&gt;&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;Create a table &lt;code&gt;TZOffsets&lt;/code&gt; with three columns: RegionClassId, StartDateTime, and OffsetMinutes (int, in minutes).&lt;/p&gt;&lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;p&gt;In the table, store a list of dates and times &lt;em&gt;when&lt;/em&gt; the local time changed, and by how much. The number of regions in the table and the number of dates would depend on what range of dates and areas of the world you need to support. Think of this as if it is &quot;historical&quot; date, even though the dates should include the future to some practical limit.&lt;/p&gt;\n\n&lt;p&gt;When you need to compute the local time of any UTC time, just do this:&lt;/p&gt;\n\n&lt;pre&gt;&lt;code&gt;SELECT DATEADD(&apos;m&apos;, SUM(OffsetMinutes), @inputdatetime) AS LocalDateTime\nFROM   TZOffsets\nWHERE  StartDateTime &amp;lt;= @inputdatetime\n       AND RegionClassId = @RegionClassId;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;You might want to cache this table in your app and use LINQ or some similar means to do the queries rather than hitting the database.&lt;/p&gt;\n\n&lt;p&gt;This data can be distilled from the &lt;a href=&quot;http://www.twinsun.com/tz/tz-link.htm&quot; rel=&quot;nofollow noreferrer&quot;&gt;public domain tz database&lt;/a&gt;.&lt;/p&gt;\n\n&lt;p&gt;Advantages and footnotes of this approach:&lt;/p&gt;\n\n&lt;ol&gt;\n&lt;li&gt;No rules are baked into code, you can adjust the offsets for new regions or date ranges readily.&lt;/li&gt;\n&lt;li&gt;You don&apos;t have to support every range of dates or regions, you can add them as needed.&lt;/li&gt;\n&lt;li&gt;Regions don&apos;t have to correspond directly to geopolitical boundaries, and to avoid duplication of rows (for instance, most states in the US handle DST the same way), you can have broad RegionClass entries that link in another table to more traditional lists of states, countries, etc.&lt;/li&gt;\n&lt;li&gt;For situations like the US where the start and end date of DST has changed over the past few years, this is pretty easy to deal with.&lt;/li&gt;\n&lt;li&gt;Since the StartDateTime field can store a time as well, the 2:00 AM standard change-over time is handled easily.&lt;/li&gt;\n&lt;li&gt;Not everywhere in the world uses a 1-hour DST. This handles those cases easily.&lt;/li&gt;\n&lt;li&gt;The data table is cross-platform and could be a separate open-source project that could be used by developers who use nearly any database platform or programming language.&lt;/li&gt;\n&lt;li&gt;This can be used for offsets that have nothing to do with time zones. For instance, the 1-second adjustments that happen from time to time to adjust for the Earth&apos;s rotation, historical adjustments to and within the Gregorian calendar, etc.&lt;/li&gt;\n&lt;li&gt;Since this is in a database table, standard report queries, etc. can take advantage of the data without a trip through business logic code.&lt;/li&gt;\n&lt;li&gt;This handles time zone offsets as well if you want it to, and can even account for special historical cases where a region is assigned to another time zone. All you need is an initial date that assigns a time zone offset to each region with a minimal start date. This would require creating at least one region for each time zone, but would allow you to ask interesting questions like: &quot;What is the difference in local time between Yuma, Arizona and Seattle, Washington on February 2, 1989 at 5:00am?&quot; (Just subtract one SUM() from the other).&lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;p&gt;Now, the only disadvantage of this approach &lt;em&gt;or any other&lt;/em&gt; is that conversions &lt;em&gt;from&lt;/em&gt; local time to GMT are not perfect, since any DST change that has a negative offset to the clock &lt;em&gt;repeats&lt;/em&gt; a given local time. No easy way to deal with that one, I&apos;m afraid, which is one reason storing local times is bad news in the first place.&lt;/p&gt;\n    ","\n&lt;p&gt;I have hit this on two types of systems, shift planning systems (e.g. factory workers) and gas depend management systems)&lt;/p&gt;\n\n&lt;p&gt;23 and 25 hour long days are a pain to cope with, so are 8hr shifts that take 7hr or 9hr.  The problem is you will find that each customers, or even department of the customer have different rules they have created (often without documenting) on what they do in these special cases.&lt;/p&gt;\n\n&lt;p&gt;Some questions are best not asked of the customers until after they have paid for your off the shelf software.  It is very rare to find a customer that thinks about this type of issue up front when buying software.&lt;/p&gt;\n\n&lt;p&gt;I think in all cases you should record time in UTC and convert to/from local time before storing the date/time.   However even know which take a given time is in can be hard with Daylight saving and time zones.&lt;/p&gt;\n    ","\n&lt;p&gt;For the web, the rules aren&apos;t that complicated...&lt;/p&gt;\n\n&lt;ul&gt;\n&lt;li&gt;&lt;strong&gt;Server-side, use UTC&lt;/strong&gt; &lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;Client-side, use &lt;a href=&quot;http://en.wikipedia.org/wiki/Tz_database&quot;&gt;Olson&lt;/a&gt;&lt;/strong&gt;\n&lt;ul&gt;\n&lt;li&gt;Reason: UTC-offsets are not daylight savings-safe (e.g. New York is EST (UTC - 5 Hours) part of the year, EDT (UTC - 4 Hours) rest of the year).&lt;/li&gt;\n&lt;li&gt;For client-side time zone determination, you have two options:\n&lt;ul&gt;\n&lt;li&gt;&lt;strong&gt;1) Have user set zone (Safer)&lt;/strong&gt;\n&lt;ul&gt;\n&lt;li&gt;Resources: Web-ready Olson tz &lt;a href=&quot;https://gist.github.com/3349954&quot;&gt;HTML Dropdown&lt;/a&gt; and &lt;a href=&quot;https://gist.github.com/3349960&quot;&gt;JSON&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;2) Auto-detect zone&lt;/strong&gt;\n&lt;ul&gt;\n&lt;li&gt;Resource: &lt;a href=&quot;https://bitbucket.org/pellepim/jstimezonedetect/&quot;&gt;jsTimezoneDetect&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;&lt;/li&gt;\n&lt;/ul&gt;&lt;/li&gt;\n&lt;/ul&gt;&lt;/li&gt;\n&lt;/ul&gt;\n\n&lt;p&gt;The rest is just UTC/local conversion using your server-side datetime libraries. Good to go...&lt;/p&gt;\n    ","\n&lt;p&gt;When it comes to applications that run on a &lt;em&gt;server&lt;/em&gt;, including web sites and other back-end services, the time zone setting of the server should be ignored by the application.&lt;/p&gt;\n\n&lt;p&gt;The common advice is to set the server&apos;s time zone to UTC.  This is indeed a good best practice, but it&apos;s there as a band-aid for applications that do not follow other best practices.  For example, a service might be writing to log files with local timestamps instead of UTC-based timestamps, thus creating ambiguities during the daylight saving time fall-back transition.  Setting the server&apos;s time zone to UTC will fix &lt;em&gt;that&lt;/em&gt; application.  However the real fix would be for the application to log using UTC to begin with.&lt;/p&gt;\n\n&lt;p&gt;Server-side code, including web sites, should &lt;em&gt;never&lt;/em&gt; expect the local time zone of the server to be anything in particular.&lt;/p&gt;\n\n&lt;p&gt;In some languages, the local time zone can easily creep in to application code.  For example, the &lt;code&gt;DateTime.ToUniversalTime&lt;/code&gt; method in .NET will convert &lt;em&gt;from&lt;/em&gt; the local time zone to UTC, and the &lt;code&gt;DateTime.Now&lt;/code&gt; property returns the current time in the local time zone.   Also, the &lt;code&gt;Date&lt;/code&gt; constructor in JavaScript uses the computer&apos;s local time zone.  There are many other examples like this.   It is important to practice defensive programming, avoiding any code that uses the computer&apos;s local time zone setting.&lt;/p&gt;\n\n&lt;p&gt;Reserve using the local time zone for client-side code, such as desktop applications, mobile applications, and client-side JavaScript.&lt;/p&gt;\n    ","\n&lt;p&gt;Keep your servers set to UTC, and make sure they all are configured for ntp or the equivalent.&lt;/p&gt;\n\n&lt;p&gt;UTC avoids daylight savings time issues, and out-of-sync servers can cause unpredictable results that take a while to diagnose.&lt;/p&gt;\n    ","\n&lt;p&gt;Be careful when dealing with timestamps stored in the FAT32 filesystem - it is always persisted in local time coordinates (which include DST - see &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ms724290(VS.85).aspx&quot; rel=&quot;noreferrer&quot;&gt;msdn article&lt;/a&gt;).  Got burned on that one.&lt;/p&gt;\n    ","\n&lt;p&gt;One other thing, make sure the servers have the up to date daylight savings patch applied.&lt;/p&gt;\n\n&lt;p&gt;We had a situation last year where our times were consistently out by one hour for a three-week period for North American users, even though we were using a UTC based system.&lt;/p&gt;\n\n&lt;p&gt;It turns out in the end it was the servers. They just needed an up-to-date patch applied (&lt;a href=&quot;http://en.wikipedia.org/wiki/Windows_Server_2003&quot; rel=&quot;nofollow noreferrer&quot;&gt;Windows Server 2003&lt;/a&gt;).&lt;/p&gt;\n    ","\n&lt;h1&gt;PHP&apos;s &lt;a href=&quot;http://www.php.net/manual/en/datetimezone.listabbreviations.php&quot;&gt;&lt;code&gt;DateTimeZone::listAbbreviations()&lt;/code&gt;&lt;/a&gt; output&lt;/h1&gt;\n\n&lt;p&gt;This PHP method returns an associative array containing some &apos;major&apos; timezones (like CEST), which on their own contain more specific &apos;geographic&apos; timezones (like Europe/Amsterdam).&lt;/p&gt;\n\n&lt;p&gt;If you&apos;re using these timezones and their offset/DST information, it&apos;s extremely important to realize the following:&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;It seems like &lt;em&gt;all different offset/DST configurations&lt;/em&gt; (including historical configurations) of each timezone are included!&lt;/strong&gt;&lt;/p&gt;\n\n&lt;p&gt;For example, Europe/Amsterdam can be found six times in the output of this function. Two occurrences (offset 1172/4772) are for the Amsterdam time used until 1937; two (1200/4800) are for the time that was used between 1937 and 1940; and two (3600/4800) are for the time used since 1940.&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;Therefore, &lt;em&gt;you cannot rely on the offset/DST information returned by this function&lt;/em&gt; as being currently correct/in use!&lt;/strong&gt;&lt;/p&gt;\n\n&lt;p&gt;If you want to know the current offset/DST of a certain timezone, you&apos;ll have to do something like this:&lt;/p&gt;\n\n&lt;pre&gt;&lt;code&gt;&amp;lt;?php\n$now = new DateTime(null, new DateTimeZone(&apos;Europe/Amsterdam&apos;));\necho $now-&amp;gt;getOffset();\n?&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;If you happen to maintain database systems that are running with DST active, check carefully whether they need to be shut down during the transition in fall. Mandy DBS (or other systems as well) don&apos;t like passing the same point in (local) time twice, which is exactly what happens when you turn back the clock in fall. SAP has solved this with a (IMHO really neat) workaround - instead of turning back the clock, they just let the internal clock run at half the usual speed for two hours...&lt;/p&gt;\n    ","\n&lt;p&gt;Are you using the &lt;strong&gt;.NET framework&lt;/strong&gt;?\nIf so, let me introduce you to the &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/system.datetimeoffset.aspx&quot; rel=&quot;nofollow&quot;&gt;DateTimeOffset&lt;/a&gt; type, added with .NET 3.5.&lt;/p&gt;\n\n&lt;p&gt;This structure holds both a &lt;code&gt;DateTime&lt;/code&gt; and an Offset (&lt;code&gt;TimeSpan&lt;/code&gt;), which specifies the difference between the &lt;code&gt;DateTimeOffset&lt;/code&gt; instance&apos;s date and time and Coordinated Universal Time (UTC).&lt;/p&gt;\n\n&lt;ul&gt;\n&lt;li&gt;&lt;p&gt;The &lt;code&gt;DateTimeOffset.Now&lt;/code&gt; static method will return a &lt;code&gt;DateTimeOffset&lt;/code&gt;\ninstance consisting of the current (local) time, and the local offset\n(as defined in the operating system&apos;s regional info).&lt;/p&gt;&lt;/li&gt;\n&lt;li&gt;&lt;p&gt;The &lt;code&gt;DateTimeOffset.UtcNow&lt;/code&gt; static method will return a\n&lt;code&gt;DateTimeOffset&lt;/code&gt; instance consisting of the current time in UTC (as\nif you were in Greenwich).&lt;/p&gt;&lt;/li&gt;\n&lt;/ul&gt;\n\n&lt;p&gt;Other helpful types are the &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/system.timezone.aspx&quot; rel=&quot;nofollow&quot;&gt;TimeZone&lt;/a&gt; and &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/system.timezoneinfo.aspx&quot; rel=&quot;nofollow&quot;&gt;TimeZoneInfo&lt;/a&gt; classes. &lt;/p&gt;\n    ","\n&lt;p&gt;For those struggling with this on &lt;a href=&quot;http://en.wikipedia.org/wiki/.NET_Framework&quot; rel=&quot;nofollow&quot;&gt;.NET&lt;/a&gt;, see if using &lt;code&gt;DateTimeOffset&lt;/code&gt; and/or &lt;code&gt;TimeZoneInfo&lt;/code&gt; are worth your while.&lt;/p&gt;\n\n&lt;p&gt;If you want to use &lt;a href=&quot;http://en.wikipedia.org/wiki/Tz_database&quot; rel=&quot;nofollow&quot;&gt;IANA/Olson time zones&lt;/a&gt;, or find the built in types are insufficient for your needs, check out &lt;a href=&quot;http://nodatime.org&quot; rel=&quot;nofollow&quot;&gt;Noda Time&lt;/a&gt;, which offers a much smarter date and time API for .NET. &lt;/p&gt;\n    ","\n&lt;p&gt;Business rules should always work on &lt;a href=&quot;https://en.wikipedia.org/wiki/Civil_time&quot; rel=&quot;nofollow noreferrer&quot;&gt;civil time&lt;/a&gt; (unless there&apos;s legislation that says otherwise). Be aware that civil time is a mess, but it&apos;s what people use so it&apos;s what is important.&lt;/p&gt;\n\n&lt;p&gt;Internally, keep timestamps in something like civil-time-seconds-from-epoch. The &lt;a href=&quot;https://en.wikipedia.org/wiki/Epoch_%28reference_date%29&quot; rel=&quot;nofollow noreferrer&quot;&gt;epoch&lt;/a&gt; doesn&apos;t matter particularly (I favour the &lt;a href=&quot;https://en.wikipedia.org/wiki/Unix_time&quot; rel=&quot;nofollow noreferrer&quot;&gt;Unix epoch&lt;/a&gt;) but it does make things easier than the alternative. Pretend that &lt;a href=&quot;https://en.wikipedia.org/wiki/Leap_second&quot; rel=&quot;nofollow noreferrer&quot;&gt;leap-seconds&lt;/a&gt; don&apos;t exist unless you&apos;re doing something that &lt;em&gt;really&lt;/em&gt; needs them (e.g., satellite tracking). The mapping between timestamps and displayed time is the only point where &lt;a href=&quot;https://en.wikipedia.org/wiki/Daylight_saving_time&quot; rel=&quot;nofollow noreferrer&quot;&gt;DST&lt;/a&gt; rules should be applied; the rules change frequently (on a global level, several times a year; blame politicians) so you should make sure that you do not hard-code the mapping. Olson&apos;s &lt;a href=&quot;https://en.wikipedia.org/wiki/Tz_database&quot; rel=&quot;nofollow noreferrer&quot;&gt;TZ database&lt;/a&gt; is invaluable.&lt;/p&gt;\n    ","\n&lt;p&gt;Just wanted to point out two things that seem inaccurate or at least confusing:&lt;/p&gt;\n\n&lt;blockquote&gt;\n  &lt;p&gt;Always persist time according to a unified standard that is not\n  affected by daylight savings. GMT and UTC have been mentioned by\n  different people, though UTC seems to be mentioned most often.&lt;/p&gt;\n&lt;/blockquote&gt;\n\n&lt;p&gt;For (almost) all practical computing purposes, UTC is, in fact, GMT. Unless you see a timestamps with a fractional second, you&apos;re dealing with GMT which makes this distinction redundant.&lt;/p&gt;\n\n&lt;blockquote&gt;\n  &lt;p&gt;Include the local time offset as is (including DST offset) when\n  storing timestamps.&lt;/p&gt;\n&lt;/blockquote&gt;\n\n&lt;p&gt;A timestamp is always represented in GMT and thus has no offset.&lt;/p&gt;\n    ","\n&lt;p&gt;Here is my experience:-&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;(Does not require any third-party library)&lt;/strong&gt;&lt;/p&gt;\n\n&lt;ul&gt;\n&lt;li&gt;On server-side, store times in UTC format so that all date/time values in database are in a single standard regardless of location of users, servers, timezones or DST.&lt;/li&gt;\n&lt;li&gt;On the UI layer or in emails sent out to user, you need to show times according to user. For that matter, you need to have user&apos;s timezone offset so that you can add this offset to your database&apos;s UTC value which will result in user&apos;s local time. You can either take user&apos;s timezone offset when they are signing up or you can auto-detect them in web and mobile platforms. For websites, JavaScript&apos;s function getTimezoneOffset() method is a standard since version 1.0 and compatible with all browsers. (Ref: &lt;a href=&quot;http://www.w3schools.com/jsref/jsref_getTimezoneOffset.asp&quot; rel=&quot;nofollow&quot;&gt;http://www.w3schools.com/jsref/jsref_getTimezoneOffset.asp&lt;/a&gt;)&lt;/li&gt;\n&lt;/ul&gt;\n    ","\n&lt;p&gt;&lt;strong&gt;Tom Scott&apos;s&lt;/strong&gt; &lt;a href=&quot;https://www.youtube.com/watch?v=-5wpm-gesOY&quot; rel=&quot;nofollow&quot;&gt;video about timezones on YouTube&lt;/a&gt; on the Computerphile channel has also a nice and entertaining description of the topic. \nExamples include: &lt;/p&gt;\n\n&lt;ul&gt;\n&lt;li&gt;&lt;strong&gt;Samoa&lt;/strong&gt; (an island in the Pacific Ocean) shifting its time zone forward by 24 hours to make trading easier with Australia and New Zealand, &lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;West Bank&lt;/strong&gt;, where 2 populations of people are following different time zones,&lt;/li&gt;\n&lt;li&gt;18th century changes from the &lt;strong&gt;Julian&lt;/strong&gt; calendar to the &lt;strong&gt;Gregorian&lt;/strong&gt;\ncalendar (which happened in the 20th century in Russia).&lt;/li&gt;\n&lt;/ul&gt;\n    ","\n&lt;p&gt;Just one example to prove that handling time is the huge mess described, and that you can never be complacent. In several spots on this page leap-seconds have been ignored. &lt;/p&gt;\n\n&lt;p&gt;Several years ago, the Android operating system used GPS satellites to get a UTC time reference, but ignored the fact that GPS satellites do not use leap-seconds. No one noticed until there was confusion on New Year&apos;s Eve, when the Apple phone users and Android phone users did their count-downs about 15 seconds apart. &lt;/p&gt;\n\n&lt;p&gt;I think it has since been fixed, but you never know when these &apos;minor details&apos; will come back to haunt you. &lt;/p&gt;\n    ","\n&lt;p&gt;Actually, kernel32.dll does not export SystemTimeToTzSpecificLocation.  It does however export the following two:  SystemTimeToTzSpecificLocalTime and TzSpecificLocalTimeToSystemTime...&lt;/p&gt;\n    ","\n&lt;p&gt;Never rely only on constructors like &lt;/p&gt;\n\n&lt;pre&gt;&lt;code&gt; new DateTime(int year, int month, int day, int hour, int minute, TimeZone timezone)\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;They can throw exceptions when a certain date time does not exist due to DST. Instead, build your own methods for creating such dates. In them, catch any exceptions that occur due to DST, and adjust the time is needed with the transition offset. DST may occur on different dates and at different hours (even at midnight for Brazil) according to the timezone.&lt;/p&gt;\n    ","\n&lt;ul&gt;\n&lt;li&gt;Never, ever store local time without its UTC offset (or a reference to the time zone)examples of how not to do it include FAT32 and &lt;code&gt;struct tm&lt;/code&gt; in C.&lt;/li&gt;\n&lt;li&gt;Understand that a time zone is a combination of\n\n&lt;ul&gt;\n&lt;li&gt;a set of UTC offsets (e.g. +0100 in winter, +0200 in summer)&lt;/li&gt;\n&lt;li&gt;rules for when the switchover happens (which may change over time: for example, in the 1990s the EU harmonized the switchover as being on the last Sundays in March and October, at 02:00 standard time/03:00 DST; previously this differed between member states).&lt;/li&gt;\n&lt;/ul&gt;&lt;/li&gt;\n&lt;/ul&gt;\n\n&lt;hr&gt;\n\n&lt;p&gt; Some implementations of &lt;code&gt;struct tm&lt;/code&gt; do store the UTC offset, but this has not made it into the standard.&lt;/p&gt;\n    ","\n&lt;p&gt;In dealing with databases (in particular &lt;a href=&quot;http://en.wikipedia.org/wiki/MySQL&quot; rel=&quot;nofollow&quot;&gt;MySQL&lt;/a&gt;, but this applies to most databases), I found it hard to store UTC.&lt;/p&gt;\n\n&lt;ul&gt;\n&lt;li&gt;Databases usually work with server datetime by default (that is, CURRENT_TIMESTAMP).&lt;/li&gt;\n&lt;li&gt;You may not be able to change the server timezone.&lt;/li&gt;\n&lt;li&gt;Even if you are able to change the timezone, you may have third-party code that expects server timezone to be local.&lt;/li&gt;\n&lt;/ul&gt;\n\n&lt;p&gt;I found it easier to just store server datetime in the database, then let the database convert the stored datetime back to UTC (that is, UNIX_TIMESTAMP()) in the SQL statements. After that you can use the datetime as UTC in your code.&lt;/p&gt;\n\n&lt;p&gt;If you have 100% control over the server and all code, it&apos;s probably better to change server timezone to UTC.&lt;/p&gt;\n    "]},"page":"36","randomQuestions":[{"title":"How to unnest (explode) a column in a pandas DataFrame, into multiple rows","slug":"how-to-unnest-(explode)-a-column-in-a-pandas-dataframe-into-multiple-rows-1657387806735"},{"title":"Submit same Partial View called multiple times data to controller?","slug":"submit-same-partial-view-called-multiple-times-data-to-controller-1657387887213"},{"title":"commandButton/commandLink/ajax action/listener method not invoked or input value not set/updated","slug":"commandbuttoncommandlinkajax-actionlistener-method-not-invoked-or-input-value-not-setupdated-1657384667519"},{"title":"Get the cartesian product of a series of lists?","slug":"get-the-cartesian-product-of-a-series-of-lists-1657387709890"},{"title":"How do you use a variable in a regular expression?","slug":"how-do-you-use-a-variable-in-a-regular-expression-1657387939007"},{"title":"Undefined, unspecified and implementation-defined behavior","slug":"undefined-unspecified-and-implementation-defined-behavior-1657384516085"},{"title":"How to center an element horizontally and vertically","slug":"how-to-center-an-element-horizontally-and-vertically-1657388132330"},{"title":"What is the copy-and-swap idiom?","slug":"what-is-the-copy-and-swap-idiom-1657384840329"},{"title":"Do I cast the result of malloc?","slug":"do-i-cast-the-result-of-malloc-1657384271583"},{"title":"How to check if element is visible after scrolling?","slug":"how-to-check-if-element-is-visible-after-scrolling-1657387987960"},{"title":"Why are floating point numbers inaccurate?","slug":"why-are-floating-point-numbers-inaccurate-1657387346111"},{"title":"How to deal with SettingWithCopyWarning in Pandas","slug":"how-to-deal-with-settingwithcopywarning-in-pandas-1657384778377"},{"title":"Generating random whole numbers in JavaScript in a specific range","slug":"generating-random-whole-numbers-in-javascript-in-a-specific-range-1657388112728"},{"title":"How to calculate the difference between two dates using PHP?","slug":"how-to-calculate-the-difference-between-two-dates-using-php-1657387409560"},{"title":"Test for existence of nested JavaScript object key","slug":"test-for-existence-of-nested-javascript-object-key-1657387935411"},{"title":"Why can't an element with a z-index value cover its child?","slug":"why-can't-an-element-with-a-z-index-value-cover-its-child-1657387707187"},{"title":"Is storing a delimited list in a database column really that bad?","slug":"is-storing-a-delimited-list-in-a-database-column-really-that-bad-1657384474773"},{"title":"When to use virtual destructors?","slug":"when-to-use-virtual-destructors-1657388152135"},{"title":"Android permission doesn't work even if I have declared it","slug":"android-permission-doesn't-work-even-if-i-have-declared-it-1657387726990"},{"title":"Is there a difference between \"==\" and \"is\"?","slug":"is-there-a-difference-between-\"\"-and-\"is\"-1657387902231"}]},"__N_SSG":true}