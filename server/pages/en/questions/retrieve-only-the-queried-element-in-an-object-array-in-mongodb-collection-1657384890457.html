<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find the solution to any question. We focus on finding the fastest possible solution for users. Main topics like coding, learning. - solutionschecker.com"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><link name="keywords" content="mongodb,mongodb-query,aggregation-framework,projection,solutions checker, solution checker, how to, solution for, check for solution, resolve question, what is, what solution for, find solution"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://solutionschecker.com","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@id":"https://solutionschecker.com/questions","name":"Questions"}},{"@type":"ListItem","position":3,"item":{"@id":"https://solutionschecker.com/questions/retrieve-only-the-queried-element-in-an-object-array-in-mongodb-collection-1657384890457","name":"Questions"}}]}</script><title>Retrieve only the queried element in an object array in MongoDB collection | Solution Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="Suppose you have the following documents in my collection:

{  
   &quot;_id&quot;:ObjectId(&quot;562e7c594c12942f08fe4192&quot;),
   &quot;shapes&quot;:[  
      {  
         &quot;shape&quot;:&quot;square&quot;,
         &quot;color&quot;:&quot;blue&quot;
      },
      {  
         &quot;shape&quot;:&quot;circle&quot;,
         &quot;color&quot;:&quot;red&quot;
      }
   ]
},
{  
   &quot;_id&quot;:ObjectId(&quot;562e7c594c12942f08fe4193&quot;),
   &quot;shapes&quot;:[  
      {  
         &quot;shape&quot;:&quot;square&quot;,
         &quot;color&quot;:&quot;black&quot;
      },
      {  
         &quot;shape&quot;:&quot;circle&quot;,
         &quot;color&quot;:&quot;green&quot;
      }
   ]
}




Do query:

db.test.find({&quot;shapes.color&quot;: &quot;red&quot;}, {&quot;shapes.color&quot;: 1})


Or

db.test.find({shapes: {&quot;$elemMatch&quot;: {color: &quot;red&quot;}}}, {&quot;shapes.color&quot;: 1})




Returns matched document (Document 1), but always with ALL array items in shapes:

{ &quot;shapes&quot;: 
  [
    {&quot;shape&quot;: &quot;square&quot;, &quot;color&quot;: &quot;blue&quot;},
    {&quot;shape&quot;: &quot;circle&quot;, &quot;color&quot;: &quot;red&quot;}
  ] 
}


However, I&#x27;d like to get the document (Document 1) only with the array that contains color=red:

{ &quot;shapes&quot;: 
  [
    {&quot;shape&quot;: &quot;circle&quot;, &quot;color&quot;: &quot;red&quot;}
  ] 
}


How can I do this?
    "/><meta property="og:title" content="Retrieve only the queried element in an object array in MongoDB collection | Solution Checker"/><meta property="og:description" content="Suppose you have the following documents in my collection:

{  
   &quot;_id&quot;:ObjectId(&quot;562e7c594c12942f08fe4192&quot;),
   &quot;shapes&quot;:[  
      {  
         &quot;shape&quot;:&quot;square&quot;,
         &quot;color&quot;:&quot;blue&quot;
      },
      {  
         &quot;shape&quot;:&quot;circle&quot;,
         &quot;color&quot;:&quot;red&quot;
      }
   ]
},
{  
   &quot;_id&quot;:ObjectId(&quot;562e7c594c12942f08fe4193&quot;),
   &quot;shapes&quot;:[  
      {  
         &quot;shape&quot;:&quot;square&quot;,
         &quot;color&quot;:&quot;black&quot;
      },
      {  
         &quot;shape&quot;:&quot;circle&quot;,
         &quot;color&quot;:&quot;green&quot;
      }
   ]
}




Do query:

db.test.find({&quot;shapes.color&quot;: &quot;red&quot;}, {&quot;shapes.color&quot;: 1})


Or

db.test.find({shapes: {&quot;$elemMatch&quot;: {color: &quot;red&quot;}}}, {&quot;shapes.color&quot;: 1})




Returns matched document (Document 1), but always with ALL array items in shapes:

{ &quot;shapes&quot;: 
  [
    {&quot;shape&quot;: &quot;square&quot;, &quot;color&quot;: &quot;blue&quot;},
    {&quot;shape&quot;: &quot;circle&quot;, &quot;color&quot;: &quot;red&quot;}
  ] 
}


However, I&#x27;d like to get the document (Document 1) only with the array that contains color=red:

{ &quot;shapes&quot;: 
  [
    {&quot;shape&quot;: &quot;circle&quot;, &quot;color&quot;: &quot;red&quot;}
  ] 
}


How can I do this?
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"Retrieve only the queried element in an object array in MongoDB collection","text":"Suppose you have the following documents in my collection:\n\n{  \n   &quot;_id&quot;:ObjectId(&quot;562e7c594c12942f08fe4192&quot;),\n   &quot;shapes&quot;:[  \n      {  \n         &quot;shape&quot;:&quot;square&quot;,\n         &quot;color&quot;:&quot;blue&quot;\n      },\n      {  \n         &quot;shape&quot;:&quot;circle&quot;,\n         &quot;color&quot;:&quot;red&quot;\n      }\n   ]\n},\n{  \n   &quot;_id&quot;:ObjectId(&quot;562e7c594c12942f08fe4193&quot;),\n   &quot;shapes&quot;:[  \n      {  \n         &quot;shape&quot;:&quot;square&quot;,\n         &quot;color&quot;:&quot;black&quot;\n      },\n      {  \n         &quot;shape&quot;:&quot;circle&quot;,\n         &quot;color&quot;:&quot;green&quot;\n      }\n   ]\n}\n\n\n\n\nDo query:\n\ndb.test.find({&quot;shapes.color&quot;: &quot;red&quot;}, {&quot;shapes.color&quot;: 1})\n\n\nOr\n\ndb.test.find({shapes: {&quot;$elemMatch&quot;: {color: &quot;red&quot;}}}, {&quot;shapes.color&quot;: 1})\n\n\n\n\nReturns matched document (Document 1), but always with ALL array items in shapes:\n\n{ &quot;shapes&quot;: \n  [\n    {&quot;shape&quot;: &quot;square&quot;, &quot;color&quot;: &quot;blue&quot;},\n    {&quot;shape&quot;: &quot;circle&quot;, &quot;color&quot;: &quot;red&quot;}\n  ] \n}\n\n\nHowever, I&apos;d like to get the document (Document 1) only with the array that contains color=red:\n\n{ &quot;shapes&quot;: \n  [\n    {&quot;shape&quot;: &quot;circle&quot;, &quot;color&quot;: &quot;red&quot;}\n  ] \n}\n\n\nHow can I do this?\n    ","answerCount":15,"upVoteCount":500,"suggestedAnswer":[{"text":"MongoDB 2.2&apos;s new $elemMatch projection operator provides another way to alter the returned document to contain only the first matched shapes element:\n\n\n\ndb.test.find(\n    {&quot;shapes.color&quot;: &quot;red&quot;}, \n    {_id: 0, shapes: {$elemMatch: {color: &quot;red&quot;}}});\n\n\nReturns:\n\n{&quot;shapes&quot; : [{&quot;shape&quot;: &quot;circle&quot;, &quot;color&quot;: &quot;red&quot;}]}\n\n\nIn 2.2 you can also do this using the $ projection operator, where the $ in a projection object field name represents the index of the field&apos;s first matching array element from the query.  The following returns the same results as above:\n\ndb.test.find({&quot;shapes.color&quot;: &quot;red&quot;}, {_id: 0, &apos;shapes.$&apos;: 1});\n\n\nMongoDB 3.2 Update\n\nStarting with the 3.2 release, you can use the new $filter aggregation operator to filter an array during projection, which has the benefit of including all matches, instead of just the first one.\n\ndb.test.aggregate([\n    // Get just the docs that contain a shapes element where color is &apos;red&apos;\n    {$match: {&apos;shapes.color&apos;: &apos;red&apos;}},\n    {$project: {\n        shapes: {$filter: {\n            input: &apos;$shapes&apos;,\n            as: &apos;shape&apos;,\n            cond: {$eq: [&apos;$$shape.color&apos;, &apos;red&apos;]}\n        }},\n        _id: 0\n    }}\n])\n\n\nResults:\n\n[ \n    {\n        &quot;shapes&quot; : [ \n            {\n                &quot;shape&quot; : &quot;circle&quot;,\n                &quot;color&quot; : &quot;red&quot;\n            }\n        ]\n    }\n]\n\n    ","url":"/questions/[slug]#solution1","@type":"Answer","upvoteCount":0},{"text":"The new Aggregation Framework in MongoDB 2.2+ provides an alternative to Map/Reduce.  The $unwind operator can be used to separate your shapes array into a stream of documents that can be matched:\n\ndb.test.aggregate(\n  // Start with a $match pipeline which can take advantage of an index and limit documents processed\n  { $match : {\n     &quot;shapes.color&quot;: &quot;red&quot;\n  }},\n  { $unwind : &quot;$shapes&quot; },\n  { $match : {\n     &quot;shapes.color&quot;: &quot;red&quot;\n  }}\n)\n\n\nResults in:\n\n{\n    &quot;result&quot; : [\n        {\n            &quot;_id&quot; : ObjectId(&quot;504425059b7c9fa7ec92beec&quot;),\n            &quot;shapes&quot; : {\n                &quot;shape&quot; : &quot;circle&quot;,\n                &quot;color&quot; : &quot;red&quot;\n            }\n        }\n    ],\n    &quot;ok&quot; : 1\n}\n\n    ","url":"/questions/[slug]#solution2","@type":"Answer","upvoteCount":0},{"text":"\n  Caution: This answer provides a solution that was relevant at that time, before the new features of MongoDB 2.2 and up were introduced. See the other answers if you are using a more recent version of MongoDB.\n\n\nThe field selector parameter is limited to complete properties. It cannot be used to select part of an array, only the entire array. I tried using the $ positional operator, but that didn&apos;t work.\n\nThe easiest way is to just filter the shapes in the client.\n\nIf you really need the correct output directly from MongoDB, you can use a map-reduce to filter the shapes.\n\nfunction map() {\n  filteredShapes = [];\n\n  this.shapes.forEach(function (s) {\n    if (s.color === &quot;red&quot;) {\n      filteredShapes.push(s);\n    }\n  });\n\n  emit(this._id, { shapes: filteredShapes });\n}\n\nfunction reduce(key, values) {\n  return values[0];\n}\n\nres = db.test.mapReduce(map, reduce, { query: { &quot;shapes.color&quot;: &quot;red&quot; } })\n\ndb[res.result].find()\n\n    ","url":"/questions/[slug]#solution3","@type":"Answer","upvoteCount":0},{"text":"Another interesing way is to use $redact, which is one of the new aggregation features of MongoDB 2.6. If you are using 2.6, you don&apos;t need an $unwind which might cause you performance problems if you have large arrays. \n\ndb.test.aggregate([\n    { $match: { \n         shapes: { $elemMatch: {color: &quot;red&quot;} } \n    }},\n    { $redact : {\n         $cond: {\n             if: { $or : [{ $eq: [&quot;$color&quot;,&quot;red&quot;] }, { $not : &quot;$color&quot; }]},\n             then: &quot;$$DESCEND&quot;,\n             else: &quot;$$PRUNE&quot;\n         }\n    }}]);\n\n\n$redact &quot;restricts the contents of the documents based on information stored in the documents themselves&quot;. So it will run only inside of the document. It basically scans your document top to the bottom, and checks if it matches with your if condition which is in $cond, if there is match it will either keep the content($$DESCEND) or remove($$PRUNE).\n\nIn the example  above, first $match returns the whole shapes array, and $redact strips it down to the expected result. \n\nNote that {$not:&quot;$color&quot;} is necessary, because it will scan the top document as well, and if $redact does not find a color field on the top level this will return false that might strip the whole document which we don&apos;t want. \n    ","url":"/questions/[slug]#solution4","@type":"Answer","upvoteCount":0},{"text":"Better you can query in matching array element using $slice is it helpful to returning the significant object in an array.\n\ndb.test.find({&quot;shapes.color&quot; : &quot;blue&quot;}, {&quot;shapes.$&quot; : 1})\n\n\n$slice is helpful when you know the index of the element, but sometimes you want\nwhichever array element matched your criteria. You can return the matching element\nwith the $ operator.\n    ","url":"/questions/[slug]#solution5","@type":"Answer","upvoteCount":0},{"text":" db.getCollection(&apos;aj&apos;).find({&quot;shapes.color&quot;:&quot;red&quot;},{&quot;shapes.$&quot;:1})\n\n\nOUTPUTS\n\n{\n\n   &quot;shapes&quot; : [ \n       {\n           &quot;shape&quot; : &quot;circle&quot;,\n           &quot;color&quot; : &quot;red&quot;\n       }\n   ]\n}\n\n    ","url":"/questions/[slug]#solution6","@type":"Answer","upvoteCount":0},{"text":"The syntax for find in mongodb is \n\n    db.&lt;collection name&gt;.find(query, projection);\n\n\nand the second query that you have written, that is\n\n    db.test.find(\n    {shapes: {&quot;$elemMatch&quot;: {color: &quot;red&quot;}}}, \n    {&quot;shapes.color&quot;:1})\n\n\nin this you have used the $elemMatch operator in query part, whereas if you use this operator in the projection part then you will get the desired result. You can write down your query as \n\n     db.users.find(\n     {&quot;shapes.color&quot;:&quot;red&quot;},\n     {_id:0, shapes: {$elemMatch : {color: &quot;red&quot;}}})\n\n\nThis will give you the desired result.\n    ","url":"/questions/[slug]#solution7","@type":"Answer","upvoteCount":0},{"text":"Thanks to JohnnyHK.\n\nHere I just want to add some more complex usage.\n\n// Document \n{ \n&quot;_id&quot; : 1\n&quot;shapes&quot; : [\n  {&quot;shape&quot; : &quot;square&quot;,  &quot;color&quot; : &quot;red&quot;},\n  {&quot;shape&quot; : &quot;circle&quot;,  &quot;color&quot; : &quot;green&quot;}\n  ] \n} \n\n{ \n&quot;_id&quot; : 2\n&quot;shapes&quot; : [\n  {&quot;shape&quot; : &quot;square&quot;,  &quot;color&quot; : &quot;red&quot;},\n  {&quot;shape&quot; : &quot;circle&quot;,  &quot;color&quot; : &quot;green&quot;}\n  ] \n} \n\n\n// The Query   \ndb.contents.find({\n    &quot;_id&quot; : ObjectId(1),\n    &quot;shapes.color&quot;:&quot;red&quot;\n},{\n    &quot;_id&quot;: 0,\n    &quot;shapes&quot; :{\n       &quot;$elemMatch&quot;:{\n           &quot;color&quot; : &quot;red&quot;\n       } \n    }\n}) \n\n\n//And the Result\n\n{&quot;shapes&quot;:[\n    {\n       &quot;shape&quot; : &quot;square&quot;,\n       &quot;color&quot; : &quot;red&quot;\n    }\n]}\n\n    ","url":"/questions/[slug]#solution8","@type":"Answer","upvoteCount":0},{"text":"You just need to run query\n\ndb.test.find(\n{&quot;shapes.color&quot;: &quot;red&quot;}, \n{shapes: {$elemMatch: {color: &quot;red&quot;}}});\n\n\noutput of this query is\n\n{\n    &quot;_id&quot; : ObjectId(&quot;562e7c594c12942f08fe4192&quot;),\n    &quot;shapes&quot; : [ \n        {&quot;shape&quot; : &quot;circle&quot;, &quot;color&quot; : &quot;red&quot;}\n    ]\n}\n\n\nas you expected it&apos;ll gives the exact field from array that matches color:&apos;red&apos;.\n    ","url":"/questions/[slug]#solution9","@type":"Answer","upvoteCount":0},{"text":"Along with  $project it will be more appropriate  other wise matching elements will be clubbed together with other elements in document.\ndb.test.aggregate(\n  { &quot;$unwind&quot; : &quot;$shapes&quot; },\n  { &quot;$match&quot; : { &quot;shapes.color&quot;: &quot;red&quot; } },\n  { \n    &quot;$project&quot;: {\n      &quot;_id&quot;:1,\n      &quot;item&quot;:1\n    }\n  }\n)\n\n    ","url":"/questions/[slug]#solution10","@type":"Answer","upvoteCount":0},{"text":"Likewise you can find for the multiple\n\ndb.getCollection(&apos;localData&apos;).aggregate([\n    // Get just the docs that contain a shapes element where color is &apos;red&apos;\n  {$match: {&apos;shapes.color&apos;: {$in : [&apos;red&apos;,&apos;yellow&apos;] } }},\n  {$project: {\n     shapes: {$filter: {\n        input: &apos;$shapes&apos;,\n        as: &apos;shape&apos;,\n        cond: {$in: [&apos;$$shape.color&apos;, [&apos;red&apos;, &apos;yellow&apos;]]}\n     }}\n  }}\n])\n\n    ","url":"/questions/[slug]#solution11","@type":"Answer","upvoteCount":0},{"text":"db.test.find( {&quot;shapes.color&quot;: &quot;red&quot;}, {_id: 0})\n\n    ","url":"/questions/[slug]#solution12","@type":"Answer","upvoteCount":0},{"text":"Use aggregation function and $project to get specific object field in document\n\ndb.getCollection(&apos;geolocations&apos;).aggregate([ { $project : { geolocation : 1} } ])\n\n\nresult:\n\n{\n    &quot;_id&quot; : ObjectId(&quot;5e3ee15968879c0d5942464b&quot;),\n    &quot;geolocation&quot; : [ \n        {\n            &quot;_id&quot; : ObjectId(&quot;5e3ee3ee68879c0d5942465e&quot;),\n            &quot;latitude&quot; : 12.9718313,\n            &quot;longitude&quot; : 77.593551,\n            &quot;country&quot; : &quot;India&quot;,\n            &quot;city&quot; : &quot;Chennai&quot;,\n            &quot;zipcode&quot; : &quot;560001&quot;,\n            &quot;streetName&quot; : &quot;Sidney Road&quot;,\n            &quot;countryCode&quot; : &quot;in&quot;,\n            &quot;ip&quot; : &quot;116.75.115.248&quot;,\n            &quot;date&quot; : ISODate(&quot;2020-02-08T16:38:06.584Z&quot;)\n        }\n    ]\n}\n\n    ","url":"/questions/[slug]#solution13","@type":"Answer","upvoteCount":0},{"text":"Although the question was asked 9.6 years ago, this has been of immense help to numerous people, me being one of them. Thank you everyone for all your queries, hints and answers. Picking up from one of the answers here.. I found that the following method can also be used to project other fields in the parent document.This may be helpful to someone. \n\nFor the following document, the need was to find out if an employee (emp #7839) has his leave history set for the year 2020. Leave history is implemented as an embedded document within the parent Employee document. \n\ndb.employees.find( {&quot;leave_history.calendar_year&quot;: 2020}, \n    {leave_history: {$elemMatch: {calendar_year: 2020}},empno:true,ename:true}).pretty()\n\n\n{\n        &quot;_id&quot; : ObjectId(&quot;5e907ad23997181dde06e8fc&quot;),\n        &quot;empno&quot; : 7839,\n        &quot;ename&quot; : &quot;KING&quot;,\n        &quot;mgrno&quot; : 0,\n        &quot;hiredate&quot; : &quot;1990-05-09&quot;,\n        &quot;sal&quot; : 100000,\n        &quot;deptno&quot; : {\n                &quot;_id&quot; : ObjectId(&quot;5e9065f53997181dde06e8f8&quot;)\n        },\n        &quot;username&quot; : &quot;none&quot;,\n        &quot;password&quot; : &quot;none&quot;,\n        &quot;is_admin&quot; : &quot;N&quot;,\n        &quot;is_approver&quot; : &quot;Y&quot;,\n        &quot;is_manager&quot; : &quot;Y&quot;,\n        &quot;user_role&quot; : &quot;AP&quot;,\n        &quot;admin_approval_received&quot; : &quot;Y&quot;,\n        &quot;active&quot; : &quot;Y&quot;,\n        &quot;created_date&quot; : &quot;2020-04-10&quot;,\n        &quot;updated_date&quot; : &quot;2020-04-10&quot;,\n        &quot;application_usage_log&quot; : [\n                {\n                        &quot;logged_in_as&quot; : &quot;AP&quot;,\n                        &quot;log_in_date&quot; : &quot;2020-04-10&quot;\n                },\n                {\n                        &quot;logged_in_as&quot; : &quot;EM&quot;,\n                        &quot;log_in_date&quot; : ISODate(&quot;2020-04-16T07:28:11.959Z&quot;)\n                }\n        ],\n        &quot;leave_history&quot; : [\n                {\n                        &quot;calendar_year&quot; : 2020,\n                        &quot;pl_used&quot; : 0,\n                        &quot;cl_used&quot; : 0,\n                        &quot;sl_used&quot; : 0\n                },\n                {\n                        &quot;calendar_year&quot; : 2021,\n                        &quot;pl_used&quot; : 0,\n                        &quot;cl_used&quot; : 0,\n                        &quot;sl_used&quot; : 0\n                }\n        ]\n}\n\n    ","url":"/questions/[slug]#solution14","@type":"Answer","upvoteCount":0},{"text":"if you want to do filter, set and find at the same time.\nlet post = await Post.findOneAndUpdate(\n          {\n            _id: req.params.id,\n            tasks: {\n              $elemMatch: {\n                id: req.params.jobId,\n                date,\n              },\n            },\n          },\n          {\n            $set: {\n              &apos;jobs.$[i].performer&apos;: performer,\n              &apos;jobs.$[i].status&apos;: status,\n              &apos;jobs.$[i].type&apos;: type,\n            },\n          },\n          {\n            arrayFilters: [\n              {\n                &apos;i.id&apos;: req.params.jobId,\n              },\n            ],\n            new: true,\n          }\n        );\n\n    ","url":"/questions/[slug]#solution15","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="22"/><link rel="preload" href="/_next/static/css/c116652e2d6f4ad0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c116652e2d6f4ad0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-ccfab947c79712f4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-43d1c35cd6eb9b8f.js" defer=""></script><script src="/_next/static/chunks/294-106ef8570fa99deb.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-50e201fdaa1e0fd1.js" defer=""></script><script src="/_next/static/00bsHgHZki2FteshOatnd/_buildManifest.js" defer=""></script><script src="/_next/static/00bsHgHZki2FteshOatnd/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h1 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h1></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/retrieve-only-the-queried-element-in-an-object-array-in-mongodb-collection-1657384890457#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/retrieve-only-the-queried-element-in-an-object-array-in-mongodb-collection-1657384890457"><h1>Retrieve only the queried element in an object array in MongoDB collection</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/projection">projection</a></div></div><div class="question-content mt-5">
                


<p>Suppose you have the following documents in my collection:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">{  
   <span class="hljs-string">"_id"</span>:<span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"562e7c594c12942f08fe4192"</span>),
   <span class="hljs-string">"shapes"</span>:[  
      {  
         <span class="hljs-string">"shape"</span>:<span class="hljs-string">"square"</span>,
         <span class="hljs-string">"color"</span>:<span class="hljs-string">"blue"</span>
      },
      {  
         <span class="hljs-string">"shape"</span>:<span class="hljs-string">"circle"</span>,
         <span class="hljs-string">"color"</span>:<span class="hljs-string">"red"</span>
      }
   ]
},
{  
   <span class="hljs-string">"_id"</span>:<span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"562e7c594c12942f08fe4193"</span>),
   <span class="hljs-string">"shapes"</span>:[  
      {  
         <span class="hljs-string">"shape"</span>:<span class="hljs-string">"square"</span>,
         <span class="hljs-string">"color"</span>:<span class="hljs-string">"black"</span>
      },
      {  
         <span class="hljs-string">"shape"</span>:<span class="hljs-string">"circle"</span>,
         <span class="hljs-string">"color"</span>:<span class="hljs-string">"green"</span>
      }
   ]
}
</code></pre>

<hr>

<p>Do query:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>({<span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>}, {<span class="hljs-string">"shapes.color"</span>: <span class="hljs-number">1</span>})
</code></pre>

<p>Or</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>({<span class="hljs-attr">shapes</span>: {<span class="hljs-string">"$elemMatch"</span>: {<span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>}}}, {<span class="hljs-string">"shapes.color"</span>: <span class="hljs-number">1</span>})
</code></pre>

<hr>

<p>Returns matched document <em>(Document 1)</em>, but always with ALL array items in <code>shapes</code>:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">{ <span class="hljs-string">"shapes"</span>: 
  [
    {<span class="hljs-string">"shape"</span>: <span class="hljs-string">"square"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"blue"</span>},
    {<span class="hljs-string">"shape"</span>: <span class="hljs-string">"circle"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"red"</span>}
  ] 
}
</code></pre>

<p>However, I'd like to get the document <em>(Document 1)</em> only with the array that contains <code>color=red</code>:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">{ <span class="hljs-string">"shapes"</span>: 
  [
    {<span class="hljs-string">"shape"</span>: <span class="hljs-string">"circle"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"red"</span>}
  ] 
}
</code></pre>

<p>How can I do this?</p>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><h1 class="text-lg font-semibold mb-5">Navigate to solutions: </h1><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li><li class="pagination-solution-item"><span data-id="#solution3" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">3</span></li><li class="pagination-solution-item"><span data-id="#solution4" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">4</span></li><li class="pagination-solution-item"><span data-id="#solution5" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">5</span></li><li class="pagination-solution-item"><span data-id="#solution6" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">6</span></li><li class="pagination-solution-item"><span data-id="#solution7" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">7</span></li><li class="pagination-solution-item"><span data-id="#solution8" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">8</span></li><li class="pagination-solution-item"><span data-id="#solution9" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">9</span></li><li class="pagination-solution-item"><span data-id="#solution10" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">10</span></li><li class="pagination-solution-item"><span data-id="#solution11" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">11</span></li><li class="pagination-solution-item"><span data-id="#solution12" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">12</span></li><li class="pagination-solution-item"><span data-id="#solution13" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">13</span></li><li class="pagination-solution-item"><span data-id="#solution14" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">14</span></li><li class="pagination-solution-item"><span data-id="#solution15" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">15</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 1</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>MongoDB 2.2's new <a href="http://docs.mongodb.org/manual/reference/projection/elemMatch/" rel="noreferrer"><code>$elemMatch</code></a> projection operator provides another way to alter the returned document to contain only the <strong><em>first</em></strong> matched <code>shapes</code> element:</p>



<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>(
    {<span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>}, 
    {<span class="hljs-attr">_id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">shapes</span>: {<span class="hljs-attr">$elemMatch</span>: {<span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>}}});
</code></pre>

<p>Returns:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">{<span class="hljs-string">"shapes"</span> : [{<span class="hljs-string">"shape"</span>: <span class="hljs-string">"circle"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"red"</span>}]}
</code></pre>

<p>In 2.2 you can also do this using the <a href="http://docs.mongodb.org/manual/reference/operator/projection/positional/#proj._S_" rel="noreferrer"><code>$ projection operator</code></a>, where the <code>$</code> in a projection object field name represents the index of the field's first matching array element from the query.  The following returns the same results as above:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>({<span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>}, {<span class="hljs-attr">_id</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'shapes.$'</span>: <span class="hljs-number">1</span>});
</code></pre>

<p><strong>MongoDB 3.2 Update</strong></p>

<p>Starting with the 3.2 release, you can use the new <a href="https://docs.mongodb.org/master/reference/operator/aggregation/filter/#exp._S_filter" rel="noreferrer"><code>$filter</code></a> aggregation operator to filter an array during projection, which has the benefit of including <em>all</em> matches, instead of just the first one.</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">aggregate</span>([
    <span class="hljs-comment">// Get just the docs that contain a shapes element where color is 'red'</span>
    {<span class="hljs-attr">$match</span>: {<span class="hljs-string">'shapes.color'</span>: <span class="hljs-string">'red'</span>}},
    {<span class="hljs-attr">$project</span>: {
        <span class="hljs-attr">shapes</span>: {<span class="hljs-attr">$filter</span>: {
            <span class="hljs-attr">input</span>: <span class="hljs-string">'$shapes'</span>,
            <span class="hljs-attr">as</span>: <span class="hljs-string">'shape'</span>,
            <span class="hljs-attr">cond</span>: {<span class="hljs-attr">$eq</span>: [<span class="hljs-string">'$$shape.color'</span>, <span class="hljs-string">'red'</span>]}
        }},
        <span class="hljs-attr">_id</span>: <span class="hljs-number">0</span>
    }}
])
</code></pre>

<p>Results:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">[ 
    {
        <span class="hljs-string">"shapes"</span> : [ 
            {
                <span class="hljs-string">"shape"</span> : <span class="hljs-string">"circle"</span>,
                <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>
            }
        ]
    }
]
</code></pre>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 2</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The new <a href="http://docs.mongodb.org/manual/applications/aggregation/">Aggregation Framework</a> in MongoDB 2.2+ provides an alternative to Map/Reduce.  The <a href="http://docs.mongodb.org/manual/reference/aggregation/unwind/#_S_unwind"><code>$unwind</code></a> operator can be used to separate your <code>shapes</code> array into a stream of documents that can be matched:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">aggregate</span>(
  <span class="hljs-comment">// Start with a $match pipeline which can take advantage of an index and limit documents processed</span>
  { $match : {
     <span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>
  }},
  { $unwind : <span class="hljs-string">"$shapes"</span> },
  { $match : {
     <span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>
  }}
)
</code></pre>

<p>Results in:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">{
    <span class="hljs-string">"result"</span> : [
        {
            <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"504425059b7c9fa7ec92beec"</span>),
            <span class="hljs-string">"shapes"</span> : {
                <span class="hljs-string">"shape"</span> : <span class="hljs-string">"circle"</span>,
                <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>
            }
        }
    ],
    <span class="hljs-string">"ok"</span> : <span class="hljs-number">1</span>
}
</code></pre>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 3</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<blockquote>
  <p><strong>Caution:</strong> This answer provides a solution that was relevant <em>at that time</em>, before the new features of MongoDB 2.2 and up were introduced. See the other answers if you are using a more recent version of MongoDB.</p>
</blockquote>

<p>The field selector parameter is limited to complete properties. It cannot be used to select part of an array, only the entire array. I tried using the <a href="http://www.mongodb.org/display/DOCS/Updating#Updating-The%24positionaloperator" rel="noreferrer">$ positional operator</a>, but that didn't work.</p>

<p>The easiest way is to just filter the shapes <strong>in the client</strong>.</p>

<p>If you really <em>need</em> the correct output directly from MongoDB, you can <strong>use a map-reduce</strong> to filter the shapes.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">map</span>(<span class="hljs-params"></span>) {
  filteredShapes = [];

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">shapes</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">s</span>) {
    <span class="hljs-keyword">if</span> (s.<span class="hljs-property">color</span> === <span class="hljs-string">"red"</span>) {
      filteredShapes.<span class="hljs-title function_">push</span>(s);
    }
  });

  <span class="hljs-title function_">emit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_id</span>, { <span class="hljs-attr">shapes</span>: filteredShapes });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">reduce</span>(<span class="hljs-params">key, values</span>) {
  <span class="hljs-keyword">return</span> values[<span class="hljs-number">0</span>];
}

res = db.<span class="hljs-property">test</span>.<span class="hljs-title function_">mapReduce</span>(map, reduce, { <span class="hljs-attr">query</span>: { <span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span> } })

db[res.<span class="hljs-property">result</span>].<span class="hljs-title function_">find</span>()
</code></pre>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 4</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Another interesing way is to use <a href="http://docs.mongodb.org/manual/reference/operator/aggregation/redact/"><strong>$redact</strong></a>, which is one of the new aggregation features of <strong>MongoDB 2.6</strong>. If you are using 2.6, you don't need an $unwind which might cause you performance problems if you have large arrays. </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">aggregate</span>([
    { <span class="hljs-attr">$match</span>: { 
         <span class="hljs-attr">shapes</span>: { <span class="hljs-attr">$elemMatch</span>: {<span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>} } 
    }},
    { $redact : {
         <span class="hljs-attr">$cond</span>: {
             <span class="hljs-attr">if</span>: { $or : [{ <span class="hljs-attr">$eq</span>: [<span class="hljs-string">"$color"</span>,<span class="hljs-string">"red"</span>] }, { $not : <span class="hljs-string">"$color"</span> }]},
             <span class="hljs-attr">then</span>: <span class="hljs-string">"$$DESCEND"</span>,
             <span class="hljs-attr">else</span>: <span class="hljs-string">"$$PRUNE"</span>
         }
    }}]);
</code></pre>

<p><code>$redact</code> <em>"restricts the contents of the documents based on information stored in the documents themselves"</em>. So it will run only <em>inside of the document</em>. It basically scans your document top to the bottom, and checks if it matches with your <code>if</code> condition which is in <code>$cond</code>, if there is match it will either keep the content(<code>$$DESCEND</code>) or remove(<code>$$PRUNE</code>).</p>

<p>In the example  above, first <code>$match</code> returns the whole <code>shapes</code> array, and $redact strips it down to the expected result. </p>

<p>Note that <code>{$not:"$color"}</code> is necessary, because it will scan the top document as well, and if <code>$redact</code> does not find a <code>color</code> field on the top level this will return <code>false</code> that might strip the whole document which we don't want. </p>
    </div></div></div></div><div id="solution5" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 5</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Better you can query in matching array element using <code>$slice</code> is it helpful to returning the significant object in an array.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>({<span class="hljs-string">"shapes.color"</span> : <span class="hljs-string">"blue"</span>}, {<span class="hljs-string">"shapes.$"</span> : <span class="hljs-number">1</span>})
</code></pre>

<p><code>$slice</code> is helpful when you know the index of the element, but sometimes you want
whichever array element matched your criteria. You can return the matching element
with the <code>$</code> operator.</p>
    </div></div></div></div><div id="solution6" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 6</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<pre class="lang-js s-code-block"><code class="hljs language-javascript"> db.<span class="hljs-title function_">getCollection</span>(<span class="hljs-string">'aj'</span>).<span class="hljs-title function_">find</span>({<span class="hljs-string">"shapes.color"</span>:<span class="hljs-string">"red"</span>},{<span class="hljs-string">"shapes.$"</span>:<span class="hljs-number">1</span>})
</code></pre>

<p><em>OUTPUTS</em></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">{

   <span class="hljs-string">"shapes"</span> : [ 
       {
           <span class="hljs-string">"shape"</span> : <span class="hljs-string">"circle"</span>,
           <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>
       }
   ]
}
</code></pre>
    </div></div></div></div><div id="solution7" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 7</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The syntax for find in mongodb is </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">    db.&lt;collection name&gt;.<span class="hljs-title function_">find</span>(query, projection);
</code></pre>

<p>and the second query that you have written, that is</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">    db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>(
    {<span class="hljs-attr">shapes</span>: {<span class="hljs-string">"$elemMatch"</span>: {<span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>}}}, 
    {<span class="hljs-string">"shapes.color"</span>:<span class="hljs-number">1</span>})
</code></pre>

<p>in this you have used the <code>$elemMatch</code> operator in query part, whereas if you use this operator in the projection part then you will get the desired result. You can write down your query as </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">     db.<span class="hljs-property">users</span>.<span class="hljs-title function_">find</span>(
     {<span class="hljs-string">"shapes.color"</span>:<span class="hljs-string">"red"</span>},
     {<span class="hljs-attr">_id</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">shapes</span>: {$elemMatch : {<span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>}}})
</code></pre>

<p>This will give you the desired result.</p>
    </div></div></div></div><div id="solution8" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 8</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<h2>Thanks to <em><a href="https://stackoverflow.com/users/1259510/johnnyhk">JohnnyHK</a></em>.</h2>

<p>Here I just want to add some more complex usage.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// Document </span>
{ 
<span class="hljs-string">"_id"</span> : <span class="hljs-number">1</span>
<span class="hljs-string">"shapes"</span> : [
  {<span class="hljs-string">"shape"</span> : <span class="hljs-string">"square"</span>,  <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>},
  {<span class="hljs-string">"shape"</span> : <span class="hljs-string">"circle"</span>,  <span class="hljs-string">"color"</span> : <span class="hljs-string">"green"</span>}
  ] 
} 

{ 
<span class="hljs-string">"_id"</span> : <span class="hljs-number">2</span>
<span class="hljs-string">"shapes"</span> : [
  {<span class="hljs-string">"shape"</span> : <span class="hljs-string">"square"</span>,  <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>},
  {<span class="hljs-string">"shape"</span> : <span class="hljs-string">"circle"</span>,  <span class="hljs-string">"color"</span> : <span class="hljs-string">"green"</span>}
  ] 
} 


<span class="hljs-comment">// The Query   </span>
db.<span class="hljs-property">contents</span>.<span class="hljs-title function_">find</span>({
    <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-number">1</span>),
    <span class="hljs-string">"shapes.color"</span>:<span class="hljs-string">"red"</span>
},{
    <span class="hljs-string">"_id"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">"shapes"</span> :{
       <span class="hljs-string">"$elemMatch"</span>:{
           <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>
       } 
    }
}) 


<span class="hljs-comment">//And the Result</span>

{<span class="hljs-string">"shapes"</span>:[
    {
       <span class="hljs-string">"shape"</span> : <span class="hljs-string">"square"</span>,
       <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>
    }
]}
</code></pre>
    </div></div></div></div><div id="solution9" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 9</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You just need to run query</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>(
{<span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>}, 
{<span class="hljs-attr">shapes</span>: {<span class="hljs-attr">$elemMatch</span>: {<span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>}}});
</code></pre>

<p>output of this query is</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">{
    <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"562e7c594c12942f08fe4192"</span>),
    <span class="hljs-string">"shapes"</span> : [ 
        {<span class="hljs-string">"shape"</span> : <span class="hljs-string">"circle"</span>, <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>}
    ]
}
</code></pre>

<p>as you expected it'll gives the exact field from array that matches color:'red'.</p>
    </div></div></div></div><div id="solution10" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 10</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Along with  <code>$project</code> it will be more appropriate  other wise matching elements will be clubbed together with other elements in document.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">aggregate</span>(
  { <span class="hljs-string">"$unwind"</span> : <span class="hljs-string">"$shapes"</span> },
  { <span class="hljs-string">"$match"</span> : { <span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span> } },
  { 
    <span class="hljs-string">"$project"</span>: {
      <span class="hljs-string">"_id"</span>:<span class="hljs-number">1</span>,
      <span class="hljs-string">"item"</span>:<span class="hljs-number">1</span>
    }
  }
)
</code></pre>
    </div></div></div></div><div id="solution11" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 11</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Likewise you can find for the multiple</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-title function_">getCollection</span>(<span class="hljs-string">'localData'</span>).<span class="hljs-title function_">aggregate</span>([
    <span class="hljs-comment">// Get just the docs that contain a shapes element where color is 'red'</span>
  {<span class="hljs-attr">$match</span>: {<span class="hljs-string">'shapes.color'</span>: {$in : [<span class="hljs-string">'red'</span>,<span class="hljs-string">'yellow'</span>] } }},
  {<span class="hljs-attr">$project</span>: {
     <span class="hljs-attr">shapes</span>: {<span class="hljs-attr">$filter</span>: {
        <span class="hljs-attr">input</span>: <span class="hljs-string">'$shapes'</span>,
        <span class="hljs-attr">as</span>: <span class="hljs-string">'shape'</span>,
        <span class="hljs-attr">cond</span>: {<span class="hljs-attr">$in</span>: [<span class="hljs-string">'$$shape.color'</span>, [<span class="hljs-string">'red'</span>, <span class="hljs-string">'yellow'</span>]]}
     }}
  }}
])
</code></pre>
    </div></div></div></div><div id="solution12" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 12</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>( {<span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>}, {<span class="hljs-attr">_id</span>: <span class="hljs-number">0</span>})
</code></pre>
    </div></div></div></div><div id="solution13" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 13</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Use aggregation function and <code>$project</code> to get specific object field in document</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-title function_">getCollection</span>(<span class="hljs-string">'geolocations'</span>).<span class="hljs-title function_">aggregate</span>([ { $project : { geolocation : <span class="hljs-number">1</span>} } ])
</code></pre>

<p><strong>result:</strong></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">{
    <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"5e3ee15968879c0d5942464b"</span>),
    <span class="hljs-string">"geolocation"</span> : [ 
        {
            <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"5e3ee3ee68879c0d5942465e"</span>),
            <span class="hljs-string">"latitude"</span> : <span class="hljs-number">12.9718313</span>,
            <span class="hljs-string">"longitude"</span> : <span class="hljs-number">77.593551</span>,
            <span class="hljs-string">"country"</span> : <span class="hljs-string">"India"</span>,
            <span class="hljs-string">"city"</span> : <span class="hljs-string">"Chennai"</span>,
            <span class="hljs-string">"zipcode"</span> : <span class="hljs-string">"560001"</span>,
            <span class="hljs-string">"streetName"</span> : <span class="hljs-string">"Sidney Road"</span>,
            <span class="hljs-string">"countryCode"</span> : <span class="hljs-string">"in"</span>,
            <span class="hljs-string">"ip"</span> : <span class="hljs-string">"116.75.115.248"</span>,
            <span class="hljs-string">"date"</span> : <span class="hljs-title class_">ISODate</span>(<span class="hljs-string">"2020-02-08T16:38:06.584Z"</span>)
        }
    ]
}
</code></pre>
    </div></div></div></div><div id="solution14" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 14</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Although the question was asked 9.6 years ago, this has been of immense help to numerous people, me being one of them. Thank you everyone for all your queries, hints and answers. Picking up from one of the answers here.. I found that the following method can also be used to project other fields in the parent document.This may be helpful to someone. </p>

<p>For the following document, the need was to find out if an employee (emp #7839) has his leave history set for the year 2020. Leave history is implemented as an embedded document within the parent Employee document. </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">employees</span>.<span class="hljs-title function_">find</span>( {<span class="hljs-string">"leave_history.calendar_year"</span>: <span class="hljs-number">2020</span>}, 
    {<span class="hljs-attr">leave_history</span>: {<span class="hljs-attr">$elemMatch</span>: {<span class="hljs-attr">calendar_year</span>: <span class="hljs-number">2020</span>}},<span class="hljs-attr">empno</span>:<span class="hljs-literal">true</span>,<span class="hljs-attr">ename</span>:<span class="hljs-literal">true</span>}).<span class="hljs-title function_">pretty</span>(<span class="hljs-params"></span>)


{
        <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"5e907ad23997181dde06e8fc"</span>),
        <span class="hljs-string">"empno"</span> : <span class="hljs-number">7839</span>,
        <span class="hljs-string">"ename"</span> : <span class="hljs-string">"KING"</span>,
        <span class="hljs-string">"mgrno"</span> : <span class="hljs-number">0</span>,
        <span class="hljs-string">"hiredate"</span> : <span class="hljs-string">"1990-05-09"</span>,
        <span class="hljs-string">"sal"</span> : <span class="hljs-number">100000</span>,
        <span class="hljs-string">"deptno"</span> : {
                <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"5e9065f53997181dde06e8f8"</span>)
        },
        <span class="hljs-string">"username"</span> : <span class="hljs-string">"none"</span>,
        <span class="hljs-string">"password"</span> : <span class="hljs-string">"none"</span>,
        <span class="hljs-string">"is_admin"</span> : <span class="hljs-string">"N"</span>,
        <span class="hljs-string">"is_approver"</span> : <span class="hljs-string">"Y"</span>,
        <span class="hljs-string">"is_manager"</span> : <span class="hljs-string">"Y"</span>,
        <span class="hljs-string">"user_role"</span> : <span class="hljs-string">"AP"</span>,
        <span class="hljs-string">"admin_approval_received"</span> : <span class="hljs-string">"Y"</span>,
        <span class="hljs-string">"active"</span> : <span class="hljs-string">"Y"</span>,
        <span class="hljs-string">"created_date"</span> : <span class="hljs-string">"2020-04-10"</span>,
        <span class="hljs-string">"updated_date"</span> : <span class="hljs-string">"2020-04-10"</span>,
        <span class="hljs-string">"application_usage_log"</span> : [
                {
                        <span class="hljs-string">"logged_in_as"</span> : <span class="hljs-string">"AP"</span>,
                        <span class="hljs-string">"log_in_date"</span> : <span class="hljs-string">"2020-04-10"</span>
                },
                {
                        <span class="hljs-string">"logged_in_as"</span> : <span class="hljs-string">"EM"</span>,
                        <span class="hljs-string">"log_in_date"</span> : <span class="hljs-title class_">ISODate</span>(<span class="hljs-string">"2020-04-16T07:28:11.959Z"</span>)
                }
        ],
        <span class="hljs-string">"leave_history"</span> : [
                {
                        <span class="hljs-string">"calendar_year"</span> : <span class="hljs-number">2020</span>,
                        <span class="hljs-string">"pl_used"</span> : <span class="hljs-number">0</span>,
                        <span class="hljs-string">"cl_used"</span> : <span class="hljs-number">0</span>,
                        <span class="hljs-string">"sl_used"</span> : <span class="hljs-number">0</span>
                },
                {
                        <span class="hljs-string">"calendar_year"</span> : <span class="hljs-number">2021</span>,
                        <span class="hljs-string">"pl_used"</span> : <span class="hljs-number">0</span>,
                        <span class="hljs-string">"cl_used"</span> : <span class="hljs-number">0</span>,
                        <span class="hljs-string">"sl_used"</span> : <span class="hljs-number">0</span>
                }
        ]
}
</code></pre>
    </div></div></div></div><div id="solution15" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 15</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/projection">projection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>if you want to do <strong>filter, set and find</strong> at the same time.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">let</span> post = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Post</span>.<span class="hljs-title function_">findOneAndUpdate</span>(
          {
            <span class="hljs-attr">_id</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>,
            <span class="hljs-attr">tasks</span>: {
              <span class="hljs-attr">$elemMatch</span>: {
                <span class="hljs-attr">id</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">jobId</span>,
                date,
              },
            },
          },
          {
            <span class="hljs-attr">$set</span>: {
              <span class="hljs-string">'jobs.$[i].performer'</span>: performer,
              <span class="hljs-string">'jobs.$[i].status'</span>: status,
              <span class="hljs-string">'jobs.$[i].type'</span>: type,
            },
          },
          {
            <span class="hljs-attr">arrayFilters</span>: [
              {
                <span class="hljs-string">'i.id'</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">jobId</span>,
              },
            ],
            <span class="hljs-attr">new</span>: <span class="hljs-literal">true</span>,
          }
        );
</code></pre>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/the-definitive-guide-to-form-based-website-authentication-closed-1657388456475">The definitive guide to form-based website authentication [closed]</a><a href="/questions/unfortunately-myapp-has-stopped.-how-can-i-solve-this-1657384402171">Unfortunately MyApp has stopped. How can I solve this?</a><a href="/questions/why-does-jquery-or-a-dom-method-such-as-getelementbyid-not-find-the-element-1657384326458">Why does jQuery or a DOM method such as getElementById not find the element?</a><a href="/questions/r-cannot-be-resolved-android-error-1657388526258">R cannot be resolved - Android error</a><a href="/questions/how-to-fix-java.lang.unsupportedclassversionerror:-unsupported-major.minor-version-1657384863422">How to fix java.lang.UnsupportedClassVersionError: Unsupported major.minor version</a><a href="/questions/relative-imports-for-the-billionth-time-1657387756383">Relative imports for the billionth time</a><a href="/questions/what-is-dom-event-delegation-1657387625599">What is DOM Event delegation?</a><a href="/questions/srand()-why-call-it-only-once-1657387794760">srand()  why call it only once?</a><a href="/questions/how-to-compare-arrays-in-javascript-1657387352277">How to compare arrays in JavaScript?</a><a href="/questions/why-is-%22while(-!feof(file)-)%22-always-wrong-1657384367349">Why is while( !feof(file) ) always wrong?</a><a href="/questions/the-3-different-equals-1657385490242">The 3 different equals</a><a href="/questions/css-selector-for-first-element-with-class-1657388028765">CSS selector for first element with class</a><a href="/questions/how-to-remove-items-from-a-list-while-iterating-1657384496375">How to remove items from a list while iterating?</a><a href="/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725">How do I write a correct micro-benchmark in Java?</a><a href="/questions/actual-meaning-of-&#x27;shelltrue&#x27;-in-subprocess-1657388470341">Actual meaning of &#x27;shell=True&#x27; in subprocess</a><a href="/questions/submit-same-partial-view-called-multiple-times-data-to-controller-1657387887213">Submit same Partial View called multiple times data to controller?</a><a href="/questions/the-model-item-passed-into-the-dictionary-is-of-type-..-but-this-dictionary-requires-a-model-item-of-type-1657388480874">The model item passed into the dictionary is of type .. but this dictionary requires a model item of type</a><a href="/questions/what-is-event-bubbling-and-capturing-1657388059203">What is event bubbling and capturing?</a><a href="/questions/can-a-local-variable&#x27;s-memory-be-accessed-outside-its-scope-1657384460386">Can a local variable&#x27;s memory be accessed outside its scope?</a><a href="/questions/how-can-i-transition-height:-0-to-height:-auto-using-css-1657388022100">How can I transition height: 0; to height: auto; using CSS?</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;MongoDB 2.2\u0026apos;s new \u0026lt;a href=\u0026quot;http://docs.mongodb.org/manual/reference/projection/elemMatch/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;$elemMatch\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; projection operator provides another way to alter the returned document to contain only the \u0026lt;strong\u0026gt;\u0026lt;em\u0026gt;first\u0026lt;/em\u0026gt;\u0026lt;/strong\u0026gt; matched \u0026lt;code\u0026gt;shapes\u0026lt;/code\u0026gt; element:\u0026lt;/p\u0026gt;\n\n\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;(\n    {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}, \n    {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$elemMatch\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}}});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Returns:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : [{\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}]}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;In 2.2 you can also do this using the \u0026lt;a href=\u0026quot;http://docs.mongodb.org/manual/reference/operator/projection/positional/#proj._S_\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;$ projection operator\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;, where the \u0026lt;code\u0026gt;$\u0026lt;/code\u0026gt; in a projection object field name represents the index of the field\u0026apos;s first matching array element from the query.  The following returns the same results as above:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;({\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}, {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;shapes.$\u0026apos;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;MongoDB 3.2 Update\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Starting with the 3.2 release, you can use the new \u0026lt;a href=\u0026quot;https://docs.mongodb.org/master/reference/operator/aggregation/filter/#exp._S_filter\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;$filter\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; aggregation operator to filter an array during projection, which has the benefit of including \u0026lt;em\u0026gt;all\u0026lt;/em\u0026gt; matches, instead of just the first one.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;aggregate\u0026lt;/span\u0026gt;([\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Get just the docs that contain a shapes element where color is \u0026apos;red\u0026apos;\u0026lt;/span\u0026gt;\n    {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$match\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;shapes.color\u0026apos;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;red\u0026apos;\u0026lt;/span\u0026gt;}},\n    {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$project\u0026lt;/span\u0026gt;: {\n        \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$filter\u0026lt;/span\u0026gt;: {\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;input\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$shapes\u0026apos;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;shape\u0026apos;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;cond\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$eq\u0026lt;/span\u0026gt;: [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$$shape.color\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;red\u0026apos;\u0026lt;/span\u0026gt;]}\n        }},\n        \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n    }}\n])\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Results:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;[ \n    {\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : [ \n            {\n                \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,\n                \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n            }\n        ]\n    }\n]\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The new \u0026lt;a href=\u0026quot;http://docs.mongodb.org/manual/applications/aggregation/\u0026quot;\u0026gt;Aggregation Framework\u0026lt;/a\u0026gt; in MongoDB 2.2+ provides an alternative to Map/Reduce.  The \u0026lt;a href=\u0026quot;http://docs.mongodb.org/manual/reference/aggregation/unwind/#_S_unwind\u0026quot;\u0026gt;\u0026lt;code\u0026gt;$unwind\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; operator can be used to separate your \u0026lt;code\u0026gt;shapes\u0026lt;/code\u0026gt; array into a stream of documents that can be matched:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;aggregate\u0026lt;/span\u0026gt;(\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Start with a $match pipeline which can take advantage of an index and limit documents processed\u0026lt;/span\u0026gt;\n  { $match : {\n     \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n  }},\n  { $unwind : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$shapes\u0026quot;\u0026lt;/span\u0026gt; },\n  { $match : {\n     \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n  }}\n)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Results in:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;result\u0026quot;\u0026lt;/span\u0026gt; : [\n        {\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;504425059b7c9fa7ec92beec\u0026quot;\u0026lt;/span\u0026gt;),\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : {\n                \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,\n                \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n            }\n        }\n    ],\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ok\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Caution:\u0026lt;/strong\u0026gt; This answer provides a solution that was relevant \u0026lt;em\u0026gt;at that time\u0026lt;/em\u0026gt;, before the new features of MongoDB 2.2 and up were introduced. See the other answers if you are using a more recent version of MongoDB.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;The field selector parameter is limited to complete properties. It cannot be used to select part of an array, only the entire array. I tried using the \u0026lt;a href=\u0026quot;http://www.mongodb.org/display/DOCS/Updating#Updating-The%24positionaloperator\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;$ positional operator\u0026lt;/a\u0026gt;, but that didn\u0026apos;t work.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The easiest way is to just filter the shapes \u0026lt;strong\u0026gt;in the client\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;If you really \u0026lt;em\u0026gt;need\u0026lt;/em\u0026gt; the correct output directly from MongoDB, you can \u0026lt;strong\u0026gt;use a map-reduce\u0026lt;/strong\u0026gt; to filter the shapes.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n  filteredShapes = [];\n\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;s\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (s.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt; === \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;) {\n      filteredShapes.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(s);\n    }\n  });\n\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;emit\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;, { \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: filteredShapes });\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reduce\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;key, values\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; values[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;];\n}\n\nres = db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;mapReduce\u0026lt;/span\u0026gt;(map, reduce, { \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;query\u0026lt;/span\u0026gt;: { \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt; } })\n\ndb[res.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;result\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;()\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Another interesing way is to use \u0026lt;a href=\u0026quot;http://docs.mongodb.org/manual/reference/operator/aggregation/redact/\u0026quot;\u0026gt;\u0026lt;strong\u0026gt;$redact\u0026lt;/strong\u0026gt;\u0026lt;/a\u0026gt;, which is one of the new aggregation features of \u0026lt;strong\u0026gt;MongoDB 2.6\u0026lt;/strong\u0026gt;. If you are using 2.6, you don\u0026apos;t need an $unwind which might cause you performance problems if you have large arrays. \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;aggregate\u0026lt;/span\u0026gt;([\n    { \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$match\u0026lt;/span\u0026gt;: { \n         \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: { \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$elemMatch\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;} } \n    }},\n    { $redact : {\n         \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$cond\u0026lt;/span\u0026gt;: {\n             \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;: { $or : [{ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$eq\u0026lt;/span\u0026gt;: [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$color\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;] }, { $not : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$color\u0026quot;\u0026lt;/span\u0026gt; }]},\n             \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$$DESCEND\u0026quot;\u0026lt;/span\u0026gt;,\n             \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$$PRUNE\u0026quot;\u0026lt;/span\u0026gt;\n         }\n    }}]);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;$redact\u0026lt;/code\u0026gt; \u0026lt;em\u0026gt;\u0026quot;restricts the contents of the documents based on information stored in the documents themselves\u0026quot;\u0026lt;/em\u0026gt;. So it will run only \u0026lt;em\u0026gt;inside of the document\u0026lt;/em\u0026gt;. It basically scans your document top to the bottom, and checks if it matches with your \u0026lt;code\u0026gt;if\u0026lt;/code\u0026gt; condition which is in \u0026lt;code\u0026gt;$cond\u0026lt;/code\u0026gt;, if there is match it will either keep the content(\u0026lt;code\u0026gt;$$DESCEND\u0026lt;/code\u0026gt;) or remove(\u0026lt;code\u0026gt;$$PRUNE\u0026lt;/code\u0026gt;).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;In the example  above, first \u0026lt;code\u0026gt;$match\u0026lt;/code\u0026gt; returns the whole \u0026lt;code\u0026gt;shapes\u0026lt;/code\u0026gt; array, and $redact strips it down to the expected result. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Note that \u0026lt;code\u0026gt;{$not:\u0026quot;$color\u0026quot;}\u0026lt;/code\u0026gt; is necessary, because it will scan the top document as well, and if \u0026lt;code\u0026gt;$redact\u0026lt;/code\u0026gt; does not find a \u0026lt;code\u0026gt;color\u0026lt;/code\u0026gt; field on the top level this will return \u0026lt;code\u0026gt;false\u0026lt;/code\u0026gt; that might strip the whole document which we don\u0026apos;t want. \u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Better you can query in matching array element using \u0026lt;code\u0026gt;$slice\u0026lt;/code\u0026gt; is it helpful to returning the significant object in an array.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;({\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;blue\u0026quot;\u0026lt;/span\u0026gt;}, {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.$\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;$slice\u0026lt;/code\u0026gt; is helpful when you know the index of the element, but sometimes you want\nwhichever array element matched your criteria. You can return the matching element\nwith the \u0026lt;code\u0026gt;$\u0026lt;/code\u0026gt; operator.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt; db.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getCollection\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;aj\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;({\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;},{\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.$\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;OUTPUTS\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{\n\n   \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : [ \n       {\n           \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,\n           \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n       }\n   ]\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The syntax for find in mongodb is \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    db.\u0026amp;lt;collection name\u0026amp;gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;(query, projection);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;and the second query that you have written, that is\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;(\n    {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$elemMatch\u0026quot;\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}}}, \n    {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;in this you have used the \u0026lt;code\u0026gt;$elemMatch\u0026lt;/code\u0026gt; operator in query part, whereas if you use this operator in the projection part then you will get the desired result. You can write down your query as \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;     db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;users\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;(\n     {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;},\n     {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {$elemMatch : {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}}})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;This will give you the desired result.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;h2\u0026gt;Thanks to \u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;https://stackoverflow.com/users/1259510/johnnyhk\u0026quot;\u0026gt;JohnnyHK\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;.\u0026lt;/h2\u0026gt;\n\n\u0026lt;p\u0026gt;Here I just want to add some more complex usage.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Document \u0026lt;/span\u0026gt;\n{ \n\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : [\n  {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;square\u0026quot;\u0026lt;/span\u0026gt;,  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;},\n  {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;green\u0026quot;\u0026lt;/span\u0026gt;}\n  ] \n} \n\n{ \n\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : [\n  {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;square\u0026quot;\u0026lt;/span\u0026gt;,  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;},\n  {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;green\u0026quot;\u0026lt;/span\u0026gt;}\n  ] \n} \n\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// The Query   \u0026lt;/span\u0026gt;\ndb.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;contents\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;({\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;),\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n},{\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; :{\n       \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$elemMatch\u0026quot;\u0026lt;/span\u0026gt;:{\n           \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n       } \n    }\n}) \n\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//And the Result\u0026lt;/span\u0026gt;\n\n{\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt;:[\n    {\n       \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;square\u0026quot;\u0026lt;/span\u0026gt;,\n       \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n    }\n]}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;You just need to run query\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;(\n{\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}, \n{\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$elemMatch\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}}});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;output of this query is\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;562e7c594c12942f08fe4192\u0026quot;\u0026lt;/span\u0026gt;),\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : [ \n        {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}\n    ]\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;as you expected it\u0026apos;ll gives the exact field from array that matches color:\u0026apos;red\u0026apos;.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Along with  \u0026lt;code\u0026gt;$project\u0026lt;/code\u0026gt; it will be more appropriate  other wise matching elements will be clubbed together with other elements in document.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;aggregate\u0026lt;/span\u0026gt;(\n  { \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$unwind\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$shapes\u0026quot;\u0026lt;/span\u0026gt; },\n  { \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$match\u0026quot;\u0026lt;/span\u0026gt; : { \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt; } },\n  { \n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$project\u0026quot;\u0026lt;/span\u0026gt;: {\n      \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\n      \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;item\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n    }\n  }\n)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Likewise you can find for the multiple\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getCollection\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;localData\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;aggregate\u0026lt;/span\u0026gt;([\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Get just the docs that contain a shapes element where color is \u0026apos;red\u0026apos;\u0026lt;/span\u0026gt;\n  {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$match\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;shapes.color\u0026apos;\u0026lt;/span\u0026gt;: {$in : [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;red\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;yellow\u0026apos;\u0026lt;/span\u0026gt;] } }},\n  {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$project\u0026lt;/span\u0026gt;: {\n     \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$filter\u0026lt;/span\u0026gt;: {\n        \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;input\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$shapes\u0026apos;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;shape\u0026apos;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;cond\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$in\u0026lt;/span\u0026gt;: [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$$shape.color\u0026apos;\u0026lt;/span\u0026gt;, [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;red\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;yellow\u0026apos;\u0026lt;/span\u0026gt;]]}\n     }}\n  }}\n])\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;( {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}, {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Use aggregation function and \u0026lt;code\u0026gt;$project\u0026lt;/code\u0026gt; to get specific object field in document\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getCollection\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;geolocations\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;aggregate\u0026lt;/span\u0026gt;([ { $project : { geolocation : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;} } ])\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;result:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;5e3ee15968879c0d5942464b\u0026quot;\u0026lt;/span\u0026gt;),\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;geolocation\u0026quot;\u0026lt;/span\u0026gt; : [ \n        {\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;5e3ee3ee68879c0d5942465e\u0026quot;\u0026lt;/span\u0026gt;),\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;latitude\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;12.9718313\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;longitude\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;77.593551\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;country\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;India\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;city\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Chennai\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;zipcode\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;560001\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;streetName\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Sidney Road\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;countryCode\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;in\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ip\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;116.75.115.248\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;date\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ISODate\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;2020-02-08T16:38:06.584Z\u0026quot;\u0026lt;/span\u0026gt;)\n        }\n    ]\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Although the question was asked 9.6 years ago, this has been of immense help to numerous people, me being one of them. Thank you everyone for all your queries, hints and answers. Picking up from one of the answers here.. I found that the following method can also be used to project other fields in the parent document.This may be helpful to someone. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For the following document, the need was to find out if an employee (emp #7839) has his leave history set for the year 2020. Leave history is implemented as an embedded document within the parent Employee document. \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;employees\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;( {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;leave_history.calendar_year\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2020\u0026lt;/span\u0026gt;}, \n    {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;leave_history\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$elemMatch\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;calendar_year\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2020\u0026lt;/span\u0026gt;}},\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;empno\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;ename\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;}).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;pretty\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;)\n\n\n{\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;5e907ad23997181dde06e8fc\u0026quot;\u0026lt;/span\u0026gt;),\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;empno\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;7839\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ename\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;KING\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;mgrno\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;hiredate\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;1990-05-09\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sal\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100000\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deptno\u0026quot;\u0026lt;/span\u0026gt; : {\n                \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;5e9065f53997181dde06e8f8\u0026quot;\u0026lt;/span\u0026gt;)\n        },\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;username\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;none\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;password\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;none\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;is_admin\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;N\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;is_approver\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Y\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;is_manager\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Y\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;user_role\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;AP\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;admin_approval_received\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Y\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;active\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Y\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;created_date\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;2020-04-10\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;updated_date\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;2020-04-10\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;application_usage_log\u0026quot;\u0026lt;/span\u0026gt; : [\n                {\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;logged_in_as\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;AP\u0026quot;\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;log_in_date\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;2020-04-10\u0026quot;\u0026lt;/span\u0026gt;\n                },\n                {\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;logged_in_as\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;EM\u0026quot;\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;log_in_date\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ISODate\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;2020-04-16T07:28:11.959Z\u0026quot;\u0026lt;/span\u0026gt;)\n                }\n        ],\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;leave_history\u0026quot;\u0026lt;/span\u0026gt; : [\n                {\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;calendar_year\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2020\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;pl_used\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;cl_used\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sl_used\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n                },\n                {\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;calendar_year\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2021\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;pl_used\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;cl_used\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sl_used\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n                }\n        ]\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;if you want to do \u0026lt;strong\u0026gt;filter, set and find\u0026lt;/strong\u0026gt; at the same time.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; post = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Post\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;findOneAndUpdate\u0026lt;/span\u0026gt;(\n          {\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;: req.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;params\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;tasks\u0026lt;/span\u0026gt;: {\n              \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$elemMatch\u0026lt;/span\u0026gt;: {\n                \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;: req.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;params\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;jobId\u0026lt;/span\u0026gt;,\n                date,\n              },\n            },\n          },\n          {\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$set\u0026lt;/span\u0026gt;: {\n              \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;jobs.$[i].performer\u0026apos;\u0026lt;/span\u0026gt;: performer,\n              \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;jobs.$[i].status\u0026apos;\u0026lt;/span\u0026gt;: status,\n              \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;jobs.$[i].type\u0026apos;\u0026lt;/span\u0026gt;: type,\n            },\n          },\n          {\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;arrayFilters\u0026lt;/span\u0026gt;: [\n              {\n                \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;i.id\u0026apos;\u0026lt;/span\u0026gt;: req.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;params\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;jobId\u0026lt;/span\u0026gt;,\n              },\n            ],\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;,\n          }\n        );\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    "],"id":184,"title":"Retrieve only the queried element in an object array in MongoDB collection","content":"\n                \n\n\n\u0026lt;p\u0026gt;Suppose you have the following documents in my collection:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{  \n   \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;562e7c594c12942f08fe4192\u0026quot;\u0026lt;/span\u0026gt;),\n   \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt;:[  \n      {  \n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;square\u0026quot;\u0026lt;/span\u0026gt;,\n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;blue\u0026quot;\u0026lt;/span\u0026gt;\n      },\n      {  \n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,\n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n      }\n   ]\n},\n{  \n   \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;562e7c594c12942f08fe4193\u0026quot;\u0026lt;/span\u0026gt;),\n   \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt;:[  \n      {  \n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;square\u0026quot;\u0026lt;/span\u0026gt;,\n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;black\u0026quot;\u0026lt;/span\u0026gt;\n      },\n      {  \n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,\n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;green\u0026quot;\u0026lt;/span\u0026gt;\n      }\n   ]\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;Do query:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;({\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}, {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Or\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;({\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$elemMatch\u0026quot;\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}}}, {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;Returns matched document \u0026lt;em\u0026gt;(Document 1)\u0026lt;/em\u0026gt;, but always with ALL array items in \u0026lt;code\u0026gt;shapes\u0026lt;/code\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{ \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt;: \n  [\n    {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;square\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;blue\u0026quot;\u0026lt;/span\u0026gt;},\n    {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}\n  ] \n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;However, I\u0026apos;d like to get the document \u0026lt;em\u0026gt;(Document 1)\u0026lt;/em\u0026gt; only with the array that contains \u0026lt;code\u0026gt;color=red\u0026lt;/code\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{ \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt;: \n  [\n    {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}\n  ] \n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;How can I do this?\u0026lt;/p\u0026gt;\n    ","slug":"retrieve-only-the-queried-element-in-an-object-array-in-mongodb-collection-1657384890457","postType":"QUESTION","createdAt":"2022-07-09T16:41:30.000Z","updatedAt":"2022-07-09T16:41:30.000Z","tags":[{"id":675,"name":"mongodb","slug":"mongodb","createdAt":"2022-07-09T16:41:30.000Z","updatedAt":"2022-07-09T16:41:30.000Z","Questions_Tags":{"questionId":184,"tagId":675}},{"id":676,"name":"mongodb-query","slug":"mongodb-query","createdAt":"2022-07-09T16:41:30.000Z","updatedAt":"2022-07-09T16:41:30.000Z","Questions_Tags":{"questionId":184,"tagId":676}},{"id":677,"name":"aggregation-framework","slug":"aggregation-framework","createdAt":"2022-07-09T16:41:30.000Z","updatedAt":"2022-07-09T16:41:30.000Z","Questions_Tags":{"questionId":184,"tagId":677}},{"id":678,"name":"projection","slug":"projection","createdAt":"2022-07-09T16:41:30.000Z","updatedAt":"2022-07-09T16:41:30.000Z","Questions_Tags":{"questionId":184,"tagId":678}}],"relatedQuestions":[{"title":"Retrieve only the queried element in an object array in MongoDB collection","slug":"retrieve-only-the-queried-element-in-an-object-array-in-mongodb-collection-1657384890457","tags":[{"name":"mongodb","Questions_Tags":{"questionId":184,"tagId":675}},{"name":"mongodb-query","Questions_Tags":{"questionId":184,"tagId":676}},{"name":"aggregation-framework","Questions_Tags":{"questionId":184,"tagId":677}},{"name":"projection","Questions_Tags":{"questionId":184,"tagId":678}}]}]},"randomQuestions":[{"title":"The definitive guide to form-based website authentication [closed]","slug":"the-definitive-guide-to-form-based-website-authentication-closed-1657388456475"},{"title":"Unfortunately MyApp has stopped. How can I solve this?","slug":"unfortunately-myapp-has-stopped.-how-can-i-solve-this-1657384402171"},{"title":"Why does jQuery or a DOM method such as getElementById not find the element?","slug":"why-does-jquery-or-a-dom-method-such-as-getelementbyid-not-find-the-element-1657384326458"},{"title":"R cannot be resolved - Android error","slug":"r-cannot-be-resolved-android-error-1657388526258"},{"title":"How to fix java.lang.UnsupportedClassVersionError: Unsupported major.minor version","slug":"how-to-fix-java.lang.unsupportedclassversionerror:-unsupported-major.minor-version-1657384863422"},{"title":"Relative imports for the billionth time","slug":"relative-imports-for-the-billionth-time-1657387756383"},{"title":"What is DOM Event delegation?","slug":"what-is-dom-event-delegation-1657387625599"},{"title":"srand()  why call it only once?","slug":"srand()-why-call-it-only-once-1657387794760"},{"title":"How to compare arrays in JavaScript?","slug":"how-to-compare-arrays-in-javascript-1657387352277"},{"title":"Why is while( !feof(file) ) always wrong?","slug":"why-is-\"while(-!feof(file)-)\"-always-wrong-1657384367349"},{"title":"The 3 different equals","slug":"the-3-different-equals-1657385490242"},{"title":"CSS selector for first element with class","slug":"css-selector-for-first-element-with-class-1657388028765"},{"title":"How to remove items from a list while iterating?","slug":"how-to-remove-items-from-a-list-while-iterating-1657384496375"},{"title":"How do I write a correct micro-benchmark in Java?","slug":"how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725"},{"title":"Actual meaning of 'shell=True' in subprocess","slug":"actual-meaning-of-'shelltrue'-in-subprocess-1657388470341"},{"title":"Submit same Partial View called multiple times data to controller?","slug":"submit-same-partial-view-called-multiple-times-data-to-controller-1657387887213"},{"title":"The model item passed into the dictionary is of type .. but this dictionary requires a model item of type","slug":"the-model-item-passed-into-the-dictionary-is-of-type-..-but-this-dictionary-requires-a-model-item-of-type-1657388480874"},{"title":"What is event bubbling and capturing?","slug":"what-is-event-bubbling-and-capturing-1657388059203"},{"title":"Can a local variable's memory be accessed outside its scope?","slug":"can-a-local-variable's-memory-be-accessed-outside-its-scope-1657384460386"},{"title":"How can I transition height: 0; to height: auto; using CSS?","slug":"how-can-i-transition-height:-0-to-height:-auto-using-css-1657388022100"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"retrieve-only-the-queried-element-in-an-object-array-in-mongodb-collection-1657384890457"},"buildId":"00bsHgHZki2FteshOatnd","isFallback":false,"gsp":true,"locale":"en","locales":["en"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>