{"pageProps":{"data":{"count":1,"rows":[{"id":486,"title":"When to use virtual destructors?","slug":"when-to-use-virtual-destructors-1657388152135","postType":"QUESTION","createdAt":"2022-07-09T17:35:52.000Z","updatedAt":"2022-07-09T17:35:52.000Z","tags":[{"id":2448,"name":"shared-ptr","slug":"shared-ptr","createdAt":"2022-07-09T17:35:52.000Z","updatedAt":"2022-07-09T17:35:52.000Z","Questions_Tags":{"questionId":486,"tagId":2448}}]}]},"slug":"shared-ptr","page":1,"answers":{"486":["\n&lt;p&gt;Virtual destructors are useful when you might potentially delete an instance of a derived class through a pointer to base class:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Base&lt;/span&gt; \n{\n    &lt;span class=&quot;hljs-comment&quot;&gt;// some virtual methods&lt;/span&gt;\n};\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Derived&lt;/span&gt; : &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Base\n{\n    ~&lt;span class=&quot;hljs-built_in&quot;&gt;Derived&lt;/span&gt;()\n    {\n        &lt;span class=&quot;hljs-comment&quot;&gt;// Do some important cleanup&lt;/span&gt;\n    }\n};\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Here, you&apos;ll notice that I didn&apos;t declare Base&apos;s destructor to be &lt;code&gt;virtual&lt;/code&gt;. Now, let&apos;s have a look at the following snippet:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;Base *b = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;Derived&lt;/span&gt;();\n&lt;span class=&quot;hljs-comment&quot;&gt;// use b&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; b; &lt;span class=&quot;hljs-comment&quot;&gt;// Here&apos;s the problem!&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Since Base&apos;s destructor is not &lt;code&gt;virtual&lt;/code&gt; and &lt;code&gt;b&lt;/code&gt; is a &lt;code&gt;Base*&lt;/code&gt; pointing to a &lt;code&gt;Derived&lt;/code&gt; object, &lt;code&gt;delete b&lt;/code&gt; has &lt;a href=&quot;https://stackoverflow.com/q/2397984/20984&quot;&gt;undefined behaviour&lt;/a&gt;:&lt;/p&gt;\n\n&lt;blockquote&gt;\n  &lt;p&gt;[In &lt;code&gt;delete b&lt;/code&gt;], if the static type of the\n  object to be deleted is different from its dynamic type, the static\n  type shall be a base class of the dynamic type of the object to be\n  deleted and &lt;strong&gt;the static type shall have a virtual destructor or the\n  behavior is undefined&lt;/strong&gt;.&lt;/p&gt;\n&lt;/blockquote&gt;\n\n&lt;p&gt;In most implementations, the call to the destructor will be resolved like any non-virtual code, meaning that the destructor of the base class will be called but not the one of the derived class, resulting in a resources leak.&lt;/p&gt;\n\n&lt;p&gt;To sum up, always make base classes&apos; destructors &lt;code&gt;virtual&lt;/code&gt; when they&apos;re meant to be manipulated polymorphically.&lt;/p&gt;\n\n&lt;p&gt;If you want to prevent the deletion of an instance through a base class pointer, you can make the base class destructor protected and nonvirtual; by doing so, the compiler won&apos;t let you call &lt;code&gt;delete&lt;/code&gt; on a base class pointer.&lt;/p&gt;\n\n&lt;p&gt;You can learn more about virtuality and virtual base class destructor in &lt;a href=&quot;http://www.gotw.ca/publications/mill18.htm&quot; rel=&quot;noreferrer&quot;&gt;this article from Herb Sutter&lt;/a&gt;.&lt;/p&gt;\n    ","\n&lt;p&gt;A virtual constructor is not possible but virtual destructor is possible.\nLet us experiment.......&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;namespace&lt;/span&gt; std;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Base&lt;/span&gt;\n{\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n    &lt;span class=&quot;hljs-built_in&quot;&gt;Base&lt;/span&gt;(){\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Base Constructor Called\\n&quot;&lt;/span&gt;;\n    }\n    ~&lt;span class=&quot;hljs-built_in&quot;&gt;Base&lt;/span&gt;(){\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Base Destructor called\\n&quot;&lt;/span&gt;;\n    }\n};\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Derived1&lt;/span&gt;: &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Base\n{\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n    &lt;span class=&quot;hljs-built_in&quot;&gt;Derived1&lt;/span&gt;(){\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Derived constructor called\\n&quot;&lt;/span&gt;;\n    }\n    ~&lt;span class=&quot;hljs-built_in&quot;&gt;Derived1&lt;/span&gt;(){\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Derived destructor called\\n&quot;&lt;/span&gt;;\n    }\n};\n\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;\n&lt;/span&gt;{\n    Base *b = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;Derived1&lt;/span&gt;();\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; b;\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;The above code output the following:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-none s-code-block&quot;&gt;&lt;code&gt;Base Constructor Called\nDerived constructor called\nBase Destructor called\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;The construction of derived object follow the construction rule but when we delete the &quot;b&quot; pointer(base pointer) we have found that only the base destructor is called. But this must not happen. To do the appropriate thing, we have to make the base destructor virtual.\nNow let see what happens in the following:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;namespace&lt;/span&gt; std;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Base&lt;/span&gt;\n{ \n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n    &lt;span class=&quot;hljs-built_in&quot;&gt;Base&lt;/span&gt;(){\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Base Constructor Called\\n&quot;&lt;/span&gt;;\n    }\n    &lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; ~&lt;span class=&quot;hljs-built_in&quot;&gt;Base&lt;/span&gt;(){\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Base Destructor called\\n&quot;&lt;/span&gt;;\n    }\n};\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Derived1&lt;/span&gt;: &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Base\n{\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n    &lt;span class=&quot;hljs-built_in&quot;&gt;Derived1&lt;/span&gt;(){\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Derived constructor called\\n&quot;&lt;/span&gt;;\n    }\n    ~&lt;span class=&quot;hljs-built_in&quot;&gt;Derived1&lt;/span&gt;(){\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Derived destructor called\\n&quot;&lt;/span&gt;;\n    }\n};\n\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;\n&lt;/span&gt;{\n    Base *b = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;Derived1&lt;/span&gt;();\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; b;\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;The output changed as following:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-none s-code-block&quot;&gt;&lt;code&gt;Base Constructor Called\nDerived Constructor called\nDerived destructor called\nBase destructor called\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;So the destruction of the base pointer (which takes an allocation on derived object!) follows the destruction rule, i.e first the Derived, then the Base.\nOn the other hand, there is nothing like a virtual constructor.       &lt;/p&gt;\n    ","\n&lt;p&gt;Declare destructors virtual in polymorphic base classes.  This is Item 7 in Scott Meyers&apos; &lt;a href=&quot;https://rads.stackoverflow.com/amzn/click/com/0201924889&quot; rel=&quot;noreferrer&quot;&gt;Effective C++&lt;/a&gt;.  Meyers goes on to summarize that if a class has &lt;em&gt;any&lt;/em&gt; virtual function, it should have a virtual destructor, and that classes not designed to be base classes or not designed to be used polymorphically should &lt;em&gt;not&lt;/em&gt; declare virtual destructors.&lt;/p&gt;\n    ","\n&lt;p&gt;Also be aware that deleting a base class pointer when there is no virtual destructor will result in &lt;strong&gt;&lt;em&gt;undefined behavior&lt;/em&gt;&lt;/strong&gt;.  Something that I learned just recently:&lt;/p&gt;\n\n&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/408196/how-should-overriding-delete-in-c-behave&quot;&gt;How should overriding delete in C++ behave?&lt;/a&gt;&lt;/p&gt;\n\n&lt;p&gt;I&apos;ve been using C++ for years and I still manage to hang myself.&lt;/p&gt;\n    ","\n&lt;p&gt;Make the destructor virtual whenever your class is polymorphic.&lt;/p&gt;\n    ","\n&lt;h3&gt;Calling destructor via a pointer to a base class&lt;/h3&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Base&lt;/span&gt; {\n  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{}\n  &lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; ~&lt;span class=&quot;hljs-built_in&quot;&gt;Base&lt;/span&gt;() {}\n};\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Derived&lt;/span&gt; : Base {\n  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;override&lt;/span&gt; &lt;/span&gt;{}\n  ~&lt;span class=&quot;hljs-built_in&quot;&gt;Derived&lt;/span&gt;() &lt;span class=&quot;hljs-keyword&quot;&gt;override&lt;/span&gt; {}\n};\n\nBase* base = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; Derived;\nbase-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;f&lt;/span&gt;(); &lt;span class=&quot;hljs-comment&quot;&gt;// calls Derived::f&lt;/span&gt;\nbase-&amp;gt;~&lt;span class=&quot;hljs-built_in&quot;&gt;Base&lt;/span&gt;(); &lt;span class=&quot;hljs-comment&quot;&gt;// calls Derived::~Derived&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Virtual destructor call is no different from any other virtual function call.&lt;/p&gt;\n\n&lt;p&gt;For &lt;code&gt;base-&amp;gt;f()&lt;/code&gt;, the call will be dispatched to &lt;code&gt;Derived::f()&lt;/code&gt;, and it&apos;s the same for &lt;code&gt;base-&amp;gt;~Base()&lt;/code&gt; - its overriding function - the &lt;code&gt;Derived::~Derived()&lt;/code&gt; will be called.&lt;/p&gt;\n\n&lt;p&gt;Same happens when destructor is being called indirectly, e.g. &lt;code&gt;delete base;&lt;/code&gt;. The &lt;code&gt;delete&lt;/code&gt; statement will call &lt;code&gt;base-&amp;gt;~Base()&lt;/code&gt; which will be dispatched to &lt;code&gt;Derived::~Derived()&lt;/code&gt;.&lt;/p&gt;\n\n&lt;h3&gt;Abstract class with non-virtual destructor&lt;/h3&gt;\n\n&lt;p&gt;If you are not going to delete object through a pointer to its base class - then there is no need to have a virtual destructor. Just make it &lt;code&gt;protected&lt;/code&gt; so that it won&apos;t be called accidentally:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// library.hpp&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Base&lt;/span&gt; {\n  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;= &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt;:\n  ~&lt;span class=&quot;hljs-built_in&quot;&gt;Base&lt;/span&gt;() = &lt;span class=&quot;hljs-keyword&quot;&gt;default&lt;/span&gt;;\n};\n\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;CallsF&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(Base&amp;amp; base)&lt;/span&gt;&lt;/span&gt;;\n&lt;span class=&quot;hljs-comment&quot;&gt;// CallsF is not going to own &quot;base&quot; (i.e. call &quot;delete &amp;amp;base;&quot;).&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;// It will only call Base::f() so it doesn&apos;t need to access Base::~Base.&lt;/span&gt;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;//-------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;// application.cpp&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Derived&lt;/span&gt; : Base {\n  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;override&lt;/span&gt; &lt;/span&gt;{ ... }\n};\n\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{\n  Derived derived;\n  &lt;span class=&quot;hljs-built_in&quot;&gt;CallsF&lt;/span&gt;(derived);\n  &lt;span class=&quot;hljs-comment&quot;&gt;// No need for virtual destructor here as well.&lt;/span&gt;\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;To be simple,\nVirtual destructor is to destruct the resources in a proper order, when you delete a base class pointer pointing to derived class object.&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt; &lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;\n &lt;span class=&quot;hljs-keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;namespace&lt;/span&gt; std;\n &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;B&lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n       &lt;span class=&quot;hljs-built_in&quot;&gt;B&lt;/span&gt;(){\n          cout&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;B()\\n&quot;&lt;/span&gt;;\n       }\n       &lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; ~&lt;span class=&quot;hljs-built_in&quot;&gt;B&lt;/span&gt;(){ \n          cout&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;~B()\\n&quot;&lt;/span&gt;;\n       }\n };\n &lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;D&lt;/span&gt;: &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; B{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n       &lt;span class=&quot;hljs-built_in&quot;&gt;D&lt;/span&gt;(){\n          cout&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;D()\\n&quot;&lt;/span&gt;;\n       }\n       ~&lt;span class=&quot;hljs-built_in&quot;&gt;D&lt;/span&gt;(){\n          cout&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;~D()\\n&quot;&lt;/span&gt;;\n       }\n };\n &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{\n    B *b = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;D&lt;/span&gt;();\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; b;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n }\n\nOUTPUT:\n&lt;span class=&quot;hljs-built_in&quot;&gt;B&lt;/span&gt;()\n&lt;span class=&quot;hljs-built_in&quot;&gt;D&lt;/span&gt;()\n~&lt;span class=&quot;hljs-built_in&quot;&gt;D&lt;/span&gt;()\n~&lt;span class=&quot;hljs-built_in&quot;&gt;B&lt;/span&gt;()\n\n==============\nIf you don&lt;span class=&quot;hljs-number&quot;&gt;&apos;&lt;/span&gt;t give ~&lt;span class=&quot;hljs-built_in&quot;&gt;B&lt;/span&gt;()  as &lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt;. then output would be \n&lt;span class=&quot;hljs-built_in&quot;&gt;B&lt;/span&gt;()\n&lt;span class=&quot;hljs-built_in&quot;&gt;D&lt;/span&gt;()\n~&lt;span class=&quot;hljs-built_in&quot;&gt;B&lt;/span&gt;()\nwhere destruction of ~&lt;span class=&quot;hljs-built_in&quot;&gt;D&lt;/span&gt;() is &lt;span class=&quot;hljs-keyword&quot;&gt;not&lt;/span&gt; done which leads to leak\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;hr&gt;\n    ","\n&lt;p&gt;Virtual keyword for destructor is necessary when you want different destructors should follow proper order while objects is being deleted through base class pointer. \nfor example:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;Base *myObj = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;Derived&lt;/span&gt;();\n&lt;span class=&quot;hljs-comment&quot;&gt;// Some code which is using myObj object&lt;/span&gt;\nmyObj-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;fun&lt;/span&gt;();\n&lt;span class=&quot;hljs-comment&quot;&gt;//Now delete the object&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; myObj ; \n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;If your base class destructor is virtual then objects will be destructed in a order(firstly derived object then base ). If your base class destructor is NOT virtual then only base class object will get deleted(because pointer is of base class &quot;Base *myObj&quot;). So there will be memory leak for derived object.&lt;/p&gt;\n    ","\n&lt;p&gt;I like to think about interfaces and implementations of interfaces. In C++ speak interface is pure virtual class. Destructor is part of the interface and expected to implemented. Therefore destructor should be pure virtual. How about constructor? Constructor is actually not part of the interface because object is always instantiated explicitly. &lt;/p&gt;\n    ","\n&lt;p&gt;Virtual base class destructors are &quot;best practice&quot; - you should always use them to avoid (hard to detect) memory leaks. Using them, you can be sure all destructors in the inheritance chain of your classes are beeing called (in proper order). Inheriting from a base class using virtual destructor makes the destructor of the inheriting class automatically virtual, too (so you do not have to retype &apos;virtual&apos; in the inheriting class destructor declaration).&lt;/p&gt;\n    ","\n&lt;p&gt;I think the core of this question is about virtual methods and polymorphism, not the destructor specifically. Here is a clearer example:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;A&lt;/span&gt;\n{\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n    &lt;span class=&quot;hljs-built_in&quot;&gt;A&lt;/span&gt;() {}\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;\n    &lt;/span&gt;{\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;This is A.&quot;&lt;/span&gt; &amp;lt;&amp;lt; endl;\n    }\n};\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;B&lt;/span&gt; : &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; A\n{\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n    &lt;span class=&quot;hljs-built_in&quot;&gt;B&lt;/span&gt;() {}\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;\n    &lt;/span&gt;{\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;This is B.&quot;&lt;/span&gt; &amp;lt;&amp;lt; endl;\n    }\n};\n\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; argc, &lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt;* argv[])&lt;/span&gt;\n&lt;/span&gt;{\n    A *a = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;B&lt;/span&gt;();\n    a-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;foo&lt;/span&gt;();\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(a != &lt;span class=&quot;hljs-literal&quot;&gt;NULL&lt;/span&gt;)\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; a;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Will print out:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;This is B.\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Without &lt;code&gt;virtual&lt;/code&gt; it will print out:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;This is A.\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;And now you should understand when to use virtual destructors.&lt;/p&gt;\n    ","\n&lt;p&gt;If you use &lt;code&gt;shared_ptr&lt;/code&gt;(only shared_ptr, not unique_ptr), you don&apos;t have to have the base class destructor virtual:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&amp;lt;memory&amp;gt;&lt;/span&gt;&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;namespace&lt;/span&gt; std;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Base&lt;/span&gt;\n{\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n    &lt;span class=&quot;hljs-built_in&quot;&gt;Base&lt;/span&gt;(){\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Base Constructor Called\\n&quot;&lt;/span&gt;;\n    }\n    ~&lt;span class=&quot;hljs-built_in&quot;&gt;Base&lt;/span&gt;(){ &lt;span class=&quot;hljs-comment&quot;&gt;// not virtual&lt;/span&gt;\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Base Destructor called\\n&quot;&lt;/span&gt;;\n    }\n};\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Derived&lt;/span&gt;: &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Base\n{\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n    &lt;span class=&quot;hljs-built_in&quot;&gt;Derived&lt;/span&gt;(){\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Derived constructor called\\n&quot;&lt;/span&gt;;\n    }\n    ~&lt;span class=&quot;hljs-built_in&quot;&gt;Derived&lt;/span&gt;(){\n        cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Derived destructor called\\n&quot;&lt;/span&gt;;\n    }\n};\n\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;\n&lt;/span&gt;{\n    &lt;span class=&quot;hljs-function&quot;&gt;shared_ptr&amp;lt;Base&amp;gt; &lt;span class=&quot;hljs-title&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; Derived())&lt;/span&gt;&lt;/span&gt;;\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;output:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-none s-code-block&quot;&gt;&lt;code&gt;Base Constructor Called\nDerived constructor called\nDerived destructor called\nBase Destructor called\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;What is a virtual destructor or how to use virtual destructor&lt;/p&gt;\n\n&lt;p&gt;A class destructor is a function with same name of the class preceding with ~ that will reallocate the memory that is allocated by the class. Why we need a virtual destructor&lt;/p&gt;\n\n&lt;p&gt;See  the  following  sample with some virtual functions&lt;/p&gt;\n\n&lt;p&gt;The sample also tell how you can convert a letter to upper or lower&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;stdafx.h&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;namespace&lt;/span&gt; std;\n&lt;span class=&quot;hljs-comment&quot;&gt;// program to convert the lower to upper orlower&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;convertch&lt;/span&gt;\n{\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n  &lt;span class=&quot;hljs-comment&quot;&gt;//void convertch(){};&lt;/span&gt;\n  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt;* &lt;span class=&quot;hljs-title&quot;&gt;convertChar&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;= &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n  ~&lt;span class=&quot;hljs-built_in&quot;&gt;convertch&lt;/span&gt;(){};\n};\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MakeLower&lt;/span&gt; :&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; convertch\n{\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n  &lt;span class=&quot;hljs-built_in&quot;&gt;MakeLower&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt; *passLetter)\n  {\n    tolower = &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\n    Letter = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt;[&lt;span class=&quot;hljs-number&quot;&gt;30&lt;/span&gt;];\n    &lt;span class=&quot;hljs-built_in&quot;&gt;strcpy&lt;/span&gt;(Letter, passLetter);\n  }\n\n  &lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; ~&lt;span class=&quot;hljs-built_in&quot;&gt;MakeLower&lt;/span&gt;()\n  {\n    cout&amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;called ~MakeLower()&quot;&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;\\n&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt;[] Letter;\n  }\n\n  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt;* &lt;span class=&quot;hljs-title&quot;&gt;convertChar&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;\n  &lt;/span&gt;{\n    &lt;span class=&quot;hljs-type&quot;&gt;size_t&lt;/span&gt; len = &lt;span class=&quot;hljs-built_in&quot;&gt;strlen&lt;/span&gt;(Letter);\n    &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i= &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;len;i++)\n      Letter[i] = Letter[i] + &lt;span class=&quot;hljs-number&quot;&gt;32&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; Letter;\n  }\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt;:\n  &lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt; *Letter;\n  &lt;span class=&quot;hljs-type&quot;&gt;bool&lt;/span&gt; tolower;\n};\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MakeUpper&lt;/span&gt; : &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; convertch\n{\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n  &lt;span class=&quot;hljs-built_in&quot;&gt;MakeUpper&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt; *passLetter)\n  {\n    Letter = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt;[&lt;span class=&quot;hljs-number&quot;&gt;30&lt;/span&gt;];\n    toupper = &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\n    &lt;span class=&quot;hljs-built_in&quot;&gt;strcpy&lt;/span&gt;(Letter, passLetter);\n  }\n\n  &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt;* &lt;span class=&quot;hljs-title&quot;&gt;convertChar&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;\n  &lt;/span&gt;{   \n    &lt;span class=&quot;hljs-type&quot;&gt;size_t&lt;/span&gt; len = &lt;span class=&quot;hljs-built_in&quot;&gt;strlen&lt;/span&gt;(Letter);\n    &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i= &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;len;i++)\n      Letter[i] = Letter[i] - &lt;span class=&quot;hljs-number&quot;&gt;32&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; Letter;\n  }\n\n  &lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; ~&lt;span class=&quot;hljs-built_in&quot;&gt;MakeUpper&lt;/span&gt;()\n  {\n    cout&amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;called ~MakeUpper()&quot;&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;\\n&quot;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; Letter;\n  }\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt;:\n  &lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt; *Letter;\n  &lt;span class=&quot;hljs-type&quot;&gt;bool&lt;/span&gt; toupper;\n};\n\n\n&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; _tmain(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; argc, _TCHAR* argv[])\n{\n  convertch *makeupper = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;MakeUpper&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;hai&quot;&lt;/span&gt;); \n  cout&amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Eneterd : hai = &quot;&lt;/span&gt; &amp;lt;&amp;lt;makeupper-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;convertChar&lt;/span&gt;()&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot; &quot;&lt;/span&gt;;     \n  &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; makeupper;\n  convertch *makelower = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;MakeLower&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;HAI&quot;&lt;/span&gt;);;\n  cout&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;Eneterd : HAI = &quot;&lt;/span&gt; &amp;lt;&amp;lt;makelower-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;convertChar&lt;/span&gt;()&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot; &quot;&lt;/span&gt;; \n  &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; makelower;\n  &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;From the above sample you can see that the destructor for both MakeUpper and MakeLower class is not called.&lt;/p&gt;\n\n&lt;p&gt;See the next sample with the virtual destructor&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;stdafx.h&quot;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;namespace&lt;/span&gt; std;\n&lt;span class=&quot;hljs-comment&quot;&gt;// program to convert the lower to upper orlower&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;convertch&lt;/span&gt;\n{\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n&lt;span class=&quot;hljs-comment&quot;&gt;//void convertch(){};&lt;/span&gt;\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt;* &lt;span class=&quot;hljs-title&quot;&gt;convertChar&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;= &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n&lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; ~&lt;span class=&quot;hljs-built_in&quot;&gt;convertch&lt;/span&gt;(){}; &lt;span class=&quot;hljs-comment&quot;&gt;// defined the virtual destructor&lt;/span&gt;\n\n};\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MakeLower&lt;/span&gt; :&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; convertch\n{\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n&lt;span class=&quot;hljs-built_in&quot;&gt;MakeLower&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt; *passLetter)\n{\ntolower = &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\nLetter = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt;[&lt;span class=&quot;hljs-number&quot;&gt;30&lt;/span&gt;];\n&lt;span class=&quot;hljs-built_in&quot;&gt;strcpy&lt;/span&gt;(Letter, passLetter);\n}\n&lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; ~&lt;span class=&quot;hljs-built_in&quot;&gt;MakeLower&lt;/span&gt;()\n{\ncout&amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;called ~MakeLower()&quot;&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;\\n&quot;&lt;/span&gt;;\n      &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt;[] Letter;\n}\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt;* &lt;span class=&quot;hljs-title&quot;&gt;convertChar&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;\n&lt;/span&gt;{\n&lt;span class=&quot;hljs-type&quot;&gt;size_t&lt;/span&gt; len = &lt;span class=&quot;hljs-built_in&quot;&gt;strlen&lt;/span&gt;(Letter);\n&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i= &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;len;i++)\n{\nLetter[i] = Letter[i] + &lt;span class=&quot;hljs-number&quot;&gt;32&lt;/span&gt;;\n\n}\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; Letter;\n}\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt;:\n&lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt; *Letter;\n&lt;span class=&quot;hljs-type&quot;&gt;bool&lt;/span&gt; tolower;\n\n};\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MakeUpper&lt;/span&gt; : &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; convertch\n{\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n&lt;span class=&quot;hljs-built_in&quot;&gt;MakeUpper&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt; *passLetter)\n{\nLetter = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt;[&lt;span class=&quot;hljs-number&quot;&gt;30&lt;/span&gt;];\ntoupper = &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\n&lt;span class=&quot;hljs-built_in&quot;&gt;strcpy&lt;/span&gt;(Letter, passLetter);\n}\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt;* &lt;span class=&quot;hljs-title&quot;&gt;convertChar&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;\n&lt;/span&gt;{\n\n&lt;span class=&quot;hljs-type&quot;&gt;size_t&lt;/span&gt; len = &lt;span class=&quot;hljs-built_in&quot;&gt;strlen&lt;/span&gt;(Letter);\n&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; i= &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;i&amp;lt;len;i++)\n{\nLetter[i] = Letter[i] - &lt;span class=&quot;hljs-number&quot;&gt;32&lt;/span&gt;;\n}\n&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; Letter;\n}\n&lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; ~&lt;span class=&quot;hljs-built_in&quot;&gt;MakeUpper&lt;/span&gt;()\n{\n      cout&amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;called ~MakeUpper()&quot;&lt;/span&gt;&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;\\n&quot;&lt;/span&gt;;\n&lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; Letter;\n}\n&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt;:\n&lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt; *Letter;\n&lt;span class=&quot;hljs-type&quot;&gt;bool&lt;/span&gt; toupper;\n};\n\n\n&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; _tmain(&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; argc, _TCHAR* argv[])\n{\n\nconvertch *makeupper = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;MakeUpper&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;hai&quot;&lt;/span&gt;);\n\ncout&amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;Eneterd : hai = &quot;&lt;/span&gt; &amp;lt;&amp;lt;makeupper-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;convertChar&lt;/span&gt;()&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot; \\n&quot;&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; makeupper;\nconvertch *makelower = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;MakeLower&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;HAI&quot;&lt;/span&gt;);;\ncout&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;Eneterd : HAI = &quot;&lt;/span&gt; &amp;lt;&amp;lt;makelower-&amp;gt;&lt;span class=&quot;hljs-built_in&quot;&gt;convertChar&lt;/span&gt;()&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;\\n &quot;&lt;/span&gt;;\n\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; makelower;\n&lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;The virtual destructor will call explicitly the most derived run time destructor of class so that it will be able to clear the object in a proper way.&lt;/p&gt;\n\n&lt;p&gt;Or visit the link&lt;/p&gt;\n\n&lt;p&gt;&lt;a href=&quot;https://web.archive.org/web/20130822173509/http://www.programminggallery.com/article_details.php?article_id=138&quot; rel=&quot;nofollow&quot;&gt;https://web.archive.org/web/20130822173509/http://www.programminggallery.com/article_details.php?article_id=138&lt;/a&gt;&lt;/p&gt;\n    ","\n&lt;p&gt;I thought it would be beneficial to discuss the &quot;undefined&quot; behavior, or at least the &quot;crash&quot; undefined behavior that may occur when deleting through a base class(/struct) without a virtual destructor, or more precisely no vtable.  The code below list a few simple structs (the same would be true for classes).&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;namespace&lt;/span&gt; std;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;a&lt;/span&gt;\n{\n    ~&lt;span class=&quot;hljs-built_in&quot;&gt;a&lt;/span&gt;() {}\n\n    &lt;span class=&quot;hljs-type&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;long&lt;/span&gt; i;\n};\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;b&lt;/span&gt; : a\n{\n    ~&lt;span class=&quot;hljs-built_in&quot;&gt;b&lt;/span&gt;() {}\n\n    &lt;span class=&quot;hljs-type&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;long&lt;/span&gt; j;\n};\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;c&lt;/span&gt; : b\n{\n    ~&lt;span class=&quot;hljs-built_in&quot;&gt;c&lt;/span&gt;() {}\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;m3&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{}\n\n    &lt;span class=&quot;hljs-type&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;long&lt;/span&gt; k;\n};\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;d&lt;/span&gt; : c\n{\n    ~&lt;span class=&quot;hljs-built_in&quot;&gt;d&lt;/span&gt;() {}\n\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;m4&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{}\n\n    &lt;span class=&quot;hljs-type&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;long&lt;/span&gt; l;\n};\n\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;\n&lt;/span&gt;{\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;sizeof(a): &quot;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&quot;hljs-built_in&quot;&gt;sizeof&lt;/span&gt;(a) &amp;lt;&amp;lt; endl;\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;sizeof(b): &quot;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&quot;hljs-built_in&quot;&gt;sizeof&lt;/span&gt;(b) &amp;lt;&amp;lt; endl;\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;sizeof(c): &quot;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&quot;hljs-built_in&quot;&gt;sizeof&lt;/span&gt;(c) &amp;lt;&amp;lt; endl;\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;sizeof(d): &quot;&lt;/span&gt; &amp;lt;&amp;lt; &lt;span class=&quot;hljs-built_in&quot;&gt;sizeof&lt;/span&gt;(d) &amp;lt;&amp;lt; endl;\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// No issue.&lt;/span&gt;\n\n    a* a1 = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;a&lt;/span&gt;();\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;a1: &quot;&lt;/span&gt; &amp;lt;&amp;lt; a1 &amp;lt;&amp;lt; endl;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; a1;\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// No issue.&lt;/span&gt;\n\n    b* b1 = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;b&lt;/span&gt;();\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;b1: &quot;&lt;/span&gt; &amp;lt;&amp;lt; b1 &amp;lt;&amp;lt; endl;\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;(a*) b1: &quot;&lt;/span&gt; &amp;lt;&amp;lt; (a*) b1 &amp;lt;&amp;lt; endl;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; b1;\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// No issue.&lt;/span&gt;\n\n    c* c1 = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;c&lt;/span&gt;();\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;c1: &quot;&lt;/span&gt; &amp;lt;&amp;lt; c1 &amp;lt;&amp;lt; endl;\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;(b*) c1: &quot;&lt;/span&gt; &amp;lt;&amp;lt; (b*) c1 &amp;lt;&amp;lt; endl;\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;(a*) c1: &quot;&lt;/span&gt; &amp;lt;&amp;lt; (a*) c1 &amp;lt;&amp;lt; endl;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; c1;\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// No issue.&lt;/span&gt;\n\n    d* d1 = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;d&lt;/span&gt;();\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;d1: &quot;&lt;/span&gt; &amp;lt;&amp;lt; d1 &amp;lt;&amp;lt; endl;\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;(c*) d1: &quot;&lt;/span&gt; &amp;lt;&amp;lt; (c*) d1 &amp;lt;&amp;lt; endl;\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;(b*) d1: &quot;&lt;/span&gt; &amp;lt;&amp;lt; (b*) d1 &amp;lt;&amp;lt; endl;\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;(a*) d1: &quot;&lt;/span&gt; &amp;lt;&amp;lt; (a*) d1 &amp;lt;&amp;lt; endl;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; d1;\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Doesn&apos;t crash, but may not produce the results you want.&lt;/span&gt;\n\n    c1 = (c*) &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;d&lt;/span&gt;();\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; c1;\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Crashes due to passing an invalid address to the method which&lt;/span&gt;\n    &lt;span class=&quot;hljs-comment&quot;&gt;// frees the memory.&lt;/span&gt;\n\n    d1 = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;d&lt;/span&gt;();\n    b1 = (b*) d1;\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;d1: &quot;&lt;/span&gt; &amp;lt;&amp;lt; d1 &amp;lt;&amp;lt; endl;\n    cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;b1: &quot;&lt;/span&gt; &amp;lt;&amp;lt; b1 &amp;lt;&amp;lt; endl;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; b1;  \n\n&lt;span class=&quot;hljs-comment&quot;&gt;/*\n\n    // This is similar to what&apos;s happening above in the &quot;crash&quot; case.\n\n    char* buf = new char[32];\n    cout &amp;lt;&amp;lt; &quot;buf: &quot; &amp;lt;&amp;lt; (void*) buf &amp;lt;&amp;lt; endl;\n    buf += 8;\n    cout &amp;lt;&amp;lt; &quot;buf after adding 8: &quot; &amp;lt;&amp;lt; (void*) buf &amp;lt;&amp;lt; endl;\n    delete buf;\n*/&lt;/span&gt;\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;I&apos;m not suggesting whether you need virtual destructors or not, though I think in general it&apos;s a good practice to have them.  I&apos;m just pointing out the reason you may end up with a crash if your base class(/struct) does not have a vtable and your derived class(/struct) does and you delete an object via a base class(/struct) pointer.  In this case, the address you pass to the heap&apos;s free routine is invalid and thus the reason for the crash.&lt;/p&gt;\n\n&lt;p&gt;If you run the above code you&apos;ll see clearly when the issue occurs.  When the this pointer of the base class(/struct) is different from the this pointer of the derived class(/struct) you&apos;re going to run into this problem.  In the sample above, struct a and b don&apos;t have vtables.  structs c and d do have vtables.  Thus an a or b pointer to a c or d object instance will be fixed up to account for the vtable.  If you pass this a or b pointer to delete it will crash due to the address being invalid to the heap&apos;s free routine.&lt;/p&gt;\n\n&lt;p&gt;If you plan to delete derived instances which have vtables from base class pointers, you need to ensure the base class has a vtable.  One way to do that is to add a virtual destructor, which you might want anyway to properly clean up resources.&lt;/p&gt;\n    ","\n&lt;p&gt;when you need to call derived class destructor from base class. you need to declare virtual base class destructor in base class.&lt;/p&gt;\n    ","\n&lt;p&gt;I think most answers here miss the point, with the exception of the accepted one, which is a good thing. However, let me add one more with a different view on the issue: You need a virtual destructor if you want to polymorphically delete instances of this class.&lt;/p&gt;\n&lt;p&gt;This kind-of sidesteps the question, so let me elaborate: As many pointed out, you get undesired behaviour if you invoke &lt;code&gt;delete base_ptr&lt;/code&gt; and the destructor is not virtual. However, there are several assumptions there that need to be make explicit:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;If your class is not a baseclass, you will hopefully not write code like this. In this case I don&apos;t mean the manual memory management, which is bad in and of itself, but deriving publicly from this class. A class not designed as baseclass should not be inherited from, like e.g. &lt;code&gt;std::string&lt;/code&gt;. C++ allows you to shoot yourself in the foot. This is your fault though, not that of the baseclass not having a virtual destructor.&lt;/li&gt;\n&lt;li&gt;If the destructor is not accessible (protected or private), this code won&apos;t compile, so the undesired behaviour can not occur. Having a protected destructor is useful, especially for mixins but also (to a lesser extent) for interfaces. You don&apos;t want to incur the overhead of virtual functions unless you actually make use of them. Making the destructor protected instead prevents undesired behaviour but doesn&apos;t restrict you otherwise.&lt;/li&gt;\n&lt;li&gt;If you actually write a class that is supposed to be derived from, you will typically have virtual functions anyways. As a user of them, you will typically only use them via a pointer to the baseclass. When this use includes disposing of them, it then needs to be polymorphic as well. This is then the case when you should make the destructor virtual.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;For a similarly different view on the subject, also read &lt;a href=&quot;https://stackoverflow.com/questions/300986/when-should-you-not-use-virtual-destructors&quot;&gt;When should you not use virtual destructors?&lt;/a&gt;&lt;/p&gt;\n    ","\n&lt;p&gt;A basic definition about &lt;code&gt;virtual&lt;/code&gt; is it determines if a member function of a class can be over-ridden in its derived classes. &lt;/p&gt;\n\n&lt;p&gt;A class&apos;s D-tor is called basically at the end of the scope, but there is a problem, for example when we define an instance on the Heap (dynamic allocation), we should delete it manually.&lt;/p&gt;\n\n&lt;p&gt;As soon as the instruction get executed, the base class destructor get called, but not for the derived one.&lt;/p&gt;\n\n&lt;p&gt;A Pratical example is when, in control field, you have to manipulate effectors, actuators.&lt;/p&gt;\n\n&lt;p&gt;At the end of the scope, if the destructor of one of the power elements (Actuator), isn&apos;t called, there will be fatal consequences.&lt;/p&gt;\n\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Mother&lt;/span&gt;{\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n\n    &lt;span class=&quot;hljs-built_in&quot;&gt;Mother&lt;/span&gt;(){\n\n          std::cout&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;Mother Ctor&quot;&lt;/span&gt;&amp;lt;&amp;lt;std::endl;\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt;~&lt;span class=&quot;hljs-built_in&quot;&gt;Mother&lt;/span&gt;(){\n\n        std::cout&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;Mother D-tor&quot;&lt;/span&gt;&amp;lt;&amp;lt;std::endl;\n    }\n\n\n};\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Child&lt;/span&gt;: &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; Mother{\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt;:\n\n    &lt;span class=&quot;hljs-built_in&quot;&gt;Child&lt;/span&gt;(){\n\n        std::cout&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;Child C-tor&quot;&lt;/span&gt;&amp;lt;&amp;lt;std::endl;\n    }\n\n    ~&lt;span class=&quot;hljs-built_in&quot;&gt;Child&lt;/span&gt;(){\n\n         std::cout&amp;lt;&amp;lt;&lt;span class=&quot;hljs-string&quot;&gt;&quot;Child D-tor&quot;&lt;/span&gt;&amp;lt;&amp;lt;std::endl;\n    }\n};\n\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;\n&lt;/span&gt;{\n\n    Mother *c = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;Child&lt;/span&gt;();\n    &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; c;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Make all destructors virtual unless you have good reason not to.&lt;/p&gt;\n&lt;p&gt;Otherwise evil like this happens:&lt;/p&gt;\n&lt;p&gt;Suppose you have an array of Fruit pointers with both Apple and Orange objects.&lt;/p&gt;\n&lt;p&gt;When you delete from the collection of Fruit objects,\n~Apple() and ~Orange() fail to be called unless ~Fruit() is virtual.&lt;/p&gt;\n&lt;p&gt;Example done right:&lt;/p&gt;\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;namespace&lt;/span&gt; std;\n&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Fruit&lt;/span&gt; { &lt;span class=&quot;hljs-comment&quot;&gt;// good&lt;/span&gt;\n  &lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; ~&lt;span class=&quot;hljs-built_in&quot;&gt;Fruit&lt;/span&gt;() { cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;peel or core should have been tossed&quot;&lt;/span&gt; &amp;lt;&amp;lt; endl; } \n};\n&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Apple&lt;/span&gt;:  Fruit { &lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; ~&lt;span class=&quot;hljs-built_in&quot;&gt;Apple&lt;/span&gt;()  {cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;toss core&quot;&lt;/span&gt; &amp;lt;&amp;lt; endl; } };\n&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Orange&lt;/span&gt;: Fruit { &lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; ~&lt;span class=&quot;hljs-built_in&quot;&gt;Orange&lt;/span&gt;() {cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;toss peel&quot;&lt;/span&gt; &amp;lt;&amp;lt; endl; } };\n\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{ \n  Fruit *basket[]={ &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;Apple&lt;/span&gt;(), &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;Orange&lt;/span&gt;() };\n  &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;auto&lt;/span&gt; fruit: basket) &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; fruit;\n};\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;good output&lt;/p&gt;\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;toss core\npeel &lt;span class=&quot;hljs-keyword&quot;&gt;or&lt;/span&gt; core should have been tossed\ntoss peel\npeel &lt;span class=&quot;hljs-keyword&quot;&gt;or&lt;/span&gt; core should have been tossed\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Example done wrong:&lt;/p&gt;\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;#&lt;span class=&quot;hljs-keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&amp;lt;iostream&amp;gt;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;namespace&lt;/span&gt; std;\n&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Fruit&lt;/span&gt; { &lt;span class=&quot;hljs-comment&quot;&gt;// bad &lt;/span&gt;\n  ~&lt;span class=&quot;hljs-built_in&quot;&gt;Fruit&lt;/span&gt;() { cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;peel or core should have been tossed&quot;&lt;/span&gt; &amp;lt;&amp;lt; endl; } \n};\n&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Apple&lt;/span&gt;:  Fruit { &lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; ~&lt;span class=&quot;hljs-built_in&quot;&gt;Apple&lt;/span&gt;()  {cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;toss core&quot;&lt;/span&gt; &amp;lt;&amp;lt; endl; } };\n&lt;span class=&quot;hljs-keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Orange&lt;/span&gt;: Fruit { &lt;span class=&quot;hljs-keyword&quot;&gt;virtual&lt;/span&gt; ~&lt;span class=&quot;hljs-built_in&quot;&gt;Orange&lt;/span&gt;() {cout &amp;lt;&amp;lt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;toss peel&quot;&lt;/span&gt; &amp;lt;&amp;lt; endl; } };\n\n&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{ \n  Fruit *basket[]={ &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;Apple&lt;/span&gt;(), &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;Orange&lt;/span&gt;() };\n  &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;auto&lt;/span&gt; fruit: basket) &lt;span class=&quot;hljs-keyword&quot;&gt;delete&lt;/span&gt; fruit;\n};\n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;bad output&lt;/p&gt;\n&lt;pre class=&quot;lang-cpp s-code-block&quot;&gt;&lt;code class=&quot;hljs language-cpp&quot;&gt;peel &lt;span class=&quot;hljs-keyword&quot;&gt;or&lt;/span&gt; core should have been tossed\npeel &lt;span class=&quot;hljs-keyword&quot;&gt;or&lt;/span&gt; core should have been tossed\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;(Note: Where I used struct for brevity, normally use class and specify public)&lt;/p&gt;\n    ","\n&lt;p&gt;Any class that is inherited publicly, polymorphic or not, should have a virtual destructor. To put another way, if it can be pointed to by a base class pointer, its base class should have a virtual destructor.&lt;/p&gt;\n&lt;p&gt;If virtual, the derived class destructor gets called and then the base class destructor. If not virtual, only the base class destructor gets called.&lt;/p&gt;\n    "]},"randomTags":[{"name":"c-preprocessor","slug":"c-preprocessor"},{"name":"date-parsing","slug":"date-parsing"},{"name":"css-transitions","slug":"css-transitions"},{"name":"for-loop","slug":"for-loop"},{"name":"python-3.6","slug":"python-3.6"},{"name":"pecs","slug":"pecs"},{"name":"naming-conventions","slug":"naming-conventions"},{"name":"var","slug":"var"},{"name":"email","slug":"email"},{"name":"android-edittext","slug":"android-edittext"},{"name":"delayedvariableexpansion","slug":"delayedvariableexpansion"},{"name":"eval","slug":"eval"},{"name":"sequence","slug":"sequence"},{"name":"count","slug":"count"},{"name":"c#","slug":"c"},{"name":"dom-traversal","slug":"dom-traversal"},{"name":"double-quotes","slug":"double-quotes"},{"name":"fopen","slug":"fopen"},{"name":"abi","slug":"abi"},{"name":"benchmarking","slug":"benchmarking"}]},"__N_SSG":true}