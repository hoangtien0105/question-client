{"pageProps":{"data":{"count":1,"rows":[{"id":331,"title":"How to create a MySQL hierarchical recursive query?","slug":"how-to-create-a-mysql-hierarchical-recursive-query-1657387662163","postType":"QUESTION","createdAt":"2022-07-09T17:27:42.000Z","updatedAt":"2022-07-09T17:27:42.000Z","tags":[{"id":1906,"name":"hierarchical-data","slug":"hierarchical-data","createdAt":"2022-07-09T17:27:42.000Z","updatedAt":"2022-07-09T17:27:42.000Z","Questions_Tags":{"questionId":331,"tagId":1906}}]}]},"slug":"hierarchical-data","page":"1","answers":{"331":["\n&lt;p&gt;For &lt;strong&gt;MySQL 8+:&lt;/strong&gt; use the recursive &lt;a href=&quot;https://dev.mysql.com/doc/refman/8.0/en/with.html&quot; rel=&quot;noreferrer&quot;&gt;&lt;code&gt;with&lt;/code&gt;&lt;/a&gt; syntax.&lt;br&gt;\nFor &lt;strong&gt;MySQL 5.x:&lt;/strong&gt; use inline variables, path IDs, or self-joins.&lt;/p&gt;\n&lt;h1&gt;MySQL 8+&lt;/h1&gt;\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;recursive&lt;/span&gt; cte (id, name, parent_id) &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; (\n  &lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt;     id,\n             name,\n             parent_id\n  &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt;       products\n  &lt;span class=&quot;hljs-keyword&quot;&gt;where&lt;/span&gt;      parent_id &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;\n  &lt;span class=&quot;hljs-keyword&quot;&gt;union&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;all&lt;/span&gt;\n  &lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt;     p.id,\n             p.name,\n             p.parent_id\n  &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt;       products p\n  &lt;span class=&quot;hljs-keyword&quot;&gt;inner&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt; cte\n          &lt;span class=&quot;hljs-keyword&quot;&gt;on&lt;/span&gt; p.parent_id &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; cte.id\n)\n&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; cte;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;The value specified in &lt;code&gt;parent_id = 19&lt;/code&gt; should be set to the &lt;code&gt;id&lt;/code&gt; of the parent you want to select all the descendants of.&lt;/p&gt;\n&lt;h1&gt;MySQL 5.x&lt;/h1&gt;\n&lt;p&gt;For MySQL versions that do not support Common Table Expressions (up to version 5.7), you would achieve this with the following query:&lt;/p&gt;\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt;  id,\n        name,\n        parent_id \n&lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt;    (&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; products\n         &lt;span class=&quot;hljs-keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;by&lt;/span&gt; parent_id, id) products_sorted,\n        (&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt; :&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;19&apos;&lt;/span&gt;) initialisation\n&lt;span class=&quot;hljs-keyword&quot;&gt;where&lt;/span&gt;   find_in_set(parent_id, &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;)\n&lt;span class=&quot;hljs-keyword&quot;&gt;and&lt;/span&gt;     length(&lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt; :&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; concat(&lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt;, id))\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Here is a &lt;a href=&quot;http://sqlfiddle.com/#!9/d74210/1&quot; rel=&quot;noreferrer&quot;&gt;fiddle&lt;/a&gt;.&lt;/p&gt;\n&lt;p&gt;Here, the value specified in &lt;code&gt;@pv := &apos;19&apos;&lt;/code&gt; should be set to the &lt;code&gt;id&lt;/code&gt; of the parent you want to select all the descendants of.&lt;/p&gt;\n&lt;p&gt;This will work also if a parent has &lt;em&gt;multiple&lt;/em&gt; children. However, it is required that each record fulfills the condition &lt;code&gt;parent_id &amp;lt; id&lt;/code&gt;, otherwise the results will not be complete.&lt;/p&gt;\n&lt;h3&gt;Variable assignments inside a query&lt;/h3&gt;\n&lt;p&gt;This query uses specific MySQL syntax: variables are assigned and modified during its execution. Some assumptions are made about the order of execution:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;The &lt;code&gt;from&lt;/code&gt; clause is evaluated first. So that is where &lt;code&gt;@pv&lt;/code&gt; gets initialised.&lt;/li&gt;\n&lt;li&gt;The &lt;code&gt;where&lt;/code&gt; clause is evaluated for each record in the order of retrieval from the &lt;code&gt;from&lt;/code&gt; aliases. So this is where a condition is put to only include records for which the parent was already identified as being in the descendant tree (all descendants of the primary parent are progressively added to &lt;code&gt;@pv&lt;/code&gt;).&lt;/li&gt;\n&lt;li&gt;The conditions in this &lt;code&gt;where&lt;/code&gt; clause are evaluated in order, and the evaluation is interrupted once the total outcome is certain. Therefore the second condition must be in second place, as it adds the &lt;code&gt;id&lt;/code&gt; to the parent list, and this should only happen if the &lt;code&gt;id&lt;/code&gt; passes the first condition. The &lt;code&gt;length&lt;/code&gt; function is only called to make sure this condition is always true, even if the &lt;code&gt;pv&lt;/code&gt; string would for some reason yield a falsy value.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;All in all, one may find these assumptions too risky to rely on. The &lt;a href=&quot;https://dev.mysql.com/doc/refman/5.7/en/user-variables.html&quot; rel=&quot;noreferrer&quot;&gt;documentation&lt;/a&gt; warns:&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;you might get the results you expect, but this is not guaranteed [...] the order of evaluation for expressions involving user variables is undefined.&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;So even though it works consistently with the above query, the evaluation order may still change, for instance when you add conditions or use this query as a view or sub-query in a larger query. It is a &quot;feature&quot; that &lt;a href=&quot;https://dev.mysql.com/doc/refman/8.0/en/user-variables.html&quot; rel=&quot;noreferrer&quot;&gt;will be removed in a future MySQL release&lt;/a&gt;:&lt;/p&gt;\n&lt;blockquote&gt;\n&lt;p&gt;Previous releases of MySQL made it possible to assign a value to a user variable in statements other than &lt;code&gt;SET&lt;/code&gt;. This functionality is supported in MySQL 8.0 for backward compatibility but is subject to removal in a future release of MySQL.&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;As stated above, from MySQL 8.0 onward you should use the recursive &lt;code&gt;with&lt;/code&gt; syntax.&lt;/p&gt;\n&lt;h3&gt;Efficiency&lt;/h3&gt;\n&lt;p&gt;For very large data sets this solution might get slow, as the &lt;a href=&quot;https://dev.mysql.com/doc/refman/8.0/en/string-functions.html#function_find-in-set&quot; rel=&quot;noreferrer&quot;&gt;&lt;code&gt;find_in_set&lt;/code&gt;&lt;/a&gt; operation is not the most ideal way to find a number in a list, certainly not in a list that reaches a size in the same order of magnitude as the number of records returned.&lt;/p&gt;\n&lt;h2&gt;Alternative 1: &lt;code&gt;with recursive&lt;/code&gt;, &lt;code&gt;connect by&lt;/code&gt;&lt;/h2&gt;\n&lt;p&gt;More and more databases implement the &lt;a href=&quot;https://en.wikipedia.org/wiki/SQL:1999#Common_table_expressions_and_recursive_queries&quot; rel=&quot;noreferrer&quot;&gt;SQL:1999 ISO standard &lt;code&gt;WITH [RECURSIVE]&lt;/code&gt; syntax&lt;/a&gt; for recursive queries (e.g. &lt;a href=&quot;http://www.postgresql.org/docs/8.4/static/queries-with.html&quot; rel=&quot;noreferrer&quot;&gt;Postgres 8.4+&lt;/a&gt;, &lt;a href=&quot;https://technet.microsoft.com/en-us/library/ms186243%28v=sql.105%29.aspx&quot; rel=&quot;noreferrer&quot;&gt;SQL Server 2005+&lt;/a&gt;, &lt;a href=&quot;https://www.ibm.com/developerworks/ibmi/library/i-db2connectby/&quot; rel=&quot;noreferrer&quot;&gt;DB2&lt;/a&gt;, &lt;a href=&quot;https://docs.oracle.com/cloud/latest/db112/SQLRF/statements_10002.htm#sthref6733&quot; rel=&quot;noreferrer&quot;&gt;Oracle 11gR2+&lt;/a&gt;, &lt;a href=&quot;https://www.sqlite.org/lang_with.html&quot; rel=&quot;noreferrer&quot;&gt;SQLite 3.8.4+&lt;/a&gt;, &lt;a href=&quot;https://firebirdsql.org/refdocs/langrefupd21-select.html#langrefupd21-select-cte&quot; rel=&quot;noreferrer&quot;&gt;Firebird 2.1+&lt;/a&gt;, &lt;a href=&quot;http://www.h2database.com/html/advanced.html#recursive_queries&quot; rel=&quot;noreferrer&quot;&gt;H2&lt;/a&gt;, &lt;a href=&quot;http://www.hsqldb.org/doc/guide/dataaccess-chapt.html#dac_with_clause&quot; rel=&quot;noreferrer&quot;&gt;HyperSQL 2.1.0+&lt;/a&gt;, &lt;a href=&quot;http://www.info.teradata.com/htmlpubs/DB_TTU_14_00/index.html#page/SQL_Reference/B035_1146_111A/ch01.032.066.html&quot; rel=&quot;noreferrer&quot;&gt;Teradata&lt;/a&gt;, &lt;a href=&quot;https://mariadb.com/kb/en/mariadb/with/&quot; rel=&quot;noreferrer&quot;&gt;MariaDB 10.2.2+&lt;/a&gt;). And as of &lt;a href=&quot;https://dev.mysql.com/doc/refman/8.0/en/with.html&quot; rel=&quot;noreferrer&quot;&gt;version 8.0, also MySQL supports it&lt;/a&gt;. See the top of this answer for the syntax to use.&lt;/p&gt;\n&lt;p&gt;Some databases have an alternative, non-standard syntax for hierarchical look-ups, such as the &lt;code&gt;CONNECT BY&lt;/code&gt; clause available on &lt;a href=&quot;https://docs.oracle.com/cd/B19306_01/server.102/b14200/queries003.htm&quot; rel=&quot;noreferrer&quot;&gt;Oracle&lt;/a&gt;, &lt;a href=&quot;https://www.ibm.com/developerworks/ibmi/library/i-db2connectby/&quot; rel=&quot;noreferrer&quot;&gt;DB2&lt;/a&gt;, &lt;a href=&quot;https://www.ibm.com/support/knowledgecenter/en/SSGU8G_12.1.0/com.ibm.sqls.doc/ids_sqs_2035.htm&quot; rel=&quot;noreferrer&quot;&gt;Informix&lt;/a&gt;, &lt;a href=&quot;https://www.cubrid.org/manual/en/10.0/sql/query/hq.html&quot; rel=&quot;noreferrer&quot;&gt;CUBRID&lt;/a&gt; and other databases.&lt;/p&gt;\n&lt;p&gt;MySQL version 5.7 does not offer such a feature. When your database engine provides this syntax or you can migrate to one that does, then that is certainly the best option to go for. If not, then also consider the following alternatives.&lt;/p&gt;\n&lt;h2&gt;Alternative 2: Path-style Identifiers&lt;/h2&gt;\n&lt;p&gt;Things become a lot easier if you would assign &lt;code&gt;id&lt;/code&gt; values that contain the hierarchical information: a path. For example, in your case this could look like this:&lt;/p&gt;\n&lt;div class=&quot;s-table-container&quot;&gt;\n&lt;table class=&quot;s-table&quot;&gt;\n&lt;thead&gt;\n&lt;tr&gt;\n&lt;th&gt;ID&lt;/th&gt;\n&lt;th&gt;NAME&lt;/th&gt;\n&lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n&lt;tr&gt;\n&lt;td&gt;19&lt;/td&gt;\n&lt;td&gt;category1&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td&gt;19/1&lt;/td&gt;\n&lt;td&gt;category2&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td&gt;19/1/1&lt;/td&gt;\n&lt;td&gt;category3&lt;/td&gt;\n&lt;/tr&gt;\n&lt;tr&gt;\n&lt;td&gt;19/1/1/1&lt;/td&gt;\n&lt;td&gt;category4&lt;/td&gt;\n&lt;/tr&gt;\n&lt;/tbody&gt;\n&lt;/table&gt;\n&lt;/div&gt;\n&lt;p&gt;Then your &lt;code&gt;select&lt;/code&gt; would look like this:&lt;/p&gt;\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt;  id,\n        name \n&lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt;    products\n&lt;span class=&quot;hljs-keyword&quot;&gt;where&lt;/span&gt;   id &lt;span class=&quot;hljs-keyword&quot;&gt;like&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;19/%&apos;&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2&gt;Alternative 3: Repeated Self-joins&lt;/h2&gt;\n&lt;p&gt;If you know an upper limit for how deep your hierarchy tree can become, you can use a standard &lt;code&gt;sql&lt;/code&gt; query like this:&lt;/p&gt;\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt;      p6.parent_id &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; parent6_id,\n            p5.parent_id &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; parent5_id,\n            p4.parent_id &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; parent4_id,\n            p3.parent_id &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; parent3_id,\n            p2.parent_id &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; parent2_id,\n            p1.parent_id &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; parent_id,\n            p1.id &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; product_id,\n            p1.name\n&lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt;        products p1\n&lt;span class=&quot;hljs-keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt;   products p2 &lt;span class=&quot;hljs-keyword&quot;&gt;on&lt;/span&gt; p2.id &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; p1.parent_id \n&lt;span class=&quot;hljs-keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt;   products p3 &lt;span class=&quot;hljs-keyword&quot;&gt;on&lt;/span&gt; p3.id &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; p2.parent_id \n&lt;span class=&quot;hljs-keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt;   products p4 &lt;span class=&quot;hljs-keyword&quot;&gt;on&lt;/span&gt; p4.id &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; p3.parent_id  \n&lt;span class=&quot;hljs-keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt;   products p5 &lt;span class=&quot;hljs-keyword&quot;&gt;on&lt;/span&gt; p5.id &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; p4.parent_id  \n&lt;span class=&quot;hljs-keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt;   products p6 &lt;span class=&quot;hljs-keyword&quot;&gt;on&lt;/span&gt; p6.id &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; p5.parent_id\n&lt;span class=&quot;hljs-keyword&quot;&gt;where&lt;/span&gt;       &lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; (p1.parent_id, \n                   p2.parent_id, \n                   p3.parent_id, \n                   p4.parent_id, \n                   p5.parent_id, \n                   p6.parent_id) \n&lt;span class=&quot;hljs-keyword&quot;&gt;order&lt;/span&gt;       &lt;span class=&quot;hljs-keyword&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;See this &lt;a href=&quot;http://sqlfiddle.com/#!9/5de2a/46&quot; rel=&quot;noreferrer&quot;&gt;fiddle&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;The &lt;code&gt;where&lt;/code&gt; condition specifies which parent you want to retrieve the descendants of. You can extend this query with more levels as needed.&lt;/p&gt;\n    ","\n&lt;p&gt;From the blog &lt;strong&gt;&lt;a href=&quot;https://web.archive.org/web/20181221162916/http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/&quot; rel=&quot;noreferrer&quot;&gt;Managing Hierarchical Data in MySQL&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;\n\n&lt;p&gt;Table structure&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-comment&quot;&gt;-------------+----------------------+--------+&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category_id &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; name                 &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; parent &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-comment&quot;&gt;-------------+----------------------+--------+&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;           &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; ELECTRONICS          &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;           &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; TELEVISIONS          &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;      &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;           &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; TUBE                 &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;      &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;           &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; LCD                  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;      &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;           &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; PLASMA               &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;      &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;           &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; PORTABLE ELECTRONICS &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;      &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;           &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; MP3 PLAYERS          &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;      &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;           &lt;span class=&quot;hljs-number&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; FLASH                &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;      &lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;           &lt;span class=&quot;hljs-number&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; CD PLAYERS           &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;      &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;          &lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt; WAY RADIOS         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;      &lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-comment&quot;&gt;-------------+----------------------+--------+&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Query:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; t1.name &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; lev1, t2.name &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; lev2, t3.name &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; lev3, t4.name &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; lev4\n&lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; category &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; t1\n&lt;span class=&quot;hljs-keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt; category &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; t2 &lt;span class=&quot;hljs-keyword&quot;&gt;ON&lt;/span&gt; t2.parent &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; t1.category_id\n&lt;span class=&quot;hljs-keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt; category &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; t3 &lt;span class=&quot;hljs-keyword&quot;&gt;ON&lt;/span&gt; t3.parent &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; t2.category_id\n&lt;span class=&quot;hljs-keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt; category &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; t4 &lt;span class=&quot;hljs-keyword&quot;&gt;ON&lt;/span&gt; t4.parent &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; t3.category_id\n&lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; t1.name &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;ELECTRONICS&apos;&lt;/span&gt;;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Output&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-comment&quot;&gt;-------------+----------------------+--------------+-------+&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; lev1        &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; lev2                 &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; lev3         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; lev4  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-comment&quot;&gt;-------------+----------------------+--------------+-------+&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; ELECTRONICS &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; TELEVISIONS          &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; TUBE         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt;  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; ELECTRONICS &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; TELEVISIONS          &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; LCD          &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt;  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; ELECTRONICS &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; TELEVISIONS          &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; PLASMA       &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt;  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; ELECTRONICS &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; PORTABLE ELECTRONICS &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; MP3 PLAYERS  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; FLASH &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; ELECTRONICS &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; PORTABLE ELECTRONICS &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; CD PLAYERS   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt;  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; ELECTRONICS &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; PORTABLE ELECTRONICS &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt; WAY RADIOS &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt;  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-comment&quot;&gt;-------------+----------------------+--------------+-------+&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Most users at one time or another have dealt with hierarchical data in a SQL database and no doubt learned that the management of hierarchical data is not what a relational database is intended for. The tables of a relational database are not hierarchical (like XML), but are simply a flat list. Hierarchical data has a parent-child relationship that is not naturally represented in a relational database table.\n&lt;a href=&quot;https://web.archive.org/web/20181221162916/http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/&quot; rel=&quot;noreferrer&quot;&gt;Read more&lt;/a&gt;&lt;/p&gt;\n\n&lt;p&gt;Refer the blog for more details.&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;EDIT:&lt;/strong&gt;&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;category_id &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; category_id, name, parent &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; category\n&lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt;\n(&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;)tmp\n&lt;span class=&quot;hljs-keyword&quot;&gt;where&lt;/span&gt; parent&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Output:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;category_id name    parent\n&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;  category1   &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;  category2   &lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;  category3   &lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;  category4   &lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Reference: &lt;a href=&quot;https://stackoverflow.com/questions/16513418/how-to-do-the-recursive-select-query-in-mysql&quot;&gt;How to do the Recursive SELECT query in Mysql?&lt;/a&gt;&lt;/p&gt;\n    ","\n&lt;p&gt;Try these:&lt;/p&gt;\n\n&lt;p&gt;Table definition:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; IF &lt;span class=&quot;hljs-keyword&quot;&gt;EXISTS&lt;/span&gt; category;\n&lt;span class=&quot;hljs-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; category (\n    id &lt;span class=&quot;hljs-type&quot;&gt;INT&lt;/span&gt; AUTO_INCREMENT &lt;span class=&quot;hljs-keyword&quot;&gt;PRIMARY&lt;/span&gt; KEY,\n    name &lt;span class=&quot;hljs-type&quot;&gt;VARCHAR&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;),\n    parent_id &lt;span class=&quot;hljs-type&quot;&gt;INT&lt;/span&gt;,\n    &lt;span class=&quot;hljs-keyword&quot;&gt;CONSTRAINT&lt;/span&gt; fk_category_parent &lt;span class=&quot;hljs-keyword&quot;&gt;FOREIGN&lt;/span&gt; KEY (parent_id)\n    &lt;span class=&quot;hljs-keyword&quot;&gt;REFERENCES&lt;/span&gt; category (id)\n) engine&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;innodb;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Experimental rows:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; category &lt;span class=&quot;hljs-keyword&quot;&gt;VALUES&lt;/span&gt;\n(&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;category1&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt;),\n(&lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;category2&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;),\n(&lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;category3&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;),\n(&lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;category4&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;),\n(&lt;span class=&quot;hljs-number&quot;&gt;23&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;categoryA&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;),\n(&lt;span class=&quot;hljs-number&quot;&gt;24&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;categoryB&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;23&lt;/span&gt;),\n(&lt;span class=&quot;hljs-number&quot;&gt;25&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;categoryC&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;23&lt;/span&gt;),\n(&lt;span class=&quot;hljs-number&quot;&gt;26&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;categoryD&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;24&lt;/span&gt;);\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Recursive Stored procedure:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;PROCEDURE&lt;/span&gt; IF &lt;span class=&quot;hljs-keyword&quot;&gt;EXISTS&lt;/span&gt; getpath;\nDELIMITER $$\n&lt;span class=&quot;hljs-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;PROCEDURE&lt;/span&gt; getpath(&lt;span class=&quot;hljs-keyword&quot;&gt;IN&lt;/span&gt; cat_id &lt;span class=&quot;hljs-type&quot;&gt;INT&lt;/span&gt;, &lt;span class=&quot;hljs-keyword&quot;&gt;OUT&lt;/span&gt; path TEXT)\n&lt;span class=&quot;hljs-keyword&quot;&gt;BEGIN&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; catname &lt;span class=&quot;hljs-type&quot;&gt;VARCHAR&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;);\n    &lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; temppath TEXT;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; tempparent &lt;span class=&quot;hljs-type&quot;&gt;INT&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;SET&lt;/span&gt; max_sp_recursion_depth &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;255&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; name, parent_id &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; category &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; id&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;cat_id &lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; catname, tempparent;\n    IF tempparent &lt;span class=&quot;hljs-keyword&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;THEN&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;SET&lt;/span&gt; path &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; catname;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;ELSE&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;CALL&lt;/span&gt; getpath(tempparent, temppath);\n        &lt;span class=&quot;hljs-keyword&quot;&gt;SET&lt;/span&gt; path &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; CONCAT(temppath, &lt;span class=&quot;hljs-string&quot;&gt;&apos;/&apos;&lt;/span&gt;, catname);\n    &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt; IF;\n&lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt;$$\nDELIMITER ;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Wrapper function for the stored procedure:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FUNCTION&lt;/span&gt; IF &lt;span class=&quot;hljs-keyword&quot;&gt;EXISTS&lt;/span&gt; getpath;\nDELIMITER $$\n&lt;span class=&quot;hljs-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FUNCTION&lt;/span&gt; getpath(cat_id &lt;span class=&quot;hljs-type&quot;&gt;INT&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;RETURNS&lt;/span&gt; TEXT &lt;span class=&quot;hljs-keyword&quot;&gt;DETERMINISTIC&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;BEGIN&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; res TEXT;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;CALL&lt;/span&gt; getpath(cat_id, res);\n    &lt;span class=&quot;hljs-keyword&quot;&gt;RETURN&lt;/span&gt; res;\n&lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt;$$\nDELIMITER ;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Select example:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; id, name, getpath(id) &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; category;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Output:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-comment&quot;&gt;----+-----------+-----------------------------------------+&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; id &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; name      &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; path                                    &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-comment&quot;&gt;----+-----------+-----------------------------------------+&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category1 &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category1                               &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category2 &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category1&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;category2                     &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category3 &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category1&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;category2&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;category3           &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category4 &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category1&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;category2&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;category3&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;category4 &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;23&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; categoryA &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category1&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;categoryA                     &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; categoryB &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category1&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;categoryA&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;categoryB           &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; categoryC &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category1&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;categoryA&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;categoryC           &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;26&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; categoryD &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category1&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;categoryA&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;categoryB&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;categoryD &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-comment&quot;&gt;----+-----------+-----------------------------------------+&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Filtering rows with certain path:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; id, name, getpath(id) &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; category &lt;span class=&quot;hljs-keyword&quot;&gt;HAVING&lt;/span&gt; path &lt;span class=&quot;hljs-keyword&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;category1/category2%&apos;&lt;/span&gt;;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Output:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-comment&quot;&gt;----+-----------+-----------------------------------------+&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; id &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; name      &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; path                                    &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-comment&quot;&gt;----+-----------+-----------------------------------------+&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category2 &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category1&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;category2                     &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category3 &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category1&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;category2&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;category3           &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category4 &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category1&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;category2&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;category3&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;category4 &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-comment&quot;&gt;----+-----------+-----------------------------------------+&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Did the same thing for another quetion here&lt;/p&gt;\n\n&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/28363893/mysql-select-recursive-get-all-child-with-multiple-level/28366310&quot;&gt;Mysql select recursive get all child with multiple level&lt;/a&gt;&lt;/p&gt;\n\n&lt;p&gt;The query will be :&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; GROUP_CONCAT(lv SEPARATOR &lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; (\n  &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;(\n    &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; GROUP_CONCAT(id SEPARATOR &lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt;)\n    &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; parent_id &lt;span class=&quot;hljs-keyword&quot;&gt;IN&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;)\n  ) &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; lv &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;table&lt;/span&gt; \n  &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt;\n  (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;)tmp\n  &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; parent_id &lt;span class=&quot;hljs-keyword&quot;&gt;IN&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;)\n) a;\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;If you need quick read speed, the best option is to use a closure table. A closure table contains a row for each ancestor/descendant pair. So in your example, the closure table would look like&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;ancestor &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; descendant &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; depth\n&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;        &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;          &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;        &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;        &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;        &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;        &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;       &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;       &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;       &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;       &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;       &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;       &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;       &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;       &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;       &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;       &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;         &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Once you have this table, hierarchical queries become very easy and fast. To get all the descendants of category 20:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; cat.&lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; categories_closure &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; cl\n&lt;span class=&quot;hljs-keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt; categories &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; cat &lt;span class=&quot;hljs-keyword&quot;&gt;ON&lt;/span&gt; cat.id &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; cl.descendant\n&lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; cl.ancestor &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AND&lt;/span&gt; cl.depth &lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Of course, there is a big downside whenever you use denormalized data like this. You need to maintain the closure table alongside your categories table. The best way is probably to use triggers, but it is somewhat complex to correctly track inserts/updates/deletes for closure tables. As with anything, you need to look at your requirements and decide what approach is best for you.&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;Edit&lt;/strong&gt;: See the question &lt;a href=&quot;https://stackoverflow.com/questions/4048151/what-are-the-options-for-storing-hierarchical-data-in-a-relational-database&quot;&gt;What are the options for storing hierarchical data in a relational database?&lt;/a&gt; for more options. There are different optimal solutions for different situations.&lt;/p&gt;\n    ","\n&lt;p&gt;The best approach I&apos;ve come up with is&lt;/p&gt;\n\n&lt;ol&gt;\n&lt;li&gt;Use lineage to store\\sort\\trace trees. That&apos;s more than enough, and works thousands times faster for reading than any other approach.\nIt also allows to stay on that pattern even if DB will change(as ANY db will allow that pattern to be used)&lt;/li&gt;\n&lt;li&gt;Use function that determines lineage for specific ID.&lt;/li&gt;\n&lt;li&gt;Use it as you wish (in selects, or on CUD operations, or even by jobs).&lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;p&gt;Lineage approach descr. can be found wherever, for example\n&lt;a href=&quot;http://ferdychristant.com/blog/archive/DOMM-7QJPM7&quot; rel=&quot;nofollow noreferrer&quot;&gt;Here&lt;/a&gt; or &lt;a href=&quot;https://dba.stackexchange.com/questions/30021/mysql-tree-hierarchical-query&quot;&gt;here&lt;/a&gt;.\nAs of function - &lt;a href=&quot;https://stackoverflow.com/questions/12948009/finding-all-parents-in-mysql-table-with-single-query&quot;&gt;that&lt;/a&gt; is what enspired me.&lt;/p&gt;\n\n&lt;p&gt;In the end - got more-or-less simple, relatively fast, and SIMPLE solution.&lt;/p&gt;\n\n&lt;p&gt;Function&apos;s body&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;-- --------------------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;-- Routine DDL&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;-- &lt;span class=&quot;hljs-doctag&quot;&gt;Note:&lt;/span&gt; comments before and after the routine body will not be stored by the server&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;-- --------------------------------------------------------------------------------&lt;/span&gt;\nDELIMITER $$\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;CREATE&lt;/span&gt; DEFINER&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;`root`@`localhost` &lt;span class=&quot;hljs-keyword&quot;&gt;FUNCTION&lt;/span&gt; `get_lineage`(the_id &lt;span class=&quot;hljs-type&quot;&gt;INT&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;RETURNS&lt;/span&gt; text CHARSET utf8\n    &lt;span class=&quot;hljs-keyword&quot;&gt;READS&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;SQL&lt;/span&gt; DATA\n&lt;span class=&quot;hljs-keyword&quot;&gt;BEGIN&lt;/span&gt;\n\n &lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; v_rec &lt;span class=&quot;hljs-type&quot;&gt;INT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n\n &lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; done &lt;span class=&quot;hljs-type&quot;&gt;INT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;FALSE&lt;/span&gt;;\n &lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; v_res text &lt;span class=&quot;hljs-keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;;\n &lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; v_papa &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt;;\n &lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; v_papa_papa &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;-1&lt;/span&gt;;\n &lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; csr &lt;span class=&quot;hljs-keyword&quot;&gt;CURSOR&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt; \n  &lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; _id,parent_id &lt;span class=&quot;hljs-comment&quot;&gt;-- @n:=@n+1 as rownum,T1.* &lt;/span&gt;\n  &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; \n    (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@r&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; _id,\n        (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@r&lt;/span&gt; :&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; table_parent_id &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;table&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; table_id &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; _id) &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; parent_id,\n        &lt;span class=&quot;hljs-variable&quot;&gt;@l&lt;/span&gt; :&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@l&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; lvl\n    &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt;\n        (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@r&lt;/span&gt; :&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; the_id, &lt;span class=&quot;hljs-variable&quot;&gt;@l&lt;/span&gt; :&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;hljs-variable&quot;&gt;@n&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;) vars,\n        &lt;span class=&quot;hljs-keyword&quot;&gt;table&lt;/span&gt; m\n    &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@r&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;&amp;lt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n    ) T1\n    &lt;span class=&quot;hljs-keyword&quot;&gt;where&lt;/span&gt; T1.parent_id &lt;span class=&quot;hljs-keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;\n &lt;span class=&quot;hljs-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;BY&lt;/span&gt; T1.lvl &lt;span class=&quot;hljs-keyword&quot;&gt;DESC&lt;/span&gt;;\n &lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; CONTINUE HANDLER &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NOT&lt;/span&gt; FOUND &lt;span class=&quot;hljs-keyword&quot;&gt;SET&lt;/span&gt; done &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;TRUE&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;open&lt;/span&gt; csr;\n    read_loop: LOOP\n    &lt;span class=&quot;hljs-keyword&quot;&gt;fetch&lt;/span&gt; csr &lt;span class=&quot;hljs-keyword&quot;&gt;into&lt;/span&gt; v_papa,v_papa_papa;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;SET&lt;/span&gt; v_rec &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; v_rec&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;\n        IF done &lt;span class=&quot;hljs-keyword&quot;&gt;THEN&lt;/span&gt;\n            LEAVE read_loop;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt; IF;\n        &lt;span class=&quot;hljs-comment&quot;&gt;-- add first&lt;/span&gt;\n        IF v_rec &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;THEN&lt;/span&gt;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;SET&lt;/span&gt; v_res &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; v_papa_papa;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt; IF;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;SET&lt;/span&gt; v_res &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; CONCAT(v_res,&lt;span class=&quot;hljs-string&quot;&gt;&apos;-&apos;&lt;/span&gt;,v_papa);\n    &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt; LOOP;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;close&lt;/span&gt; csr;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; v_res;\n&lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;And then you just&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; get_lineage(the_id)\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Hope it helps somebody :)&lt;/p&gt;\n    ","\n&lt;p&gt;Based on the @trincot answer, very good explained, I use &lt;code&gt;WITH RECURSIVE ()&lt;/code&gt; statement to &lt;strong&gt;create a breadcrumb&lt;/strong&gt; using &lt;code&gt;id&lt;/code&gt; of the current page and &lt;strong&gt;go backwards in the hierarchy&lt;/strong&gt; to find the every &lt;code&gt;parent&lt;/code&gt; in my &lt;code&gt;route&lt;/code&gt; table.&lt;/p&gt;\n&lt;p&gt;So, the @trincot solution is adapted here in the opposite direction to find parents instead of descendants.&lt;/p&gt;\n&lt;p&gt;I also added &lt;code&gt;depth&lt;/code&gt; value which is usefull to invert result order (otherwise the breadcrumb would be upside down).&lt;/p&gt;\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;WITH&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;RECURSIVE&lt;/span&gt; cte (\n    `id`,\n    `title`,\n    `url`,\n    `icon`,\n    `class`,\n    `parent_id`,\n    `depth`\n) &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; (\n    &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt;   \n        `id`,\n        `title`,\n        `url`,\n        `icon`,\n        `class`,\n        `parent_id`,\n        &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; `depth` \n    &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt;     `route`\n    &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt;    `id` &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; :id\n      \n    &lt;span class=&quot;hljs-keyword&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;ALL&lt;/span&gt; \n    &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; \n        P.`id`,\n        P.`title`,\n        P.`url`,\n        P.`icon`,\n        P.`class`,\n        P.`parent_id`,\n        `depth` &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; `route` P\n        \n    &lt;span class=&quot;hljs-keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt; cte\n        &lt;span class=&quot;hljs-keyword&quot;&gt;ON&lt;/span&gt; P.`id` &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; cte.`parent_id`\n)\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; cte &lt;span class=&quot;hljs-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;BY&lt;/span&gt; `depth` &lt;span class=&quot;hljs-keyword&quot;&gt;DESC&lt;/span&gt;;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;Before upgrade to mySQL 8+, &lt;strong&gt;I was using vars but it&apos;s deprecated and no more working on my 8.0.22 version&lt;/strong&gt; !&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;&lt;strong&gt;EDIT 2021-02-19&lt;/strong&gt; :\n&lt;strong&gt;Example for hierarchical menu&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;After @david comment I decided to try to make a full hierarchical menu with all nodes and sorted as I want (with &lt;code&gt;sorting&lt;/code&gt; column which sort items in each depth). Very usefull for my user/authorization matrix page.&lt;/p&gt;\n&lt;p&gt;&lt;em&gt;This really simplifies my old version with one query on each depth (PHP loops)&lt;/em&gt;.&lt;/p&gt;\n&lt;p&gt;&lt;a href=&quot;https://i.stack.imgur.com/eeGnI.png&quot; rel=&quot;noreferrer&quot;&gt;&lt;img src=&quot;https://i.stack.imgur.com/eeGnI.png&quot; alt=&quot;ERP authroization Matrix&quot;&gt;&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;This example intergrates an INNER JOIN with &lt;code&gt;url&lt;/code&gt; table to filter route by website (multi-websites CMS system).&lt;/p&gt;\n&lt;p&gt;You can see the essential &lt;code&gt;path&lt;/code&gt; column that contains &lt;code&gt;CONCAT()&lt;/code&gt; function to sort the menu in the right way.&lt;/p&gt;\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; R.&lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; (\n    &lt;span class=&quot;hljs-keyword&quot;&gt;WITH&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;RECURSIVE&lt;/span&gt; cte (\n        `id`,\n        `title`,\n        `url`,\n        `icon`,\n        `class`,\n        `parent`,\n        `depth`,\n        `sorting`,\n        `path`\n    ) &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; (\n        &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; \n            `id`,\n            `title`,\n            `url`,\n            `icon`,\n            `class`,\n            `parent`,\n            &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; `depth`,\n            `sorting`,\n            CONCAT(`sorting`, &lt;span class=&quot;hljs-string&quot;&gt;&apos; &apos;&lt;/span&gt; , `title`) &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; `path`\n        &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; `route`\n        &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; `parent` &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;ALL&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; \n            D.`id`,\n            D.`title`,\n            D.`url`,\n            D.`icon`,\n            D.`class`,\n            D.`parent`,\n            `depth` &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,\n            D.`sorting`,\n            CONCAT(cte.`path`, &lt;span class=&quot;hljs-string&quot;&gt;&apos; &amp;gt; &apos;&lt;/span&gt;, D.`sorting`, &lt;span class=&quot;hljs-string&quot;&gt;&apos; &apos;&lt;/span&gt; , D.`title`)\n        &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; `route` D\n        &lt;span class=&quot;hljs-keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt; cte\n            &lt;span class=&quot;hljs-keyword&quot;&gt;ON&lt;/span&gt; cte.`id` &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; D.`parent`\n    )\n    &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; cte\n) R\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;INNER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt; `url` U\n    &lt;span class=&quot;hljs-keyword&quot;&gt;ON&lt;/span&gt; R.`id` &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; U.`route_id`\n    &lt;span class=&quot;hljs-keyword&quot;&gt;AND&lt;/span&gt; U.`site_id` &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;BY&lt;/span&gt; `path` &lt;span class=&quot;hljs-keyword&quot;&gt;ASC&lt;/span&gt;  \n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Simple query to list child&apos;s of first recursion:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;id &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; id, name, parent_id\n&lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; products\n&lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;)tmp\n&lt;span class=&quot;hljs-keyword&quot;&gt;where&lt;/span&gt; parent_id&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Result:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;id  name        parent_id\n&lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;  category2   &lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;  category3   &lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;  category4   &lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;26&lt;/span&gt;  category24  &lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;... with left join:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt;\n    &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;p1.id &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; id\n  , p2.name &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; parent_name\n  , p1.name name\n  , p1.parent_id\n&lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; products p1\n&lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;)tmp\n&lt;span class=&quot;hljs-keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt; products p2 &lt;span class=&quot;hljs-keyword&quot;&gt;on&lt;/span&gt; p2.id&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;p1.parent_id &lt;span class=&quot;hljs-comment&quot;&gt;-- optional join to get parent name&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;where&lt;/span&gt; p1.parent_id&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;The solution of @tincot to list all child&apos;s:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt;  id,\n        name,\n        parent_id \n&lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt;    (&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; products\n         &lt;span class=&quot;hljs-keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;by&lt;/span&gt; parent_id, id) products_sorted,\n        (&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt; :&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;19&apos;&lt;/span&gt;) initialisation\n&lt;span class=&quot;hljs-keyword&quot;&gt;where&lt;/span&gt;   find_in_set(parent_id, &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;) &lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;and&lt;/span&gt;     &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt; :&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; concat(&lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt;, id)\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Test it online with &lt;a href=&quot;http://sqlfiddle.com/#!9/a318e3/4/0&quot; rel=&quot;noreferrer&quot;&gt;Sql Fiddle&lt;/a&gt; and see all results.&lt;/p&gt;\n\n&lt;p&gt;&lt;a href=&quot;http://sqlfiddle.com/#!9/a318e3/4/0&quot; rel=&quot;noreferrer&quot;&gt;http://sqlfiddle.com/#!9/a318e3/4/0&lt;/a&gt;&lt;/p&gt;\n    ","\n&lt;p&gt;Something not mentioned here, although a bit similar to the second alternative of the accepted answer but different and low cost for big hierarchy query and easy (insert update delete) items, would be  adding a persistent path  column for each item.&lt;/p&gt;\n\n&lt;p&gt;some like:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;id &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; name        &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; path\n&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category1   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category2   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category3   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;\n&lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; category4   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Example:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;-- get children of category3:&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; my_table &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; path &lt;span class=&quot;hljs-keyword&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;/19/20/21%&apos;&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;-- Reparent an item:&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;UPDATE&lt;/span&gt; my_table &lt;span class=&quot;hljs-keyword&quot;&gt;SET&lt;/span&gt; path &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; REPLACE(path, &lt;span class=&quot;hljs-string&quot;&gt;&apos;/19/20&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;/15/16&apos;&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; path &lt;span class=&quot;hljs-keyword&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;/19/20/%&apos;&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;&lt;strong&gt;Optimise the path length and &lt;code&gt;ORDER BY path&lt;/code&gt; using base36 encoding instead real numeric path id&lt;/strong&gt; &lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt; &lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt; base10 &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt; base36\n &lt;span class=&quot;hljs-string&quot;&gt;&apos;1&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;1&apos;&lt;/span&gt;,\n &lt;span class=&quot;hljs-string&quot;&gt;&apos;10&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;A&apos;&lt;/span&gt;,\n &lt;span class=&quot;hljs-string&quot;&gt;&apos;100&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;2S&apos;&lt;/span&gt;,\n &lt;span class=&quot;hljs-string&quot;&gt;&apos;1000&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;RS&apos;&lt;/span&gt;,\n &lt;span class=&quot;hljs-string&quot;&gt;&apos;10000&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;7PS&apos;&lt;/span&gt;,\n &lt;span class=&quot;hljs-string&quot;&gt;&apos;100000&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;255S&apos;&lt;/span&gt;,\n &lt;span class=&quot;hljs-string&quot;&gt;&apos;1000000&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;LFLS&apos;&lt;/span&gt;,\n &lt;span class=&quot;hljs-string&quot;&gt;&apos;1000000000&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;GJDGXS&apos;&lt;/span&gt;,\n &lt;span class=&quot;hljs-string&quot;&gt;&apos;1000000000000&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;CRE66I9S&apos;&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Base36&quot; rel=&quot;noreferrer&quot;&gt;https://en.wikipedia.org/wiki/Base36&lt;/a&gt;&lt;/p&gt;\n\n&lt;p&gt;Suppressing also the slash &apos;/&apos; separator by using fixed length and padding to the encoded id&lt;/p&gt;\n\n&lt;p&gt;Detailed optimization explanation here:\n&lt;a href=&quot;https://bojanz.wordpress.com/2014/04/25/storing-hierarchical-data-materialized-path/&quot; rel=&quot;noreferrer&quot;&gt;https://bojanz.wordpress.com/2014/04/25/storing-hierarchical-data-materialized-path/&lt;/a&gt;&lt;/p&gt;\n\n&lt;p&gt;&lt;strong&gt;TODO&lt;/strong&gt;&lt;/p&gt;\n\n&lt;p&gt;building a function or procedure to split path for retreive ancestors of one item&lt;/p&gt;\n    ","\n&lt;p&gt;You can do it like this in other databases quite easily with a recursive query (YMMV on performance).&lt;/p&gt;\n\n&lt;p&gt;The other way to do it is to store two extra bits of data, a left and right value. The left and right value are derived from a pre-order traversal of the tree structure you&apos;re representing.&lt;/p&gt;\n\n&lt;p&gt;This is know as Modified Preorder Tree Traversal and lets you run a simple query to get all parent values at once. It also goes by the name &quot;nested set&quot;.&lt;/p&gt;\n    ","\n&lt;p&gt;Just use &lt;a href=&quot;https://github.com/BlueM/Tree&quot; rel=&quot;nofollow noreferrer&quot;&gt;BlueM/tree&lt;/a&gt; php class for make tree of a self-relation table in mysql.&lt;/p&gt;\n\n&lt;blockquote&gt;\n  &lt;p&gt;Tree&amp;nbsp;and&amp;nbsp;Tree\\Node&amp;nbsp;are PHP classes for handling data that is structured hierarchically using parent ID references. A typical example is a table in a relational database where each records parent field references the primary key of another record. Of course, Tree cannot only use data originating from a database, but anything: you supply the data, and Tree uses it, regardless of where the data came from and how it was processed. &lt;a href=&quot;https://github.com/BlueM/Tree/blob/master/README.markdown&quot; rel=&quot;nofollow noreferrer&quot;&gt;read more&lt;/a&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n\n&lt;p&gt;Here is an example of using BlueM/tree:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-operator&quot;&gt;&amp;lt;&lt;/span&gt;?php \nrequire &lt;span class=&quot;hljs-string&quot;&gt;&apos;/path/to/vendor/autoload.php&apos;&lt;/span&gt;; $db &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; PDO(...); &lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;Set&lt;/span&gt; up your database connection \n$stm &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; $db&lt;span class=&quot;hljs-operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt;query(&lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT id, parent, title FROM tablename ORDER BY title&apos;&lt;/span&gt;); \n$records &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; $stm&lt;span class=&quot;hljs-operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt;fetchAll(PDO::FETCH_ASSOC); \n$tree &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; BlueM\\Tree($records); \n...\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;&lt;a href=&quot;https://i.stack.imgur.com/mjPhB.png&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;img src=&quot;https://i.stack.imgur.com/mjPhB.png&quot; alt=&quot;enter image description here&quot;&gt;&lt;/a&gt;&lt;/p&gt;\n\n&lt;p&gt;It&apos;s a &lt;strong&gt;category&lt;/strong&gt; table.&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt;  id,\n        NAME,\n        parent_category \n&lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt;    (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; category\n         &lt;span class=&quot;hljs-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;BY&lt;/span&gt; parent_category, id) products_sorted,\n        (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt; :&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;2&apos;&lt;/span&gt;) initialisation\n&lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt;   FIND_IN_SET(parent_category, &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;) &lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;AND&lt;/span&gt;     &lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt; :&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; CONCAT(&lt;span class=&quot;hljs-variable&quot;&gt;@pv&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt;, id)\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;&lt;strong&gt;&lt;em&gt;Output::&lt;/em&gt;&lt;/strong&gt;\n&lt;a href=&quot;https://i.stack.imgur.com/VzdrQ.png&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;img src=&quot;https://i.stack.imgur.com/VzdrQ.png&quot; alt=&quot;enter image description here&quot;&gt;&lt;/a&gt;&lt;/p&gt;\n    ","\n&lt;p&gt;Its a little tricky one, check this whether it is working for you&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; a.id,if(a.parent &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;hljs-variable&quot;&gt;@varw&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;concat(a.id,&lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt;),&lt;span class=&quot;hljs-variable&quot;&gt;@varw&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;concat(a.id,&lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-variable&quot;&gt;@varw&lt;/span&gt;)) &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; list &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; recursivejoin &lt;span class=&quot;hljs-keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;by&lt;/span&gt; if(parent&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,id,parent) &lt;span class=&quot;hljs-keyword&quot;&gt;asc&lt;/span&gt;) a &lt;span class=&quot;hljs-keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt; recursivejoin b &lt;span class=&quot;hljs-keyword&quot;&gt;on&lt;/span&gt; (a.id &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; b.parent),(&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@varw&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; c  &lt;span class=&quot;hljs-keyword&quot;&gt;having&lt;/span&gt; list &lt;span class=&quot;hljs-keyword&quot;&gt;like&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;%19,%&apos;&lt;/span&gt;;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;SQL fiddle link &lt;a href=&quot;http://www.sqlfiddle.com/#!2/e3cdf/2&quot; rel=&quot;nofollow&quot;&gt;http://www.sqlfiddle.com/#!2/e3cdf/2&lt;/a&gt;&lt;/p&gt;\n\n&lt;p&gt;Replace with your field and table name appropriately. &lt;/p&gt;\n    ","\n&lt;p&gt;This works for me, hope this will work for you too. It will give you a Record set Root to Child for any Specific Menu. Change the Field name as per your requirements.&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@id&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;22&apos;&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; Menu_Name, (&lt;span class=&quot;hljs-variable&quot;&gt;@id&lt;/span&gt;:&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;Sub_Menu_ID ) &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; Sub_Menu_ID, Menu_ID \n&lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; \n    ( &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; Menu_ID, Menu_Name, Sub_Menu_ID \n      &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; menu \n      &lt;span class=&quot;hljs-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;BY&lt;/span&gt; Sub_Menu_ID &lt;span class=&quot;hljs-keyword&quot;&gt;DESC&lt;/span&gt;\n    ) &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; aux_table \n    &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; Menu_ID &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@id&lt;/span&gt;\n     &lt;span class=&quot;hljs-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;BY&lt;/span&gt; Sub_Menu_ID;\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;I found it more easily to :&lt;/p&gt;\n\n&lt;p&gt;1) create a function that will check if a item is anywhere in the parent hierarchy of another one. Something like this (I will not write the function, make it with WHILE DO) :&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;is_related(id, parent_id);\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;in your example &lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;is_related(&lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;) &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;\nis_related(&lt;span class=&quot;hljs-number&quot;&gt;20&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;19&lt;/span&gt;) &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;\nis_related(&lt;span class=&quot;hljs-number&quot;&gt;21&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;18&lt;/span&gt;) &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;2) use a sub-select , something like this:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; ...\n&lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;table&lt;/span&gt; t\n&lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;table&lt;/span&gt; pt &lt;span class=&quot;hljs-keyword&quot;&gt;on&lt;/span&gt; pt.id &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; i.id &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;table&lt;/span&gt; i &lt;span class=&quot;hljs-keyword&quot;&gt;where&lt;/span&gt; is_related(t.id,i.id));\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;I have made a query for you. This will give you Recursive Category with a Single Query:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; id,NAME,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; subName,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; subsubName,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; subsubsubName &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; Table1 &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; prent &lt;span class=&quot;hljs-keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;UNION&lt;/span&gt; \n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; b.id,a.name,b.name &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; subName,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; subsubName,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; subsubsubName &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; Table1 &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; a &lt;span class=&quot;hljs-keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt; Table1 &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; b &lt;span class=&quot;hljs-keyword&quot;&gt;ON&lt;/span&gt; b.prent&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;a.id &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; a.prent &lt;span class=&quot;hljs-keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AND&lt;/span&gt; b.name &lt;span class=&quot;hljs-keyword&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt; \n&lt;span class=&quot;hljs-keyword&quot;&gt;UNION&lt;/span&gt; \n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; c.id,a.name,b.name &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; subName,c.name &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; subsubName,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; subsubsubName &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; Table1 &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; a &lt;span class=&quot;hljs-keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt; Table1 &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; b &lt;span class=&quot;hljs-keyword&quot;&gt;ON&lt;/span&gt; b.prent&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;a.id &lt;span class=&quot;hljs-keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt; Table1 &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; c &lt;span class=&quot;hljs-keyword&quot;&gt;ON&lt;/span&gt; c.prent&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;b.id &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; a.prent &lt;span class=&quot;hljs-keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AND&lt;/span&gt; c.name &lt;span class=&quot;hljs-keyword&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt; \n&lt;span class=&quot;hljs-keyword&quot;&gt;UNION&lt;/span&gt; \n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; d.id,a.name,b.name &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; subName,c.name &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; subsubName,d.name &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; subsubsubName &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; Table1 &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; a &lt;span class=&quot;hljs-keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt; Table1 &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; b &lt;span class=&quot;hljs-keyword&quot;&gt;ON&lt;/span&gt; b.prent&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;a.id &lt;span class=&quot;hljs-keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt; Table1 &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; c &lt;span class=&quot;hljs-keyword&quot;&gt;ON&lt;/span&gt; c.prent&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;b.id &lt;span class=&quot;hljs-keyword&quot;&gt;LEFT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;JOIN&lt;/span&gt; Table1 &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; d &lt;span class=&quot;hljs-keyword&quot;&gt;ON&lt;/span&gt; d.prent&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;c.id &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; a.prent &lt;span class=&quot;hljs-keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AND&lt;/span&gt; d.name &lt;span class=&quot;hljs-keyword&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt; \n&lt;span class=&quot;hljs-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;BY&lt;/span&gt; NAME,subName,subsubName,subsubsubName\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Here is a &lt;a href=&quot;http://sqlfiddle.com/#!9/b4f997/3&quot; rel=&quot;nofollow noreferrer&quot;&gt;fiddle&lt;/a&gt;.&lt;/p&gt;\n    "]},"randomTags":[{"name":"dst","slug":"dst"},{"name":"event-propagation","slug":"event-propagation"},{"name":"clearfix","slug":"clearfix"},{"name":"reshape2","slug":"reshape2"},{"name":"javafx","slug":"javafx"},{"name":"int","slug":"int"},{"name":"linked-list","slug":"linked-list"},{"name":"dataframe","slug":"dataframe"},{"name":"dom","slug":"dom"},{"name":"design-patterns","slug":"design-patterns"},{"name":"listview","slug":"listview"},{"name":"getelementsbyclassname","slug":"getelementsbyclassname"},{"name":"polymorphism","slug":"polymorphism"},{"name":"post","slug":"post"},{"name":"sticky-footer","slug":"sticky-footer"},{"name":"thread-safety","slug":"thread-safety"},{"name":"gethashcode","slug":"gethashcode"},{"name":"content-script","slug":"content-script"},{"name":"ereg","slug":"ereg"},{"name":"cpu-architecture","slug":"cpu-architecture"}]},"__N_SSG":true}