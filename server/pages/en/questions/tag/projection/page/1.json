{"pageProps":{"data":{"count":1,"rows":[{"id":184,"title":"Retrieve only the queried element in an object array in MongoDB collection","slug":"retrieve-only-the-queried-element-in-an-object-array-in-mongodb-collection-1657384890457","postType":"QUESTION","createdAt":"2022-07-09T16:41:30.000Z","updatedAt":"2022-07-09T16:41:30.000Z","tags":[{"id":678,"name":"projection","slug":"projection","createdAt":"2022-07-09T16:41:30.000Z","updatedAt":"2022-07-09T16:41:30.000Z","Questions_Tags":{"questionId":184,"tagId":678}}]}]},"slug":"projection","page":"1","answers":{"184":["\n&lt;p&gt;MongoDB 2.2&apos;s new &lt;a href=&quot;http://docs.mongodb.org/manual/reference/projection/elemMatch/&quot; rel=&quot;noreferrer&quot;&gt;&lt;code&gt;$elemMatch&lt;/code&gt;&lt;/a&gt; projection operator provides another way to alter the returned document to contain only the &lt;strong&gt;&lt;em&gt;first&lt;/em&gt;&lt;/strong&gt; matched &lt;code&gt;shapes&lt;/code&gt; element:&lt;/p&gt;\n\n\n\n&lt;pre class=&quot;lang-javascript s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;db.&lt;span class=&quot;hljs-property&quot;&gt;test&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;find&lt;/span&gt;(\n    {&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.color&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;}, \n    {&lt;span class=&quot;hljs-attr&quot;&gt;_id&lt;/span&gt;: &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-attr&quot;&gt;shapes&lt;/span&gt;: {&lt;span class=&quot;hljs-attr&quot;&gt;$elemMatch&lt;/span&gt;: {&lt;span class=&quot;hljs-attr&quot;&gt;color&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;}}});\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Returns:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-javascript s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;{&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes&quot;&lt;/span&gt; : [{&lt;span class=&quot;hljs-string&quot;&gt;&quot;shape&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;circle&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;color&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;}]}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;In 2.2 you can also do this using the &lt;a href=&quot;http://docs.mongodb.org/manual/reference/operator/projection/positional/#proj._S_&quot; rel=&quot;noreferrer&quot;&gt;&lt;code&gt;$ projection operator&lt;/code&gt;&lt;/a&gt;, where the &lt;code&gt;$&lt;/code&gt; in a projection object field name represents the index of the field&apos;s first matching array element from the query.  The following returns the same results as above:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-javascript s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;db.&lt;span class=&quot;hljs-property&quot;&gt;test&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;find&lt;/span&gt;({&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.color&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;}, {&lt;span class=&quot;hljs-attr&quot;&gt;_id&lt;/span&gt;: &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;shapes.$&apos;&lt;/span&gt;: &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;});\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;&lt;strong&gt;MongoDB 3.2 Update&lt;/strong&gt;&lt;/p&gt;\n\n&lt;p&gt;Starting with the 3.2 release, you can use the new &lt;a href=&quot;https://docs.mongodb.org/master/reference/operator/aggregation/filter/#exp._S_filter&quot; rel=&quot;noreferrer&quot;&gt;&lt;code&gt;$filter&lt;/code&gt;&lt;/a&gt; aggregation operator to filter an array during projection, which has the benefit of including &lt;em&gt;all&lt;/em&gt; matches, instead of just the first one.&lt;/p&gt;\n\n&lt;pre class=&quot;lang-javascript s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;db.&lt;span class=&quot;hljs-property&quot;&gt;test&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;aggregate&lt;/span&gt;([\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Get just the docs that contain a shapes element where color is &apos;red&apos;&lt;/span&gt;\n    {&lt;span class=&quot;hljs-attr&quot;&gt;$match&lt;/span&gt;: {&lt;span class=&quot;hljs-string&quot;&gt;&apos;shapes.color&apos;&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&apos;red&apos;&lt;/span&gt;}},\n    {&lt;span class=&quot;hljs-attr&quot;&gt;$project&lt;/span&gt;: {\n        &lt;span class=&quot;hljs-attr&quot;&gt;shapes&lt;/span&gt;: {&lt;span class=&quot;hljs-attr&quot;&gt;$filter&lt;/span&gt;: {\n            &lt;span class=&quot;hljs-attr&quot;&gt;input&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&apos;$shapes&apos;&lt;/span&gt;,\n            &lt;span class=&quot;hljs-attr&quot;&gt;as&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&apos;shape&apos;&lt;/span&gt;,\n            &lt;span class=&quot;hljs-attr&quot;&gt;cond&lt;/span&gt;: {&lt;span class=&quot;hljs-attr&quot;&gt;$eq&lt;/span&gt;: [&lt;span class=&quot;hljs-string&quot;&gt;&apos;$$shape.color&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;red&apos;&lt;/span&gt;]}\n        }},\n        &lt;span class=&quot;hljs-attr&quot;&gt;_id&lt;/span&gt;: &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n    }}\n])\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Results:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-javascript s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;[ \n    {\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes&quot;&lt;/span&gt; : [ \n            {\n                &lt;span class=&quot;hljs-string&quot;&gt;&quot;shape&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;circle&quot;&lt;/span&gt;,\n                &lt;span class=&quot;hljs-string&quot;&gt;&quot;color&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;\n            }\n        ]\n    }\n]\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;The new &lt;a href=&quot;http://docs.mongodb.org/manual/applications/aggregation/&quot;&gt;Aggregation Framework&lt;/a&gt; in MongoDB 2.2+ provides an alternative to Map/Reduce.  The &lt;a href=&quot;http://docs.mongodb.org/manual/reference/aggregation/unwind/#_S_unwind&quot;&gt;&lt;code&gt;$unwind&lt;/code&gt;&lt;/a&gt; operator can be used to separate your &lt;code&gt;shapes&lt;/code&gt; array into a stream of documents that can be matched:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;db.&lt;span class=&quot;hljs-property&quot;&gt;test&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;aggregate&lt;/span&gt;(\n  &lt;span class=&quot;hljs-comment&quot;&gt;// Start with a $match pipeline which can take advantage of an index and limit documents processed&lt;/span&gt;\n  { $match : {\n     &lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.color&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;\n  }},\n  { $unwind : &lt;span class=&quot;hljs-string&quot;&gt;&quot;$shapes&quot;&lt;/span&gt; },\n  { $match : {\n     &lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.color&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;\n  }}\n)\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Results in:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;{\n    &lt;span class=&quot;hljs-string&quot;&gt;&quot;result&quot;&lt;/span&gt; : [\n        {\n            &lt;span class=&quot;hljs-string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-title class_&quot;&gt;ObjectId&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;504425059b7c9fa7ec92beec&quot;&lt;/span&gt;),\n            &lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes&quot;&lt;/span&gt; : {\n                &lt;span class=&quot;hljs-string&quot;&gt;&quot;shape&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;circle&quot;&lt;/span&gt;,\n                &lt;span class=&quot;hljs-string&quot;&gt;&quot;color&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;\n            }\n        }\n    ],\n    &lt;span class=&quot;hljs-string&quot;&gt;&quot;ok&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;blockquote&gt;\n  &lt;p&gt;&lt;strong&gt;Caution:&lt;/strong&gt; This answer provides a solution that was relevant &lt;em&gt;at that time&lt;/em&gt;, before the new features of MongoDB 2.2 and up were introduced. See the other answers if you are using a more recent version of MongoDB.&lt;/p&gt;\n&lt;/blockquote&gt;\n\n&lt;p&gt;The field selector parameter is limited to complete properties. It cannot be used to select part of an array, only the entire array. I tried using the &lt;a href=&quot;http://www.mongodb.org/display/DOCS/Updating#Updating-The%24positionaloperator&quot; rel=&quot;noreferrer&quot;&gt;$ positional operator&lt;/a&gt;, but that didn&apos;t work.&lt;/p&gt;\n\n&lt;p&gt;The easiest way is to just filter the shapes &lt;strong&gt;in the client&lt;/strong&gt;.&lt;/p&gt;\n\n&lt;p&gt;If you really &lt;em&gt;need&lt;/em&gt; the correct output directly from MongoDB, you can &lt;strong&gt;use a map-reduce&lt;/strong&gt; to filter the shapes.&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;map&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;/span&gt;) {\n  filteredShapes = [];\n\n  &lt;span class=&quot;hljs-variable language_&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;shapes&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;forEach&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; (&lt;span class=&quot;hljs-params&quot;&gt;s&lt;/span&gt;) {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (s.&lt;span class=&quot;hljs-property&quot;&gt;color&lt;/span&gt; === &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;) {\n      filteredShapes.&lt;span class=&quot;hljs-title function_&quot;&gt;push&lt;/span&gt;(s);\n    }\n  });\n\n  &lt;span class=&quot;hljs-title function_&quot;&gt;emit&lt;/span&gt;(&lt;span class=&quot;hljs-variable language_&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;_id&lt;/span&gt;, { &lt;span class=&quot;hljs-attr&quot;&gt;shapes&lt;/span&gt;: filteredShapes });\n}\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title function_&quot;&gt;reduce&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;key, values&lt;/span&gt;) {\n  &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; values[&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;];\n}\n\nres = db.&lt;span class=&quot;hljs-property&quot;&gt;test&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;mapReduce&lt;/span&gt;(map, reduce, { &lt;span class=&quot;hljs-attr&quot;&gt;query&lt;/span&gt;: { &lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.color&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt; } })\n\ndb[res.&lt;span class=&quot;hljs-property&quot;&gt;result&lt;/span&gt;].&lt;span class=&quot;hljs-title function_&quot;&gt;find&lt;/span&gt;()\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Another interesing way is to use &lt;a href=&quot;http://docs.mongodb.org/manual/reference/operator/aggregation/redact/&quot;&gt;&lt;strong&gt;$redact&lt;/strong&gt;&lt;/a&gt;, which is one of the new aggregation features of &lt;strong&gt;MongoDB 2.6&lt;/strong&gt;. If you are using 2.6, you don&apos;t need an $unwind which might cause you performance problems if you have large arrays. &lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;db.&lt;span class=&quot;hljs-property&quot;&gt;test&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;aggregate&lt;/span&gt;([\n    { &lt;span class=&quot;hljs-attr&quot;&gt;$match&lt;/span&gt;: { \n         &lt;span class=&quot;hljs-attr&quot;&gt;shapes&lt;/span&gt;: { &lt;span class=&quot;hljs-attr&quot;&gt;$elemMatch&lt;/span&gt;: {&lt;span class=&quot;hljs-attr&quot;&gt;color&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;} } \n    }},\n    { $redact : {\n         &lt;span class=&quot;hljs-attr&quot;&gt;$cond&lt;/span&gt;: {\n             &lt;span class=&quot;hljs-attr&quot;&gt;if&lt;/span&gt;: { $or : [{ &lt;span class=&quot;hljs-attr&quot;&gt;$eq&lt;/span&gt;: [&lt;span class=&quot;hljs-string&quot;&gt;&quot;$color&quot;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;] }, { $not : &lt;span class=&quot;hljs-string&quot;&gt;&quot;$color&quot;&lt;/span&gt; }]},\n             &lt;span class=&quot;hljs-attr&quot;&gt;then&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;$$DESCEND&quot;&lt;/span&gt;,\n             &lt;span class=&quot;hljs-attr&quot;&gt;else&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;$$PRUNE&quot;&lt;/span&gt;\n         }\n    }}]);\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;&lt;code&gt;$redact&lt;/code&gt; &lt;em&gt;&quot;restricts the contents of the documents based on information stored in the documents themselves&quot;&lt;/em&gt;. So it will run only &lt;em&gt;inside of the document&lt;/em&gt;. It basically scans your document top to the bottom, and checks if it matches with your &lt;code&gt;if&lt;/code&gt; condition which is in &lt;code&gt;$cond&lt;/code&gt;, if there is match it will either keep the content(&lt;code&gt;$$DESCEND&lt;/code&gt;) or remove(&lt;code&gt;$$PRUNE&lt;/code&gt;).&lt;/p&gt;\n\n&lt;p&gt;In the example  above, first &lt;code&gt;$match&lt;/code&gt; returns the whole &lt;code&gt;shapes&lt;/code&gt; array, and $redact strips it down to the expected result. &lt;/p&gt;\n\n&lt;p&gt;Note that &lt;code&gt;{$not:&quot;$color&quot;}&lt;/code&gt; is necessary, because it will scan the top document as well, and if &lt;code&gt;$redact&lt;/code&gt; does not find a &lt;code&gt;color&lt;/code&gt; field on the top level this will return &lt;code&gt;false&lt;/code&gt; that might strip the whole document which we don&apos;t want. &lt;/p&gt;\n    ","\n&lt;p&gt;Better you can query in matching array element using &lt;code&gt;$slice&lt;/code&gt; is it helpful to returning the significant object in an array.&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;db.&lt;span class=&quot;hljs-property&quot;&gt;test&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;find&lt;/span&gt;({&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.color&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;blue&quot;&lt;/span&gt;}, {&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.$&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;})\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;&lt;code&gt;$slice&lt;/code&gt; is helpful when you know the index of the element, but sometimes you want\nwhichever array element matched your criteria. You can return the matching element\nwith the &lt;code&gt;$&lt;/code&gt; operator.&lt;/p&gt;\n    ","\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt; db.&lt;span class=&quot;hljs-title function_&quot;&gt;getCollection&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;aj&apos;&lt;/span&gt;).&lt;span class=&quot;hljs-title function_&quot;&gt;find&lt;/span&gt;({&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.color&quot;&lt;/span&gt;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;},{&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.$&quot;&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;})\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;&lt;em&gt;OUTPUTS&lt;/em&gt;&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;{\n\n   &lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes&quot;&lt;/span&gt; : [ \n       {\n           &lt;span class=&quot;hljs-string&quot;&gt;&quot;shape&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;circle&quot;&lt;/span&gt;,\n           &lt;span class=&quot;hljs-string&quot;&gt;&quot;color&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;\n       }\n   ]\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;The syntax for find in mongodb is &lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;    db.&amp;lt;collection name&amp;gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;find&lt;/span&gt;(query, projection);\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;and the second query that you have written, that is&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;    db.&lt;span class=&quot;hljs-property&quot;&gt;test&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;find&lt;/span&gt;(\n    {&lt;span class=&quot;hljs-attr&quot;&gt;shapes&lt;/span&gt;: {&lt;span class=&quot;hljs-string&quot;&gt;&quot;$elemMatch&quot;&lt;/span&gt;: {&lt;span class=&quot;hljs-attr&quot;&gt;color&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;}}}, \n    {&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.color&quot;&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;})\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;in this you have used the &lt;code&gt;$elemMatch&lt;/code&gt; operator in query part, whereas if you use this operator in the projection part then you will get the desired result. You can write down your query as &lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;     db.&lt;span class=&quot;hljs-property&quot;&gt;users&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;find&lt;/span&gt;(\n     {&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.color&quot;&lt;/span&gt;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;},\n     {&lt;span class=&quot;hljs-attr&quot;&gt;_id&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-attr&quot;&gt;shapes&lt;/span&gt;: {$elemMatch : {&lt;span class=&quot;hljs-attr&quot;&gt;color&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;}}})\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;This will give you the desired result.&lt;/p&gt;\n    ","\n&lt;h2&gt;Thanks to &lt;em&gt;&lt;a href=&quot;https://stackoverflow.com/users/1259510/johnnyhk&quot;&gt;JohnnyHK&lt;/a&gt;&lt;/em&gt;.&lt;/h2&gt;\n\n&lt;p&gt;Here I just want to add some more complex usage.&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Document &lt;/span&gt;\n{ \n&lt;span class=&quot;hljs-string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes&quot;&lt;/span&gt; : [\n  {&lt;span class=&quot;hljs-string&quot;&gt;&quot;shape&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;square&quot;&lt;/span&gt;,  &lt;span class=&quot;hljs-string&quot;&gt;&quot;color&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;},\n  {&lt;span class=&quot;hljs-string&quot;&gt;&quot;shape&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;circle&quot;&lt;/span&gt;,  &lt;span class=&quot;hljs-string&quot;&gt;&quot;color&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;green&quot;&lt;/span&gt;}\n  ] \n} \n\n{ \n&lt;span class=&quot;hljs-string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;\n&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes&quot;&lt;/span&gt; : [\n  {&lt;span class=&quot;hljs-string&quot;&gt;&quot;shape&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;square&quot;&lt;/span&gt;,  &lt;span class=&quot;hljs-string&quot;&gt;&quot;color&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;},\n  {&lt;span class=&quot;hljs-string&quot;&gt;&quot;shape&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;circle&quot;&lt;/span&gt;,  &lt;span class=&quot;hljs-string&quot;&gt;&quot;color&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;green&quot;&lt;/span&gt;}\n  ] \n} \n\n\n&lt;span class=&quot;hljs-comment&quot;&gt;// The Query   &lt;/span&gt;\ndb.&lt;span class=&quot;hljs-property&quot;&gt;contents&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;find&lt;/span&gt;({\n    &lt;span class=&quot;hljs-string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-title class_&quot;&gt;ObjectId&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;),\n    &lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.color&quot;&lt;/span&gt;:&lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;\n},{\n    &lt;span class=&quot;hljs-string&quot;&gt;&quot;_id&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,\n    &lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes&quot;&lt;/span&gt; :{\n       &lt;span class=&quot;hljs-string&quot;&gt;&quot;$elemMatch&quot;&lt;/span&gt;:{\n           &lt;span class=&quot;hljs-string&quot;&gt;&quot;color&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;\n       } \n    }\n}) \n\n\n&lt;span class=&quot;hljs-comment&quot;&gt;//And the Result&lt;/span&gt;\n\n{&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes&quot;&lt;/span&gt;:[\n    {\n       &lt;span class=&quot;hljs-string&quot;&gt;&quot;shape&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;square&quot;&lt;/span&gt;,\n       &lt;span class=&quot;hljs-string&quot;&gt;&quot;color&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;\n    }\n]}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;You just need to run query&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;db.&lt;span class=&quot;hljs-property&quot;&gt;test&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;find&lt;/span&gt;(\n{&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.color&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;}, \n{&lt;span class=&quot;hljs-attr&quot;&gt;shapes&lt;/span&gt;: {&lt;span class=&quot;hljs-attr&quot;&gt;$elemMatch&lt;/span&gt;: {&lt;span class=&quot;hljs-attr&quot;&gt;color&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;}}});\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;output of this query is&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;{\n    &lt;span class=&quot;hljs-string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-title class_&quot;&gt;ObjectId&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;562e7c594c12942f08fe4192&quot;&lt;/span&gt;),\n    &lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes&quot;&lt;/span&gt; : [ \n        {&lt;span class=&quot;hljs-string&quot;&gt;&quot;shape&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;circle&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;color&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;}\n    ]\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;as you expected it&apos;ll gives the exact field from array that matches color:&apos;red&apos;.&lt;/p&gt;\n    ","\n&lt;p&gt;Along with  &lt;code&gt;$project&lt;/code&gt; it will be more appropriate  other wise matching elements will be clubbed together with other elements in document.&lt;/p&gt;\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;db.&lt;span class=&quot;hljs-property&quot;&gt;test&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;aggregate&lt;/span&gt;(\n  { &lt;span class=&quot;hljs-string&quot;&gt;&quot;$unwind&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;$shapes&quot;&lt;/span&gt; },\n  { &lt;span class=&quot;hljs-string&quot;&gt;&quot;$match&quot;&lt;/span&gt; : { &lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.color&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt; } },\n  { \n    &lt;span class=&quot;hljs-string&quot;&gt;&quot;$project&quot;&lt;/span&gt;: {\n      &lt;span class=&quot;hljs-string&quot;&gt;&quot;_id&quot;&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,\n      &lt;span class=&quot;hljs-string&quot;&gt;&quot;item&quot;&lt;/span&gt;:&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n    }\n  }\n)\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Likewise you can find for the multiple&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;db.&lt;span class=&quot;hljs-title function_&quot;&gt;getCollection&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;localData&apos;&lt;/span&gt;).&lt;span class=&quot;hljs-title function_&quot;&gt;aggregate&lt;/span&gt;([\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Get just the docs that contain a shapes element where color is &apos;red&apos;&lt;/span&gt;\n  {&lt;span class=&quot;hljs-attr&quot;&gt;$match&lt;/span&gt;: {&lt;span class=&quot;hljs-string&quot;&gt;&apos;shapes.color&apos;&lt;/span&gt;: {$in : [&lt;span class=&quot;hljs-string&quot;&gt;&apos;red&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&apos;yellow&apos;&lt;/span&gt;] } }},\n  {&lt;span class=&quot;hljs-attr&quot;&gt;$project&lt;/span&gt;: {\n     &lt;span class=&quot;hljs-attr&quot;&gt;shapes&lt;/span&gt;: {&lt;span class=&quot;hljs-attr&quot;&gt;$filter&lt;/span&gt;: {\n        &lt;span class=&quot;hljs-attr&quot;&gt;input&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&apos;$shapes&apos;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-attr&quot;&gt;as&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&apos;shape&apos;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-attr&quot;&gt;cond&lt;/span&gt;: {&lt;span class=&quot;hljs-attr&quot;&gt;$in&lt;/span&gt;: [&lt;span class=&quot;hljs-string&quot;&gt;&apos;$$shape.color&apos;&lt;/span&gt;, [&lt;span class=&quot;hljs-string&quot;&gt;&apos;red&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;yellow&apos;&lt;/span&gt;]]}\n     }}\n  }}\n])\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;db.&lt;span class=&quot;hljs-property&quot;&gt;test&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;find&lt;/span&gt;( {&lt;span class=&quot;hljs-string&quot;&gt;&quot;shapes.color&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-string&quot;&gt;&quot;red&quot;&lt;/span&gt;}, {&lt;span class=&quot;hljs-attr&quot;&gt;_id&lt;/span&gt;: &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;})\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Use aggregation function and &lt;code&gt;$project&lt;/code&gt; to get specific object field in document&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;db.&lt;span class=&quot;hljs-title function_&quot;&gt;getCollection&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;geolocations&apos;&lt;/span&gt;).&lt;span class=&quot;hljs-title function_&quot;&gt;aggregate&lt;/span&gt;([ { $project : { geolocation : &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;} } ])\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;&lt;strong&gt;result:&lt;/strong&gt;&lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;{\n    &lt;span class=&quot;hljs-string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-title class_&quot;&gt;ObjectId&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;5e3ee15968879c0d5942464b&quot;&lt;/span&gt;),\n    &lt;span class=&quot;hljs-string&quot;&gt;&quot;geolocation&quot;&lt;/span&gt; : [ \n        {\n            &lt;span class=&quot;hljs-string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-title class_&quot;&gt;ObjectId&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;5e3ee3ee68879c0d5942465e&quot;&lt;/span&gt;),\n            &lt;span class=&quot;hljs-string&quot;&gt;&quot;latitude&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;12.9718313&lt;/span&gt;,\n            &lt;span class=&quot;hljs-string&quot;&gt;&quot;longitude&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;77.593551&lt;/span&gt;,\n            &lt;span class=&quot;hljs-string&quot;&gt;&quot;country&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;India&quot;&lt;/span&gt;,\n            &lt;span class=&quot;hljs-string&quot;&gt;&quot;city&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;Chennai&quot;&lt;/span&gt;,\n            &lt;span class=&quot;hljs-string&quot;&gt;&quot;zipcode&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;560001&quot;&lt;/span&gt;,\n            &lt;span class=&quot;hljs-string&quot;&gt;&quot;streetName&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;Sidney Road&quot;&lt;/span&gt;,\n            &lt;span class=&quot;hljs-string&quot;&gt;&quot;countryCode&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;in&quot;&lt;/span&gt;,\n            &lt;span class=&quot;hljs-string&quot;&gt;&quot;ip&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;116.75.115.248&quot;&lt;/span&gt;,\n            &lt;span class=&quot;hljs-string&quot;&gt;&quot;date&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-title class_&quot;&gt;ISODate&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;2020-02-08T16:38:06.584Z&quot;&lt;/span&gt;)\n        }\n    ]\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Although the question was asked 9.6 years ago, this has been of immense help to numerous people, me being one of them. Thank you everyone for all your queries, hints and answers. Picking up from one of the answers here.. I found that the following method can also be used to project other fields in the parent document.This may be helpful to someone. &lt;/p&gt;\n\n&lt;p&gt;For the following document, the need was to find out if an employee (emp #7839) has his leave history set for the year 2020. Leave history is implemented as an embedded document within the parent Employee document. &lt;/p&gt;\n\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;db.&lt;span class=&quot;hljs-property&quot;&gt;employees&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;find&lt;/span&gt;( {&lt;span class=&quot;hljs-string&quot;&gt;&quot;leave_history.calendar_year&quot;&lt;/span&gt;: &lt;span class=&quot;hljs-number&quot;&gt;2020&lt;/span&gt;}, \n    {&lt;span class=&quot;hljs-attr&quot;&gt;leave_history&lt;/span&gt;: {&lt;span class=&quot;hljs-attr&quot;&gt;$elemMatch&lt;/span&gt;: {&lt;span class=&quot;hljs-attr&quot;&gt;calendar_year&lt;/span&gt;: &lt;span class=&quot;hljs-number&quot;&gt;2020&lt;/span&gt;}},&lt;span class=&quot;hljs-attr&quot;&gt;empno&lt;/span&gt;:&lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;hljs-attr&quot;&gt;ename&lt;/span&gt;:&lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;}).&lt;span class=&quot;hljs-title function_&quot;&gt;pretty&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;/span&gt;)\n\n\n{\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-title class_&quot;&gt;ObjectId&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;5e907ad23997181dde06e8fc&quot;&lt;/span&gt;),\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;empno&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;7839&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;ename&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;KING&quot;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;mgrno&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;hiredate&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;1990-05-09&quot;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;sal&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;100000&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;deptno&quot;&lt;/span&gt; : {\n                &lt;span class=&quot;hljs-string&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-title class_&quot;&gt;ObjectId&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;5e9065f53997181dde06e8f8&quot;&lt;/span&gt;)\n        },\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;username&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;none&quot;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;password&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;none&quot;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;is_admin&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;N&quot;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;is_approver&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;Y&quot;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;is_manager&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;Y&quot;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;user_role&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;AP&quot;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;admin_approval_received&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;Y&quot;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;active&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;Y&quot;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;created_date&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;2020-04-10&quot;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;updated_date&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;2020-04-10&quot;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;application_usage_log&quot;&lt;/span&gt; : [\n                {\n                        &lt;span class=&quot;hljs-string&quot;&gt;&quot;logged_in_as&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;AP&quot;&lt;/span&gt;,\n                        &lt;span class=&quot;hljs-string&quot;&gt;&quot;log_in_date&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;2020-04-10&quot;&lt;/span&gt;\n                },\n                {\n                        &lt;span class=&quot;hljs-string&quot;&gt;&quot;logged_in_as&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-string&quot;&gt;&quot;EM&quot;&lt;/span&gt;,\n                        &lt;span class=&quot;hljs-string&quot;&gt;&quot;log_in_date&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-title class_&quot;&gt;ISODate&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;2020-04-16T07:28:11.959Z&quot;&lt;/span&gt;)\n                }\n        ],\n        &lt;span class=&quot;hljs-string&quot;&gt;&quot;leave_history&quot;&lt;/span&gt; : [\n                {\n                        &lt;span class=&quot;hljs-string&quot;&gt;&quot;calendar_year&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;2020&lt;/span&gt;,\n                        &lt;span class=&quot;hljs-string&quot;&gt;&quot;pl_used&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,\n                        &lt;span class=&quot;hljs-string&quot;&gt;&quot;cl_used&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,\n                        &lt;span class=&quot;hljs-string&quot;&gt;&quot;sl_used&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n                },\n                {\n                        &lt;span class=&quot;hljs-string&quot;&gt;&quot;calendar_year&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;2021&lt;/span&gt;,\n                        &lt;span class=&quot;hljs-string&quot;&gt;&quot;pl_used&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,\n                        &lt;span class=&quot;hljs-string&quot;&gt;&quot;cl_used&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;,\n                        &lt;span class=&quot;hljs-string&quot;&gt;&quot;sl_used&quot;&lt;/span&gt; : &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n                }\n        ]\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;if you want to do &lt;strong&gt;filter, set and find&lt;/strong&gt; at the same time.&lt;/p&gt;\n&lt;pre class=&quot;lang-js s-code-block&quot;&gt;&lt;code class=&quot;hljs language-javascript&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;let&lt;/span&gt; post = &lt;span class=&quot;hljs-keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;Post&lt;/span&gt;.&lt;span class=&quot;hljs-title function_&quot;&gt;findOneAndUpdate&lt;/span&gt;(\n          {\n            &lt;span class=&quot;hljs-attr&quot;&gt;_id&lt;/span&gt;: req.&lt;span class=&quot;hljs-property&quot;&gt;params&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;id&lt;/span&gt;,\n            &lt;span class=&quot;hljs-attr&quot;&gt;tasks&lt;/span&gt;: {\n              &lt;span class=&quot;hljs-attr&quot;&gt;$elemMatch&lt;/span&gt;: {\n                &lt;span class=&quot;hljs-attr&quot;&gt;id&lt;/span&gt;: req.&lt;span class=&quot;hljs-property&quot;&gt;params&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;jobId&lt;/span&gt;,\n                date,\n              },\n            },\n          },\n          {\n            &lt;span class=&quot;hljs-attr&quot;&gt;$set&lt;/span&gt;: {\n              &lt;span class=&quot;hljs-string&quot;&gt;&apos;jobs.$[i].performer&apos;&lt;/span&gt;: performer,\n              &lt;span class=&quot;hljs-string&quot;&gt;&apos;jobs.$[i].status&apos;&lt;/span&gt;: status,\n              &lt;span class=&quot;hljs-string&quot;&gt;&apos;jobs.$[i].type&apos;&lt;/span&gt;: type,\n            },\n          },\n          {\n            &lt;span class=&quot;hljs-attr&quot;&gt;arrayFilters&lt;/span&gt;: [\n              {\n                &lt;span class=&quot;hljs-string&quot;&gt;&apos;i.id&apos;&lt;/span&gt;: req.&lt;span class=&quot;hljs-property&quot;&gt;params&lt;/span&gt;.&lt;span class=&quot;hljs-property&quot;&gt;jobId&lt;/span&gt;,\n              },\n            ],\n            &lt;span class=&quot;hljs-attr&quot;&gt;new&lt;/span&gt;: &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;,\n          }\n        );\n&lt;/code&gt;&lt;/pre&gt;\n    "]},"randomTags":[{"name":"thread-safety","slug":"thread-safety"},{"name":"variable-variables","slug":"variable-variables"},{"name":"python-internals","slug":"python-internals"},{"name":"awk","slug":"awk"},{"name":"pandas-explode","slug":"pandas-explode"},{"name":"password-hash","slug":"password-hash"},{"name":"sql-function","slug":"sql-function"},{"name":"selenium","slug":"selenium"},{"name":"random","slug":"random"},{"name":"matlab","slug":"matlab"},{"name":"unicode","slug":"unicode"},{"name":"soft-keyboard","slug":"soft-keyboard"},{"name":"compiler-optimization","slug":"compiler-optimization"},{"name":"binary","slug":"binary"},{"name":"copy-elision","slug":"copy-elision"},{"name":"pygame","slug":"pygame"},{"name":"memory-management","slug":"memory-management"},{"name":"object","slug":"object"},{"name":"xml","slug":"xml"},{"name":"command-line","slug":"command-line"}]},"__N_SSG":true}