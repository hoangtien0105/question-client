<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find solution for coding, HTML, CSS, JAVASCRIPT, MYSQL, PHP, PYTHON,... quickly. - solutionschecker.com"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><title>Simulating group_concat MySQL function in Microsoft SQL Server 2005? | Solutions Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="I&#x27;m trying to migrate a MySQL-based app over to Microsoft SQL Server 2005 (not by choice, but that&#x27;s life).

In the original app, we used almost entirely ANSI-SQL compliant statements, with one significant exception -- we used MySQL&#x27;s group_concat function fairly frequently.

group_concat, by the way, does this: given a table of, say, employee names and projects...

SELECT empName, projID FROM project_members;


returns:

ANDY   |  A100
ANDY   |  B391
ANDY   |  X010
TOM    |  A100
TOM    |  A510


... and here&#x27;s what you get with group_concat:

SELECT 
    empName, group_concat(projID SEPARATOR &#x27; / &#x27;) 
FROM 
    project_members 
GROUP BY 
    empName;


returns:

ANDY   |  A100 / B391 / X010
TOM    |  A100 / A510


So what I&#x27;d like to know is: Is it possible to write, say, a user-defined function in SQL Server which emulates the functionality of group_concat? 

I have almost no experience using UDFs, stored procedures, or anything like that, just straight-up SQL, so please err on the side of too much explanation :)
    "/><meta property="og:title" content="Simulating group_concat MySQL function in Microsoft SQL Server 2005? | Solutions Checker"/><meta property="og:description" content="I&#x27;m trying to migrate a MySQL-based app over to Microsoft SQL Server 2005 (not by choice, but that&#x27;s life).

In the original app, we used almost entirely ANSI-SQL compliant statements, with one significant exception -- we used MySQL&#x27;s group_concat function fairly frequently.

group_concat, by the way, does this: given a table of, say, employee names and projects...

SELECT empName, projID FROM project_members;


returns:

ANDY   |  A100
ANDY   |  B391
ANDY   |  X010
TOM    |  A100
TOM    |  A510


... and here&#x27;s what you get with group_concat:

SELECT 
    empName, group_concat(projID SEPARATOR &#x27; / &#x27;) 
FROM 
    project_members 
GROUP BY 
    empName;


returns:

ANDY   |  A100 / B391 / X010
TOM    |  A100 / A510


So what I&#x27;d like to know is: Is it possible to write, say, a user-defined function in SQL Server which emulates the functionality of group_concat? 

I have almost no experience using UDFs, stored procedures, or anything like that, just straight-up SQL, so please err on the side of too much explanation :)
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"Simulating group_concat MySQL function in Microsoft SQL Server 2005?","text":"I&apos;m trying to migrate a MySQL-based app over to Microsoft SQL Server 2005 (not by choice, but that&apos;s life).\n\nIn the original app, we used almost entirely ANSI-SQL compliant statements, with one significant exception -- we used MySQL&apos;s group_concat function fairly frequently.\n\ngroup_concat, by the way, does this: given a table of, say, employee names and projects...\n\nSELECT empName, projID FROM project_members;\n\n\nreturns:\n\nANDY   |  A100\nANDY   |  B391\nANDY   |  X010\nTOM    |  A100\nTOM    |  A510\n\n\n... and here&apos;s what you get with group_concat:\n\nSELECT \n    empName, group_concat(projID SEPARATOR &apos; / &apos;) \nFROM \n    project_members \nGROUP BY \n    empName;\n\n\nreturns:\n\nANDY   |  A100 / B391 / X010\nTOM    |  A100 / A510\n\n\nSo what I&apos;d like to know is: Is it possible to write, say, a user-defined function in SQL Server which emulates the functionality of group_concat? \n\nI have almost no experience using UDFs, stored procedures, or anything like that, just straight-up SQL, so please err on the side of too much explanation :)\n    ","answerCount":13,"upVoteCount":500,"suggestedAnswer":[{"text":"No REAL easy way to do this. Lots of ideas out there, though.\n\nBest one I&apos;ve found:\n\nSELECT table_name, LEFT(column_names , LEN(column_names )-1) AS column_names\nFROM information_schema.columns AS extern\nCROSS APPLY\n(\n    SELECT column_name + &apos;,&apos;\n    FROM information_schema.columns AS intern\n    WHERE extern.table_name = intern.table_name\n    FOR XML PATH(&apos;&apos;)\n) pre_trimmed (column_names)\nGROUP BY table_name, column_names;\n\n\nOr a version that works correctly if the data might contain characters such as &lt;\n\nWITH extern\n     AS (SELECT DISTINCT table_name\n         FROM   INFORMATION_SCHEMA.COLUMNS)\nSELECT table_name,\n       LEFT(y.column_names, LEN(y.column_names) - 1) AS column_names\nFROM   extern\n       CROSS APPLY (SELECT column_name + &apos;,&apos;\n                    FROM   INFORMATION_SCHEMA.COLUMNS AS intern\n                    WHERE  extern.table_name = intern.table_name\n                    FOR XML PATH(&apos;&apos;), TYPE) x (column_names)\n       CROSS APPLY (SELECT x.column_names.value(&apos;.&apos;, &apos;NVARCHAR(MAX)&apos;)) y(column_names) \n\n    ","url":"/questions/[slug]#solution1","@type":"Answer","upvoteCount":0},{"text":"I may be a bit late to the party but this method works for me and is easier than the COALESCE method.\n\nSELECT STUFF(\n             (SELECT &apos;,&apos; + Column_Name \n              FROM Table_Name\n              FOR XML PATH (&apos;&apos;))\n             , 1, 1, &apos;&apos;)\n\n    ","url":"/questions/[slug]#solution2","@type":"Answer","upvoteCount":0},{"text":"SQL Server 2017 does introduce a new aggregate function\n\nSTRING_AGG ( expression, separator).\n\n\n  Concatenates the values of string expressions and places separator\n  values between them. The separator is not added at the end of string.\n\n\nThe concatenated elements can be ordered by appending WITHIN GROUP (ORDER BY some_expression)\n\nFor versions 2005-2016 I typically use the XML method in the accepted answer.\n\nThis can fail in some circumstances however. e.g. if the data to be concatenated contains CHAR(29) you see\n\n\n  FOR XML could not serialize the data ... because it\n  contains a character (0x001D) which is not allowed in XML.\n\n\nA more robust method that can deal with all characters would be to use a CLR aggregate. However applying an ordering to the concatenated elements is more difficult with this approach.\n\nThe method of assigning to a variable is not guaranteed and should be avoided in production code.\n    ","url":"/questions/[slug]#solution3","@type":"Answer","upvoteCount":0},{"text":"Possibly too late to be of benefit now, but is this not the easiest way to do things?\n\nSELECT     empName, projIDs = replace\n                          ((SELECT Surname AS [data()]\n                              FROM project_members\n                              WHERE  empName = a.empName\n                              ORDER BY empName FOR xml path(&apos;&apos;)), &apos; &apos;, REQUIRED SEPERATOR)\nFROM         project_members a\nWHERE     empName IS NOT NULL\nGROUP BY empName\n\n    ","url":"/questions/[slug]#solution4","@type":"Answer","upvoteCount":0},{"text":"Have a look at the GROUP_CONCAT project on Github, I think I does exactly what you are searching for:\n\n\n  This project contains a set of SQLCLR User-defined Aggregate functions (SQLCLR UDAs) that collectively offer similar functionality to the MySQL GROUP_CONCAT function. There are multiple functions to ensure the best performance based on the functionality required...\n\n    ","url":"/questions/[slug]#solution5","@type":"Answer","upvoteCount":0},{"text":"To concatenate all the project manager names from projects that have multiple project managers write:\n\nSELECT a.project_id,a.project_name,Stuff((SELECT N&apos;/ &apos; + first_name + &apos;, &apos;+last_name FROM projects_v \nwhere a.project_id=project_id\n FOR\n XML PATH(&apos;&apos;),TYPE).value(&apos;text()[1]&apos;,&apos;nvarchar(max)&apos;),1,2,N&apos;&apos;\n) mgr_names\nfrom projects_v a\ngroup by a.project_id,a.project_name\n\n    ","url":"/questions/[slug]#solution6","@type":"Answer","upvoteCount":0},{"text":"With the below code you have to set PermissionLevel=External on your project properties before you deploy, and change the database to trust external code (be sure to read elsewhere about security risks and alternatives [like certificates]) by running &quot;ALTER DATABASE database_name SET TRUSTWORTHY ON&quot;.\n\nusing System;\nusing System.Collections.Generic;\nusing System.Data.SqlTypes;\nusing System.IO;\nusing System.Runtime.Serialization;\nusing System.Runtime.Serialization.Formatters.Binary;\nusing Microsoft.SqlServer.Server;\n\n[Serializable]\n[SqlUserDefinedAggregate(Format.UserDefined,\nMaxByteSize=8000,\nIsInvariantToDuplicates=true,\nIsInvariantToNulls=true,\nIsInvariantToOrder=true,\nIsNullIfEmpty=true)]\n    public struct CommaDelimit : IBinarySerialize\n{\n\n\n[Serializable]\n private class StringList : List&lt;string&gt;\n { }\n\n private StringList List;\n\n public void Init()\n {\n  this.List = new StringList();\n }\n\n public void Accumulate(SqlString value)\n {\n  if (!value.IsNull)\n   this.Add(value.Value);\n }\n\n private void Add(string value)\n {\n  if (!this.List.Contains(value))\n   this.List.Add(value);\n }\n\n public void Merge(CommaDelimit group)\n {\n  foreach (string s in group.List)\n  {\n   this.Add(s);\n  }\n }\n\n void IBinarySerialize.Read(BinaryReader reader)\n {\n    IFormatter formatter = new BinaryFormatter();\n    this.List = (StringList)formatter.Deserialize(reader.BaseStream);\n }\n\n public SqlString Terminate()\n {\n  if (this.List.Count == 0)\n   return SqlString.Null;\n\n  const string Separator = &quot;, &quot;;\n\n  this.List.Sort();\n\n  return new SqlString(String.Join(Separator, this.List.ToArray()));\n }\n\n void IBinarySerialize.Write(BinaryWriter writer)\n {\n  IFormatter formatter = new BinaryFormatter();\n  formatter.Serialize(writer.BaseStream, this.List);\n }\n    }\n\n\nI&apos;ve tested this using a query that looks like:\n\nSELECT \n dbo.CommaDelimit(X.value) [delimited] \nFROM \n (\n  SELECT &apos;D&apos; [value] \n  UNION ALL SELECT &apos;B&apos; [value] \n  UNION ALL SELECT &apos;B&apos; [value] -- intentional duplicate\n  UNION ALL SELECT &apos;A&apos; [value] \n  UNION ALL SELECT &apos;C&apos; [value] \n ) X \n\n\nAnd yields: A, B, C, D\n    ","url":"/questions/[slug]#solution7","@type":"Answer","upvoteCount":0},{"text":"Tried these but for my purposes in MS SQL Server 2005 the following was most useful, which I found at xaprb\n\ndeclare @result varchar(8000);\n\nset @result = &apos;&apos;;\n\nselect @result = @result + name + &apos; &apos;\n\nfrom master.dbo.systypes;\n\nselect rtrim(@result);\n\n\n@Mark as you mentioned it was the space character that caused issues for me.\n    ","url":"/questions/[slug]#solution8","@type":"Answer","upvoteCount":0},{"text":"About J Hardiman&apos;s answer, how about:\n\nSELECT empName, projIDs=\n  REPLACE(\n    REPLACE(\n      (SELECT REPLACE(projID, &apos; &apos;, &apos;-somebody-puts-microsoft-out-of-his-misery-please-&apos;) AS [data()] FROM project_members WHERE empName=a.empName FOR XML PATH(&apos;&apos;)), \n      &apos; &apos;, \n      &apos; / &apos;), \n    &apos;-somebody-puts-microsoft-out-of-his-misery-please-&apos;,\n    &apos; &apos;) \n  FROM project_members a WHERE empName IS NOT NULL GROUP BY empName\n\n\nBy the way, is the use of &quot;Surname&quot; a typo or am i not understanding a concept here?\n\nAnyway, thanks a lot guys cuz it saved me quite some time :)\n    ","url":"/questions/[slug]#solution9","@type":"Answer","upvoteCount":0},{"text":"2021\n@AbdusSalamAzad&apos;s answer is the correct one.\nSELECT STRING_AGG(my_col, &apos;,&apos;) AS my_result FROM my_tbl;\n\nIf the result is too big, you may get error &quot;STRING_AGG aggregation result exceeded the limit of 8000 bytes. Use LOB types to avoid result truncation.&quot; , which can be fixed by changing the query to this:\nSELECT STRING_AGG(convert(varchar(max), my_col), &apos;,&apos;) AS my_result FROM my_tbl;\n\n    ","url":"/questions/[slug]#solution10","@type":"Answer","upvoteCount":0},{"text":"UPDATE 2020: SQL Server 2016+ JSON Serialization and De-serialization Examples\nThe data provided by the OP inserted into a temporary table called #project_members\ndrop table if exists #project_members;\ncreate table #project_members(\n  empName        varchar(20) not null,\n  projID         varchar(20) not null);\ngo\ninsert #project_members(empName, projID) values\n(&apos;ANDY&apos;, &apos;A100&apos;),\n(&apos;ANDY&apos;, &apos;B391&apos;),\n(&apos;ANDY&apos;, &apos;X010&apos;),\n(&apos;TOM&apos;, &apos;A100&apos;),\n(&apos;TOM&apos;, &apos;A510&apos;);\n\nHow to serialize this data into a single JSON string with a nested array containing projID&apos;s\nselect empName, (select pm_json.projID \n                 from #project_members pm_json \n                 where pm.empName=pm_json.empName \n                 for json path, root(&apos;projList&apos;)) projJSON\nfrom #project_members pm\ngroup by empName\nfor json path;\n\nResult\n&apos;[\n  {\n    &quot;empName&quot;: &quot;ANDY&quot;,\n    &quot;projJSON&quot;: {\n      &quot;projList&quot;: [\n        { &quot;projID&quot;: &quot;A100&quot; },\n        { &quot;projID&quot;: &quot;B391&quot; },\n        { &quot;projID&quot;: &quot;X010&quot; }\n      ]\n    }\n  },\n  {\n    &quot;empName&quot;: &quot;TOM&quot;,\n    &quot;projJSON&quot;: {\n      &quot;projList&quot;: [\n        { &quot;projID&quot;: &quot;A100&quot; },\n        { &quot;projID&quot;: &quot;A510&quot; }\n      ]\n    }\n  }\n]&apos;\n\nHow to de-serialize this data from a single JSON string back to it&apos;s original rows and columns\ndeclare @json           nvarchar(max)=N&apos;[{&quot;empName&quot;:&quot;ANDY&quot;,&quot;projJSON&quot;:{&quot;projList&quot;:[{&quot;projID&quot;:&quot;A100&quot;},\n                                         {&quot;projID&quot;:&quot;B391&quot;},{&quot;projID&quot;:&quot;X010&quot;}]}},{&quot;empName&quot;:&quot;TOM&quot;,&quot;projJSON&quot;:\n                                         {&quot;projList&quot;:[{&quot;projID&quot;:&quot;A100&quot;},{&quot;projID&quot;:&quot;A510&quot;}]}}]&apos;;\n\nselect oj.empName, noj.projID \nfrom openjson(@json) with (empName        varchar(20),\n                           projJSON       nvarchar(max) as json) oj\n     cross apply openjson(oj.projJSON, &apos;$.projList&apos;) with (projID    varchar(20)) noj;\n\nResults\nempName projID\nANDY    A100\nANDY    B391\nANDY    X010\nTOM     A100\nTOM     A510\n\nHow to persist the unique empName to a table and store the projID&apos;s in a nested JSON array\ndrop table if exists #project_members_with_json;\ncreate table #project_members_with_json(\n  empName        varchar(20) unique not null,\n  projJSON       nvarchar(max) not null);\ngo\ninsert #project_members_with_json(empName, projJSON) \nselect empName, (select pm_json.projID \n                 from #project_members pm_json \n                 where pm.empName=pm_json.empName \n                 for json path, root(&apos;projList&apos;)) \nfrom #project_members pm\ngroup by empName;\n\nResults\nempName projJSON\nANDY    {&quot;projList&quot;:[{&quot;projID&quot;:&quot;A100&quot;},{&quot;projID&quot;:&quot;B391&quot;},{&quot;projID&quot;:&quot;X010&quot;}]}\nTOM     {&quot;projList&quot;:[{&quot;projID&quot;:&quot;A100&quot;},{&quot;projID&quot;:&quot;A510&quot;}]}\n\nHow to de-serialize from a table with unique empName and nested JSON array column containing projID&apos;s\nselect wj.empName, oj.projID\nfrom\n  #project_members_with_json wj\n cross apply\n  openjson(wj.projJSON, &apos;$.projList&apos;) with (projID    varchar(20)) oj;\n\nResults\nempName projID\nANDY    A100\nANDY    B391\nANDY    X010\nTOM     A100\nTOM     A510\n\n    ","url":"/questions/[slug]#solution11","@type":"Answer","upvoteCount":0},{"text":"For SQL Server 2017+, use  STRING_AGG() function\n    SELECT STRING_AGG(Genre, &apos;,&apos;) AS Result\n    FROM Genres;\n\nSample result:\nResult\nRock,Jazz,Country,Pop,Blues,Hip Hop,Rap,Punk\n    ","url":"/questions/[slug]#solution12","@type":"Answer","upvoteCount":0},{"text":"For my fellow Googlers out there, here&apos;s a very simple plug-and-play solution that worked for me after struggling with the more complex solutions for a while:\n\nSELECT\ndistinct empName,\nNewColumnName=STUFF((SELECT &apos;,&apos;+ CONVERT(VARCHAR(10), projID ) \n                     FROM returns \n                     WHERE empName=t.empName FOR XML PATH(&apos;&apos;)) , 1 , 1 , &apos;&apos; )\nFROM \nreturns t\n\n\nNotice that I had to convert the ID into a VARCHAR in order to concatenate it as a string. If you don&apos;t have to do that, here&apos;s an even simpler version:\n\nSELECT\ndistinct empName,\nNewColumnName=STUFF((SELECT &apos;,&apos;+ projID\n                     FROM returns \n                     WHERE empName=t.empName FOR XML PATH(&apos;&apos;)) , 1 , 1 , &apos;&apos; )\nFROM \nreturns t\n\n\nAll credit for this goes to here:\nhttps://social.msdn.microsoft.com/Forums/sqlserver/en-US/9508abc2-46e7-4186-b57f-7f368374e084/replicating-groupconcat-function-of-mysql-in-sql-server?forum=transactsql\n    ","url":"/questions/[slug]#solution13","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/08bcc42a26fe5c92.css" as="style"/><link rel="stylesheet" href="/_next/static/css/08bcc42a26fe5c92.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-ccfab947c79712f4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-08d1a634dea6705e.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/150-b06815e21c943e0d.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/108-87de33c23337ff53.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-79a1437acf654019.js" defer=""></script><script src="/_next/static/TQ2eYlCSdocSK-hq6gkM0/_buildManifest.js" defer=""></script><script src="/_next/static/TQ2eYlCSdocSK-hq6gkM0/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h4 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h4></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/simulating-group_concat-mysql-function-in-microsoft-sql-server-2005-1657384832169#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/simulating-group_concat-mysql-function-in-microsoft-sql-server-2005-1657384832169"><h1>Simulating group_concat MySQL function in Microsoft SQL Server 2005?</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/string-aggregation">string-aggregation</a></div></div><div class="question-content mt-5">
                
<p>I'm trying to migrate a MySQL-based app over to Microsoft SQL Server 2005 (not by choice, but that's life).</p>

<p>In the original app, we used <em>almost</em> entirely ANSI-SQL compliant statements, with one significant exception -- we used MySQL's <code>group_concat</code> function fairly frequently.</p>

<p><code>group_concat</code>, by the way, does this: given a table of, say, employee names and projects...</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> empName, projID <span class="hljs-keyword">FROM</span> project_members;
</code></pre>

<p>returns:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">ANDY   <span class="hljs-operator">|</span>  A100
ANDY   <span class="hljs-operator">|</span>  B391
ANDY   <span class="hljs-operator">|</span>  X010
TOM    <span class="hljs-operator">|</span>  A100
TOM    <span class="hljs-operator">|</span>  A510
</code></pre>

<p>... and here's what you get with group_concat:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> 
    empName, group_concat(projID SEPARATOR <span class="hljs-string">' / '</span>) 
<span class="hljs-keyword">FROM</span> 
    project_members 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    empName;
</code></pre>

<p>returns:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">ANDY   <span class="hljs-operator">|</span>  A100 <span class="hljs-operator">/</span> B391 <span class="hljs-operator">/</span> X010
TOM    <span class="hljs-operator">|</span>  A100 <span class="hljs-operator">/</span> A510
</code></pre>

<p>So what I'd like to know is: Is it possible to write, say, a user-defined function in SQL Server which emulates the functionality of <code>group_concat</code>? </p>

<p>I have almost no experience using UDFs, stored procedures, or anything like that, just straight-up SQL, so please err on the side of too much explanation :)</p>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li><li class="pagination-solution-item"><span data-id="#solution3" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">3</span></li><li class="pagination-solution-item"><span data-id="#solution4" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">4</span></li><li class="pagination-solution-item"><span data-id="#solution5" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">5</span></li><li class="pagination-solution-item"><span data-id="#solution6" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">6</span></li><li class="pagination-solution-item"><span data-id="#solution7" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">7</span></li><li class="pagination-solution-item"><span data-id="#solution8" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">8</span></li><li class="pagination-solution-item"><span data-id="#solution9" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">9</span></li><li class="pagination-solution-item"><span data-id="#solution10" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">10</span></li><li class="pagination-solution-item"><span data-id="#solution11" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">11</span></li><li class="pagination-solution-item"><span data-id="#solution12" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">12</span></li><li class="pagination-solution-item"><span data-id="#solution13" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">13</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/string-aggregation">string-aggregation</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>No REAL easy way to do this. Lots of ideas out there, though.</p>

<p><a href="http://blog.shlomoid.com/2008/11/emulating-mysqls-groupconcat-function.html" rel="noreferrer">Best one I've found</a>:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> table_name, <span class="hljs-keyword">LEFT</span>(column_names , LEN(column_names )<span class="hljs-number">-1</span>) <span class="hljs-keyword">AS</span> column_names
<span class="hljs-keyword">FROM</span> information_schema.columns <span class="hljs-keyword">AS</span> extern
<span class="hljs-keyword">CROSS</span> APPLY
(
    <span class="hljs-keyword">SELECT</span> column_name <span class="hljs-operator">+</span> <span class="hljs-string">','</span>
    <span class="hljs-keyword">FROM</span> information_schema.columns <span class="hljs-keyword">AS</span> intern
    <span class="hljs-keyword">WHERE</span> extern.table_name <span class="hljs-operator">=</span> intern.table_name
    <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>)
) pre_trimmed (column_names)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> table_name, column_names;
</code></pre>

<p>Or a version that works correctly if the data might contain characters such as <code>&lt;</code></p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">WITH</span> extern
     <span class="hljs-keyword">AS</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> table_name
         <span class="hljs-keyword">FROM</span>   INFORMATION_SCHEMA.COLUMNS)
<span class="hljs-keyword">SELECT</span> table_name,
       <span class="hljs-keyword">LEFT</span>(y.column_names, LEN(y.column_names) <span class="hljs-operator">-</span> <span class="hljs-number">1</span>) <span class="hljs-keyword">AS</span> column_names
<span class="hljs-keyword">FROM</span>   extern
       <span class="hljs-keyword">CROSS</span> APPLY (<span class="hljs-keyword">SELECT</span> column_name <span class="hljs-operator">+</span> <span class="hljs-string">','</span>
                    <span class="hljs-keyword">FROM</span>   INFORMATION_SCHEMA.COLUMNS <span class="hljs-keyword">AS</span> intern
                    <span class="hljs-keyword">WHERE</span>  extern.table_name <span class="hljs-operator">=</span> intern.table_name
                    <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>), TYPE) x (column_names)
       <span class="hljs-keyword">CROSS</span> APPLY (<span class="hljs-keyword">SELECT</span> x.column_names.value(<span class="hljs-string">'.'</span>, <span class="hljs-string">'NVARCHAR(MAX)'</span>)) y(column_names) 
</code></pre>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/string-aggregation">string-aggregation</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I may be a bit late to the party but this method works for me and is easier than the COALESCE method.</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> STUFF(
             (<span class="hljs-keyword">SELECT</span> <span class="hljs-string">','</span> <span class="hljs-operator">+</span> Column_Name 
              <span class="hljs-keyword">FROM</span> Table_Name
              <span class="hljs-keyword">FOR</span> XML PATH (<span class="hljs-string">''</span>))
             , <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">''</span>)
</code></pre>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/string-aggregation">string-aggregation</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><strong>SQL Server 2017</strong> does introduce a new aggregate function</p>

<p><a href="https://msdn.microsoft.com/en-us/library/mt790580.aspx" rel="noreferrer"><code>STRING_AGG ( expression, separator)</code></a>.</p>

<blockquote>
  <p>Concatenates the values of string expressions and places separator
  values between them. The separator is not added at the end of string.</p>
</blockquote>

<p>The concatenated elements can be ordered by appending <code>WITHIN GROUP (ORDER BY some_expression)</code></p>

<p><strong>For versions 2005-2016</strong> I typically use the XML method in the accepted answer.</p>

<p>This can fail in some circumstances however. e.g. if the data to be concatenated contains <code>CHAR(29)</code> you see</p>

<blockquote>
  <p>FOR XML could not serialize the data ... because it
  contains a character (0x001D) which is not allowed in XML.</p>
</blockquote>

<p>A more robust method that can deal with all characters would be to use a CLR aggregate. However applying an ordering to the concatenated elements is more difficult with this approach.</p>

<p>The method of assigning to a variable is <a href="https://stackoverflow.com/questions/15138593/nvarchar-concatenation-index-nvarcharmax-inexplicable-behavior/15163136#15163136">not guaranteed</a> and should be avoided in production code.</p>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/string-aggregation">string-aggregation</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Possibly too late to be of benefit now, but is this not the easiest way to do things?</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span>     empName, projIDs <span class="hljs-operator">=</span> replace
                          ((<span class="hljs-keyword">SELECT</span> Surname <span class="hljs-keyword">AS</span> [data()]
                              <span class="hljs-keyword">FROM</span> project_members
                              <span class="hljs-keyword">WHERE</span>  empName <span class="hljs-operator">=</span> a.empName
                              <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> empName <span class="hljs-keyword">FOR</span> xml path(<span class="hljs-string">''</span>)), <span class="hljs-string">' '</span>, REQUIRED SEPERATOR)
<span class="hljs-keyword">FROM</span>         project_members a
<span class="hljs-keyword">WHERE</span>     empName <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> empName
</code></pre>
    </div></div></div></div><div id="solution5" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/string-aggregation">string-aggregation</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Have a look at the <a href="https://github.com/orlando-colamatteo/ms-sql-server-group-concat-sqlclr" rel="noreferrer">GROUP_CONCAT</a> project on Github, I think I does exactly what you are searching for:</p>

<blockquote>
  <p>This project contains a set of SQLCLR User-defined Aggregate functions (SQLCLR UDAs) that collectively offer similar functionality to the MySQL GROUP_CONCAT function. There are multiple functions to ensure the best performance based on the functionality required...</p>
</blockquote>
    </div></div></div></div><div id="solution6" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/string-aggregation">string-aggregation</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>To concatenate all the project manager names from projects that have multiple project managers write:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> a.project_id,a.project_name,Stuff((<span class="hljs-keyword">SELECT</span> N<span class="hljs-string">'/ '</span> <span class="hljs-operator">+</span> first_name <span class="hljs-operator">+</span> <span class="hljs-string">', '</span><span class="hljs-operator">+</span>last_name <span class="hljs-keyword">FROM</span> projects_v 
<span class="hljs-keyword">where</span> a.project_id<span class="hljs-operator">=</span>project_id
 <span class="hljs-keyword">FOR</span>
 XML PATH(<span class="hljs-string">''</span>),TYPE).<span class="hljs-keyword">value</span>(<span class="hljs-string">'text()[1]'</span>,<span class="hljs-string">'nvarchar(max)'</span>),<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,N<span class="hljs-string">''</span>
) mgr_names
<span class="hljs-keyword">from</span> projects_v a
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a.project_id,a.project_name
</code></pre>
    </div></div></div></div><div id="solution7" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 7</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/string-aggregation">string-aggregation</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>With the below code you have to set PermissionLevel=External on your project properties before you deploy, and change the database to trust external code (be sure to read elsewhere about security risks and alternatives [like certificates]) by running "ALTER DATABASE database_name SET TRUSTWORTHY ON".</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">using</span> <span class="hljs-keyword">System</span>;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> System.Data.SqlTypes;
<span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> System.Runtime.Serialization;
<span class="hljs-keyword">using</span> System.Runtime.Serialization.Formatters.Binary;
<span class="hljs-keyword">using</span> Microsoft.SqlServer.Server;

[Serializable]
[SqlUserDefinedAggregate(Format.UserDefined,
MaxByteSize<span class="hljs-operator">=</span><span class="hljs-number">8000</span>,
IsInvariantToDuplicates<span class="hljs-operator">=</span><span class="hljs-literal">true</span>,
IsInvariantToNulls<span class="hljs-operator">=</span><span class="hljs-literal">true</span>,
IsInvariantToOrder<span class="hljs-operator">=</span><span class="hljs-literal">true</span>,
IsNullIfEmpty<span class="hljs-operator">=</span><span class="hljs-literal">true</span>)]
    public struct CommaDelimit : IBinarySerialize
{


[Serializable]
 private class StringList : List<span class="hljs-operator">&lt;</span>string<span class="hljs-operator">&gt;</span>
 { }

 private StringList List;

 public void Init()
 {
  this.List <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> StringList();
 }

 public void Accumulate(SqlString <span class="hljs-keyword">value</span>)
 {
  if (<span class="hljs-operator">!</span>value.IsNull)
   this.Add(value.Value);
 }

 private void <span class="hljs-keyword">Add</span>(string <span class="hljs-keyword">value</span>)
 {
  if (<span class="hljs-operator">!</span>this.List.Contains(<span class="hljs-keyword">value</span>))
   this.List.Add(<span class="hljs-keyword">value</span>);
 }

 public void <span class="hljs-keyword">Merge</span>(CommaDelimit <span class="hljs-keyword">group</span>)
 {
  foreach (string s <span class="hljs-keyword">in</span> group.List)
  {
   this.Add(s);
  }
 }

 void IBinarySerialize.Read(BinaryReader reader)
 {
    IFormatter formatter <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> BinaryFormatter();
    this.List <span class="hljs-operator">=</span> (StringList)formatter.Deserialize(reader.BaseStream);
 }

 public SqlString Terminate()
 {
  if (this.List.Count <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">0</span>)
   <span class="hljs-keyword">return</span> SqlString.Null;

  const string Separator <span class="hljs-operator">=</span> ", ";

  this.List.Sort();

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SqlString(String.Join(Separator, this.List.ToArray()));
 }

 void IBinarySerialize.Write(BinaryWriter writer)
 {
  IFormatter formatter <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> BinaryFormatter();
  formatter.Serialize(writer.BaseStream, this.List);
 }
    }
</code></pre>

<p>I've tested this using a query that looks like:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> 
 dbo.CommaDelimit(X.value) [delimited] 
<span class="hljs-keyword">FROM</span> 
 (
  <span class="hljs-keyword">SELECT</span> <span class="hljs-string">'D'</span> [<span class="hljs-keyword">value</span>] 
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-string">'B'</span> [<span class="hljs-keyword">value</span>] 
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-string">'B'</span> [<span class="hljs-keyword">value</span>] <span class="hljs-comment">-- intentional duplicate</span>
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-string">'A'</span> [<span class="hljs-keyword">value</span>] 
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-string">'C'</span> [<span class="hljs-keyword">value</span>] 
 ) X 
</code></pre>

<p>And yields: A, B, C, D</p>
    </div></div></div></div><div id="solution8" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 8</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/string-aggregation">string-aggregation</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Tried these but for my purposes in MS SQL Server 2005 the following was most useful, which I found at <a href="http://www.xaprb.com/blog/2005/09/28/simulating-the-group-concat-function/" rel="noreferrer">xaprb</a></p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">declare</span> <span class="hljs-variable">@result</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">8000</span>);

<span class="hljs-keyword">set</span> <span class="hljs-variable">@result</span> <span class="hljs-operator">=</span> <span class="hljs-string">''</span>;

<span class="hljs-keyword">select</span> <span class="hljs-variable">@result</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@result</span> <span class="hljs-operator">+</span> name <span class="hljs-operator">+</span> <span class="hljs-string">' '</span>

<span class="hljs-keyword">from</span> master.dbo.systypes;

<span class="hljs-keyword">select</span> rtrim(<span class="hljs-variable">@result</span>);
</code></pre>

<p>@Mark as you mentioned it was the space character that caused issues for me.</p>
    </div></div></div></div><div id="solution9" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 9</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/string-aggregation">string-aggregation</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>About J Hardiman's answer, how about:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> empName, projIDs<span class="hljs-operator">=</span>
  REPLACE(
    REPLACE(
      (<span class="hljs-keyword">SELECT</span> REPLACE(projID, <span class="hljs-string">' '</span>, <span class="hljs-string">'-somebody-puts-microsoft-out-of-his-misery-please-'</span>) <span class="hljs-keyword">AS</span> [data()] <span class="hljs-keyword">FROM</span> project_members <span class="hljs-keyword">WHERE</span> empName<span class="hljs-operator">=</span>a.empName <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>)), 
      <span class="hljs-string">' '</span>, 
      <span class="hljs-string">' / '</span>), 
    <span class="hljs-string">'-somebody-puts-microsoft-out-of-his-misery-please-'</span>,
    <span class="hljs-string">' '</span>) 
  <span class="hljs-keyword">FROM</span> project_members a <span class="hljs-keyword">WHERE</span> empName <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> empName
</code></pre>

<p>By the way, is the use of "Surname" a typo or am i not understanding a concept here?</p>

<p>Anyway, thanks a lot guys cuz it saved me quite some time :)</p>
    </div></div></div></div><div id="solution10" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 10</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/string-aggregation">string-aggregation</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<h3>2021</h3>
<p>@AbdusSalamAzad's answer is the correct one.</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> STRING_AGG(my_col, <span class="hljs-string">','</span>) <span class="hljs-keyword">AS</span> my_result <span class="hljs-keyword">FROM</span> my_tbl;
</code></pre>
<p>If the result is too big, you may get error "<strong>STRING_AGG aggregation result exceeded the limit of 8000 bytes. Use LOB types to avoid result truncation.</strong>" , which can be fixed by changing the query to this:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> STRING_AGG(<span class="hljs-keyword">convert</span>(<span class="hljs-type">varchar</span>(max), my_col), <span class="hljs-string">','</span>) <span class="hljs-keyword">AS</span> my_result <span class="hljs-keyword">FROM</span> my_tbl;
</code></pre>
    </div></div></div></div><div id="solution11" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 11</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/string-aggregation">string-aggregation</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>UPDATE 2020: <strong>SQL Server 2016+</strong> <strong>JSON</strong> Serialization and De-serialization Examples</p>
<p>The data provided by the OP inserted into a temporary table called #project_members</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> #project_members;
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> #project_members(
  empName        <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,
  projID         <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>);
go
<span class="hljs-keyword">insert</span> #project_members(empName, projID) <span class="hljs-keyword">values</span>
(<span class="hljs-string">'ANDY'</span>, <span class="hljs-string">'A100'</span>),
(<span class="hljs-string">'ANDY'</span>, <span class="hljs-string">'B391'</span>),
(<span class="hljs-string">'ANDY'</span>, <span class="hljs-string">'X010'</span>),
(<span class="hljs-string">'TOM'</span>, <span class="hljs-string">'A100'</span>),
(<span class="hljs-string">'TOM'</span>, <span class="hljs-string">'A510'</span>);
</code></pre>
<p>How to serialize this data into a single JSON string with a nested array containing projID's</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> empName, (<span class="hljs-keyword">select</span> pm_json.projID 
                 <span class="hljs-keyword">from</span> #project_members pm_json 
                 <span class="hljs-keyword">where</span> pm.empName<span class="hljs-operator">=</span>pm_json.empName 
                 <span class="hljs-keyword">for</span> json path, root(<span class="hljs-string">'projList'</span>)) projJSON
<span class="hljs-keyword">from</span> #project_members pm
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> empName
<span class="hljs-keyword">for</span> json path;
</code></pre>
<p>Result</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-string">'[
  {
    "empName": "ANDY",
    "projJSON": {
      "projList": [
        { "projID": "A100" },
        { "projID": "B391" },
        { "projID": "X010" }
      ]
    }
  },
  {
    "empName": "TOM",
    "projJSON": {
      "projList": [
        { "projID": "A100" },
        { "projID": "A510" }
      ]
    }
  }
]'</span>
</code></pre>
<p>How to de-serialize this data from a single JSON string back to it's original rows and columns</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">declare</span> <span class="hljs-variable">@json</span>           nvarchar(max)<span class="hljs-operator">=</span>N<span class="hljs-string">'[{"empName":"ANDY","projJSON":{"projList":[{"projID":"A100"},
                                         {"projID":"B391"},{"projID":"X010"}]}},{"empName":"TOM","projJSON":
                                         {"projList":[{"projID":"A100"},{"projID":"A510"}]}}]'</span>;

<span class="hljs-keyword">select</span> oj.empName, noj.projID 
<span class="hljs-keyword">from</span> openjson(<span class="hljs-variable">@json</span>) <span class="hljs-keyword">with</span> (empName        <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),
                           projJSON       nvarchar(max) <span class="hljs-keyword">as</span> json) oj
     <span class="hljs-keyword">cross</span> apply openjson(oj.projJSON, <span class="hljs-string">'$.projList'</span>) <span class="hljs-keyword">with</span> (projID    <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>)) noj;
</code></pre>
<p>Results</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql">empName projID
ANDY    A100
ANDY    B391
ANDY    X010
TOM     A100
TOM     A510
</code></pre>
<p>How to persist the unique empName to a table and store the projID's in a nested JSON array</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> #project_members_with_json;
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> #project_members_with_json(
  empName        <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">unique</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,
  projJSON       nvarchar(max) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>);
go
<span class="hljs-keyword">insert</span> #project_members_with_json(empName, projJSON) 
<span class="hljs-keyword">select</span> empName, (<span class="hljs-keyword">select</span> pm_json.projID 
                 <span class="hljs-keyword">from</span> #project_members pm_json 
                 <span class="hljs-keyword">where</span> pm.empName<span class="hljs-operator">=</span>pm_json.empName 
                 <span class="hljs-keyword">for</span> json path, root(<span class="hljs-string">'projList'</span>)) 
<span class="hljs-keyword">from</span> #project_members pm
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> empName;
</code></pre>
<p>Results</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql">empName projJSON
ANDY    {"projList":[{"projID":"A100"},{"projID":"B391"},{"projID":"X010"}]}
TOM     {"projList":[{"projID":"A100"},{"projID":"A510"}]}
</code></pre>
<p>How to de-serialize from a table with unique empName and nested JSON array column containing projID's</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> wj.empName, oj.projID
<span class="hljs-keyword">from</span>
  #project_members_with_json wj
 <span class="hljs-keyword">cross</span> apply
  openjson(wj.projJSON, <span class="hljs-string">'$.projList'</span>) <span class="hljs-keyword">with</span> (projID    <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>)) oj;
</code></pre>
<p>Results</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql">empName projID
ANDY    A100
ANDY    B391
ANDY    X010
TOM     A100
TOM     A510
</code></pre>
    </div></div></div></div><div id="solution12" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 12</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/string-aggregation">string-aggregation</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>For SQL Server 2017+, use  STRING_AGG() function</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql">    <span class="hljs-keyword">SELECT</span> STRING_AGG(Genre, <span class="hljs-string">','</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">Result</span>
    <span class="hljs-keyword">FROM</span> Genres;
</code></pre>
<p>Sample result:</p>
<h2 id="result">Result</h2>
<p>Rock,Jazz,Country,Pop,Blues,Hip Hop,Rap,Punk</p>
    </div></div></div></div><div id="solution13" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 13</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/string-aggregation">string-aggregation</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>For my fellow Googlers out there, here's a very simple plug-and-play solution that worked for me after struggling with the more complex solutions for a while:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span>
<span class="hljs-keyword">distinct</span> empName,
NewColumnName<span class="hljs-operator">=</span>STUFF((<span class="hljs-keyword">SELECT</span> <span class="hljs-string">','</span><span class="hljs-operator">+</span> <span class="hljs-keyword">CONVERT</span>(<span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>), projID ) 
                     <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">returns</span> 
                     <span class="hljs-keyword">WHERE</span> empName<span class="hljs-operator">=</span>t.empName <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>)) , <span class="hljs-number">1</span> , <span class="hljs-number">1</span> , <span class="hljs-string">''</span> )
<span class="hljs-keyword">FROM</span> 
<span class="hljs-keyword">returns</span> t
</code></pre>

<p>Notice that I had to convert the ID into a VARCHAR in order to concatenate it as a string. If you don't have to do that, here's an even simpler version:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span>
<span class="hljs-keyword">distinct</span> empName,
NewColumnName<span class="hljs-operator">=</span>STUFF((<span class="hljs-keyword">SELECT</span> <span class="hljs-string">','</span><span class="hljs-operator">+</span> projID
                     <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">returns</span> 
                     <span class="hljs-keyword">WHERE</span> empName<span class="hljs-operator">=</span>t.empName <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>)) , <span class="hljs-number">1</span> , <span class="hljs-number">1</span> , <span class="hljs-string">''</span> )
<span class="hljs-keyword">FROM</span> 
<span class="hljs-keyword">returns</span> t
</code></pre>

<p>All credit for this goes to here:
<a href="https://social.msdn.microsoft.com/Forums/sqlserver/en-US/9508abc2-46e7-4186-b57f-7f368374e084/replicating-groupconcat-function-of-mysql-in-sql-server?forum=transactsql" rel="nofollow noreferrer">https://social.msdn.microsoft.com/Forums/sqlserver/en-US/9508abc2-46e7-4186-b57f-7f368374e084/replicating-groupconcat-function-of-mysql-in-sql-server?forum=transactsql</a></p>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/captured-variable-in-a-loop-in-c-1657387696779">Captured variable in a loop in C#</a><a href="/questions/how-to-access-the-correct-this-inside-a-callback-1657384283261">How to access the correct `this` inside a callback</a><a href="/questions/i-just-assigned-a-variable-but-echo-dollarvariable-shows-something-else-1657387574561">I just assigned a variable, but echo $variable shows something else</a><a href="/questions/get-selected-value-in-dropdown-list-using-javascript-1657387631638">Get selected value in dropdown list using JavaScript</a><a href="/questions/reference-what-does-this-error-mean-in-php-1657384301782">Reference - What does this error mean in PHP?</a><a href="/questions/what-are-valid-values-for-the-id-attribute-in-html-1657384874780">What are valid values for the id attribute in HTML?</a><a href="/questions/what-is-the-behavior-of-integer-division-1657388222571">What is the behavior of integer division?</a><a href="/questions/secure-hash-and-salt-for-php-passwords-1657387363258">Secure hash and salt for PHP passwords</a><a href="/questions/how-to-generate-all-permutations-of-a-list-1657388537371">How to generate all permutations of a list</a><a href="/questions/using-auto-layout-in-uitableview-for-dynamic-cell-layouts-and-variable-row-heights-1657387722263">Using Auto Layout in UITableView for dynamic cell layouts &amp; variable row heights</a><a href="/questions/sorting-object-property-by-values-1657388367300">Sorting object property by values</a><a href="/questions/how-do-i-profile-a-python-script-1657388346692">How do I profile a Python script?</a><a href="/questions/why-is-using-the-javascript-eval-function-a-bad-idea-1657387485165">Why is using the JavaScript eval function a bad idea?</a><a href="/questions/how-can-i-upload-files-to-a-server-using-jspservlet-1657384847658">How can I upload files to a server using JSP/Servlet?</a><a href="/questions/how-to-create-recyclerview-with-multiple-view-types-1657388121512">How to create RecyclerView with multiple view types</a><a href="/questions/sort-a-maplesskey-valuegreater-by-values-1657387443904">Sort a Map&lt;Key, Value&gt; by values</a><a href="/questions/non-static-variable-cannot-be-referenced-from-a-static-context-1657387386240">Non-static variable cannot be referenced from a static context</a><a href="/questions/how-to-return-datasnapshot-value-as-a-result-of-a-method-1657387538165">How to return DataSnapshot value as a result of a method?</a><a href="/questions/re.findall-behaves-weird-1657388408049">re.findall behaves weird</a><a href="/questions/why-does-a-regexp-with-global-flag-give-wrong-results-1657387788550">Why does a RegExp with global flag give wrong results?</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;No REAL easy way to do this. Lots of ideas out there, though.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://blog.shlomoid.com/2008/11/emulating-mysqls-groupconcat-function.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Best one I\u0026apos;ve found\u0026lt;/a\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; table_name, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;LEFT\u0026lt;/span\u0026gt;(column_names , LEN(column_names )\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; column_names\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; information_schema.columns \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; extern\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CROSS\u0026lt;/span\u0026gt; APPLY\n(\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; column_name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; information_schema.columns \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; intern\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; extern.table_name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; intern.table_name\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)\n) pre_trimmed (column_names)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;GROUP\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; table_name, column_names;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Or a version that works correctly if the data might contain characters such as \u0026lt;code\u0026gt;\u0026amp;lt;\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WITH\u0026lt;/span\u0026gt; extern\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DISTINCT\u0026lt;/span\u0026gt; table_name\n         \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt;   INFORMATION_SCHEMA.COLUMNS)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; table_name,\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;LEFT\u0026lt;/span\u0026gt;(y.column_names, LEN(y.column_names) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; column_names\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt;   extern\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CROSS\u0026lt;/span\u0026gt; APPLY (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; column_name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt;   INFORMATION_SCHEMA.COLUMNS \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; intern\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt;  extern.table_name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; intern.table_name\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;), TYPE) x (column_names)\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CROSS\u0026lt;/span\u0026gt; APPLY (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; x.column_names.value(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;.\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;NVARCHAR(MAX)\u0026apos;\u0026lt;/span\u0026gt;)) y(column_names) \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I may be a bit late to the party but this method works for me and is easier than the COALESCE method.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; STUFF(\n             (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; Column_Name \n              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Table_Name\n              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;))\n             , \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;SQL Server 2017\u0026lt;/strong\u0026gt; does introduce a new aggregate function\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://msdn.microsoft.com/en-us/library/mt790580.aspx\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;STRING_AGG ( expression, separator)\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;Concatenates the values of string expressions and places separator\n  values between them. The separator is not added at the end of string.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;The concatenated elements can be ordered by appending \u0026lt;code\u0026gt;WITHIN GROUP (ORDER BY some_expression)\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;For versions 2005-2016\u0026lt;/strong\u0026gt; I typically use the XML method in the accepted answer.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This can fail in some circumstances however. e.g. if the data to be concatenated contains \u0026lt;code\u0026gt;CHAR(29)\u0026lt;/code\u0026gt; you see\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;FOR XML could not serialize the data ... because it\n  contains a character (0x001D) which is not allowed in XML.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;A more robust method that can deal with all characters would be to use a CLR aggregate. However applying an ordering to the concatenated elements is more difficult with this approach.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The method of assigning to a variable is \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/15138593/nvarchar-concatenation-index-nvarcharmax-inexplicable-behavior/15163136#15163136\u0026quot;\u0026gt;not guaranteed\u0026lt;/a\u0026gt; and should be avoided in production code.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Possibly too late to be of benefit now, but is this not the easiest way to do things?\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt;     empName, projIDs \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; replace\n                          ((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; Surname \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; [data()]\n                              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; project_members\n                              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt;  empName \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; a.empName\n                              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ORDER\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; empName \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; xml path(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)), \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \u0026apos;\u0026lt;/span\u0026gt;, REQUIRED SEPERATOR)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt;         project_members a\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt;     empName \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;IS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NOT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NULL\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;GROUP\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; empName\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Have a look at the \u0026lt;a href=\u0026quot;https://github.com/orlando-colamatteo/ms-sql-server-group-concat-sqlclr\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;GROUP_CONCAT\u0026lt;/a\u0026gt; project on Github, I think I does exactly what you are searching for:\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;This project contains a set of SQLCLR User-defined Aggregate functions (SQLCLR UDAs) that collectively offer similar functionality to the MySQL GROUP_CONCAT function. There are multiple functions to ensure the best performance based on the functionality required...\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n    ","\n\u0026lt;p\u0026gt;To concatenate all the project manager names from projects that have multiple project managers write:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; a.project_id,a.project_name,Stuff((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; N\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/ \u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; first_name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;, \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;last_name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; projects_v \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; a.project_id\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;project_id\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt;\n XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;),TYPE).\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;text()[1]\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;nvarchar(max)\u0026apos;\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;,N\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;\n) mgr_names\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; projects_v a\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;group\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; a.project_id,a.project_name\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;With the below code you have to set PermissionLevel=External on your project properties before you deploy, and change the database to trust external code (be sure to read elsewhere about security risks and alternatives [like certificates]) by running \u0026quot;ALTER DATABASE database_name SET TRUSTWORTHY ON\u0026quot;.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;System\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; System.Collections.Generic;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; System.Data.SqlTypes;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; System.IO;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; System.Runtime.Serialization;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; System.Runtime.Serialization.Formatters.Binary;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; Microsoft.SqlServer.Server;\n\n[Serializable]\n[SqlUserDefinedAggregate(Format.UserDefined,\nMaxByteSize\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8000\u0026lt;/span\u0026gt;,\nIsInvariantToDuplicates\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;,\nIsInvariantToNulls\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;,\nIsInvariantToOrder\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;,\nIsNullIfEmpty\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;)]\n    public struct CommaDelimit : IBinarySerialize\n{\n\n\n[Serializable]\n private class StringList : List\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;string\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n { }\n\n private StringList List;\n\n public void Init()\n {\n  this.List \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; StringList();\n }\n\n public void Accumulate(SqlString \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;)\n {\n  if (\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;!\u0026lt;/span\u0026gt;value.IsNull)\n   this.Add(value.Value);\n }\n\n private void \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Add\u0026lt;/span\u0026gt;(string \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;)\n {\n  if (\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;!\u0026lt;/span\u0026gt;this.List.Contains(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;))\n   this.List.Add(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;);\n }\n\n public void \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Merge\u0026lt;/span\u0026gt;(CommaDelimit \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;group\u0026lt;/span\u0026gt;)\n {\n  foreach (string s \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; group.List)\n  {\n   this.Add(s);\n  }\n }\n\n void IBinarySerialize.Read(BinaryReader reader)\n {\n    IFormatter formatter \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; BinaryFormatter();\n    this.List \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; (StringList)formatter.Deserialize(reader.BaseStream);\n }\n\n public SqlString Terminate()\n {\n  if (this.List.Count \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)\n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; SqlString.Null;\n\n  const string Separator \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026quot;, \u0026quot;;\n\n  this.List.Sort();\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlString(String.Join(Separator, this.List.ToArray()));\n }\n\n void IBinarySerialize.Write(BinaryWriter writer)\n {\n  IFormatter formatter \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; BinaryFormatter();\n  formatter.Serialize(writer.BaseStream, this.List);\n }\n    }\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;I\u0026apos;ve tested this using a query that looks like:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \n dbo.CommaDelimit(X.value) [delimited] \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \n (\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;D\u0026apos;\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;] \n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;UNION\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ALL\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;B\u0026apos;\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;] \n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;UNION\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ALL\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;B\u0026apos;\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;] \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- intentional duplicate\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;UNION\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ALL\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;A\u0026apos;\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;] \n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;UNION\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ALL\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;C\u0026apos;\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;] \n ) X \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;And yields: A, B, C, D\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Tried these but for my purposes in MS SQL Server 2005 the following was most useful, which I found at \u0026lt;a href=\u0026quot;http://www.xaprb.com/blog/2005/09/28/simulating-the-group-concat-function/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;xaprb\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@result\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8000\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@result\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@result\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@result\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; master.dbo.systypes;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; rtrim(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@result\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;@Mark as you mentioned it was the space character that caused issues for me.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;About J Hardiman\u0026apos;s answer, how about:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; empName, projIDs\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\n  REPLACE(\n    REPLACE(\n      (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; REPLACE(projID, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;-somebody-puts-microsoft-out-of-his-misery-please-\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; [data()] \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; project_members \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; empName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;a.empName \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)), \n      \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \u0026apos;\u0026lt;/span\u0026gt;, \n      \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; / \u0026apos;\u0026lt;/span\u0026gt;), \n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;-somebody-puts-microsoft-out-of-his-misery-please-\u0026apos;\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \u0026apos;\u0026lt;/span\u0026gt;) \n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; project_members a \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; empName \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;IS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NOT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NULL\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;GROUP\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; empName\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;By the way, is the use of \u0026quot;Surname\u0026quot; a typo or am i not understanding a concept here?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Anyway, thanks a lot guys cuz it saved me quite some time :)\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;h3\u0026gt;2021\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;@AbdusSalamAzad\u0026apos;s answer is the correct one.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; STRING_AGG(my_col, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; my_result \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; my_tbl;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;If the result is too big, you may get error \u0026quot;\u0026lt;strong\u0026gt;STRING_AGG aggregation result exceeded the limit of 8000 bytes. Use LOB types to avoid result truncation.\u0026lt;/strong\u0026gt;\u0026quot; , which can be fixed by changing the query to this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; STRING_AGG(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;convert\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(max), my_col), \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; my_result \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; my_tbl;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;UPDATE 2020: \u0026lt;strong\u0026gt;SQL Server 2016+\u0026lt;/strong\u0026gt; \u0026lt;strong\u0026gt;JSON\u0026lt;/strong\u0026gt; Serialization and De-serialization Examples\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The data provided by the OP inserted into a temporary table called #project_members\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;drop\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt; if \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;exists\u0026lt;/span\u0026gt; #project_members;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;create\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt; #project_members(\n  empName        \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;not\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;,\n  projID         \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;not\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;);\ngo\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;insert\u0026lt;/span\u0026gt; #project_members(empName, projID) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;values\u0026lt;/span\u0026gt;\n(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ANDY\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;A100\u0026apos;\u0026lt;/span\u0026gt;),\n(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ANDY\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;B391\u0026apos;\u0026lt;/span\u0026gt;),\n(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ANDY\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;X010\u0026apos;\u0026lt;/span\u0026gt;),\n(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;TOM\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;A100\u0026apos;\u0026lt;/span\u0026gt;),\n(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;TOM\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;A510\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;How to serialize this data into a single JSON string with a nested array containing projID\u0026apos;s\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; empName, (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; pm_json.projID \n                 \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; #project_members pm_json \n                 \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; pm.empName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;pm_json.empName \n                 \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; json path, root(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;projList\u0026apos;\u0026lt;/span\u0026gt;)) projJSON\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; #project_members pm\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;group\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; empName\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; json path;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Result\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;[\n  {\n    \u0026quot;empName\u0026quot;: \u0026quot;ANDY\u0026quot;,\n    \u0026quot;projJSON\u0026quot;: {\n      \u0026quot;projList\u0026quot;: [\n        { \u0026quot;projID\u0026quot;: \u0026quot;A100\u0026quot; },\n        { \u0026quot;projID\u0026quot;: \u0026quot;B391\u0026quot; },\n        { \u0026quot;projID\u0026quot;: \u0026quot;X010\u0026quot; }\n      ]\n    }\n  },\n  {\n    \u0026quot;empName\u0026quot;: \u0026quot;TOM\u0026quot;,\n    \u0026quot;projJSON\u0026quot;: {\n      \u0026quot;projList\u0026quot;: [\n        { \u0026quot;projID\u0026quot;: \u0026quot;A100\u0026quot; },\n        { \u0026quot;projID\u0026quot;: \u0026quot;A510\u0026quot; }\n      ]\n    }\n  }\n]\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;How to de-serialize this data from a single JSON string back to it\u0026apos;s original rows and columns\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@json\u0026lt;/span\u0026gt;           nvarchar(max)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;N\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;[{\u0026quot;empName\u0026quot;:\u0026quot;ANDY\u0026quot;,\u0026quot;projJSON\u0026quot;:{\u0026quot;projList\u0026quot;:[{\u0026quot;projID\u0026quot;:\u0026quot;A100\u0026quot;},\n                                         {\u0026quot;projID\u0026quot;:\u0026quot;B391\u0026quot;},{\u0026quot;projID\u0026quot;:\u0026quot;X010\u0026quot;}]}},{\u0026quot;empName\u0026quot;:\u0026quot;TOM\u0026quot;,\u0026quot;projJSON\u0026quot;:\n                                         {\u0026quot;projList\u0026quot;:[{\u0026quot;projID\u0026quot;:\u0026quot;A100\u0026quot;},{\u0026quot;projID\u0026quot;:\u0026quot;A510\u0026quot;}]}}]\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; oj.empName, noj.projID \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; openjson(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@json\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;with\u0026lt;/span\u0026gt; (empName        \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;),\n                           projJSON       nvarchar(max) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; json) oj\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;cross\u0026lt;/span\u0026gt; apply openjson(oj.projJSON, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$.projList\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;with\u0026lt;/span\u0026gt; (projID    \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;)) noj;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Results\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;empName projID\nANDY    A100\nANDY    B391\nANDY    X010\nTOM     A100\nTOM     A510\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;How to persist the unique empName to a table and store the projID\u0026apos;s in a nested JSON array\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;drop\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt; if \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;exists\u0026lt;/span\u0026gt; #project_members_with_json;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;create\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt; #project_members_with_json(\n  empName        \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;unique\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;not\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;,\n  projJSON       nvarchar(max) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;not\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;);\ngo\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;insert\u0026lt;/span\u0026gt; #project_members_with_json(empName, projJSON) \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; empName, (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; pm_json.projID \n                 \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; #project_members pm_json \n                 \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; pm.empName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;pm_json.empName \n                 \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; json path, root(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;projList\u0026apos;\u0026lt;/span\u0026gt;)) \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; #project_members pm\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;group\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; empName;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Results\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;empName projJSON\nANDY    {\u0026quot;projList\u0026quot;:[{\u0026quot;projID\u0026quot;:\u0026quot;A100\u0026quot;},{\u0026quot;projID\u0026quot;:\u0026quot;B391\u0026quot;},{\u0026quot;projID\u0026quot;:\u0026quot;X010\u0026quot;}]}\nTOM     {\u0026quot;projList\u0026quot;:[{\u0026quot;projID\u0026quot;:\u0026quot;A100\u0026quot;},{\u0026quot;projID\u0026quot;:\u0026quot;A510\u0026quot;}]}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;How to de-serialize from a table with unique empName and nested JSON array column containing projID\u0026apos;s\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; wj.empName, oj.projID\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt;\n  #project_members_with_json wj\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;cross\u0026lt;/span\u0026gt; apply\n  openjson(wj.projJSON, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$.projList\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;with\u0026lt;/span\u0026gt; (projID    \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;)) oj;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Results\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;empName projID\nANDY    A100\nANDY    B391\nANDY    X010\nTOM     A100\nTOM     A510\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;For SQL Server 2017+, use  STRING_AGG() function\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; STRING_AGG(Genre, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Result\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Genres;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Sample result:\u0026lt;/p\u0026gt;\n\u0026lt;h2 id=\u0026quot;result\u0026quot;\u0026gt;Result\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;Rock,Jazz,Country,Pop,Blues,Hip Hop,Rap,Punk\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;For my fellow Googlers out there, here\u0026apos;s a very simple plug-and-play solution that worked for me after struggling with the more complex solutions for a while:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;distinct\u0026lt;/span\u0026gt; empName,\nNewColumnName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;STUFF((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CONVERT\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;), projID ) \n                     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;returns\u0026lt;/span\u0026gt; \n                     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; empName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;t.empName \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)) , \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; , \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; , \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt; )\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;returns\u0026lt;/span\u0026gt; t\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Notice that I had to convert the ID into a VARCHAR in order to concatenate it as a string. If you don\u0026apos;t have to do that, here\u0026apos;s an even simpler version:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;distinct\u0026lt;/span\u0026gt; empName,\nNewColumnName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;STUFF((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; projID\n                     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;returns\u0026lt;/span\u0026gt; \n                     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; empName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;t.empName \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)) , \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; , \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; , \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt; )\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;returns\u0026lt;/span\u0026gt; t\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;All credit for this goes to here:\n\u0026lt;a href=\u0026quot;https://social.msdn.microsoft.com/Forums/sqlserver/en-US/9508abc2-46e7-4186-b57f-7f368374e084/replicating-groupconcat-function-of-mysql-in-sql-server?forum=transactsql\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;https://social.msdn.microsoft.com/Forums/sqlserver/en-US/9508abc2-46e7-4186-b57f-7f368374e084/replicating-groupconcat-function-of-mysql-in-sql-server?forum=transactsql\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    "],"id":164,"title":"Simulating group_concat MySQL function in Microsoft SQL Server 2005?","content":"\n                \n\u0026lt;p\u0026gt;I\u0026apos;m trying to migrate a MySQL-based app over to Microsoft SQL Server 2005 (not by choice, but that\u0026apos;s life).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;In the original app, we used \u0026lt;em\u0026gt;almost\u0026lt;/em\u0026gt; entirely ANSI-SQL compliant statements, with one significant exception -- we used MySQL\u0026apos;s \u0026lt;code\u0026gt;group_concat\u0026lt;/code\u0026gt; function fairly frequently.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;group_concat\u0026lt;/code\u0026gt;, by the way, does this: given a table of, say, employee names and projects...\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; empName, projID \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; project_members;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;returns:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;ANDY   \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  A100\nANDY   \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  B391\nANDY   \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  X010\nTOM    \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  A100\nTOM    \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  A510\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;... and here\u0026apos;s what you get with group_concat:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \n    empName, group_concat(projID SEPARATOR \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; / \u0026apos;\u0026lt;/span\u0026gt;) \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \n    project_members \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;GROUP\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; \n    empName;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;returns:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;ANDY   \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  A100 \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt; B391 \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt; X010\nTOM    \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  A100 \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt; A510\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;So what I\u0026apos;d like to know is: Is it possible to write, say, a user-defined function in SQL Server which emulates the functionality of \u0026lt;code\u0026gt;group_concat\u0026lt;/code\u0026gt;? \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I have almost no experience using UDFs, stored procedures, or anything like that, just straight-up SQL, so please err on the side of too much explanation :)\u0026lt;/p\u0026gt;\n    ","slug":"simulating-group_concat-mysql-function-in-microsoft-sql-server-2005-1657384832169","postType":"QUESTION","createdAt":"2022-07-09T16:40:32.000Z","updatedAt":"2022-07-09T16:40:32.000Z","tags":[{"id":602,"name":"sql-server","slug":"sql-server","createdAt":"2022-07-09T16:40:32.000Z","updatedAt":"2022-07-09T16:40:32.000Z","Questions_Tags":{"questionId":164,"tagId":602}},{"id":603,"name":"sql-server-2005","slug":"sql-server-2005","createdAt":"2022-07-09T16:40:32.000Z","updatedAt":"2022-07-09T16:40:32.000Z","Questions_Tags":{"questionId":164,"tagId":603}},{"id":604,"name":"string-aggregation","slug":"string-aggregation","createdAt":"2022-07-09T16:40:32.000Z","updatedAt":"2022-07-09T16:40:32.000Z","Questions_Tags":{"questionId":164,"tagId":604}}],"relatedQuestions":[{"title":"Simulating group_concat MySQL function in Microsoft SQL Server 2005?","slug":"simulating-group_concat-mysql-function-in-microsoft-sql-server-2005-1657384832169","tags":[{"name":"sql-server","Questions_Tags":{"questionId":164,"tagId":602}},{"name":"sql-server-2005","Questions_Tags":{"questionId":164,"tagId":603}},{"name":"string-aggregation","Questions_Tags":{"questionId":164,"tagId":604}}]}]},"randomQuestions":[{"title":"Captured variable in a loop in C#","slug":"captured-variable-in-a-loop-in-c-1657387696779"},{"title":"How to access the correct `this` inside a callback","slug":"how-to-access-the-correct-this-inside-a-callback-1657384283261"},{"title":"I just assigned a variable, but echo $variable shows something else","slug":"i-just-assigned-a-variable-but-echo-dollarvariable-shows-something-else-1657387574561"},{"title":"Get selected value in dropdown list using JavaScript","slug":"get-selected-value-in-dropdown-list-using-javascript-1657387631638"},{"title":"Reference - What does this error mean in PHP?","slug":"reference-what-does-this-error-mean-in-php-1657384301782"},{"title":"What are valid values for the id attribute in HTML?","slug":"what-are-valid-values-for-the-id-attribute-in-html-1657384874780"},{"title":"What is the behavior of integer division?","slug":"what-is-the-behavior-of-integer-division-1657388222571"},{"title":"Secure hash and salt for PHP passwords","slug":"secure-hash-and-salt-for-php-passwords-1657387363258"},{"title":"How to generate all permutations of a list","slug":"how-to-generate-all-permutations-of-a-list-1657388537371"},{"title":"Using Auto Layout in UITableView for dynamic cell layouts \u0026 variable row heights","slug":"using-auto-layout-in-uitableview-for-dynamic-cell-layouts-and-variable-row-heights-1657387722263"},{"title":"Sorting object property by values","slug":"sorting-object-property-by-values-1657388367300"},{"title":"How do I profile a Python script?","slug":"how-do-i-profile-a-python-script-1657388346692"},{"title":"Why is using the JavaScript eval function a bad idea?","slug":"why-is-using-the-javascript-eval-function-a-bad-idea-1657387485165"},{"title":"How can I upload files to a server using JSP/Servlet?","slug":"how-can-i-upload-files-to-a-server-using-jspservlet-1657384847658"},{"title":"How to create RecyclerView with multiple view types","slug":"how-to-create-recyclerview-with-multiple-view-types-1657388121512"},{"title":"Sort a Map\u003cKey, Value\u003e by values","slug":"sort-a-maplesskey-valuegreater-by-values-1657387443904"},{"title":"Non-static variable cannot be referenced from a static context","slug":"non-static-variable-cannot-be-referenced-from-a-static-context-1657387386240"},{"title":"How to return DataSnapshot value as a result of a method?","slug":"how-to-return-datasnapshot-value-as-a-result-of-a-method-1657387538165"},{"title":"re.findall behaves weird","slug":"re.findall-behaves-weird-1657388408049"},{"title":"Why does a RegExp with global flag give wrong results?","slug":"why-does-a-regexp-with-global-flag-give-wrong-results-1657387788550"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"simulating-group_concat-mysql-function-in-microsoft-sql-server-2005-1657384832169"},"buildId":"TQ2eYlCSdocSK-hq6gkM0","isFallback":false,"gsp":true,"locale":"en","locales":["en"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>