{"pageProps":{"data":{"answer":["\n\n&lt;p&gt;You are not the first, who fell into the famous &quot;delayed expansion trap&quot; (and you won&apos;t be the last).&lt;/p&gt;\n&lt;p&gt;You need delayed expansion if you want to use a variable, that you changed in the same block (a block is a series of commands within parentheses &lt;code&gt;(&lt;/code&gt;and &lt;code&gt;)&lt;/code&gt;).&lt;/p&gt;\n&lt;p&gt;Delayed variables are referenced with &lt;code&gt;!var!&lt;/code&gt; instead of &lt;code&gt;%var%&lt;/code&gt;.&lt;/p&gt;\n&lt;p&gt;Reason is the way, &lt;code&gt;cmd&lt;/code&gt; parses the code. A complete line or block is parsed at once, replacing normal variables with their value at parse time. Delayed variables are evaluated at runtime.&lt;/p&gt;\n&lt;p&gt;Two simple batch files to demonstrate:&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-csharp&quot;&gt;setlocal EnableDelayedExpansion\n&lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var=hello&quot;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;==&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; (\n    &lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var=world&quot;&lt;/span&gt;\n    echo %&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt;% !&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt;!\n)\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-lua&quot;&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;setlocal&lt;/span&gt; EnableDelayedExpansion\n&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; /L %%i &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; (&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt; (\n    echo %&lt;span class=&quot;hljs-built_in&quot;&gt;random&lt;/span&gt;% !&lt;span class=&quot;hljs-built_in&quot;&gt;random&lt;/span&gt;!\n)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;em&gt;Note&lt;/em&gt;: A line is also treated as a block:&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-bash&quot;&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var=old&quot;&lt;/span&gt;\n&lt;span class=&quot;hljs-built_in&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var=new&quot;&lt;/span&gt; &amp;amp; &lt;span class=&quot;hljs-built_in&quot;&gt;echo&lt;/span&gt; %var% \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;With delayed expansion:&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-bash&quot;&gt;setlocal EnableDelayedExpansion\n&lt;span class=&quot;hljs-built_in&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var=old&quot;&lt;/span&gt;\n&lt;span class=&quot;hljs-built_in&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var=new&quot;&lt;/span&gt; &amp;amp; &lt;span class=&quot;hljs-built_in&quot;&gt;echo&lt;/span&gt; !var! \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Delayed expansion is per default turned off at the command prompt. If you really need it, you can do:&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-csharp&quot;&gt;cmd /V:ON /C &lt;span class=&quot;hljs-string&quot;&gt;&quot;set &quot;&lt;/span&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt;=hello&lt;span class=&quot;hljs-string&quot;&gt;&quot; &amp;amp; echo !var!&quot;&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Also there is a way to do the same without delayed expansion (but &lt;code&gt;call&lt;/code&gt; costs some time, so it&apos;s slower, but if for some reason you can&apos;t / don&apos;t want to use delayed expansion, it&apos;s an alternative):&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-lua&quot;&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;setlocal&lt;/span&gt; DISabledelayedexpansion\n&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; /L %%i &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; (&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt; (\n    call echo %&lt;span class=&quot;hljs-built_in&quot;&gt;random&lt;/span&gt;% %%&lt;span class=&quot;hljs-built_in&quot;&gt;random&lt;/span&gt;%% \n)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Both methods can also be used to display &lt;a href=&quot;https://stackoverflow.com/a/10167990&quot;&gt;array-like variables&lt;/a&gt;:&lt;/p&gt;\n&lt;p&gt;(This is often asked like &quot;variable which contains another variable&quot; or &quot;nested variables&quot;)&lt;/p&gt;\n&lt;p&gt;Here is a collection for using such array-like variables in different situations:&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;With delayed expansion:&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-dart&quot;&gt;setlocal ENableDelayedExpansion\n&lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;num=4&quot;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var[%num%]=HELLO&quot;&lt;/span&gt;\necho plain delayed: !&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt;[%&lt;span class=&quot;hljs-built_in&quot;&gt;num&lt;/span&gt;%]!\n&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; /L %%i &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; (&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt; (\n    echo &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; delayed: !&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt;[%%i]!\n    &lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; a=%%i\n    call echo &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; delayed &lt;span class=&quot;hljs-keyword&quot;&gt;with&lt;/span&gt; variable: %%&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt;[!a!]%%\n)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;without delayed expansion:&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;setlocal DISableDelayedExpansion\n&lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &quot;num=4&quot;\n&lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &quot;var[%num%]=HELLO&quot;\n&lt;span class=&quot;hljs-keyword&quot;&gt;call&lt;/span&gt; echo plain &lt;span class=&quot;hljs-keyword&quot;&gt;called&lt;/span&gt;: &lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;var[&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;num&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;]&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;L &lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;i &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; (&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;) do (\n    &lt;span class=&quot;hljs-keyword&quot;&gt;call&lt;/span&gt; echo &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;called&lt;/span&gt;: &lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;var[&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;i]&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; a&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;i\n    &lt;span class=&quot;hljs-keyword&quot;&gt;call&lt;/span&gt; echo &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;called&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;with&lt;/span&gt; variable: &lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;var[&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;a&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;]&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;\n)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: &lt;code&gt;setlocal&lt;/code&gt; has no effect outside of batchfiles, so &lt;code&gt;delayedexpansion&lt;/code&gt; works only:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;In batch files&lt;/li&gt;\n&lt;li&gt;When the cmd was started with delayed expansion enabled (&lt;code&gt;cmd /V:ON&lt;/code&gt;) (by default, the cmd runs with delayed expansion &lt;strong&gt;dis&lt;/strong&gt;abled)&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;(Follow the links, when you are interested in the &lt;a href=&quot;http://blogs.msdn.com/b/oldnewthing/archive/2006/08/23/714650.aspx&quot; rel=&quot;nofollow noreferrer&quot;&gt;technical background&lt;/a&gt; or even the &lt;a href=&quot;http://stackoverflow.com/q/4094699/2152082&quot;&gt;advanced technical stuff&lt;/a&gt;)&lt;/p&gt;\n    "],"id":176,"title":"Variables are not behaving as expected","content":"\n                \n&lt;p&gt;I&apos;ve been wrestling trying to get the syntax right on this batch file and I cannot figure out why some things aren&apos;t working.&lt;/p&gt;\n\n&lt;ol&gt;\n&lt;li&gt;The variable &lt;code&gt;i&lt;/code&gt; is not getting incremented each time I do it.&lt;/li&gt;\n&lt;li&gt;Concatenation on &lt;code&gt;strc&lt;/code&gt; doesn&apos;t seem to concatenate.&lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;p&gt;Here is my code:&lt;/p&gt;\n\n&lt;pre&gt;&lt;code&gt;set i=0\nset &quot;strc=concat:&quot;\n\nfor %%f in (*.mp4) do (\n    set /a i+=1\n    set &quot;str=intermediate%i%.ts&quot;\n\n    set strc=&quot;%strc% %str%|&quot;\n\n    ffmpeg -i &quot;%%f&quot; -c copy -bsf:v h264_mp4toannexb -f mpegts &quot;%str%&quot;\n)\n\nset strc=&quot;%strc:-1%&quot;\nffmpeg -i &quot;%strc%&quot; -c copy -bsf:a aac_adtstoasc Output.mp4\n&lt;/code&gt;&lt;/pre&gt;\n    ","slug":"variables-are-not-behaving-as-expected-1657384865672","postType":"QUESTION","createdAt":"2022-07-09T16:41:05.000Z","updatedAt":"2022-07-09T16:41:05.000Z","tags":[{"id":646,"name":"windows","slug":"windows","createdAt":"2022-07-09T16:41:05.000Z","updatedAt":"2022-07-09T16:41:05.000Z","Questions_Tags":{"questionId":176,"tagId":646}},{"id":647,"name":"batch-file","slug":"batch-file","createdAt":"2022-07-09T16:41:05.000Z","updatedAt":"2022-07-09T16:41:05.000Z","Questions_Tags":{"questionId":176,"tagId":647}},{"id":648,"name":"cmd","slug":"cmd","createdAt":"2022-07-09T16:41:05.000Z","updatedAt":"2022-07-09T16:41:05.000Z","Questions_Tags":{"questionId":176,"tagId":648}},{"id":649,"name":"environment-variables","slug":"environment-variables","createdAt":"2022-07-09T16:41:05.000Z","updatedAt":"2022-07-09T16:41:05.000Z","Questions_Tags":{"questionId":176,"tagId":649}},{"id":650,"name":"delayedvariableexpansion","slug":"delayedvariableexpansion","createdAt":"2022-07-09T16:41:05.000Z","updatedAt":"2022-07-09T16:41:05.000Z","Questions_Tags":{"questionId":176,"tagId":650}}],"relatedQuestions":[{"title":"Variables are not behaving as expected","slug":"variables-are-not-behaving-as-expected-1657384865672","tags":[{"name":"windows","Questions_Tags":{"questionId":176,"tagId":646}},{"name":"batch-file","Questions_Tags":{"questionId":176,"tagId":647}},{"name":"cmd","Questions_Tags":{"questionId":176,"tagId":648}},{"name":"environment-variables","Questions_Tags":{"questionId":176,"tagId":649}},{"name":"delayedvariableexpansion","Questions_Tags":{"questionId":176,"tagId":650}}]}]},"randomQuestions":[{"title":"My attempt at value initialization is interpreted as a function declaration, and why doesn't A a(()); solve it?","slug":"my-attempt-at-value-initialization-is-interpreted-as-a-function-declaration-and-why-doesn't-a-a(())-solve-it-1657388474057"},{"title":"How do I vertically center text with CSS? [duplicate]","slug":"how-do-i-vertically-center-text-with-css-duplicate-1657387645821"},{"title":"How can I remove a specific item from an array?","slug":"how-can-i-remove-a-specific-item-from-an-array-1657387552077"},{"title":"Convert columns into rows with Pandas","slug":"convert-columns-into-rows-with-pandas-1657388374964"},{"title":"How to reshape data from long to wide format","slug":"how-to-reshape-data-from-long-to-wide-format-1657384486421"},{"title":"Javascript infamous Loop issue? [duplicate]","slug":"javascript-infamous-loop-issue-duplicate-1657387498530"},{"title":"Randomize a List<T>","slug":"randomize-a-listlesstgreater-1657388172793"},{"title":"What is the difference between \"INNER JOIN\" and \"OUTER JOIN\"?","slug":"what-is-the-difference-between-\"inner-join\"-and-\"outer-join\"-1657387501982"},{"title":"Why is using the JavaScript eval function a bad idea?","slug":"why-is-using-the-javascript-eval-function-a-bad-idea-1657387485165"},{"title":"How do I set, clear, and toggle a single bit?","slug":"how-do-i-set-clear-and-toggle-a-single-bit-1657388227052"},{"title":"How do I detect collision in pygame?","slug":"how-do-i-detect-collision-in-pygame-1657387496338"},{"title":"How can I combine two strings together in PHP?","slug":"how-can-i-combine-two-strings-together-in-php-1657388279401"},{"title":"What is object slicing?","slug":"what-is-object-slicing-1657384506425"},{"title":"Sending Email in Android using JavaMail API without using the default/built-in app","slug":"sending-email-in-android-using-javamail-api-without-using-the-defaultbuilt-in-app-1657387883400"},{"title":"How do I detect a click outside an element?","slug":"how-do-i-detect-a-click-outside-an-element-1657387505351"},{"title":"What's the meaning of \"=>\" (an arrow formed from equals & greater than) in JavaScript?","slug":"what's-the-meaning-of-\"greater\"-(an-arrow-formed-from-equals-and-greater-than)-in-javascript-1657387977118"},{"title":"How to close/hide the Android soft keyboard programmatically?","slug":"how-to-closehide-the-android-soft-keyboard-programmatically-1657388217420"},{"title":"How do I determine the correct path for FXML files, CSS files, Images, and other resources needed by my JavaFX Application?","slug":"how-do-i-determine-the-correct-path-for-fxml-files-css-files-images-and-other-resources-needed-by-my-javafx-application-1657388143988"},{"title":"What does \"list comprehension\" and similar mean? How does it work and how can I use it?","slug":"what-does-\"list-comprehension\"-and-similar-mean-how-does-it-work-and-how-can-i-use-it-1657387996940"},{"title":"Detecting a mobile browser","slug":"detecting-a-mobile-browser-1657388460071"}]},"__N_SSG":true}