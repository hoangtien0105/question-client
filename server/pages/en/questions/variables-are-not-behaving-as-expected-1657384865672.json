{"pageProps":{"data":{"answer":["\n\n&lt;p&gt;You are not the first, who fell into the famous &quot;delayed expansion trap&quot; (and you won&apos;t be the last).&lt;/p&gt;\n&lt;p&gt;You need delayed expansion if you want to use a variable, that you changed in the same block (a block is a series of commands within parentheses &lt;code&gt;(&lt;/code&gt;and &lt;code&gt;)&lt;/code&gt;).&lt;/p&gt;\n&lt;p&gt;Delayed variables are referenced with &lt;code&gt;!var!&lt;/code&gt; instead of &lt;code&gt;%var%&lt;/code&gt;.&lt;/p&gt;\n&lt;p&gt;Reason is the way, &lt;code&gt;cmd&lt;/code&gt; parses the code. A complete line or block is parsed at once, replacing normal variables with their value at parse time. Delayed variables are evaluated at runtime.&lt;/p&gt;\n&lt;p&gt;Two simple batch files to demonstrate:&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-csharp&quot;&gt;setlocal EnableDelayedExpansion\n&lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var=hello&quot;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;==&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; (\n    &lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var=world&quot;&lt;/span&gt;\n    echo %&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt;% !&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt;!\n)\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-lua&quot;&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;setlocal&lt;/span&gt; EnableDelayedExpansion\n&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; /L %%i &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; (&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt; (\n    echo %&lt;span class=&quot;hljs-built_in&quot;&gt;random&lt;/span&gt;% !&lt;span class=&quot;hljs-built_in&quot;&gt;random&lt;/span&gt;!\n)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;em&gt;Note&lt;/em&gt;: A line is also treated as a block:&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-bash&quot;&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var=old&quot;&lt;/span&gt;\n&lt;span class=&quot;hljs-built_in&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var=new&quot;&lt;/span&gt; &amp;amp; &lt;span class=&quot;hljs-built_in&quot;&gt;echo&lt;/span&gt; %var% \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;With delayed expansion:&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-bash&quot;&gt;setlocal EnableDelayedExpansion\n&lt;span class=&quot;hljs-built_in&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var=old&quot;&lt;/span&gt;\n&lt;span class=&quot;hljs-built_in&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var=new&quot;&lt;/span&gt; &amp;amp; &lt;span class=&quot;hljs-built_in&quot;&gt;echo&lt;/span&gt; !var! \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Delayed expansion is per default turned off at the command prompt. If you really need it, you can do:&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-csharp&quot;&gt;cmd /V:ON /C &lt;span class=&quot;hljs-string&quot;&gt;&quot;set &quot;&lt;/span&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt;=hello&lt;span class=&quot;hljs-string&quot;&gt;&quot; &amp;amp; echo !var!&quot;&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Also there is a way to do the same without delayed expansion (but &lt;code&gt;call&lt;/code&gt; costs some time, so it&apos;s slower, but if for some reason you can&apos;t / don&apos;t want to use delayed expansion, it&apos;s an alternative):&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-lua&quot;&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;setlocal&lt;/span&gt; DISabledelayedexpansion\n&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; /L %%i &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; (&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt; (\n    call echo %&lt;span class=&quot;hljs-built_in&quot;&gt;random&lt;/span&gt;% %%&lt;span class=&quot;hljs-built_in&quot;&gt;random&lt;/span&gt;%% \n)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Both methods can also be used to display &lt;a href=&quot;https://stackoverflow.com/a/10167990&quot;&gt;array-like variables&lt;/a&gt;:&lt;/p&gt;\n&lt;p&gt;(This is often asked like &quot;variable which contains another variable&quot; or &quot;nested variables&quot;)&lt;/p&gt;\n&lt;p&gt;Here is a collection for using such array-like variables in different situations:&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;With delayed expansion:&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-dart&quot;&gt;setlocal ENableDelayedExpansion\n&lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;num=4&quot;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&quot;var[%num%]=HELLO&quot;&lt;/span&gt;\necho plain delayed: !&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt;[%&lt;span class=&quot;hljs-built_in&quot;&gt;num&lt;/span&gt;%]!\n&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; /L %%i &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; (&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;do&lt;/span&gt; (\n    echo &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; delayed: !&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt;[%%i]!\n    &lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; a=%%i\n    call echo &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; delayed &lt;span class=&quot;hljs-keyword&quot;&gt;with&lt;/span&gt; variable: %%&lt;span class=&quot;hljs-keyword&quot;&gt;var&lt;/span&gt;[!a!]%%\n)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;without delayed expansion:&lt;/strong&gt;&lt;/p&gt;\n&lt;pre class=&quot;lang-bat s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;setlocal DISableDelayedExpansion\n&lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &quot;num=4&quot;\n&lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &quot;var[%num%]=HELLO&quot;\n&lt;span class=&quot;hljs-keyword&quot;&gt;call&lt;/span&gt; echo plain &lt;span class=&quot;hljs-keyword&quot;&gt;called&lt;/span&gt;: &lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;var[&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;num&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;]&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;L &lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;i &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; (&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;) do (\n    &lt;span class=&quot;hljs-keyword&quot;&gt;call&lt;/span&gt; echo &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;called&lt;/span&gt;: &lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;var[&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;i]&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; a&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;i\n    &lt;span class=&quot;hljs-keyword&quot;&gt;call&lt;/span&gt; echo &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;called&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;with&lt;/span&gt; variable: &lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;var[&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;a&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;]&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;%&lt;/span&gt;\n)\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;strong&gt;Note&lt;/strong&gt;: &lt;code&gt;setlocal&lt;/code&gt; has no effect outside of batchfiles, so &lt;code&gt;delayedexpansion&lt;/code&gt; works only:&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;In batch files&lt;/li&gt;\n&lt;li&gt;When the cmd was started with delayed expansion enabled (&lt;code&gt;cmd /V:ON&lt;/code&gt;) (by default, the cmd runs with delayed expansion &lt;strong&gt;dis&lt;/strong&gt;abled)&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;(Follow the links, when you are interested in the &lt;a href=&quot;http://blogs.msdn.com/b/oldnewthing/archive/2006/08/23/714650.aspx&quot; rel=&quot;nofollow noreferrer&quot;&gt;technical background&lt;/a&gt; or even the &lt;a href=&quot;http://stackoverflow.com/q/4094699/2152082&quot;&gt;advanced technical stuff&lt;/a&gt;)&lt;/p&gt;\n    "],"id":176,"title":"Variables are not behaving as expected","content":"\n                \n&lt;p&gt;I&apos;ve been wrestling trying to get the syntax right on this batch file and I cannot figure out why some things aren&apos;t working.&lt;/p&gt;\n\n&lt;ol&gt;\n&lt;li&gt;The variable &lt;code&gt;i&lt;/code&gt; is not getting incremented each time I do it.&lt;/li&gt;\n&lt;li&gt;Concatenation on &lt;code&gt;strc&lt;/code&gt; doesn&apos;t seem to concatenate.&lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;p&gt;Here is my code:&lt;/p&gt;\n\n&lt;pre&gt;&lt;code&gt;set i=0\nset &quot;strc=concat:&quot;\n\nfor %%f in (*.mp4) do (\n    set /a i+=1\n    set &quot;str=intermediate%i%.ts&quot;\n\n    set strc=&quot;%strc% %str%|&quot;\n\n    ffmpeg -i &quot;%%f&quot; -c copy -bsf:v h264_mp4toannexb -f mpegts &quot;%str%&quot;\n)\n\nset strc=&quot;%strc:-1%&quot;\nffmpeg -i &quot;%strc%&quot; -c copy -bsf:a aac_adtstoasc Output.mp4\n&lt;/code&gt;&lt;/pre&gt;\n    ","slug":"variables-are-not-behaving-as-expected-1657384865672","postType":"QUESTION","createdAt":"2022-07-09T16:41:05.000Z","updatedAt":"2022-07-09T16:41:05.000Z","tags":[{"id":646,"name":"windows","slug":"windows","createdAt":"2022-07-09T16:41:05.000Z","updatedAt":"2022-07-09T16:41:05.000Z","Questions_Tags":{"questionId":176,"tagId":646}},{"id":647,"name":"batch-file","slug":"batch-file","createdAt":"2022-07-09T16:41:05.000Z","updatedAt":"2022-07-09T16:41:05.000Z","Questions_Tags":{"questionId":176,"tagId":647}},{"id":648,"name":"cmd","slug":"cmd","createdAt":"2022-07-09T16:41:05.000Z","updatedAt":"2022-07-09T16:41:05.000Z","Questions_Tags":{"questionId":176,"tagId":648}},{"id":649,"name":"environment-variables","slug":"environment-variables","createdAt":"2022-07-09T16:41:05.000Z","updatedAt":"2022-07-09T16:41:05.000Z","Questions_Tags":{"questionId":176,"tagId":649}},{"id":650,"name":"delayedvariableexpansion","slug":"delayedvariableexpansion","createdAt":"2022-07-09T16:41:05.000Z","updatedAt":"2022-07-09T16:41:05.000Z","Questions_Tags":{"questionId":176,"tagId":650}}],"relatedQuestions":[{"title":"Variables are not behaving as expected","slug":"variables-are-not-behaving-as-expected-1657384865672","tags":[{"name":"windows","Questions_Tags":{"questionId":176,"tagId":646}},{"name":"batch-file","Questions_Tags":{"questionId":176,"tagId":647}},{"name":"cmd","Questions_Tags":{"questionId":176,"tagId":648}},{"name":"environment-variables","Questions_Tags":{"questionId":176,"tagId":649}},{"name":"delayedvariableexpansion","Questions_Tags":{"questionId":176,"tagId":650}}]}]},"randomQuestions":[{"title":"What is the best regular expression to check if a string is a valid URL?","slug":"what-is-the-best-regular-expression-to-check-if-a-string-is-a-valid-url-1657387618306"},{"title":"How do I access previous promise results in a .then() chain?","slug":"how-do-i-access-previous-promise-results-in-a-.then()-chain-1657387705386"},{"title":"Error in finding last used cell in Excel with VBA","slug":"error-in-finding-last-used-cell-in-excel-with-vba-1657384584748"},{"title":"Captured variable in a loop in C#","slug":"captured-variable-in-a-loop-in-c-1657387696779"},{"title":"How can I validate an email address using a regular expression?","slug":"how-can-i-validate-an-email-address-using-a-regular-expression-1657384549233"},{"title":"Which equals operator (== vs ===) should be used in JavaScript comparisons?","slug":"which-equals-operator-(-vs-)-should-be-used-in-javascript-comparisons-1657384663105"},{"title":"What is an IndexOutOfRangeException / ArgumentOutOfRangeException and how do I fix it?","slug":"what-is-an-indexoutofrangeexception-argumentoutofrangeexception-and-how-do-i-fix-it-1657384697159"},{"title":"How can I tell if a DOM element is visible in the current viewport?","slug":"how-can-i-tell-if-a-dom-element-is-visible-in-the-current-viewport-1657388316510"},{"title":"What and where are the stack and heap?","slug":"what-and-where-are-the-stack-and-heap-1657387415361"},{"title":"How do I merge two dictionaries in a single expression?","slug":"how-do-i-merge-two-dictionaries-in-a-single-expression-1657387593160"},{"title":"Why is \"using namespace std;\" considered bad practice?","slug":"why-is-\"using-namespace-std\"-considered-bad-practice-1657384296377"},{"title":"How do JavaScript closures work?","slug":"how-do-javascript-closures-work-1657384418555"},{"title":"How does Access-Control-Allow-Origin header work?","slug":"how-does-access-control-allow-origin-header-work-1657384881723"},{"title":"Why not use Double or Float to represent currency?","slug":"why-not-use-double-or-float-to-represent-currency-1657387417964"},{"title":"How to add JTable in JPanel with null layout?","slug":"how-to-add-jtable-in-jpanel-with-null-layout-1657384590912"},{"title":"How to store objects in HTML5 localStorage","slug":"how-to-store-objects-in-html5-localstorage-1657387568907"},{"title":"How do I vertically center text with CSS? [duplicate]","slug":"how-do-i-vertically-center-text-with-css-duplicate-1657387645821"},{"title":"How can I upload files to a server using JSP/Servlet?","slug":"how-can-i-upload-files-to-a-server-using-jspservlet-1657384847658"},{"title":"Returning data from async call in Swift function","slug":"returning-data-from-async-call-in-swift-function-1657387469218"},{"title":"How to affect other elements when one element is hovered","slug":"how-to-affect-other-elements-when-one-element-is-hovered-1657387832363"}]},"__N_SSG":true}