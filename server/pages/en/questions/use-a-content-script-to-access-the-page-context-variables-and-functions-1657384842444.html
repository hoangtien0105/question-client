<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find the solution to any question. We focus on finding the fastest possible solution for users. Main topics like coding, learning. - solutionschecker.com"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><link name="keywords" content="google-chrome-extension,youtube-api,content-script,solutions checker, solution checker, how to, solution for, check for solution, resolve question, what is, what solution for, find solution"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://solutionschecker.com","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@id":"https://solutionschecker.com/questions","name":"Questions"}},{"@type":"ListItem","position":3,"item":{"@id":"https://solutionschecker.com/questions/use-a-content-script-to-access-the-page-context-variables-and-functions-1657384842444","name":"Questions"}}]}</script><title>Use a content script to access the page context variables and functions | Solution Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="I&#x27;m learning how to create Chrome extensions. I just started developing one to catch YouTube events. I want to use it with YouTube flash player (later I will try to make it compatible with HTML5).

manifest.json:

{
    &quot;name&quot;: &quot;MyExtension&quot;,
    &quot;version&quot;: &quot;1.0&quot;,
    &quot;description&quot;: &quot;Gotta catch Youtube events!&quot;,
    &quot;permissions&quot;: [&quot;tabs&quot;, &quot;http://*/*&quot;],
    &quot;content_scripts&quot; : [{
        &quot;matches&quot; : [ &quot;www.youtube.com/*&quot;],
        &quot;js&quot; : [&quot;myScript.js&quot;]
    }]
}


myScript.js:

function state() { console.log(&quot;State Changed!&quot;); }
var player = document.getElementById(&quot;movie_player&quot;);
player.addEventListener(&quot;onStateChange&quot;, &quot;state&quot;);
console.log(&quot;Started!&quot;);


The problem is that the console gives me the &quot;Started!&quot;, but there is no &quot;State Changed!&quot; when I play/pause YouTube videos.

When this code is put in the console, it worked. What am I doing wrong?
    "/><meta property="og:title" content="Use a content script to access the page context variables and functions | Solution Checker"/><meta property="og:description" content="I&#x27;m learning how to create Chrome extensions. I just started developing one to catch YouTube events. I want to use it with YouTube flash player (later I will try to make it compatible with HTML5).

manifest.json:

{
    &quot;name&quot;: &quot;MyExtension&quot;,
    &quot;version&quot;: &quot;1.0&quot;,
    &quot;description&quot;: &quot;Gotta catch Youtube events!&quot;,
    &quot;permissions&quot;: [&quot;tabs&quot;, &quot;http://*/*&quot;],
    &quot;content_scripts&quot; : [{
        &quot;matches&quot; : [ &quot;www.youtube.com/*&quot;],
        &quot;js&quot; : [&quot;myScript.js&quot;]
    }]
}


myScript.js:

function state() { console.log(&quot;State Changed!&quot;); }
var player = document.getElementById(&quot;movie_player&quot;);
player.addEventListener(&quot;onStateChange&quot;, &quot;state&quot;);
console.log(&quot;Started!&quot;);


The problem is that the console gives me the &quot;Started!&quot;, but there is no &quot;State Changed!&quot; when I play/pause YouTube videos.

When this code is put in the console, it worked. What am I doing wrong?
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"Use a content script to access the page context variables and functions","text":"I&apos;m learning how to create Chrome extensions. I just started developing one to catch YouTube events. I want to use it with YouTube flash player (later I will try to make it compatible with HTML5).\n\nmanifest.json:\n\n{\n    &quot;name&quot;: &quot;MyExtension&quot;,\n    &quot;version&quot;: &quot;1.0&quot;,\n    &quot;description&quot;: &quot;Gotta catch Youtube events!&quot;,\n    &quot;permissions&quot;: [&quot;tabs&quot;, &quot;http://*/*&quot;],\n    &quot;content_scripts&quot; : [{\n        &quot;matches&quot; : [ &quot;www.youtube.com/*&quot;],\n        &quot;js&quot; : [&quot;myScript.js&quot;]\n    }]\n}\n\n\nmyScript.js:\n\nfunction state() { console.log(&quot;State Changed!&quot;); }\nvar player = document.getElementById(&quot;movie_player&quot;);\nplayer.addEventListener(&quot;onStateChange&quot;, &quot;state&quot;);\nconsole.log(&quot;Started!&quot;);\n\n\nThe problem is that the console gives me the &quot;Started!&quot;, but there is no &quot;State Changed!&quot; when I play/pause YouTube videos.\n\nWhen this code is put in the console, it worked. What am I doing wrong?\n    ","answerCount":6,"upVoteCount":500,"suggestedAnswer":[{"text":"Underlying cause:\nContent scripts are executed in an &quot;isolated world&quot; environment.\nSolution:\nInject the code into the page using DOM - that code will be able to access functions/variables of the page context (&quot;main world&quot;) or expose functions/variables to the page context (in your case it&apos;s the state() method).\n\nNote in case communication with the page script is needed:\nUse DOM CustomEvent handler. Examples: one, two, and three.\n\nNote in case chrome API is needed in the page script:\nSince chrome.* APIs can&apos;t be used in the page script, you have to use them in the content script and send the results to the page script via DOM messaging (see the note above).\n\n\nSafety warning:\nA page may redefine or augment/hook a built-in prototype so your exposed code may fail if the page did it in an incompatible fashion. If you want to make sure your exposed code runs in a safe environment then you should either a) declare your content script with &quot;run_at&quot;: &quot;document_start&quot; and use Methods 2-3 not 1, or b) extract the original native built-ins via an empty iframe, example. Note that with document_start you may need to use DOMContentLoaded event inside the exposed code to wait for DOM.\nTable of contents\n\nMethod 1: Inject another file - ManifestV3 compatible\nMethod 2: Inject embedded code\nMethod 2b: Using a function\nMethod 3: Using an inline event - ManifestV3 compatible\nMethod 4: Using executeScript&apos;s world - ManifestV3 only\nDynamic values in the injected code\n\nMethod 1: Inject another file - ManifestV3 compatible\nParticularly good when you have lots of code. Put the code in a file within your extension, say script.js. Then load it in your content script like this:\nvar s = document.createElement(&apos;script&apos;);\ns.src = chrome.runtime.getURL(&apos;script.js&apos;);\ns.onload = function() {\n    this.remove();\n};\n(document.head || document.documentElement).appendChild(s);\n\nThe js file must be exposed in web_accessible_resources:\n\nmanifest.json example for ManifestV2\n&quot;web_accessible_resources&quot;: [&quot;script.js&quot;],\n\n\nmanifest.json example for ManifestV3\n&quot;web_accessible_resources&quot;: [{\n  &quot;resources&quot;: [&quot;script.js&quot;],\n  &quot;matches&quot;: [&quot;&lt;all_urls&gt;&quot;]\n}]\n\n\n\nIf not, the following error will appear in the console:\n\nDenying load of chrome-extension://[EXTENSIONID]/script.js. Resources must be listed in the web_accessible_resources manifest key in order to be loaded by pages outside the extension.\n\nMethod 2: Inject embedded code\nThis method is useful when you want to quickly run a small piece of code. (See also: How to disable facebook hotkeys with Chrome extension?).\nvar actualCode = `// Code here.\n// If you want to use a variable, use $ and curly braces.\n// For example, to use a fixed random number:\nvar someFixedRandomValue = ${ Math.random() };\n// NOTE: Do not insert unsafe variables in this way, see below\n// at &quot;Dynamic values in the injected code&quot;\n`;\n\nvar script = document.createElement(&apos;script&apos;);\nscript.textContent = actualCode;\n(document.head||document.documentElement).appendChild(script);\nscript.remove();\n\nNote: template literals are only supported in Chrome 41 and above. If you want the extension to work in Chrome 40-, use:\nvar actualCode = [&apos;/* Code here. Example: */&apos; + &apos;alert(0);&apos;,\n                  &apos;// Beware! This array have to be joined&apos;,\n                  &apos;// using a newline. Otherwise, missing semicolons&apos;,\n                  &apos;// or single-line comments (//) will mess up your&apos;,\n                  &apos;// code -----&gt;&apos;].join(&apos;\\n&apos;);\n\nMethod 2b: Using a function\nFor a big chunk of code, quoting the string is not feasible. Instead of using an array, a function can be used, and stringified:\nvar actualCode = &apos;(&apos; + function() {\n    // All code is executed in a local scope.\n    // For example, the following does NOT overwrite the global `alert` method\n    var alert = null;\n    // To overwrite a global variable, prefix `window`:\n    window.alert = null;\n} + &apos;)();&apos;;\nvar script = document.createElement(&apos;script&apos;);\nscript.textContent = actualCode;\n(document.head||document.documentElement).appendChild(script);\nscript.remove();\n\nThis method works, because the + operator on strings and a function converts all objects to a string. If you intend on using the code more than once, it&apos;s wise to create a function to avoid code repetition. An implementation might look like:\nfunction injectScript(func) {\n    var actualCode = &apos;(&apos; + func + &apos;)();&apos;\n    ...\n}\ninjectScript(function() {\n   alert(&quot;Injected script&quot;);\n});\n\nNote: Since the function is serialized, the original scope, and all bound properties are lost!\nvar scriptToInject = function() {\n    console.log(typeof scriptToInject);\n};\ninjectScript(scriptToInject);\n// Console output:  &quot;undefined&quot;\n\nMethod 3: Using an inline event - ManifestV3 compatible\nSometimes, you want to run some code immediately, e.g. to run some code before the &lt;head&gt; element is created. This can be done by inserting a &lt;script&gt; tag with textContent (see method 2/2b).\nAn alternative, but not recommended is to use inline events. It is not recommended because if the page defines a Content Security policy that forbids inline scripts, then inline event listeners are blocked. Inline scripts injected by the extension, on the other hand, still run.\nIf you still want to use inline events, this is how:\nvar actualCode = &apos;// Some code example \\n&apos; + \n                 &apos;console.log(document.documentElement.outerHTML);&apos;;\n\ndocument.documentElement.setAttribute(&apos;onreset&apos;, actualCode);\ndocument.documentElement.dispatchEvent(new CustomEvent(&apos;reset&apos;));\ndocument.documentElement.removeAttribute(&apos;onreset&apos;);\n\nNote: This method assumes that there are no other global event listeners that handle the reset event. If there is, you can also pick one of the other global events. Just open the JavaScript console (F12), type document.documentElement.on, and pick on of the available events.\nMethod 4: Using executeScript&apos;s world - ManifestV3 only\nIn Chrome 95 or newer use chrome.scripting.executeScript with world: &apos;MAIN&apos; in your extension script like the background script or the popup script, but not in the content script.\nSee the documentation and examples.\nDynamic values in the injected code\nOccasionally, you need to pass an arbitrary variable to the injected function. For example:\nvar GREETING = &quot;Hi, I&apos;m &quot;;\nvar NAME = &quot;Rob&quot;;\nvar scriptToInject = function() {\n    alert(GREETING + NAME);\n};\n\nTo inject this code, you need to pass the variables as arguments to the anonymous function. Be sure to implement it correctly! The following will not work:\nvar scriptToInject = function (GREETING, NAME) { ... };\nvar actualCode = &apos;(&apos; + scriptToInject + &apos;)(&apos; + GREETING + &apos;,&apos; + NAME + &apos;)&apos;;\n// The previous will work for numbers and booleans, but not strings.\n// To see why, have a look at the resulting string:\nvar actualCode = &quot;(function(GREETING, NAME) {...})(Hi, I&apos;m ,Rob)&quot;;\n//                                                 ^^^^^^^^ ^^^ No string literals!\n\nThe solution is to use JSON.stringify before passing the argument. Example:\nvar actualCode = &apos;(&apos; + function(greeting, name) { ...\n} + &apos;)(&apos; + JSON.stringify(GREETING) + &apos;,&apos; + JSON.stringify(NAME) + &apos;)&apos;;\n\nIf you have many variables, it&apos;s worthwhile to use JSON.stringify once, to improve readability, as follows:\n...\n} + &apos;)(&apos; + JSON.stringify([arg1, arg2, arg3, arg4]) + &apos;)&apos;;\n\n    ","url":"/questions/[slug]#solution1","@type":"Answer","upvoteCount":0},{"text":"The only thing missing hidden from Rob W&apos;s excellent answer is how to communicate between the injected page script and the content script.\n\nOn the receiving side (either your content script or the injected page script) add an event listener:\n\ndocument.addEventListener(&apos;yourCustomEvent&apos;, function (e) {\n  var data = e.detail;\n  console.log(&apos;received&apos;, data);\n});\n\n\nOn the initiator side (content script or injected page script) send the event:\n\nvar data = {\n  allowedTypes: &apos;those supported by structured cloning, see the list below&apos;,\n  inShort: &apos;no DOM elements or classes/functions&apos;,\n};\n\ndocument.dispatchEvent(new CustomEvent(&apos;yourCustomEvent&apos;, { detail: data }));\n\n\nNotes:\n\n\nDOM messaging uses structured cloning algorithm, which can transfer only some types of data in addition to primitive values. It can&apos;t send class instances or functions or DOM elements.\nIn Firefox, to send an object (i.e. not a primitive value) from the content script to the page context you have to explicitly clone it into the target using cloneInto (a built-in function), otherwise it&apos;ll fail with a security violation error.\n\ndocument.dispatchEvent(new CustomEvent(&apos;yourCustomEvent&apos;, {\n  detail: cloneInto(data, document.defaultView),\n}));\n\n\n    ","url":"/questions/[slug]#solution2","@type":"Answer","upvoteCount":0},{"text":"I&apos;ve also faced the problem of ordering of loaded scripts, which was solved through sequential loading of scripts. The loading is based on Rob W&apos;s answer.\n\nfunction scriptFromFile(file) {\n    var script = document.createElement(&quot;script&quot;);\n    script.src = chrome.extension.getURL(file);\n    return script;\n}\n\nfunction scriptFromSource(source) {\n    var script = document.createElement(&quot;script&quot;);\n    script.textContent = source;\n    return script;\n}\n\nfunction inject(scripts) {\n    if (scripts.length === 0)\n        return;\n    var otherScripts = scripts.slice(1);\n    var script = scripts[0];\n    var onload = function() {\n        script.parentNode.removeChild(script);\n        inject(otherScripts);\n    };\n    if (script.src != &quot;&quot;) {\n        script.onload = onload;\n        document.head.appendChild(script);\n    } else {\n        document.head.appendChild(script);\n        onload();\n    }\n}\n\n\nThe example of usage would be:\n\nvar formulaImageUrl = chrome.extension.getURL(&quot;formula.png&quot;);\nvar codeImageUrl = chrome.extension.getURL(&quot;code.png&quot;);\n\ninject([\n    scriptFromSource(&quot;var formulaImageUrl = &apos;&quot; + formulaImageUrl + &quot;&apos;;&quot;),\n    scriptFromSource(&quot;var codeImageUrl = &apos;&quot; + codeImageUrl + &quot;&apos;;&quot;),\n    scriptFromFile(&quot;EqEditor/eq_editor-lite-17.js&quot;),\n    scriptFromFile(&quot;EqEditor/eq_config.js&quot;),\n    scriptFromFile(&quot;highlight/highlight.pack.js&quot;),\n    scriptFromFile(&quot;injected.js&quot;)\n]);\n\n\nActually, I&apos;m kinda new to JS, so feel free to ping me to the better ways.\n    ","url":"/questions/[slug]#solution3","@type":"Answer","upvoteCount":0},{"text":"in Content script , i add script tag to the head which binds a &apos;onmessage&apos; handler, inside the handler i use , eval to execute code.\nIn booth content script i use onmessage handler as well , so i get two way communication. \nChrome Docs\n\n//Content Script\n\nvar pmsgUrl = chrome.extension.getURL(&apos;pmListener.js&apos;);\n$(&quot;head&quot;).first().append(&quot;&lt;script src=&apos;&quot;+pmsgUrl+&quot;&apos; type=&apos;text/javascript&apos;&gt;&lt;/script&gt;&quot;);\n\n\n//Listening to messages from DOM\nwindow.addEventListener(&quot;message&quot;, function(event) {\n  console.log(&apos;CS :: message in from DOM&apos;, event);\n  if(event.data.hasOwnProperty(&apos;cmdClient&apos;)) {\n    var obj = JSON.parse(event.data.cmdClient);\n    DoSomthingInContentScript(obj);\n }\n});\n\n\npmListener.js is a post message url listener \n\n//pmListener.js\n\n//Listen to messages from Content Script and Execute Them\nwindow.addEventListener(&quot;message&quot;, function (msg) {\n  console.log(&quot;im in REAL DOM&quot;);\n  if (msg.data.cmnd) {\n    eval(msg.data.cmnd);\n  }\n});\n\nconsole.log(&quot;injected To Real Dom&quot;);\n\n\nThis way , I can have 2 way communication between CS to Real Dom.\nIts very usefull for example if you need to listen webscoket events ,\nor to any in memory variables or events.\n    ","url":"/questions/[slug]#solution4","@type":"Answer","upvoteCount":0},{"text":"You can use a utility function I&apos;ve created for the purpose of running code in the page context and getting back the returned value.\n\nThis is done by serializing a function to a string and injecting it to the web page.\n\nThe utility is available here on GitHub.\n\nUsage examples -\n\n\n\n// Some code that exists only in the page context -\nwindow.someProperty = &apos;property&apos;;\nfunction someFunction(name = &apos;test&apos;) {\n    return new Promise(res =&gt; setTimeout(()=&gt;res(&apos;resolved &apos; + name), 1200));\n}\n/////////////////\n\n// Content script examples -\n\nawait runInPageContext(() =&gt; someProperty); // returns &apos;property&apos;\n\nawait runInPageContext(() =&gt; someFunction()); // returns &apos;resolved test&apos;\n\nawait runInPageContext(async (name) =&gt; someFunction(name), &apos;with name&apos; ); // &apos;resolved with name&apos;\n\nawait runInPageContext(async (...args) =&gt; someFunction(...args), &apos;with spread operator and rest parameters&apos; ); // returns &apos;resolved with spread operator and rest parameters&apos;\n\nawait runInPageContext({\n    func: (name) =&gt; someFunction(name),\n    args: [&apos;with params object&apos;],\n    doc: document,\n    timeout: 10000\n} ); // returns &apos;resolved with params object&apos;\n\n\n\n    ","url":"/questions/[slug]#solution5","@type":"Answer","upvoteCount":0},{"text":"If you wish to inject pure function, instead of text, you can use this method:\n\n\n\nfunction inject(){\n    document.body.style.backgroundColor = &apos;blue&apos;;\n}\n\n// this includes the function as text and the barentheses make it run itself.\nvar actualCode = &quot;(&quot;+inject+&quot;)()&quot;; \n\ndocument.documentElement.setAttribute(&apos;onreset&apos;, actualCode);\ndocument.documentElement.dispatchEvent(new CustomEvent(&apos;reset&apos;));\ndocument.documentElement.removeAttribute(&apos;onreset&apos;);\n Run code snippetHide resultsExpand snippet\n\n\n\nAnd you can pass parameters (unfortunatelly no objects and arrays can be stringifyed) to the functions. Add it into the baretheses, like so:\n\n\n\nfunction inject(color){\n    document.body.style.backgroundColor = color;\n}\n\n// this includes the function as text and the barentheses make it run itself.\nvar color = &apos;yellow&apos;;\nvar actualCode = &quot;(&quot;+inject+&quot;)(&quot;+color+&quot;)&quot;; \n Run code snippetHide resultsExpand snippet\n\n\n    ","url":"/questions/[slug]#solution6","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="22"/><link rel="preload" href="/_next/static/css/c116652e2d6f4ad0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c116652e2d6f4ad0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-ccfab947c79712f4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c0d2dcb5e85faf18.js" defer=""></script><script src="/_next/static/chunks/294-106ef8570fa99deb.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-50e201fdaa1e0fd1.js" defer=""></script><script src="/_next/static/DSpI0pSdXueTMCIVyw0q4/_buildManifest.js" defer=""></script><script src="/_next/static/DSpI0pSdXueTMCIVyw0q4/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h1 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h1></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/use-a-content-script-to-access-the-page-context-variables-and-functions-1657384842444#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/use-a-content-script-to-access-the-page-context-variables-and-functions-1657384842444"><h1>Use a content script to access the page context variables and functions</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/google-chrome-extension">google-chrome-extension</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/youtube-api">youtube-api</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/content-script">content-script</a></div></div><div class="question-content mt-5">
                
<p>I'm learning how to create Chrome extensions. I just started developing one to catch YouTube events. I want to use it with YouTube flash player (later I will try to make it compatible with HTML5).</p>

<p><strong>manifest.json:</strong></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">{
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"MyExtension"</span>,
    <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0"</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"Gotta catch Youtube events!"</span>,
    <span class="hljs-string">"permissions"</span>: [<span class="hljs-string">"tabs"</span>, <span class="hljs-string">"http://*/*"</span>],
    <span class="hljs-string">"content_scripts"</span> : [{
        <span class="hljs-string">"matches"</span> : [ <span class="hljs-string">"www.youtube.com/*"</span>],
        <span class="hljs-string">"js"</span> : [<span class="hljs-string">"myScript.js"</span>]
    }]
}
</code></pre>

<p><strong>myScript.js:</strong></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">state</span>(<span class="hljs-params"></span>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"State Changed!"</span>); }
<span class="hljs-keyword">var</span> player = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"movie_player"</span>);
player.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"onStateChange"</span>, <span class="hljs-string">"state"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Started!"</span>);
</code></pre>

<p>The problem is that the console gives me the <em>"Started!"</em>, but there is no <em>"State Changed!"</em> when I play/pause YouTube videos.</p>

<p>When this code is put in the console, it worked. What am I doing wrong?</p>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><h1 class="text-lg font-semibold mb-5">Navigate to solutions: </h1><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li><li class="pagination-solution-item"><span data-id="#solution3" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">3</span></li><li class="pagination-solution-item"><span data-id="#solution4" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">4</span></li><li class="pagination-solution-item"><span data-id="#solution5" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">5</span></li><li class="pagination-solution-item"><span data-id="#solution6" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">6</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 1</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/google-chrome-extension">google-chrome-extension</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/youtube-api">youtube-api</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/content-script">content-script</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><strong>Underlying cause:</strong><br>
Content scripts are executed in an <a href="https://developer.chrome.com/extensions/content_scripts#isolated_world" rel="noreferrer">"isolated world"</a> environment.</p>
<p><strong>Solution:</strong><br>
Inject the code into the page using DOM - that code will be able to <em>access</em> functions/variables of the page context ("main world") or <em>expose</em> functions/variables to the page context (in your case it's the <code>state()</code> method).</p>
<ul>
<li><p><strong>Note in case communication with the page script is needed:</strong><br>
Use DOM <code>CustomEvent</code> handler. Examples: <a href="https://stackoverflow.com/a/9636008">one</a>, <a href="https://stackoverflow.com/a/19312198/">two</a>, and <a href="/a/46870005">three</a>.</p>
</li>
<li><p><strong>Note in case <code>chrome</code> API is needed in the page script:</strong><br>
Since <code>chrome.*</code> APIs can't be used in the page script, you have to use them in the content script and send the results to the page script via DOM messaging (see the note above).</p>
</li>
</ul>
<p><strong>Safety warning</strong>:<br>
A page may redefine or augment/hook a built-in prototype so your exposed code may fail if the page did it in an incompatible fashion. If you want to make sure your exposed code runs in a safe environment then you should either a) declare your content script with <a href="https://developer.chrome.com/extensions/content_scripts#run_time" rel="noreferrer">"run_at": "document_start"</a> and use Methods 2-3 not 1, or b) extract the original native built-ins via an empty iframe, <a href="https://stackoverflow.com/questions/13990187/create-a-reset-of-javascript-array-prototype-when-array-prototype-has-been-modif">example</a>. Note that with <code>document_start</code> you may need to use <code>DOMContentLoaded</code> event inside the exposed code to wait for DOM.</p>
<h1>Table of contents</h1>
<ul>
<li>Method 1: Inject another file - ManifestV3 compatible</li>
<li>Method 2: Inject embedded code</li>
<li>Method 2b: Using a function</li>
<li>Method 3: Using an inline event - ManifestV3 compatible</li>
<li>Method 4: Using executeScript's world - ManifestV3 only</li>
<li>Dynamic values in the injected code</li>
</ul>
<h2>Method 1: Inject another file - ManifestV3 compatible</h2>
<p>Particularly good when you have lots of code. Put the code in a file within your extension, say <code>script.js</code>. Then load it in your <a href="https://stackoverflow.com/a/9310273">content script</a> like this:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> s = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
s.<span class="hljs-property">src</span> = chrome.<span class="hljs-property">runtime</span>.<span class="hljs-title function_">getURL</span>(<span class="hljs-string">'script.js'</span>);
s.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">remove</span>();
};
(<span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>).<span class="hljs-title function_">appendChild</span>(s);
</code></pre>
<p><strong>The js file must be exposed in <a href="https://developer.chrome.com/extensions/manifest/web_accessible_resources.html" rel="noreferrer"><code>web_accessible_resources</code></a></strong>:</p>
<ul>
<li><p>manifest.json example for ManifestV2</p>
<pre class="lang-json s-code-block"><code class="hljs language-json"><span class="hljs-attr">"web_accessible_resources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"script.js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
</code></pre>
</li>
<li><p>manifest.json example for ManifestV3</p>
<pre class="lang-json s-code-block"><code class="hljs language-json"><span class="hljs-attr">"web_accessible_resources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"resources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"script.js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"matches"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"&lt;all_urls&gt;"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
</code></pre>
</li>
</ul>
<p>If not, the following error will appear in the console:</p>
<blockquote>
<p>Denying load of chrome-extension://[EXTENSIONID]/script.js. Resources must be listed in the web_accessible_resources manifest key in order to be loaded by pages outside the extension.</p>
</blockquote>
<h2>Method 2: Inject embedded code</h2>
<p>This method is useful when you want to quickly run a small piece of code. (See also: <a href="https://stackoverflow.com/a/8994454/938089?how-to-disable-facebook-hotkeys-with-chrome-extension">How to disable facebook hotkeys with Chrome extension?</a>).</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> actualCode = <span class="hljs-string">`// Code here.
// If you want to use a variable, use $ and curly braces.
// For example, to use a fixed random number:
var someFixedRandomValue = <span class="hljs-subst">${ <span class="hljs-built_in">Math</span>.random() }</span>;
// NOTE: Do not insert unsafe variables in this way, see below
// at "Dynamic values in the injected code"
`</span>;

<span class="hljs-keyword">var</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
script.<span class="hljs-property">textContent</span> = actualCode;
(<span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>||<span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>).<span class="hljs-title function_">appendChild</span>(script);
script.<span class="hljs-title function_">remove</span>();
</code></pre>
<p>Note: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals" rel="noreferrer">template literals</a> are only supported in Chrome 41 and above. If you want the extension to work in Chrome 40-, use:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> actualCode = [<span class="hljs-string">'/* Code here. Example: */'</span> + <span class="hljs-string">'alert(0);'</span>,
                  <span class="hljs-string">'// Beware! This array have to be joined'</span>,
                  <span class="hljs-string">'// using a newline. Otherwise, missing semicolons'</span>,
                  <span class="hljs-string">'// or single-line comments (//) will mess up your'</span>,
                  <span class="hljs-string">'// code -----&gt;'</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>);
</code></pre>
<h2>Method 2b: Using a function</h2>
<p>For a big chunk of code, quoting the string is not feasible. Instead of using an array, a function can be used, and stringified:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> actualCode = <span class="hljs-string">'('</span> + <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
    <span class="hljs-comment">// All code is executed in a local scope.</span>
    <span class="hljs-comment">// For example, the following does NOT overwrite the global `alert` method</span>
    <span class="hljs-keyword">var</span> alert = <span class="hljs-literal">null</span>;
    <span class="hljs-comment">// To overwrite a global variable, prefix `window`:</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">alert</span> = <span class="hljs-literal">null</span>;
} + <span class="hljs-string">')();'</span>;
<span class="hljs-keyword">var</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
script.<span class="hljs-property">textContent</span> = actualCode;
(<span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>||<span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>).<span class="hljs-title function_">appendChild</span>(script);
script.<span class="hljs-title function_">remove</span>();
</code></pre>
<p>This method works, because the <code>+</code> operator on strings and a function converts all objects to a string. If you intend on using the code more than once, it's wise to create a function to avoid code repetition. An implementation might look like:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">injectScript</span>(<span class="hljs-params">func</span>) {
    <span class="hljs-keyword">var</span> actualCode = <span class="hljs-string">'('</span> + func + <span class="hljs-string">')();'</span>
    ...
}
<span class="hljs-title function_">injectScript</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
   <span class="hljs-title function_">alert</span>(<span class="hljs-string">"Injected script"</span>);
});
</code></pre>
<p>Note: Since the function is serialized, the original scope, and all bound properties are lost!</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> scriptToInject = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> scriptToInject);
};
<span class="hljs-title function_">injectScript</span>(scriptToInject);
<span class="hljs-comment">// Console output:  "undefined"</span>
</code></pre>
<h2>Method 3: Using an inline event - ManifestV3 compatible</h2>
<p>Sometimes, you want to run some code immediately, e.g. to run some code before the <code>&lt;head&gt;</code> element is created. This can be done by inserting a <code>&lt;script&gt;</code> tag with <code>textContent</code> (see method 2/2b).</p>
<p>An alternative, <strong>but not recommended</strong> is to use inline events. It is not recommended because if the page defines a Content Security policy that forbids inline scripts, then inline event listeners are blocked. Inline scripts injected by the extension, on the other hand, still run.
If you still want to use inline events, this is how:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> actualCode = <span class="hljs-string">'// Some code example \n'</span> + 
                 <span class="hljs-string">'console.log(document.documentElement.outerHTML);'</span>;

<span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'onreset'</span>, actualCode);
<span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'reset'</span>));
<span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">removeAttribute</span>(<span class="hljs-string">'onreset'</span>);
</code></pre>
<p>Note: This method assumes that there are no other global event listeners that handle the <code>reset</code> event. If there is, you can also pick one of the other global events. Just open the JavaScript console (F12), type <code>document.documentElement.on</code>, and pick on of the available events.</p>
<h2>Method 4: Using executeScript's world - ManifestV3 only</h2>
<p>In Chrome 95 or newer use <code>chrome.scripting.executeScript</code> with <code>world: 'MAIN'</code> in your extension script like the background script or the popup script, but not in the content script.<br>
See the <a href="https://developer.chrome.com/docs/extensions/reference/scripting/" rel="noreferrer">documentation</a> and <a href="https://stackoverflow.com/search?q=%5Bgoogle-chrome-extension%5D%20chrome.scripting.executeScript%20world%20MAIN%20is%3Aanswer">examples</a>.</p>
<h2>Dynamic values in the injected code</h2>
<p>Occasionally, you need to pass an arbitrary variable to the injected function. For example:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> <span class="hljs-variable constant_">GREETING</span> = <span class="hljs-string">"Hi, I'm "</span>;
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">NAME</span> = <span class="hljs-string">"Rob"</span>;
<span class="hljs-keyword">var</span> scriptToInject = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
    <span class="hljs-title function_">alert</span>(<span class="hljs-variable constant_">GREETING</span> + <span class="hljs-variable constant_">NAME</span>);
};
</code></pre>
<p>To inject this code, you need to pass the variables as arguments to the anonymous function. Be sure to implement it correctly! The following will <strong>not</strong> work:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> scriptToInject = <span class="hljs-keyword">function</span> (<span class="hljs-params">GREETING, NAME</span>) { ... };
<span class="hljs-keyword">var</span> actualCode = <span class="hljs-string">'('</span> + scriptToInject + <span class="hljs-string">')('</span> + <span class="hljs-variable constant_">GREETING</span> + <span class="hljs-string">','</span> + <span class="hljs-variable constant_">NAME</span> + <span class="hljs-string">')'</span>;
<span class="hljs-comment">// The previous will work for numbers and booleans, but not strings.</span>
<span class="hljs-comment">// To see why, have a look at the resulting string:</span>
<span class="hljs-keyword">var</span> actualCode = <span class="hljs-string">"(function(GREETING, NAME) {...})(Hi, I'm ,Rob)"</span>;
<span class="hljs-comment">//                                                 ^^^^^^^^ ^^^ No string literals!</span>
</code></pre>
<p>The solution is to use <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/JSON/stringify" rel="noreferrer"><code>JSON.stringify</code></a> before passing the argument. Example:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> actualCode = <span class="hljs-string">'('</span> + <span class="hljs-keyword">function</span>(<span class="hljs-params">greeting, name</span>) { ...
} + <span class="hljs-string">')('</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable constant_">GREETING</span>) + <span class="hljs-string">','</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable constant_">NAME</span>) + <span class="hljs-string">')'</span>;
</code></pre>
<p>If you have many variables, it's worthwhile to use <code>JSON.stringify</code> once, to improve readability, as follows:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">...
} + <span class="hljs-string">')('</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>([arg1, arg2, arg3, arg4]) + <span class="hljs-string">')'</span>;
</code></pre>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 2</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/google-chrome-extension">google-chrome-extension</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/youtube-api">youtube-api</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/content-script">content-script</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The only thing <del>missing</del> hidden from Rob W's excellent answer is how to communicate between the injected page script and the content script.</p>

<p>On the receiving side (either your content script or the injected page script) add an event listener:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'yourCustomEvent'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
  <span class="hljs-keyword">var</span> data = e.<span class="hljs-property">detail</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'received'</span>, data);
});
</code></pre>

<p>On the initiator side (content script or injected page script) send the event:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> data = {
  <span class="hljs-attr">allowedTypes</span>: <span class="hljs-string">'those supported by structured cloning, see the list below'</span>,
  <span class="hljs-attr">inShort</span>: <span class="hljs-string">'no DOM elements or classes/functions'</span>,
};

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'yourCustomEvent'</span>, { <span class="hljs-attr">detail</span>: data }));
</code></pre>

<p>Notes:</p>

<ul>
<li>DOM messaging uses structured cloning algorithm, which can transfer only <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm" rel="noreferrer">some types of data</a> in addition to primitive values. It can't send class instances or functions or DOM elements.</li>
<li><p>In Firefox, to send an object (i.e. not a primitive value) from the content script to the page context you have to explicitly clone it into the target using <code>cloneInto</code> (a built-in function), otherwise it'll fail with a security violation error.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'yourCustomEvent'</span>, {
  <span class="hljs-attr">detail</span>: <span class="hljs-title function_">cloneInto</span>(data, <span class="hljs-variable language_">document</span>.<span class="hljs-property">defaultView</span>),
}));
</code></pre></li>
</ul>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 3</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/google-chrome-extension">google-chrome-extension</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/youtube-api">youtube-api</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/content-script">content-script</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I've also faced the problem of ordering of loaded scripts, which was solved through sequential loading of scripts. The loading is based on <a href="https://stackoverflow.com/a/9517879/1828937">Rob W's answer</a>.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">scriptFromFile</span>(<span class="hljs-params">file</span>) {
    <span class="hljs-keyword">var</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"script"</span>);
    script.<span class="hljs-property">src</span> = chrome.<span class="hljs-property">extension</span>.<span class="hljs-title function_">getURL</span>(file);
    <span class="hljs-keyword">return</span> script;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">scriptFromSource</span>(<span class="hljs-params">source</span>) {
    <span class="hljs-keyword">var</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"script"</span>);
    script.<span class="hljs-property">textContent</span> = source;
    <span class="hljs-keyword">return</span> script;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">inject</span>(<span class="hljs-params">scripts</span>) {
    <span class="hljs-keyword">if</span> (scripts.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>)
        <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">var</span> otherScripts = scripts.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>);
    <span class="hljs-keyword">var</span> script = scripts[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">var</span> onload = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
        script.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">removeChild</span>(script);
        <span class="hljs-title function_">inject</span>(otherScripts);
    };
    <span class="hljs-keyword">if</span> (script.<span class="hljs-property">src</span> != <span class="hljs-string">""</span>) {
        script.<span class="hljs-property">onload</span> = onload;
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(script);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(script);
        <span class="hljs-title function_">onload</span>();
    }
}
</code></pre>

<p>The example of usage would be:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> formulaImageUrl = chrome.<span class="hljs-property">extension</span>.<span class="hljs-title function_">getURL</span>(<span class="hljs-string">"formula.png"</span>);
<span class="hljs-keyword">var</span> codeImageUrl = chrome.<span class="hljs-property">extension</span>.<span class="hljs-title function_">getURL</span>(<span class="hljs-string">"code.png"</span>);

<span class="hljs-title function_">inject</span>([
    <span class="hljs-title function_">scriptFromSource</span>(<span class="hljs-string">"var formulaImageUrl = '"</span> + formulaImageUrl + <span class="hljs-string">"';"</span>),
    <span class="hljs-title function_">scriptFromSource</span>(<span class="hljs-string">"var codeImageUrl = '"</span> + codeImageUrl + <span class="hljs-string">"';"</span>),
    <span class="hljs-title function_">scriptFromFile</span>(<span class="hljs-string">"EqEditor/eq_editor-lite-17.js"</span>),
    <span class="hljs-title function_">scriptFromFile</span>(<span class="hljs-string">"EqEditor/eq_config.js"</span>),
    <span class="hljs-title function_">scriptFromFile</span>(<span class="hljs-string">"highlight/highlight.pack.js"</span>),
    <span class="hljs-title function_">scriptFromFile</span>(<span class="hljs-string">"injected.js"</span>)
]);
</code></pre>

<p>Actually, I'm kinda new to JS, so feel free to ping me to the better ways.</p>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 4</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/google-chrome-extension">google-chrome-extension</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/youtube-api">youtube-api</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/content-script">content-script</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>in Content script , i add script tag to the head which binds a 'onmessage' handler, inside the handler i use , eval to execute code.
In booth content script i use onmessage handler as well , so i get two way communication. 
<a href="https://developer.chrome.com/extensions/content_scripts#host-page-communication" rel="noreferrer" title="Official Docs">Chrome Docs</a></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">//Content Script</span>

<span class="hljs-keyword">var</span> pmsgUrl = chrome.<span class="hljs-property">extension</span>.<span class="hljs-title function_">getURL</span>(<span class="hljs-string">'pmListener.js'</span>);
$(<span class="hljs-string">"head"</span>).<span class="hljs-title function_">first</span>().<span class="hljs-title function_">append</span>(<span class="hljs-string">"&lt;script src='"</span>+pmsgUrl+<span class="hljs-string">"' type='text/javascript'&gt;&lt;/script&gt;"</span>);


<span class="hljs-comment">//Listening to messages from DOM</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"message"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'CS :: message in from DOM'</span>, event);
  <span class="hljs-keyword">if</span>(event.<span class="hljs-property">data</span>.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'cmdClient'</span>)) {
    <span class="hljs-keyword">var</span> obj = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>.<span class="hljs-property">cmdClient</span>);
    <span class="hljs-title class_">DoSomthingInContentScript</span>(obj);
 }
});
</code></pre>

<p>pmListener.js is a post message url listener </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">//pmListener.js</span>

<span class="hljs-comment">//Listen to messages from Content Script and Execute Them</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"message"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">msg</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"im in REAL DOM"</span>);
  <span class="hljs-keyword">if</span> (msg.<span class="hljs-property">data</span>.<span class="hljs-property">cmnd</span>) {
    <span class="hljs-built_in">eval</span>(msg.<span class="hljs-property">data</span>.<span class="hljs-property">cmnd</span>);
  }
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"injected To Real Dom"</span>);
</code></pre>

<p>This way , I can have 2 way communication between CS to Real Dom.
Its very usefull for example if you need to listen webscoket events ,
or to any in memory variables or events.</p>
    </div></div></div></div><div id="solution5" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 5</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/google-chrome-extension">google-chrome-extension</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/youtube-api">youtube-api</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/content-script">content-script</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You can use a utility function I've created for the purpose of running code in the page context and getting back the returned value.</p>

<p>This is done by serializing a function to a string and injecting it to the web page.</p>

<p>The utility is <a href="https://github.com/arikw/extension-page-context" rel="noreferrer">available here on GitHub</a>.</p>

<p>Usage examples -</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">

<span class="hljs-comment">// Some code that exists only in the page context -</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">someProperty</span> = <span class="hljs-string">'property'</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">someFunction</span>(<span class="hljs-params">name = <span class="hljs-string">'test'</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span><span class="hljs-title function_">res</span>(<span class="hljs-string">'resolved '</span> + name), <span class="hljs-number">1200</span>));
}
<span class="hljs-comment">/////////////////</span>

<span class="hljs-comment">// Content script examples -</span>

<span class="hljs-keyword">await</span> <span class="hljs-title function_">runInPageContext</span>(<span class="hljs-function">() =&gt;</span> someProperty); <span class="hljs-comment">// returns 'property'</span>

<span class="hljs-keyword">await</span> <span class="hljs-title function_">runInPageContext</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">someFunction</span>()); <span class="hljs-comment">// returns 'resolved test'</span>

<span class="hljs-keyword">await</span> <span class="hljs-title function_">runInPageContext</span>(<span class="hljs-keyword">async</span> (name) =&gt; <span class="hljs-title function_">someFunction</span>(name), <span class="hljs-string">'with name'</span> ); <span class="hljs-comment">// 'resolved with name'</span>

<span class="hljs-keyword">await</span> <span class="hljs-title function_">runInPageContext</span>(<span class="hljs-keyword">async</span> (...args) =&gt; <span class="hljs-title function_">someFunction</span>(...args), <span class="hljs-string">'with spread operator and rest parameters'</span> ); <span class="hljs-comment">// returns 'resolved with spread operator and rest parameters'</span>

<span class="hljs-keyword">await</span> <span class="hljs-title function_">runInPageContext</span>({
    <span class="hljs-attr">func</span>: <span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> <span class="hljs-title function_">someFunction</span>(name),
    <span class="hljs-attr">args</span>: [<span class="hljs-string">'with params object'</span>],
    <span class="hljs-attr">doc</span>: <span class="hljs-variable language_">document</span>,
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>
} ); <span class="hljs-comment">// returns 'resolved with params object'</span>


</code></pre>
    </div></div></div></div><div id="solution6" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 6</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/google-chrome-extension">google-chrome-extension</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/youtube-api">youtube-api</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/content-script">content-script</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If you wish to inject pure function, instead of text, you can use this method:</p>

<p></p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
<div class="snippet-code">
<pre class="snippet-code-html lang-html s-code-block"><code class="hljs language-xml">function inject(){
    document.body.style.backgroundColor = 'blue';
}

// this includes the function as text and the barentheses make it run itself.
var actualCode = "("+inject+")()"; 

document.documentElement.setAttribute('onreset', actualCode);
document.documentElement.dispatchEvent(new CustomEvent('reset'));
document.documentElement.removeAttribute('onreset');</code></pre>
<div class="snippet-result"><div class="snippet-ctas"><button type="button" class="s-btn s-btn__primary"><span class="icon-play-white _hover"></span><span> Run code snippet</span></button><input class="copySnippet s-btn s-btn__filled" type="button" value="Copy snippet to answer" style="display: none;"><button type="button" class="s-btn hideResults" style="display: none;">Hide results</button><div class="popout-code"><a class="snippet-expand-link">Expand snippet</a></div></div><div class="snippet-result-code" style="display: none;"><iframe name="sif1" sandbox="allow-forms allow-modals allow-scripts" class="snippet-box-edit snippet-box-result" frameborder="0"></iframe></div></div></div>
</div>
<p></p>

<p>And you can pass parameters (unfortunatelly no objects and arrays can be stringifyed) to the functions. Add it into the baretheses, like so:</p>

<p></p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
<div class="snippet-code">
<pre class="snippet-code-html lang-html s-code-block"><code class="hljs language-xml">function inject(color){
    document.body.style.backgroundColor = color;
}

// this includes the function as text and the barentheses make it run itself.
var color = 'yellow';
var actualCode = "("+inject+")("+color+")"; </code></pre>
<div class="snippet-result"><div class="snippet-ctas"><button type="button" class="s-btn s-btn__primary"><span class="icon-play-white _hover"></span><span> Run code snippet</span></button><input class="copySnippet s-btn s-btn__filled" type="button" value="Copy snippet to answer" style="display: none;"><button type="button" class="s-btn hideResults" style="display: none;">Hide results</button><div class="popout-code"><a class="snippet-expand-link">Expand snippet</a></div></div><div class="snippet-result-code" style="display: none;"><iframe name="sif2" sandbox="allow-forms allow-modals allow-scripts" class="snippet-box-edit snippet-box-result" frameborder="0"></iframe></div></div></div>
</div>
<p></p>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/does-python-have-a-ternary-conditional-operator-1657387555448">Does Python have a ternary conditional operator?</a><a href="/questions/using-global-variables-in-a-function-1657384796002">Using global variables in a function</a><a href="/questions/how-to-count-the-number-of-set-bits-in-a-32-bit-integer-1657388437370">How to count the number of set bits in a 32-bit integer?</a><a href="/questions/how-can-i-remove-a-specific-item-from-an-array-1657387552077">How can I remove a specific item from an array?</a><a href="/questions/what-are-good-ways-to-prevent-sql-injection-duplicate-1657388431570">What are good ways to prevent SQL injection? [duplicate]</a><a href="/questions/int-division:-why-is-the-result-of-13-0-1657387547814">Int division: Why is the result of 1/3 == 0?</a><a href="/questions/add-a-property-to-a-javascript-object-using-a-variable-as-the-name-1657388425650">Add a property to a JavaScript object using a variable as the name?</a><a href="/questions/alternatives-to-gprof-closed-1657388336554">Alternatives to gprof [closed]</a><a href="/questions/official-locator-strategies-for-the-webdriver-1657384353174">Official locator strategies for the webdriver</a><a href="/questions/disable-same-origin-policy-in-chrome-1657387743804">Disable same origin policy in Chrome</a><a href="/questions/how-to-deal-with-mysqli-problems-mysqli_fetch_array():-argument-1-must-be-of-type-mysqli_result-1657384360922">How to deal with mysqli problems? mysqli_fetch_array(): Argument #1 must be of type mysqli_result</a><a href="/questions/how-to-read-a-file-line-by-line-into-a-list-1657387865894">How to read a file line-by-line into a list?</a><a href="/questions/when-to-use-linkedlist-over-arraylist-in-java-1657388107480">When to use LinkedList over ArrayList in Java?</a><a href="/questions/how-to-remove-%22noise%22-from-gccclang-assembly-output-1657387612391">How to remove &quot;noise&quot; from GCC/clang assembly output?</a><a href="/questions/use-dynamic-variable-names-in-javascript-1657388468075">Use dynamic variable names in JavaScript</a><a href="/questions/can-php-pdo-statements-accept-the-table-or-column-name-as-parameter-1657387478588">Can PHP PDO Statements accept the table or column name as parameter?</a><a href="/questions/transpose-reshape-dataframe-without-%22timevar%22-from-long-to-wide-format-1657388213347">Transpose / reshape dataframe without &quot;timevar&quot; from long to wide format</a><a href="/questions/jstl-in-jsf2-facelets...-makes-sense-1657387667435">JSTL in JSF2 Facelets... makes sense?</a><a href="/questions/input()-error-nameerror:-name-&#x27;...&#x27;-is-not-defined-1657388497243">input() error - NameError: name &#x27;...&#x27; is not defined</a><a href="/questions/how-do-i-return-the-response-from-an-observablehttpasync-call-in-angular-1657387335024">How do I return the response from an Observable/http/async call in angular?</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Underlying cause:\u0026lt;/strong\u0026gt;\u0026lt;br\u0026gt;\nContent scripts are executed in an \u0026lt;a href=\u0026quot;https://developer.chrome.com/extensions/content_scripts#isolated_world\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026quot;isolated world\u0026quot;\u0026lt;/a\u0026gt; environment.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Solution:\u0026lt;/strong\u0026gt;\u0026lt;br\u0026gt;\nInject the code into the page using DOM - that code will be able to \u0026lt;em\u0026gt;access\u0026lt;/em\u0026gt; functions/variables of the page context (\u0026quot;main world\u0026quot;) or \u0026lt;em\u0026gt;expose\u0026lt;/em\u0026gt; functions/variables to the page context (in your case it\u0026apos;s the \u0026lt;code\u0026gt;state()\u0026lt;/code\u0026gt; method).\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Note in case communication with the page script is needed:\u0026lt;/strong\u0026gt;\u0026lt;br\u0026gt;\nUse DOM \u0026lt;code\u0026gt;CustomEvent\u0026lt;/code\u0026gt; handler. Examples: \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/9636008\u0026quot;\u0026gt;one\u0026lt;/a\u0026gt;, \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/19312198/\u0026quot;\u0026gt;two\u0026lt;/a\u0026gt;, and \u0026lt;a href=\u0026quot;/a/46870005\u0026quot;\u0026gt;three\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Note in case \u0026lt;code\u0026gt;chrome\u0026lt;/code\u0026gt; API is needed in the page script:\u0026lt;/strong\u0026gt;\u0026lt;br\u0026gt;\nSince \u0026lt;code\u0026gt;chrome.*\u0026lt;/code\u0026gt; APIs can\u0026apos;t be used in the page script, you have to use them in the content script and send the results to the page script via DOM messaging (see the note above).\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Safety warning\u0026lt;/strong\u0026gt;:\u0026lt;br\u0026gt;\nA page may redefine or augment/hook a built-in prototype so your exposed code may fail if the page did it in an incompatible fashion. If you want to make sure your exposed code runs in a safe environment then you should either a) declare your content script with \u0026lt;a href=\u0026quot;https://developer.chrome.com/extensions/content_scripts#run_time\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026quot;run_at\u0026quot;: \u0026quot;document_start\u0026quot;\u0026lt;/a\u0026gt; and use Methods 2-3 not 1, or b) extract the original native built-ins via an empty iframe, \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/13990187/create-a-reset-of-javascript-array-prototype-when-array-prototype-has-been-modif\u0026quot;\u0026gt;example\u0026lt;/a\u0026gt;. Note that with \u0026lt;code\u0026gt;document_start\u0026lt;/code\u0026gt; you may need to use \u0026lt;code\u0026gt;DOMContentLoaded\u0026lt;/code\u0026gt; event inside the exposed code to wait for DOM.\u0026lt;/p\u0026gt;\n\u0026lt;h1\u0026gt;Table of contents\u0026lt;/h1\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Method 1: Inject another file - ManifestV3 compatible\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Method 2: Inject embedded code\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Method 2b: Using a function\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Method 3: Using an inline event - ManifestV3 compatible\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Method 4: Using executeScript\u0026apos;s world - ManifestV3 only\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Dynamic values in the injected code\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;h2\u0026gt;Method 1: Inject another file - ManifestV3 compatible\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;Particularly good when you have lots of code. Put the code in a file within your extension, say \u0026lt;code\u0026gt;script.js\u0026lt;/code\u0026gt;. Then load it in your \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/9310273\u0026quot;\u0026gt;content script\u0026lt;/a\u0026gt; like this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; s = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;createElement\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;script\u0026apos;\u0026lt;/span\u0026gt;);\ns.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;src\u0026lt;/span\u0026gt; = chrome.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;runtime\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getURL\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;script.js\u0026apos;\u0026lt;/span\u0026gt;);\ns.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;onload\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;remove\u0026lt;/span\u0026gt;();\n};\n(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;head\u0026lt;/span\u0026gt; || \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;documentElement\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;appendChild\u0026lt;/span\u0026gt;(s);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;The js file must be exposed in \u0026lt;a href=\u0026quot;https://developer.chrome.com/extensions/manifest/web_accessible_resources.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;web_accessible_resources\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;manifest.json example for ManifestV2\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-json s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-json\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;\u0026quot;web_accessible_resources\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;[\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;script.js\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;]\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;,\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;manifest.json example for ManifestV3\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-json s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-json\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;\u0026quot;web_accessible_resources\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;[\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;{\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;\u0026quot;resources\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;[\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;script.js\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;]\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;,\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;\u0026quot;matches\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;[\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026amp;lt;all_urls\u0026amp;gt;\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;]\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;}\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;]\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;p\u0026gt;If not, the following error will appear in the console:\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;Denying load of chrome-extension://[EXTENSIONID]/script.js. Resources must be listed in the web_accessible_resources manifest key in order to be loaded by pages outside the extension.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;h2\u0026gt;Method 2: Inject embedded code\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;This method is useful when you want to quickly run a small piece of code. (See also: \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/8994454/938089?how-to-disable-facebook-hotkeys-with-chrome-extension\u0026quot;\u0026gt;How to disable facebook hotkeys with Chrome extension?\u0026lt;/a\u0026gt;).\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; actualCode = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`// Code here.\n// If you want to use a variable, use $ and curly braces.\n// For example, to use a fixed random number:\nvar someFixedRandomValue = \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${ \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.random() }\u0026lt;/span\u0026gt;;\n// NOTE: Do not insert unsafe variables in this way, see below\n// at \u0026quot;Dynamic values in the injected code\u0026quot;\n`\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; script = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;createElement\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;script\u0026apos;\u0026lt;/span\u0026gt;);\nscript.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;textContent\u0026lt;/span\u0026gt; = actualCode;\n(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;head\u0026lt;/span\u0026gt;||\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;documentElement\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;appendChild\u0026lt;/span\u0026gt;(script);\nscript.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;remove\u0026lt;/span\u0026gt;();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Note: \u0026lt;a href=\u0026quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;template literals\u0026lt;/a\u0026gt; are only supported in Chrome 41 and above. If you want the extension to work in Chrome 40-, use:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; actualCode = [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/* Code here. Example: */\u0026apos;\u0026lt;/span\u0026gt; + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;alert(0);\u0026apos;\u0026lt;/span\u0026gt;,\n                  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;// Beware! This array have to be joined\u0026apos;\u0026lt;/span\u0026gt;,\n                  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;// using a newline. Otherwise, missing semicolons\u0026apos;\u0026lt;/span\u0026gt;,\n                  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;// or single-line comments (//) will mess up your\u0026apos;\u0026lt;/span\u0026gt;,\n                  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;// code -----\u0026amp;gt;\u0026apos;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\\n\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;h2\u0026gt;Method 2b: Using a function\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;For a big chunk of code, quoting the string is not feasible. Instead of using an array, a function can be used, and stringified:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; actualCode = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;(\u0026apos;\u0026lt;/span\u0026gt; + \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// All code is executed in a local scope.\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// For example, the following does NOT overwrite the global `alert` method\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; alert = \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// To overwrite a global variable, prefix `window`:\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;window\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;alert\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;;\n} + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)();\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; script = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;createElement\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;script\u0026apos;\u0026lt;/span\u0026gt;);\nscript.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;textContent\u0026lt;/span\u0026gt; = actualCode;\n(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;head\u0026lt;/span\u0026gt;||\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;documentElement\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;appendChild\u0026lt;/span\u0026gt;(script);\nscript.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;remove\u0026lt;/span\u0026gt;();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;This method works, because the \u0026lt;code\u0026gt;+\u0026lt;/code\u0026gt; operator on strings and a function converts all objects to a string. If you intend on using the code more than once, it\u0026apos;s wise to create a function to avoid code repetition. An implementation might look like:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;injectScript\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;func\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; actualCode = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;(\u0026apos;\u0026lt;/span\u0026gt; + func + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)();\u0026apos;\u0026lt;/span\u0026gt;\n    ...\n}\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;injectScript\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n   \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;alert\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Injected script\u0026quot;\u0026lt;/span\u0026gt;);\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Note: Since the function is serialized, the original scope, and all bound properties are lost!\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; scriptToInject = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;typeof\u0026lt;/span\u0026gt; scriptToInject);\n};\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;injectScript\u0026lt;/span\u0026gt;(scriptToInject);\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Console output:  \u0026quot;undefined\u0026quot;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;h2\u0026gt;Method 3: Using an inline event - ManifestV3 compatible\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;Sometimes, you want to run some code immediately, e.g. to run some code before the \u0026lt;code\u0026gt;\u0026amp;lt;head\u0026amp;gt;\u0026lt;/code\u0026gt; element is created. This can be done by inserting a \u0026lt;code\u0026gt;\u0026amp;lt;script\u0026amp;gt;\u0026lt;/code\u0026gt; tag with \u0026lt;code\u0026gt;textContent\u0026lt;/code\u0026gt; (see method 2/2b).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;An alternative, \u0026lt;strong\u0026gt;but not recommended\u0026lt;/strong\u0026gt; is to use inline events. It is not recommended because if the page defines a Content Security policy that forbids inline scripts, then inline event listeners are blocked. Inline scripts injected by the extension, on the other hand, still run.\nIf you still want to use inline events, this is how:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; actualCode = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;// Some code example \\n\u0026apos;\u0026lt;/span\u0026gt; + \n                 \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;console.log(document.documentElement.outerHTML);\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;documentElement\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;setAttribute\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;onreset\u0026apos;\u0026lt;/span\u0026gt;, actualCode);\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;documentElement\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;dispatchEvent\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;CustomEvent\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;reset\u0026apos;\u0026lt;/span\u0026gt;));\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;documentElement\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;removeAttribute\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;onreset\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Note: This method assumes that there are no other global event listeners that handle the \u0026lt;code\u0026gt;reset\u0026lt;/code\u0026gt; event. If there is, you can also pick one of the other global events. Just open the JavaScript console (F12), type \u0026lt;code\u0026gt;document.documentElement.on\u0026lt;/code\u0026gt;, and pick on of the available events.\u0026lt;/p\u0026gt;\n\u0026lt;h2\u0026gt;Method 4: Using executeScript\u0026apos;s world - ManifestV3 only\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;In Chrome 95 or newer use \u0026lt;code\u0026gt;chrome.scripting.executeScript\u0026lt;/code\u0026gt; with \u0026lt;code\u0026gt;world: \u0026apos;MAIN\u0026apos;\u0026lt;/code\u0026gt; in your extension script like the background script or the popup script, but not in the content script.\u0026lt;br\u0026gt;\nSee the \u0026lt;a href=\u0026quot;https://developer.chrome.com/docs/extensions/reference/scripting/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;documentation\u0026lt;/a\u0026gt; and \u0026lt;a href=\u0026quot;https://stackoverflow.com/search?q=%5Bgoogle-chrome-extension%5D%20chrome.scripting.executeScript%20world%20MAIN%20is%3Aanswer\u0026quot;\u0026gt;examples\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;h2\u0026gt;Dynamic values in the injected code\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;Occasionally, you need to pass an arbitrary variable to the injected function. For example:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;GREETING\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Hi, I\u0026apos;m \u0026quot;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;NAME\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Rob\u0026quot;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; scriptToInject = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;alert\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;GREETING\u0026lt;/span\u0026gt; + \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;NAME\u0026lt;/span\u0026gt;);\n};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;To inject this code, you need to pass the variables as arguments to the anonymous function. Be sure to implement it correctly! The following will \u0026lt;strong\u0026gt;not\u0026lt;/strong\u0026gt; work:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; scriptToInject = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;GREETING, NAME\u0026lt;/span\u0026gt;) { ... };\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; actualCode = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;(\u0026apos;\u0026lt;/span\u0026gt; + scriptToInject + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)(\u0026apos;\u0026lt;/span\u0026gt; + \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;GREETING\u0026lt;/span\u0026gt; + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt; + \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;NAME\u0026lt;/span\u0026gt; + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// The previous will work for numbers and booleans, but not strings.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// To see why, have a look at the resulting string:\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; actualCode = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;(function(GREETING, NAME) {...})(Hi, I\u0026apos;m ,Rob)\u0026quot;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//                                                 ^^^^^^^^ ^^^ No string literals!\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;The solution is to use \u0026lt;a href=\u0026quot;https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/JSON/stringify\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;JSON.stringify\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; before passing the argument. Example:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; actualCode = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;(\u0026apos;\u0026lt;/span\u0026gt; + \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;greeting, name\u0026lt;/span\u0026gt;) { ...\n} + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)(\u0026apos;\u0026lt;/span\u0026gt; + \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;JSON\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;stringify\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;GREETING\u0026lt;/span\u0026gt;) + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt; + \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;JSON\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;stringify\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;NAME\u0026lt;/span\u0026gt;) + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;If you have many variables, it\u0026apos;s worthwhile to use \u0026lt;code\u0026gt;JSON.stringify\u0026lt;/code\u0026gt; once, to improve readability, as follows:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;...\n} + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)(\u0026apos;\u0026lt;/span\u0026gt; + \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;JSON\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;stringify\u0026lt;/span\u0026gt;([arg1, arg2, arg3, arg4]) + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The only thing \u0026lt;del\u0026gt;missing\u0026lt;/del\u0026gt; hidden from Rob W\u0026apos;s excellent answer is how to communicate between the injected page script and the content script.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;On the receiving side (either your content script or the injected page script) add an event listener:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;addEventListener\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;yourCustomEvent\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;e\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; data = e.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;detail\u0026lt;/span\u0026gt;;\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;received\u0026apos;\u0026lt;/span\u0026gt;, data);\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;On the initiator side (content script or injected page script) send the event:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; data = {\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;allowedTypes\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;those supported by structured cloning, see the list below\u0026apos;\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;inShort\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;no DOM elements or classes/functions\u0026apos;\u0026lt;/span\u0026gt;,\n};\n\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;dispatchEvent\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;CustomEvent\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;yourCustomEvent\u0026apos;\u0026lt;/span\u0026gt;, { \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;detail\u0026lt;/span\u0026gt;: data }));\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Notes:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;DOM messaging uses structured cloning algorithm, which can transfer only \u0026lt;a href=\u0026quot;https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;some types of data\u0026lt;/a\u0026gt; in addition to primitive values. It can\u0026apos;t send class instances or functions or DOM elements.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;In Firefox, to send an object (i.e. not a primitive value) from the content script to the page context you have to explicitly clone it into the target using \u0026lt;code\u0026gt;cloneInto\u0026lt;/code\u0026gt; (a built-in function), otherwise it\u0026apos;ll fail with a security violation error.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;dispatchEvent\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;CustomEvent\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;yourCustomEvent\u0026apos;\u0026lt;/span\u0026gt;, {\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;detail\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cloneInto\u0026lt;/span\u0026gt;(data, \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;defaultView\u0026lt;/span\u0026gt;),\n}));\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I\u0026apos;ve also faced the problem of ordering of loaded scripts, which was solved through sequential loading of scripts. The loading is based on \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/9517879/1828937\u0026quot;\u0026gt;Rob W\u0026apos;s answer\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;scriptFromFile\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; script = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;createElement\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;script\u0026quot;\u0026lt;/span\u0026gt;);\n    script.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;src\u0026lt;/span\u0026gt; = chrome.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;extension\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getURL\u0026lt;/span\u0026gt;(file);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; script;\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;scriptFromSource\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;source\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; script = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;createElement\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;script\u0026quot;\u0026lt;/span\u0026gt;);\n    script.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;textContent\u0026lt;/span\u0026gt; = source;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; script;\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;inject\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;scripts\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (scripts.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt; === \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; otherScripts = scripts.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;slice\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; script = scripts[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;];\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; onload = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n        script.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;parentNode\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;removeChild\u0026lt;/span\u0026gt;(script);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;inject\u0026lt;/span\u0026gt;(otherScripts);\n    };\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (script.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;src\u0026lt;/span\u0026gt; != \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026quot;\u0026lt;/span\u0026gt;) {\n        script.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;onload\u0026lt;/span\u0026gt; = onload;\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;head\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;appendChild\u0026lt;/span\u0026gt;(script);\n    } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;head\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;appendChild\u0026lt;/span\u0026gt;(script);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;onload\u0026lt;/span\u0026gt;();\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;The example of usage would be:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; formulaImageUrl = chrome.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;extension\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getURL\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;formula.png\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; codeImageUrl = chrome.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;extension\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getURL\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;code.png\u0026quot;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;inject\u0026lt;/span\u0026gt;([\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;scriptFromSource\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;var formulaImageUrl = \u0026apos;\u0026quot;\u0026lt;/span\u0026gt; + formulaImageUrl + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026apos;;\u0026quot;\u0026lt;/span\u0026gt;),\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;scriptFromSource\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;var codeImageUrl = \u0026apos;\u0026quot;\u0026lt;/span\u0026gt; + codeImageUrl + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026apos;;\u0026quot;\u0026lt;/span\u0026gt;),\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;scriptFromFile\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;EqEditor/eq_editor-lite-17.js\u0026quot;\u0026lt;/span\u0026gt;),\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;scriptFromFile\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;EqEditor/eq_config.js\u0026quot;\u0026lt;/span\u0026gt;),\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;scriptFromFile\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;highlight/highlight.pack.js\u0026quot;\u0026lt;/span\u0026gt;),\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;scriptFromFile\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;injected.js\u0026quot;\u0026lt;/span\u0026gt;)\n]);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Actually, I\u0026apos;m kinda new to JS, so feel free to ping me to the better ways.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;in Content script , i add script tag to the head which binds a \u0026apos;onmessage\u0026apos; handler, inside the handler i use , eval to execute code.\nIn booth content script i use onmessage handler as well , so i get two way communication. \n\u0026lt;a href=\u0026quot;https://developer.chrome.com/extensions/content_scripts#host-page-communication\u0026quot; rel=\u0026quot;noreferrer\u0026quot; title=\u0026quot;Official Docs\u0026quot;\u0026gt;Chrome Docs\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//Content Script\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; pmsgUrl = chrome.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;extension\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getURL\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;pmListener.js\u0026apos;\u0026lt;/span\u0026gt;);\n$(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;head\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;first\u0026lt;/span\u0026gt;().\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;append\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026amp;lt;script src=\u0026apos;\u0026quot;\u0026lt;/span\u0026gt;+pmsgUrl+\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026apos; type=\u0026apos;text/javascript\u0026apos;\u0026amp;gt;\u0026amp;lt;/script\u0026amp;gt;\u0026quot;\u0026lt;/span\u0026gt;);\n\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//Listening to messages from DOM\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;window\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;addEventListener\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;message\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;event\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;CS :: message in from DOM\u0026apos;\u0026lt;/span\u0026gt;, event);\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;(event.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;data\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;hasOwnProperty\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;cmdClient\u0026apos;\u0026lt;/span\u0026gt;)) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; obj = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;JSON\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;parse\u0026lt;/span\u0026gt;(event.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;data\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;cmdClient\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;DoSomthingInContentScript\u0026lt;/span\u0026gt;(obj);\n }\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;pmListener.js is a post message url listener \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//pmListener.js\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//Listen to messages from Content Script and Execute Them\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;window\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;addEventListener\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;message\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;msg\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;im in REAL DOM\u0026quot;\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (msg.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;data\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;cmnd\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;eval\u0026lt;/span\u0026gt;(msg.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;data\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;cmnd\u0026lt;/span\u0026gt;);\n  }\n});\n\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;injected To Real Dom\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;This way , I can have 2 way communication between CS to Real Dom.\nIts very usefull for example if you need to listen webscoket events ,\nor to any in memory variables or events.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;You can use a utility function I\u0026apos;ve created for the purpose of running code in the page context and getting back the returned value.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This is done by serializing a function to a string and injecting it to the web page.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The utility is \u0026lt;a href=\u0026quot;https://github.com/arikw/extension-page-context\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;available here on GitHub\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Usage examples -\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Some code that exists only in the page context -\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;window\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;someProperty\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;property\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someFunction\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;name = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;test\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;res\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;()=\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;res\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;resolved \u0026apos;\u0026lt;/span\u0026gt; + name), \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1200\u0026lt;/span\u0026gt;));\n}\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/////////////////\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Content script examples -\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;runInPageContext\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; someProperty); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// returns \u0026apos;property\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;runInPageContext\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someFunction\u0026lt;/span\u0026gt;()); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// returns \u0026apos;resolved test\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;runInPageContext\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (name) =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someFunction\u0026lt;/span\u0026gt;(name), \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;with name\u0026apos;\u0026lt;/span\u0026gt; ); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// \u0026apos;resolved with name\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;runInPageContext\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (...args) =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someFunction\u0026lt;/span\u0026gt;(...args), \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;with spread operator and rest parameters\u0026apos;\u0026lt;/span\u0026gt; ); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// returns \u0026apos;resolved with spread operator and rest parameters\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;runInPageContext\u0026lt;/span\u0026gt;({\n    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;func\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;name\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someFunction\u0026lt;/span\u0026gt;(name),\n    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;args\u0026lt;/span\u0026gt;: [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;with params object\u0026apos;\u0026lt;/span\u0026gt;],\n    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;doc\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;timeout\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10000\u0026lt;/span\u0026gt;\n} ); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// returns \u0026apos;resolved with params object\u0026apos;\u0026lt;/span\u0026gt;\n\n\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;If you wish to inject pure function, instead of text, you can use this method:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\u0026lt;div class=\u0026quot;snippet\u0026quot; data-lang=\u0026quot;js\u0026quot; data-hide=\u0026quot;false\u0026quot; data-console=\u0026quot;true\u0026quot; data-babel=\u0026quot;false\u0026quot;\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-code\u0026quot;\u0026gt;\n\u0026lt;pre class=\u0026quot;snippet-code-html lang-html s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-xml\u0026quot;\u0026gt;function inject(){\n    document.body.style.backgroundColor = \u0026apos;blue\u0026apos;;\n}\n\n// this includes the function as text and the barentheses make it run itself.\nvar actualCode = \u0026quot;(\u0026quot;+inject+\u0026quot;)()\u0026quot;; \n\ndocument.documentElement.setAttribute(\u0026apos;onreset\u0026apos;, actualCode);\ndocument.documentElement.dispatchEvent(new CustomEvent(\u0026apos;reset\u0026apos;));\ndocument.documentElement.removeAttribute(\u0026apos;onreset\u0026apos;);\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-result\u0026quot;\u0026gt;\u0026lt;div class=\u0026quot;snippet-ctas\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn s-btn__primary\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;icon-play-white _hover\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;span\u0026gt; Run code snippet\u0026lt;/span\u0026gt;\u0026lt;/button\u0026gt;\u0026lt;input class=\u0026quot;copySnippet s-btn s-btn__filled\u0026quot; type=\u0026quot;button\u0026quot; value=\u0026quot;Copy snippet to answer\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn hideResults\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;Hide results\u0026lt;/button\u0026gt;\u0026lt;div class=\u0026quot;popout-code\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;snippet-expand-link\u0026quot;\u0026gt;Expand snippet\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;div class=\u0026quot;snippet-result-code\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;iframe name=\u0026quot;sif1\u0026quot; sandbox=\u0026quot;allow-forms allow-modals allow-scripts\u0026quot; class=\u0026quot;snippet-box-edit snippet-box-result\u0026quot; frameborder=\u0026quot;0\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;And you can pass parameters (unfortunatelly no objects and arrays can be stringifyed) to the functions. Add it into the baretheses, like so:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\u0026lt;div class=\u0026quot;snippet\u0026quot; data-lang=\u0026quot;js\u0026quot; data-hide=\u0026quot;false\u0026quot; data-console=\u0026quot;true\u0026quot; data-babel=\u0026quot;false\u0026quot;\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-code\u0026quot;\u0026gt;\n\u0026lt;pre class=\u0026quot;snippet-code-html lang-html s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-xml\u0026quot;\u0026gt;function inject(color){\n    document.body.style.backgroundColor = color;\n}\n\n// this includes the function as text and the barentheses make it run itself.\nvar color = \u0026apos;yellow\u0026apos;;\nvar actualCode = \u0026quot;(\u0026quot;+inject+\u0026quot;)(\u0026quot;+color+\u0026quot;)\u0026quot;; \u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-result\u0026quot;\u0026gt;\u0026lt;div class=\u0026quot;snippet-ctas\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn s-btn__primary\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;icon-play-white _hover\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;span\u0026gt; Run code snippet\u0026lt;/span\u0026gt;\u0026lt;/button\u0026gt;\u0026lt;input class=\u0026quot;copySnippet s-btn s-btn__filled\u0026quot; type=\u0026quot;button\u0026quot; value=\u0026quot;Copy snippet to answer\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn hideResults\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;Hide results\u0026lt;/button\u0026gt;\u0026lt;div class=\u0026quot;popout-code\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;snippet-expand-link\u0026quot;\u0026gt;Expand snippet\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;div class=\u0026quot;snippet-result-code\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;iframe name=\u0026quot;sif2\u0026quot; sandbox=\u0026quot;allow-forms allow-modals allow-scripts\u0026quot; class=\u0026quot;snippet-box-edit snippet-box-result\u0026quot; frameborder=\u0026quot;0\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\n    "],"id":168,"title":"Use a content script to access the page context variables and functions","content":"\n                \n\u0026lt;p\u0026gt;I\u0026apos;m learning how to create Chrome extensions. I just started developing one to catch YouTube events. I want to use it with YouTube flash player (later I will try to make it compatible with HTML5).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;manifest.json:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;name\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;MyExtension\u0026quot;\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;version\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;1.0\u0026quot;\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;description\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Gotta catch Youtube events!\u0026quot;\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;permissions\u0026quot;\u0026lt;/span\u0026gt;: [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;tabs\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;http://*/*\u0026quot;\u0026lt;/span\u0026gt;],\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;content_scripts\u0026quot;\u0026lt;/span\u0026gt; : [{\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;matches\u0026quot;\u0026lt;/span\u0026gt; : [ \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;www.youtube.com/*\u0026quot;\u0026lt;/span\u0026gt;],\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;js\u0026quot;\u0026lt;/span\u0026gt; : [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;myScript.js\u0026quot;\u0026lt;/span\u0026gt;]\n    }]\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;myScript.js:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;state\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) { \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;State Changed!\u0026quot;\u0026lt;/span\u0026gt;); }\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; player = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getElementById\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;movie_player\u0026quot;\u0026lt;/span\u0026gt;);\nplayer.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;addEventListener\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;onStateChange\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;state\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Started!\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;The problem is that the console gives me the \u0026lt;em\u0026gt;\u0026quot;Started!\u0026quot;\u0026lt;/em\u0026gt;, but there is no \u0026lt;em\u0026gt;\u0026quot;State Changed!\u0026quot;\u0026lt;/em\u0026gt; when I play/pause YouTube videos.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;When this code is put in the console, it worked. What am I doing wrong?\u0026lt;/p\u0026gt;\n    ","slug":"use-a-content-script-to-access-the-page-context-variables-and-functions-1657384842444","postType":"QUESTION","createdAt":"2022-07-09T16:40:42.000Z","updatedAt":"2022-07-09T16:40:42.000Z","tags":[{"id":617,"name":"google-chrome-extension","slug":"google-chrome-extension","createdAt":"2022-07-09T16:40:42.000Z","updatedAt":"2022-07-09T16:40:42.000Z","Questions_Tags":{"questionId":168,"tagId":617}},{"id":619,"name":"youtube-api","slug":"youtube-api","createdAt":"2022-07-09T16:40:42.000Z","updatedAt":"2022-07-09T16:40:42.000Z","Questions_Tags":{"questionId":168,"tagId":619}},{"id":620,"name":"content-script","slug":"content-script","createdAt":"2022-07-09T16:40:42.000Z","updatedAt":"2022-07-09T16:40:42.000Z","Questions_Tags":{"questionId":168,"tagId":620}}],"relatedQuestions":[{"title":"Use a content script to access the page context variables and functions","slug":"use-a-content-script-to-access-the-page-context-variables-and-functions-1657384842444","tags":[{"name":"google-chrome-extension","Questions_Tags":{"questionId":168,"tagId":617}},{"name":"youtube-api","Questions_Tags":{"questionId":168,"tagId":619}},{"name":"content-script","Questions_Tags":{"questionId":168,"tagId":620}}]}]},"randomQuestions":[{"title":"Does Python have a ternary conditional operator?","slug":"does-python-have-a-ternary-conditional-operator-1657387555448"},{"title":"Using global variables in a function","slug":"using-global-variables-in-a-function-1657384796002"},{"title":"How to count the number of set bits in a 32-bit integer?","slug":"how-to-count-the-number-of-set-bits-in-a-32-bit-integer-1657388437370"},{"title":"How can I remove a specific item from an array?","slug":"how-can-i-remove-a-specific-item-from-an-array-1657387552077"},{"title":"What are good ways to prevent SQL injection? [duplicate]","slug":"what-are-good-ways-to-prevent-sql-injection-duplicate-1657388431570"},{"title":"Int division: Why is the result of 1/3 == 0?","slug":"int-division:-why-is-the-result-of-13-0-1657387547814"},{"title":"Add a property to a JavaScript object using a variable as the name?","slug":"add-a-property-to-a-javascript-object-using-a-variable-as-the-name-1657388425650"},{"title":"Alternatives to gprof [closed]","slug":"alternatives-to-gprof-closed-1657388336554"},{"title":"Official locator strategies for the webdriver","slug":"official-locator-strategies-for-the-webdriver-1657384353174"},{"title":"Disable same origin policy in Chrome","slug":"disable-same-origin-policy-in-chrome-1657387743804"},{"title":"How to deal with mysqli problems? mysqli_fetch_array(): Argument #1 must be of type mysqli_result","slug":"how-to-deal-with-mysqli-problems-mysqli_fetch_array():-argument-1-must-be-of-type-mysqli_result-1657384360922"},{"title":"How to read a file line-by-line into a list?","slug":"how-to-read-a-file-line-by-line-into-a-list-1657387865894"},{"title":"When to use LinkedList over ArrayList in Java?","slug":"when-to-use-linkedlist-over-arraylist-in-java-1657388107480"},{"title":"How to remove \"noise\" from GCC/clang assembly output?","slug":"how-to-remove-\"noise\"-from-gccclang-assembly-output-1657387612391"},{"title":"Use dynamic variable names in JavaScript","slug":"use-dynamic-variable-names-in-javascript-1657388468075"},{"title":"Can PHP PDO Statements accept the table or column name as parameter?","slug":"can-php-pdo-statements-accept-the-table-or-column-name-as-parameter-1657387478588"},{"title":"Transpose / reshape dataframe without \"timevar\" from long to wide format","slug":"transpose-reshape-dataframe-without-\"timevar\"-from-long-to-wide-format-1657388213347"},{"title":"JSTL in JSF2 Facelets... makes sense?","slug":"jstl-in-jsf2-facelets...-makes-sense-1657387667435"},{"title":"input() error - NameError: name '...' is not defined","slug":"input()-error-nameerror:-name-'...'-is-not-defined-1657388497243"},{"title":"How do I return the response from an Observable/http/async call in angular?","slug":"how-do-i-return-the-response-from-an-observablehttpasync-call-in-angular-1657387335024"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"use-a-content-script-to-access-the-page-context-variables-and-functions-1657384842444"},"buildId":"DSpI0pSdXueTMCIVyw0q4","isFallback":false,"gsp":true,"locale":"en","locales":["en"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>