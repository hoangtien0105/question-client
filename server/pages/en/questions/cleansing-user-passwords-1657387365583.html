<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find the solution to any question. We focus on finding the fastest possible solution for users. Main topics like coding, learning. - solutionschecker.com"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><link name="keywords" content="solutions checker, solution checker, how to, solution for, check for solution, resolve question, what is, what solution for, find solution"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://solutionschecker.com","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@id":"https://solutionschecker.com/questions","name":"Questions"}},{"@type":"ListItem","position":3,"item":{"@id":"https://solutionschecker.com/questions/cleansing-user-passwords-1657387365583","name":"Questions"}}]}</script><title>Cleansing User Passwords | Solution Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="How should I escape or cleanse user-provided passwords before I hash them and store them in my database?

When PHP developers consider hashing users&#x27; passwords for security purposes, they often tend to think of those passwords like they would any other user-provided data. This subject comes up often in PHP questions related to password storage; the developer often wants to cleanse the password using functions such as escape_string()(in various iterations), htmlspecialchars(), addslashes() and others before hashing it and storing it in the database. 
    "/><meta property="og:title" content="Cleansing User Passwords | Solution Checker"/><meta property="og:description" content="How should I escape or cleanse user-provided passwords before I hash them and store them in my database?

When PHP developers consider hashing users&#x27; passwords for security purposes, they often tend to think of those passwords like they would any other user-provided data. This subject comes up often in PHP questions related to password storage; the developer often wants to cleanse the password using functions such as escape_string()(in various iterations), htmlspecialchars(), addslashes() and others before hashing it and storing it in the database. 
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"Cleansing User Passwords","text":"How should I escape or cleanse user-provided passwords before I hash them and store them in my database?\n\nWhen PHP developers consider hashing users&apos; passwords for security purposes, they often tend to think of those passwords like they would any other user-provided data. This subject comes up often in PHP questions related to password storage; the developer often wants to cleanse the password using functions such as escape_string()(in various iterations), htmlspecialchars(), addslashes() and others before hashing it and storing it in the database. \n    ","answerCount":2,"upVoteCount":500,"suggestedAnswer":[{"text":"You should never escape, trim or use any other cleansing mechanism on passwords you&apos;ll be hashing with PHP&apos;s password_hash() for a number of reasons, the single largest of which is because doing additional cleansing to the password requires unnecessary additional code.\n\nYou will argue (and you see it in every post where user data is accepted for use in your systems) that we should cleanse all user input and you would be right for every other piece of information we&apos;re accepting from our users. Passwords are different. Hashed passwords cannot offer any SQL injection threat because the string is turned into hash prior to storing in the database.\n\nThe act of hashing a password is the act of making the password safe to store in your database.  The hash function doesn&apos;t give special meaning to any bytes, so no cleansing of its input is required for security reasons\n\nIf you follow the mantras of allowing users to use the passwords / phrases they desire and you don&apos;t limit passwords, allowing any length, any number of spaces and any special characters hashing will make the password/passphrase safe no matter what is contained within the password. As of right now the most common hash (the default), PASSWORD_BCRYPT, turns the password into a 60 character wide string containing a random salt along with the hashed password information and a cost (the algorithmic cost of creating the hash):\n\n\n  PASSWORD_BCRYPT is used to create new password hashes using the CRYPT_BLOWFISH algorithm. This will always result in a hash using the &quot;$2y$&quot; crypt format, which is always 60 characters wide.\n\n\nThe space requirements for storing the hash are subject to change as different hashing methods are added to the function, so it is always better to go larger on the column type for the stored hash, such as VARCHAR(255) or TEXT.\n\nYou could use a complete SQL query as your password and it would be hashed, making it unexecutable by the SQL engine e.g.,\n\nSELECT * FROM `users`;\n\n\nCould be hashed to $2y$10$1tOKcWUWBW5gBka04tGMO.BH7gs/qjAHZsC5wyG0zmI2C.KgaqU5G\n\nLet&apos;s see how different sanitizing methods affect the password -\n\nThe password is I&apos;m a &quot;dessert topping&quot; &amp; a &lt;floor wax&gt;! (There are 5 spaces at the end of the password which are not displayed here.)\n\nWhen we apply the following methods of trimming we get some wildy different results:\n\nvar_dump(trim($_POST[&apos;upassword&apos;]));\nvar_dump(htmlentities($_POST[&apos;upassword&apos;]));\nvar_dump(htmlspecialchars($_POST[&apos;upassword&apos;]));\nvar_dump(addslashes($_POST[&apos;upassword&apos;]));\nvar_dump(strip_tags($_POST[&apos;upassword&apos;]));\n\n\nResults:\n\nstring(40) &quot;I&apos;m a &quot;dessert topping&quot; &amp; a &lt;floor wax&gt;!&quot; // spaces at the end are missing\nstring(65) &quot;I&apos;m a &amp;quot;dessert topping&amp;quot; &amp;amp; a &amp;lt;floor wax&amp;gt;!     &quot; // double quotes, ampersand and braces have been changed\nstring(65) &quot;I&apos;m a &amp;quot;dessert topping&amp;quot; &amp;amp; a &amp;lt;floor wax&amp;gt;!     &quot; // same here\nstring(48) &quot;I\\&apos;m a \\&quot;dessert topping\\&quot; &amp; a &lt;floor wax&gt;!     &quot; // escape characters have been added\nstring(34) &quot;I&apos;m a &quot;dessert topping&quot; &amp; a !     &quot; // looks like we have something missing\n\n\nWhat happens when we send these to password_hash()? They all get hashed, just as the query did above. The problem comes in when you try to verify the password. If we employ one or more of these methods we must re-employ them prior to comparing them with password_verify(). The following would fail:\n\npassword_verify($_POST[&apos;upassword&apos;], $hashed_password); // where $hashed_password comes from a database query\n\n\nYou would have to run the posted password through the cleansing method you chose before using the result of that in password verification. It is an unnecessary set of steps and will make the hash no better.\n\n\n\nUsing a PHP version less than 5.5? You can use the password_hash() compatibility pack.\n\nYou really shouldn&apos;t use MD5 password hashes.\n    ","url":"/questions/[slug]#solution1","@type":"Answer","upvoteCount":0},{"text":"Before hashing the password, you should normalise it as described in section 4 of RFC 7613.  In particular:\n\n\nAdditional Mapping Rule: Any instances of non-ASCII space MUST be\nmapped to ASCII space (U+0020); a non-ASCII space is any Unicode\ncode point having a Unicode general category of &quot;Zs&quot; (with the\nexception of U+0020).\n\n\nand:\n\n\nNormalization Rule: Unicode Normalization Form C (NFC) MUST be\napplied to all characters.\n\n\nThis attempts to ensure that if the user types the same password but using a different input method, the password should still be accepted.\n    ","url":"/questions/[slug]#solution2","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="22"/><link rel="preload" href="/_next/static/css/4f7b2847abfe82c6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4f7b2847abfe82c6.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-ccfab947c79712f4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c0d2dcb5e85faf18.js" defer=""></script><script src="/_next/static/chunks/294-106ef8570fa99deb.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-50e201fdaa1e0fd1.js" defer=""></script><script src="/_next/static/eGqQHYKGZKE-nXShFn8wX/_buildManifest.js" defer=""></script><script src="/_next/static/eGqQHYKGZKE-nXShFn8wX/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h1 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h1></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/cleansing-user-passwords-1657387365583#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/cleansing-user-passwords-1657387365583"><h1>Cleansing User Passwords</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"></div></div><div class="question-content mt-5">
                
<p>How should I escape or cleanse user-provided passwords before I hash them and store them in my database?</p>

<p>When PHP developers consider hashing users' passwords for security purposes, they often tend to think of those passwords like they would any other user-provided data. This subject comes up often in PHP questions related to password storage; the developer often wants to cleanse the password using functions such as <code>escape_string()</code>(in various iterations), <code>htmlspecialchars()</code>, <code>addslashes()</code> and others before hashing it and storing it in the database. </p>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><h1 class="text-lg font-semibold mb-5">Navigate to solutions: </h1><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 1</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You should never escape, trim or use any other cleansing mechanism on passwords you'll be hashing with PHP's <a href="http://php.net/manual/en/function.password-hash.php" rel="noreferrer"><code>password_hash()</code></a> for a number of reasons, the single largest of which is because doing additional cleansing to the password requires unnecessary additional code.</p>

<p>You will argue (and you see it in every post where user data is accepted for use in your systems) that we should cleanse all user input and you would be right for every other piece of information we're accepting from our users. Passwords are different. <em>Hashed passwords cannot offer any SQL injection threat because the string is turned into hash prior to storing in the database.</em></p>

<p>The act of hashing a password is the act of making the password safe to store in your database.  The hash function doesn't give special meaning to any bytes, so no cleansing of its input is required for security reasons</p>

<p>If you follow the mantras of allowing users to use the <a href="https://xkcd.com/936/" rel="noreferrer">passwords / phrases</a> they desire and you <a href="http://jayblanchard.net/security_fail_passwords.html" rel="noreferrer">don't limit passwords</a>, allowing any length, any number of spaces and any special characters hashing will make the password/passphrase safe no matter what is contained within the password. As of right now the most common hash (the default), <a href="http://php.net/manual/en/password.constants.php" rel="noreferrer"><code>PASSWORD_BCRYPT</code></a>, turns the password into a 60 character wide string containing a random salt along with the hashed password information and a cost (the algorithmic cost of creating the hash):</p>

<blockquote>
  <p>PASSWORD_BCRYPT is used to create new password hashes using the CRYPT_BLOWFISH algorithm. This will always result in a hash using the "$2y$" crypt format, which is always 60 characters wide.</p>
</blockquote>

<p>The space requirements for storing the hash are subject to change as different hashing methods are added to the function, so it is always better to go larger on the column type for the stored hash, such as <code>VARCHAR(255)</code> or <code>TEXT</code>.</p>

<p>You could use a complete SQL query as your password and it would be hashed, making it unexecutable by the SQL engine e.g.,</p>

<pre class="default s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `users`;
</code></pre>

<p>Could be hashed to <code>$2y$10$1tOKcWUWBW5gBka04tGMO.BH7gs/qjAHZsC5wyG0zmI2C.KgaqU5G</code></p>

<p><strong>Let's see how different sanitizing methods affect the password -</strong></p>

<p>The password is <code>I'm a "dessert topping" &amp; a &lt;floor wax&gt;!</code> (There are 5 spaces at the end of the password which are not displayed here.)</p>

<p>When we apply the following methods of trimming we get some wildy different results:</p>

<pre class="default s-code-block"><code class="hljs language-lisp">var_dump(<span class="hljs-name">trim</span>($_POST['upassword']))<span class="hljs-comment">;</span>
var_dump(<span class="hljs-name">htmlentities</span>($_POST['upassword']))<span class="hljs-comment">;</span>
var_dump(<span class="hljs-name">htmlspecialchars</span>($_POST['upassword']))<span class="hljs-comment">;</span>
var_dump(<span class="hljs-name">addslashes</span>($_POST['upassword']))<span class="hljs-comment">;</span>
var_dump(<span class="hljs-name">strip_tags</span>($_POST['upassword']))<span class="hljs-comment">;</span>
</code></pre>

<p>Results:</p>

<pre class="default s-code-block"><code class="hljs language-csharp"><span class="hljs-built_in">string</span>(<span class="hljs-number">40</span>) <span class="hljs-string">"I'm a "</span>dessert topping<span class="hljs-string">" &amp; a &lt;floor wax&gt;!"</span> <span class="hljs-comment">// spaces at the end are missing</span>
<span class="hljs-built_in">string</span>(<span class="hljs-number">65</span>) <span class="hljs-string">"I'm a &amp;quot;dessert topping&amp;quot; &amp;amp; a &amp;lt;floor wax&amp;gt;!     "</span> <span class="hljs-comment">// double quotes, ampersand and braces have been changed</span>
<span class="hljs-built_in">string</span>(<span class="hljs-number">65</span>) <span class="hljs-string">"I'm a &amp;quot;dessert topping&amp;quot; &amp;amp; a &amp;lt;floor wax&amp;gt;!     "</span> <span class="hljs-comment">// same here</span>
<span class="hljs-built_in">string</span>(<span class="hljs-number">48</span>) <span class="hljs-string">"I\'m a \"dessert topping\" &amp; a &lt;floor wax&gt;!     "</span> <span class="hljs-comment">// escape characters have been added</span>
<span class="hljs-built_in">string</span>(<span class="hljs-number">34</span>) <span class="hljs-string">"I'm a "</span>dessert topping<span class="hljs-string">" &amp; a !     "</span> <span class="hljs-comment">// looks like we have something missing</span>
</code></pre>

<p>What happens when we send these to <code>password_hash()</code>? They all get hashed, just as the query did above. The problem comes in when you try to verify the password. If we employ one or more of these methods we must re-employ them prior to comparing them with <a href="http://php.net/manual/en/function.password-verify.php" rel="noreferrer"><code>password_verify()</code></a>. The following would fail:</p>

<pre class="default s-code-block"><code class="hljs language-bash">password_verify(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'upassword'</span>], <span class="hljs-variable">$hashed_password</span>); // <span class="hljs-built_in">where</span> <span class="hljs-variable">$hashed_password</span> comes from a database query
</code></pre>

<p>You would have to run the posted password through the cleansing method you chose before using the result of that in password verification. It is an unnecessary set of steps and will make the hash no better.</p>

<hr>

<p>Using a PHP version less than 5.5? You can use the <code>password_hash()</code> <a href="https://github.com/ircmaxell/password_compat" rel="noreferrer">compatibility pack</a>.</p>

<p>You really shouldn't use <a href="https://security.stackexchange.com/questions/19906/is-md5-considered-insecure">MD5 password hashes</a>.</p>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 2</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Before hashing the password, you should normalise it as described in <a href="https://www.rfc-editor.org/rfc/rfc7613#section-4" rel="nofollow noreferrer">section 4 of RFC 7613</a>.  In particular:</p>
<blockquote>
<ol start="2">
<li>Additional Mapping Rule: Any instances of non-ASCII space MUST be
mapped to ASCII space (U+0020); a non-ASCII space is any Unicode
code point having a Unicode general category of "Zs" (with the
exception of U+0020).</li>
</ol>
</blockquote>
<p>and:</p>
<blockquote>
<ol start="4">
<li>Normalization Rule: Unicode Normalization Form C (NFC) MUST be
applied to all characters.</li>
</ol>
</blockquote>
<p>This attempts to ensure that if the user types the same password but using a different input method, the password should still be accepted.</p>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/split-array-into-chunks-1657387896420">Split array into chunks</a><a href="/questions/how-to-access-a-local-variable-from-a-different-function-using-pointers-1657388159760">How to access a local variable from a different function using pointers?</a><a href="/questions/split-comma-separated-strings-in-a-column-into-separate-rows-1657387785823">Split comma-separated strings in a column into separate rows</a><a href="/questions/how-do-you-parse-and-process-htmlxml-in-php-1657384351267">How do you parse and process HTML/XML in PHP?</a><a href="/questions/which-equals-operator-(-vs-)-should-be-used-in-javascript-comparisons-1657384663105">Which equals operator (== vs ===) should be used in JavaScript comparisons?</a><a href="/questions/passing-data-between-view-controllers-1657384540021">Passing data between view controllers</a><a href="/questions/disable-same-origin-policy-in-chrome-1657387743804">Disable same origin policy in Chrome</a><a href="/questions/how-to-check-if-element-is-visible-after-scrolling-1657387987960">How to check if element is visible after scrolling?</a><a href="/questions/what-is-a-plain-english-explanation-of-%22big-o%22-notation-1657387641953">What is a plain English explanation of &quot;Big O&quot; notation?</a><a href="/questions/what-is-the-best-regular-expression-to-check-if-a-string-is-a-valid-url-1657387618306">What is the best regular expression to check if a string is a valid URL?</a><a href="/questions/in-css-flexbox-why-are-there-no-%22justify-items%22-and-%22justify-self%22-properties-1657384782711">In CSS Flexbox, why are there no &quot;justify-items&quot; and &quot;justify-self&quot; properties?</a><a href="/questions/using-regular-expressions-to-parse-html:-why-not-1657387543969">Using regular expressions to parse HTML: why not?</a><a href="/questions/what&#x27;s-the-difference-between-inner-join-left-join-right-join-and-full-join-duplicate-1657388082887">What&#x27;s the difference between INNER JOIN, LEFT JOIN, RIGHT JOIN and FULL JOIN? [duplicate]</a><a href="/questions/how-does-the-sql-injection-from-the-%22bobby-tables%22-xkcd-comic-work-1657384621653">How does the SQL injection from the &quot;Bobby Tables&quot; XKCD comic work?</a><a href="/questions/how-do-i-set-a-variable-to-the-output-of-a-command-in-bash-1657387250909">How do I set a variable to the output of a command in Bash?</a><a href="/questions/how-do-i-make-git-forget-about-a-file-that-was-tracked-but-is-now-in-.gitignore-1657387328843">How do I make Git forget about a file that was tracked, but is now in .gitignore?</a><a href="/questions/what-should-main()-return-in-c-and-c++-1657384745630">What should main() return in C and C++?</a><a href="/questions/most-efficient-method-to-groupby-on-an-array-of-objects-1657387580538">Most efficient method to groupby on an array of objects</a><a href="/questions/creating-multiline-strings-in-javascript-1657388025414">Creating multiline strings in JavaScript</a><a href="/questions/how-do-i-copy-to-the-clipboard-in-javascript-1657385501223">How do I copy to the clipboard in JavaScript?</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;You should never escape, trim or use any other cleansing mechanism on passwords you\u0026apos;ll be hashing with PHP\u0026apos;s \u0026lt;a href=\u0026quot;http://php.net/manual/en/function.password-hash.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;password_hash()\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; for a number of reasons, the single largest of which is because doing additional cleansing to the password requires unnecessary additional code.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You will argue (and you see it in every post where user data is accepted for use in your systems) that we should cleanse all user input and you would be right for every other piece of information we\u0026apos;re accepting from our users. Passwords are different. \u0026lt;em\u0026gt;Hashed passwords cannot offer any SQL injection threat because the string is turned into hash prior to storing in the database.\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The act of hashing a password is the act of making the password safe to store in your database.  The hash function doesn\u0026apos;t give special meaning to any bytes, so no cleansing of its input is required for security reasons\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;If you follow the mantras of allowing users to use the \u0026lt;a href=\u0026quot;https://xkcd.com/936/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;passwords / phrases\u0026lt;/a\u0026gt; they desire and you \u0026lt;a href=\u0026quot;http://jayblanchard.net/security_fail_passwords.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;don\u0026apos;t limit passwords\u0026lt;/a\u0026gt;, allowing any length, any number of spaces and any special characters hashing will make the password/passphrase safe no matter what is contained within the password. As of right now the most common hash (the default), \u0026lt;a href=\u0026quot;http://php.net/manual/en/password.constants.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;PASSWORD_BCRYPT\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;, turns the password into a 60 character wide string containing a random salt along with the hashed password information and a cost (the algorithmic cost of creating the hash):\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;PASSWORD_BCRYPT is used to create new password hashes using the CRYPT_BLOWFISH algorithm. This will always result in a hash using the \u0026quot;$2y$\u0026quot; crypt format, which is always 60 characters wide.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;The space requirements for storing the hash are subject to change as different hashing methods are added to the function, so it is always better to go larger on the column type for the stored hash, such as \u0026lt;code\u0026gt;VARCHAR(255)\u0026lt;/code\u0026gt; or \u0026lt;code\u0026gt;TEXT\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You could use a complete SQL query as your password and it would be hashed, making it unexecutable by the SQL engine e.g.,\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; `users`;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Could be hashed to \u0026lt;code\u0026gt;$2y$10$1tOKcWUWBW5gBka04tGMO.BH7gs/qjAHZsC5wyG0zmI2C.KgaqU5G\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Let\u0026apos;s see how different sanitizing methods affect the password -\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The password is \u0026lt;code\u0026gt;I\u0026apos;m a \u0026quot;dessert topping\u0026quot; \u0026amp;amp; a \u0026amp;lt;floor wax\u0026amp;gt;!\u0026lt;/code\u0026gt; (There are 5 spaces at the end of the password which are not displayed here.)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;When we apply the following methods of trimming we get some wildy different results:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-lisp\u0026quot;\u0026gt;var_dump(\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;trim\u0026lt;/span\u0026gt;($_POST[\u0026apos;upassword\u0026apos;]))\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;;\u0026lt;/span\u0026gt;\nvar_dump(\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;htmlentities\u0026lt;/span\u0026gt;($_POST[\u0026apos;upassword\u0026apos;]))\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;;\u0026lt;/span\u0026gt;\nvar_dump(\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;htmlspecialchars\u0026lt;/span\u0026gt;($_POST[\u0026apos;upassword\u0026apos;]))\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;;\u0026lt;/span\u0026gt;\nvar_dump(\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;addslashes\u0026lt;/span\u0026gt;($_POST[\u0026apos;upassword\u0026apos;]))\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;;\u0026lt;/span\u0026gt;\nvar_dump(\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;strip_tags\u0026lt;/span\u0026gt;($_POST[\u0026apos;upassword\u0026apos;]))\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Results:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-csharp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;40\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;I\u0026apos;m a \u0026quot;\u0026lt;/span\u0026gt;dessert topping\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot; \u0026amp;amp; a \u0026amp;lt;floor wax\u0026amp;gt;!\u0026quot;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// spaces at the end are missing\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;65\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;I\u0026apos;m a \u0026amp;amp;quot;dessert topping\u0026amp;amp;quot; \u0026amp;amp;amp; a \u0026amp;amp;lt;floor wax\u0026amp;amp;gt;!     \u0026quot;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// double quotes, ampersand and braces have been changed\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;65\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;I\u0026apos;m a \u0026amp;amp;quot;dessert topping\u0026amp;amp;quot; \u0026amp;amp;amp; a \u0026amp;amp;lt;floor wax\u0026amp;amp;gt;!     \u0026quot;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// same here\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;48\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;I\\\u0026apos;m a \\\u0026quot;dessert topping\\\u0026quot; \u0026amp;amp; a \u0026amp;lt;floor wax\u0026amp;gt;!     \u0026quot;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// escape characters have been added\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;34\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;I\u0026apos;m a \u0026quot;\u0026lt;/span\u0026gt;dessert topping\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot; \u0026amp;amp; a !     \u0026quot;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// looks like we have something missing\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;What happens when we send these to \u0026lt;code\u0026gt;password_hash()\u0026lt;/code\u0026gt;? They all get hashed, just as the query did above. The problem comes in when you try to verify the password. If we employ one or more of these methods we must re-employ them prior to comparing them with \u0026lt;a href=\u0026quot;http://php.net/manual/en/function.password-verify.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;password_verify()\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;. The following would fail:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;password_verify(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;upassword\u0026apos;\u0026lt;/span\u0026gt;], \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hashed_password\u0026lt;/span\u0026gt;); // \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hashed_password\u0026lt;/span\u0026gt; comes from a database query\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;You would have to run the posted password through the cleansing method you chose before using the result of that in password verification. It is an unnecessary set of steps and will make the hash no better.\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;Using a PHP version less than 5.5? You can use the \u0026lt;code\u0026gt;password_hash()\u0026lt;/code\u0026gt; \u0026lt;a href=\u0026quot;https://github.com/ircmaxell/password_compat\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;compatibility pack\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You really shouldn\u0026apos;t use \u0026lt;a href=\u0026quot;https://security.stackexchange.com/questions/19906/is-md5-considered-insecure\u0026quot;\u0026gt;MD5 password hashes\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Before hashing the password, you should normalise it as described in \u0026lt;a href=\u0026quot;https://www.rfc-editor.org/rfc/rfc7613#section-4\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;section 4 of RFC 7613\u0026lt;/a\u0026gt;.  In particular:\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;ol start=\u0026quot;2\u0026quot;\u0026gt;\n\u0026lt;li\u0026gt;Additional Mapping Rule: Any instances of non-ASCII space MUST be\nmapped to ASCII space (U+0020); a non-ASCII space is any Unicode\ncode point having a Unicode general category of \u0026quot;Zs\u0026quot; (with the\nexception of U+0020).\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;and:\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;ol start=\u0026quot;4\u0026quot;\u0026gt;\n\u0026lt;li\u0026gt;Normalization Rule: Unicode Normalization Form C (NFC) MUST be\napplied to all characters.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;This attempts to ensure that if the user types the same password but using a different input method, the password should still be accepted.\u0026lt;/p\u0026gt;\n    "],"id":237,"title":"Cleansing User Passwords","content":"\n                \n\u0026lt;p\u0026gt;How should I escape or cleanse user-provided passwords before I hash them and store them in my database?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;When PHP developers consider hashing users\u0026apos; passwords for security purposes, they often tend to think of those passwords like they would any other user-provided data. This subject comes up often in PHP questions related to password storage; the developer often wants to cleanse the password using functions such as \u0026lt;code\u0026gt;escape_string()\u0026lt;/code\u0026gt;(in various iterations), \u0026lt;code\u0026gt;htmlspecialchars()\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;addslashes()\u0026lt;/code\u0026gt; and others before hashing it and storing it in the database. \u0026lt;/p\u0026gt;\n    ","slug":"cleansing-user-passwords-1657387365583","postType":"QUESTION","createdAt":"2022-07-09T17:22:45.000Z","updatedAt":"2022-07-09T17:22:45.000Z","tags":[],"relatedQuestions":[]},"randomQuestions":[{"title":"Split array into chunks","slug":"split-array-into-chunks-1657387896420"},{"title":"How to access a local variable from a different function using pointers?","slug":"how-to-access-a-local-variable-from-a-different-function-using-pointers-1657388159760"},{"title":"Split comma-separated strings in a column into separate rows","slug":"split-comma-separated-strings-in-a-column-into-separate-rows-1657387785823"},{"title":"How do you parse and process HTML/XML in PHP?","slug":"how-do-you-parse-and-process-htmlxml-in-php-1657384351267"},{"title":"Which equals operator (== vs ===) should be used in JavaScript comparisons?","slug":"which-equals-operator-(-vs-)-should-be-used-in-javascript-comparisons-1657384663105"},{"title":"Passing data between view controllers","slug":"passing-data-between-view-controllers-1657384540021"},{"title":"Disable same origin policy in Chrome","slug":"disable-same-origin-policy-in-chrome-1657387743804"},{"title":"How to check if element is visible after scrolling?","slug":"how-to-check-if-element-is-visible-after-scrolling-1657387987960"},{"title":"What is a plain English explanation of \"Big O\" notation?","slug":"what-is-a-plain-english-explanation-of-\"big-o\"-notation-1657387641953"},{"title":"What is the best regular expression to check if a string is a valid URL?","slug":"what-is-the-best-regular-expression-to-check-if-a-string-is-a-valid-url-1657387618306"},{"title":"In CSS Flexbox, why are there no \"justify-items\" and \"justify-self\" properties?","slug":"in-css-flexbox-why-are-there-no-\"justify-items\"-and-\"justify-self\"-properties-1657384782711"},{"title":"Using regular expressions to parse HTML: why not?","slug":"using-regular-expressions-to-parse-html:-why-not-1657387543969"},{"title":"What's the difference between INNER JOIN, LEFT JOIN, RIGHT JOIN and FULL JOIN? [duplicate]","slug":"what's-the-difference-between-inner-join-left-join-right-join-and-full-join-duplicate-1657388082887"},{"title":"How does the SQL injection from the \"Bobby Tables\" XKCD comic work?","slug":"how-does-the-sql-injection-from-the-\"bobby-tables\"-xkcd-comic-work-1657384621653"},{"title":"How do I set a variable to the output of a command in Bash?","slug":"how-do-i-set-a-variable-to-the-output-of-a-command-in-bash-1657387250909"},{"title":"How do I make Git forget about a file that was tracked, but is now in .gitignore?","slug":"how-do-i-make-git-forget-about-a-file-that-was-tracked-but-is-now-in-.gitignore-1657387328843"},{"title":"What should main() return in C and C++?","slug":"what-should-main()-return-in-c-and-c++-1657384745630"},{"title":"Most efficient method to groupby on an array of objects","slug":"most-efficient-method-to-groupby-on-an-array-of-objects-1657387580538"},{"title":"Creating multiline strings in JavaScript","slug":"creating-multiline-strings-in-javascript-1657388025414"},{"title":"How do I copy to the clipboard in JavaScript?","slug":"how-do-i-copy-to-the-clipboard-in-javascript-1657385501223"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"cleansing-user-passwords-1657387365583"},"buildId":"eGqQHYKGZKE-nXShFn8wX","isFallback":false,"gsp":true,"locale":"en","locales":["en"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>