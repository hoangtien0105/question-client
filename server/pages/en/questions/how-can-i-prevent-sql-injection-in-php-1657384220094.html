<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find solution for coding, HTML, CSS, JAVASCRIPT, MYSQL, PHP, PYTHON,... quickly. - solutionschecker.com"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><title>How can I prevent SQL injection in PHP? | Solutions Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="
            
        
            
                    
                        
                    
                
                    
                        This question&#x27;s answers are a community effort. Edit existing answers to improve this post. It is not currently accepting new answers or interactions.
                        
                    
                
            
        


    

If user input is inserted without modification into an SQL query, then the application becomes vulnerable to SQL injection, like in the following example:

$unsafe_variable = $_POST[&#x27;user_input&#x27;]; 

mysql_query(&quot;INSERT INTO `table` (`column`) VALUES (&#x27;$unsafe_variable&#x27;)&quot;);


That&#x27;s because the user can input something like value&#x27;); DROP TABLE table;--, and the query becomes:

INSERT INTO `table` (`column`) VALUES(&#x27;value&#x27;); DROP TABLE table;--&#x27;)


What can be done to prevent this from happening?
    "/><meta property="og:title" content="How can I prevent SQL injection in PHP? | Solutions Checker"/><meta property="og:description" content="
            
        
            
                    
                        
                    
                
                    
                        This question&#x27;s answers are a community effort. Edit existing answers to improve this post. It is not currently accepting new answers or interactions.
                        
                    
                
            
        


    

If user input is inserted without modification into an SQL query, then the application becomes vulnerable to SQL injection, like in the following example:

$unsafe_variable = $_POST[&#x27;user_input&#x27;]; 

mysql_query(&quot;INSERT INTO `table` (`column`) VALUES (&#x27;$unsafe_variable&#x27;)&quot;);


That&#x27;s because the user can input something like value&#x27;); DROP TABLE table;--, and the query becomes:

INSERT INTO `table` (`column`) VALUES(&#x27;value&#x27;); DROP TABLE table;--&#x27;)


What can be done to prevent this from happening?
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"How can I prevent SQL injection in PHP?","text":"\n            \n        \n            \n                    \n                        \n                    \n                \n                    \n                        This question&apos;s answers are a community effort. Edit existing answers to improve this post. It is not currently accepting new answers or interactions.\n                        \n                    \n                \n            \n        \n\n\n    \n\nIf user input is inserted without modification into an SQL query, then the application becomes vulnerable to SQL injection, like in the following example:\n\n$unsafe_variable = $_POST[&apos;user_input&apos;]; \n\nmysql_query(&quot;INSERT INTO `table` (`column`) VALUES (&apos;$unsafe_variable&apos;)&quot;);\n\n\nThat&apos;s because the user can input something like value&apos;); DROP TABLE table;--, and the query becomes:\n\nINSERT INTO `table` (`column`) VALUES(&apos;value&apos;); DROP TABLE table;--&apos;)\n\n\nWhat can be done to prevent this from happening?\n    ","answerCount":28,"upVoteCount":500,"suggestedAnswer":[{"text":"The correct way to avoid SQL injection attacks, no matter which database you use, is to separate the data from SQL, so that data stays data and will never be interpreted as commands by the SQL parser. It is possible to create an SQL statement with correctly formatted data parts, but if you don&apos;t fully understand the details, you should always use prepared statements and parameterized queries. These are SQL statements that are sent to and parsed by the database server separately from any parameters. This way it is impossible for an attacker to inject malicious SQL.\nYou basically have two options to achieve this:\n\nUsing PDO (for any supported database driver):\n $stmt = $pdo-&gt;prepare(&apos;SELECT * FROM employees WHERE name = :name&apos;);\n$stmt-&gt;execute([ &apos;name&apos; =&gt; $name ]);\n\nforeach ($stmt as $row) {\n    // Do something with $row\n}\n\n\nUsing MySQLi (for MySQL):\n $stmt = $dbConnection-&gt;prepare(&apos;SELECT * FROM employees WHERE name = ?&apos;);\n$stmt-&gt;bind_param(&apos;s&apos;, $name); // &apos;s&apos; specifies the variable type =&gt; &apos;string&apos;\n$stmt-&gt;execute();\n\n$result = $stmt-&gt;get_result();\nwhile ($row = $result-&gt;fetch_assoc()) {\n    // Do something with $row\n}\n\n\n\nIf you&apos;re connecting to a database other than MySQL, there is a driver-specific second option that you can refer to (for example, pg_prepare() and pg_execute() for PostgreSQL). PDO is the universal option.\n\nCorrectly setting up the connection\nPDO\nNote that when using PDO to access a MySQL database real prepared statements are not used by default. To fix this you have to disable the emulation of prepared statements. An example of creating a connection using PDO is:\n$dbConnection = new PDO(&apos;mysql:dbname=dbtest;host=127.0.0.1;charset=utf8mb4&apos;, &apos;user&apos;, &apos;password&apos;);\n\n$dbConnection-&gt;setAttribute(PDO::ATTR_EMULATE_PREPARES, false);\n$dbConnection-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n\nIn the above example, the error mode isn&apos;t strictly necessary, but it is advised to add it. This way PDO will inform you of all MySQL errors by means of throwing the PDOException.\nWhat is mandatory, however, is the first setAttribute() line, which tells PDO to disable emulated prepared statements and use real prepared statements. This makes sure the statement and the values aren&apos;t parsed by PHP before sending it to the MySQL server (giving a possible attacker no chance to inject malicious SQL).\nAlthough you can set the charset in the options of the constructor, it&apos;s important to note that &apos;older&apos; versions of PHP (before 5.3.6) silently ignored the charset parameter in the DSN.\nMysqli\nFor mysqli we have to follow the same routine:\nmysqli_report(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT); // error reporting\n$dbConnection = new mysqli(&apos;127.0.0.1&apos;, &apos;username&apos;, &apos;password&apos;, &apos;test&apos;);\n$dbConnection-&gt;set_charset(&apos;utf8mb4&apos;); // charset\n\n\nExplanation\nThe SQL statement you pass to prepare is parsed and compiled by the database server. By specifying parameters (either a ? or a named parameter like :name in the example above) you tell the database engine where you want to filter on. Then when you call execute, the prepared statement is combined with the parameter values you specify.\nThe important thing here is that the parameter values are combined with the compiled statement, not an SQL string. SQL injection works by tricking the script into including malicious strings when it creates SQL to send to the database. So by sending the actual SQL separately from the parameters, you limit the risk of ending up with something you didn&apos;t intend.\nAny parameters you send when using a prepared statement will just be treated as strings (although the database engine may do some optimization so parameters may end up as numbers too, of course). In the example above, if the $name variable contains &apos;Sarah&apos;; DELETE FROM employees the result would simply be a search for the string &quot;&apos;Sarah&apos;; DELETE FROM employees&quot;, and you will not end up with an empty table.\nAnother benefit of using prepared statements is that if you execute the same statement many times in the same session it will only be parsed and compiled once, giving you some speed gains.\nOh, and since you asked about how to do it for an insert, here&apos;s an example (using PDO):\n$preparedStatement = $db-&gt;prepare(&apos;INSERT INTO table (column) VALUES (:column)&apos;);\n\n$preparedStatement-&gt;execute([ &apos;column&apos; =&gt; $unsafeValue ]);\n\n\nCan prepared statements be used for dynamic queries?\nWhile you can still use prepared statements for the query parameters, the structure of the dynamic query itself cannot be parametrized and certain query features cannot be parametrized.\nFor these specific scenarios, the best thing to do is use a whitelist filter that restricts the possible values.\n// Value whitelist\n// $dir can only be &apos;DESC&apos;, otherwise it will be &apos;ASC&apos;\nif (empty($dir) || $dir !== &apos;DESC&apos;) {\n   $dir = &apos;ASC&apos;;\n}\n\n    ","url":"/questions/[slug]#solution1","@type":"Answer","upvoteCount":0},{"text":"To use the parameterized query, you need to use either Mysqli or PDO. To rewrite your example with mysqli, we would need something like the following.\n&lt;?php\nmysqli_report(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT);\n$mysqli = new mysqli(&quot;server&quot;, &quot;username&quot;, &quot;password&quot;, &quot;database_name&quot;);\n\n$variable = $_POST[&quot;user-input&quot;];\n$stmt = $mysqli-&gt;prepare(&quot;INSERT INTO table (column) VALUES (?)&quot;);\n// &quot;s&quot; means the database expects a string\n$stmt-&gt;bind_param(&quot;s&quot;, $variable);\n$stmt-&gt;execute();\n\nThe key function you&apos;ll want to read up on there would be mysqli::prepare.\nAlso, as others have suggested, you may find it useful/easier to step up a layer of abstraction with something like PDO.\nPlease note that the case you asked about is a fairly simple one and that more complex cases may require more complex approaches. In particular:\n\nIf you want to alter the structure of the SQL based on user input, parameterized queries are not going to help, and the escaping required is not covered by mysql_real_escape_string. In this kind of case, you would be better off passing the user&apos;s input through a whitelist to ensure only &apos;safe&apos; values are allowed through.\n\n    ","url":"/questions/[slug]#solution2","@type":"Answer","upvoteCount":0},{"text":"Every answer here covers only part of the problem.\nIn fact, there are four different query parts which we can add to SQL dynamically: -\n\na string\na number\nan identifier\na syntax keyword\n\nAnd prepared statements cover only two of them.\nBut sometimes we have to make our query even more dynamic, adding operators or identifiers as well.\nSo, we will need different protection techniques.\nIn general, such a protection approach is based on whitelisting.\nIn this case, every dynamic parameter should be hardcoded in your script and chosen from that set.\nFor example, to do dynamic ordering:\n$orders  = array(&quot;name&quot;, &quot;price&quot;, &quot;qty&quot;); // Field names\n$key = array_search($_GET[&apos;sort&apos;], $orders)); // if we have such a name\n$orderby = $orders[$key]; // If not, first one will be set automatically. \n$query = &quot;SELECT * FROM `table` ORDER BY $orderby&quot;; // Value is safe\n\nTo ease the process I wrote a whitelist helper function that does all the job in one line:\n$orderby = white_list($_GET[&apos;orderby&apos;], &quot;name&quot;, [&quot;name&quot;,&quot;price&quot;,&quot;qty&quot;], &quot;Invalid field name&quot;);\n$query  = &quot;SELECT * FROM `table` ORDER BY `$orderby`&quot;; // sound and safe\n\nThere is another way to secure identifiers - escaping but I rather stick to whitelisting as a more robust and explicit approach. Yet as long as you have an identifier quoted, you can escape the quote character to make it safe. For example, by default for mysql you have to double the quote character to escape it. For other other DBMS escaping rules would be different.\nStill, there is an issue with SQL syntax keywords (such as AND, DESC and such), but white-listing seems the only approach in this case.\nSo, a general recommendation may be phrased as\n\n\nAny variable that represents an SQL data literal, (or, to put it simply - an SQL string, or a number) must be added through a prepared statement. No Exceptions.\nAny other query part, such as an SQL keyword, a table or a field name, or an operator - must be filtered through a white list.\n\n\nUpdate\nAlthough there is a general agreement on the best practices regarding SQL injection protection, there are still many bad practices as well. And some of them too deeply rooted in the minds of PHP users. For instance, on this very page there are (although invisible to most visitors) more than 80 deleted answers - all removed by the community due to bad quality or promoting bad and outdated practices. Worse yet, some of the bad answers aren&apos;t deleted, but rather prospering.\nFor example, there(1) are(2) still(3) many(4) answers(5), including the second most upvoted answer suggesting you manual string escaping - an outdated approach that is proven to be insecure.\nOr there is a slightly better answer that suggests just another method of string formatting and even boasts it as the ultimate panacea. While of course, it is not. This method is no better than regular string formatting, yet it keeps all its drawbacks: it is applicable to strings only and, like any other manual formatting, it&apos;s essentially optional, non-obligatory measure, prone to human error of any sort.\nI think that all this because of one very old superstition, supported by such authorities like OWASP or the PHP manual, which proclaims equality between whatever &quot;escaping&quot; and protection from SQL injections.\nRegardless of what PHP manual said for ages, *_escape_string by no means makes data safe and never has been intended to. Besides being useless for any SQL part other than string, manual escaping is wrong, because it is manual as opposite to automated.\nAnd OWASP makes it even worse, stressing on escaping user input which is an utter nonsense: there should be no such words in the context of injection protection. Every variable is potentially dangerous - no matter the source! Or, in other words - every variable has to be properly formatted to be put into a query - no matter the source again. It&apos;s the destination that matters. The moment a developer starts to separate the sheep from the goats (thinking whether some particular variable is &quot;safe&quot; or not) he/she takes his/her first step towards disaster. Not to mention that even the wording suggests bulk escaping at the entry point, resembling the very magic quotes feature - already despised, deprecated and removed.\nSo, unlike whatever &quot;escaping&quot;, prepared statements is the measure that indeed protects from SQL injection (when applicable).\n    ","url":"/questions/[slug]#solution3","@type":"Answer","upvoteCount":0},{"text":"I&apos;d recommend using PDO (PHP Data Objects) to run parameterized SQL queries. \n\nNot only does this protect against SQL injection, but it also speeds up queries. \n\nAnd by using PDO rather than mysql_, mysqli_, and pgsql_ functions, you make your application a little more abstracted from the database, in the rare occurrence that you have to switch database providers.\n    ","url":"/questions/[slug]#solution4","@type":"Answer","upvoteCount":0},{"text":"Use PDO and prepared queries.\n($conn is a PDO object)\n$stmt = $conn-&gt;prepare(&quot;INSERT INTO tbl VALUES(:id, :name)&quot;);\n$stmt-&gt;bindValue(&apos;:id&apos;, $id);\n$stmt-&gt;bindValue(&apos;:name&apos;, $name);\n$stmt-&gt;execute();\n\n    ","url":"/questions/[slug]#solution5","@type":"Answer","upvoteCount":0},{"text":"As you can see, people suggest you use prepared statements at the most. It&apos;s not wrong, but when your query is executed just once per process, there would be a slight performance penalty. \n\nI was facing this issue, but I think I solved it in very sophisticated way - the way hackers use to avoid using quotes. I used this in conjunction with emulated prepared statements. I use it to prevent all kinds of possible SQL injection attacks.\n\nMy approach:\n\n\nIf you expect input to be integer make sure it&apos;s really integer. In a variable-type language like PHP it is this very important. You can use for example this very simple but powerful solution: sprintf(&quot;SELECT 1,2,3 FROM table WHERE 4 = %u&quot;, $input);  \nIf you expect anything else from integer hex it. If you hex it, you will perfectly escape all input. In C/C++ there&apos;s a function called mysql_hex_string(), in PHP you can use bin2hex().\n\nDon&apos;t worry about that the escaped string will have a 2x size of its original length because even if you use mysql_real_escape_string, PHP has to allocate same capacity ((2*input_length)+1), which is the same.\nThis hex method is often used when you transfer binary data, but I see no reason why not use it on all data to prevent SQL injection attacks. Note that you have to prepend data with 0x or use the MySQL function UNHEX instead.\n\n\nSo, for example, the query:\n\nSELECT password FROM users WHERE name = &apos;root&apos;;\n\n\nWill become:\n\nSELECT password FROM users WHERE name = 0x726f6f74;\n\n\nor\n\nSELECT password FROM users WHERE name = UNHEX(&apos;726f6f74&apos;);\n\n\nHex is the perfect escape. No way to inject.\n\nDifference between UNHEX function and 0x prefix\n\nThere was some discussion in comments, so I finally want to make it clear. These two approaches are very similar, but they are a little different in some ways:\n\nThe 0x prefix can only be used for data columns such as char, varchar, text, block, binary, etc.\nAlso, its use is a little complicated if you are about to insert an empty string. You&apos;ll have to entirely replace it with &apos;&apos;, or you&apos;ll get an error.\n\nUNHEX() works on any column; you do not have to worry about the empty string.\n\n\n\nHex methods are often used as attacks\n\nNote that this hex method is often used as an SQL injection attack where integers are just like strings and escaped just with mysql_real_escape_string. Then you can avoid the use of quotes.\n\nFor example, if you just do something like this:\n\n&quot;SELECT title FROM article WHERE id = &quot; . mysql_real_escape_string($_GET[&quot;id&quot;])\n\n\nan attack can inject you very easily. Consider the following injected code returned from your script:\n\nSELECT ... WHERE id = -1 UNION ALL SELECT table_name FROM information_schema.tables;\n\n\nand now just extract table structure:\n\nSELECT ... WHERE id = -1 UNION ALL SELECT column_name FROM information_schema.column WHERE table_name = __0x61727469636c65__;\n\n\nAnd then just select whatever data ones want. Isn&apos;t it cool?\n\nBut if the coder of an injectable site would hex it, no injection would be possible because the query would look like this:\n\nSELECT ... WHERE id = UNHEX(&apos;2d312075...3635&apos;);\n\n    ","url":"/questions/[slug]#solution6","@type":"Answer","upvoteCount":0},{"text":"\n  Deprecated Warning:\n  This answer&apos;s sample code (like the question&apos;s sample code) uses PHP&apos;s MySQL extension, which was deprecated in PHP 5.5.0 and removed entirely in PHP 7.0.0.\n  \n  Security Warning: This answer is not in line with security best practices. Escaping is inadequate to prevent SQL injection, use prepared statements instead. Use the strategy outlined below at your own risk. (Also, mysql_real_escape_string() was removed in PHP 7.)\n  \n  IMPORTANT\n  \n  The best way to prevent SQL Injection is to use Prepared Statements instead of escaping, as the accepted answer demonstrates. \n  \n  There are libraries such as Aura.Sql and EasyDB that allow developers to use prepared statements easier. To learn more about why prepared statements are better at stopping SQL injection, refer to this mysql_real_escape_string() bypass and recently fixed Unicode SQL Injection vulnerabilities in WordPress.\n\n\nInjection prevention - mysql_real_escape_string()\n\nPHP has a specially-made function to prevent these attacks. All you need to do is use the mouthful of a function, mysql_real_escape_string.\n\nmysql_real_escape_string takes a string that is going to be used in a MySQL query and return the same string with all SQL injection attempts safely escaped. Basically, it will replace those troublesome quotes(&apos;) a user might enter with a MySQL-safe substitute, an escaped quote \\&apos;.\n\nNOTE: you must be connected to the database to use this function!\n\n// Connect to MySQL\n\n$name_bad = &quot;&apos; OR 1&apos;&quot;; \n\n$name_bad = mysql_real_escape_string($name_bad);\n\n$query_bad = &quot;SELECT * FROM customers WHERE username = &apos;$name_bad&apos;&quot;;\necho &quot;Escaped Bad Injection: &lt;br /&gt;&quot; . $query_bad . &quot;&lt;br /&gt;&quot;;\n\n\n$name_evil = &quot;&apos;; DELETE FROM customers WHERE 1 or username = &apos;&quot;; \n\n$name_evil = mysql_real_escape_string($name_evil);\n\n$query_evil = &quot;SELECT * FROM customers WHERE username = &apos;$name_evil&apos;&quot;;\necho &quot;Escaped Evil Injection: &lt;br /&gt;&quot; . $query_evil;\n\n\nYou can find more details in MySQL - SQL Injection Prevention.\n    ","url":"/questions/[slug]#solution7","@type":"Answer","upvoteCount":0},{"text":"\nSecurity Warning: This answer is not in line with security best practices. Escaping is inadequate to prevent SQL injection, use prepared statements instead. Use the strategy outlined below at your own risk.\n\nYou could do something basic like this:\n$safe_variable = mysqli_real_escape_string($_POST[&quot;user-input&quot;], $dbConnection);\nmysqli_query($dbConnection, &quot;INSERT INTO table (column) VALUES (&apos;&quot; . $safe_variable . &quot;&apos;)&quot;);\n\nThis won&apos;t solve every problem, but it&apos;s a very good stepping stone. I left out obvious items such as checking the variable&apos;s existence, format (numbers, letters, etc.).\n    ","url":"/questions/[slug]#solution8","@type":"Answer","upvoteCount":0},{"text":"Whatever you do end up using, make sure that you check your input hasn&apos;t already been mangled by magic_quotes or some other well-meaning rubbish, and if necessary, run it through stripslashes or whatever to sanitize it.\n    ","url":"/questions/[slug]#solution9","@type":"Answer","upvoteCount":0},{"text":"\n  Deprecated Warning:\n  This answer&apos;s sample code (like the question&apos;s sample code) uses PHP&apos;s MySQL extension, which was deprecated in PHP 5.5.0 and removed entirely in PHP 7.0.0.\n  \n  Security Warning: This answer is not in line with security best practices. Escaping is inadequate to prevent SQL injection, use prepared statements instead. Use the strategy outlined below at your own risk. (Also, mysql_real_escape_string() was removed in PHP 7.)\n\n\nParameterized query AND input validation is the way to go. There are many scenarios under which SQL injection may occur, even though mysql_real_escape_string() has been used.\n\nThose examples are vulnerable to SQL injection:\n\n$offset = isset($_GET[&apos;o&apos;]) ? $_GET[&apos;o&apos;] : 0;\n$offset = mysql_real_escape_string($offset);\nRunQuery(&quot;SELECT userid, username FROM sql_injection_test LIMIT $offset, 10&quot;);\n\n\nor\n\n$order = isset($_GET[&apos;o&apos;]) ? $_GET[&apos;o&apos;] : &apos;userid&apos;;\n$order = mysql_real_escape_string($order);\nRunQuery(&quot;SELECT userid, username FROM sql_injection_test ORDER BY `$order`&quot;);\n\n\nIn both cases, you can&apos;t use &apos; to protect the encapsulation.\n\nSource: The Unexpected SQL Injection (When Escaping Is Not Enough)\n    ","url":"/questions/[slug]#solution10","@type":"Answer","upvoteCount":0},{"text":"In my opinion, the best way to generally prevent SQL injection in your PHP application (or any web application, for that matter) is to think about your application&apos;s architecture. If the only way to protect against SQL injection is to remember to use a special method or function that does The Right Thing every time you talk to the database, you are doing it wrong. That way, it&apos;s just a matter of time until you forget to correctly format your query at some point in your code.\n\nAdopting the MVC pattern and a framework like CakePHP or CodeIgniter is probably the right way to go: Common tasks like creating secure database queries have been solved and centrally implemented in such frameworks. They help you to organize your web application in a sensible way and make you think more about loading and saving objects than about securely constructing single SQL queries. \n    ","url":"/questions/[slug]#solution11","@type":"Answer","upvoteCount":0},{"text":"There are many ways of preventing SQL injections and other SQL hacks. You can easily find it on the Internet (Google Search). Of course PDO is one of the good solutions. But I would like to suggest you some good links prevention from SQL injection.\n\nWhat is SQL injection and how to prevent\n\nPHP manual for SQL injection\n\nMicrosoft explanation of SQL injection and prevention in PHP\n\nAnd some other like Preventing SQL injection with MySQL and PHP.\n\nNow, why you do you need to prevent your query from SQL injection?\n\nI would like to let you know: Why do we try for preventing SQL injection with a short example below:\n\nQuery for login authentication match:\n\n$query=&quot;select * from users where email=&apos;&quot;.$_POST[&apos;email&apos;].&quot;&apos; and password=&apos;&quot;.$_POST[&apos;password&apos;].&quot;&apos; &quot;;\n\n\nNow, if someone (a hacker) puts\n\n$_POST[&apos;email&apos;]= admin@emali.com&apos; OR &apos;1=1\n\n\nand password anything....\n\nThe query will be parsed into the system only up to:\n\n$query=&quot;select * from users where email=&apos;admin@emali.com&apos; OR &apos;1=1&apos;;\n\n\nThe other part will be discarded. So, what will happen? A non-authorized user (hacker) will be able to log in as administrator without having his/her password. Now, he/she can do anything that the administrator/email person can do. See, it&apos;s very dangerous if SQL injection is not prevented.\n    ","url":"/questions/[slug]#solution12","@type":"Answer","upvoteCount":0},{"text":"I favor stored procedures (MySQL has had stored procedures support since 5.0) from a security point of view - the advantages are -\n\n\nMost databases (including MySQL) enable user access to be restricted to executing stored procedures. The fine-grained security access control is useful to prevent escalation of privileges attacks. This prevents compromised applications from being able to run SQL directly against the database.\nThey abstract the raw SQL query from the application so less information of the database structure is available to the application. This makes it harder for people to understand the underlying structure of the database and design suitable attacks.\nThey accept only parameters, so the advantages of parameterized queries are there. Of course - IMO you still need to sanitize your input - especially if you are using dynamic SQL inside the stored procedure.\n\n\nThe disadvantages are -\n\n\nThey (stored procedures) are tough to maintain and tend to multiply very quickly. This makes managing them an issue.\nThey are not very suitable for dynamic queries - if they are built to accept dynamic code as parameters then a lot of the advantages are negated.\n\n    ","url":"/questions/[slug]#solution13","@type":"Answer","upvoteCount":0},{"text":"I think if someone wants to use PHP and MySQL or some other dataBase server:\n\nThink about learning PDO (PHP Data Objects)  it is a database access layer providing a uniform method of access to multiple databases.\nThink about learning MySQLi\n\n\nLibraries examples:\n---- PDO\n\n----- No placeholders - ripe for SQL injection! It&apos;s bad\n\n$request = $pdoConnection-&gt;(&quot;INSERT INTO parents (name, addr, city) values ($name, $addr, $city)&quot;);\n\n\n----- Unnamed placeholders\n\n$request = $pdoConnection-&gt;(&quot;INSERT INTO parents (name, addr, city) values (?, ?, ?);\n\n\n----- Named placeholders\n\n$request = $pdoConnection-&gt;(&quot;INSERT INTO parents (name, addr, city) value (:name, :addr, :city)&quot;);\n\n--- MySQLi\n$request = $mysqliConnection-&gt;prepare(&apos;\n       SELECT * FROM trainers\n       WHERE name = ?\n       AND email = ?\n       AND last_login &gt; ?&apos;);\n\n    $query-&gt;bind_param(&apos;first_param&apos;, &apos;second_param&apos;, $mail, time() - 3600);\n    $query-&gt;execute();\n\n\nP.S:\nPDO wins this battle with ease. With support for twelve\ndifferent database drivers and named parameters, we can get used to its API. From a security standpoint, both of them are safe as long as the developer uses them the way they are supposed to be used\n    ","url":"/questions/[slug]#solution14","@type":"Answer","upvoteCount":0},{"text":"If possible, cast the types of your parameters. But it&apos;s only working on simple types like int, bool, and float.\n\n$unsafe_variable = $_POST[&apos;user_id&apos;];\n\n$safe_variable = (int)$unsafe_variable ;\n\nmysqli_query($conn, &quot;INSERT INTO table (column) VALUES (&apos;&quot; . $safe_variable . &quot;&apos;)&quot;);\n\n    ","url":"/questions/[slug]#solution15","@type":"Answer","upvoteCount":0},{"text":"If you want to take advantage of cache engines, like Redis or Memcached, maybe DALMP could be a choice. It uses pure MySQLi. Check this: DALMP Database Abstraction Layer for MySQL using PHP. \n\nAlso, you can &apos;prepare&apos; your arguments before preparing your query so that you can build dynamic queries and at the end have a fully prepared statements query. DALMP Database Abstraction Layer for MySQL using PHP. \n    ","url":"/questions/[slug]#solution16","@type":"Answer","upvoteCount":0},{"text":"For those unsure of how to use PDO (coming from the mysql_ functions), I made a very, very simple PDO wrapper that is a single file. It exists to show how easy it is to do all the common things applications need to be done. Works with PostgreSQL, MySQL, and SQLite.\nBasically, read it while you read the manual to see how to put the PDO functions to use in real life to make it simple to store and retrieve values in the format you want.\n\nI want a single column\n$count = DB::column(&apos;SELECT COUNT(*) FROM `user`&apos;);\n\nI want an array(key =&gt; value) results (i.e. for making a selectbox)\n$pairs = DB::pairs(&apos;SELECT `id`, `username` FROM `user`&apos;);\n\nI want a single row result\n$user = DB::row(&apos;SELECT * FROM `user` WHERE `id` = ?&apos;, array($user_id));\n\nI want an array of results\n$banned_users = DB::fetch(&apos;SELECT * FROM `user` WHERE `banned` = ?&apos;, array(&apos;TRUE&apos;));\n\n\n    ","url":"/questions/[slug]#solution17","@type":"Answer","upvoteCount":0},{"text":"\nSecurity Warning: This answer is not in line with security best practices. Escaping is inadequate to prevent SQL injection, use prepared statements instead.\n\nA few guidelines for escaping special characters in SQL statements.\nDon&apos;t use MySQL. This extension is deprecated. Use MySQLi or PDO instead.\nMySQLi\nFor manually escaping special characters in a string you can use the mysqli_real_escape_string function. The function will not work properly unless the correct character set is set with mysqli_set_charset.\nExample:\n$mysqli = new mysqli(&apos;host&apos;, &apos;user&apos;, &apos;password&apos;, &apos;database&apos;);\n$mysqli-&gt;set_charset(&apos;charset&apos;);\n\n$string = $mysqli-&gt;real_escape_string($string);\n$mysqli-&gt;query(&quot;INSERT INTO table (column) VALUES (&apos;$string&apos;)&quot;);\n\nFor automatic escaping of values with prepared statements, use mysqli_prepare, and mysqli_stmt_bind_param where types for the corresponding bind variables must be provided for an appropriate conversion:\nExample:\n$stmt = $mysqli-&gt;prepare(&quot;INSERT INTO table (column1, column2) VALUES (?,?)&quot;);\n\n$stmt-&gt;bind_param(&quot;is&quot;, $integer, $string);\n\n$stmt-&gt;execute();\n\nNo matter if you use prepared statements or mysqli_real_escape_string, you always have to know the type of input data you&apos;re working with.\nSo if you use a prepared statement, you must specify the types of the variables for mysqli_stmt_bind_param function.\nAnd the use of mysqli_real_escape_string is for, as the name says, escaping special characters in a string, so it will not make integers safe. The purpose of this function is to prevent breaking the strings in SQL statements, and the damage to the database that it could cause. mysqli_real_escape_string is a useful function when used properly, especially when combined with sprintf.\nExample:\n$string = &quot;x&apos; OR name LIKE &apos;%John%&quot;;\n$integer = &apos;5 OR id != 0&apos;;\n\n$query = sprintf( &quot;SELECT id, email, pass, name FROM members WHERE email =&apos;%s&apos; AND id = %d&quot;, $mysqli-&gt;real_escape_string($string), $integer);\n\necho $query;\n// SELECT id, email, pass, name FROM members WHERE email =&apos;x\\&apos; OR name LIKE \\&apos;%John%&apos; AND id = 5\n\n$integer = &apos;99999999999999999999&apos;;\n$query = sprintf(&quot;SELECT id, email, pass, name FROM members WHERE email =&apos;%s&apos; AND id = %d&quot;, $mysqli-&gt;real_escape_string($string), $integer);\n\necho $query;\n// SELECT id, email, pass, name FROM members WHERE email =&apos;x\\&apos; OR name LIKE \\&apos;%John%&apos; AND id = 2147483647\n\n    ","url":"/questions/[slug]#solution18","@type":"Answer","upvoteCount":0},{"text":"\nSecurity Warning: This answer is not in line with security best practices. Escaping is inadequate to prevent SQL injection, use prepared statements instead. Use the strategy outlined below at your own risk. (Also, mysql_real_escape_string() was removed in PHP 7.)\n\n\nWarning: The mysql extension is removed at this time. we recommend using the PDO extension\n\nUsing this PHP function mysql_escape_string() you can get a good prevention in a fast way.\nFor example:\nSELECT * FROM users WHERE name = &apos;&quot;.mysql_escape_string($name_from_html_form).&quot;&apos;\n\nmysql_escape_string  Escapes a string for use in a mysql_query\nFor more prevention, you can add at the end ...\nwHERE 1=1   or  LIMIT 1\n\nFinally you get:\nSELECT * FROM users WHERE name = &apos;&quot;.mysql_escape_string($name_from_html_form).&quot;&apos; LIMIT 1\n\n    ","url":"/questions/[slug]#solution19","@type":"Answer","upvoteCount":0},{"text":"The simple alternative to this problem could be solved by granting appropriate permissions in the database itself.\nFor example: if you are using a MySQL database then enter into the database through terminal or the UI provided and just follow this command:\n\n GRANT SELECT, INSERT, DELETE ON database TO username@&apos;localhost&apos; IDENTIFIED BY &apos;password&apos;;\n\n\nThis will restrict the user to only get confined with the specified query&apos;s only. Remove the delete permission and so the data would never get deleted from the query fired from the PHP page.\nThe second thing to do is to flush the privileges so that the MySQL refreshes the permissions and updates.\n\nFLUSH PRIVILEGES; \n\n\nmore information about flush.\n\nTo see the current privileges for the user fire the following query.\n\nselect * from mysql.user where User=&apos;username&apos;;\n\n\nLearn more about GRANT.\n    ","url":"/questions/[slug]#solution20","@type":"Answer","upvoteCount":0},{"text":"Regarding many useful answers, I hope to add some value to this thread.\n\nSQL injection is an attack that can be done through user inputs (inputs that filled by a user and then used inside queries). The SQL injection patterns are correct query syntax while we can call it: bad queries for bad reasons, and we assume that there might be a bad person that try to get secret information (bypassing access control) that affect the three principles of security (confidentiality, integrity, and availability).\n\nNow, our point is to prevent security threats such as SQL injection attacks, the question asking (how to prevent an SQL injection attack using PHP), be more realistic, data filtering or clearing input data is the case when using user-input data inside such query, using PHP or any other programming language is not the case, or as recommended by more people to use modern technology such as prepared statement or any other tools that currently supporting SQL injection prevention, consider that these tools not available anymore? How do you secure your application?\n\nMy approach against SQL injection is: clearing user-input data before sending it to the database (before using it inside any query).\n\nData filtering for (converting unsafe data to safe data)\n\nConsider that PDO and MySQLi are not available. How can you secure your application? Do you force me to use them? What about other languages other than PHP? I prefer to provide general ideas as it can be used for wider border, not just for a specific language.\n\n\nSQL user (limiting user privilege): most common SQL operations are (SELECT, UPDATE, INSERT), then, why give the UPDATE privilege to a user that does not require it? For example, login, and search pages are only using SELECT, then, why use DB users in these pages with high privileges?\n\n\nRULE: do not create one database user for all privileges. For all SQL operations, you can create your scheme like (deluser, selectuser, updateuser) as usernames for easy usage.\n\nSee principle of least privilege.\n\n\nData filtering: before building any query user input, it should be validated and filtered. For programmers, it&apos;s important to define some properties for each user-input variables:\ndata type, data pattern, and data length. A field that is a number between (x and y) must be exactly validated using the exact rule, and for a field that is a string (text): pattern is the case, for example, a username must contain only some characters, lets say [a-zA-Z0-9_-.]. The length varies between (x and n) where x and n (integers, x &lt;=n).\nRule: creating exact filters and validation rules are best practices for me.\nUse other tools: Here, I will also agree with you that a prepared statement (parametrized query) and stored procedures. The disadvantages here is these ways require advanced skills which do not exist for most users. The basic idea here is to distinguish between the SQL query and the data that is used inside. Both approaches can be used even with unsafe data, because the user-input data here does not add anything to the original query, such as (any or x=x).\n\n\nFor more information, please read OWASP SQL Injection Prevention Cheat Sheet.\n\nNow, if you are an advanced user, start using this defense as you like, but, for beginners, if they can&apos;t quickly implement a stored procedure and prepared the statement, it&apos;s better to filter input data as much they can.\n\nFinally, let&apos;s consider that a user sends this text below instead of entering his/her username:\n\n[1] UNION SELECT IF(SUBSTRING(Password,1,1)=&apos;2&apos;,BENCHMARK(100000,SHA1(1)),0) User,Password FROM mysql.user WHERE User = &apos;root&apos;\n\n\nThis input can be checked early without any prepared statement and stored procedures, but to be on the safe side, using them starts after user-data filtering and validation.\n\nThe last point is detecting unexpected behavior which requires more effort and complexity; it&apos;s not recommended for normal web applications.\n\nUnexpected behavior in the above user input is SELECT, UNION, IF, SUBSTRING, BENCHMARK, SHA, and root. Once these words detected, you can avoid the input.\n\nUPDATE 1:\n\nA user commented that this post is useless, OK! Here is what OWASP.ORG provided:\n\n\n  Primary defenses: \n   \n      Option #1: Use of Prepared Statements (Parameterized Queries) \n      Option #2: Use of Stored Procedures \n      Option #3: Escaping all User Supplied Input  \n   \n  Additional defenses: \n   \n      Also Enforce: Least Privilege \n      Also Perform: White List Input Validation \n\n\nAs you may know, claiming an article should be supported by a valid argument, at least by one reference! Otherwise, it&apos;s considered as an attack and a bad claim!\n\nUpdate 2:\n\nFrom the PHP manual, PHP: Prepared Statements - Manual:\n\n\n  Escaping and SQL injection \n  \n  Bound variables will be escaped automatically by the server. The\n  server inserts their escaped values at the appropriate places into the\n  statement template before execution. A hint must be provided to the\n  server for the type of bound variable, to create an appropriate\n  conversion. See the mysqli_stmt_bind_param() function for more\n  information. \n  \n  The automatic escaping of values within the server is sometimes\n  considered a security feature to prevent SQL injection. The same\n  degree of security can be achieved with non-prepared statements if\n  input values are escaped correctly. \n\n\nUpdate 3:\n\nI created test cases for knowing how PDO and MySQLi send the query to the MySQL server when using a prepared statement:\n\nPDO:\n\n$user = &quot;&apos;&apos;1&apos;&apos;&quot;; // Malicious keyword\n$sql = &apos;SELECT * FROM awa_user WHERE userame =:username&apos;;\n$sth = $dbh-&gt;prepare($sql, array(PDO::ATTR_CURSOR =&gt; PDO::CURSOR_FWDONLY));\n$sth-&gt;execute(array(&apos;:username&apos; =&gt; $user));\n\n\nQuery Log:\n\n\n    189 Query SELECT * FROM awa_user WHERE userame =&apos;\\&apos;\\&apos;1\\&apos;\\&apos;&apos;\n    189 Quit\n\n\n\nMySQLi:\n\n$stmt = $mysqli-&gt;prepare(&quot;SELECT * FROM awa_user WHERE username =?&quot;)) {\n$stmt-&gt;bind_param(&quot;s&quot;, $user);\n$user = &quot;&apos;&apos;1&apos;&apos;&quot;;\n$stmt-&gt;execute();\n\n\nQuery Log:\n\n\n    188 Prepare   SELECT * FROM awa_user WHERE username =?\n    188 Execute   SELECT * FROM awa_user WHERE username =&apos;\\&apos;\\&apos;1\\&apos;\\&apos;&apos;\n    188 Quit\n\n\n\nIt&apos;s clear that a prepared statement is also escaping the data, nothing else.\n\nAs also mentioned in the above statement,\n\n\n  The automatic escaping of values within the server is sometimes considered a security feature to prevent SQL injection. The same degree of security can be achieved with non-prepared statements, if input values are escaped correctly\n\n\nTherefore, this proves that data validation such as intval() is a good idea for integer values before sending any query. In addition, preventing malicious user data before sending the query is a correct and valid approach.\n\nPlease see this question for more detail: PDO sends raw query to MySQL while Mysqli sends prepared query, both produce the same result\n\nReferences:\n\n\nSQL Injection Cheat Sheet\nSQL Injection\nInformation security\nSecurity Principles\nData validation\n\n    ","url":"/questions/[slug]#solution21","@type":"Answer","upvoteCount":0},{"text":"\n  Security Warning: This answer is not in line with security best practices. Escaping is inadequate to prevent SQL injection, use prepared statements instead. Use the strategy outlined below at your own risk. (Also, mysql_real_escape_string() was removed in PHP 7.)\n  \n  Deprecated Warning: The mysql extension is deprecated at this time. we recommend using the PDO extension\n\n\nI use three different ways to prevent my web application from being vulnerable to SQL injection.\n\n\nUse of mysql_real_escape_string(), which is a pre-defined function in PHP, and this code add backslashes to the following characters: \\x00, \\n, \\r, \\, &apos;, &quot; and \\x1a. Pass the input values as parameters to minimize the chance of SQL injection.\nThe most advanced way is to use PDOs.\n\n\nI hope this will help you.\n\nConsider the following query:\n\n$iId = mysql_real_escape_string(&quot;1 OR 1=1&quot;);\n $sSql = &quot;SELECT * FROM table WHERE id = $iId&quot;;\n\nmysql_real_escape_string() will not protect here. If you use single quotes (&apos; &apos;) around your variables inside your query is what protects you against this. Here is an solution below for this:\n\n$iId = (int) mysql_real_escape_string(&quot;1 OR 1=1&quot;);\n $sSql = &quot;SELECT * FROM table WHERE id = $iId&quot;;\n\nThis question has some good answers about this.\n\nI suggest, using PDO is the best option.\n\nEdit:\n\nmysql_real_escape_string() is deprecated as of PHP 5.5.0. Use either mysqli or PDO.\n\nAn alternative to mysql_real_escape_string() is \n\nstring mysqli_real_escape_string ( mysqli $link , string $escapestr )\n\n\nExample:\n\n$iId = $mysqli-&gt;real_escape_string(&quot;1 OR 1=1&quot;);\n$mysqli-&gt;query(&quot;SELECT * FROM table WHERE id = $iId&quot;);\n\n    ","url":"/questions/[slug]#solution22","@type":"Answer","upvoteCount":0},{"text":"A simple way would be to use a PHP framework like CodeIgniter or Laravel which have inbuilt features like filtering and active-record so that you don&apos;t have to worry about these nuances.\n    ","url":"/questions/[slug]#solution23","@type":"Answer","upvoteCount":0},{"text":"Warning: the approach described in this answer only applies to very specific scenarios and isn&apos;t secure since SQL injection attacks do not only rely on being able to inject X=Y.\n\nIf the attackers are trying to hack into the form via PHP&apos;s $_GET variable or with the URL&apos;s query string, you would be able to catch them if they&apos;re not secure.\n\nRewriteCond %{QUERY_STRING} ([0-9]+)=([0-9]+)\nRewriteRule ^(.*) ^/track.php\n\n\nBecause 1=1, 2=2, 1=2, 2=1, 1+1=2, etc... are the common questions to an SQL database of an attacker. Maybe also it&apos;s used by many hacking applications.\n\nBut you must be careful, that you must not rewrite a safe query from your site. The code above is giving you a tip, to rewrite or redirect (it depends on you) that hacking-specific dynamic query string into a page that will store the attacker&apos;s IP address, or EVEN THEIR COOKIES, history, browser, or any other sensitive information, so you can deal with them later by banning their account or contacting authorities.\n    ","url":"/questions/[slug]#solution24","@type":"Answer","upvoteCount":0},{"text":"A good idea is to use an object-relational mapper like Idiorm:\n\n$user = ORM::for_table(&apos;user&apos;)\n-&gt;where_equal(&apos;username&apos;, &apos;j4mie&apos;)\n-&gt;find_one();\n\n$user-&gt;first_name = &apos;Jamie&apos;;\n$user-&gt;save();\n\n$tweets = ORM::for_table(&apos;tweet&apos;)\n    -&gt;select(&apos;tweet.*&apos;)\n    -&gt;join(&apos;user&apos;, array(\n        &apos;user.id&apos;, &apos;=&apos;, &apos;tweet.user_id&apos;\n    ))\n    -&gt;where_equal(&apos;user.username&apos;, &apos;j4mie&apos;)\n    -&gt;find_many();\n\nforeach ($tweets as $tweet) {\n    echo $tweet-&gt;text;\n}\n\n\nIt not only saves you from SQL injections, but from syntax errors too! It also supports collections of models with method chaining to filter or apply actions to multiple results at once and multiple connections.\n    ","url":"/questions/[slug]#solution25","@type":"Answer","upvoteCount":0},{"text":"There are so many answers for PHP and MySQL, but here is code for PHP and Oracle for preventing SQL injection as well as regular use of oci8 drivers:\n\n$conn = oci_connect($username, $password, $connection_string);\n$stmt = oci_parse($conn, &apos;UPDATE table SET field = :xx WHERE ID = 123&apos;);\noci_bind_by_name($stmt, &apos;:xx&apos;, $fieldval);\noci_execute($stmt);\n\n    ","url":"/questions/[slug]#solution26","@type":"Answer","upvoteCount":0},{"text":"\n  Deprecated Warning:\n  This answer&apos;s sample code (like the question&apos;s sample code) uses PHP&apos;s MySQL extension, which was deprecated in PHP 5.5.0 and removed entirely in PHP 7.0.0.\n  \n  Security Warning: This answer is not in line with security best practices. Escaping is inadequate to prevent SQL injection, use prepared statements instead. Use the strategy outlined below at your own risk. (Also, mysql_real_escape_string() was removed in PHP 7.)\n\n\nUsing PDO and MYSQLi is a good practice to prevent SQL injections, but if you really want to work with MySQL functions and queries, it would be better to use\n\nmysql_real_escape_string\n\n$unsafe_variable = mysql_real_escape_string($_POST[&apos;user_input&apos;]);\n\n\nThere are more abilities to prevent this: like identify - if the input is a string, number, char or array, there are so many inbuilt functions to detect this. Also, it would be better to use these functions to check input data.\n\nis_string\n\n$unsafe_variable = (is_string($_POST[&apos;user_input&apos;]) ? $_POST[&apos;user_input&apos;] : &apos;&apos;);\n\n\nis_numeric\n\n$unsafe_variable = (is_numeric($_POST[&apos;user_input&apos;]) ? $_POST[&apos;user_input&apos;] : &apos;&apos;);\n\n\nAnd it is so much better to use those functions to check input data with mysql_real_escape_string.\n    ","url":"/questions/[slug]#solution27","@type":"Answer","upvoteCount":0},{"text":"I&apos;ve written this little function several years ago:\n\nfunction sqlvprintf($query, $args)\n{\n    global $DB_LINK;\n    $ctr = 0;\n    ensureConnection(); // Connect to database if not connected already.\n    $values = array();\n    foreach ($args as $value)\n    {\n        if (is_string($value))\n        {\n            $value = &quot;&apos;&quot; . mysqli_real_escape_string($DB_LINK, $value) . &quot;&apos;&quot;;\n        }\n        else if (is_null($value))\n        {\n            $value = &apos;NULL&apos;;\n        }\n        else if (!is_int($value) &amp;&amp; !is_float($value))\n        {\n            die(&apos;Only numeric, string, array and NULL arguments allowed in a query. Argument &apos;.($ctr+1).&apos; is not a basic type, it\\&apos;s type is &apos;. gettype($value). &apos;.&apos;);\n        }\n        $values[] = $value;\n        $ctr++;\n    }\n    $query = preg_replace_callback(\n        &apos;/{(\\\\d+)}/&apos;, \n        function($match) use ($values)\n        {\n            if (isset($values[$match[1]]))\n            {\n                return $values[$match[1]];\n            }\n            else\n            {\n                return $match[0];\n            }\n        },\n        $query\n    );\n    return $query;\n}\n\nfunction runEscapedQuery($preparedQuery /*, ...*/)\n{\n    $params = array_slice(func_get_args(), 1);\n    $results = runQuery(sqlvprintf($preparedQuery, $params)); // Run query and fetch results.   \n    return $results;\n}\n\n\nThis allows running statements in an one-liner C#-ish String.Format like:\n\nrunEscapedQuery(&quot;INSERT INTO Whatever (id, foo, bar) VALUES ({0}, {1}, {2})&quot;, $numericVar, $stringVar1, $stringVar2);\n\n\nIt escapes considering the variable type. If you try to parameterize table, column names, it would fail as it puts every string in quotes which is an invalid syntax.\n\nSECURITY UPDATE: The previous str_replace version allowed injections by adding {#} tokens into user data. This preg_replace_callback version doesn&apos;t cause problems if the replacement contains these tokens.\n    ","url":"/questions/[slug]#solution28","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/08bcc42a26fe5c92.css" as="style"/><link rel="stylesheet" href="/_next/static/css/08bcc42a26fe5c92.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-ccfab947c79712f4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-08d1a634dea6705e.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/150-b06815e21c943e0d.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/108-87de33c23337ff53.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-79a1437acf654019.js" defer=""></script><script src="/_next/static/6ctJfCympFH_chh5mjicD/_buildManifest.js" defer=""></script><script src="/_next/static/6ctJfCympFH_chh5mjicD/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h4 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h4></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/how-can-i-prevent-sql-injection-in-php-1657384220094#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/how-can-i-prevent-sql-injection-in-php-1657384220094"><h1>How can I prevent SQL injection in PHP?</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/sql-injection">sql-injection</a></div></div><div class="question-content mt-5">
                    <div>
            <aside class="s-notice s-notice__info post-notice js-post-notice mb16" role="status">
        <div class="d-flex fd-column fw-nowrap">
            <div class="d-flex fw-nowrap">
                    <div class="flex--item mr8">
                        <svg aria-hidden="true" class="svg-icon iconLock" width="18" height="18" viewBox="0 0 18 18"><path d="M16 9a2 2 0 0 0-2-2V6A5 5 0 0 0 4 6v1a2 2 0 0 0-2 2v6c0 1.1.9 2 2 2h10a2 2 0 0 0 2-2V9Zm-7 5a2 2 0 1 1 0-4 2 2 0 0 1 0 4Zm3.1-7H5.9V6a3.1 3.1 0 0 1 6.2 0v1Z"></path></svg>
                    </div>
                <div class="flex--item wmn0 fl1 lh-lg">
                    <div class="flex--item fl1 lh-lg">
                        <b>This question's answers are a <a href="/help/privileges/edit-community-wiki">community effort</a></b>. Edit existing answers to improve this post. It is not currently accepting new answers or interactions.
                        
                    </div>
                </div>
            </div>
        </div>
</aside>

    </div>

<p>If user input is inserted without modification into an SQL query, then the application becomes vulnerable to <a href="https://stackoverflow.com/a/332367/">SQL injection</a>, like in the following example:</p>

<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-variable">$unsafe_variable</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'user_input'</span>]; 

<span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-string">"INSERT INTO `table` (`column`) VALUES ('<span class="hljs-subst">$unsafe_variable</span>')"</span>);
</code></pre>

<p>That's because the user can input something like <code>value'); DROP TABLE table;--</code>, and the query becomes:</p>

<pre class="default s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `<span class="hljs-keyword">table</span>` (`<span class="hljs-keyword">column</span>`) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'value'</span>); <span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">table</span>;<span class="hljs-comment">--')</span>
</code></pre>

<p>What can be done to prevent this from happening?</p>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li><li class="pagination-solution-item"><span data-id="#solution3" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">3</span></li><li class="pagination-solution-item"><span data-id="#solution4" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">4</span></li><li class="pagination-solution-item"><span data-id="#solution5" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">5</span></li><li class="pagination-solution-item"><span data-id="#solution6" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">6</span></li><li class="pagination-solution-item"><span data-id="#solution7" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">7</span></li><li class="pagination-solution-item"><span data-id="#solution8" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">8</span></li><li class="pagination-solution-item"><span data-id="#solution9" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">9</span></li><li class="pagination-solution-item"><span data-id="#solution10" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">10</span></li><li class="pagination-solution-item"><span data-id="#solution11" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">11</span></li><li class="pagination-solution-item"><span data-id="#solution12" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">12</span></li><li class="pagination-solution-item"><span data-id="#solution13" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">13</span></li><li class="pagination-solution-item"><span data-id="#solution14" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">14</span></li><li class="pagination-solution-item"><span data-id="#solution15" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">15</span></li><li class="pagination-solution-item"><span data-id="#solution16" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">16</span></li><li class="pagination-solution-item"><span data-id="#solution17" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">17</span></li><li class="pagination-solution-item"><span data-id="#solution18" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">18</span></li><li class="pagination-solution-item"><span data-id="#solution19" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">19</span></li><li class="pagination-solution-item"><span data-id="#solution20" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">20</span></li><li class="pagination-solution-item"><span data-id="#solution21" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">21</span></li><li class="pagination-solution-item"><span data-id="#solution22" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">22</span></li><li class="pagination-solution-item"><span data-id="#solution23" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">23</span></li><li class="pagination-solution-item"><span data-id="#solution24" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">24</span></li><li class="pagination-solution-item"><span data-id="#solution25" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">25</span></li><li class="pagination-solution-item"><span data-id="#solution26" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">26</span></li><li class="pagination-solution-item"><span data-id="#solution27" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">27</span></li><li class="pagination-solution-item"><span data-id="#solution28" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">28</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The <em>correct</em> way to avoid SQL injection attacks, no matter which database you use, is to <strong>separate the data from SQL</strong>, so that data stays data and will <strong>never be interpreted</strong> as commands by the SQL parser. It is possible to create an SQL statement with correctly formatted data parts, but if you don't <em>fully</em> understand the details, you should always <strong>use prepared statements and parameterized queries.</strong> These are SQL statements that are sent to and parsed by the database server separately from any parameters. This way it is impossible for an attacker to inject malicious SQL.</p>
<p>You basically have two options to achieve this:</p>
<ol>
<li><p>Using <a href="http://php.net/manual/en/book.pdo.php" rel="noreferrer"><strong>PDO</strong></a> (for any supported database driver):</p>
 <pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$pdo</span>-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">'SELECT * FROM employees WHERE name = :name'</span>);
<span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>([ <span class="hljs-string">'name'</span> =&gt; <span class="hljs-variable">$name</span> ]);

<span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$stmt</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$row</span>) {
    <span class="hljs-comment">// Do something with $row</span>
}
</code></pre>
</li>
<li><p>Using <a href="http://php.net/manual/en/book.mysqli.php" rel="noreferrer"><strong>MySQLi</strong></a> (for MySQL):</p>
 <pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$dbConnection</span>-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">'SELECT * FROM employees WHERE name = ?'</span>);
<span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">bind_param</span>(<span class="hljs-string">'s'</span>, <span class="hljs-variable">$name</span>); <span class="hljs-comment">// 's' specifies the variable type =&gt; 'string'</span>
<span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>();

<span class="hljs-variable">$result</span> = <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">get_result</span>();
<span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">fetch_assoc</span>()) {
    <span class="hljs-comment">// Do something with $row</span>
}
</code></pre>
</li>
</ol>
<p>If you're connecting to a database other than MySQL, there is a driver-specific second option that you can refer to (for example, <code>pg_prepare()</code> and <code>pg_execute()</code> for PostgreSQL). PDO is the universal option.</p>
<hr>
<h2>Correctly setting up the connection</h2>
<h4>PDO</h4>
<p>Note that when using <strong>PDO</strong> to access a MySQL database <em>real</em> prepared statements are <strong>not used by default</strong>. To fix this you have to disable the emulation of prepared statements. An example of creating a connection using <strong>PDO</strong> is:</p>
<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-variable">$dbConnection</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">PDO</span>(<span class="hljs-string">'mysql:dbname=dbtest;host=127.0.0.1;charset=utf8mb4'</span>, <span class="hljs-string">'user'</span>, <span class="hljs-string">'password'</span>);

<span class="hljs-variable">$dbConnection</span>-&gt;<span class="hljs-title function_ invoke__">setAttribute</span>(PDO::<span class="hljs-variable constant_">ATTR_EMULATE_PREPARES</span>, <span class="hljs-literal">false</span>);
<span class="hljs-variable">$dbConnection</span>-&gt;<span class="hljs-title function_ invoke__">setAttribute</span>(PDO::<span class="hljs-variable constant_">ATTR_ERRMODE</span>, PDO::<span class="hljs-variable constant_">ERRMODE_EXCEPTION</span>);
</code></pre>
<p>In the above example, the error mode isn't strictly necessary, <strong>but it is advised to add it</strong>. This way PDO will inform you of all MySQL errors by means of throwing the <code>PDOException</code>.</p>
<p>What is <strong>mandatory</strong>, however, is the first <code>setAttribute()</code> line, which tells PDO to disable emulated prepared statements and use <em>real</em> prepared statements. This makes sure the statement and the values aren't parsed by PHP before sending it to the MySQL server (giving a possible attacker no chance to inject malicious SQL).</p>
<p>Although you can set the <code>charset</code> in the options of the constructor, it's important to note that 'older' versions of PHP (before 5.3.6) <a href="http://php.net/manual/en/ref.pdo-mysql.connection.php" rel="noreferrer">silently ignored the charset parameter</a> in the DSN.</p>
<h4>Mysqli</h4>
<p>For mysqli we have to follow the same routine:</p>
<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-title function_ invoke__">mysqli_report</span>(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT); <span class="hljs-comment">// error reporting</span>
<span class="hljs-variable">$dbConnection</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-string">'127.0.0.1'</span>, <span class="hljs-string">'username'</span>, <span class="hljs-string">'password'</span>, <span class="hljs-string">'test'</span>);
<span class="hljs-variable">$dbConnection</span>-&gt;<span class="hljs-title function_ invoke__">set_charset</span>(<span class="hljs-string">'utf8mb4'</span>); <span class="hljs-comment">// charset</span>
</code></pre>
<hr>
<h2>Explanation</h2>
<p>The SQL statement you pass to <code>prepare</code> is parsed and compiled by the database server. By specifying parameters (either a <code>?</code> or a named parameter like <code>:name</code> in the example above) you tell the database engine where you want to filter on. Then when you call <code>execute</code>, the prepared statement is combined with the parameter values you specify.</p>
<p>The important thing here is that the parameter values are combined with the compiled statement, not an SQL string. SQL injection works by tricking the script into including malicious strings when it creates SQL to send to the database. So by sending the actual SQL separately from the parameters, you limit the risk of ending up with something you didn't intend.</p>
<p>Any parameters you send when using a prepared statement will just be treated as strings (although the database engine may do some optimization so parameters may end up as numbers too, of course). In the example above, if the <code>$name</code> variable contains <code>'Sarah'; DELETE FROM employees</code> the result would simply be a search for the string <code>"'Sarah'; DELETE FROM employees"</code>, and you will not end up with <a href="http://xkcd.com/327/" rel="noreferrer">an empty table</a>.</p>
<p>Another benefit of using prepared statements is that if you execute the same statement many times in the same session it will only be parsed and compiled once, giving you some speed gains.</p>
<p>Oh, and since you asked about how to do it for an insert, here's an example (using PDO):</p>
<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-variable">$preparedStatement</span> = <span class="hljs-variable">$db</span>-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">'INSERT INTO table (column) VALUES (:column)'</span>);

<span class="hljs-variable">$preparedStatement</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>([ <span class="hljs-string">'column'</span> =&gt; <span class="hljs-variable">$unsafeValue</span> ]);
</code></pre>
<hr>
<h2>Can prepared statements be used for dynamic queries?</h2>
<p>While you can still use prepared statements for the query parameters, the structure of the dynamic query itself cannot be parametrized and certain query features cannot be parametrized.</p>
<p>For these specific scenarios, the best thing to do is use a whitelist filter that restricts the possible values.</p>
<pre class="default s-code-block"><code class="hljs language-php"><span class="hljs-comment">// Value whitelist</span>
<span class="hljs-comment">// $dir can only be 'DESC', otherwise it will be 'ASC'</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$dir</span>) || <span class="hljs-variable">$dir</span> !== <span class="hljs-string">'DESC'</span>) {
   <span class="hljs-variable">$dir</span> = <span class="hljs-string">'ASC'</span>;
}
</code></pre>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>To use the parameterized query, you need to use either Mysqli or PDO. To rewrite your example with mysqli, we would need something like the following.</p>
<pre class="default s-code-block"><code class="hljs language-php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">mysqli_report</span>(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT);
<span class="hljs-variable">$mysqli</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-string">"server"</span>, <span class="hljs-string">"username"</span>, <span class="hljs-string">"password"</span>, <span class="hljs-string">"database_name"</span>);

<span class="hljs-variable">$variable</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">"user-input"</span>];
<span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">"INSERT INTO table (column) VALUES (?)"</span>);
<span class="hljs-comment">// "s" means the database expects a string</span>
<span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">bind_param</span>(<span class="hljs-string">"s"</span>, <span class="hljs-variable">$variable</span>);
<span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>();
</code></pre>
<p>The key function you'll want to read up on there would be <a href="http://php.net/mysqli.prepare" rel="noreferrer"><code>mysqli::prepare</code></a>.</p>
<p>Also, as others have suggested, you may find it useful/easier to step up a layer of abstraction with something like <a href="http://php.net/pdo" rel="noreferrer">PDO</a>.</p>
<p>Please note that the case you asked about is a fairly simple one and that more complex cases may require more complex approaches. In particular:</p>
<ul>
<li>If you want to alter the structure of the SQL based on user input, parameterized queries are not going to help, and the escaping required is not covered by <code>mysql_real_escape_string</code>. In this kind of case, you would be better off passing the user's input through a whitelist to ensure only 'safe' values are allowed through.</li>
</ul>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Every answer here covers only part of the problem.
In fact, there are <strong>four</strong> different query parts which we can add to SQL dynamically: -</p>
<ul>
<li>a string</li>
<li>a number</li>
<li>an identifier</li>
<li>a syntax keyword</li>
</ul>
<p>And prepared statements cover only two of them.</p>
<p>But sometimes we have to make our query even more dynamic, adding operators or identifiers as well.
So, we will need different protection techniques.</p>
<p>In general, such a protection approach is based on <em>whitelisting</em>.</p>
<p>In this case, every dynamic parameter should be hardcoded in your script and chosen from that set.
For example, to do dynamic ordering:</p>
<pre class="default s-code-block"><code class="hljs language-php"><span class="hljs-variable">$orders</span>  = <span class="hljs-keyword">array</span>(<span class="hljs-string">"name"</span>, <span class="hljs-string">"price"</span>, <span class="hljs-string">"qty"</span>); <span class="hljs-comment">// Field names</span>
<span class="hljs-variable">$key</span> = <span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'sort'</span>], <span class="hljs-variable">$orders</span>)); <span class="hljs-comment">// if we have such a name</span>
<span class="hljs-variable">$orderby</span> = <span class="hljs-variable">$orders</span>[<span class="hljs-variable">$key</span>]; <span class="hljs-comment">// If not, first one will be set automatically. </span>
<span class="hljs-variable">$query</span> = <span class="hljs-string">"SELECT * FROM `table` ORDER BY <span class="hljs-subst">$orderby</span>"</span>; <span class="hljs-comment">// Value is safe</span>
</code></pre>
<p>To ease the process I wrote a <a href="https://phpdelusions.net/pdo_examples/order_by" rel="noreferrer">whitelist helper function</a> that does all the job in one line:</p>
<pre class="default s-code-block"><code class="hljs language-php"><span class="hljs-variable">$orderby</span> = <span class="hljs-title function_ invoke__">white_list</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'orderby'</span>], <span class="hljs-string">"name"</span>, [<span class="hljs-string">"name"</span>,<span class="hljs-string">"price"</span>,<span class="hljs-string">"qty"</span>], <span class="hljs-string">"Invalid field name"</span>);
<span class="hljs-variable">$query</span>  = <span class="hljs-string">"SELECT * FROM `table` ORDER BY `<span class="hljs-subst">$orderby</span>`"</span>; <span class="hljs-comment">// sound and safe</span>
</code></pre>
<p>There is another way to secure identifiers - escaping but I rather stick to whitelisting as a more robust and explicit approach. Yet as long as you have an identifier quoted, you can escape the quote character to make it safe. For example, by default for mysql you have to <a href="https://dev.mysql.com/doc/refman/8.0/en/identifiers.html" rel="noreferrer">double the quote character to escape it</a>. For other other DBMS escaping rules would be different.</p>
<p>Still, there is an issue with SQL syntax keywords (such as <code>AND</code>, <code>DESC</code> and such), but white-listing seems the only approach in this case.</p>
<p>So, a general recommendation may be phrased as</p>
<blockquote>
<ul>
<li>Any variable that represents an SQL data literal, (or, to put it simply - an SQL string, or a number) must be added through a prepared statement. No Exceptions.</li>
<li>Any other query part, such as an SQL keyword, a table or a field name, or an operator - must be filtered through a white list.</li>
</ul>
</blockquote>
<h3>Update</h3>
<p>Although there is a general agreement on the best practices regarding SQL injection protection, there are <strong>still many bad practices as well.</strong> And some of them too deeply rooted in the minds of PHP users. For instance, on this very page there are (although invisible to most visitors) <strong>more than 80 deleted answers</strong> - all removed by the community due to bad quality or promoting bad and outdated practices. Worse yet, some of the bad answers aren't deleted, but rather prospering.</p>
<p>For example, <a href="https://stackoverflow.com/a/11802479">there(1)</a> <a href="https://stackoverflow.com/a/6381189">are(2)</a> <a href="https://stackoverflow.com/a/60195/">still(3)</a> <a href="https://stackoverflow.com/a/12426697/">many(4)</a> <a href="https://stackoverflow.com/a/21179234">answers(5)</a>, including the <a href="https://stackoverflow.com/a/60442">second most upvoted answer</a> suggesting you manual string escaping - an outdated approach that is proven to be insecure.</p>
<p>Or there is a slightly better answer that suggests just <a href="https://stackoverflow.com/a/12710285">another method of string formatting</a> and even boasts it as the ultimate panacea. While of course, it is not. This method is no better than regular string formatting, yet it keeps all its drawbacks: it is applicable to strings only and, like any other manual formatting, it's essentially optional, non-obligatory measure, prone to human error of any sort.</p>
<p>I think that all this because of one very old superstition, supported by such authorities like <a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet#Defense_Option_4:_Escaping_All_User_Supplied_Input" rel="noreferrer">OWASP</a> or <a href="http://php.net/manual/en/function.mysql-real-escape-string.php#refsect1-function.mysql-real-escape-string-description" rel="noreferrer">the PHP manual</a>, which proclaims equality between whatever "escaping" and protection from SQL injections.</p>
<p>Regardless of what PHP manual said for ages, <strong><code>*_escape_string</code> by no means makes data safe</strong> and never has been intended to. Besides being useless for any SQL part other than string, manual escaping is wrong, because it is manual as opposite to automated.</p>
<p>And OWASP makes it even worse, stressing on escaping <em>user input</em> which is an utter nonsense: there should be no such words in the context of injection protection. Every variable is potentially dangerous - no matter the source! Or, in other words - every variable has to be properly formatted to be put into a query - no matter the source again. It's the destination that matters. The moment a developer starts to separate the sheep from the goats (thinking whether some particular variable is "safe" or not) he/she takes his/her first step towards disaster. Not to mention that even the wording suggests bulk escaping at the entry point, resembling the very magic quotes feature - already despised, deprecated and removed.</p>
<p>So, unlike whatever "escaping", prepared statements <em>is</em> the measure that indeed protects from SQL injection (when applicable).</p>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I'd recommend using <a href="http://ca3.php.net/manual/en/book.pdo.php" rel="noreferrer">PDO</a> (PHP Data Objects) to run parameterized SQL queries. </p>

<p>Not only does this protect against SQL injection, but it also speeds up queries. </p>

<p>And by using PDO rather than <code>mysql_</code>, <code>mysqli_</code>, and <code>pgsql_</code> functions, you make your application a little more abstracted from the database, in the rare occurrence that you have to switch database providers.</p>
    </div></div></div></div><div id="solution5" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Use <code>PDO</code> and prepared queries.</p>
<p>(<code>$conn</code> is a <code>PDO</code> object)</p>
<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$conn</span>-&gt;prepare(<span class="hljs-string">"INSERT INTO tbl VALUES(:id, :name)"</span>);
<span class="hljs-variable">$stmt</span>-&gt;bindValue(<span class="hljs-string">':id'</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-variable">$stmt</span>-&gt;bindValue(<span class="hljs-string">':name'</span>, <span class="hljs-variable">$name</span>);
<span class="hljs-variable">$stmt</span>-&gt;execute();
</code></pre>
    </div></div></div></div><div id="solution6" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>As you can see, people suggest you use prepared statements at the most. It's not wrong, but when your query is executed <strong>just once</strong> per process, there would be a slight performance penalty. </p>

<p>I was facing this issue, but I think I solved it in <em>very</em> sophisticated way - the way hackers use to avoid using quotes. I used this in conjunction with emulated prepared statements. I use it to prevent <em>all</em> kinds of possible SQL injection attacks.</p>

<h2>My approach:</h2>

<ul>
<li><p>If you expect input to be integer make sure it's <strong><em>really</em></strong> integer. In a variable-type language like PHP it is this <em>very</em> important. You can use for example this very simple but powerful solution: <code>sprintf("SELECT 1,2,3 FROM table WHERE 4 = %u", $input);</code>  </p></li>
<li><p>If you expect anything else from integer <strong>hex it</strong>. If you hex it, you will perfectly escape all input. In C/C++ there's a function called <a href="http://dev.mysql.com/doc/refman/5.0/en/mysql-hex-string.html" rel="noreferrer"><code>mysql_hex_string()</code></a>, in PHP you can use <a href="http://www.php.net/manual/en/function.bin2hex.php" rel="noreferrer"><code>bin2hex()</code></a>.</p>

<p>Don't worry about that the escaped string will have a 2x size of its original length because even if you use <code>mysql_real_escape_string</code>, PHP has to allocate same capacity <code>((2*input_length)+1)</code>, which is the same.</p></li>
<li><p>This hex method is often used when you transfer binary data, but I see no reason why not use it on all data to prevent SQL injection attacks. Note that you have to prepend data with <code>0x</code> or use the MySQL function <code>UNHEX</code> instead.</p></li>
</ul>

<p>So, for example, the query:</p>

<pre class="default s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> password <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'root'</span>;
</code></pre>

<p>Will become:</p>

<pre class="default s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> password <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-number">0x726f6f74</span>;
</code></pre>

<p>or</p>

<pre class="default s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> password <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> UNHEX(<span class="hljs-string">'726f6f74'</span>);
</code></pre>

<p>Hex is the perfect escape. No way to inject.</p>

<h2>Difference between UNHEX function and 0x prefix</h2>

<p>There was some discussion in comments, so I finally want to make it clear. These two approaches are very similar, but they are a little different in some ways:</p>

<p>The <code>0x</code> prefix can only be used for data columns such as <code>char</code>, <code>varchar</code>, <code>text</code>, <code>block</code>, <code>binary</code>, etc.<br>
Also, its use is a little complicated if you are about to insert an empty string. You'll have to entirely replace it with <code>''</code>, or you'll get an error.</p>

<p><code>UNHEX()</code> works on <strong>any</strong> column; you do not have to worry about the empty string.</p>

<hr>

<h2>Hex methods are often used as attacks</h2>

<p>Note that this hex method is often used as an SQL injection attack where integers are just like strings and escaped just with <code>mysql_real_escape_string</code>. Then you can avoid the use of quotes.</p>

<p>For example, if you just do something like this:</p>

<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-string">"SELECT title FROM article WHERE id = "</span> . mysql_real_escape_string(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">"id"</span>])
</code></pre>

<p>an attack can inject you very <em>easily</em>. Consider the following injected code returned from your script:</p>

<pre class="default s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">-1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> table_name <span class="hljs-keyword">FROM</span> information_schema.tables;
</code></pre>

<p>and now just extract table structure:</p>

<pre class="default s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">-1</span> <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> column_name <span class="hljs-keyword">FROM</span> information_schema.column <span class="hljs-keyword">WHERE</span> table_name <span class="hljs-operator">=</span> __0x61727469636c65__;
</code></pre>

<p>And then just select whatever data ones want. Isn't it cool?</p>

<p>But if the coder of an injectable site would hex it, no injection would be possible because the query would look like this:</p>

<pre class="default s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> UNHEX(<span class="hljs-string">'2d312075...3635'</span>);
</code></pre>
    </div></div></div></div><div id="solution7" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 7</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<blockquote>
  <p><strong>Deprecated Warning:</strong>
  This answer's sample code (like the question's sample code) uses PHP's <code>MySQL</code> extension, which was deprecated in PHP 5.5.0 and removed entirely in PHP 7.0.0.</p>
  
  <p><strong>Security Warning</strong>: This answer is not in line with security best practices. <a href="https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide" rel="noreferrer">Escaping is inadequate to prevent SQL injection</a>, use <em>prepared statements</em> instead. Use the strategy outlined below at your own risk. (Also, <code>mysql_real_escape_string()</code> was removed in PHP 7.)</p>
  
  <p><strong>IMPORTANT</strong></p>
  
  <p>The best way to prevent SQL Injection is to use <strong>Prepared Statements</strong> <em>instead of escaping</em>, as <a href="https://stackoverflow.com/a/60496/2224584">the accepted answer</a> demonstrates. </p>
  
  <p>There are libraries such as <a href="https://github.com/auraphp/Aura.Sql" rel="noreferrer">Aura.Sql</a> and <a href="https://github.com/paragonie/easydb" rel="noreferrer">EasyDB</a> that allow developers to use prepared statements easier. To learn more about why prepared statements are better at <a href="https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide" rel="noreferrer">stopping SQL injection</a>, refer to <a href="https://stackoverflow.com/a/12118602/2224584">this <code>mysql_real_escape_string()</code> bypass</a> and <a href="https://kraft.im/2015/05/how-emoji-saved-your-sites-hide/" rel="noreferrer">recently fixed Unicode SQL Injection vulnerabilities in WordPress</a>.</p>
</blockquote>

<p>Injection prevention - <a href="http://php.net/manual/en/function.mysql-real-escape-string.php" rel="noreferrer">mysql_real_escape_string()</a></p>

<p>PHP has a specially-made function to prevent these attacks. All you need to do is use the mouthful of a function, <code>mysql_real_escape_string</code>.</p>

<p><code>mysql_real_escape_string</code> takes a string that is going to be used in a MySQL query and return the same string with all SQL injection attempts safely escaped. Basically, it will replace those troublesome quotes(') a user might enter with a MySQL-safe substitute, an escaped quote \'.</p>

<p><strong>NOTE:</strong> you must be connected to the database to use this function!</p>

<p>// Connect to MySQL</p>

<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$name_bad</span> = <span class="hljs-string">"' OR 1'"</span>; 

<span class="hljs-variable">$name_bad</span> = mysql_real_escape_string(<span class="hljs-variable">$name_bad</span>);

<span class="hljs-variable">$query_bad</span> = <span class="hljs-string">"SELECT * FROM customers WHERE username = '<span class="hljs-variable">$name_bad</span>'"</span>;
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Escaped Bad Injection: &lt;br /&gt;"</span> . <span class="hljs-variable">$query_bad</span> . <span class="hljs-string">"&lt;br /&gt;"</span>;


<span class="hljs-variable">$name_evil</span> = <span class="hljs-string">"'; DELETE FROM customers WHERE 1 or username = '"</span>; 

<span class="hljs-variable">$name_evil</span> = mysql_real_escape_string(<span class="hljs-variable">$name_evil</span>);

<span class="hljs-variable">$query_evil</span> = <span class="hljs-string">"SELECT * FROM customers WHERE username = '<span class="hljs-variable">$name_evil</span>'"</span>;
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Escaped Evil Injection: &lt;br /&gt;"</span> . <span class="hljs-variable">$query_evil</span>;
</code></pre>

<p>You can find more details in <em><a href="http://www.tizag.com/mysqlTutorial/mysql-php-sql-injection.php" rel="noreferrer">MySQL - SQL Injection Prevention</a></em>.</p>
    </div></div></div></div><div id="solution8" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 8</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<blockquote>
<p><strong>Security Warning</strong>: This answer is not in line with security best practices. <a href="https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide" rel="nofollow noreferrer">Escaping is inadequate to prevent SQL injection</a>, use <em>prepared statements</em> instead. Use the strategy outlined below at your own risk.</p>
</blockquote>
<p>You could do something basic like this:</p>
<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$safe_variable</span> = mysqli_real_escape_string(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">"user-input"</span>], <span class="hljs-variable">$dbConnection</span>);
mysqli_query(<span class="hljs-variable">$dbConnection</span>, <span class="hljs-string">"INSERT INTO table (column) VALUES ('"</span> . <span class="hljs-variable">$safe_variable</span> . <span class="hljs-string">"')"</span>);
</code></pre>
<p>This won't solve every problem, but it's a very good stepping stone. I left out obvious items such as checking the variable's existence, format (numbers, letters, etc.).</p>
    </div></div></div></div><div id="solution9" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 9</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Whatever you do end up using, make sure that you check your input hasn't already been mangled by <code>magic_quotes</code> or some other well-meaning rubbish, and if necessary, run it through <code>stripslashes</code> or whatever to sanitize it.</p>
    </div></div></div></div><div id="solution10" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 10</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<blockquote>
  <p><strong>Deprecated Warning:</strong>
  This answer's sample code (like the question's sample code) uses PHP's <code>MySQL</code> extension, which was deprecated in PHP 5.5.0 and removed entirely in PHP 7.0.0.</p>
  
  <p><strong>Security Warning</strong>: This answer is not in line with security best practices. <a href="https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide" rel="noreferrer">Escaping is inadequate to prevent SQL injection</a>, use <em>prepared statements</em> instead. Use the strategy outlined below at your own risk. (Also, <code>mysql_real_escape_string()</code> was removed in PHP 7.)</p>
</blockquote>

<p>Parameterized query AND input validation is the way to go. There are many scenarios under which SQL injection may occur, even though <code>mysql_real_escape_string()</code> has been used.</p>

<p>Those examples are vulnerable to SQL injection:</p>

<pre class="default s-code-block"><code class="hljs language-php"><span class="hljs-variable">$offset</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'o'</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'o'</span>] : <span class="hljs-number">0</span>;
<span class="hljs-variable">$offset</span> = <span class="hljs-title function_ invoke__">mysql_real_escape_string</span>(<span class="hljs-variable">$offset</span>);
<span class="hljs-title function_ invoke__">RunQuery</span>(<span class="hljs-string">"SELECT userid, username FROM sql_injection_test LIMIT <span class="hljs-subst">$offset</span>, 10"</span>);
</code></pre>

<p>or</p>

<pre class="default s-code-block"><code class="hljs language-php"><span class="hljs-variable">$order</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'o'</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'o'</span>] : <span class="hljs-string">'userid'</span>;
<span class="hljs-variable">$order</span> = <span class="hljs-title function_ invoke__">mysql_real_escape_string</span>(<span class="hljs-variable">$order</span>);
<span class="hljs-title function_ invoke__">RunQuery</span>(<span class="hljs-string">"SELECT userid, username FROM sql_injection_test ORDER BY `<span class="hljs-subst">$order</span>`"</span>);
</code></pre>

<p>In both cases, you can't use <code>'</code> to protect the encapsulation.</p>

<p><a href="http://www.webappsec.org/projects/articles/091007.txt" rel="noreferrer">Source</a>: <em>The Unexpected SQL Injection (When Escaping Is Not Enough)</em></p>
    </div></div></div></div><div id="solution11" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 11</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In my opinion, the best way to generally prevent SQL injection in your PHP application (or any web application, for that matter) is to think about your application's architecture. If the only way to protect against SQL injection is to remember to use a special method or function that does The Right Thing every time you talk to the database, you are doing it wrong. That way, it's just a matter of time until you forget to correctly format your query at some point in your code.</p>

<p>Adopting the MVC pattern and a framework like <a href="http://cakephp.org/" rel="noreferrer">CakePHP</a> or <a href="http://codeigniter.com/" rel="noreferrer">CodeIgniter</a> is probably the right way to go: Common tasks like creating secure database queries have been solved and centrally implemented in such frameworks. They help you to organize your web application in a sensible way and make you think more about loading and saving objects than about securely constructing single SQL queries. </p>
    </div></div></div></div><div id="solution12" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 12</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>There are many ways of preventing SQL injections and other SQL hacks. You can easily find it on the Internet (Google Search). Of course <strong>PDO is one of the good solutions.</strong> But I would like to suggest you some good links prevention from SQL injection.</p>

<p><em><a href="http://www.tizag.com/mysqlTutorial/mysql-php-sql-injection.php" rel="noreferrer">What is SQL injection and how to prevent</a></em></p>

<p><em><a href="https://php.net/manual/en/security.database.sql-injection.php" rel="noreferrer">PHP manual for SQL injection</a></em></p>

<p><em><a href="https://docs.microsoft.com/en-gb/archive/blogs/brian_swan/whats-the-right-way-to-prevent-sql-injection-in-php-scripts" rel="noreferrer">Microsoft explanation of SQL injection and prevention in PHP</a></em></p>

<p>And some other like <em><a href="https://web.archive.org/web/20190221025712/http://www.digifuzz.net/archives/2007/07/preventing-sql-injection-with-php/" rel="noreferrer">Preventing SQL injection with MySQL and PHP</a></em>.</p>

<p>Now, <strong>why you do you need to prevent your query from SQL injection?</strong></p>

<p>I would like to let you know: Why do we try for preventing SQL injection with a short example below:</p>

<p>Query for login authentication match:</p>

<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$query</span>=<span class="hljs-string">"select * from users where email='"</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'email'</span>].<span class="hljs-string">"' and password='"</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>].<span class="hljs-string">"' "</span>;
</code></pre>

<p>Now, if someone (a hacker) puts</p>

<pre class="default s-code-block"><code class="hljs language-perl">$_POST[<span class="hljs-string">'email'</span>]= admin@emali.com<span class="hljs-string">' OR '</span><span class="hljs-number">1</span>=<span class="hljs-number">1</span>
</code></pre>

<p>and password anything....</p>

<p>The query will be parsed into the system only up to:</p>

<pre class="default s-code-block"><code class="hljs language-perl">$query=<span class="hljs-string">"select * from users where email='admin@emali.com' OR '1=1';
</span></code></pre>

<p>The other part will be discarded. So, what will happen? A non-authorized user (hacker) will be able to log in as administrator without having his/her password. Now, he/she can do anything that the administrator/email person can do. See, it's very dangerous if SQL injection is not prevented.</p>
    </div></div></div></div><div id="solution13" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 13</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I favor <a href="http://en.wikipedia.org/wiki/Stored_procedure" rel="noreferrer">stored procedures</a> (<a href="http://dev.mysql.com/doc/refman/5.1/en/stored-routines-syntax.html" rel="noreferrer">MySQL has had stored procedures support since 5.0</a>) from a security point of view - the advantages are -</p>

<ol>
<li>Most databases (including <a href="http://dev.mysql.com/doc/refman/5.1/en/stored-routines-privileges.html" rel="noreferrer">MySQL</a>) enable user access to be restricted to executing stored procedures. The fine-grained security access control is useful to prevent escalation of privileges attacks. This prevents compromised applications from being able to run SQL directly against the database.</li>
<li>They abstract the raw SQL query from the application so less information of the database structure is available to the application. This makes it harder for people to understand the underlying structure of the database and design suitable attacks.</li>
<li>They accept only parameters, so the advantages of parameterized queries are there. Of course - IMO you still need to sanitize your input - especially if you are using dynamic SQL inside the stored procedure.</li>
</ol>

<p>The disadvantages are -</p>

<ol>
<li>They (stored procedures) are tough to maintain and tend to multiply very quickly. This makes managing them an issue.</li>
<li>They are not very suitable for dynamic queries - if they are built to accept dynamic code as parameters then a lot of the advantages are negated.</li>
</ol>
    </div></div></div></div><div id="solution14" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 14</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I think if someone wants to use PHP and MySQL or some other dataBase server:</p>
<ol>
<li>Think about learning <a href="http://php.net/manual/en/book.pdo.php" rel="nofollow noreferrer">PDO</a> (PHP Data Objects)  it is a database access layer providing a uniform method of access to multiple databases.</li>
<li>Think about learning <a href="http://en.wikipedia.org/wiki/MySQLi" rel="nofollow noreferrer">MySQLi</a></li>
</ol>
<hr>
<p><strong>Libraries examples:</strong></p>
<p>---- <strong>PDO</strong></p>
<blockquote>
<p>----- No placeholders - ripe for SQL injection! <strong>It's bad</strong></p>
</blockquote>
<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$request</span> = <span class="hljs-variable">$pdoConnection</span>-&gt;(<span class="hljs-string">"INSERT INTO parents (name, addr, city) values (<span class="hljs-variable">$name</span>, <span class="hljs-variable">$addr</span>, <span class="hljs-variable">$city</span>)"</span>);
</code></pre>
<blockquote>
<p>----- Unnamed placeholders</p>
</blockquote>
<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$request</span> = <span class="hljs-variable">$pdoConnection</span>-&gt;(<span class="hljs-string">"INSERT INTO parents (name, addr, city) values (?, ?, ?);
</span></code></pre>
<blockquote>
<p>----- Named placeholders</p>
</blockquote>
<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$request</span> = <span class="hljs-variable">$pdoConnection</span>-&gt;(<span class="hljs-string">"INSERT INTO parents (name, addr, city) value (:name, :addr, :city)"</span>);
</code></pre>
<p>--- <strong>MySQLi</strong></p>
<pre class="default s-code-block"><code class="hljs language-perl">$request = $mysqliConnection-&gt;prepare(<span class="hljs-string">'
       SELECT * FROM trainers
       WHERE name = ?
       AND email = ?
       AND last_login &gt; ?'</span>);

    $query-&gt;bind_param(<span class="hljs-string">'first_param'</span>, <span class="hljs-string">'second_param'</span>, $mail, <span class="hljs-keyword">time</span>() - <span class="hljs-number">3600</span>);
    $query-&gt;execute();
</code></pre>
<hr>
<p><strong>P.S</strong>:</p>
<p>PDO wins this battle with ease. With support for twelve
different database drivers and named parameters, we can get used to its API. From a security standpoint, both of them are safe as long as the developer uses them the way they are supposed to be used</p>
    </div></div></div></div><div id="solution15" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 15</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If possible, cast the types of your parameters. But it's only working on simple types like int, bool, and float.</p>

<pre class="default s-code-block"><code class="hljs language-php"><span class="hljs-variable">$unsafe_variable</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'user_id'</span>];

<span class="hljs-variable">$safe_variable</span> = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$unsafe_variable</span> ;

<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$conn</span>, <span class="hljs-string">"INSERT INTO table (column) VALUES ('"</span> . <span class="hljs-variable">$safe_variable</span> . <span class="hljs-string">"')"</span>);
</code></pre>
    </div></div></div></div><div id="solution16" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 16</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If you want to take advantage of cache engines, like <a href="http://en.wikipedia.org/wiki/Redis_%28data_store%29" rel="noreferrer">Redis</a> or <a href="http://en.wikipedia.org/wiki/Memcached" rel="noreferrer">Memcached</a>, maybe DALMP could be a choice. It uses pure <a href="http://en.wikipedia.org/wiki/MySQLi" rel="noreferrer">MySQLi</a>. Check this: <a href="http://dalmp.readthedocs.org/en/latest/database/PExecute.html" rel="noreferrer">DALMP Database Abstraction Layer for MySQL using PHP.</a> </p>

<p>Also, you can 'prepare' your arguments before preparing your query so that you can build dynamic queries and at the end have a fully prepared statements query. <a href="http://dalmp.readthedocs.org/en/latest/database/Prepare.html" rel="noreferrer">DALMP Database Abstraction Layer for MySQL using PHP.</a> </p>
    </div></div></div></div><div id="solution17" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 17</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>For those unsure of how to use PDO (coming from the <code>mysql_</code> functions), I made a <a href="https://github.com/Xeoncross/DByte/blob/master/DByte/DB.php" rel="nofollow noreferrer">very, very simple PDO wrapper</a> that is a single file. It exists to show how easy it is to do all the common things applications need to be done. Works with PostgreSQL, MySQL, and SQLite.</p>
<p>Basically, read it <a href="http://php.net/pdo" rel="nofollow noreferrer">while you read the manual</a> to see how to put the PDO functions to use in real life to make it simple to store and retrieve values in the format <strong>you</strong> want.</p>
<blockquote>
<p><strong>I want a single column</strong></p>
<pre class="default s-code-block"><code class="hljs language-ruby"><span class="hljs-variable">$count</span> = <span class="hljs-variable constant_">DB</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:column</span>(<span class="hljs-string">'SELECT COUNT(*) FROM `user`'</span>);
</code></pre>
<p><strong>I want an array(key =&gt; value) results (i.e. for making a selectbox)</strong></p>
<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-variable">$pairs</span> = DB::<span class="hljs-title function_ invoke__">pairs</span>(<span class="hljs-string">'SELECT `id`, `username` FROM `user`'</span>);
</code></pre>
<p><strong>I want a single row result</strong></p>
<pre class="default s-code-block"><code class="hljs language-php"><span class="hljs-variable">$user</span> = DB::<span class="hljs-title function_ invoke__">row</span>(<span class="hljs-string">'SELECT * FROM `user` WHERE `id` = ?'</span>, <span class="hljs-keyword">array</span>(<span class="hljs-variable">$user_id</span>));
</code></pre>
<p><strong>I want an array of results</strong></p>
<pre class="default s-code-block"><code class="hljs language-php"><span class="hljs-variable">$banned_users</span> = DB::<span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">'SELECT * FROM `user` WHERE `banned` = ?'</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">'TRUE'</span>));
</code></pre>
</blockquote>
    </div></div></div></div><div id="solution18" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 18</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<blockquote>
<p><strong>Security Warning</strong>: This answer is not in line with security best practices. <a href="https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide" rel="nofollow noreferrer">Escaping is inadequate to prevent SQL injection</a>, use <em>prepared statements</em> instead.</p>
</blockquote>
<p>A few guidelines for escaping special characters in SQL statements.</p>
<p>Don't use <a href="http://www.php.net/manual/en/intro.mysql.php" rel="nofollow noreferrer">MySQL</a>. This extension is deprecated. Use <a href="http://php.net/manual/en/book.mysqli.php" rel="nofollow noreferrer">MySQLi</a> or <a href="http://php.net/manual/en/book.pdo.php" rel="nofollow noreferrer">PDO</a> instead.</p>
<p><strong>MySQLi</strong></p>
<p>For manually escaping special characters in a string you can use the <a href="http://www.php.net/manual/en/mysqli.real-escape-string.php" rel="nofollow noreferrer">mysqli_real_escape_string</a> function. The function will not work properly unless the correct character set is set with <a href="http://www.php.net/manual/en/mysqli.set-charset.php" rel="nofollow noreferrer">mysqli_set_charset</a>.</p>
<p>Example:</p>
<pre class="default s-code-block"><code class="hljs language-php"><span class="hljs-variable">$mysqli</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-string">'host'</span>, <span class="hljs-string">'user'</span>, <span class="hljs-string">'password'</span>, <span class="hljs-string">'database'</span>);
<span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">set_charset</span>(<span class="hljs-string">'charset'</span>);

<span class="hljs-variable">$string</span> = <span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">real_escape_string</span>(<span class="hljs-variable">$string</span>);
<span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">"INSERT INTO table (column) VALUES ('<span class="hljs-subst">$string</span>')"</span>);
</code></pre>
<p>For automatic escaping of values with prepared statements, use <a href="http://www.php.net/manual/en/mysqli.prepare.php" rel="nofollow noreferrer">mysqli_prepare</a>, and <a href="http://www.php.net/manual/en/mysqli-stmt.bind-param.php" rel="nofollow noreferrer">mysqli_stmt_bind_param</a> where types for the corresponding bind variables must be provided for an appropriate conversion:</p>
<p>Example:</p>
<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$mysqli</span>-&gt;prepare(<span class="hljs-string">"INSERT INTO table (column1, column2) VALUES (?,?)"</span>);

<span class="hljs-variable">$stmt</span>-&gt;bind_param(<span class="hljs-string">"is"</span>, <span class="hljs-variable">$integer</span>, <span class="hljs-variable">$string</span>);

<span class="hljs-variable">$stmt</span>-&gt;execute();
</code></pre>
<p>No matter if you use prepared statements or <code>mysqli_real_escape_string</code>, you always have to know the type of input data you're working with.</p>
<p>So if you use a prepared statement, you must specify the types of the variables for <code>mysqli_stmt_bind_param</code> function.</p>
<p>And the use of <code>mysqli_real_escape_string</code> is for, as the name says, escaping special characters in a string, so it will not make integers safe. The purpose of this function is to prevent breaking the strings in SQL statements, and the damage to the database that it could cause. <code>mysqli_real_escape_string</code> is a useful function when used properly, especially when combined with <code>sprintf</code>.</p>
<p>Example:</p>
<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$string</span> = <span class="hljs-string">"x' OR name LIKE '%John%"</span>;
<span class="hljs-variable">$integer</span> = <span class="hljs-string">'5 OR id != 0'</span>;

<span class="hljs-variable">$query</span> = sprintf( <span class="hljs-string">"SELECT id, email, pass, name FROM members WHERE email ='%s' AND id = %d"</span>, <span class="hljs-variable">$mysqli</span>-&gt;real_escape_string(<span class="hljs-variable">$string</span>), <span class="hljs-variable">$integer</span>);

<span class="hljs-built_in">echo</span> <span class="hljs-variable">$query</span>;
// SELECT <span class="hljs-built_in">id</span>, email, pass, name FROM members WHERE email =<span class="hljs-string">'x\'</span> OR name LIKE \<span class="hljs-string">'%John%'</span> AND <span class="hljs-built_in">id</span> = 5

<span class="hljs-variable">$integer</span> = <span class="hljs-string">'99999999999999999999'</span>;
<span class="hljs-variable">$query</span> = sprintf(<span class="hljs-string">"SELECT id, email, pass, name FROM members WHERE email ='%s' AND id = %d"</span>, <span class="hljs-variable">$mysqli</span>-&gt;real_escape_string(<span class="hljs-variable">$string</span>), <span class="hljs-variable">$integer</span>);

<span class="hljs-built_in">echo</span> <span class="hljs-variable">$query</span>;
// SELECT <span class="hljs-built_in">id</span>, email, pass, name FROM members WHERE email =<span class="hljs-string">'x\'</span> OR name LIKE \<span class="hljs-string">'%John%'</span> AND <span class="hljs-built_in">id</span> = 2147483647
</code></pre>
    </div></div></div></div><div id="solution19" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 19</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<blockquote>
<p><strong>Security Warning</strong>: This answer is not in line with security best practices. <a href="https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide" rel="nofollow noreferrer">Escaping is inadequate to prevent SQL injection</a>, use <em>prepared statements</em> instead. Use the strategy outlined below at your own risk. (Also, <code>mysql_real_escape_string()</code> was removed in PHP 7.)</p>
</blockquote>
<blockquote>
<p><strong>Warning</strong>: The mysql extension is removed at this time. we recommend using the <em>PDO extension</em></p>
</blockquote>
<p>Using this PHP function <code>mysql_escape_string()</code> you can get a good prevention in a fast way.</p>
<p>For example:</p>
<pre class="default s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'".mysql_escape_string($name_from_html_form)."'</span>
</code></pre>
<p><code>mysql_escape_string</code>  Escapes a string for use in a mysql_query</p>
<p>For more prevention, you can add at the end ...</p>
<pre class="default s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">wHERE</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>   <span class="hljs-keyword">or</span>  LIMIT <span class="hljs-number">1</span>
</code></pre>
<p>Finally you get:</p>
<pre class="default s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'".mysql_escape_string($name_from_html_form)."'</span> LIMIT <span class="hljs-number">1</span>
</code></pre>
    </div></div></div></div><div id="solution20" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 20</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The simple alternative to this problem could be solved by granting appropriate permissions in the database itself.
For example: if you are using a MySQL database then enter into the database through terminal or the UI provided and just follow this command:</p>

<pre class="default s-code-block"><code class="hljs language-sql"> <span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>, <span class="hljs-keyword">INSERT</span>, <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">ON</span> database <span class="hljs-keyword">TO</span> username@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'password'</span>;
</code></pre>

<p>This will restrict the user to only get confined with the specified query's only. Remove the delete permission and so the data would never get deleted from the query fired from the PHP page.
The second thing to do is to flush the privileges so that the MySQL refreshes the permissions and updates.</p>

<pre class="default s-code-block"><code class="hljs language-undefined">FLUSH PRIVILEGES; 
</code></pre>

<p>more information about <a href="https://dev.mysql.com/doc/refman/5.7/en/flush.html" rel="noreferrer">flush</a>.</p>

<p>To see the current privileges for the user fire the following query.</p>

<pre class="default s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> mysql.user <span class="hljs-keyword">where</span> <span class="hljs-keyword">User</span><span class="hljs-operator">=</span><span class="hljs-string">'username'</span>;
</code></pre>

<p>Learn more about <a href="https://dev.mysql.com/doc/refman/5.7/en/grant.html" rel="noreferrer">GRANT</a>.</p>
    </div></div></div></div><div id="solution21" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 21</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Regarding many useful answers, I hope to add some value to this thread.</p>

<p>SQL injection is an attack that can be done through user inputs (inputs that filled by a user and then used inside queries). The SQL injection patterns are correct query syntax while we can call it: bad queries for bad reasons, and we assume that there might be a bad person that try to get secret information (bypassing access control) that affect the three principles of security (confidentiality, integrity, and availability).</p>

<p>Now, our point is to prevent security threats such as SQL injection attacks, the question asking (how to prevent an SQL injection attack using PHP), be more realistic, data filtering or clearing input data is the case when using user-input data inside such query, using PHP or any other programming language is not the case, or as recommended by more people to use modern technology such as prepared statement or any other tools that currently supporting SQL injection prevention, consider that these tools not available anymore? How do you secure your application?</p>

<p>My approach against SQL injection is: clearing user-input data before sending it to the database (before using it inside any query).</p>

<p><strong>Data filtering for (converting unsafe data to safe data)</strong></p>

<p>Consider that <a href="http://en.wikipedia.org/wiki/PHP#History" rel="noreferrer">PDO</a> and <a href="http://en.wikipedia.org/wiki/MySQLi" rel="noreferrer">MySQLi</a> are not available. How can you secure your application? Do you force me to use them? What about other languages other than PHP? I prefer to provide general ideas as it can be used for wider border, not just for a specific language.</p>

<ol>
<li>SQL user (limiting user privilege): most common SQL operations are (SELECT, UPDATE, INSERT), then, why give the UPDATE privilege to a user that does not require it? For example, <strong>login, and search pages</strong> are only using SELECT, then, why use DB users in these pages with high privileges?</li>
</ol>

<p><strong>RULE: do not create one database user for all privileges. For all SQL operations, you can create your scheme like (deluser, selectuser, updateuser) as usernames for easy usage.</strong></p>

<p>See <a href="http://en.wikipedia.org/wiki/Principle_of_least_privilege" rel="noreferrer">principle of least privilege</a>.</p>

<ol start="2">
<li><p>Data filtering: before building any query user input, it should be validated and filtered. For programmers, it's important to define some properties for each user-input variables:
<strong>data type, data pattern, and data length</strong>. A field that is a number between (x and y) must be exactly validated using the exact rule, and for a field that is a string (text): pattern is the case, for example, a username must contain only some characters, lets say [a-zA-Z0-9_-.]. The length varies between (x and n) where x and n (integers, x &lt;=n).
<strong>Rule: creating exact filters and validation rules are best practices for me.</strong></p></li>
<li><p>Use other tools: Here, I will also agree with you that a prepared statement (parametrized query) and stored procedures. The disadvantages here is these ways require advanced skills which do not exist for most users. The basic idea here is to distinguish between the SQL query and the data that is used inside. Both approaches can be used even with unsafe data, because the user-input data here does not add anything to the original query, such as (any or x=x).</p></li>
</ol>

<p>For more information, please read <a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet" rel="noreferrer">OWASP SQL Injection Prevention Cheat Sheet</a>.</p>

<p>Now, if you are an advanced user, start using this defense as you like, but, for beginners, if they can't quickly implement a stored procedure and prepared the statement, it's better to filter input data as much they can.</p>

<p>Finally, let's consider that a user sends this text below instead of entering his/her username:</p>

<pre class="default s-code-block"><code class="hljs language-sql">[<span class="hljs-number">1</span>] <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">SELECT</span> IF(<span class="hljs-built_in">SUBSTRING</span>(Password,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<span class="hljs-operator">=</span><span class="hljs-string">'2'</span>,BENCHMARK(<span class="hljs-number">100000</span>,SHA1(<span class="hljs-number">1</span>)),<span class="hljs-number">0</span>) <span class="hljs-keyword">User</span>,Password <span class="hljs-keyword">FROM</span> mysql.user <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">User</span> <span class="hljs-operator">=</span> <span class="hljs-string">'root'</span>
</code></pre>

<p>This input can be checked early without any prepared statement and stored procedures, but to be on the safe side, using them starts after user-data filtering and validation.</p>

<p>The last point is detecting unexpected behavior which requires more effort and complexity; it's not recommended for normal web applications.</p>

<p>Unexpected behavior in the above user input is SELECT, UNION, IF, SUBSTRING, BENCHMARK, SHA, and root. Once these words detected, you can avoid the input.</p>

<h2>UPDATE 1:</h2>

<p>A user commented that this post is useless, OK! Here is what <a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet#Defense_Option_3:_Escaping_All_User_Supplied_Input" rel="noreferrer">OWASP.ORG provided</a>:</p>

<blockquote>
  <p>Primary defenses: <br>
   <br>
      Option #1: Use of Prepared Statements (Parameterized Queries) <br>
      Option #2: Use of Stored Procedures <br>
      Option #3: Escaping all User Supplied Input  <br>
   <br>
  Additional defenses: <br>
   <br>
      Also Enforce: Least Privilege <br>
      Also Perform: White List Input Validation <br></p>
</blockquote>

<p>As you may know, claiming an article should be supported by a valid argument, at least by one reference! Otherwise, it's considered as an attack and a bad claim!</p>

<h2>Update 2:</h2>

<p>From the PHP manual, <a href="http://php.net/manual/en/mysqli.quickstart.prepared-statements.php" rel="noreferrer">PHP: Prepared Statements - Manual</a>:</p>

<blockquote>
  <p>Escaping and SQL injection <br></p>
  
  <p>Bound variables will be escaped automatically by the server. The
  server inserts their escaped values at the appropriate places into the
  statement template before execution. A hint must be provided to the
  server for the type of bound variable, to create an appropriate
  conversion. See the mysqli_stmt_bind_param() function for more
  information. <br></p>
  
  <p>The automatic escaping of values within the server is sometimes
  considered a security feature to prevent SQL injection. The same
  degree of security can be achieved with non-prepared statements if
  input values are escaped correctly. <br></p>
</blockquote>

<h2>Update 3:</h2>

<p>I created test cases for knowing how PDO and MySQLi send the query to the MySQL server when using a prepared statement:</p>

<p><strong>PDO:</strong></p>

<pre class="default s-code-block"><code class="hljs language-php"><span class="hljs-variable">$user</span> = <span class="hljs-string">"''1''"</span>; <span class="hljs-comment">// Malicious keyword</span>
<span class="hljs-variable">$sql</span> = <span class="hljs-string">'SELECT * FROM awa_user WHERE userame =:username'</span>;
<span class="hljs-variable">$sth</span> = <span class="hljs-variable">$dbh</span>-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-keyword">array</span>(PDO::<span class="hljs-variable constant_">ATTR_CURSOR</span> =&gt; PDO::<span class="hljs-variable constant_">CURSOR_FWDONLY</span>));
<span class="hljs-variable">$sth</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">':username'</span> =&gt; <span class="hljs-variable">$user</span>));
</code></pre>

<p><strong>Query Log:</strong></p>

<blockquote>
<pre class="default s-code-block"><code class="hljs language-sql">    <span class="hljs-number">189</span> Query <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> awa_user <span class="hljs-keyword">WHERE</span> userame <span class="hljs-operator">=</span><span class="hljs-string">'\'</span>\<span class="hljs-string">'1\'</span>\<span class="hljs-string">''</span>
    <span class="hljs-number">189</span> Quit
</code></pre>
</blockquote>

<p><strong>MySQLi:</strong></p>

<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$mysqli</span>-&gt;prepare(<span class="hljs-string">"SELECT * FROM awa_user WHERE username =?"</span>)) {
<span class="hljs-variable">$stmt</span>-&gt;bind_param(<span class="hljs-string">"s"</span>, <span class="hljs-variable">$user</span>);
<span class="hljs-variable">$user</span> = <span class="hljs-string">"''1''"</span>;
<span class="hljs-variable">$stmt</span>-&gt;execute();
</code></pre>

<p><strong>Query Log:</strong></p>

<blockquote>
<pre class="default s-code-block"><code class="hljs language-sql">    <span class="hljs-number">188</span> <span class="hljs-keyword">Prepare</span>   <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> awa_user <span class="hljs-keyword">WHERE</span> username <span class="hljs-operator">=</span>?
    <span class="hljs-number">188</span> <span class="hljs-keyword">Execute</span>   <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> awa_user <span class="hljs-keyword">WHERE</span> username <span class="hljs-operator">=</span><span class="hljs-string">'\'</span>\<span class="hljs-string">'1\'</span>\<span class="hljs-string">''</span>
    <span class="hljs-number">188</span> Quit
</code></pre>
</blockquote>

<h3>It's clear that a prepared statement is also escaping the data, nothing else.</h3>

<p>As also mentioned in the above statement,</p>

<blockquote>
  <p>The automatic escaping of values within the server is sometimes considered a security feature to prevent SQL injection. The same degree of security can be achieved with non-prepared statements, if input values are escaped correctly</p>
</blockquote>

<p>Therefore, this proves that data validation such as <code>intval()</code> is a good idea for integer values before sending any query. In addition, preventing malicious user data before sending the query is <strong>a correct and valid approach</strong>.</p>

<p>Please see this question for more detail: <em><a href="https://stackoverflow.com/questions/18026088/pdo-sends-raw-query-to-mysql-while-mysqli-sends-prepared-query-both-produce-the">PDO sends raw query to MySQL while Mysqli sends prepared query, both produce the same result</a></em></p>

<p>References:</p>

<ol>
<li><a href="http://ferruh.mavituna.com/sql-injection-cheatsheet-oku/#UnionInjections" rel="noreferrer">SQL Injection Cheat Sheet</a></li>
<li><a href="https://www.owasp.org/index.php/SQL_Injection" rel="noreferrer">SQL Injection</a></li>
<li><a href="http://en.wikipedia.org/wiki/Information_security" rel="noreferrer">Information security</a></li>
<li><a href="http://www.dwheeler.com/secure-programs/Secure-Programs-HOWTO/security-principles.html" rel="noreferrer">Security Principles</a></li>
<li><a href="http://en.wikipedia.org/wiki/Data_validation" rel="noreferrer">Data validation</a></li>
</ol>
    </div></div></div></div><div id="solution22" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 22</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<blockquote>
  <p><strong>Security Warning</strong>: This answer is not in line with security best practices. <a href="https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide" rel="noreferrer">Escaping is inadequate to prevent SQL injection</a>, use <em>prepared statements</em> instead. Use the strategy outlined below at your own risk. (Also, <code>mysql_real_escape_string()</code> was removed in PHP 7.)</p>
  
  <p><strong>Deprecated Warning</strong>: The mysql extension is deprecated at this time. we recommend using the <em>PDO extension</em></p>
</blockquote>

<p>I use three different ways to prevent my web application from being vulnerable to SQL injection.</p>

<ol>
<li>Use of <code>mysql_real_escape_string()</code>, which is a pre-defined function in <a href="http://en.wikipedia.org/wiki/PHP" rel="noreferrer">PHP</a>, and this code add backslashes to the following characters: <code>\x00</code>, <code>\n</code>, <code>\r</code>, <code>\</code>, <code>'</code>, <code>"</code> and <code>\x1a</code>. Pass the input values as parameters to minimize the chance of SQL injection.</li>
<li>The most advanced way is to use PDOs.</li>
</ol>

<p>I hope this will help you.</p>

<p>Consider the following query:</p>

<p><code>$iId = mysql_real_escape_string("1 OR 1=1");
 $sSql = "SELECT * FROM table WHERE id = $iId";</code></p>

<p>mysql_real_escape_string() will not protect here. If you use single quotes (' ') around your variables inside your query is what protects you against this. Here is an solution below for this:</p>

<p><code>$iId = (int) mysql_real_escape_string("1 OR 1=1");
 $sSql = "SELECT * FROM table WHERE id = $iId";</code></p>

<p>This <a href="https://stackoverflow.com/questions/5741187/sql-injection-that-gets-around-mysql-real-escape-string">question</a> has some good answers about this.</p>

<p>I suggest, using PDO is the best option.</p>

<p><strong>Edit:</strong></p>

<p><code>mysql_real_escape_string()</code> is deprecated as of PHP 5.5.0. Use either mysqli or PDO.</p>

<p>An alternative to mysql_real_escape_string() is </p>

<pre class="default s-code-block"><code class="hljs language-php"><span class="hljs-keyword">string</span> <span class="hljs-title function_ invoke__">mysqli_real_escape_string</span> ( mysqli <span class="hljs-variable">$link</span> , <span class="hljs-keyword">string</span> <span class="hljs-variable">$escapestr</span> )
</code></pre>

<p><strong>Example:</strong></p>

<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$iId</span> = <span class="hljs-variable">$mysqli</span>-&gt;real_escape_string(<span class="hljs-string">"1 OR 1=1"</span>);
<span class="hljs-variable">$mysqli</span>-&gt;query(<span class="hljs-string">"SELECT * FROM table WHERE id = <span class="hljs-variable">$iId</span>"</span>);
</code></pre>
    </div></div></div></div><div id="solution23" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 23</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>A simple way would be to use a PHP framework like <a href="http://en.wikipedia.org/wiki/Codeigniter#CodeIgniter" rel="noreferrer">CodeIgniter</a> or <a href="https://laravel.com/" rel="noreferrer">Laravel</a> which have inbuilt features like filtering and active-record so that you don't have to worry about these nuances.</p>
    </div></div></div></div><div id="solution24" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 24</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><strong>Warning: the approach described in this answer only applies to very specific scenarios and isn't secure since SQL injection attacks do not only rely on being able to inject <code>X=Y</code>.</strong></p>

<p>If the attackers are trying to hack into the form via PHP's <code>$_GET</code> variable or with the URL's query string, you would be able to catch them if they're not secure.</p>

<pre class="default s-code-block"><code class="hljs language-bash">RewriteCond %{QUERY_STRING} ([0-9]+)=([0-9]+)
RewriteRule ^(.*) ^/track.php
</code></pre>

<p>Because <code>1=1</code>, <code>2=2</code>, <code>1=2</code>, <code>2=1</code>, <code>1+1=2</code>, etc... are the common questions to an SQL database of an attacker. Maybe also it's used by many hacking applications.</p>

<p>But you must be careful, that you must not rewrite a safe query from your site. The code above is giving you a tip, to rewrite or redirect <em>(it depends on you)</em> that hacking-specific dynamic query string into a page that will store the attacker's <a href="http://en.wikipedia.org/wiki/IP_address" rel="noreferrer">IP address</a>, or EVEN THEIR COOKIES, history, browser, or any other sensitive information, so you can deal with them later by banning their account or contacting authorities.</p>
    </div></div></div></div><div id="solution25" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 25</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>A good idea is to use an <a href="https://en.wikipedia.org/wiki/Object-relational_mapping" rel="noreferrer">object-relational mapper</a> like <a href="http://j4mie.github.io/idiormandparis/" rel="noreferrer">Idiorm</a>:</p>

<pre class="default s-code-block"><code class="hljs language-rust">$user = ORM::<span class="hljs-title function_ invoke__">for_table</span>(<span class="hljs-symbol">'user</span>')
<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">where_equal</span>(<span class="hljs-symbol">'username</span>', <span class="hljs-symbol">'j4mie</span>')
<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">find_one</span>();

$user<span class="hljs-punctuation">-&gt;</span>first_name = <span class="hljs-symbol">'Jamie</span>';
$user<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">save</span>();

$tweets = ORM::<span class="hljs-title function_ invoke__">for_table</span>(<span class="hljs-symbol">'tweet</span>')
    <span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">select</span>(<span class="hljs-symbol">'tweet</span>.*')
    <span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">join</span>(<span class="hljs-symbol">'user</span>', <span class="hljs-title function_ invoke__">array</span>(
        <span class="hljs-symbol">'user</span>.id', <span class="hljs-string">'='</span>, <span class="hljs-symbol">'tweet</span>.user_id'
    ))
    <span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">where_equal</span>(<span class="hljs-symbol">'user</span>.username', <span class="hljs-symbol">'j4mie</span>')
    <span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">find_many</span>();

<span class="hljs-title function_ invoke__">foreach</span> ($tweets <span class="hljs-keyword">as</span> $tweet) {
    echo $tweet<span class="hljs-punctuation">-&gt;</span>text;
}
</code></pre>

<p>It not only saves you from SQL injections, but from syntax errors too! It also supports collections of models with method chaining to filter or apply actions to multiple results at once and multiple connections.</p>
    </div></div></div></div><div id="solution26" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 26</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>There are so many answers for <strong>PHP and MySQL</strong>, but here is code for <strong>PHP and Oracle</strong> for preventing SQL injection as well as regular use of oci8 drivers:</p>

<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$conn</span> = oci_connect(<span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>, <span class="hljs-variable">$connection_string</span>);
<span class="hljs-variable">$stmt</span> = oci_parse(<span class="hljs-variable">$conn</span>, <span class="hljs-string">'UPDATE table SET field = :xx WHERE ID = 123'</span>);
oci_bind_by_name(<span class="hljs-variable">$stmt</span>, <span class="hljs-string">':xx'</span>, <span class="hljs-variable">$fieldval</span>);
oci_execute(<span class="hljs-variable">$stmt</span>);
</code></pre>
    </div></div></div></div><div id="solution27" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 27</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<blockquote>
  <p><strong>Deprecated Warning:</strong>
  This answer's sample code (like the question's sample code) uses PHP's <code>MySQL</code> extension, which was deprecated in PHP 5.5.0 and removed entirely in PHP 7.0.0.</p>
  
  <p><strong>Security Warning</strong>: This answer is not in line with security best practices. <a href="https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide" rel="noreferrer">Escaping is inadequate to prevent SQL injection</a>, use <em>prepared statements</em> instead. Use the strategy outlined below at your own risk. (Also, <code>mysql_real_escape_string()</code> was removed in PHP 7.)</p>
</blockquote>

<p>Using <a href="http://in3.php.net/pdo" rel="noreferrer">PDO</a> and <a href="http://in3.php.net/mysqli" rel="noreferrer">MYSQLi</a> is a good practice to prevent SQL injections, but if you really want to work with MySQL functions and queries, it would be better to use</p>

<p><a href="http://php.net/manual/en/function.mysql-real-escape-string.php" rel="noreferrer">mysql_real_escape_string</a></p>

<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$unsafe_variable</span> = mysql_real_escape_string(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'user_input'</span>]);
</code></pre>

<p>There are more abilities to prevent this: like identify - if the input is a string, number, char or array, there are so many inbuilt functions to detect this. Also, it would be better to use these functions to check input data.</p>

<p><a href="http://in3.php.net/is_string" rel="noreferrer">is_string</a></p>

<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$unsafe_variable</span> = (is_string(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'user_input'</span>]) ? <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'user_input'</span>] : <span class="hljs-string">''</span>);
</code></pre>

<p><a href="http://in3.php.net/manual/en/function.is-numeric.php" rel="noreferrer">is_numeric</a></p>

<pre class="default s-code-block"><code class="hljs language-bash"><span class="hljs-variable">$unsafe_variable</span> = (is_numeric(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'user_input'</span>]) ? <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'user_input'</span>] : <span class="hljs-string">''</span>);
</code></pre>

<p>And it is so much better to use those functions to check input data with <code>mysql_real_escape_string</code>.</p>
    </div></div></div></div><div id="solution28" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 28</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/php">php</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mysql">mysql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql">sql</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/security">security</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/sql-injection">sql-injection</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I've written this little function several years ago:</p>

<pre class="default s-code-block"><code class="hljs language-php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sqlvprintf</span>(<span class="hljs-params"><span class="hljs-variable">$query</span>, <span class="hljs-variable">$args</span></span>)
</span>{
    <span class="hljs-keyword">global</span> <span class="hljs-variable">$DB_LINK</span>;
    <span class="hljs-variable">$ctr</span> = <span class="hljs-number">0</span>;
    <span class="hljs-title function_ invoke__">ensureConnection</span>(); <span class="hljs-comment">// Connect to database if not connected already.</span>
    <span class="hljs-variable">$values</span> = <span class="hljs-keyword">array</span>();
    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$args</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$value</span>)
    {
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$value</span>))
        {
            <span class="hljs-variable">$value</span> = <span class="hljs-string">"'"</span> . <span class="hljs-title function_ invoke__">mysqli_real_escape_string</span>(<span class="hljs-variable">$DB_LINK</span>, <span class="hljs-variable">$value</span>) . <span class="hljs-string">"'"</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_null</span>(<span class="hljs-variable">$value</span>))
        {
            <span class="hljs-variable">$value</span> = <span class="hljs-string">'NULL'</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_int</span>(<span class="hljs-variable">$value</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">is_float</span>(<span class="hljs-variable">$value</span>))
        {
            <span class="hljs-keyword">die</span>(<span class="hljs-string">'Only numeric, string, array and NULL arguments allowed in a query. Argument '</span>.(<span class="hljs-variable">$ctr</span>+<span class="hljs-number">1</span>).<span class="hljs-string">' is not a basic type, it\'s type is '</span>. <span class="hljs-title function_ invoke__">gettype</span>(<span class="hljs-variable">$value</span>). <span class="hljs-string">'.'</span>);
        }
        <span class="hljs-variable">$values</span>[] = <span class="hljs-variable">$value</span>;
        <span class="hljs-variable">$ctr</span>++;
    }
    <span class="hljs-variable">$query</span> = <span class="hljs-title function_ invoke__">preg_replace_callback</span>(
        <span class="hljs-string">'/{(\\d+)}/'</span>, 
        function(<span class="hljs-variable">$match</span>) <span class="hljs-keyword">use</span> ($<span class="hljs-title">values</span>)
        {
            <span class="hljs-title">if</span> (<span class="hljs-title">isset</span>($<span class="hljs-title">values</span>[$<span class="hljs-title">match</span>[1]]))
            {
                <span class="hljs-title">return</span> $<span class="hljs-title">values</span>[$<span class="hljs-title">match</span>[1]];
            }
            <span class="hljs-keyword">else</span>
            {
                <span class="hljs-keyword">return</span> <span class="hljs-variable">$match</span>[<span class="hljs-number">0</span>];
            }
        },
        <span class="hljs-variable">$query</span>
    );
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$query</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runEscapedQuery</span>(<span class="hljs-params"><span class="hljs-variable">$preparedQuery</span> <span class="hljs-comment">/*, ...*/</span></span>)
</span>{
    <span class="hljs-variable">$params</span> = <span class="hljs-title function_ invoke__">array_slice</span>(<span class="hljs-title function_ invoke__">func_get_args</span>(), <span class="hljs-number">1</span>);
    <span class="hljs-variable">$results</span> = <span class="hljs-title function_ invoke__">runQuery</span>(<span class="hljs-title function_ invoke__">sqlvprintf</span>(<span class="hljs-variable">$preparedQuery</span>, <span class="hljs-variable">$params</span>)); <span class="hljs-comment">// Run query and fetch results.   </span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$results</span>;
}
</code></pre>

<p>This allows running statements in an one-liner C#-ish String.Format like:</p>

<pre class="default s-code-block"><code class="hljs language-bash">runEscapedQuery(<span class="hljs-string">"INSERT INTO Whatever (id, foo, bar) VALUES ({0}, {1}, {2})"</span>, <span class="hljs-variable">$numericVar</span>, <span class="hljs-variable">$stringVar1</span>, <span class="hljs-variable">$stringVar2</span>);
</code></pre>

<p>It escapes considering the variable type. If you try to parameterize table, column names, it would fail as it puts every string in quotes which is an invalid syntax.</p>

<p>SECURITY UPDATE: The previous <code>str_replace</code> version allowed injections by adding {#} tokens into user data. This <code>preg_replace_callback</code> version doesn't cause problems if the replacement contains these tokens.</p>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/methods-in-es6-objects:-using-arrow-functions-1657388249058">Methods in ES6 objects: using arrow functions</a><a href="/questions/jquery-ajax-file-upload-1657387368970">jQuery Ajax File Upload</a><a href="/questions/how-to-make-function-decorators-and-chain-them-together-1657388180803">How to make function decorators and chain them together?</a><a href="/questions/how-do-i-merge-two-dictionaries-in-a-single-expression-1657387593160">How do I merge two dictionaries in a single expression?</a><a href="/questions/use-of-&#x27;prototype&#x27;-vs.-&#x27;this&#x27;-in-javascript-1657388117307">Use of &#x27;prototype&#x27; vs. &#x27;this&#x27; in JavaScript?</a><a href="/questions/how-to-store-objects-in-html5-localstorage-1657387568907">How to store objects in HTML5 localStorage</a><a href="/questions/how-do-i-use-extern-to-share-variables-between-source-files-1657387453605">How do I use extern to share variables between source files?</a><a href="/questions/how-to-make-good-reproducible-pandas-examples-1657384310402">How to make good reproducible pandas examples</a><a href="/questions/how-to-format-numbers-as-currency-strings-1657388399166">How to format numbers as currency strings</a><a href="/questions/google-maps-js-api-v3-simple-multiple-marker-example-1657388073335">Google Maps JS API v3 - Simple Multiple Marker Example</a><a href="/questions/what-happens-if-you-use-the-32-bit-int-0x80-linux-abi-in-64-bit-code-1657388560485">What happens if you use the 32-bit int 0x80 Linux ABI in 64-bit code?</a><a href="/questions/how-do-i-properly-clean-up-excel-interop-objects-1657388329706">How do I properly clean up Excel interop objects?</a><a href="/questions/what-is-the-purpose-of-the-var-keyword-and-when-should-i-use-it-(or-omit-it)-1657387525538">What is the purpose of the var keyword and when should I use it (or omit it)?</a><a href="/questions/how-do-i-sort-a-dictionary-by-value-1657385485049">How do I sort a dictionary by value?</a><a href="/questions/why-aren&#x27;t-variable-length-arrays-part-of-the-c++-standard-1657384712975">Why aren&#x27;t variable-length arrays part of the C++ standard?</a><a href="/questions/why-jsf-calls-getters-multiple-times-1657388244489">Why JSF calls getters multiple times</a><a href="/questions/can-i-mix-mysql-apis-in-php-1657384597444">Can I mix MySQL APIs in PHP?</a><a href="/questions/the-definitive-c++-book-guide-and-list-1657384247395">The Definitive C++ Book Guide and List</a><a href="/questions/what-are-the-nuances-of-scope-prototypal-prototypical-inheritance-in-angularjs-1657387340067">What are the nuances of scope prototypal / prototypical inheritance in AngularJS?</a><a href="/questions/what-is-a-nullpointerexception-and-how-do-i-fix-it-1657384201768">What is a NullPointerException, and how do I fix it?</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;The \u0026lt;em\u0026gt;correct\u0026lt;/em\u0026gt; way to avoid SQL injection attacks, no matter which database you use, is to \u0026lt;strong\u0026gt;separate the data from SQL\u0026lt;/strong\u0026gt;, so that data stays data and will \u0026lt;strong\u0026gt;never be interpreted\u0026lt;/strong\u0026gt; as commands by the SQL parser. It is possible to create an SQL statement with correctly formatted data parts, but if you don\u0026apos;t \u0026lt;em\u0026gt;fully\u0026lt;/em\u0026gt; understand the details, you should always \u0026lt;strong\u0026gt;use prepared statements and parameterized queries.\u0026lt;/strong\u0026gt; These are SQL statements that are sent to and parsed by the database server separately from any parameters. This way it is impossible for an attacker to inject malicious SQL.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;You basically have two options to achieve this:\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Using \u0026lt;a href=\u0026quot;http://php.net/manual/en/book.pdo.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;strong\u0026gt;PDO\u0026lt;/strong\u0026gt;\u0026lt;/a\u0026gt; (for any supported database driver):\u0026lt;/p\u0026gt;\n \u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$pdo\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;prepare\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT * FROM employees WHERE name = :name\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;execute\u0026lt;/span\u0026gt;([ \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;name\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name\u0026lt;/span\u0026gt; ]);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;foreach\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$row\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Do something with $row\u0026lt;/span\u0026gt;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Using \u0026lt;a href=\u0026quot;http://php.net/manual/en/book.mysqli.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;strong\u0026gt;MySQLi\u0026lt;/strong\u0026gt;\u0026lt;/a\u0026gt; (for MySQL):\u0026lt;/p\u0026gt;\n \u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbConnection\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;prepare\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT * FROM employees WHERE name = ?\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;bind_param\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;s\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name\u0026lt;/span\u0026gt;); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// \u0026apos;s\u0026apos; specifies the variable type =\u0026amp;gt; \u0026apos;string\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;execute\u0026lt;/span\u0026gt;();\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$result\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;get_result\u0026lt;/span\u0026gt;();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$row\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$result\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;fetch_assoc\u0026lt;/span\u0026gt;()) {\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Do something with $row\u0026lt;/span\u0026gt;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;If you\u0026apos;re connecting to a database other than MySQL, there is a driver-specific second option that you can refer to (for example, \u0026lt;code\u0026gt;pg_prepare()\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;pg_execute()\u0026lt;/code\u0026gt; for PostgreSQL). PDO is the universal option.\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;h2\u0026gt;Correctly setting up the connection\u0026lt;/h2\u0026gt;\n\u0026lt;h4\u0026gt;PDO\u0026lt;/h4\u0026gt;\n\u0026lt;p\u0026gt;Note that when using \u0026lt;strong\u0026gt;PDO\u0026lt;/strong\u0026gt; to access a MySQL database \u0026lt;em\u0026gt;real\u0026lt;/em\u0026gt; prepared statements are \u0026lt;strong\u0026gt;not used by default\u0026lt;/strong\u0026gt;. To fix this you have to disable the emulation of prepared statements. An example of creating a connection using \u0026lt;strong\u0026gt;PDO\u0026lt;/strong\u0026gt; is:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbConnection\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;PDO\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;mysql:dbname=dbtest;host=127.0.0.1;charset=utf8mb4\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;user\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbConnection\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;setAttribute\u0026lt;/span\u0026gt;(PDO::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;ATTR_EMULATE_PREPARES\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbConnection\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;setAttribute\u0026lt;/span\u0026gt;(PDO::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;ATTR_ERRMODE\u0026lt;/span\u0026gt;, PDO::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;ERRMODE_EXCEPTION\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;In the above example, the error mode isn\u0026apos;t strictly necessary, \u0026lt;strong\u0026gt;but it is advised to add it\u0026lt;/strong\u0026gt;. This way PDO will inform you of all MySQL errors by means of throwing the \u0026lt;code\u0026gt;PDOException\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;What is \u0026lt;strong\u0026gt;mandatory\u0026lt;/strong\u0026gt;, however, is the first \u0026lt;code\u0026gt;setAttribute()\u0026lt;/code\u0026gt; line, which tells PDO to disable emulated prepared statements and use \u0026lt;em\u0026gt;real\u0026lt;/em\u0026gt; prepared statements. This makes sure the statement and the values aren\u0026apos;t parsed by PHP before sending it to the MySQL server (giving a possible attacker no chance to inject malicious SQL).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Although you can set the \u0026lt;code\u0026gt;charset\u0026lt;/code\u0026gt; in the options of the constructor, it\u0026apos;s important to note that \u0026apos;older\u0026apos; versions of PHP (before 5.3.6) \u0026lt;a href=\u0026quot;http://php.net/manual/en/ref.pdo-mysql.connection.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;silently ignored the charset parameter\u0026lt;/a\u0026gt; in the DSN.\u0026lt;/p\u0026gt;\n\u0026lt;h4\u0026gt;Mysqli\u0026lt;/h4\u0026gt;\n\u0026lt;p\u0026gt;For mysqli we have to follow the same routine:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mysqli_report\u0026lt;/span\u0026gt;(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// error reporting\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbConnection\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mysqli\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;127.0.0.1\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;username\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;test\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbConnection\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;set_charset\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8mb4\u0026apos;\u0026lt;/span\u0026gt;); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// charset\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;h2\u0026gt;Explanation\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;The SQL statement you pass to \u0026lt;code\u0026gt;prepare\u0026lt;/code\u0026gt; is parsed and compiled by the database server. By specifying parameters (either a \u0026lt;code\u0026gt;?\u0026lt;/code\u0026gt; or a named parameter like \u0026lt;code\u0026gt;:name\u0026lt;/code\u0026gt; in the example above) you tell the database engine where you want to filter on. Then when you call \u0026lt;code\u0026gt;execute\u0026lt;/code\u0026gt;, the prepared statement is combined with the parameter values you specify.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The important thing here is that the parameter values are combined with the compiled statement, not an SQL string. SQL injection works by tricking the script into including malicious strings when it creates SQL to send to the database. So by sending the actual SQL separately from the parameters, you limit the risk of ending up with something you didn\u0026apos;t intend.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Any parameters you send when using a prepared statement will just be treated as strings (although the database engine may do some optimization so parameters may end up as numbers too, of course). In the example above, if the \u0026lt;code\u0026gt;$name\u0026lt;/code\u0026gt; variable contains \u0026lt;code\u0026gt;\u0026apos;Sarah\u0026apos;; DELETE FROM employees\u0026lt;/code\u0026gt; the result would simply be a search for the string \u0026lt;code\u0026gt;\u0026quot;\u0026apos;Sarah\u0026apos;; DELETE FROM employees\u0026quot;\u0026lt;/code\u0026gt;, and you will not end up with \u0026lt;a href=\u0026quot;http://xkcd.com/327/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;an empty table\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Another benefit of using prepared statements is that if you execute the same statement many times in the same session it will only be parsed and compiled once, giving you some speed gains.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Oh, and since you asked about how to do it for an insert, here\u0026apos;s an example (using PDO):\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$preparedStatement\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$db\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;prepare\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;INSERT INTO table (column) VALUES (:column)\u0026apos;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$preparedStatement\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;execute\u0026lt;/span\u0026gt;([ \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;column\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$unsafeValue\u0026lt;/span\u0026gt; ]);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;h2\u0026gt;Can prepared statements be used for dynamic queries?\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;While you can still use prepared statements for the query parameters, the structure of the dynamic query itself cannot be parametrized and certain query features cannot be parametrized.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For these specific scenarios, the best thing to do is use a whitelist filter that restricts the possible values.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Value whitelist\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// $dir can only be \u0026apos;DESC\u0026apos;, otherwise it will be \u0026apos;ASC\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;empty\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dir\u0026lt;/span\u0026gt;) || \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dir\u0026lt;/span\u0026gt; !== \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;DESC\u0026apos;\u0026lt;/span\u0026gt;) {\n   \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dir\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ASC\u0026apos;\u0026lt;/span\u0026gt;;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;To use the parameterized query, you need to use either Mysqli or PDO. To rewrite your example with mysqli, we would need something like the following.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;\u0026amp;lt;?php\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mysqli_report\u0026lt;/span\u0026gt;(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mysqli\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mysqli\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;server\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;username\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;password\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;database_name\u0026quot;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$variable\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;user-input\u0026quot;\u0026lt;/span\u0026gt;];\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mysqli\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;prepare\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;INSERT INTO table (column) VALUES (?)\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// \u0026quot;s\u0026quot; means the database expects a string\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;bind_param\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;s\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$variable\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;execute\u0026lt;/span\u0026gt;();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;The key function you\u0026apos;ll want to read up on there would be \u0026lt;a href=\u0026quot;http://php.net/mysqli.prepare\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;mysqli::prepare\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Also, as others have suggested, you may find it useful/easier to step up a layer of abstraction with something like \u0026lt;a href=\u0026quot;http://php.net/pdo\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;PDO\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Please note that the case you asked about is a fairly simple one and that more complex cases may require more complex approaches. In particular:\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;If you want to alter the structure of the SQL based on user input, parameterized queries are not going to help, and the escaping required is not covered by \u0026lt;code\u0026gt;mysql_real_escape_string\u0026lt;/code\u0026gt;. In this kind of case, you would be better off passing the user\u0026apos;s input through a whitelist to ensure only \u0026apos;safe\u0026apos; values are allowed through.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Every answer here covers only part of the problem.\nIn fact, there are \u0026lt;strong\u0026gt;four\u0026lt;/strong\u0026gt; different query parts which we can add to SQL dynamically: -\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;a string\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;a number\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;an identifier\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;a syntax keyword\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;p\u0026gt;And prepared statements cover only two of them.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;But sometimes we have to make our query even more dynamic, adding operators or identifiers as well.\nSo, we will need different protection techniques.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;In general, such a protection approach is based on \u0026lt;em\u0026gt;whitelisting\u0026lt;/em\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;In this case, every dynamic parameter should be hardcoded in your script and chosen from that set.\nFor example, to do dynamic ordering:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$orders\u0026lt;/span\u0026gt;  = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;name\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;price\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;qty\u0026quot;\u0026lt;/span\u0026gt;); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Field names\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$key\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;array_search\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_GET\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;sort\u0026apos;\u0026lt;/span\u0026gt;], \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$orders\u0026lt;/span\u0026gt;)); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// if we have such a name\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$orderby\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$orders\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$key\u0026lt;/span\u0026gt;]; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// If not, first one will be set automatically. \u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT * FROM `table` ORDER BY \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$orderby\u0026lt;/span\u0026gt;\u0026quot;\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Value is safe\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;To ease the process I wrote a \u0026lt;a href=\u0026quot;https://phpdelusions.net/pdo_examples/order_by\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;whitelist helper function\u0026lt;/a\u0026gt; that does all the job in one line:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$orderby\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;white_list\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_GET\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;orderby\u0026apos;\u0026lt;/span\u0026gt;], \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;name\u0026quot;\u0026lt;/span\u0026gt;, [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;name\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;price\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;qty\u0026quot;\u0026lt;/span\u0026gt;], \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Invalid field name\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query\u0026lt;/span\u0026gt;  = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT * FROM `table` ORDER BY `\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$orderby\u0026lt;/span\u0026gt;`\u0026quot;\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// sound and safe\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;There is another way to secure identifiers - escaping but I rather stick to whitelisting as a more robust and explicit approach. Yet as long as you have an identifier quoted, you can escape the quote character to make it safe. For example, by default for mysql you have to \u0026lt;a href=\u0026quot;https://dev.mysql.com/doc/refman/8.0/en/identifiers.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;double the quote character to escape it\u0026lt;/a\u0026gt;. For other other DBMS escaping rules would be different.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Still, there is an issue with SQL syntax keywords (such as \u0026lt;code\u0026gt;AND\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;DESC\u0026lt;/code\u0026gt; and such), but white-listing seems the only approach in this case.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;So, a general recommendation may be phrased as\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Any variable that represents an SQL data literal, (or, to put it simply - an SQL string, or a number) must be added through a prepared statement. No Exceptions.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Any other query part, such as an SQL keyword, a table or a field name, or an operator - must be filtered through a white list.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;h3\u0026gt;Update\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;Although there is a general agreement on the best practices regarding SQL injection protection, there are \u0026lt;strong\u0026gt;still many bad practices as well.\u0026lt;/strong\u0026gt; And some of them too deeply rooted in the minds of PHP users. For instance, on this very page there are (although invisible to most visitors) \u0026lt;strong\u0026gt;more than 80 deleted answers\u0026lt;/strong\u0026gt; - all removed by the community due to bad quality or promoting bad and outdated practices. Worse yet, some of the bad answers aren\u0026apos;t deleted, but rather prospering.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For example, \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/11802479\u0026quot;\u0026gt;there(1)\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/6381189\u0026quot;\u0026gt;are(2)\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/60195/\u0026quot;\u0026gt;still(3)\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/12426697/\u0026quot;\u0026gt;many(4)\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/21179234\u0026quot;\u0026gt;answers(5)\u0026lt;/a\u0026gt;, including the \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/60442\u0026quot;\u0026gt;second most upvoted answer\u0026lt;/a\u0026gt; suggesting you manual string escaping - an outdated approach that is proven to be insecure.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Or there is a slightly better answer that suggests just \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/12710285\u0026quot;\u0026gt;another method of string formatting\u0026lt;/a\u0026gt; and even boasts it as the ultimate panacea. While of course, it is not. This method is no better than regular string formatting, yet it keeps all its drawbacks: it is applicable to strings only and, like any other manual formatting, it\u0026apos;s essentially optional, non-obligatory measure, prone to human error of any sort.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I think that all this because of one very old superstition, supported by such authorities like \u0026lt;a href=\u0026quot;https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet#Defense_Option_4:_Escaping_All_User_Supplied_Input\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;OWASP\u0026lt;/a\u0026gt; or \u0026lt;a href=\u0026quot;http://php.net/manual/en/function.mysql-real-escape-string.php#refsect1-function.mysql-real-escape-string-description\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;the PHP manual\u0026lt;/a\u0026gt;, which proclaims equality between whatever \u0026quot;escaping\u0026quot; and protection from SQL injections.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Regardless of what PHP manual said for ages, \u0026lt;strong\u0026gt;\u0026lt;code\u0026gt;*_escape_string\u0026lt;/code\u0026gt; by no means makes data safe\u0026lt;/strong\u0026gt; and never has been intended to. Besides being useless for any SQL part other than string, manual escaping is wrong, because it is manual as opposite to automated.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;And OWASP makes it even worse, stressing on escaping \u0026lt;em\u0026gt;user input\u0026lt;/em\u0026gt; which is an utter nonsense: there should be no such words in the context of injection protection. Every variable is potentially dangerous - no matter the source! Or, in other words - every variable has to be properly formatted to be put into a query - no matter the source again. It\u0026apos;s the destination that matters. The moment a developer starts to separate the sheep from the goats (thinking whether some particular variable is \u0026quot;safe\u0026quot; or not) he/she takes his/her first step towards disaster. Not to mention that even the wording suggests bulk escaping at the entry point, resembling the very magic quotes feature - already despised, deprecated and removed.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;So, unlike whatever \u0026quot;escaping\u0026quot;, prepared statements \u0026lt;em\u0026gt;is\u0026lt;/em\u0026gt; the measure that indeed protects from SQL injection (when applicable).\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I\u0026apos;d recommend using \u0026lt;a href=\u0026quot;http://ca3.php.net/manual/en/book.pdo.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;PDO\u0026lt;/a\u0026gt; (PHP Data Objects) to run parameterized SQL queries. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Not only does this protect against SQL injection, but it also speeds up queries. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;And by using PDO rather than \u0026lt;code\u0026gt;mysql_\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;mysqli_\u0026lt;/code\u0026gt;, and \u0026lt;code\u0026gt;pgsql_\u0026lt;/code\u0026gt; functions, you make your application a little more abstracted from the database, in the rare occurrence that you have to switch database providers.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Use \u0026lt;code\u0026gt;PDO\u0026lt;/code\u0026gt; and prepared queries.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;(\u0026lt;code\u0026gt;$conn\u0026lt;/code\u0026gt; is a \u0026lt;code\u0026gt;PDO\u0026lt;/code\u0026gt; object)\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$conn\u0026lt;/span\u0026gt;-\u0026amp;gt;prepare(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;INSERT INTO tbl VALUES(:id, :name)\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;bindValue(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;:id\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$id\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;bindValue(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;:name\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;execute();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;As you can see, people suggest you use prepared statements at the most. It\u0026apos;s not wrong, but when your query is executed \u0026lt;strong\u0026gt;just once\u0026lt;/strong\u0026gt; per process, there would be a slight performance penalty. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I was facing this issue, but I think I solved it in \u0026lt;em\u0026gt;very\u0026lt;/em\u0026gt; sophisticated way - the way hackers use to avoid using quotes. I used this in conjunction with emulated prepared statements. I use it to prevent \u0026lt;em\u0026gt;all\u0026lt;/em\u0026gt; kinds of possible SQL injection attacks.\u0026lt;/p\u0026gt;\n\n\u0026lt;h2\u0026gt;My approach:\u0026lt;/h2\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;If you expect input to be integer make sure it\u0026apos;s \u0026lt;strong\u0026gt;\u0026lt;em\u0026gt;really\u0026lt;/em\u0026gt;\u0026lt;/strong\u0026gt; integer. In a variable-type language like PHP it is this \u0026lt;em\u0026gt;very\u0026lt;/em\u0026gt; important. You can use for example this very simple but powerful solution: \u0026lt;code\u0026gt;sprintf(\u0026quot;SELECT 1,2,3 FROM table WHERE 4 = %u\u0026quot;, $input);\u0026lt;/code\u0026gt;  \u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;If you expect anything else from integer \u0026lt;strong\u0026gt;hex it\u0026lt;/strong\u0026gt;. If you hex it, you will perfectly escape all input. In C/C++ there\u0026apos;s a function called \u0026lt;a href=\u0026quot;http://dev.mysql.com/doc/refman/5.0/en/mysql-hex-string.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;mysql_hex_string()\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;, in PHP you can use \u0026lt;a href=\u0026quot;http://www.php.net/manual/en/function.bin2hex.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;bin2hex()\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Don\u0026apos;t worry about that the escaped string will have a 2x size of its original length because even if you use \u0026lt;code\u0026gt;mysql_real_escape_string\u0026lt;/code\u0026gt;, PHP has to allocate same capacity \u0026lt;code\u0026gt;((2*input_length)+1)\u0026lt;/code\u0026gt;, which is the same.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;This hex method is often used when you transfer binary data, but I see no reason why not use it on all data to prevent SQL injection attacks. Note that you have to prepend data with \u0026lt;code\u0026gt;0x\u0026lt;/code\u0026gt; or use the MySQL function \u0026lt;code\u0026gt;UNHEX\u0026lt;/code\u0026gt; instead.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;So, for example, the query:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; password \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; users \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;root\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Will become:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; password \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; users \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0x726f6f74\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;or\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; password \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; users \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; UNHEX(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;726f6f74\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Hex is the perfect escape. No way to inject.\u0026lt;/p\u0026gt;\n\n\u0026lt;h2\u0026gt;Difference between UNHEX function and 0x prefix\u0026lt;/h2\u0026gt;\n\n\u0026lt;p\u0026gt;There was some discussion in comments, so I finally want to make it clear. These two approaches are very similar, but they are a little different in some ways:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The \u0026lt;code\u0026gt;0x\u0026lt;/code\u0026gt; prefix can only be used for data columns such as \u0026lt;code\u0026gt;char\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;varchar\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;text\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;block\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;binary\u0026lt;/code\u0026gt;, etc.\u0026lt;br\u0026gt;\nAlso, its use is a little complicated if you are about to insert an empty string. You\u0026apos;ll have to entirely replace it with \u0026lt;code\u0026gt;\u0026apos;\u0026apos;\u0026lt;/code\u0026gt;, or you\u0026apos;ll get an error.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;UNHEX()\u0026lt;/code\u0026gt; works on \u0026lt;strong\u0026gt;any\u0026lt;/strong\u0026gt; column; you do not have to worry about the empty string.\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;h2\u0026gt;Hex methods are often used as attacks\u0026lt;/h2\u0026gt;\n\n\u0026lt;p\u0026gt;Note that this hex method is often used as an SQL injection attack where integers are just like strings and escaped just with \u0026lt;code\u0026gt;mysql_real_escape_string\u0026lt;/code\u0026gt;. Then you can avoid the use of quotes.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For example, if you just do something like this:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT title FROM article WHERE id = \u0026quot;\u0026lt;/span\u0026gt; . mysql_real_escape_string(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_GET\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;id\u0026quot;\u0026lt;/span\u0026gt;])\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;an attack can inject you very \u0026lt;em\u0026gt;easily\u0026lt;/em\u0026gt;. Consider the following injected code returned from your script:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; ... \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; id \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;UNION\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ALL\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; table_name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; information_schema.tables;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;and now just extract table structure:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; ... \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; id \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;UNION\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ALL\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; column_name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; information_schema.column \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; table_name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; __0x61727469636c65__;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;And then just select whatever data ones want. Isn\u0026apos;t it cool?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;But if the coder of an injectable site would hex it, no injection would be possible because the query would look like this:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; ... \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; id \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; UNHEX(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;2d312075...3635\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Deprecated Warning:\u0026lt;/strong\u0026gt;\n  This answer\u0026apos;s sample code (like the question\u0026apos;s sample code) uses PHP\u0026apos;s \u0026lt;code\u0026gt;MySQL\u0026lt;/code\u0026gt; extension, which was deprecated in PHP 5.5.0 and removed entirely in PHP 7.0.0.\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Security Warning\u0026lt;/strong\u0026gt;: This answer is not in line with security best practices. \u0026lt;a href=\u0026quot;https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Escaping is inadequate to prevent SQL injection\u0026lt;/a\u0026gt;, use \u0026lt;em\u0026gt;prepared statements\u0026lt;/em\u0026gt; instead. Use the strategy outlined below at your own risk. (Also, \u0026lt;code\u0026gt;mysql_real_escape_string()\u0026lt;/code\u0026gt; was removed in PHP 7.)\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;IMPORTANT\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt;The best way to prevent SQL Injection is to use \u0026lt;strong\u0026gt;Prepared Statements\u0026lt;/strong\u0026gt; \u0026lt;em\u0026gt;instead of escaping\u0026lt;/em\u0026gt;, as \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/60496/2224584\u0026quot;\u0026gt;the accepted answer\u0026lt;/a\u0026gt; demonstrates. \u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt;There are libraries such as \u0026lt;a href=\u0026quot;https://github.com/auraphp/Aura.Sql\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Aura.Sql\u0026lt;/a\u0026gt; and \u0026lt;a href=\u0026quot;https://github.com/paragonie/easydb\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;EasyDB\u0026lt;/a\u0026gt; that allow developers to use prepared statements easier. To learn more about why prepared statements are better at \u0026lt;a href=\u0026quot;https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;stopping SQL injection\u0026lt;/a\u0026gt;, refer to \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/12118602/2224584\u0026quot;\u0026gt;this \u0026lt;code\u0026gt;mysql_real_escape_string()\u0026lt;/code\u0026gt; bypass\u0026lt;/a\u0026gt; and \u0026lt;a href=\u0026quot;https://kraft.im/2015/05/how-emoji-saved-your-sites-hide/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;recently fixed Unicode SQL Injection vulnerabilities in WordPress\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;Injection prevention - \u0026lt;a href=\u0026quot;http://php.net/manual/en/function.mysql-real-escape-string.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;mysql_real_escape_string()\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;PHP has a specially-made function to prevent these attacks. All you need to do is use the mouthful of a function, \u0026lt;code\u0026gt;mysql_real_escape_string\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;mysql_real_escape_string\u0026lt;/code\u0026gt; takes a string that is going to be used in a MySQL query and return the same string with all SQL injection attempts safely escaped. Basically, it will replace those troublesome quotes(\u0026apos;) a user might enter with a MySQL-safe substitute, an escaped quote \\\u0026apos;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;NOTE:\u0026lt;/strong\u0026gt; you must be connected to the database to use this function!\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;// Connect to MySQL\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name_bad\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026apos; OR 1\u0026apos;\u0026quot;\u0026lt;/span\u0026gt;; \n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name_bad\u0026lt;/span\u0026gt; = mysql_real_escape_string(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name_bad\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query_bad\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT * FROM customers WHERE username = \u0026apos;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name_bad\u0026lt;/span\u0026gt;\u0026apos;\u0026quot;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;echo\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Escaped Bad Injection: \u0026amp;lt;br /\u0026amp;gt;\u0026quot;\u0026lt;/span\u0026gt; . \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query_bad\u0026lt;/span\u0026gt; . \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026amp;lt;br /\u0026amp;gt;\u0026quot;\u0026lt;/span\u0026gt;;\n\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name_evil\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026apos;; DELETE FROM customers WHERE 1 or username = \u0026apos;\u0026quot;\u0026lt;/span\u0026gt;; \n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name_evil\u0026lt;/span\u0026gt; = mysql_real_escape_string(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name_evil\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query_evil\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT * FROM customers WHERE username = \u0026apos;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name_evil\u0026lt;/span\u0026gt;\u0026apos;\u0026quot;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;echo\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Escaped Evil Injection: \u0026amp;lt;br /\u0026amp;gt;\u0026quot;\u0026lt;/span\u0026gt; . \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query_evil\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;You can find more details in \u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;http://www.tizag.com/mysqlTutorial/mysql-php-sql-injection.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;MySQL - SQL Injection Prevention\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Security Warning\u0026lt;/strong\u0026gt;: This answer is not in line with security best practices. \u0026lt;a href=\u0026quot;https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Escaping is inadequate to prevent SQL injection\u0026lt;/a\u0026gt;, use \u0026lt;em\u0026gt;prepared statements\u0026lt;/em\u0026gt; instead. Use the strategy outlined below at your own risk.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;You could do something basic like this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$safe_variable\u0026lt;/span\u0026gt; = mysqli_real_escape_string(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;user-input\u0026quot;\u0026lt;/span\u0026gt;], \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbConnection\u0026lt;/span\u0026gt;);\nmysqli_query(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbConnection\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;INSERT INTO table (column) VALUES (\u0026apos;\u0026quot;\u0026lt;/span\u0026gt; . \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$safe_variable\u0026lt;/span\u0026gt; . \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026apos;)\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;This won\u0026apos;t solve every problem, but it\u0026apos;s a very good stepping stone. I left out obvious items such as checking the variable\u0026apos;s existence, format (numbers, letters, etc.).\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Whatever you do end up using, make sure that you check your input hasn\u0026apos;t already been mangled by \u0026lt;code\u0026gt;magic_quotes\u0026lt;/code\u0026gt; or some other well-meaning rubbish, and if necessary, run it through \u0026lt;code\u0026gt;stripslashes\u0026lt;/code\u0026gt; or whatever to sanitize it.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Deprecated Warning:\u0026lt;/strong\u0026gt;\n  This answer\u0026apos;s sample code (like the question\u0026apos;s sample code) uses PHP\u0026apos;s \u0026lt;code\u0026gt;MySQL\u0026lt;/code\u0026gt; extension, which was deprecated in PHP 5.5.0 and removed entirely in PHP 7.0.0.\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Security Warning\u0026lt;/strong\u0026gt;: This answer is not in line with security best practices. \u0026lt;a href=\u0026quot;https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Escaping is inadequate to prevent SQL injection\u0026lt;/a\u0026gt;, use \u0026lt;em\u0026gt;prepared statements\u0026lt;/em\u0026gt; instead. Use the strategy outlined below at your own risk. (Also, \u0026lt;code\u0026gt;mysql_real_escape_string()\u0026lt;/code\u0026gt; was removed in PHP 7.)\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;Parameterized query AND input validation is the way to go. There are many scenarios under which SQL injection may occur, even though \u0026lt;code\u0026gt;mysql_real_escape_string()\u0026lt;/code\u0026gt; has been used.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Those examples are vulnerable to SQL injection:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$offset\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;isset\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_GET\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;o\u0026apos;\u0026lt;/span\u0026gt;]) ? \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_GET\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;o\u0026apos;\u0026lt;/span\u0026gt;] : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$offset\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mysql_real_escape_string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$offset\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;RunQuery\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT userid, username FROM sql_injection_test LIMIT \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$offset\u0026lt;/span\u0026gt;, 10\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;or\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$order\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;isset\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_GET\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;o\u0026apos;\u0026lt;/span\u0026gt;]) ? \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_GET\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;o\u0026apos;\u0026lt;/span\u0026gt;] : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;userid\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$order\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mysql_real_escape_string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$order\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;RunQuery\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT userid, username FROM sql_injection_test ORDER BY `\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$order\u0026lt;/span\u0026gt;`\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;In both cases, you can\u0026apos;t use \u0026lt;code\u0026gt;\u0026apos;\u0026lt;/code\u0026gt; to protect the encapsulation.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://www.webappsec.org/projects/articles/091007.txt\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Source\u0026lt;/a\u0026gt;: \u0026lt;em\u0026gt;The Unexpected SQL Injection (When Escaping Is Not Enough)\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In my opinion, the best way to generally prevent SQL injection in your PHP application (or any web application, for that matter) is to think about your application\u0026apos;s architecture. If the only way to protect against SQL injection is to remember to use a special method or function that does The Right Thing every time you talk to the database, you are doing it wrong. That way, it\u0026apos;s just a matter of time until you forget to correctly format your query at some point in your code.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Adopting the MVC pattern and a framework like \u0026lt;a href=\u0026quot;http://cakephp.org/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;CakePHP\u0026lt;/a\u0026gt; or \u0026lt;a href=\u0026quot;http://codeigniter.com/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;CodeIgniter\u0026lt;/a\u0026gt; is probably the right way to go: Common tasks like creating secure database queries have been solved and centrally implemented in such frameworks. They help you to organize your web application in a sensible way and make you think more about loading and saving objects than about securely constructing single SQL queries. \u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;There are many ways of preventing SQL injections and other SQL hacks. You can easily find it on the Internet (Google Search). Of course \u0026lt;strong\u0026gt;PDO is one of the good solutions.\u0026lt;/strong\u0026gt; But I would like to suggest you some good links prevention from SQL injection.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;http://www.tizag.com/mysqlTutorial/mysql-php-sql-injection.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;What is SQL injection and how to prevent\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;https://php.net/manual/en/security.database.sql-injection.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;PHP manual for SQL injection\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;https://docs.microsoft.com/en-gb/archive/blogs/brian_swan/whats-the-right-way-to-prevent-sql-injection-in-php-scripts\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Microsoft explanation of SQL injection and prevention in PHP\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;And some other like \u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;https://web.archive.org/web/20190221025712/http://www.digifuzz.net/archives/2007/07/preventing-sql-injection-with-php/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Preventing SQL injection with MySQL and PHP\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Now, \u0026lt;strong\u0026gt;why you do you need to prevent your query from SQL injection?\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I would like to let you know: Why do we try for preventing SQL injection with a short example below:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Query for login authentication match:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;select * from users where email=\u0026apos;\u0026quot;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;email\u0026apos;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026apos; and password=\u0026apos;\u0026quot;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026apos; \u0026quot;\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Now, if someone (a hacker) puts\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-perl\u0026quot;\u0026gt;$_POST[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;email\u0026apos;\u0026lt;/span\u0026gt;]= admin@emali.com\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; OR \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;and password anything....\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The query will be parsed into the system only up to:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-perl\u0026quot;\u0026gt;$query=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;select * from users where email=\u0026apos;admin@emali.com\u0026apos; OR \u0026apos;1=1\u0026apos;;\n\u0026lt;/span\u0026gt;\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;The other part will be discarded. So, what will happen? A non-authorized user (hacker) will be able to log in as administrator without having his/her password. Now, he/she can do anything that the administrator/email person can do. See, it\u0026apos;s very dangerous if SQL injection is not prevented.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I favor \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Stored_procedure\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;stored procedures\u0026lt;/a\u0026gt; (\u0026lt;a href=\u0026quot;http://dev.mysql.com/doc/refman/5.1/en/stored-routines-syntax.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;MySQL has had stored procedures support since 5.0\u0026lt;/a\u0026gt;) from a security point of view - the advantages are -\u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;Most databases (including \u0026lt;a href=\u0026quot;http://dev.mysql.com/doc/refman/5.1/en/stored-routines-privileges.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;MySQL\u0026lt;/a\u0026gt;) enable user access to be restricted to executing stored procedures. The fine-grained security access control is useful to prevent escalation of privileges attacks. This prevents compromised applications from being able to run SQL directly against the database.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;They abstract the raw SQL query from the application so less information of the database structure is available to the application. This makes it harder for people to understand the underlying structure of the database and design suitable attacks.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;They accept only parameters, so the advantages of parameterized queries are there. Of course - IMO you still need to sanitize your input - especially if you are using dynamic SQL inside the stored procedure.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;p\u0026gt;The disadvantages are -\u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;They (stored procedures) are tough to maintain and tend to multiply very quickly. This makes managing them an issue.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;They are not very suitable for dynamic queries - if they are built to accept dynamic code as parameters then a lot of the advantages are negated.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I think if someone wants to use PHP and MySQL or some other dataBase server:\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;Think about learning \u0026lt;a href=\u0026quot;http://php.net/manual/en/book.pdo.php\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;PDO\u0026lt;/a\u0026gt; (PHP Data Objects)  it is a database access layer providing a uniform method of access to multiple databases.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Think about learning \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/MySQLi\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;MySQLi\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Libraries examples:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;---- \u0026lt;strong\u0026gt;PDO\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;----- No placeholders - ripe for SQL injection! \u0026lt;strong\u0026gt;It\u0026apos;s bad\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$request\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$pdoConnection\u0026lt;/span\u0026gt;-\u0026amp;gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;INSERT INTO parents (name, addr, city) values (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$addr\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$city\u0026lt;/span\u0026gt;)\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;----- Unnamed placeholders\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$request\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$pdoConnection\u0026lt;/span\u0026gt;-\u0026amp;gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;INSERT INTO parents (name, addr, city) values (?, ?, ?);\n\u0026lt;/span\u0026gt;\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;----- Named placeholders\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$request\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$pdoConnection\u0026lt;/span\u0026gt;-\u0026amp;gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;INSERT INTO parents (name, addr, city) value (:name, :addr, :city)\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;--- \u0026lt;strong\u0026gt;MySQLi\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-perl\u0026quot;\u0026gt;$request = $mysqliConnection-\u0026amp;gt;prepare(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\n       SELECT * FROM trainers\n       WHERE name = ?\n       AND email = ?\n       AND last_login \u0026amp;gt; ?\u0026apos;\u0026lt;/span\u0026gt;);\n\n    $query-\u0026amp;gt;bind_param(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;first_param\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;second_param\u0026apos;\u0026lt;/span\u0026gt;, $mail, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;time\u0026lt;/span\u0026gt;() - \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3600\u0026lt;/span\u0026gt;);\n    $query-\u0026amp;gt;execute();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;P.S\u0026lt;/strong\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;PDO wins this battle with ease. With support for twelve\ndifferent database drivers and named parameters, we can get used to its API. From a security standpoint, both of them are safe as long as the developer uses them the way they are supposed to be used\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;If possible, cast the types of your parameters. But it\u0026apos;s only working on simple types like int, bool, and float.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$unsafe_variable\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;user_id\u0026apos;\u0026lt;/span\u0026gt;];\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$safe_variable\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$unsafe_variable\u0026lt;/span\u0026gt; ;\n\n\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mysqli_query\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$conn\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;INSERT INTO table (column) VALUES (\u0026apos;\u0026quot;\u0026lt;/span\u0026gt; . \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$safe_variable\u0026lt;/span\u0026gt; . \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026apos;)\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;If you want to take advantage of cache engines, like \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Redis_%28data_store%29\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Redis\u0026lt;/a\u0026gt; or \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Memcached\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Memcached\u0026lt;/a\u0026gt;, maybe DALMP could be a choice. It uses pure \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/MySQLi\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;MySQLi\u0026lt;/a\u0026gt;. Check this: \u0026lt;a href=\u0026quot;http://dalmp.readthedocs.org/en/latest/database/PExecute.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;DALMP Database Abstraction Layer for MySQL using PHP.\u0026lt;/a\u0026gt; \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Also, you can \u0026apos;prepare\u0026apos; your arguments before preparing your query so that you can build dynamic queries and at the end have a fully prepared statements query. \u0026lt;a href=\u0026quot;http://dalmp.readthedocs.org/en/latest/database/Prepare.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;DALMP Database Abstraction Layer for MySQL using PHP.\u0026lt;/a\u0026gt; \u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;For those unsure of how to use PDO (coming from the \u0026lt;code\u0026gt;mysql_\u0026lt;/code\u0026gt; functions), I made a \u0026lt;a href=\u0026quot;https://github.com/Xeoncross/DByte/blob/master/DByte/DB.php\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;very, very simple PDO wrapper\u0026lt;/a\u0026gt; that is a single file. It exists to show how easy it is to do all the common things applications need to be done. Works with PostgreSQL, MySQL, and SQLite.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Basically, read it \u0026lt;a href=\u0026quot;http://php.net/pdo\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;while you read the manual\u0026lt;/a\u0026gt; to see how to put the PDO functions to use in real life to make it simple to store and retrieve values in the format \u0026lt;strong\u0026gt;you\u0026lt;/strong\u0026gt; want.\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;I want a single column\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-ruby\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$count\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;DB\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-symbol\u0026quot;\u0026gt;:\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-symbol\u0026quot;\u0026gt;:column\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT COUNT(*) FROM `user`\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;I want an array(key =\u0026amp;gt; value) results (i.e. for making a selectbox)\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$pairs\u0026lt;/span\u0026gt; = DB::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;pairs\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT `id`, `username` FROM `user`\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;I want a single row result\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$user\u0026lt;/span\u0026gt; = DB::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;row\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT * FROM `user` WHERE `id` = ?\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$user_id\u0026lt;/span\u0026gt;));\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;I want an array of results\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$banned_users\u0026lt;/span\u0026gt; = DB::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;fetch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT * FROM `user` WHERE `banned` = ?\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;TRUE\u0026apos;\u0026lt;/span\u0026gt;));\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n    ","\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Security Warning\u0026lt;/strong\u0026gt;: This answer is not in line with security best practices. \u0026lt;a href=\u0026quot;https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Escaping is inadequate to prevent SQL injection\u0026lt;/a\u0026gt;, use \u0026lt;em\u0026gt;prepared statements\u0026lt;/em\u0026gt; instead.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;A few guidelines for escaping special characters in SQL statements.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Don\u0026apos;t use \u0026lt;a href=\u0026quot;http://www.php.net/manual/en/intro.mysql.php\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;MySQL\u0026lt;/a\u0026gt;. This extension is deprecated. Use \u0026lt;a href=\u0026quot;http://php.net/manual/en/book.mysqli.php\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;MySQLi\u0026lt;/a\u0026gt; or \u0026lt;a href=\u0026quot;http://php.net/manual/en/book.pdo.php\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;PDO\u0026lt;/a\u0026gt; instead.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;MySQLi\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For manually escaping special characters in a string you can use the \u0026lt;a href=\u0026quot;http://www.php.net/manual/en/mysqli.real-escape-string.php\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;mysqli_real_escape_string\u0026lt;/a\u0026gt; function. The function will not work properly unless the correct character set is set with \u0026lt;a href=\u0026quot;http://www.php.net/manual/en/mysqli.set-charset.php\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;mysqli_set_charset\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Example:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mysqli\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mysqli\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;host\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;user\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;database\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mysqli\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;set_charset\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;charset\u0026apos;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$string\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mysqli\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;real_escape_string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$string\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mysqli\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;query\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;INSERT INTO table (column) VALUES (\u0026apos;\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$string\u0026lt;/span\u0026gt;\u0026apos;)\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;For automatic escaping of values with prepared statements, use \u0026lt;a href=\u0026quot;http://www.php.net/manual/en/mysqli.prepare.php\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;mysqli_prepare\u0026lt;/a\u0026gt;, and \u0026lt;a href=\u0026quot;http://www.php.net/manual/en/mysqli-stmt.bind-param.php\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;mysqli_stmt_bind_param\u0026lt;/a\u0026gt; where types for the corresponding bind variables must be provided for an appropriate conversion:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Example:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mysqli\u0026lt;/span\u0026gt;-\u0026amp;gt;prepare(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;INSERT INTO table (column1, column2) VALUES (?,?)\u0026quot;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;bind_param(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;is\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$integer\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$string\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;execute();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;No matter if you use prepared statements or \u0026lt;code\u0026gt;mysqli_real_escape_string\u0026lt;/code\u0026gt;, you always have to know the type of input data you\u0026apos;re working with.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;So if you use a prepared statement, you must specify the types of the variables for \u0026lt;code\u0026gt;mysqli_stmt_bind_param\u0026lt;/code\u0026gt; function.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;And the use of \u0026lt;code\u0026gt;mysqli_real_escape_string\u0026lt;/code\u0026gt; is for, as the name says, escaping special characters in a string, so it will not make integers safe. The purpose of this function is to prevent breaking the strings in SQL statements, and the damage to the database that it could cause. \u0026lt;code\u0026gt;mysqli_real_escape_string\u0026lt;/code\u0026gt; is a useful function when used properly, especially when combined with \u0026lt;code\u0026gt;sprintf\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Example:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$string\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;x\u0026apos; OR name LIKE \u0026apos;%John%\u0026quot;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$integer\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;5 OR id != 0\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query\u0026lt;/span\u0026gt; = sprintf( \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT id, email, pass, name FROM members WHERE email =\u0026apos;%s\u0026apos; AND id = %d\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mysqli\u0026lt;/span\u0026gt;-\u0026amp;gt;real_escape_string(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$string\u0026lt;/span\u0026gt;), \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$integer\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;echo\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query\u0026lt;/span\u0026gt;;\n// SELECT \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;, email, pass, name FROM members WHERE email =\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;x\\\u0026apos;\u0026lt;/span\u0026gt; OR name LIKE \\\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%John%\u0026apos;\u0026lt;/span\u0026gt; AND \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt; = 5\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$integer\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;99999999999999999999\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query\u0026lt;/span\u0026gt; = sprintf(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT id, email, pass, name FROM members WHERE email =\u0026apos;%s\u0026apos; AND id = %d\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mysqli\u0026lt;/span\u0026gt;-\u0026amp;gt;real_escape_string(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$string\u0026lt;/span\u0026gt;), \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$integer\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;echo\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query\u0026lt;/span\u0026gt;;\n// SELECT \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;, email, pass, name FROM members WHERE email =\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;x\\\u0026apos;\u0026lt;/span\u0026gt; OR name LIKE \\\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%John%\u0026apos;\u0026lt;/span\u0026gt; AND \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt; = 2147483647\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Security Warning\u0026lt;/strong\u0026gt;: This answer is not in line with security best practices. \u0026lt;a href=\u0026quot;https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Escaping is inadequate to prevent SQL injection\u0026lt;/a\u0026gt;, use \u0026lt;em\u0026gt;prepared statements\u0026lt;/em\u0026gt; instead. Use the strategy outlined below at your own risk. (Also, \u0026lt;code\u0026gt;mysql_real_escape_string()\u0026lt;/code\u0026gt; was removed in PHP 7.)\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Warning\u0026lt;/strong\u0026gt;: The mysql extension is removed at this time. we recommend using the \u0026lt;em\u0026gt;PDO extension\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;Using this PHP function \u0026lt;code\u0026gt;mysql_escape_string()\u0026lt;/code\u0026gt; you can get a good prevention in a fast way.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For example:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; users \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026quot;.mysql_escape_string($name_from_html_form).\u0026quot;\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;mysql_escape_string\u0026lt;/code\u0026gt;  Escapes a string for use in a mysql_query\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For more prevention, you can add at the end ...\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;wHERE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;or\u0026lt;/span\u0026gt;  LIMIT \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Finally you get:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; users \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026quot;.mysql_escape_string($name_from_html_form).\u0026quot;\u0026apos;\u0026lt;/span\u0026gt; LIMIT \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The simple alternative to this problem could be solved by granting appropriate permissions in the database itself.\nFor example: if you are using a MySQL database then enter into the database through terminal or the UI provided and just follow this command:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;GRANT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DELETE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ON\u0026lt;/span\u0026gt; database \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TO\u0026lt;/span\u0026gt; username@\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;localhost\u0026apos;\u0026lt;/span\u0026gt; IDENTIFIED \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;This will restrict the user to only get confined with the specified query\u0026apos;s only. Remove the delete permission and so the data would never get deleted from the query fired from the PHP page.\nThe second thing to do is to flush the privileges so that the MySQL refreshes the permissions and updates.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-undefined\u0026quot;\u0026gt;FLUSH PRIVILEGES; \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;more information about \u0026lt;a href=\u0026quot;https://dev.mysql.com/doc/refman/5.7/en/flush.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;flush\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;To see the current privileges for the user fire the following query.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; mysql.user \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;User\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;username\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Learn more about \u0026lt;a href=\u0026quot;https://dev.mysql.com/doc/refman/5.7/en/grant.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;GRANT\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Regarding many useful answers, I hope to add some value to this thread.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;SQL injection is an attack that can be done through user inputs (inputs that filled by a user and then used inside queries). The SQL injection patterns are correct query syntax while we can call it: bad queries for bad reasons, and we assume that there might be a bad person that try to get secret information (bypassing access control) that affect the three principles of security (confidentiality, integrity, and availability).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Now, our point is to prevent security threats such as SQL injection attacks, the question asking (how to prevent an SQL injection attack using PHP), be more realistic, data filtering or clearing input data is the case when using user-input data inside such query, using PHP or any other programming language is not the case, or as recommended by more people to use modern technology such as prepared statement or any other tools that currently supporting SQL injection prevention, consider that these tools not available anymore? How do you secure your application?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;My approach against SQL injection is: clearing user-input data before sending it to the database (before using it inside any query).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Data filtering for (converting unsafe data to safe data)\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Consider that \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/PHP#History\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;PDO\u0026lt;/a\u0026gt; and \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/MySQLi\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;MySQLi\u0026lt;/a\u0026gt; are not available. How can you secure your application? Do you force me to use them? What about other languages other than PHP? I prefer to provide general ideas as it can be used for wider border, not just for a specific language.\u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;SQL user (limiting user privilege): most common SQL operations are (SELECT, UPDATE, INSERT), then, why give the UPDATE privilege to a user that does not require it? For example, \u0026lt;strong\u0026gt;login, and search pages\u0026lt;/strong\u0026gt; are only using SELECT, then, why use DB users in these pages with high privileges?\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;RULE: do not create one database user for all privileges. For all SQL operations, you can create your scheme like (deluser, selectuser, updateuser) as usernames for easy usage.\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;See \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Principle_of_least_privilege\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;principle of least privilege\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;ol start=\u0026quot;2\u0026quot;\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Data filtering: before building any query user input, it should be validated and filtered. For programmers, it\u0026apos;s important to define some properties for each user-input variables:\n\u0026lt;strong\u0026gt;data type, data pattern, and data length\u0026lt;/strong\u0026gt;. A field that is a number between (x and y) must be exactly validated using the exact rule, and for a field that is a string (text): pattern is the case, for example, a username must contain only some characters, lets say [a-zA-Z0-9_-.]. The length varies between (x and n) where x and n (integers, x \u0026amp;lt;=n).\n\u0026lt;strong\u0026gt;Rule: creating exact filters and validation rules are best practices for me.\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Use other tools: Here, I will also agree with you that a prepared statement (parametrized query) and stored procedures. The disadvantages here is these ways require advanced skills which do not exist for most users. The basic idea here is to distinguish between the SQL query and the data that is used inside. Both approaches can be used even with unsafe data, because the user-input data here does not add anything to the original query, such as (any or x=x).\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;p\u0026gt;For more information, please read \u0026lt;a href=\u0026quot;https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;OWASP SQL Injection Prevention Cheat Sheet\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Now, if you are an advanced user, start using this defense as you like, but, for beginners, if they can\u0026apos;t quickly implement a stored procedure and prepared the statement, it\u0026apos;s better to filter input data as much they can.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Finally, let\u0026apos;s consider that a user sends this text below instead of entering his/her username:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;] \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;UNION\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; IF(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUBSTRING\u0026lt;/span\u0026gt;(Password,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;2\u0026apos;\u0026lt;/span\u0026gt;,BENCHMARK(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100000\u0026lt;/span\u0026gt;,SHA1(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)),\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;User\u0026lt;/span\u0026gt;,Password \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; mysql.user \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;User\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;root\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;This input can be checked early without any prepared statement and stored procedures, but to be on the safe side, using them starts after user-data filtering and validation.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The last point is detecting unexpected behavior which requires more effort and complexity; it\u0026apos;s not recommended for normal web applications.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Unexpected behavior in the above user input is SELECT, UNION, IF, SUBSTRING, BENCHMARK, SHA, and root. Once these words detected, you can avoid the input.\u0026lt;/p\u0026gt;\n\n\u0026lt;h2\u0026gt;UPDATE 1:\u0026lt;/h2\u0026gt;\n\n\u0026lt;p\u0026gt;A user commented that this post is useless, OK! Here is what \u0026lt;a href=\u0026quot;https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet#Defense_Option_3:_Escaping_All_User_Supplied_Input\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;OWASP.ORG provided\u0026lt;/a\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;Primary defenses: \u0026lt;br\u0026gt;\n   \u0026lt;br\u0026gt;\n      Option #1: Use of Prepared Statements (Parameterized Queries) \u0026lt;br\u0026gt;\n      Option #2: Use of Stored Procedures \u0026lt;br\u0026gt;\n      Option #3: Escaping all User Supplied Input  \u0026lt;br\u0026gt;\n   \u0026lt;br\u0026gt;\n  Additional defenses: \u0026lt;br\u0026gt;\n   \u0026lt;br\u0026gt;\n      Also Enforce: Least Privilege \u0026lt;br\u0026gt;\n      Also Perform: White List Input Validation \u0026lt;br\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;As you may know, claiming an article should be supported by a valid argument, at least by one reference! Otherwise, it\u0026apos;s considered as an attack and a bad claim!\u0026lt;/p\u0026gt;\n\n\u0026lt;h2\u0026gt;Update 2:\u0026lt;/h2\u0026gt;\n\n\u0026lt;p\u0026gt;From the PHP manual, \u0026lt;a href=\u0026quot;http://php.net/manual/en/mysqli.quickstart.prepared-statements.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;PHP: Prepared Statements - Manual\u0026lt;/a\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;Escaping and SQL injection \u0026lt;br\u0026gt;\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt;Bound variables will be escaped automatically by the server. The\n  server inserts their escaped values at the appropriate places into the\n  statement template before execution. A hint must be provided to the\n  server for the type of bound variable, to create an appropriate\n  conversion. See the mysqli_stmt_bind_param() function for more\n  information. \u0026lt;br\u0026gt;\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt;The automatic escaping of values within the server is sometimes\n  considered a security feature to prevent SQL injection. The same\n  degree of security can be achieved with non-prepared statements if\n  input values are escaped correctly. \u0026lt;br\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;h2\u0026gt;Update 3:\u0026lt;/h2\u0026gt;\n\n\u0026lt;p\u0026gt;I created test cases for knowing how PDO and MySQLi send the query to the MySQL server when using a prepared statement:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;PDO:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$user\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026apos;\u0026apos;1\u0026apos;\u0026apos;\u0026quot;\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Malicious keyword\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT * FROM awa_user WHERE userame =:username\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sth\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbh\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;prepare\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;(PDO::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;ATTR_CURSOR\u0026lt;/span\u0026gt; =\u0026amp;gt; PDO::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;CURSOR_FWDONLY\u0026lt;/span\u0026gt;));\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sth\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;execute\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;:username\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$user\u0026lt;/span\u0026gt;));\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Query Log:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;    \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;189\u0026lt;/span\u0026gt; Query \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; awa_user \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; userame \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\\\u0026apos;\u0026lt;/span\u0026gt;\\\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;1\\\u0026apos;\u0026lt;/span\u0026gt;\\\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;189\u0026lt;/span\u0026gt; Quit\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;MySQLi:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mysqli\u0026lt;/span\u0026gt;-\u0026amp;gt;prepare(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT * FROM awa_user WHERE username =?\u0026quot;\u0026lt;/span\u0026gt;)) {\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;bind_param(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;s\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$user\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$user\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026apos;\u0026apos;1\u0026apos;\u0026apos;\u0026quot;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;execute();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Query Log:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;    \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;188\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Prepare\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; awa_user \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; username \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;?\n    \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;188\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Execute\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; awa_user \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; username \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\\\u0026apos;\u0026lt;/span\u0026gt;\\\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;1\\\u0026apos;\u0026lt;/span\u0026gt;\\\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;188\u0026lt;/span\u0026gt; Quit\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;h3\u0026gt;It\u0026apos;s clear that a prepared statement is also escaping the data, nothing else.\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;As also mentioned in the above statement,\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;The automatic escaping of values within the server is sometimes considered a security feature to prevent SQL injection. The same degree of security can be achieved with non-prepared statements, if input values are escaped correctly\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;Therefore, this proves that data validation such as \u0026lt;code\u0026gt;intval()\u0026lt;/code\u0026gt; is a good idea for integer values before sending any query. In addition, preventing malicious user data before sending the query is \u0026lt;strong\u0026gt;a correct and valid approach\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Please see this question for more detail: \u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/18026088/pdo-sends-raw-query-to-mysql-while-mysqli-sends-prepared-query-both-produce-the\u0026quot;\u0026gt;PDO sends raw query to MySQL while Mysqli sends prepared query, both produce the same result\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;References:\u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://ferruh.mavituna.com/sql-injection-cheatsheet-oku/#UnionInjections\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;SQL Injection Cheat Sheet\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;https://www.owasp.org/index.php/SQL_Injection\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;SQL Injection\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Information_security\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Information security\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://www.dwheeler.com/secure-programs/Secure-Programs-HOWTO/security-principles.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Security Principles\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Data_validation\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Data validation\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n    ","\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Security Warning\u0026lt;/strong\u0026gt;: This answer is not in line with security best practices. \u0026lt;a href=\u0026quot;https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Escaping is inadequate to prevent SQL injection\u0026lt;/a\u0026gt;, use \u0026lt;em\u0026gt;prepared statements\u0026lt;/em\u0026gt; instead. Use the strategy outlined below at your own risk. (Also, \u0026lt;code\u0026gt;mysql_real_escape_string()\u0026lt;/code\u0026gt; was removed in PHP 7.)\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Deprecated Warning\u0026lt;/strong\u0026gt;: The mysql extension is deprecated at this time. we recommend using the \u0026lt;em\u0026gt;PDO extension\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;I use three different ways to prevent my web application from being vulnerable to SQL injection.\u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;Use of \u0026lt;code\u0026gt;mysql_real_escape_string()\u0026lt;/code\u0026gt;, which is a pre-defined function in \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/PHP\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;PHP\u0026lt;/a\u0026gt;, and this code add backslashes to the following characters: \u0026lt;code\u0026gt;\\x00\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;\\n\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;\\r\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;\\\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;\u0026apos;\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;\u0026quot;\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;\\x1a\u0026lt;/code\u0026gt;. Pass the input values as parameters to minimize the chance of SQL injection.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;The most advanced way is to use PDOs.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;p\u0026gt;I hope this will help you.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Consider the following query:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;$iId = mysql_real_escape_string(\u0026quot;1 OR 1=1\u0026quot;);\n $sSql = \u0026quot;SELECT * FROM table WHERE id = $iId\u0026quot;;\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;mysql_real_escape_string() will not protect here. If you use single quotes (\u0026apos; \u0026apos;) around your variables inside your query is what protects you against this. Here is an solution below for this:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;$iId = (int) mysql_real_escape_string(\u0026quot;1 OR 1=1\u0026quot;);\n $sSql = \u0026quot;SELECT * FROM table WHERE id = $iId\u0026quot;;\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/5741187/sql-injection-that-gets-around-mysql-real-escape-string\u0026quot;\u0026gt;question\u0026lt;/a\u0026gt; has some good answers about this.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I suggest, using PDO is the best option.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Edit:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;mysql_real_escape_string()\u0026lt;/code\u0026gt; is deprecated as of PHP 5.5.0. Use either mysqli or PDO.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;An alternative to mysql_real_escape_string() is \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mysqli_real_escape_string\u0026lt;/span\u0026gt; ( mysqli \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$link\u0026lt;/span\u0026gt; , \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$escapestr\u0026lt;/span\u0026gt; )\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Example:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$iId\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mysqli\u0026lt;/span\u0026gt;-\u0026amp;gt;real_escape_string(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;1 OR 1=1\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mysqli\u0026lt;/span\u0026gt;-\u0026amp;gt;query(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT * FROM table WHERE id = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$iId\u0026lt;/span\u0026gt;\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;A simple way would be to use a PHP framework like \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Codeigniter#CodeIgniter\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;CodeIgniter\u0026lt;/a\u0026gt; or \u0026lt;a href=\u0026quot;https://laravel.com/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Laravel\u0026lt;/a\u0026gt; which have inbuilt features like filtering and active-record so that you don\u0026apos;t have to worry about these nuances.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Warning: the approach described in this answer only applies to very specific scenarios and isn\u0026apos;t secure since SQL injection attacks do not only rely on being able to inject \u0026lt;code\u0026gt;X=Y\u0026lt;/code\u0026gt;.\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;If the attackers are trying to hack into the form via PHP\u0026apos;s \u0026lt;code\u0026gt;$_GET\u0026lt;/code\u0026gt; variable or with the URL\u0026apos;s query string, you would be able to catch them if they\u0026apos;re not secure.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;RewriteCond %{QUERY_STRING} ([0-9]+)=([0-9]+)\nRewriteRule ^(.*) ^/track.php\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Because \u0026lt;code\u0026gt;1=1\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;2=2\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;1=2\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;2=1\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;1+1=2\u0026lt;/code\u0026gt;, etc... are the common questions to an SQL database of an attacker. Maybe also it\u0026apos;s used by many hacking applications.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;But you must be careful, that you must not rewrite a safe query from your site. The code above is giving you a tip, to rewrite or redirect \u0026lt;em\u0026gt;(it depends on you)\u0026lt;/em\u0026gt; that hacking-specific dynamic query string into a page that will store the attacker\u0026apos;s \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/IP_address\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;IP address\u0026lt;/a\u0026gt;, or EVEN THEIR COOKIES, history, browser, or any other sensitive information, so you can deal with them later by banning their account or contacting authorities.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;A good idea is to use an \u0026lt;a href=\u0026quot;https://en.wikipedia.org/wiki/Object-relational_mapping\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;object-relational mapper\u0026lt;/a\u0026gt; like \u0026lt;a href=\u0026quot;http://j4mie.github.io/idiormandparis/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Idiorm\u0026lt;/a\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-rust\u0026quot;\u0026gt;$user = ORM::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;for_table\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-symbol\u0026quot;\u0026gt;\u0026apos;user\u0026lt;/span\u0026gt;\u0026apos;)\n\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;-\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;where_equal\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-symbol\u0026quot;\u0026gt;\u0026apos;username\u0026lt;/span\u0026gt;\u0026apos;, \u0026lt;span class=\u0026quot;hljs-symbol\u0026quot;\u0026gt;\u0026apos;j4mie\u0026lt;/span\u0026gt;\u0026apos;)\n\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;-\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;find_one\u0026lt;/span\u0026gt;();\n\n$user\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;-\u0026amp;gt;\u0026lt;/span\u0026gt;first_name = \u0026lt;span class=\u0026quot;hljs-symbol\u0026quot;\u0026gt;\u0026apos;Jamie\u0026lt;/span\u0026gt;\u0026apos;;\n$user\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;-\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;save\u0026lt;/span\u0026gt;();\n\n$tweets = ORM::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;for_table\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-symbol\u0026quot;\u0026gt;\u0026apos;tweet\u0026lt;/span\u0026gt;\u0026apos;)\n    \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;-\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-symbol\u0026quot;\u0026gt;\u0026apos;tweet\u0026lt;/span\u0026gt;.*\u0026apos;)\n    \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;-\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-symbol\u0026quot;\u0026gt;\u0026apos;user\u0026lt;/span\u0026gt;\u0026apos;, \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;(\n        \u0026lt;span class=\u0026quot;hljs-symbol\u0026quot;\u0026gt;\u0026apos;user\u0026lt;/span\u0026gt;.id\u0026apos;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;=\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-symbol\u0026quot;\u0026gt;\u0026apos;tweet\u0026lt;/span\u0026gt;.user_id\u0026apos;\n    ))\n    \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;-\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;where_equal\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-symbol\u0026quot;\u0026gt;\u0026apos;user\u0026lt;/span\u0026gt;.username\u0026apos;, \u0026lt;span class=\u0026quot;hljs-symbol\u0026quot;\u0026gt;\u0026apos;j4mie\u0026lt;/span\u0026gt;\u0026apos;)\n    \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;-\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;find_many\u0026lt;/span\u0026gt;();\n\n\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;foreach\u0026lt;/span\u0026gt; ($tweets \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; $tweet) {\n    echo $tweet\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;-\u0026amp;gt;\u0026lt;/span\u0026gt;text;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;It not only saves you from SQL injections, but from syntax errors too! It also supports collections of models with method chaining to filter or apply actions to multiple results at once and multiple connections.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;There are so many answers for \u0026lt;strong\u0026gt;PHP and MySQL\u0026lt;/strong\u0026gt;, but here is code for \u0026lt;strong\u0026gt;PHP and Oracle\u0026lt;/strong\u0026gt; for preventing SQL injection as well as regular use of oci8 drivers:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$conn\u0026lt;/span\u0026gt; = oci_connect(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$username\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$connection_string\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt; = oci_parse(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$conn\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;UPDATE table SET field = :xx WHERE ID = 123\u0026apos;\u0026lt;/span\u0026gt;);\noci_bind_by_name(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;:xx\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$fieldval\u0026lt;/span\u0026gt;);\noci_execute(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Deprecated Warning:\u0026lt;/strong\u0026gt;\n  This answer\u0026apos;s sample code (like the question\u0026apos;s sample code) uses PHP\u0026apos;s \u0026lt;code\u0026gt;MySQL\u0026lt;/code\u0026gt; extension, which was deprecated in PHP 5.5.0 and removed entirely in PHP 7.0.0.\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Security Warning\u0026lt;/strong\u0026gt;: This answer is not in line with security best practices. \u0026lt;a href=\u0026quot;https://paragonie.com/blog/2015/05/preventing-sql-injection-in-php-applications-easy-and-definitive-guide\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Escaping is inadequate to prevent SQL injection\u0026lt;/a\u0026gt;, use \u0026lt;em\u0026gt;prepared statements\u0026lt;/em\u0026gt; instead. Use the strategy outlined below at your own risk. (Also, \u0026lt;code\u0026gt;mysql_real_escape_string()\u0026lt;/code\u0026gt; was removed in PHP 7.)\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;Using \u0026lt;a href=\u0026quot;http://in3.php.net/pdo\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;PDO\u0026lt;/a\u0026gt; and \u0026lt;a href=\u0026quot;http://in3.php.net/mysqli\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;MYSQLi\u0026lt;/a\u0026gt; is a good practice to prevent SQL injections, but if you really want to work with MySQL functions and queries, it would be better to use\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://php.net/manual/en/function.mysql-real-escape-string.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;mysql_real_escape_string\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$unsafe_variable\u0026lt;/span\u0026gt; = mysql_real_escape_string(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;user_input\u0026apos;\u0026lt;/span\u0026gt;]);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;There are more abilities to prevent this: like identify - if the input is a string, number, char or array, there are so many inbuilt functions to detect this. Also, it would be better to use these functions to check input data.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://in3.php.net/is_string\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;is_string\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$unsafe_variable\u0026lt;/span\u0026gt; = (is_string(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;user_input\u0026apos;\u0026lt;/span\u0026gt;]) ? \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;user_input\u0026apos;\u0026lt;/span\u0026gt;] : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://in3.php.net/manual/en/function.is-numeric.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;is_numeric\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$unsafe_variable\u0026lt;/span\u0026gt; = (is_numeric(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;user_input\u0026apos;\u0026lt;/span\u0026gt;]) ? \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;user_input\u0026apos;\u0026lt;/span\u0026gt;] : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;And it is so much better to use those functions to check input data with \u0026lt;code\u0026gt;mysql_real_escape_string\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I\u0026apos;ve written this little function several years ago:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;sqlvprintf\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$args\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;)\n\u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;global\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$DB_LINK\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$ctr\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;ensureConnection\u0026lt;/span\u0026gt;(); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Connect to database if not connected already.\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$values\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;();\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;foreach\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$args\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$value\u0026lt;/span\u0026gt;)\n    {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;is_string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$value\u0026lt;/span\u0026gt;))\n        {\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$value\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026apos;\u0026quot;\u0026lt;/span\u0026gt; . \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mysqli_real_escape_string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$DB_LINK\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$value\u0026lt;/span\u0026gt;) . \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026apos;\u0026quot;\u0026lt;/span\u0026gt;;\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;is_null\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$value\u0026lt;/span\u0026gt;))\n        {\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$value\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;NULL\u0026apos;\u0026lt;/span\u0026gt;;\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;is_int\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$value\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; !\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;is_float\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$value\u0026lt;/span\u0026gt;))\n        {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;die\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Only numeric, string, array and NULL arguments allowed in a query. Argument \u0026apos;\u0026lt;/span\u0026gt;.(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$ctr\u0026lt;/span\u0026gt;+\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; is not a basic type, it\\\u0026apos;s type is \u0026apos;\u0026lt;/span\u0026gt;. \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;gettype\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$value\u0026lt;/span\u0026gt;). \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;.\u0026apos;\u0026lt;/span\u0026gt;);\n        }\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$values\u0026lt;/span\u0026gt;[] = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$value\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$ctr\u0026lt;/span\u0026gt;++;\n    }\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;preg_replace_callback\u0026lt;/span\u0026gt;(\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/{(\\\\d+)}/\u0026apos;\u0026lt;/span\u0026gt;, \n        function(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$match\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;use\u0026lt;/span\u0026gt; ($\u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;values\u0026lt;/span\u0026gt;)\n        {\n            \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;isset\u0026lt;/span\u0026gt;($\u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;values\u0026lt;/span\u0026gt;[$\u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;match\u0026lt;/span\u0026gt;[1]]))\n            {\n                \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; $\u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;values\u0026lt;/span\u0026gt;[$\u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;match\u0026lt;/span\u0026gt;[1]];\n            }\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt;\n            {\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$match\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;];\n            }\n        },\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query\u0026lt;/span\u0026gt;\n    );\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$query\u0026lt;/span\u0026gt;;\n}\n\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;runEscapedQuery\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$preparedQuery\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/*, ...*/\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;)\n\u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$params\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;array_slice\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;func_get_args\u0026lt;/span\u0026gt;(), \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$results\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;runQuery\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;sqlvprintf\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$preparedQuery\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$params\u0026lt;/span\u0026gt;)); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Run query and fetch results.   \u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$results\u0026lt;/span\u0026gt;;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;This allows running statements in an one-liner C#-ish String.Format like:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-bash\u0026quot;\u0026gt;runEscapedQuery(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;INSERT INTO Whatever (id, foo, bar) VALUES ({0}, {1}, {2})\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$numericVar\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stringVar1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stringVar2\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;It escapes considering the variable type. If you try to parameterize table, column names, it would fail as it puts every string in quotes which is an invalid syntax.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;SECURITY UPDATE: The previous \u0026lt;code\u0026gt;str_replace\u0026lt;/code\u0026gt; version allowed injections by adding {#} tokens into user data. This \u0026lt;code\u0026gt;preg_replace_callback\u0026lt;/code\u0026gt; version doesn\u0026apos;t cause problems if the replacement contains these tokens.\u0026lt;/p\u0026gt;\n    "],"id":4,"title":"How can I prevent SQL injection in PHP?","content":"\n                    \u0026lt;div\u0026gt;\n            \u0026lt;aside class=\u0026quot;s-notice s-notice__info post-notice js-post-notice mb16\u0026quot; role=\u0026quot;status\u0026quot;\u0026gt;\n        \u0026lt;div class=\u0026quot;d-flex fd-column fw-nowrap\u0026quot;\u0026gt;\n            \u0026lt;div class=\u0026quot;d-flex fw-nowrap\u0026quot;\u0026gt;\n                    \u0026lt;div class=\u0026quot;flex--item mr8\u0026quot;\u0026gt;\n                        \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;svg-icon iconLock\u0026quot; width=\u0026quot;18\u0026quot; height=\u0026quot;18\u0026quot; viewBox=\u0026quot;0 0 18 18\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;M16 9a2 2 0 0 0-2-2V6A5 5 0 0 0 4 6v1a2 2 0 0 0-2 2v6c0 1.1.9 2 2 2h10a2 2 0 0 0 2-2V9Zm-7 5a2 2 0 1 1 0-4 2 2 0 0 1 0 4Zm3.1-7H5.9V6a3.1 3.1 0 0 1 6.2 0v1Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                    \u0026lt;/div\u0026gt;\n                \u0026lt;div class=\u0026quot;flex--item wmn0 fl1 lh-lg\u0026quot;\u0026gt;\n                    \u0026lt;div class=\u0026quot;flex--item fl1 lh-lg\u0026quot;\u0026gt;\n                        \u0026lt;b\u0026gt;This question\u0026apos;s answers are a \u0026lt;a href=\u0026quot;/help/privileges/edit-community-wiki\u0026quot;\u0026gt;community effort\u0026lt;/a\u0026gt;\u0026lt;/b\u0026gt;. Edit existing answers to improve this post. It is not currently accepting new answers or interactions.\n                        \n                    \u0026lt;/div\u0026gt;\n                \u0026lt;/div\u0026gt;\n            \u0026lt;/div\u0026gt;\n        \u0026lt;/div\u0026gt;\n\u0026lt;/aside\u0026gt;\n\n    \u0026lt;/div\u0026gt;\n\n\u0026lt;p\u0026gt;If user input is inserted without modification into an SQL query, then the application becomes vulnerable to \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/332367/\u0026quot;\u0026gt;SQL injection\u0026lt;/a\u0026gt;, like in the following example:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$unsafe_variable\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;user_input\u0026apos;\u0026lt;/span\u0026gt;]; \n\n\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mysql_query\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;INSERT INTO `table` (`column`) VALUES (\u0026apos;\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$unsafe_variable\u0026lt;/span\u0026gt;\u0026apos;)\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;That\u0026apos;s because the user can input something like \u0026lt;code\u0026gt;value\u0026apos;); DROP TABLE table;--\u0026lt;/code\u0026gt;, and the query becomes:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INTO\u0026lt;/span\u0026gt; `\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt;` (`\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;column\u0026lt;/span\u0026gt;`) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;VALUES\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;value\u0026apos;\u0026lt;/span\u0026gt;); \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DROP\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TABLE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt;;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--\u0026apos;)\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;What can be done to prevent this from happening?\u0026lt;/p\u0026gt;\n    ","slug":"how-can-i-prevent-sql-injection-in-php-1657384220094","postType":"QUESTION","createdAt":"2022-07-09T16:30:20.000Z","updatedAt":"2022-07-09T16:30:20.000Z","tags":[{"id":8,"name":"php","slug":"php","createdAt":"2022-07-09T16:30:20.000Z","updatedAt":"2022-07-09T16:30:20.000Z","Questions_Tags":{"questionId":4,"tagId":8}},{"id":9,"name":"mysql","slug":"mysql","createdAt":"2022-07-09T16:30:20.000Z","updatedAt":"2022-07-09T16:30:20.000Z","Questions_Tags":{"questionId":4,"tagId":9}},{"id":10,"name":"sql","slug":"sql","createdAt":"2022-07-09T16:30:20.000Z","updatedAt":"2022-07-09T16:30:20.000Z","Questions_Tags":{"questionId":4,"tagId":10}},{"id":11,"name":"security","slug":"security","createdAt":"2022-07-09T16:30:20.000Z","updatedAt":"2022-07-09T16:30:20.000Z","Questions_Tags":{"questionId":4,"tagId":11}},{"id":12,"name":"sql-injection","slug":"sql-injection","createdAt":"2022-07-09T16:30:20.000Z","updatedAt":"2022-07-09T16:30:20.000Z","Questions_Tags":{"questionId":4,"tagId":12}}],"relatedQuestions":[{"title":"How can I prevent SQL injection in PHP?","slug":"how-can-i-prevent-sql-injection-in-php-1657384220094","tags":[{"name":"php","Questions_Tags":{"questionId":4,"tagId":8}},{"name":"mysql","Questions_Tags":{"questionId":4,"tagId":9}},{"name":"sql","Questions_Tags":{"questionId":4,"tagId":10}},{"name":"security","Questions_Tags":{"questionId":4,"tagId":11}},{"name":"sql-injection","Questions_Tags":{"questionId":4,"tagId":12}}]}]},"randomQuestions":[{"title":"Methods in ES6 objects: using arrow functions","slug":"methods-in-es6-objects:-using-arrow-functions-1657388249058"},{"title":"jQuery Ajax File Upload","slug":"jquery-ajax-file-upload-1657387368970"},{"title":"How to make function decorators and chain them together?","slug":"how-to-make-function-decorators-and-chain-them-together-1657388180803"},{"title":"How do I merge two dictionaries in a single expression?","slug":"how-do-i-merge-two-dictionaries-in-a-single-expression-1657387593160"},{"title":"Use of 'prototype' vs. 'this' in JavaScript?","slug":"use-of-'prototype'-vs.-'this'-in-javascript-1657388117307"},{"title":"How to store objects in HTML5 localStorage","slug":"how-to-store-objects-in-html5-localstorage-1657387568907"},{"title":"How do I use extern to share variables between source files?","slug":"how-do-i-use-extern-to-share-variables-between-source-files-1657387453605"},{"title":"How to make good reproducible pandas examples","slug":"how-to-make-good-reproducible-pandas-examples-1657384310402"},{"title":"How to format numbers as currency strings","slug":"how-to-format-numbers-as-currency-strings-1657388399166"},{"title":"Google Maps JS API v3 - Simple Multiple Marker Example","slug":"google-maps-js-api-v3-simple-multiple-marker-example-1657388073335"},{"title":"What happens if you use the 32-bit int 0x80 Linux ABI in 64-bit code?","slug":"what-happens-if-you-use-the-32-bit-int-0x80-linux-abi-in-64-bit-code-1657388560485"},{"title":"How do I properly clean up Excel interop objects?","slug":"how-do-i-properly-clean-up-excel-interop-objects-1657388329706"},{"title":"What is the purpose of the var keyword and when should I use it (or omit it)?","slug":"what-is-the-purpose-of-the-var-keyword-and-when-should-i-use-it-(or-omit-it)-1657387525538"},{"title":"How do I sort a dictionary by value?","slug":"how-do-i-sort-a-dictionary-by-value-1657385485049"},{"title":"Why aren't variable-length arrays part of the C++ standard?","slug":"why-aren't-variable-length-arrays-part-of-the-c++-standard-1657384712975"},{"title":"Why JSF calls getters multiple times","slug":"why-jsf-calls-getters-multiple-times-1657388244489"},{"title":"Can I mix MySQL APIs in PHP?","slug":"can-i-mix-mysql-apis-in-php-1657384597444"},{"title":"The Definitive C++ Book Guide and List","slug":"the-definitive-c++-book-guide-and-list-1657384247395"},{"title":"What are the nuances of scope prototypal / prototypical inheritance in AngularJS?","slug":"what-are-the-nuances-of-scope-prototypal-prototypical-inheritance-in-angularjs-1657387340067"},{"title":"What is a NullPointerException, and how do I fix it?","slug":"what-is-a-nullpointerexception-and-how-do-i-fix-it-1657384201768"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"how-can-i-prevent-sql-injection-in-php-1657384220094"},"buildId":"6ctJfCympFH_chh5mjicD","isFallback":false,"gsp":true,"locale":"en","locales":["en"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>