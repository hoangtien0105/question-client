<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find solution for coding, HTML, CSS, JAVASCRIPT, MYSQL, PHP, PYTHON,... quickly. - solutionschecker.com"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><title>Are global variables thread-safe in Flask? How do I share data between requests? | Solutions Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="In my application, the state of a common object is changed by making requests, and the response depends on the state.
class SomeObj():
    def __init__(self, param):
        self.param = param
    def query(self):
        self.param += 1
        return self.param

global_obj = SomeObj(0)

@app.route(&#x27;/&#x27;)
def home():
    flash(global_obj.query())
    render_template(&#x27;index.html&#x27;)

If I run this on my development server, I expect to get 1, 2, 3 and so on.  If requests are made from 100 different clients simultaneously, can something go wrong? The expected result would be that the 100 different clients each see a unique number from 1 to 100. Or will something like this happen:

Client 1 queries. self.param is incremented by 1.
Before the return statement can be executed, the thread switches over to client 2. self.param is incremented again.
The thread switches back to client 1, and the client is returned the number 2, say.
Now the thread moves to client 2 and returns him/her the number 3.

Since there were only two clients, the expected results were 1 and 2, not 2 and 3. A number was skipped.
Will this actually happen as I scale up my application? What alternatives to a global variable should I look at?
    "/><meta property="og:title" content="Are global variables thread-safe in Flask? How do I share data between requests? | Solutions Checker"/><meta property="og:description" content="In my application, the state of a common object is changed by making requests, and the response depends on the state.
class SomeObj():
    def __init__(self, param):
        self.param = param
    def query(self):
        self.param += 1
        return self.param

global_obj = SomeObj(0)

@app.route(&#x27;/&#x27;)
def home():
    flash(global_obj.query())
    render_template(&#x27;index.html&#x27;)

If I run this on my development server, I expect to get 1, 2, 3 and so on.  If requests are made from 100 different clients simultaneously, can something go wrong? The expected result would be that the 100 different clients each see a unique number from 1 to 100. Or will something like this happen:

Client 1 queries. self.param is incremented by 1.
Before the return statement can be executed, the thread switches over to client 2. self.param is incremented again.
The thread switches back to client 1, and the client is returned the number 2, say.
Now the thread moves to client 2 and returns him/her the number 3.

Since there were only two clients, the expected results were 1 and 2, not 2 and 3. A number was skipped.
Will this actually happen as I scale up my application? What alternatives to a global variable should I look at?
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"Are global variables thread-safe in Flask? How do I share data between requests?","text":"In my application, the state of a common object is changed by making requests, and the response depends on the state.\nclass SomeObj():\n    def __init__(self, param):\n        self.param = param\n    def query(self):\n        self.param += 1\n        return self.param\n\nglobal_obj = SomeObj(0)\n\n@app.route(&apos;/&apos;)\ndef home():\n    flash(global_obj.query())\n    render_template(&apos;index.html&apos;)\n\nIf I run this on my development server, I expect to get 1, 2, 3 and so on.  If requests are made from 100 different clients simultaneously, can something go wrong? The expected result would be that the 100 different clients each see a unique number from 1 to 100. Or will something like this happen:\n\nClient 1 queries. self.param is incremented by 1.\nBefore the return statement can be executed, the thread switches over to client 2. self.param is incremented again.\nThe thread switches back to client 1, and the client is returned the number 2, say.\nNow the thread moves to client 2 and returns him/her the number 3.\n\nSince there were only two clients, the expected results were 1 and 2, not 2 and 3. A number was skipped.\nWill this actually happen as I scale up my application? What alternatives to a global variable should I look at?\n    ","answerCount":4,"upVoteCount":500,"suggestedAnswer":[{"text":"You can&apos;t use global variables to hold this sort of data. Not only is it not thread safe, it&apos;s not process safe, and WSGI servers in production spawn multiple processes. Not only would your counts be wrong if you were using threads to handle requests, they would also vary depending on which process handled the request.\n\nUse a data source outside of Flask to hold global data. A database, memcached, or redis are all appropriate separate storage areas, depending on your needs. If you need to load and access Python data, consider multiprocessing.Manager. You could also use the session for simple data that is per-user.\n\n\n\nThe development server may run in single thread and process. You won&apos;t see the behavior you describe since each request will be handled synchronously. Enable threads or processes and you will see it. app.run(threaded=True) or app.run(processes=10). (In 1.0 the server is threaded by default.)\n\n\n\nSome WSGI servers may support gevent or another async worker. Global variables are still not thread safe because there&apos;s still no protection against most race conditions. You can still have a scenario where one worker gets a value, yields, another modifies it, yields, then the first worker also modifies it.\n\n\n\nIf you need to store some global data during a request, you may use Flask&apos;s g object. Another common case is some top-level object that manages database connections. The distinction for this type of &quot;global&quot; is that it&apos;s unique to each request, not used between requests, and there&apos;s something managing the set up and teardown of the resource.\n    ","url":"/questions/[slug]#solution1","@type":"Answer","upvoteCount":0},{"text":"This is not really an answer to thread safety of globals.\n\nBut I think it is important to mention sessions here.\nYou are looking for a way to store client-specific data. Every connection should have access to its own pool of data, in a threadsafe way.\n\nThis is possible with server-side sessions, and they are available in a very neat flask plugin: https://pythonhosted.org/Flask-Session/\n\nIf you set up sessions, a session variable is available in all your routes and it behaves like a dictionary. The data stored in this dictionary is individual for each connecting client.\n\nHere is a short demo:\n\nfrom flask import Flask, session\nfrom flask_session import Session\n\napp = Flask(__name__)\n# Check Configuration section for more details\nSESSION_TYPE = &apos;filesystem&apos;\napp.config.from_object(__name__)\nSession(app)\n\n@app.route(&apos;/&apos;)\ndef reset():\n    session[&quot;counter&quot;]=0\n\n    return &quot;counter was reset&quot;\n\n@app.route(&apos;/inc&apos;)\ndef routeA():\n    if not &quot;counter&quot; in session:\n        session[&quot;counter&quot;]=0\n\n    session[&quot;counter&quot;]+=1\n\n    return &quot;counter is {}&quot;.format(session[&quot;counter&quot;])\n\n@app.route(&apos;/dec&apos;)\ndef routeB():\n    if not &quot;counter&quot; in session:\n        session[&quot;counter&quot;] = 0\n\n    session[&quot;counter&quot;] -= 1\n\n    return &quot;counter is {}&quot;.format(session[&quot;counter&quot;])\n\n\nif __name__ == &apos;__main__&apos;:\n    app.run()\n\n\nAfter pip install Flask-Session, you should be able to run this. Try accessing it from different browsers, you&apos;ll see that the counter is not shared between them.\n    ","url":"/questions/[slug]#solution2","@type":"Answer","upvoteCount":0},{"text":"Another example of a data source external to requests is a cache, such as what&apos;s provided by Flask-Caching or another extension.\n\nCreate a file common.py and place in it the following:\n\nfrom flask_caching import Cache\n\n# Instantiate the cache\ncache = Cache()\n\n\nIn the file where your flask app is created, register your cache with the following code:\n\n# Import cache\nfrom common import cache\n\n# ...\napp = Flask(__name__)\n\ncache.init_app(app=app, config={&quot;CACHE_TYPE&quot;: &quot;filesystem&quot;,&apos;CACHE_DIR&apos;: Path(&apos;/tmp&apos;)})\n\n\nNow use throughout your application by importing the cache and executing as follows:\n\n# Import cache\nfrom common import cache\n\n# store a value\ncache.set(&quot;my_value&quot;, 1_000_000)\n\n# Get a value\nmy_value = cache.get(&quot;my_value&quot;)\n\n    ","url":"/questions/[slug]#solution3","@type":"Answer","upvoteCount":0},{"text":"While totally accepting the previous upvoted answers, and discouraging use of global variables for production and scalable Flask storage, for the purpose of prototyping or really simple servers, running under the flask &apos;development server&apos;...\n...\nThe Python built-in data types, and I personally used and tested the global dict, as per Python documentation are thread safe. Not process safe.\nThe insertions, lookups, and reads from such a (server global) dict will be OK from each (possibly concurrent) Flask session running under the development server.\nWhen such a global dict is keyed with a unique Flask session key, it can be rather useful for server-side storage of session specific data otherwise not fitting into the cookie (max size 4 kB).\nOf course, such a server global dict should be carefully guarded for growing too large, being in-memory. Some sort of expiring the &apos;old&apos; key/value pairs can be coded during request processing.\nAgain, it is not recommended for production or scalable deployments, but it is possibly OK for local task-oriented servers where a separate database is too much for the given task.\n...\n    ","url":"/questions/[slug]#solution4","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/08bcc42a26fe5c92.css" as="style"/><link rel="stylesheet" href="/_next/static/css/08bcc42a26fe5c92.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-ccfab947c79712f4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-08d1a634dea6705e.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/150-b06815e21c943e0d.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/108-87de33c23337ff53.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-79a1437acf654019.js" defer=""></script><script src="/_next/static/Zo3C7AOWQzKM9qqyzx2hf/_buildManifest.js" defer=""></script><script src="/_next/static/Zo3C7AOWQzKM9qqyzx2hf/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h4 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h4></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/are-global-variables-thread-safe-in-flask-how-do-i-share-data-between-requests-1657387949951#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/are-global-variables-thread-safe-in-flask-how-do-i-share-data-between-requests-1657387949951"><h1>Are global variables thread-safe in Flask? How do I share data between requests?</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/thread-safety">thread-safety</a></div></div><div class="question-content mt-5">
                
<p>In my application, the state of a common object is changed by making requests, and the response depends on the state.</p>
<pre class="lang-py s-code-block"><code class="hljs language-python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeObj</span>():
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, param</span>):
        self.param = param
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">self</span>):
        self.param += <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> self.param

global_obj = SomeObj(<span class="hljs-number">0</span>)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">home</span>():
    flash(global_obj.query())
    render_template(<span class="hljs-string">'index.html'</span>)
</code></pre>
<p>If I run this on my development server, I expect to get 1, 2, 3 and so on.  If requests are made from 100 different clients simultaneously, can something go wrong? The expected result would be that the 100 different clients each see a unique number from 1 to 100. Or will something like this happen:</p>
<ol>
<li>Client 1 queries. <code>self.param</code> is incremented by 1.</li>
<li>Before the return statement can be executed, the thread switches over to client 2. <code>self.param</code> is incremented again.</li>
<li>The thread switches back to client 1, and the client is returned the number 2, say.</li>
<li>Now the thread moves to client 2 and returns him/her the number 3.</li>
</ol>
<p>Since there were only two clients, the expected results were 1 and 2, not 2 and 3. A number was skipped.</p>
<p>Will this actually happen as I scale up my application? What alternatives to a global variable should I look at?</p>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li><li class="pagination-solution-item"><span data-id="#solution3" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">3</span></li><li class="pagination-solution-item"><span data-id="#solution4" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">4</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/thread-safety">thread-safety</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You can't use global variables to hold this sort of data. Not only is it not thread safe, it's not <em>process</em> safe, and WSGI servers in production spawn multiple processes. Not only would your counts be wrong if you were using threads to handle requests, they would also vary depending on which process handled the request.</p>

<p>Use a data source outside of Flask to hold global data. A database, memcached, or redis are all appropriate separate storage areas, depending on your needs. If you need to load and access Python data, consider <a href="https://stackoverflow.com/a/28426819"><code>multiprocessing.Manager</code></a>. You could also use the session for simple data that is per-user.</p>

<hr>

<p>The development server may run in single thread and process. You won't see the behavior you describe since each request will be handled synchronously. Enable threads or processes and you will see it. <code>app.run(threaded=True)</code> or <code>app.run(processes=10)</code>. (In 1.0 the server is threaded by default.)</p>

<hr>

<p>Some WSGI servers may support gevent or another async worker. Global variables are still not thread safe because there's still no protection against most race conditions. You can still have a scenario where one worker gets a value, yields, another modifies it, yields, then the first worker also modifies it.</p>

<hr>

<p>If you need to store some global data <em>during</em> a request, you may use Flask's <a href="http://flask.pocoo.org/docs/1.0/api/#flask.g" rel="noreferrer"><code>g</code> object</a>. Another common case is some top-level object that manages database connections. The distinction for this type of "global" is that it's unique to each request, not used <em>between</em> requests, and there's something managing the set up and teardown of the resource.</p>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/thread-safety">thread-safety</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>This is not really an answer to thread safety of globals.</p>

<p>But I think it is important to mention sessions here.
You are looking for a way to store client-specific data. Every connection should have access to its own pool of data, in a threadsafe way.</p>

<p>This is possible with server-side sessions, and they are available in a very neat flask plugin: <a href="https://pythonhosted.org/Flask-Session/" rel="noreferrer">https://pythonhosted.org/Flask-Session/</a></p>

<p>If you set up sessions, a <code>session</code> variable is available in all your routes and it behaves like a dictionary. The data stored in this dictionary is individual for each connecting client.</p>

<p>Here is a short demo:</p>

<pre class="lang-py s-code-block"><code class="hljs language-python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, session
<span class="hljs-keyword">from</span> flask_session <span class="hljs-keyword">import</span> Session

app = Flask(__name__)
<span class="hljs-comment"># Check Configuration section for more details</span>
SESSION_TYPE = <span class="hljs-string">'filesystem'</span>
app.config.from_object(__name__)
Session(app)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">reset</span>():
    session[<span class="hljs-string">"counter"</span>]=<span class="hljs-number">0</span>

    <span class="hljs-keyword">return</span> <span class="hljs-string">"counter was reset"</span>

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/inc'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">routeA</span>():
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-string">"counter"</span> <span class="hljs-keyword">in</span> session:
        session[<span class="hljs-string">"counter"</span>]=<span class="hljs-number">0</span>

    session[<span class="hljs-string">"counter"</span>]+=<span class="hljs-number">1</span>

    <span class="hljs-keyword">return</span> <span class="hljs-string">"counter is {}"</span>.<span class="hljs-built_in">format</span>(session[<span class="hljs-string">"counter"</span>])

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/dec'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">routeB</span>():
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-string">"counter"</span> <span class="hljs-keyword">in</span> session:
        session[<span class="hljs-string">"counter"</span>] = <span class="hljs-number">0</span>

    session[<span class="hljs-string">"counter"</span>] -= <span class="hljs-number">1</span>

    <span class="hljs-keyword">return</span> <span class="hljs-string">"counter is {}"</span>.<span class="hljs-built_in">format</span>(session[<span class="hljs-string">"counter"</span>])


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run()
</code></pre>

<p>After <code>pip install Flask-Session</code>, you should be able to run this. Try accessing it from different browsers, you'll see that the counter is not shared between them.</p>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/thread-safety">thread-safety</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Another example of a data source external to requests is a cache, such as what's provided by <a href="https://flask-caching.readthedocs.io/en/latest/index.html" rel="noreferrer">Flask-Caching</a> or another extension.</p>
<ol>
<li>Create a file <code>common.py</code> and place in it the following:</li>
</ol>
<pre class="lang-py s-code-block"><code class="hljs language-python"><span class="hljs-keyword">from</span> flask_caching <span class="hljs-keyword">import</span> Cache

<span class="hljs-comment"># Instantiate the cache</span>
cache = Cache()
</code></pre>
<ol start="2">
<li>In the file where your <code>flask app</code> is created, register your cache with the following code:</li>
</ol>
<pre class="lang-py s-code-block"><code class="hljs language-python"><span class="hljs-comment"># Import cache</span>
<span class="hljs-keyword">from</span> common <span class="hljs-keyword">import</span> cache

<span class="hljs-comment"># ...</span>
app = Flask(__name__)

cache.init_app(app=app, config={<span class="hljs-string">"CACHE_TYPE"</span>: <span class="hljs-string">"filesystem"</span>,<span class="hljs-string">'CACHE_DIR'</span>: Path(<span class="hljs-string">'/tmp'</span>)})
</code></pre>
<ol start="3">
<li>Now use throughout your application by importing the cache and executing as follows:</li>
</ol>
<pre class="lang-py s-code-block"><code class="hljs language-python"><span class="hljs-comment"># Import cache</span>
<span class="hljs-keyword">from</span> common <span class="hljs-keyword">import</span> cache

<span class="hljs-comment"># store a value</span>
cache.<span class="hljs-built_in">set</span>(<span class="hljs-string">"my_value"</span>, <span class="hljs-number">1_000_000</span>)

<span class="hljs-comment"># Get a value</span>
my_value = cache.get(<span class="hljs-string">"my_value"</span>)
</code></pre>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/thread-safety">thread-safety</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>While totally accepting the previous upvoted answers, and discouraging use of global variables for production and scalable Flask storage, for the purpose of prototyping or really simple servers, running under the flask 'development server'...</p>
<p>...</p>
<p>The Python built-in data types, and I personally used and tested the global <code>dict</code>, <a href="https://docs.python.org/3/glossary.html#term-global-interpreter-lock" rel="nofollow noreferrer">as per Python documentation</a> are <strong>thread</strong> safe. Not <strong>process</strong> safe.</p>
<p>The insertions, lookups, and reads from such a (server global) dict will be OK from each (possibly concurrent) Flask session running under the development server.</p>
<p>When such a global dict is keyed with a unique Flask session key, it can be rather useful for server-side storage of session specific data otherwise not fitting into the cookie (max size 4 kB).</p>
<p>Of course, such a server global dict should be carefully guarded for growing too large, being in-memory. Some sort of expiring the 'old' key/value pairs can be coded during request processing.</p>
<p>Again, it is not recommended for production or scalable deployments, but it is possibly OK for local task-oriented servers where a separate database is too much for the given task.</p>
<p>...</p>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/reference-what-does-this-symbol-mean-in-php-1657384561666">Reference — What does this symbol mean in PHP?</a><a href="/questions/using-auto-layout-in-uitableview-for-dynamic-cell-layouts-and-variable-row-heights-1657387722263">Using Auto Layout in UITableView for dynamic cell layouts &amp; variable row heights</a><a href="/questions/align-inline-block-divs-to-top-of-container-element-1657387489610">Align inline-block DIVs to top of container element</a><a href="/questions/what-is-jsonp-and-why-was-it-created-1657387770563">What is JSONP, and why was it created?</a><a href="/questions/input()-error-nameerror:-name-&#x27;...&#x27;-is-not-defined-1657388497243">input() error - NameError: name &#x27;...&#x27; is not defined</a><a href="/questions/jquery-ajax-file-upload-1657387368970">jQuery Ajax File Upload</a><a href="/questions/how-do-i-import-a-module-given-the-full-path-1657388139965">How do I import a module given the full path?</a><a href="/questions/are-dictionaries-ordered-in-python-3.6+-1657387834234">Are dictionaries ordered in Python 3.6+?</a><a href="/questions/what-is-the-difference-between-char-s-and-char-*s-1657387823570">What is the difference between char s[] and char *s?</a><a href="/questions/how-do-you-use-a-variable-in-a-regular-expression-1657387939007">How do you use a variable in a regular expression?</a><a href="/questions/why-can&#x27;t-i-store-a-value-and-a-reference-to-that-value-in-the-same-struct-1657387506828">Why can&#x27;t I store a value and a reference to that value in the same struct?</a><a href="/questions/event-binding-on-dynamically-created-elements-1657384268057">Event binding on dynamically created elements?</a><a href="/questions/how-should-i-use-servlets-and-ajax-1657385492684">How should I use servlets and Ajax?</a><a href="/questions/why-are-mutable-structs-%22evil%22-1657388508974">Why are mutable structs “evil”?</a><a href="/questions/ways-to-circumvent-the-same-origin-policy-1657384763316">Ways to circumvent the same-origin policy</a><a href="/questions/the-definitive-c++-book-guide-and-list-1657384247395">The Definitive C++ Book Guide and List</a><a href="/questions/why-can&#x27;t-an-element-with-a-z-index-value-cover-its-child-1657387707187">Why can&#x27;t an element with a z-index value cover its child?</a><a href="/questions/how-can-i-return-pivot-table-output-in-mysql-1657384715043">How can I return pivot table output in MySQL?</a><a href="/questions/what&#x27;s-the-simplest-way-to-print-a-java-array-1657384702397">What&#x27;s the simplest way to print a Java array?</a><a href="/questions/php-parsesyntax-errors-and-how-to-solve-them-1657384264713">PHP parse/syntax errors; and how to solve them</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;You can\u0026apos;t use global variables to hold this sort of data. Not only is it not thread safe, it\u0026apos;s not \u0026lt;em\u0026gt;process\u0026lt;/em\u0026gt; safe, and WSGI servers in production spawn multiple processes. Not only would your counts be wrong if you were using threads to handle requests, they would also vary depending on which process handled the request.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Use a data source outside of Flask to hold global data. A database, memcached, or redis are all appropriate separate storage areas, depending on your needs. If you need to load and access Python data, consider \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/28426819\u0026quot;\u0026gt;\u0026lt;code\u0026gt;multiprocessing.Manager\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;. You could also use the session for simple data that is per-user.\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;The development server may run in single thread and process. You won\u0026apos;t see the behavior you describe since each request will be handled synchronously. Enable threads or processes and you will see it. \u0026lt;code\u0026gt;app.run(threaded=True)\u0026lt;/code\u0026gt; or \u0026lt;code\u0026gt;app.run(processes=10)\u0026lt;/code\u0026gt;. (In 1.0 the server is threaded by default.)\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;Some WSGI servers may support gevent or another async worker. Global variables are still not thread safe because there\u0026apos;s still no protection against most race conditions. You can still have a scenario where one worker gets a value, yields, another modifies it, yields, then the first worker also modifies it.\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;If you need to store some global data \u0026lt;em\u0026gt;during\u0026lt;/em\u0026gt; a request, you may use Flask\u0026apos;s \u0026lt;a href=\u0026quot;http://flask.pocoo.org/docs/1.0/api/#flask.g\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;g\u0026lt;/code\u0026gt; object\u0026lt;/a\u0026gt;. Another common case is some top-level object that manages database connections. The distinction for this type of \u0026quot;global\u0026quot; is that it\u0026apos;s unique to each request, not used \u0026lt;em\u0026gt;between\u0026lt;/em\u0026gt; requests, and there\u0026apos;s something managing the set up and teardown of the resource.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;This is not really an answer to thread safety of globals.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;But I think it is important to mention sessions here.\nYou are looking for a way to store client-specific data. Every connection should have access to its own pool of data, in a threadsafe way.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This is possible with server-side sessions, and they are available in a very neat flask plugin: \u0026lt;a href=\u0026quot;https://pythonhosted.org/Flask-Session/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;https://pythonhosted.org/Flask-Session/\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;If you set up sessions, a \u0026lt;code\u0026gt;session\u0026lt;/code\u0026gt; variable is available in all your routes and it behaves like a dictionary. The data stored in this dictionary is individual for each connecting client.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Here is a short demo:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-py s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-python\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; flask \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; Flask, session\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; flask_session \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; Session\n\napp = Flask(__name__)\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;# Check Configuration section for more details\u0026lt;/span\u0026gt;\nSESSION_TYPE = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;filesystem\u0026apos;\u0026lt;/span\u0026gt;\napp.config.from_object(__name__)\nSession(app)\n\n\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;@app.route(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;def\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reset\u0026lt;/span\u0026gt;():\n    session[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;counter\u0026quot;\u0026lt;/span\u0026gt;]=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;counter was reset\u0026quot;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;@app.route(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/inc\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;def\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;routeA\u0026lt;/span\u0026gt;():\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;not\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;counter\u0026quot;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; session:\n        session[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;counter\u0026quot;\u0026lt;/span\u0026gt;]=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n\n    session[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;counter\u0026quot;\u0026lt;/span\u0026gt;]+=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;counter is {}\u0026quot;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;format\u0026lt;/span\u0026gt;(session[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;counter\u0026quot;\u0026lt;/span\u0026gt;])\n\n\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;@app.route(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/dec\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;def\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;routeB\u0026lt;/span\u0026gt;():\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;not\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;counter\u0026quot;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; session:\n        session[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;counter\u0026quot;\u0026lt;/span\u0026gt;] = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n\n    session[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;counter\u0026quot;\u0026lt;/span\u0026gt;] -= \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;counter is {}\u0026quot;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;format\u0026lt;/span\u0026gt;(session[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;counter\u0026quot;\u0026lt;/span\u0026gt;])\n\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; __name__ == \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;__main__\u0026apos;\u0026lt;/span\u0026gt;:\n    app.run()\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;After \u0026lt;code\u0026gt;pip install Flask-Session\u0026lt;/code\u0026gt;, you should be able to run this. Try accessing it from different browsers, you\u0026apos;ll see that the counter is not shared between them.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Another example of a data source external to requests is a cache, such as what\u0026apos;s provided by \u0026lt;a href=\u0026quot;https://flask-caching.readthedocs.io/en/latest/index.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Flask-Caching\u0026lt;/a\u0026gt; or another extension.\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;Create a file \u0026lt;code\u0026gt;common.py\u0026lt;/code\u0026gt; and place in it the following:\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-py s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-python\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; flask_caching \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; Cache\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;# Instantiate the cache\u0026lt;/span\u0026gt;\ncache = Cache()\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;ol start=\u0026quot;2\u0026quot;\u0026gt;\n\u0026lt;li\u0026gt;In the file where your \u0026lt;code\u0026gt;flask app\u0026lt;/code\u0026gt; is created, register your cache with the following code:\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-py s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-python\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;# Import cache\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; common \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; cache\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;# ...\u0026lt;/span\u0026gt;\napp = Flask(__name__)\n\ncache.init_app(app=app, config={\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;CACHE_TYPE\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;filesystem\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;CACHE_DIR\u0026apos;\u0026lt;/span\u0026gt;: Path(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/tmp\u0026apos;\u0026lt;/span\u0026gt;)})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;ol start=\u0026quot;3\u0026quot;\u0026gt;\n\u0026lt;li\u0026gt;Now use throughout your application by importing the cache and executing as follows:\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-py s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-python\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;# Import cache\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; common \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; cache\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;# store a value\u0026lt;/span\u0026gt;\ncache.\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;set\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;my_value\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1_000_000\u0026lt;/span\u0026gt;)\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;# Get a value\u0026lt;/span\u0026gt;\nmy_value = cache.get(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;my_value\u0026quot;\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;While totally accepting the previous upvoted answers, and discouraging use of global variables for production and scalable Flask storage, for the purpose of prototyping or really simple servers, running under the flask \u0026apos;development server\u0026apos;...\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;...\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The Python built-in data types, and I personally used and tested the global \u0026lt;code\u0026gt;dict\u0026lt;/code\u0026gt;, \u0026lt;a href=\u0026quot;https://docs.python.org/3/glossary.html#term-global-interpreter-lock\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;as per Python documentation\u0026lt;/a\u0026gt; are \u0026lt;strong\u0026gt;thread\u0026lt;/strong\u0026gt; safe. Not \u0026lt;strong\u0026gt;process\u0026lt;/strong\u0026gt; safe.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The insertions, lookups, and reads from such a (server global) dict will be OK from each (possibly concurrent) Flask session running under the development server.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;When such a global dict is keyed with a unique Flask session key, it can be rather useful for server-side storage of session specific data otherwise not fitting into the cookie (max size 4 kB).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Of course, such a server global dict should be carefully guarded for growing too large, being in-memory. Some sort of expiring the \u0026apos;old\u0026apos; key/value pairs can be coded during request processing.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Again, it is not recommended for production or scalable deployments, but it is possibly OK for local task-oriented servers where a separate database is too much for the given task.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;...\u0026lt;/p\u0026gt;\n    "],"id":427,"title":"Are global variables thread-safe in Flask? How do I share data between requests?","content":"\n                \n\u0026lt;p\u0026gt;In my application, the state of a common object is changed by making requests, and the response depends on the state.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-py s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-python\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;SomeObj\u0026lt;/span\u0026gt;():\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;def\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;__init__\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;self, param\u0026lt;/span\u0026gt;):\n        self.param = param\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;def\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;query\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;self\u0026lt;/span\u0026gt;):\n        self.param += \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; self.param\n\nglobal_obj = SomeObj(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)\n\n\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;@app.route(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;def\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;home\u0026lt;/span\u0026gt;():\n    flash(global_obj.query())\n    render_template(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;index.html\u0026apos;\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;If I run this on my development server, I expect to get 1, 2, 3 and so on.  If requests are made from 100 different clients simultaneously, can something go wrong? The expected result would be that the 100 different clients each see a unique number from 1 to 100. Or will something like this happen:\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;Client 1 queries. \u0026lt;code\u0026gt;self.param\u0026lt;/code\u0026gt; is incremented by 1.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Before the return statement can be executed, the thread switches over to client 2. \u0026lt;code\u0026gt;self.param\u0026lt;/code\u0026gt; is incremented again.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;The thread switches back to client 1, and the client is returned the number 2, say.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Now the thread moves to client 2 and returns him/her the number 3.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;Since there were only two clients, the expected results were 1 and 2, not 2 and 3. A number was skipped.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Will this actually happen as I scale up my application? What alternatives to a global variable should I look at?\u0026lt;/p\u0026gt;\n    ","slug":"are-global-variables-thread-safe-in-flask-how-do-i-share-data-between-requests-1657387949951","postType":"QUESTION","createdAt":"2022-07-09T17:32:29.000Z","updatedAt":"2022-07-09T17:32:29.000Z","tags":[{"id":2246,"name":"thread-safety","slug":"thread-safety","createdAt":"2022-07-09T17:32:30.000Z","updatedAt":"2022-07-09T17:32:30.000Z","Questions_Tags":{"questionId":427,"tagId":2246}}],"relatedQuestions":[{"title":"Are global variables thread-safe in Flask? How do I share data between requests?","slug":"are-global-variables-thread-safe-in-flask-how-do-i-share-data-between-requests-1657387949951","tags":[{"name":"thread-safety","Questions_Tags":{"questionId":427,"tagId":2246}}]}]},"randomQuestions":[{"title":"Reference — What does this symbol mean in PHP?","slug":"reference-what-does-this-symbol-mean-in-php-1657384561666"},{"title":"Using Auto Layout in UITableView for dynamic cell layouts \u0026 variable row heights","slug":"using-auto-layout-in-uitableview-for-dynamic-cell-layouts-and-variable-row-heights-1657387722263"},{"title":"Align inline-block DIVs to top of container element","slug":"align-inline-block-divs-to-top-of-container-element-1657387489610"},{"title":"What is JSONP, and why was it created?","slug":"what-is-jsonp-and-why-was-it-created-1657387770563"},{"title":"input() error - NameError: name '...' is not defined","slug":"input()-error-nameerror:-name-'...'-is-not-defined-1657388497243"},{"title":"jQuery Ajax File Upload","slug":"jquery-ajax-file-upload-1657387368970"},{"title":"How do I import a module given the full path?","slug":"how-do-i-import-a-module-given-the-full-path-1657388139965"},{"title":"Are dictionaries ordered in Python 3.6+?","slug":"are-dictionaries-ordered-in-python-3.6+-1657387834234"},{"title":"What is the difference between char s[] and char *s?","slug":"what-is-the-difference-between-char-s-and-char-*s-1657387823570"},{"title":"How do you use a variable in a regular expression?","slug":"how-do-you-use-a-variable-in-a-regular-expression-1657387939007"},{"title":"Why can't I store a value and a reference to that value in the same struct?","slug":"why-can't-i-store-a-value-and-a-reference-to-that-value-in-the-same-struct-1657387506828"},{"title":"Event binding on dynamically created elements?","slug":"event-binding-on-dynamically-created-elements-1657384268057"},{"title":"How should I use servlets and Ajax?","slug":"how-should-i-use-servlets-and-ajax-1657385492684"},{"title":"Why are mutable structs “evil”?","slug":"why-are-mutable-structs-\"evil\"-1657388508974"},{"title":"Ways to circumvent the same-origin policy","slug":"ways-to-circumvent-the-same-origin-policy-1657384763316"},{"title":"The Definitive C++ Book Guide and List","slug":"the-definitive-c++-book-guide-and-list-1657384247395"},{"title":"Why can't an element with a z-index value cover its child?","slug":"why-can't-an-element-with-a-z-index-value-cover-its-child-1657387707187"},{"title":"How can I return pivot table output in MySQL?","slug":"how-can-i-return-pivot-table-output-in-mysql-1657384715043"},{"title":"What's the simplest way to print a Java array?","slug":"what's-the-simplest-way-to-print-a-java-array-1657384702397"},{"title":"PHP parse/syntax errors; and how to solve them","slug":"php-parsesyntax-errors-and-how-to-solve-them-1657384264713"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"are-global-variables-thread-safe-in-flask-how-do-i-share-data-between-requests-1657387949951"},"buildId":"Zo3C7AOWQzKM9qqyzx2hf","isFallback":false,"gsp":true,"locale":"en","locales":["en"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>