<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find solution for coding, HTML, CSS, JAVASCRIPT, MYSQL, PHP, PYTHON,... quickly. - solutionschecker.com"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><title>Trouble with UTF-8 characters; what I see is not what I stored | Solutions Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="I tried to use UTF-8 and ran into trouble.

I have tried so many things; here are the results I have gotten:


???? instead of Asian characters. Even for European text, I got Se?or for Señor.
Strange gibberish (Mojibake?) such as SeÃ±or or æ–°æµªæ–°é—» for 新浪新闻.
Black diamonds, such as Se�or.
Finally, I got into a situation where the data was lost, or at least truncated: Se for Señor.
Even when I got text to look right, it did not sort correctly.


What am I doing wrong? How can I fix the code? Can I recover the data, if so, how?
    "/><meta property="og:title" content="Trouble with UTF-8 characters; what I see is not what I stored | Solutions Checker"/><meta property="og:description" content="I tried to use UTF-8 and ran into trouble.

I have tried so many things; here are the results I have gotten:


???? instead of Asian characters. Even for European text, I got Se?or for Señor.
Strange gibberish (Mojibake?) such as SeÃ±or or æ–°æµªæ–°é—» for 新浪新闻.
Black diamonds, such as Se�or.
Finally, I got into a situation where the data was lost, or at least truncated: Se for Señor.
Even when I got text to look right, it did not sort correctly.


What am I doing wrong? How can I fix the code? Can I recover the data, if so, how?
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"Trouble with UTF-8 characters; what I see is not what I stored","text":"I tried to use UTF-8 and ran into trouble.\n\nI have tried so many things; here are the results I have gotten:\n\n\n???? instead of Asian characters. Even for European text, I got Se?or for Señor.\nStrange gibberish (Mojibake?) such as SeÃ±or or æ–°æµªæ–°é—» for 新浪新闻.\nBlack diamonds, such as Se�or.\nFinally, I got into a situation where the data was lost, or at least truncated: Se for Señor.\nEven when I got text to look right, it did not sort correctly.\n\n\nWhat am I doing wrong? How can I fix the code? Can I recover the data, if so, how?\n    ","answerCount":5,"upVoteCount":500,"suggestedAnswer":[{"text":"This problem plagues the participants of this site, and many others.\n\nYou have listed the five main cases of CHARACTER SET troubles.\n\nBest Practice\n\nGoing forward, it is best to use CHARACTER SET utf8mb4 and COLLATION utf8mb4_unicode_520_ci. (There is a newer version of the Unicode collation in the pipeline.)\n\nutf8mb4 is a superset of utf8 in that it handles 4-byte utf8 codes, which are needed by Emoji and some of Chinese.\n\nOutside of MySQL, &quot;UTF-8&quot; refers to all size encodings, hence effectively the same as MySQL&apos;s utf8mb4, not utf8.\n\nI will try to use those spellings and capitalizations to distinguish inside versus outside MySQL in the following.\n\nOverview of what you should do\n\n\nHave your editor, etc. set to UTF-8.\nHTML forms should start like &lt;form accept-charset=&quot;UTF-8&quot;&gt;.\nHave your bytes encoded as UTF-8.\nEstablish UTF-8 as the encoding being used in the client.\nHave the column/table declared CHARACTER SET utf8mb4 (Check with SHOW CREATE TABLE.)\n&lt;meta charset=UTF-8&gt; at the beginning of HTML\nStored Routines acquire the current charset/collation.  They may need rebuilding.\n\n\nUTF-8 all the way through\n\nMore details for computer languages (and its following sections)\n\nTest the data\n\nViewing the data with a tool or with SELECT cannot be trusted.\nToo many such clients, especially browsers, try to compensate for incorrect encodings, and show you correct text even if the database is mangled.\nSo, pick a table and column that has some non-English text and do\n\nSELECT col, HEX(col) FROM tbl WHERE ...\n\n\nThe HEX for correctly stored UTF-8 will be\n\n\nFor a blank space (in any language):  20\nFor English:  4x, 5x, 6x, or 7x\nFor most of Western Europe, accented letters should be Cxyy\nCyrillic, Hebrew, and Farsi/Arabic:  Dxyy\nMost of Asia:  Exyyzz\nEmoji and some of Chinese:  F0yyzzww\nMore details\n\n\nSpecific causes and fixes of the problems seen\n\nTruncated text (Se for Señor):\n\n\nThe bytes to be stored are not encoded as utf8mb4. Fix this.\nAlso, check that the connection during reading is UTF-8.\n\n\nBlack Diamonds with question marks (Seor for Señor);\none of these cases exists:\n\nCase 1 (original bytes were not UTF-8):\n\n\nThe bytes to be stored are not encoded as utf8. Fix this.\nThe connection (or SET NAMES) for the INSERT and the SELECT was not utf8/utf8mb4.  Fix this.\nAlso, check that the column in the database is CHARACTER SET utf8 (or utf8mb4).\n\n\nCase 2 (original bytes were UTF-8):\n\n\nThe connection (or SET NAMES) for the SELECT was not utf8/utf8mb4.  Fix this.\nAlso, check that the column in the database is CHARACTER SET utf8 (or utf8mb4).\n\n\nBlack diamonds occur only when the browser is set to &lt;meta charset=UTF-8&gt;.\n\nQuestion Marks (regular ones, not black diamonds) (Se?or for Señor):\n\n\nThe bytes to be stored are not encoded as utf8/utf8mb4.  Fix this.\nThe column in the database is not CHARACTER SET utf8 (or utf8mb4).  Fix this.  (Use SHOW CREATE TABLE.)\nAlso, check that the connection during reading is UTF-8.\n\n\nMojibake (SeÃ±or for Señor):\n(This discussion also applies to Double Encoding, which is not necessarily visible.)\n\n\nThe bytes to be stored need to be UTF-8-encoded.  Fix this.\nThe connection when INSERTing and SELECTing text needs to specify utf8 or utf8mb4.  Fix this.\nThe column needs to be declared CHARACTER SET utf8 (or utf8mb4).  Fix this.\nHTML should start with &lt;meta charset=UTF-8&gt;.\n\n\nIf the data looks correct, but won&apos;t sort correctly, then\neither you have picked the wrong collation,\nor there is no collation that suits your need,\nor you have Double Encoding.\n\nDouble Encoding can be confirmed by doing the SELECT .. HEX .. described above.\n\né should come back C3A9, but instead shows C383C2A9\nThe Emoji  should come back F09F91BD, but comes back C3B0C5B8E28098C2BD\n\n\nThat is, the hex is about twice as long as it should be.\nThis is caused by converting from latin1 (or whatever) to utf8, then treating those\nbytes as if they were latin1 and repeating the conversion.\nThe sorting (and comparing) does not work correctly because it is, for example,\nsorting as if the string were SeÃ±or.\n\nFixing the Data, where possible\n\nFor Truncation and Question Marks, the data is lost.\n\nFor Mojibake / Double Encoding, ...\n\nFor Black Diamonds, ...\n\nThe Fixes are listed here.  (5 different fixes for 5 different situations; pick carefully):  http://mysql.rjweb.org/doc.php/charcoll#fixes_for_various_cases\n    ","url":"/questions/[slug]#solution1","@type":"Answer","upvoteCount":0},{"text":"I had similar issues with two of my projects, after a server migration. After searching and trying a lot of solutions, I came across with this one:\nmysqli_set_charset($con,&quot;utf8&quot;);\n\nAfter adding this line to my configuration file, everything works fine!\nI found this solution for MySQLiPHP mysqli set_charset() Functionwhen I was looking to solve an insert from an HTML query.\n    ","url":"/questions/[slug]#solution2","@type":"Answer","upvoteCount":0},{"text":"I was also searching for the same issue. It took me nearly one month to find the appropriate solution.\nFirst of all, you will have to update you database will all the recent CHARACTER and COLLATION to utf8mb4 or at least which support UTF-8 data.\nFor Java:\nwhile making a JDBC connection, add this to the connection URL useUnicode=yes&amp;characterEncoding=UTF-8 as parameters and it will work.\nFor Python:\nBefore querying into the database, try enforcing this over the cursor\n*\ncursor.execute(&apos;SET NAMES utf8mb4&apos;)\ncursor.execute(&quot;SET CHARACTER SET utf8mb4&quot;)\ncursor.execute(&quot;SET character_set_connection=utf8mb4&quot;)\n*\nIf it does not work, happy hunting for the right solution.\n    ","url":"/questions/[slug]#solution3","@type":"Answer","upvoteCount":0},{"text":"\nSet your code IDE language to UTF-8\n\nAdd &lt;meta charset=&quot;utf-8&quot;&gt; to your webpage header where you collect data form.\n\nCheck your MySQL table definition looks like this:\n CREATE TABLE your_table (\n   ...\n ) ENGINE=InnoDB DEFAULT CHARSET=utf8\n\n\nIf you are using PDO, make sure\n$options = array(PDO::MYSQL_ATTR_INIT_COMMAND=&gt;&apos;SET NAMES utf8&apos;);\n$dbL = new PDO($pdo, $user, $pass, $options);\n\n\n\nIf you already got a large database with above problem, you can try SIDU to export with correct charset, and import back with UTF-8.\n    ","url":"/questions/[slug]#solution4","@type":"Answer","upvoteCount":0},{"text":"Depending on how the server is setup, you have to change the encode accordingly. utf8 from what you said should work the best. However, if you&apos;re getting weird characters, it might help if you change the webpage encoding to ANSI.\nThis helped me when I was setting up a PHP MySQLi. This might help you understand more: ANSI to UTF-8 in Notepad++\n    ","url":"/questions/[slug]#solution5","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/08bcc42a26fe5c92.css" as="style"/><link rel="stylesheet" href="/_next/static/css/08bcc42a26fe5c92.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-ccfab947c79712f4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-08d1a634dea6705e.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/150-b06815e21c943e0d.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/108-87de33c23337ff53.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-79a1437acf654019.js" defer=""></script><script src="/_next/static/Zo3C7AOWQzKM9qqyzx2hf/_buildManifest.js" defer=""></script><script src="/_next/static/Zo3C7AOWQzKM9qqyzx2hf/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h4 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h4></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/trouble-with-utf-8-characters-what-i-see-is-not-what-i-stored-1657384817490#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/trouble-with-utf-8-characters-what-i-see-is-not-what-i-stored-1657384817490"><h1>Trouble with UTF-8 characters; what I see is not what I stored</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/unicode">unicode</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/character-encoding">character-encoding</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/mariadb">mariadb</a></div></div><div class="question-content mt-5">
                
<p>I tried to use UTF-8 and ran into trouble.</p>

<p>I have tried so many things; here are the results I have gotten:</p>

<ul>
<li><code>????</code> instead of Asian characters. Even for European text, I got <code>Se?or</code> for <code>Señor</code>.</li>
<li>Strange gibberish (Mojibake?) such as <code>SeÃ±or</code> or <code>æ–°æµªæ–°é—»</code> for <code>新浪新闻</code>.</li>
<li>Black diamonds, such as Se�or.</li>
<li>Finally, I got into a situation where the data was lost, or at least truncated: <code>Se</code> for <code>Señor</code>.</li>
<li>Even when I got text to <em>look</em> right, it did not <em>sort</em> correctly.</li>
</ul>

<p>What am I doing wrong? How can I fix the <em>code</em>? Can I recover the <em>data</em>, if so, how?</p>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li><li class="pagination-solution-item"><span data-id="#solution3" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">3</span></li><li class="pagination-solution-item"><span data-id="#solution4" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">4</span></li><li class="pagination-solution-item"><span data-id="#solution5" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">5</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/unicode">unicode</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/character-encoding">character-encoding</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mariadb">mariadb</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>This problem plagues the participants of this site, and many others.</p>

<p>You have listed the five main cases of <code>CHARACTER SET</code> troubles.</p>

<p><strong>Best Practice</strong></p>

<p>Going forward, it is best to use <code>CHARACTER SET utf8mb4</code> and <code>COLLATION utf8mb4_unicode_520_ci</code>. (There is a newer version of the Unicode collation in the pipeline.)</p>

<p><code>utf8mb4</code> is a superset of <code>utf8</code> in that it handles 4-byte utf8 codes, which are needed by Emoji and some of Chinese.</p>

<p>Outside of MySQL, "UTF-8" refers to all size encodings, hence effectively the same as MySQL's <code>utf8mb4</code>, not <code>utf8</code>.</p>

<p>I will try to use those spellings and capitalizations to distinguish inside versus outside MySQL in the following.</p>

<p><strong>Overview of what you <em>should</em> do</strong></p>

<ul>
<li>Have your editor, etc. set to UTF-8.</li>
<li>HTML forms should start like <code>&lt;form accept-charset="UTF-8"&gt;</code>.</li>
<li>Have your bytes encoded as UTF-8.</li>
<li>Establish UTF-8 as the encoding being used in the client.</li>
<li>Have the column/table declared <code>CHARACTER SET utf8mb4</code> (Check with <code>SHOW CREATE TABLE</code>.)</li>
<li><code>&lt;meta charset=UTF-8&gt;</code> at the beginning of HTML</li>
<li>Stored Routines acquire the current charset/collation.  They may need rebuilding.</li>
</ul>

<p><em><a href="https://stackoverflow.com/questions/279170/how-to-support-utf-8-completely-in-a-web-application">UTF-8 all the way through</a></em></p>

<p><a href="http://mysql.rjweb.org/doc.php/charcoll#python" rel="noreferrer">More details for computer languages</a> (and its following sections)</p>

<p><strong>Test the data</strong></p>

<p>Viewing the data with a tool or with <code>SELECT</code> cannot be trusted.
Too many such clients, especially browsers, try to compensate for incorrect encodings, and show you correct text even if the database is mangled.
So, pick a table and column that has some non-English text and do</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> col, HEX(col) <span class="hljs-keyword">FROM</span> tbl <span class="hljs-keyword">WHERE</span> ...
</code></pre>

<p>The HEX for correctly stored UTF-8 will be</p>

<ul>
<li>For a blank space (in any language):  <code>20</code></li>
<li>For English:  <code>4x</code>, <code>5x</code>, <code>6x</code>, or <code>7x</code></li>
<li>For most of Western Europe, accented letters should be <code>Cxyy</code></li>
<li>Cyrillic, Hebrew, and Farsi/Arabic:  <code>Dxyy</code></li>
<li>Most of Asia:  <code>Exyyzz</code></li>
<li>Emoji and some of Chinese:  <code>F0yyzzww</code></li>
<li><a href="http://mysql.rjweb.org/doc.php/charcoll#diagnosing_charset_issues" rel="noreferrer">More details</a></li>
</ul>

<p><strong>Specific causes and fixes of the problems seen</strong></p>

<p><strong>Truncated</strong> text (<code>Se</code> for <code>Señor</code>):</p>

<ul>
<li>The bytes to be stored are not encoded as utf8mb4. Fix this.</li>
<li>Also, check that the connection during reading is UTF-8.</li>
</ul>

<p><strong>Black Diamonds</strong> with question marks (<code>Seor</code> for <code>Señor</code>);
one of these cases exists:</p>

<p>Case 1 (original bytes were <em>not</em> UTF-8):</p>

<ul>
<li>The bytes to be stored are not encoded as utf8. Fix this.</li>
<li>The connection (or <code>SET NAMES</code>) for the <code>INSERT</code> <em>and</em> the <code>SELECT</code> was not utf8/utf8mb4.  Fix this.</li>
<li>Also, check that the column in the database is <code>CHARACTER SET utf8</code> (or utf8mb4).</li>
</ul>

<p>Case 2 (original bytes <em>were</em> UTF-8):</p>

<ul>
<li>The connection (or <code>SET NAMES</code>) for the <code>SELECT</code> was not utf8/utf8mb4.  Fix this.</li>
<li>Also, check that the column in the database is <code>CHARACTER SET utf8</code> (or utf8mb4).</li>
</ul>

<p>Black diamonds occur only when the browser is set to <code>&lt;meta charset=UTF-8&gt;</code>.</p>

<p><strong>Question Marks</strong> (regular ones, not black diamonds) (<code>Se?or</code> for <code>Señor</code>):</p>

<ul>
<li>The bytes to be stored are not encoded as utf8/utf8mb4.  Fix this.</li>
<li>The column in the database is not <code>CHARACTER SET utf8</code> (or utf8mb4).  Fix this.  (Use <code>SHOW CREATE TABLE</code>.)</li>
<li>Also, check that the connection during reading is UTF-8.</li>
</ul>

<p><strong>Mojibake</strong> (<code>SeÃ±or</code> for <code>Señor</code>):
(This discussion also applies to <strong>Double Encoding</strong>, which is not necessarily visible.)</p>

<ul>
<li>The bytes to be stored need to be UTF-8-encoded.  Fix this.</li>
<li>The connection when <code>INSERTing</code> and <code>SELECTing</code> text needs to specify utf8 or utf8mb4.  Fix this.</li>
<li>The column needs to be declared <code>CHARACTER SET utf8</code> (or utf8mb4).  Fix this.</li>
<li>HTML should start with <code>&lt;meta charset=UTF-8&gt;</code>.</li>
</ul>

<p>If the data looks correct, but won't sort correctly, then
either you have picked the wrong collation,
or there is no collation that suits your need,
or you have <strong>Double Encoding</strong>.</p>

<p><strong>Double Encoding</strong> can be confirmed by doing the <code>SELECT .. HEX ..</code> described above.</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">é should come back C3A9, but instead shows C383C2A9
The Emoji  should come back F09F91BD, but comes back C3B0C5B8E28098C2BD
</code></pre>

<p>That is, the hex is about twice as long as it should be.
This is caused by converting from latin1 (or whatever) to utf8, then treating those
bytes as if they were latin1 and repeating the conversion.
The sorting (and comparing) does not work correctly because it is, for example,
sorting as if the string were <code>SeÃ±or</code>.</p>

<p><strong>Fixing the Data, where possible</strong></p>

<p>For <strong>Truncation</strong> and <strong>Question Marks</strong>, the data is lost.</p>

<p>For <strong>Mojibake</strong> / <strong>Double Encoding</strong>, ...</p>

<p>For <strong>Black Diamonds</strong>, ...</p>

<p>The <strong>Fixes</strong> are listed here.  (5 different fixes for 5 different situations; pick carefully):  <a href="http://mysql.rjweb.org/doc.php/charcoll#fixes_for_various_cases" rel="noreferrer">http://mysql.rjweb.org/doc.php/charcoll#fixes_for_various_cases</a></p>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/unicode">unicode</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/character-encoding">character-encoding</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mariadb">mariadb</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I had similar issues with two of my projects, after a server migration. After searching and trying a lot of solutions, I came across with this one:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql">mysqli_set_charset($con,"utf8");
</code></pre>
<p>After adding this line to my configuration file, everything works fine!</p>
<p>I found this solution for <a href="https://en.wikipedia.org/wiki/MySQLi" rel="nofollow noreferrer">MySQLi</a><em><a href="https://www.w3schools.com/PHP/func_mysqli_set_charset.asp" rel="nofollow noreferrer">PHP mysqli set_charset() Function</a></em>when I was looking to solve an insert from an HTML query.</p>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/unicode">unicode</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/character-encoding">character-encoding</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mariadb">mariadb</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I was also searching for the same issue. It took me nearly one month to find the appropriate solution.</p>
<p>First of all, you will have to update you database will all the recent CHARACTER and COLLATION to utf8mb4 or at least which support UTF-8 data.</p>
<p>For Java:</p>
<p>while making a JDBC connection, add this to the connection URL <em>useUnicode=yes&amp;characterEncoding=UTF-8</em> as parameters and it will work.</p>
<p>For Python:</p>
<p>Before querying into the database, try enforcing this over the cursor</p>
<p>*
<code>cursor.execute('SET NAMES utf8mb4')</code>
<code>cursor.execute("SET CHARACTER SET utf8mb4")</code>
<code>cursor.execute("SET character_set_connection=utf8mb4")</code>
*</p>
<p>If it does not work, happy hunting for the right solution.</p>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/unicode">unicode</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/character-encoding">character-encoding</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mariadb">mariadb</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<ol>
<li><p>Set your code IDE language to UTF-8</p>
</li>
<li><p>Add &lt;meta charset="utf-8"&gt; to your webpage header where you collect data form.</p>
</li>
<li><p>Check your MySQL table definition looks like this:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> your_table (
   ...
 ) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8
</code></pre>
</li>
<li><p>If you are using <a href="https://en.wikipedia.org/wiki/PHP#Development_and_community" rel="nofollow noreferrer">PDO</a>, make sure</p>
<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-variable">$options</span> = <span class="hljs-keyword">array</span>(PDO::<span class="hljs-variable constant_">MYSQL_ATTR_INIT_COMMAND</span>=&gt;<span class="hljs-string">'SET NAMES utf8'</span>);
<span class="hljs-variable">$dbL</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">PDO</span>(<span class="hljs-variable">$pdo</span>, <span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span>, <span class="hljs-variable">$options</span>);
</code></pre>
</li>
</ol>
<p>If you already got a large database with above problem, you can try SIDU to export with correct charset, and import back with UTF-8.</p>
    </div></div></div></div><div id="solution5" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/unicode">unicode</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/character-encoding">character-encoding</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/mariadb">mariadb</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Depending on how the server is setup, you have to change the encode accordingly. utf8 from what you said should work the best. However, if you're getting weird characters, it might help if you change the webpage encoding to ANSI.</p>
<p>This helped me when I was setting up a PHP <a href="https://en.wikipedia.org/wiki/MySQLi" rel="nofollow noreferrer">MySQLi</a>. This might help you understand more: <em><a href="https://superuser.com/questions/762473/ansi-to-utf-8-in-notepad">ANSI to UTF-8 in Notepad++</a></em></p>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/how-to-horizontally-center-an-element-1657384634147">How to horizontally center an element</a><a href="/questions/how-do-servlets-work-instantiation-sessions-shared-variables-and-multithreading-1657387540375">How do servlets work? Instantiation, sessions, shared variables and multithreading</a><a href="/questions/how-do-i-execute-a-program-or-call-a-system-command-1657385465629">How do I execute a program or call a system command?</a><a href="/questions/how-to-serve-static-files-in-flask-1657387862496">How to serve static files in Flask</a><a href="/questions/can-php-pdo-statements-accept-the-table-or-column-name-as-parameter-1657387478588">Can PHP PDO Statements accept the table or column name as parameter?</a><a href="/questions/servlet-returns-%22http-status-404-the-requested-resource-(servlet)-is-not-available%22-1657384850661">Servlet returns &quot;HTTP Status 404 The requested resource (/servlet) is not available&quot;</a><a href="/questions/why-use-getters-and-settersaccessors-1657387343971">Why use getters and setters/accessors?</a><a href="/questions/mysql-pivot-row-into-dynamic-number-of-columns-1657387981930">MySQL pivot row into dynamic number of columns</a><a href="/questions/serialize-and-deserialize-json-and-json-array-in-unity-1657388273270">Serialize and Deserialize Json and Json Array in Unity</a><a href="/questions/how-can-i-validate-an-email-address-using-a-regular-expression-1657384549233">How can I validate an email address using a regular expression?</a><a href="/questions/how-to-store-objects-in-html5-localstorage-1657387568907">How to store objects in HTML5 localStorage</a><a href="/questions/do-dom-tree-elements-with-ids-become-global-properties-1657387475110">Do DOM tree elements with IDs become global properties?</a><a href="/questions/scanner-is-skipping-nextline()-after-using-next()-or-nextfoo()-1657384379697">Scanner is skipping nextLine() after using next() or nextFoo()?</a><a href="/questions/cleansing-user-passwords-1657387365583">Cleansing User Passwords</a><a href="/questions/crash-or-%22segmentation-fault%22-when-data-is-copiedscannedread-to-an-uninitialized-pointer-1657387520581">Crash or &quot;segmentation fault&quot; when data is copied/scanned/read to an uninitialized pointer</a><a href="/questions/why-can-templates-only-be-implemented-in-the-header-file-1657384341933">Why can templates only be implemented in the header file?</a><a href="/questions/the-3-different-equals-1657385490242">The 3 different equals</a><a href="/questions/how-do-function-pointers-in-c-work-1657388332074">How do function pointers in C work?</a><a href="/questions/efficiently-convert-rows-to-columns-in-sql-server-1657387919213">Efficiently convert rows to columns in sql server</a><a href="/questions/how-can-i-sort-arrays-and-data-in-php-1657384726665">How can I sort arrays and data in PHP?</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;This problem plagues the participants of this site, and many others.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You have listed the five main cases of \u0026lt;code\u0026gt;CHARACTER SET\u0026lt;/code\u0026gt; troubles.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Best Practice\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Going forward, it is best to use \u0026lt;code\u0026gt;CHARACTER SET utf8mb4\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;COLLATION utf8mb4_unicode_520_ci\u0026lt;/code\u0026gt;. (There is a newer version of the Unicode collation in the pipeline.)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;utf8mb4\u0026lt;/code\u0026gt; is a superset of \u0026lt;code\u0026gt;utf8\u0026lt;/code\u0026gt; in that it handles 4-byte utf8 codes, which are needed by Emoji and some of Chinese.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Outside of MySQL, \u0026quot;UTF-8\u0026quot; refers to all size encodings, hence effectively the same as MySQL\u0026apos;s \u0026lt;code\u0026gt;utf8mb4\u0026lt;/code\u0026gt;, not \u0026lt;code\u0026gt;utf8\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I will try to use those spellings and capitalizations to distinguish inside versus outside MySQL in the following.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Overview of what you \u0026lt;em\u0026gt;should\u0026lt;/em\u0026gt; do\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Have your editor, etc. set to UTF-8.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;HTML forms should start like \u0026lt;code\u0026gt;\u0026amp;lt;form accept-charset=\u0026quot;UTF-8\u0026quot;\u0026amp;gt;\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Have your bytes encoded as UTF-8.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Establish UTF-8 as the encoding being used in the client.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Have the column/table declared \u0026lt;code\u0026gt;CHARACTER SET utf8mb4\u0026lt;/code\u0026gt; (Check with \u0026lt;code\u0026gt;SHOW CREATE TABLE\u0026lt;/code\u0026gt;.)\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;\u0026amp;lt;meta charset=UTF-8\u0026amp;gt;\u0026lt;/code\u0026gt; at the beginning of HTML\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Stored Routines acquire the current charset/collation.  They may need rebuilding.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/279170/how-to-support-utf-8-completely-in-a-web-application\u0026quot;\u0026gt;UTF-8 all the way through\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://mysql.rjweb.org/doc.php/charcoll#python\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;More details for computer languages\u0026lt;/a\u0026gt; (and its following sections)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Test the data\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Viewing the data with a tool or with \u0026lt;code\u0026gt;SELECT\u0026lt;/code\u0026gt; cannot be trusted.\nToo many such clients, especially browsers, try to compensate for incorrect encodings, and show you correct text even if the database is mangled.\nSo, pick a table and column that has some non-English text and do\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; col, HEX(col) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; tbl \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; ...\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;The HEX for correctly stored UTF-8 will be\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;For a blank space (in any language):  \u0026lt;code\u0026gt;20\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;For English:  \u0026lt;code\u0026gt;4x\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;5x\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;6x\u0026lt;/code\u0026gt;, or \u0026lt;code\u0026gt;7x\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;For most of Western Europe, accented letters should be \u0026lt;code\u0026gt;Cxyy\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Cyrillic, Hebrew, and Farsi/Arabic:  \u0026lt;code\u0026gt;Dxyy\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Most of Asia:  \u0026lt;code\u0026gt;Exyyzz\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Emoji and some of Chinese:  \u0026lt;code\u0026gt;F0yyzzww\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://mysql.rjweb.org/doc.php/charcoll#diagnosing_charset_issues\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;More details\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Specific causes and fixes of the problems seen\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Truncated\u0026lt;/strong\u0026gt; text (\u0026lt;code\u0026gt;Se\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;Señor\u0026lt;/code\u0026gt;):\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The bytes to be stored are not encoded as utf8mb4. Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Also, check that the connection during reading is UTF-8.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Black Diamonds\u0026lt;/strong\u0026gt; with question marks (\u0026lt;code\u0026gt;Seor\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;Señor\u0026lt;/code\u0026gt;);\none of these cases exists:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Case 1 (original bytes were \u0026lt;em\u0026gt;not\u0026lt;/em\u0026gt; UTF-8):\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The bytes to be stored are not encoded as utf8. Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;The connection (or \u0026lt;code\u0026gt;SET NAMES\u0026lt;/code\u0026gt;) for the \u0026lt;code\u0026gt;INSERT\u0026lt;/code\u0026gt; \u0026lt;em\u0026gt;and\u0026lt;/em\u0026gt; the \u0026lt;code\u0026gt;SELECT\u0026lt;/code\u0026gt; was not utf8/utf8mb4.  Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Also, check that the column in the database is \u0026lt;code\u0026gt;CHARACTER SET utf8\u0026lt;/code\u0026gt; (or utf8mb4).\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;Case 2 (original bytes \u0026lt;em\u0026gt;were\u0026lt;/em\u0026gt; UTF-8):\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The connection (or \u0026lt;code\u0026gt;SET NAMES\u0026lt;/code\u0026gt;) for the \u0026lt;code\u0026gt;SELECT\u0026lt;/code\u0026gt; was not utf8/utf8mb4.  Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Also, check that the column in the database is \u0026lt;code\u0026gt;CHARACTER SET utf8\u0026lt;/code\u0026gt; (or utf8mb4).\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;Black diamonds occur only when the browser is set to \u0026lt;code\u0026gt;\u0026amp;lt;meta charset=UTF-8\u0026amp;gt;\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Question Marks\u0026lt;/strong\u0026gt; (regular ones, not black diamonds) (\u0026lt;code\u0026gt;Se?or\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;Señor\u0026lt;/code\u0026gt;):\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The bytes to be stored are not encoded as utf8/utf8mb4.  Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;The column in the database is not \u0026lt;code\u0026gt;CHARACTER SET utf8\u0026lt;/code\u0026gt; (or utf8mb4).  Fix this.  (Use \u0026lt;code\u0026gt;SHOW CREATE TABLE\u0026lt;/code\u0026gt;.)\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Also, check that the connection during reading is UTF-8.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Mojibake\u0026lt;/strong\u0026gt; (\u0026lt;code\u0026gt;SeÃ±or\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;Señor\u0026lt;/code\u0026gt;):\n(This discussion also applies to \u0026lt;strong\u0026gt;Double Encoding\u0026lt;/strong\u0026gt;, which is not necessarily visible.)\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The bytes to be stored need to be UTF-8-encoded.  Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;The connection when \u0026lt;code\u0026gt;INSERTing\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;SELECTing\u0026lt;/code\u0026gt; text needs to specify utf8 or utf8mb4.  Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;The column needs to be declared \u0026lt;code\u0026gt;CHARACTER SET utf8\u0026lt;/code\u0026gt; (or utf8mb4).  Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;HTML should start with \u0026lt;code\u0026gt;\u0026amp;lt;meta charset=UTF-8\u0026amp;gt;\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;If the data looks correct, but won\u0026apos;t sort correctly, then\neither you have picked the wrong collation,\nor there is no collation that suits your need,\nor you have \u0026lt;strong\u0026gt;Double Encoding\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Double Encoding\u0026lt;/strong\u0026gt; can be confirmed by doing the \u0026lt;code\u0026gt;SELECT .. HEX ..\u0026lt;/code\u0026gt; described above.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;é should come back C3A9, but instead shows C383C2A9\nThe Emoji  should come back F09F91BD, but comes back C3B0C5B8E28098C2BD\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;That is, the hex is about twice as long as it should be.\nThis is caused by converting from latin1 (or whatever) to utf8, then treating those\nbytes as if they were latin1 and repeating the conversion.\nThe sorting (and comparing) does not work correctly because it is, for example,\nsorting as if the string were \u0026lt;code\u0026gt;SeÃ±or\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Fixing the Data, where possible\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For \u0026lt;strong\u0026gt;Truncation\u0026lt;/strong\u0026gt; and \u0026lt;strong\u0026gt;Question Marks\u0026lt;/strong\u0026gt;, the data is lost.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For \u0026lt;strong\u0026gt;Mojibake\u0026lt;/strong\u0026gt; / \u0026lt;strong\u0026gt;Double Encoding\u0026lt;/strong\u0026gt;, ...\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For \u0026lt;strong\u0026gt;Black Diamonds\u0026lt;/strong\u0026gt;, ...\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The \u0026lt;strong\u0026gt;Fixes\u0026lt;/strong\u0026gt; are listed here.  (5 different fixes for 5 different situations; pick carefully):  \u0026lt;a href=\u0026quot;http://mysql.rjweb.org/doc.php/charcoll#fixes_for_various_cases\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;http://mysql.rjweb.org/doc.php/charcoll#fixes_for_various_cases\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I had similar issues with two of my projects, after a server migration. After searching and trying a lot of solutions, I came across with this one:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;mysqli_set_charset($con,\u0026quot;utf8\u0026quot;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;After adding this line to my configuration file, everything works fine!\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I found this solution for \u0026lt;a href=\u0026quot;https://en.wikipedia.org/wiki/MySQLi\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;MySQLi\u0026lt;/a\u0026gt;\u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;https://www.w3schools.com/PHP/func_mysqli_set_charset.asp\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;PHP mysqli set_charset() Function\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;when I was looking to solve an insert from an HTML query.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I was also searching for the same issue. It took me nearly one month to find the appropriate solution.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;First of all, you will have to update you database will all the recent CHARACTER and COLLATION to utf8mb4 or at least which support UTF-8 data.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For Java:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;while making a JDBC connection, add this to the connection URL \u0026lt;em\u0026gt;useUnicode=yes\u0026amp;amp;characterEncoding=UTF-8\u0026lt;/em\u0026gt; as parameters and it will work.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For Python:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Before querying into the database, try enforcing this over the cursor\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;*\n\u0026lt;code\u0026gt;cursor.execute(\u0026apos;SET NAMES utf8mb4\u0026apos;)\u0026lt;/code\u0026gt;\n\u0026lt;code\u0026gt;cursor.execute(\u0026quot;SET CHARACTER SET utf8mb4\u0026quot;)\u0026lt;/code\u0026gt;\n\u0026lt;code\u0026gt;cursor.execute(\u0026quot;SET character_set_connection=utf8mb4\u0026quot;)\u0026lt;/code\u0026gt;\n*\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;If it does not work, happy hunting for the right solution.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Set your code IDE language to UTF-8\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Add \u0026amp;lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026amp;gt; to your webpage header where you collect data form.\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Check your MySQL table definition looks like this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TABLE\u0026lt;/span\u0026gt; your_table (\n   ...\n ) ENGINE\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;InnoDB \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DEFAULT\u0026lt;/span\u0026gt; CHARSET\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;utf8\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;If you are using \u0026lt;a href=\u0026quot;https://en.wikipedia.org/wiki/PHP#Development_and_community\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;PDO\u0026lt;/a\u0026gt;, make sure\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;(PDO::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;MYSQL_ATTR_INIT_COMMAND\u0026lt;/span\u0026gt;=\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SET NAMES utf8\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbL\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;PDO\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$pdo\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$user\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$pass\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;If you already got a large database with above problem, you can try SIDU to export with correct charset, and import back with UTF-8.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Depending on how the server is setup, you have to change the encode accordingly. utf8 from what you said should work the best. However, if you\u0026apos;re getting weird characters, it might help if you change the webpage encoding to ANSI.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;This helped me when I was setting up a PHP \u0026lt;a href=\u0026quot;https://en.wikipedia.org/wiki/MySQLi\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;MySQLi\u0026lt;/a\u0026gt;. This might help you understand more: \u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;https://superuser.com/questions/762473/ansi-to-utf-8-in-notepad\u0026quot;\u0026gt;ANSI to UTF-8 in Notepad++\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n    "],"id":159,"title":"Trouble with UTF-8 characters; what I see is not what I stored","content":"\n                \n\u0026lt;p\u0026gt;I tried to use UTF-8 and ran into trouble.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I have tried so many things; here are the results I have gotten:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;????\u0026lt;/code\u0026gt; instead of Asian characters. Even for European text, I got \u0026lt;code\u0026gt;Se?or\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;Señor\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Strange gibberish (Mojibake?) such as \u0026lt;code\u0026gt;SeÃ±or\u0026lt;/code\u0026gt; or \u0026lt;code\u0026gt;æ–°æµªæ–°é—»\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;新浪新闻\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Black diamonds, such as Se�or.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Finally, I got into a situation where the data was lost, or at least truncated: \u0026lt;code\u0026gt;Se\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;Señor\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Even when I got text to \u0026lt;em\u0026gt;look\u0026lt;/em\u0026gt; right, it did not \u0026lt;em\u0026gt;sort\u0026lt;/em\u0026gt; correctly.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;What am I doing wrong? How can I fix the \u0026lt;em\u0026gt;code\u0026lt;/em\u0026gt;? Can I recover the \u0026lt;em\u0026gt;data\u0026lt;/em\u0026gt;, if so, how?\u0026lt;/p\u0026gt;\n    ","slug":"trouble-with-utf-8-characters-what-i-see-is-not-what-i-stored-1657384817490","postType":"QUESTION","createdAt":"2022-07-09T16:40:17.000Z","updatedAt":"2022-07-09T16:40:17.000Z","tags":[{"id":580,"name":"unicode","slug":"unicode","createdAt":"2022-07-09T16:40:17.000Z","updatedAt":"2022-07-09T16:40:17.000Z","Questions_Tags":{"questionId":159,"tagId":580}},{"id":582,"name":"character-encoding","slug":"character-encoding","createdAt":"2022-07-09T16:40:17.000Z","updatedAt":"2022-07-09T16:40:17.000Z","Questions_Tags":{"questionId":159,"tagId":582}},{"id":583,"name":"mariadb","slug":"mariadb","createdAt":"2022-07-09T16:40:17.000Z","updatedAt":"2022-07-09T16:40:17.000Z","Questions_Tags":{"questionId":159,"tagId":583}}],"relatedQuestions":[{"title":"Trouble with UTF-8 characters; what I see is not what I stored","slug":"trouble-with-utf-8-characters-what-i-see-is-not-what-i-stored-1657384817490","tags":[{"name":"unicode","Questions_Tags":{"questionId":159,"tagId":580}},{"name":"character-encoding","Questions_Tags":{"questionId":159,"tagId":582}},{"name":"mariadb","Questions_Tags":{"questionId":159,"tagId":583}}]}]},"randomQuestions":[{"title":"How to horizontally center an element","slug":"how-to-horizontally-center-an-element-1657384634147"},{"title":"How do servlets work? Instantiation, sessions, shared variables and multithreading","slug":"how-do-servlets-work-instantiation-sessions-shared-variables-and-multithreading-1657387540375"},{"title":"How do I execute a program or call a system command?","slug":"how-do-i-execute-a-program-or-call-a-system-command-1657385465629"},{"title":"How to serve static files in Flask","slug":"how-to-serve-static-files-in-flask-1657387862496"},{"title":"Can PHP PDO Statements accept the table or column name as parameter?","slug":"can-php-pdo-statements-accept-the-table-or-column-name-as-parameter-1657387478588"},{"title":"Servlet returns \"HTTP Status 404 The requested resource (/servlet) is not available\"","slug":"servlet-returns-\"http-status-404-the-requested-resource-(servlet)-is-not-available\"-1657384850661"},{"title":"Why use getters and setters/accessors?","slug":"why-use-getters-and-settersaccessors-1657387343971"},{"title":"MySQL pivot row into dynamic number of columns","slug":"mysql-pivot-row-into-dynamic-number-of-columns-1657387981930"},{"title":"Serialize and Deserialize Json and Json Array in Unity","slug":"serialize-and-deserialize-json-and-json-array-in-unity-1657388273270"},{"title":"How can I validate an email address using a regular expression?","slug":"how-can-i-validate-an-email-address-using-a-regular-expression-1657384549233"},{"title":"How to store objects in HTML5 localStorage","slug":"how-to-store-objects-in-html5-localstorage-1657387568907"},{"title":"Do DOM tree elements with IDs become global properties?","slug":"do-dom-tree-elements-with-ids-become-global-properties-1657387475110"},{"title":"Scanner is skipping nextLine() after using next() or nextFoo()?","slug":"scanner-is-skipping-nextline()-after-using-next()-or-nextfoo()-1657384379697"},{"title":"Cleansing User Passwords","slug":"cleansing-user-passwords-1657387365583"},{"title":"Crash or \"segmentation fault\" when data is copied/scanned/read to an uninitialized pointer","slug":"crash-or-\"segmentation-fault\"-when-data-is-copiedscannedread-to-an-uninitialized-pointer-1657387520581"},{"title":"Why can templates only be implemented in the header file?","slug":"why-can-templates-only-be-implemented-in-the-header-file-1657384341933"},{"title":"The 3 different equals","slug":"the-3-different-equals-1657385490242"},{"title":"How do function pointers in C work?","slug":"how-do-function-pointers-in-c-work-1657388332074"},{"title":"Efficiently convert rows to columns in sql server","slug":"efficiently-convert-rows-to-columns-in-sql-server-1657387919213"},{"title":"How can I sort arrays and data in PHP?","slug":"how-can-i-sort-arrays-and-data-in-php-1657384726665"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"trouble-with-utf-8-characters-what-i-see-is-not-what-i-stored-1657384817490"},"buildId":"Zo3C7AOWQzKM9qqyzx2hf","isFallback":false,"gsp":true,"locale":"en","locales":["en"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>