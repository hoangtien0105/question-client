<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find solution for coding, HTML, CSS, JAVASCRIPT, MYSQL, PHP, PYTHON,... quickly. - solutionschecker.com"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><title>How to remove &quot;noise&quot; from GCC/clang assembly output? | Solutions Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="I want to inspect the assembly output of applying boost::variant in my code in order to see which intermediate calls are optimized away.

When I compile the following example (with GCC 5.3 using g++ -O3 -std=c++14 -S), it seems as if the compiler optimizes away everything and directly returns 100:

(...)
main:
.LFB9320:
    .cfi_startproc
    movl    $100, %eax
    ret
    .cfi_endproc
(...)




#include &lt;boost/variant.hpp&gt;

struct Foo
{
    int get() { return 100; }
};

struct Bar
{
    int get() { return 999; }
};

using Variant = boost::variant&lt;Foo, Bar&gt;;


int run(Variant v)
{
    return boost::apply_visitor([](auto&amp; x){return x.get();}, v);
}
int main()
{
    Foo f;
    return run(f);
}


However, the full assembly output contains much more than the above excerpt, which to me looks like it is never called. Is there a way to tell GCC/clang to remove all that &quot;noise&quot; and just output what is actually called when the program is ran?



full assembly output:

    .file   &quot;main1.cpp&quot;
    .section    .rodata.str1.8,&quot;aMS&quot;,@progbits,1
    .align 8
.LC0:
    .string &quot;/opt/boost/include/boost/variant/detail/forced_return.hpp&quot;
    .section    .rodata.str1.1,&quot;aMS&quot;,@progbits,1
.LC1:
    .string &quot;false&quot;
    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIvEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat
.LCOLDB2:
    .section    .text._ZN5boost6detail7variant13forced_returnIvEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat
.LHOTB2:
    .p2align 4,,15
    .weak   _ZN5boost6detail7variant13forced_returnIvEET_v
    .type   _ZN5boost6detail7variant13forced_returnIvEET_v, @function
_ZN5boost6detail7variant13forced_returnIvEET_v:
.LFB1197:
    .cfi_startproc
    subq    $8, %rsp
    .cfi_def_cfa_offset 16
    movl    $_ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__, %ecx
    movl    $49, %edx
    movl    $.LC0, %esi
    movl    $.LC1, %edi
    call    __assert_fail
    .cfi_endproc
.LFE1197:
    .size   _ZN5boost6detail7variant13forced_returnIvEET_v, .-_ZN5boost6detail7variant13forced_returnIvEET_v
    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIvEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat
.LCOLDE2:
    .section    .text._ZN5boost6detail7variant13forced_returnIvEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat
.LHOTE2:
    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIiEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat
.LCOLDB3:
    .section    .text._ZN5boost6detail7variant13forced_returnIiEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat
.LHOTB3:
    .p2align 4,,15
    .weak   _ZN5boost6detail7variant13forced_returnIiEET_v
    .type   _ZN5boost6detail7variant13forced_returnIiEET_v, @function
_ZN5boost6detail7variant13forced_returnIiEET_v:
.LFB9757:
    .cfi_startproc
    subq    $8, %rsp
    .cfi_def_cfa_offset 16
    movl    $_ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__, %ecx
    movl    $39, %edx
    movl    $.LC0, %esi
    movl    $.LC1, %edi
    call    __assert_fail
    .cfi_endproc
.LFE9757:
    .size   _ZN5boost6detail7variant13forced_returnIiEET_v, .-_ZN5boost6detail7variant13forced_returnIiEET_v
    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIiEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat
.LCOLDE3:
    .section    .text._ZN5boost6detail7variant13forced_returnIiEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat
.LHOTE3:
    .section    .text.unlikely,&quot;ax&quot;,@progbits
.LCOLDB4:
    .text
.LHOTB4:
    .p2align 4,,15
    .globl  _Z3runN5boost7variantI3FooJ3BarEEE
    .type   _Z3runN5boost7variantI3FooJ3BarEEE, @function
_Z3runN5boost7variantI3FooJ3BarEEE:
.LFB9310:
    .cfi_startproc
    subq    $8, %rsp
    .cfi_def_cfa_offset 16
    movl    (%rdi), %eax
    cltd
    xorl    %edx, %eax
    cmpl    $19, %eax
    ja  .L7
    jmp *.L9(,%rax,8)
    .section    .rodata
    .align 8
    .align 4
.L9:
    .quad   .L30
    .quad   .L10
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .text
    .p2align 4,,10
    .p2align 3
.L7:
    call    _ZN5boost6detail7variant13forced_returnIiEET_v
    .p2align 4,,10
    .p2align 3
.L30:
    movl    $100, %eax
.L8:
    addq    $8, %rsp
    .cfi_remember_state
    .cfi_def_cfa_offset 8
    ret
    .p2align 4,,10
    .p2align 3
.L10:
    .cfi_restore_state
    movl    $999, %eax
    jmp .L8
    .cfi_endproc
.LFE9310:
    .size   _Z3runN5boost7variantI3FooJ3BarEEE, .-_Z3runN5boost7variantI3FooJ3BarEEE
    .section    .text.unlikely
.LCOLDE4:
    .text
.LHOTE4:
    .globl  _Z3runN5boost7variantI3FooI3BarEEE
    .set    _Z3runN5boost7variantI3FooI3BarEEE,_Z3runN5boost7variantI3FooJ3BarEEE
    .section    .text.unlikely
.LCOLDB5:
    .section    .text.startup,&quot;ax&quot;,@progbits
.LHOTB5:
    .p2align 4,,15
    .globl  main
    .type   main, @function
main:
.LFB9320:
    .cfi_startproc
    movl    $100, %eax
    ret
    .cfi_endproc
.LFE9320:
    .size   main, .-main
    .section    .text.unlikely
.LCOLDE5:
    .section    .text.startup
.LHOTE5:
    .section    .rodata
    .align 32
    .type   _ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__, @object
    .size   _ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__, 58
_ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__:
    .string &quot;T boost::detail::variant::forced_return() [with T = void]&quot;
    .align 32
    .type   _ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__, @object
    .size   _ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__, 57
_ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__:
    .string &quot;T boost::detail::variant::forced_return() [with T = int]&quot;
    .ident  &quot;GCC: (Ubuntu 5.3.0-3ubuntu1~14.04) 5.3.0 20151204&quot;
    .section    .note.GNU-stack,&quot;&quot;,@progbits

    "/><meta property="og:title" content="How to remove &quot;noise&quot; from GCC/clang assembly output? | Solutions Checker"/><meta property="og:description" content="I want to inspect the assembly output of applying boost::variant in my code in order to see which intermediate calls are optimized away.

When I compile the following example (with GCC 5.3 using g++ -O3 -std=c++14 -S), it seems as if the compiler optimizes away everything and directly returns 100:

(...)
main:
.LFB9320:
    .cfi_startproc
    movl    $100, %eax
    ret
    .cfi_endproc
(...)




#include &lt;boost/variant.hpp&gt;

struct Foo
{
    int get() { return 100; }
};

struct Bar
{
    int get() { return 999; }
};

using Variant = boost::variant&lt;Foo, Bar&gt;;


int run(Variant v)
{
    return boost::apply_visitor([](auto&amp; x){return x.get();}, v);
}
int main()
{
    Foo f;
    return run(f);
}


However, the full assembly output contains much more than the above excerpt, which to me looks like it is never called. Is there a way to tell GCC/clang to remove all that &quot;noise&quot; and just output what is actually called when the program is ran?



full assembly output:

    .file   &quot;main1.cpp&quot;
    .section    .rodata.str1.8,&quot;aMS&quot;,@progbits,1
    .align 8
.LC0:
    .string &quot;/opt/boost/include/boost/variant/detail/forced_return.hpp&quot;
    .section    .rodata.str1.1,&quot;aMS&quot;,@progbits,1
.LC1:
    .string &quot;false&quot;
    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIvEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat
.LCOLDB2:
    .section    .text._ZN5boost6detail7variant13forced_returnIvEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat
.LHOTB2:
    .p2align 4,,15
    .weak   _ZN5boost6detail7variant13forced_returnIvEET_v
    .type   _ZN5boost6detail7variant13forced_returnIvEET_v, @function
_ZN5boost6detail7variant13forced_returnIvEET_v:
.LFB1197:
    .cfi_startproc
    subq    $8, %rsp
    .cfi_def_cfa_offset 16
    movl    $_ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__, %ecx
    movl    $49, %edx
    movl    $.LC0, %esi
    movl    $.LC1, %edi
    call    __assert_fail
    .cfi_endproc
.LFE1197:
    .size   _ZN5boost6detail7variant13forced_returnIvEET_v, .-_ZN5boost6detail7variant13forced_returnIvEET_v
    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIvEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat
.LCOLDE2:
    .section    .text._ZN5boost6detail7variant13forced_returnIvEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat
.LHOTE2:
    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIiEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat
.LCOLDB3:
    .section    .text._ZN5boost6detail7variant13forced_returnIiEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat
.LHOTB3:
    .p2align 4,,15
    .weak   _ZN5boost6detail7variant13forced_returnIiEET_v
    .type   _ZN5boost6detail7variant13forced_returnIiEET_v, @function
_ZN5boost6detail7variant13forced_returnIiEET_v:
.LFB9757:
    .cfi_startproc
    subq    $8, %rsp
    .cfi_def_cfa_offset 16
    movl    $_ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__, %ecx
    movl    $39, %edx
    movl    $.LC0, %esi
    movl    $.LC1, %edi
    call    __assert_fail
    .cfi_endproc
.LFE9757:
    .size   _ZN5boost6detail7variant13forced_returnIiEET_v, .-_ZN5boost6detail7variant13forced_returnIiEET_v
    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIiEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat
.LCOLDE3:
    .section    .text._ZN5boost6detail7variant13forced_returnIiEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat
.LHOTE3:
    .section    .text.unlikely,&quot;ax&quot;,@progbits
.LCOLDB4:
    .text
.LHOTB4:
    .p2align 4,,15
    .globl  _Z3runN5boost7variantI3FooJ3BarEEE
    .type   _Z3runN5boost7variantI3FooJ3BarEEE, @function
_Z3runN5boost7variantI3FooJ3BarEEE:
.LFB9310:
    .cfi_startproc
    subq    $8, %rsp
    .cfi_def_cfa_offset 16
    movl    (%rdi), %eax
    cltd
    xorl    %edx, %eax
    cmpl    $19, %eax
    ja  .L7
    jmp *.L9(,%rax,8)
    .section    .rodata
    .align 8
    .align 4
.L9:
    .quad   .L30
    .quad   .L10
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .text
    .p2align 4,,10
    .p2align 3
.L7:
    call    _ZN5boost6detail7variant13forced_returnIiEET_v
    .p2align 4,,10
    .p2align 3
.L30:
    movl    $100, %eax
.L8:
    addq    $8, %rsp
    .cfi_remember_state
    .cfi_def_cfa_offset 8
    ret
    .p2align 4,,10
    .p2align 3
.L10:
    .cfi_restore_state
    movl    $999, %eax
    jmp .L8
    .cfi_endproc
.LFE9310:
    .size   _Z3runN5boost7variantI3FooJ3BarEEE, .-_Z3runN5boost7variantI3FooJ3BarEEE
    .section    .text.unlikely
.LCOLDE4:
    .text
.LHOTE4:
    .globl  _Z3runN5boost7variantI3FooI3BarEEE
    .set    _Z3runN5boost7variantI3FooI3BarEEE,_Z3runN5boost7variantI3FooJ3BarEEE
    .section    .text.unlikely
.LCOLDB5:
    .section    .text.startup,&quot;ax&quot;,@progbits
.LHOTB5:
    .p2align 4,,15
    .globl  main
    .type   main, @function
main:
.LFB9320:
    .cfi_startproc
    movl    $100, %eax
    ret
    .cfi_endproc
.LFE9320:
    .size   main, .-main
    .section    .text.unlikely
.LCOLDE5:
    .section    .text.startup
.LHOTE5:
    .section    .rodata
    .align 32
    .type   _ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__, @object
    .size   _ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__, 58
_ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__:
    .string &quot;T boost::detail::variant::forced_return() [with T = void]&quot;
    .align 32
    .type   _ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__, @object
    .size   _ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__, 57
_ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__:
    .string &quot;T boost::detail::variant::forced_return() [with T = int]&quot;
    .ident  &quot;GCC: (Ubuntu 5.3.0-3ubuntu1~14.04) 5.3.0 20151204&quot;
    .section    .note.GNU-stack,&quot;&quot;,@progbits

    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"How to remove &quot;noise&quot; from GCC/clang assembly output?","text":"I want to inspect the assembly output of applying boost::variant in my code in order to see which intermediate calls are optimized away.\n\nWhen I compile the following example (with GCC 5.3 using g++ -O3 -std=c++14 -S), it seems as if the compiler optimizes away everything and directly returns 100:\n\n(...)\nmain:\n.LFB9320:\n    .cfi_startproc\n    movl    $100, %eax\n    ret\n    .cfi_endproc\n(...)\n\n\n\n\n#include &lt;boost/variant.hpp&gt;\n\nstruct Foo\n{\n    int get() { return 100; }\n};\n\nstruct Bar\n{\n    int get() { return 999; }\n};\n\nusing Variant = boost::variant&lt;Foo, Bar&gt;;\n\n\nint run(Variant v)\n{\n    return boost::apply_visitor([](auto&amp; x){return x.get();}, v);\n}\nint main()\n{\n    Foo f;\n    return run(f);\n}\n\n\nHowever, the full assembly output contains much more than the above excerpt, which to me looks like it is never called. Is there a way to tell GCC/clang to remove all that &quot;noise&quot; and just output what is actually called when the program is ran?\n\n\n\nfull assembly output:\n\n    .file   &quot;main1.cpp&quot;\n    .section    .rodata.str1.8,&quot;aMS&quot;,@progbits,1\n    .align 8\n.LC0:\n    .string &quot;/opt/boost/include/boost/variant/detail/forced_return.hpp&quot;\n    .section    .rodata.str1.1,&quot;aMS&quot;,@progbits,1\n.LC1:\n    .string &quot;false&quot;\n    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIvEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat\n.LCOLDB2:\n    .section    .text._ZN5boost6detail7variant13forced_returnIvEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat\n.LHOTB2:\n    .p2align 4,,15\n    .weak   _ZN5boost6detail7variant13forced_returnIvEET_v\n    .type   _ZN5boost6detail7variant13forced_returnIvEET_v, @function\n_ZN5boost6detail7variant13forced_returnIvEET_v:\n.LFB1197:\n    .cfi_startproc\n    subq    $8, %rsp\n    .cfi_def_cfa_offset 16\n    movl    $_ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__, %ecx\n    movl    $49, %edx\n    movl    $.LC0, %esi\n    movl    $.LC1, %edi\n    call    __assert_fail\n    .cfi_endproc\n.LFE1197:\n    .size   _ZN5boost6detail7variant13forced_returnIvEET_v, .-_ZN5boost6detail7variant13forced_returnIvEET_v\n    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIvEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat\n.LCOLDE2:\n    .section    .text._ZN5boost6detail7variant13forced_returnIvEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat\n.LHOTE2:\n    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIiEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat\n.LCOLDB3:\n    .section    .text._ZN5boost6detail7variant13forced_returnIiEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat\n.LHOTB3:\n    .p2align 4,,15\n    .weak   _ZN5boost6detail7variant13forced_returnIiEET_v\n    .type   _ZN5boost6detail7variant13forced_returnIiEET_v, @function\n_ZN5boost6detail7variant13forced_returnIiEET_v:\n.LFB9757:\n    .cfi_startproc\n    subq    $8, %rsp\n    .cfi_def_cfa_offset 16\n    movl    $_ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__, %ecx\n    movl    $39, %edx\n    movl    $.LC0, %esi\n    movl    $.LC1, %edi\n    call    __assert_fail\n    .cfi_endproc\n.LFE9757:\n    .size   _ZN5boost6detail7variant13forced_returnIiEET_v, .-_ZN5boost6detail7variant13forced_returnIiEET_v\n    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIiEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat\n.LCOLDE3:\n    .section    .text._ZN5boost6detail7variant13forced_returnIiEET_v,&quot;axG&quot;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat\n.LHOTE3:\n    .section    .text.unlikely,&quot;ax&quot;,@progbits\n.LCOLDB4:\n    .text\n.LHOTB4:\n    .p2align 4,,15\n    .globl  _Z3runN5boost7variantI3FooJ3BarEEE\n    .type   _Z3runN5boost7variantI3FooJ3BarEEE, @function\n_Z3runN5boost7variantI3FooJ3BarEEE:\n.LFB9310:\n    .cfi_startproc\n    subq    $8, %rsp\n    .cfi_def_cfa_offset 16\n    movl    (%rdi), %eax\n    cltd\n    xorl    %edx, %eax\n    cmpl    $19, %eax\n    ja  .L7\n    jmp *.L9(,%rax,8)\n    .section    .rodata\n    .align 8\n    .align 4\n.L9:\n    .quad   .L30\n    .quad   .L10\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .text\n    .p2align 4,,10\n    .p2align 3\n.L7:\n    call    _ZN5boost6detail7variant13forced_returnIiEET_v\n    .p2align 4,,10\n    .p2align 3\n.L30:\n    movl    $100, %eax\n.L8:\n    addq    $8, %rsp\n    .cfi_remember_state\n    .cfi_def_cfa_offset 8\n    ret\n    .p2align 4,,10\n    .p2align 3\n.L10:\n    .cfi_restore_state\n    movl    $999, %eax\n    jmp .L8\n    .cfi_endproc\n.LFE9310:\n    .size   _Z3runN5boost7variantI3FooJ3BarEEE, .-_Z3runN5boost7variantI3FooJ3BarEEE\n    .section    .text.unlikely\n.LCOLDE4:\n    .text\n.LHOTE4:\n    .globl  _Z3runN5boost7variantI3FooI3BarEEE\n    .set    _Z3runN5boost7variantI3FooI3BarEEE,_Z3runN5boost7variantI3FooJ3BarEEE\n    .section    .text.unlikely\n.LCOLDB5:\n    .section    .text.startup,&quot;ax&quot;,@progbits\n.LHOTB5:\n    .p2align 4,,15\n    .globl  main\n    .type   main, @function\nmain:\n.LFB9320:\n    .cfi_startproc\n    movl    $100, %eax\n    ret\n    .cfi_endproc\n.LFE9320:\n    .size   main, .-main\n    .section    .text.unlikely\n.LCOLDE5:\n    .section    .text.startup\n.LHOTE5:\n    .section    .rodata\n    .align 32\n    .type   _ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__, @object\n    .size   _ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__, 58\n_ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__:\n    .string &quot;T boost::detail::variant::forced_return() [with T = void]&quot;\n    .align 32\n    .type   _ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__, @object\n    .size   _ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__, 57\n_ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__:\n    .string &quot;T boost::detail::variant::forced_return() [with T = int]&quot;\n    .ident  &quot;GCC: (Ubuntu 5.3.0-3ubuntu1~14.04) 5.3.0 20151204&quot;\n    .section    .note.GNU-stack,&quot;&quot;,@progbits\n\n    ","answerCount":3,"upVoteCount":500,"suggestedAnswer":[{"text":"Stripping out the .cfi directives, unused labels, and comment lines is a solved problem: the scripts behind Matt Godbolt&apos;s compiler explorer are open source on its github project.  It can even do colour highlighting to match source lines to asm lines (using the debug info).\nYou can set it up locally so you can feed it files that are part of your project with all the #include paths and so on (using -I/...).  And so you can use it on private source code that you don&apos;t want to send out over the Internet.\nMatt Godbolt&apos;s CppCon2017 talk What Has My Compiler Done for Me Lately? Unbolting the Compiler&apos;s Lid shows how to use it (it&apos;s pretty self-explanatory but has some neat features if you read the docs on github), and also how to read x86 asm, with a gentle introduction to x86 asm itself for total beginners, and to looking at compiler output.  He goes on to show some neat compiler optimizations (e.g. for dividing by a constant), and what kind of functions give useful asm output for looking at optimized compiler output (function args, not int a = 123;).\nOn the Godbolt compiler explorer, it can be useful to use -g0 -fno-asynchronous-unwind-tables if you want to uncheck the filter option for directives, e.g. because you want to see the .section and .p2align stuff in the compiler output.  The default is to add -g to your options to get the debug info it uses to colour-highlight matching source and asm lines, but this means .cfi directives for every stack operation, and .loc for every source line, among other things.\n\nWith plain gcc/clang (not g++), -fno-asynchronous-unwind-tables avoids .cfi directives.  Possibly also useful: -fno-exceptions -fno-rtti -masm=intel.  Make sure to omit -g.\nCopy/paste this for local use:\ng++ -fno-asynchronous-unwind-tables -fno-exceptions -fno-rtti -fverbose-asm \\\n    -Wall -Wextra  foo.cpp   -O3 -masm=intel -S -o- | less\n\nOr -Os can be more readable, e.g. using div for division by non-power-of-2 constants instead of a multiplicative inverse even though that&apos;s a lot worse for performance and only a bit smaller, if at all.\n\nBut really, I&apos;d recommend just using Godbolt directly (online or set it up locally)!  You can quickly flip between versions of gcc and clang to see if old or new compilers do something dumb.  (Or what ICC does, or even what MSVC does.)  There&apos;s even ARM / ARM64 gcc 6.3, and various gcc for PowerPC, MIPS, AVR, MSP430.  (It can be interesting to see what happens on a machine where int is wider than a register, or isn&apos;t 32-bit.  Or on a RISC vs. x86).\nFor C instead of C++, you can use -xc -std=gnu11 to avoid flipping the language drop-down to C, which resets your source pane and compiler choices, and has a different set of compilers available.\n\nUseful compiler options for making asm for human consumption:\n\nRemember, your code only has to compile, not link: passing a pointer to an external function like void ext(void*p) is a good way to stop something from optimizing away.  You only need a prototype for it, with no definition so the compiler can&apos;t inline it or make any assumptions about what it does.  (Or inline asm like Benchmark::DoNotOptimize can force a compiler to materialize a value in a register, or forget about it being a known constant, if you know GNU C inline asm syntax well enough to use constraints to understand the effect you&apos;re having on what you&apos;re requiring of the compiler.)\n\nI&apos;d recommend using -O3 -Wall -Wextra -fverbose-asm -march=haswell for looking at code.  (-fverbose-asm can just make the source look noisy, though, when all you get are numbered temporaries as names for the operands.)  When you&apos;re fiddling with the source to see how it changes the asm, you definitely want compiler warnings enabled.  You don&apos;t want to waste time scratching your head over the asm when the explanation is that you did something that deserves a warning in the source.\n\nTo see how the calling convention works, you often want to look at caller and callee without inlining.\nYou can use __attribute__((noipa)) foo_t foo(bar_t x) { ... } on a definition, or compile with gcc -O3 -fno-inline-functions -fno-inline-functions-called-once -fno-inline-small-functions to disable inlining.  (But those command line options don&apos;t disable cloning a function for constant-propagation.  noipa = no Inter-Procedural Analysis.  It&apos;s even stronger than __attribute__((noinline,noclone)).)  See From compiler perspective, how is reference for array dealt with, and, why passing by value(not decay) is not allowed? for an example.\nOr if you just want to see how functions pass / receive args of different types, you could use different names but the same prototype so the compiler doesn&apos;t have a definition to inline.  This works with any compiler.  Without a definition, a function is just a black box to the optimizer, governed only by the calling convention / ABI.\n\n-ffast-math will get many libm functions to inline, some to a single instruction (esp. with SSE4 available for roundsd).  Some will inline with just -fno-math-errno, or other &quot;safer&quot; parts of -ffast-math, without the parts that allow the compiler to round differently.  If you have FP code, definitely look at it with/without -ffast-math.  If you can&apos;t safely enable any of -ffast-math in your regular build, maybe you&apos;ll get an idea for a safe change you can make in the source to allow the same optimization without -ffast-math.\n\n-O3 -fno-tree-vectorize will optimize without auto-vectorizing, so you can get full optimization without if you want to compare with -O2 (which doesn&apos;t enable autovectorization on gcc11 and earlier, but does on all clang).\n-Os (optimize for size and speed) can be helpful to keep the code more compact, which means less code to understand.    clang&apos;s -Oz optimizes for size even when it hurts speed, even using push 1 / pop rax instead of mov eax, 1, so that&apos;s only interesting for code golf.\nEven -Og (minimal optimization) might be what you want to look at, depending on your goals.  -O0 is full of store/reload noise, which makes it harder to follow, unless you use register vars.  The only upside is that each C statement compiles to a separate block of instructions, and it makes -fverbose-asm able to use the actual C var names.\n\nclang unrolls loops by default, so -fno-unroll-loops can be useful in complex functions.  You can get a sense of &quot;what the compiler did&quot; without having to wade through the unrolled loops.  (gcc enables -funroll-loops with -fprofile-use, but not with -O3).  (This is a suggestion for human-readable code, not for code that would run faster.)\n\nDefinitely enable some level of optimization, unless you specifically want to know what -O0 did.  Its &quot;predictable debug behaviour&quot; requirement makes the compiler store/reload everything between every C statement, so you can modify C variables with a debugger and even &quot;jump&quot; to a different source line within the same function, and have execution continue as if you did that in the C source.  -O0 output is so noisy with stores/reloads (and so slow) not just from lack of optimization, but forced de-optimization to support debugging.  (also related).\n\n\n\nTo get a mix of source and asm, use gcc -Wa,-adhln -c -g foo.c | less to pass extra options to as.  (More discussion of this in a blog post, and another blog.).  Note that the output of this isn&apos;t valid assembler input, because the C source is there directly, not as an assembler comment.  So don&apos;t call it a .s.  A .lst might make sense if you want to save it to a file.\nGodbolt&apos;s color highlighting serves a similar purpose, and is great at helping you see when multiple non-contiguous asm instructions come from the same source line.  I haven&apos;t used that gcc listing command at all, so IDK how well it does, and how easy it is for the eye to see, in that case.\nI like the high code density of godbolt&apos;s asm pane, so I don&apos;t think I&apos;d like having source lines mixed in.  At least not for simple functions.  Maybe with a function that was too complex to get a handle on the overall structure of what the asm does...\n\nAnd remember, when you want to just look at the asm, leave out the main() and the compile-time constants.  You want to see the code for dealing with a function arg in a register, not for the code after constant-propagation turns it into return 42, or at least optimizes away some stuff.\nRemoving static and/or inline from functions will produce a stand-alone definition for them, as well as a definition for any callers, so you can just look at that.\nDon&apos;t put your code in a function called main().  gcc knows that main is special and assumes it will only be called once, so it marks it as &quot;cold&quot; and optimizes it less.\n\nThe other thing you can do: If you did make a main(), you can run it and use a debugger.  stepi (si) steps by instruction.  See the bottom of the x86 tag wiki for instructions.  But remember that code might optimize away after inlining into main with compile-time-constant args.\n__attribute__((noinline)) may help, on a function that you want to not be inlined.  gcc will also make constant-propagation clones of functions, i.e. a special version with one of the args as a constant, for call-sites that know they&apos;re passing a constant.  The symbol name will be .clone.foo.constprop_1234 or something in the asm output. You can use __attribute__((noclone)) to disable that, too.).\n\nFor example\nIf you want to see how the compiler multiplies two integers:  I put the following code on the Godbolt compiler explorer to get the asm (from gcc -O3 -march=haswell -fverbose-asm) for the wrong way and the right way to test this.\n// the wrong way, which people often write when they&apos;re used to creating a runnable test-case with a main() and a printf\n// or worse, people will actually look at the asm for such a main()\nint constants() { int a = 10, b = 20; return a * b; }\n    mov     eax, 200  #,\n    ret                     # compiles the same as  return 200;  not interesting\n\n// the right way: compiler doesn&apos;t know anything about the inputs\n// so we get asm like what would happen when this inlines into a bigger function.\nint variables(int a, int b) { return a * b; }\n    mov     eax, edi  # D.2345, a\n    imul    eax, esi        # D.2345, b\n    ret\n\n(This mix of asm and C was hand-crafted by copy-pasting the asm output from godbolt into the right place.  I find it&apos;s a good way to show how a short function compiles in SO answers / compiler bug reports / emails.)\n    ","url":"/questions/[slug]#solution1","@type":"Answer","upvoteCount":0},{"text":"You can always look at the generated assembly from the object file, instead of using the compilers assembly output. objdump comes to mind.\n\nYou can even tell objdump to intermix source with assembly, making it easier to figure out what source line corresponds to what instructions. Example session:\n\n$ cat test.cc\nint foo(int arg)\n{\n    return arg * 42;\n}\n\n$ g++ -g -O3 -std=c++14 -c test.cc -o test.o &amp;&amp; objdump -dS -M intel test.o\n\ntest.o:     file format elf64-x86-64\n\n\nDisassembly of section .text:\n\n0000000000000000 &lt;_Z3fooi&gt;:\nint foo(int arg)\n{\n    return arg + 1;\n   0:   8d 47 01                lea    eax,[rdi+0x1]\n}\n   3:   c3                      ret    \n\n\nExplanation of objdump flags:\n\n\n-d disassembles all executable sections\n-S intermixes assembly with source (-g required while compiling with g++)\n-M intel choses intel syntax over ugly AT&amp;T syntax (optional)\n\n    ","url":"/questions/[slug]#solution2","@type":"Answer","upvoteCount":0},{"text":"I like to insert labels that I can easily grep out of the objdump output.\n\nint main() {\n    asm volatile (&quot;interesting_part_begin%=:&quot;:);\n    do_something();\n    asm volatile (&quot;interesting_part_end%=:&quot;:);\n}\n\n\nI haven&apos;t had a problem with this yet, but asm volatile can be very hard on a compiler&apos;s optimizer because it tends to leave such code untouched.\n    ","url":"/questions/[slug]#solution3","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/08bcc42a26fe5c92.css" as="style"/><link rel="stylesheet" href="/_next/static/css/08bcc42a26fe5c92.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-ccfab947c79712f4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-08d1a634dea6705e.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/150-b06815e21c943e0d.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/108-87de33c23337ff53.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-79a1437acf654019.js" defer=""></script><script src="/_next/static/TQ2eYlCSdocSK-hq6gkM0/_buildManifest.js" defer=""></script><script src="/_next/static/TQ2eYlCSdocSK-hq6gkM0/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h4 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h4></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/how-to-remove-%22noise%22-from-gccclang-assembly-output-1657387612391#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/how-to-remove-%22noise%22-from-gccclang-assembly-output-1657387612391"><h1>How to remove &quot;noise&quot; from GCC/clang assembly output?</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/assembly">assembly</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/clang">clang</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/compiler-optimization">compiler-optimization</a></div></div><div class="question-content mt-5">
                
<p>I want to inspect the assembly output of applying <code>boost::variant</code> in my code in order to see which intermediate calls are optimized away.</p>

<p>When I compile the following example (with GCC 5.3 using <code>g++ -O3 -std=c++14 -S</code>), it seems as if the compiler optimizes away everything and directly returns 100:</p>

<pre class="default s-code-block"><code class="hljs language-makefile">(...)
<span class="hljs-section">main:</span>
<span class="hljs-section">.LFB9320:</span>
    .cfi_startproc
    movl    $100, %eax
    ret
    .cfi_endproc
(...)
</code></pre>

<hr>

<pre class="default s-code-block"><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;boost/variant.hpp&gt;</span></span>

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Foo</span>
{
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">get</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>; }
};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Bar</span>
{
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">get</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-number">999</span>; }
};

<span class="hljs-keyword">using</span> Variant = boost::variant&lt;Foo, Bar&gt;;


<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">run</span><span class="hljs-params">(Variant v)</span>
</span>{
    <span class="hljs-keyword">return</span> boost::<span class="hljs-built_in">apply_visitor</span>([](<span class="hljs-keyword">auto</span>&amp; x){<span class="hljs-keyword">return</span> x.<span class="hljs-built_in">get</span>();}, v);
}
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    Foo f;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">run</span>(f);
}
</code></pre>

<p>However, the full assembly output contains much more than the above excerpt, which to me looks like it is never called. <strong>Is there a way to tell GCC/clang to remove all that "noise" and just output what is actually called when the program is ran?</strong></p>

<hr>

<p><strong>full assembly output:</strong></p>

<pre class="default s-code-block"><code class="hljs language-perl">    .file   <span class="hljs-string">"main1.cpp"</span>
    .section    .rodata.str1.<span class="hljs-number">8</span>,<span class="hljs-string">"aMS"</span>,@progbits,<span class="hljs-number">1</span>
    .align <span class="hljs-number">8</span>
.LC<span class="hljs-number">0</span>:
    .string <span class="hljs-string">"/opt/boost/include/boost/variant/detail/forced_return.hpp"</span>
    .section    .rodata.str1.<span class="hljs-number">1</span>,<span class="hljs-string">"aMS"</span>,@progbits,<span class="hljs-number">1</span>
.LC1:
    .string <span class="hljs-string">"false"</span>
    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIvEET_v,<span class="hljs-string">"axG"</span>,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat
.LCOLDB2:
    .section    .text._ZN5boost6detail7variant13forced_returnIvEET_v,<span class="hljs-string">"axG"</span>,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat
.LHOTB2:
    .p2align <span class="hljs-number">4</span>,,<span class="hljs-number">15</span>
    .weak   _ZN5boost6detail7variant13forced_returnIvEET_v
    .type   _ZN5boost6detail7variant13forced_returnIvEET_v, @function
_ZN5boost6detail7variant13forced_returnIvEET_v:
.LFB1197:
    .cfi_startproc
    subq    $8, %rsp
    .cfi_def_cfa_offset <span class="hljs-number">16</span>
    movl    $_ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__, %ecx
    movl    $49, %edx
    movl    $.LC<span class="hljs-number">0</span>, %esi
    movl    $.LC1, %edi
    call    __assert_fail
    .cfi_endproc
.LFE1197:
    .size   _ZN5boost6detail7variant13forced_returnIvEET_v, .-_ZN5boost6detail7variant13forced_returnIvEET_v
    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIvEET_v,<span class="hljs-string">"axG"</span>,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat
.LCOLDE2:
    .section    .text._ZN5boost6detail7variant13forced_returnIvEET_v,<span class="hljs-string">"axG"</span>,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat
.LHOTE2:
    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIiEET_v,<span class="hljs-string">"axG"</span>,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat
.LCOLDB3:
    .section    .text._ZN5boost6detail7variant13forced_returnIiEET_v,<span class="hljs-string">"axG"</span>,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat
.LHOTB3:
    .p2align <span class="hljs-number">4</span>,,<span class="hljs-number">15</span>
    .weak   _ZN5boost6detail7variant13forced_returnIiEET_v
    .type   _ZN5boost6detail7variant13forced_returnIiEET_v, @function
_ZN5boost6detail7variant13forced_returnIiEET_v:
.LFB9757:
    .cfi_startproc
    subq    $8, %rsp
    .cfi_def_cfa_offset <span class="hljs-number">16</span>
    movl    $_ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__, %ecx
    movl    $39, %edx
    movl    $.LC<span class="hljs-number">0</span>, %esi
    movl    $.LC1, %edi
    call    __assert_fail
    .cfi_endproc
.LFE9757:
    .size   _ZN5boost6detail7variant13forced_returnIiEET_v, .-_ZN5boost6detail7variant13forced_returnIiEET_v
    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIiEET_v,<span class="hljs-string">"axG"</span>,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat
.LCOLDE3:
    .section    .text._ZN5boost6detail7variant13forced_returnIiEET_v,<span class="hljs-string">"axG"</span>,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat
.LHOTE3:
    .section    .text.unlikely,<span class="hljs-string">"ax"</span>,@progbits
.LCOLDB4:
    .text
.LHOTB4:
    .p2align <span class="hljs-number">4</span>,,<span class="hljs-number">15</span>
    .globl  _Z3runN5boost7variantI3FooJ3BarEEE
    .type   _Z3runN5boost7variantI3FooJ3BarEEE, @function
_Z3runN5boost7variantI3FooJ3BarEEE:
.LFB931<span class="hljs-number">0</span>:
    .cfi_startproc
    subq    $8, %rsp
    .cfi_def_cfa_offset <span class="hljs-number">16</span>
    movl    (%rdi), %eax
    cltd
    xorl    %edx, %eax
    cmpl    $19, %eax
    ja  .L7
    jmp *.L9(,%rax,<span class="hljs-number">8</span>)
    .section    .rodata
    .align <span class="hljs-number">8</span>
    .align <span class="hljs-number">4</span>
.L9:
    .quad   .L3<span class="hljs-number">0</span>
    .quad   .L1<span class="hljs-number">0</span>
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .quad   .L7
    .text
    .p2align <span class="hljs-number">4</span>,,<span class="hljs-number">10</span>
    .p2align <span class="hljs-number">3</span>
.L7:
    call    _ZN5boost6detail7variant13forced_returnIiEET_v
    .p2align <span class="hljs-number">4</span>,,<span class="hljs-number">10</span>
    .p2align <span class="hljs-number">3</span>
.L3<span class="hljs-number">0</span>:
    movl    $10<span class="hljs-number">0</span>, %eax
.L8:
    addq    $8, %rsp
    .cfi_remember_state
    .cfi_def_cfa_offset <span class="hljs-number">8</span>
    ret
    .p2align <span class="hljs-number">4</span>,,<span class="hljs-number">10</span>
    .p2align <span class="hljs-number">3</span>
.L1<span class="hljs-number">0</span>:
    .cfi_restore_state
    movl    $999, %eax
    jmp .L8
    .cfi_endproc
.LFE931<span class="hljs-number">0</span>:
    .size   _Z3runN5boost7variantI3FooJ3BarEEE, .-_Z3runN5boost7variantI3FooJ3BarEEE
    .section    .text.unlikely
.LCOLDE4:
    .text
.LHOTE4:
    .globl  _Z3runN5boost7variantI3FooI3BarEEE
    .set    _Z3runN5boost7variantI3FooI3BarEEE,_Z3runN5boost7variantI3FooJ3BarEEE
    .section    .text.unlikely
.LCOLDB5:
    .section    .text.startup,<span class="hljs-string">"ax"</span>,@progbits
.LHOTB5:
    .p2align <span class="hljs-number">4</span>,,<span class="hljs-number">15</span>
    .globl  main
    .type   main, @function
main:
.LFB932<span class="hljs-number">0</span>:
    .cfi_startproc
    movl    $10<span class="hljs-number">0</span>, %eax
    ret
    .cfi_endproc
.LFE932<span class="hljs-number">0</span>:
    .size   main, .-main
    .section    .text.unlikely
.LCOLDE5:
    .section    .text.startup
.LHOTE5:
    .section    .rodata
    .align <span class="hljs-number">32</span>
    .type   _ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION_<span class="hljs-number">_</span>, @object
    .size   _ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION_<span class="hljs-number">_</span>, <span class="hljs-number">58</span>
_ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION_<span class="hljs-number">_</span>:
    .string <span class="hljs-string">"T boost::detail::variant::forced_return() [with T = void]"</span>
    .align <span class="hljs-number">32</span>
    .type   _ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION_<span class="hljs-number">_</span>, @object
    .size   _ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION_<span class="hljs-number">_</span>, <span class="hljs-number">57</span>
_ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION_<span class="hljs-number">_</span>:
    .string <span class="hljs-string">"T boost::detail::variant::forced_return() [with T = int]"</span>
    .ident  <span class="hljs-string">"GCC: (Ubuntu 5.3.0-3ubuntu1~14.04) 5.3.0 20151204"</span>
    .section    .note.GNU-stack,<span class="hljs-string">""</span>,@progbits
</code></pre>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li><li class="pagination-solution-item"><span data-id="#solution3" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">3</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/assembly">assembly</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/clang">clang</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/compiler-optimization">compiler-optimization</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Stripping out the <code>.cfi</code> directives, unused labels, and comment lines is a solved problem: the scripts behind <a href="http://gcc.godbolt.org/#compilers:!((compiler:g530,options:%27-std%3Dgnu%2B%2B14+-Wall+-Wextra++-O3+-fno-verbose-asm+-ffast-math+-march%3Dhaswell%27,source:%27%23include+%3Cboost/variant.hpp%3E%0A%0Astruct+Foo%0A%7B%0A++++int+get()+%7B+return+100%3B+%7D%0A%7D%3B%0A%0Astruct+Bar%0A%7B%0A++++int+get()+%7B+return+999%3B+%7D%0A%7D%3B%0A%0Ausing+Variant+%3D+boost::variant%3CFoo,+Bar%3E%3B%0A%0A%0Aint+run(Variant+v)%0A%7B%0A++++return+boost::apply_visitor(%5B%5D(auto%26+x)%7Breturn+x.get()%3B%7D,+v)%3B%0A%7D%0Aint+main()%0A%7B%0A++++Foo+f%3B%0A++++return+run(f)%3B%0A%7D%0A%27)),filterAsm:(commentOnly:!t,directives:!t,intel:!t,labels:!t),version:3" rel="noreferrer">Matt Godbolt's compiler explorer</a> are open source on <a href="https://github.com/mattgodbolt/gcc-explorer" rel="noreferrer">its github project</a>.  It can even do colour highlighting to match source lines to asm lines (using the debug info).</p>
<p>You can set it up locally so you can feed it files that are part of your project with all the <code>#include</code> paths and so on (using <code>-I/...</code>).  And so you can use it on private source code that you don't want to send out over the Internet.</p>
<p><strong>Matt Godbolt's CppCon2017 talk <a href="https://youtu.be/bSkpMdDe4g4" rel="noreferrer">What Has My Compiler Done for Me Lately? Unbolting the Compiler's Lid</a> shows how to use it</strong> (it's pretty self-explanatory but has some neat features if you read the docs on github), and also <strong>how to read x86 asm</strong>, with a gentle introduction to x86 asm itself for total beginners, and to looking at compiler output.  He goes on to show some neat compiler optimizations (e.g. for dividing by a constant), and what kind of functions give useful asm output for looking at optimized compiler output (function args, not <code>int a = 123;</code>).</p>
<p>On the Godbolt compiler explorer, it can be useful to use <code>-g0 -fno-asynchronous-unwind-tables</code> if you want to uncheck the filter option for directives, e.g. because you want to see the <code>.section</code> and <code>.p2align</code> stuff in the compiler output.  The default is to add <code>-g</code> to your options to get the debug info it uses to colour-highlight matching source and asm lines, but this means <code>.cfi</code> directives for every stack operation, and <code>.loc</code> for every source line, among other things.</p>
<hr>
<p>With plain gcc/clang (not g++), <code>-fno-asynchronous-unwind-tables</code> avoids <code>.cfi</code> directives.  Possibly also useful: <code>-fno-exceptions -fno-rtti</code> <code>-masm=intel</code>.  Make sure to omit <code>-g</code>.</p>
<p><strong>Copy/paste this for local use</strong>:</p>
<pre class="default s-code-block"><code class="hljs language-cpp">g++ -fno-asynchronous-unwind-tables -fno-exceptions -fno-rtti -fverbose-<span class="hljs-keyword">asm</span> \
    -Wall -Wextra  foo.cpp   -O3 -masm=intel -S -o- | less
</code></pre>
<p>Or <code>-Os</code> can be more readable, e.g. using <code>div</code> for division by non-power-of-2 constants instead of a multiplicative inverse even though that's a lot worse for performance and only a bit smaller, if at all.</p>
<hr>
<p>But really, I'd recommend just using Godbolt directly (online or set it up locally)!  You can quickly flip between versions of gcc and clang to see if old or new compilers do something dumb.  (Or what ICC does, or even what MSVC does.)  There's even ARM / ARM64 gcc 6.3, and various gcc for PowerPC, MIPS, AVR, MSP430.  (It can be interesting to see what happens on a machine where <code>int</code> is wider than a register, or isn't 32-bit.  Or on a RISC vs. x86).</p>
<p>For C instead of C++, you can use <code>-xc -std=gnu11</code> to avoid flipping the language drop-down to C, which resets your source pane and compiler choices, and has a different set of compilers available.</p>
<hr>
<p><strong>Useful compiler options for making asm for human consumption</strong>:</p>
<ul>
<li><p><strong>Remember, your code only has to compile, not link: passing a pointer to an external function like <code>void ext(void*p)</code> is a good way to stop something from optimizing away</strong>.  You only need a prototype for it, with no definition so the compiler can't inline it or make any assumptions about what it does.  (Or <a href="https://stackoverflow.com/questions/40122141/preventing-compiler-optimizations-while-benchmarking">inline asm like <code>Benchmark::DoNotOptimize</code></a> can force a compiler to materialize a value in a register, or forget about it being a known constant, if you know GNU C inline asm syntax well enough to use constraints to understand the effect you're having on what you're requiring of the compiler.)</p>
</li>
<li><p>I'd recommend using <code>-O3 -Wall -Wextra -fverbose-asm -march=haswell</code> for looking at code.  (<code>-fverbose-asm</code> can just make the source look noisy, though, when all you get are numbered temporaries as names for the operands.)  When you're fiddling with the source to see how it changes the asm, you <em>definitely</em> want compiler warnings enabled.  You don't want to waste time scratching your head over the asm when the explanation is that you did something that deserves a warning in the source.</p>
</li>
<li><p>To see how the calling convention works, <strong>you often want to look at caller and callee without inlining</strong>.</p>
<p>You can use <code>__attribute__((noipa)) foo_t foo(bar_t x) { ... }</code> on a definition, or compile with <code>gcc -O3 -fno-inline-functions -fno-inline-functions-called-once -fno-inline-small-functions</code> to disable inlining.  (But those command line options don't disable cloning a function for constant-propagation.  <code>noipa</code> = no Inter-Procedural Analysis.  It's even stronger than <code>__attribute__((noinline,noclone))</code>.)  See <a href="https://stackoverflow.com/questions/50775127/from-compiler-perspective-how-is-reference-for-array-dealt-with-and-why-passi">From compiler perspective, how is reference for array dealt with, and, why passing by value(not decay) is not allowed?</a> for an example.</p>
<p>Or if you just want to see how functions pass / receive args of different types, you could use different names but the same prototype so the compiler doesn't have a definition to inline.  This works with any compiler.  Without a definition, a function is just a black box to the optimizer, governed only by the calling convention / ABI.</p>
</li>
<li><p><code>-ffast-math</code> will get many libm functions to inline, some to a single instruction (esp. with SSE4 available for <code>roundsd</code>).  Some will inline with just <code>-fno-math-errno</code>, or other "safer" parts of <code>-ffast-math</code>, without the parts that allow the compiler to round differently.  If you have FP code, definitely look at it with/without <code>-ffast-math</code>.  If you can't safely enable any of <code>-ffast-math</code> in your regular build, maybe you'll get an idea for a safe change you can make in the source to allow the same optimization without <code>-ffast-math</code>.</p>
</li>
<li><p><strong><code>-O3 -fno-tree-vectorize</code> will optimize without auto-vectorizing</strong>, so you can get full optimization without if you want to compare with <code>-O2</code> (which doesn't enable autovectorization on gcc11 and earlier, but does on all clang).</p>
<p><strong><code>-Os</code> (optimize for size and speed) can be helpful</strong> to keep the code more compact, which means less code to understand.    clang's <code>-Oz</code> optimizes for size even when it hurts speed, even using <code>push 1</code> / <code>pop rax</code> instead of <code>mov eax, 1</code>, so that's only interesting for <a href="https://codegolf.stackexchange.com/questions/132981/tips-for-golfing-in-x86-x64-machine-code">code golf</a>.</p>
<p>Even <code>-Og</code> (minimal optimization) might be what you want to look at, depending on your goals.  <code>-O0</code> is full of store/reload noise, which makes it harder to follow, <a href="https://stackoverflow.com/questions/53366394/why-does-clang-produce-inefficient-asm-with-o0-for-this-simple-floating-point">unless you use <code>register</code> vars</a>.  The only upside is that each C statement compiles to a separate block of instructions, and it makes <code>-fverbose-asm</code> able to use the actual C var names.</p>
</li>
<li><p>clang unrolls loops by default, so <strong><code>-fno-unroll-loops</code> can be useful in complex functions</strong>.  You can get a sense of "what the compiler did" without having to wade through the unrolled loops.  (gcc enables <code>-funroll-loops</code> with <code>-fprofile-use</code>, but not with <code>-O3</code>).  (This is a suggestion for human-readable code, not for code that would run faster.)</p>
</li>
<li><p><strong>Definitely enable some level of optimization, unless you specifically want to know what <code>-O0</code> did</strong>.  Its "predictable debug behaviour" requirement makes the compiler store/reload everything between every C statement, so you can modify C variables with a debugger and even "jump" to a different source line within the same function, and have execution continue as if you did that in the C source.  <code>-O0</code> output is so noisy with stores/reloads (and so slow) not just from lack of optimization, but <a href="https://stackoverflow.com/questions/53366394/why-does-clang-produce-inefficient-asm-with-o0-for-this-simple-floating-point">forced de-optimization to support debugging</a>.  (also <a href="https://stackoverflow.com/questions/46638527/when-will-the-trivial-code-that-has-no-effect-code-gets-removed-in-compilation/46640101#46640101">related</a>).</p>
</li>
</ul>
<hr>
<p><strong>To get a mix of source and asm</strong>, use <a href="https://stackoverflow.com/a/137479/224132"><code>gcc -Wa,-adhln -c -g foo.c | less</code></a> to pass extra options to <code>as</code>.  (More discussion of this in <a href="http://www.systutorials.com/240/generate-a-mixed-source-and-assembly-listing-using-gcc/" rel="noreferrer">a blog post</a>, and <a href="https://panthema.net/2013/0124-GCC-Output-Assembler-Code/" rel="noreferrer">another blog</a>.).  Note that the output of this isn't valid assembler input, because the C source is there directly, not as an assembler comment.  So don't call it a <code>.s</code>.  A <code>.lst</code> might make sense if you want to save it to a file.</p>
<p>Godbolt's color highlighting serves a similar purpose, and is great at helping you see when multiple <em>non-contiguous</em> asm instructions come from the same source line.  I haven't used that gcc listing command at all, so IDK how well it does, and how easy it is for the eye to see, in that case.</p>
<p>I like the high code density of godbolt's asm pane, so I don't think I'd like having source lines mixed in.  At least not for simple functions.  Maybe with a function that was too complex to get a handle on the overall structure of what the asm does...</p>
<hr>
<p>And remember, when you want to just look at the asm, <strong>leave out the <code>main()</code> and the compile-time constants</strong>.  You want to see the code for dealing with a function arg in a register, not for the code after constant-propagation turns it into <code>return 42</code>, or at least optimizes away some stuff.</p>
<p>Removing <code>static</code> and/or <code>inline</code> from functions will produce a stand-alone definition for them, as well as a definition for any callers, so you can just look at that.</p>
<p><strong>Don't put your code in a function called <code>main()</code></strong>.  gcc knows that <code>main</code> is special and assumes it will only be called once, so it marks it as "cold" and optimizes it less.</p>
<hr>
<p>The other thing you can do: If you did make a <code>main()</code>, you can run it and use a debugger.  <code>stepi</code> (<code>si</code>) steps by instruction.  See the bottom of the <a href="/questions/tagged/x86" class="post-tag" title="show questions tagged 'x86'" rel="tag">x86</a> <a href="https://stackoverflow.com/tags/x86/info">tag wiki</a> for instructions.  But remember that code might optimize away after inlining into main with compile-time-constant args.</p>
<p><code>__attribute__((noinline))</code> may help, on a function that you want to not be inlined.  gcc will also make constant-propagation clones of functions, i.e. a special version with one of the args as a constant, for call-sites that know they're passing a constant.  The symbol name will be <code>.clone.foo.constprop_1234</code> or something in the asm output. You can use <code>__attribute__((noclone))</code> to disable that, too.).</p>
<hr>
<h2>For example</h2>
<p>If you want to see how the compiler multiplies two integers:  I put the following code <a href="http://gcc.godbolt.org/#compilers:!((compiler:g530,options:%27-xc+-std%3Dgnu11+-Wall+-Wextra++-O3+-fverbose-asm+-ffast-math+-march%3Dhaswell%27,source:%27int+constants()+%7B+int+a+%3D+10,+b+%3D+20%3B+return+a+*+b%3B+%7D%0Aint+variables(int+a,+int+b)+%7B+return+a+*+b%3B+%7D%0A%27)),filterAsm:(commentOnly:!t,directives:!t,intel:!t,labels:!t),version:3" rel="noreferrer">on the Godbolt compiler explorer</a> to get the asm (from <code>gcc -O3 -march=haswell -fverbose-asm</code>) for the wrong way and the right way to test this.</p>
<pre class="default s-code-block"><code class="hljs language-csharp"><span class="hljs-comment">// the wrong way, which people often write when they're used to creating a runnable test-case with a main() and a printf</span>
<span class="hljs-comment">// or worse, people will actually look at the asm for such a main()</span>
<span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">constants</span>()</span> { <span class="hljs-built_in">int</span> a = <span class="hljs-number">10</span>, b = <span class="hljs-number">20</span>; <span class="hljs-keyword">return</span> a * b; }
    mov     eax, <span class="hljs-number">200</span>  <span class="hljs-meta">#,</span>
    ret                     <span class="hljs-meta"># compiles the same as  return 200;  not interesting</span>

<span class="hljs-comment">// the right way: compiler doesn't know anything about the inputs</span>
<span class="hljs-comment">// so we get asm like what would happen when this inlines into a bigger function.</span>
<span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">variables</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> a, <span class="hljs-built_in">int</span> b</span>)</span> { <span class="hljs-keyword">return</span> a * b; }
    mov     eax, edi  <span class="hljs-meta"># D.2345, a</span>
    imul    eax, esi        <span class="hljs-meta"># D.2345, b</span>
    ret
</code></pre>
<p>(This mix of asm and C was hand-crafted by copy-pasting the asm output from godbolt into the right place.  I find it's a good way to show how a short function compiles in SO answers / compiler bug reports / emails.)</p>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/assembly">assembly</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/clang">clang</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/compiler-optimization">compiler-optimization</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You can always look at the generated assembly from the object file, instead of using the compilers assembly output. <code>objdump</code> comes to mind.</p>

<p>You can even tell <code>objdump</code> to intermix source with assembly, making it easier to figure out what source line corresponds to what instructions. Example session:</p>

<pre class="default s-code-block"><code class="hljs language-csharp">$ cat test.<span class="hljs-function">cc
<span class="hljs-built_in">int</span> <span class="hljs-title">foo</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> arg</span>)</span>
{
    <span class="hljs-keyword">return</span> arg * <span class="hljs-number">42</span>;
}

$ g++ -g -O3 -std=c++<span class="hljs-number">14</span> -c test.cc -o test.o &amp;&amp; objdump -dS -M intel test.o

test.o:     file format elf64-x86<span class="hljs-number">-64</span>


Disassembly of section .text:

<span class="hljs-number">0000000000000000</span> &lt;_Z3fooi&gt;:
<span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">foo</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> arg</span>)</span>
{
    <span class="hljs-keyword">return</span> arg + <span class="hljs-number">1</span>;
   <span class="hljs-number">0</span>:   <span class="hljs-number">8</span>d <span class="hljs-number">47</span> <span class="hljs-number">01</span>                lea    eax,[rdi+<span class="hljs-number">0x1</span>]
}
   <span class="hljs-number">3</span>:   c3                      ret    
</code></pre>

<p>Explanation of <code>objdump</code> flags:</p>

<ul>
<li><code>-d</code> disassembles all executable sections</li>
<li><code>-S</code> intermixes assembly with source (<code>-g</code> required while compiling with <code>g++</code>)</li>
<li><code>-M intel</code> choses intel syntax over ugly AT&amp;T syntax (<em>optional</em>)</li>
</ul>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/assembly">assembly</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/clang">clang</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/compiler-optimization">compiler-optimization</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I like to insert labels that I can easily grep out of the objdump output.</p>

<pre class="default s-code-block"><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span> <span class="hljs-params">(<span class="hljs-string">"interesting_part_begin%=:"</span>:)</span></span>;
    <span class="hljs-built_in">do_something</span>();
    <span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span> <span class="hljs-params">(<span class="hljs-string">"interesting_part_end%=:"</span>:)</span></span>;
}
</code></pre>

<p>I haven't had a problem with this yet, but <code>asm volatile</code> can be very hard on a compiler's optimizer because it tends to leave such code untouched.</p>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/how-can-i-tell-if-a-dom-element-is-visible-in-the-current-viewport-1657388316510">How can I tell if a DOM element is visible in the current viewport?</a><a href="/questions/storing-images-in-db-yea-or-nay-1657387248067">Storing Images in DB - Yea or Nay?</a><a href="/questions/how-can-i-convert-ereg-expressions-to-preg-in-php-1657387652855">How can I convert ereg expressions to preg in PHP?</a><a href="/questions/strange-result-when-removing-item-from-a-list-while-iterating-over-it-duplicate-1657387735759">Strange result when removing item from a list while iterating over it [duplicate]</a><a href="/questions/what-is-the-javascript-version-of-sleep()-1657387391406">What is the JavaScript version of sleep()?</a><a href="/questions/cross-thread-operation-not-valid:-control-accessed-from-a-thread-other-than-the-thread-it-was-created-on-1657387659019">Cross-thread operation not valid: Control accessed from a thread other than the thread it was created on</a><a href="/questions/correctly-allocating-multi-dimensional-arrays-1657387733756">Correctly allocating multi-dimensional arrays</a><a href="/questions/how-do-you-remove-duplicates-from-a-list-whilst-preserving-order-1657387877978">How do you remove duplicates from a list whilst preserving order?</a><a href="/questions/what-is-the-difference-between-single-quoted-and-double-quoted-strings-in-php-1657384624345">What is the difference between single-quoted and double-quoted strings in PHP?</a><a href="/questions/what-is-the-purpose-of-the-var-keyword-and-when-should-i-use-it-(or-omit-it)-1657387525538">What is the purpose of the var keyword and when should I use it (or omit it)?</a><a href="/questions/http-get-with-request-body-1657387379038">HTTP GET with request body</a><a href="/questions/official-locator-strategies-for-the-webdriver-1657384353174">Official locator strategies for the webdriver</a><a href="/questions/how-to-print-without-a-newline-or-space-1657387814213">How to print without a newline or space</a><a href="/questions/commandbuttoncommandlinkajax-actionlistener-method-not-invoked-or-input-value-not-setupdated-1657384667519">commandButton/commandLink/ajax action/listener method not invoked or input value not set/updated</a><a href="/questions/how-to-add-jtable-in-jpanel-with-null-layout-1657384590912">How to add JTable in JPanel with null layout?</a><a href="/questions/how-do-i-match-any-character-across-multiple-lines-in-a-regular-expression-1657387839720">How do I match any character across multiple lines in a regular expression?</a><a href="/questions/why-is-iostream::eof-inside-a-loop-condition-(i.e.-while-(!stream.eof()))-considered-wrong-1657384355427">Why is iostream::eof inside a loop condition (i.e. `while (!stream.eof())`) considered wrong?</a><a href="/questions/of-the-many-findelement(s)by-functions-in-selenium-when-would-you-use-one-over-the-other-1657388412658">Of the many findElement(s)/By functions in Selenium, when would you use one over the other?</a><a href="/questions/retrieve-only-the-queried-element-in-an-object-array-in-mongodb-collection-1657384890457">Retrieve only the queried element in an object array in MongoDB collection</a><a href="/questions/how-do-i-expire-a-php-session-after-30-minutes-1657387990658">How do I expire a PHP session after 30 minutes?</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;Stripping out the \u0026lt;code\u0026gt;.cfi\u0026lt;/code\u0026gt; directives, unused labels, and comment lines is a solved problem: the scripts behind \u0026lt;a href=\u0026quot;http://gcc.godbolt.org/#compilers:!((compiler:g530,options:%27-std%3Dgnu%2B%2B14+-Wall+-Wextra++-O3+-fno-verbose-asm+-ffast-math+-march%3Dhaswell%27,source:%27%23include+%3Cboost/variant.hpp%3E%0A%0Astruct+Foo%0A%7B%0A++++int+get()+%7B+return+100%3B+%7D%0A%7D%3B%0A%0Astruct+Bar%0A%7B%0A++++int+get()+%7B+return+999%3B+%7D%0A%7D%3B%0A%0Ausing+Variant+%3D+boost::variant%3CFoo,+Bar%3E%3B%0A%0A%0Aint+run(Variant+v)%0A%7B%0A++++return+boost::apply_visitor(%5B%5D(auto%26+x)%7Breturn+x.get()%3B%7D,+v)%3B%0A%7D%0Aint+main()%0A%7B%0A++++Foo+f%3B%0A++++return+run(f)%3B%0A%7D%0A%27)),filterAsm:(commentOnly:!t,directives:!t,intel:!t,labels:!t),version:3\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Matt Godbolt\u0026apos;s compiler explorer\u0026lt;/a\u0026gt; are open source on \u0026lt;a href=\u0026quot;https://github.com/mattgodbolt/gcc-explorer\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;its github project\u0026lt;/a\u0026gt;.  It can even do colour highlighting to match source lines to asm lines (using the debug info).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;You can set it up locally so you can feed it files that are part of your project with all the \u0026lt;code\u0026gt;#include\u0026lt;/code\u0026gt; paths and so on (using \u0026lt;code\u0026gt;-I/...\u0026lt;/code\u0026gt;).  And so you can use it on private source code that you don\u0026apos;t want to send out over the Internet.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Matt Godbolt\u0026apos;s CppCon2017 talk \u0026lt;a href=\u0026quot;https://youtu.be/bSkpMdDe4g4\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;What Has My Compiler Done for Me Lately? Unbolting the Compiler\u0026apos;s Lid\u0026lt;/a\u0026gt; shows how to use it\u0026lt;/strong\u0026gt; (it\u0026apos;s pretty self-explanatory but has some neat features if you read the docs on github), and also \u0026lt;strong\u0026gt;how to read x86 asm\u0026lt;/strong\u0026gt;, with a gentle introduction to x86 asm itself for total beginners, and to looking at compiler output.  He goes on to show some neat compiler optimizations (e.g. for dividing by a constant), and what kind of functions give useful asm output for looking at optimized compiler output (function args, not \u0026lt;code\u0026gt;int a = 123;\u0026lt;/code\u0026gt;).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;On the Godbolt compiler explorer, it can be useful to use \u0026lt;code\u0026gt;-g0 -fno-asynchronous-unwind-tables\u0026lt;/code\u0026gt; if you want to uncheck the filter option for directives, e.g. because you want to see the \u0026lt;code\u0026gt;.section\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;.p2align\u0026lt;/code\u0026gt; stuff in the compiler output.  The default is to add \u0026lt;code\u0026gt;-g\u0026lt;/code\u0026gt; to your options to get the debug info it uses to colour-highlight matching source and asm lines, but this means \u0026lt;code\u0026gt;.cfi\u0026lt;/code\u0026gt; directives for every stack operation, and \u0026lt;code\u0026gt;.loc\u0026lt;/code\u0026gt; for every source line, among other things.\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;With plain gcc/clang (not g++), \u0026lt;code\u0026gt;-fno-asynchronous-unwind-tables\u0026lt;/code\u0026gt; avoids \u0026lt;code\u0026gt;.cfi\u0026lt;/code\u0026gt; directives.  Possibly also useful: \u0026lt;code\u0026gt;-fno-exceptions -fno-rtti\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;-masm=intel\u0026lt;/code\u0026gt;.  Make sure to omit \u0026lt;code\u0026gt;-g\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Copy/paste this for local use\u0026lt;/strong\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;g++ -fno-asynchronous-unwind-tables -fno-exceptions -fno-rtti -fverbose-\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;asm\u0026lt;/span\u0026gt; \\\n    -Wall -Wextra  foo.cpp   -O3 -masm=intel -S -o- | less\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Or \u0026lt;code\u0026gt;-Os\u0026lt;/code\u0026gt; can be more readable, e.g. using \u0026lt;code\u0026gt;div\u0026lt;/code\u0026gt; for division by non-power-of-2 constants instead of a multiplicative inverse even though that\u0026apos;s a lot worse for performance and only a bit smaller, if at all.\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;But really, I\u0026apos;d recommend just using Godbolt directly (online or set it up locally)!  You can quickly flip between versions of gcc and clang to see if old or new compilers do something dumb.  (Or what ICC does, or even what MSVC does.)  There\u0026apos;s even ARM / ARM64 gcc 6.3, and various gcc for PowerPC, MIPS, AVR, MSP430.  (It can be interesting to see what happens on a machine where \u0026lt;code\u0026gt;int\u0026lt;/code\u0026gt; is wider than a register, or isn\u0026apos;t 32-bit.  Or on a RISC vs. x86).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For C instead of C++, you can use \u0026lt;code\u0026gt;-xc -std=gnu11\u0026lt;/code\u0026gt; to avoid flipping the language drop-down to C, which resets your source pane and compiler choices, and has a different set of compilers available.\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Useful compiler options for making asm for human consumption\u0026lt;/strong\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Remember, your code only has to compile, not link: passing a pointer to an external function like \u0026lt;code\u0026gt;void ext(void*p)\u0026lt;/code\u0026gt; is a good way to stop something from optimizing away\u0026lt;/strong\u0026gt;.  You only need a prototype for it, with no definition so the compiler can\u0026apos;t inline it or make any assumptions about what it does.  (Or \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/40122141/preventing-compiler-optimizations-while-benchmarking\u0026quot;\u0026gt;inline asm like \u0026lt;code\u0026gt;Benchmark::DoNotOptimize\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; can force a compiler to materialize a value in a register, or forget about it being a known constant, if you know GNU C inline asm syntax well enough to use constraints to understand the effect you\u0026apos;re having on what you\u0026apos;re requiring of the compiler.)\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;I\u0026apos;d recommend using \u0026lt;code\u0026gt;-O3 -Wall -Wextra -fverbose-asm -march=haswell\u0026lt;/code\u0026gt; for looking at code.  (\u0026lt;code\u0026gt;-fverbose-asm\u0026lt;/code\u0026gt; can just make the source look noisy, though, when all you get are numbered temporaries as names for the operands.)  When you\u0026apos;re fiddling with the source to see how it changes the asm, you \u0026lt;em\u0026gt;definitely\u0026lt;/em\u0026gt; want compiler warnings enabled.  You don\u0026apos;t want to waste time scratching your head over the asm when the explanation is that you did something that deserves a warning in the source.\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;To see how the calling convention works, \u0026lt;strong\u0026gt;you often want to look at caller and callee without inlining\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;You can use \u0026lt;code\u0026gt;__attribute__((noipa)) foo_t foo(bar_t x) { ... }\u0026lt;/code\u0026gt; on a definition, or compile with \u0026lt;code\u0026gt;gcc -O3 -fno-inline-functions -fno-inline-functions-called-once -fno-inline-small-functions\u0026lt;/code\u0026gt; to disable inlining.  (But those command line options don\u0026apos;t disable cloning a function for constant-propagation.  \u0026lt;code\u0026gt;noipa\u0026lt;/code\u0026gt; = no Inter-Procedural Analysis.  It\u0026apos;s even stronger than \u0026lt;code\u0026gt;__attribute__((noinline,noclone))\u0026lt;/code\u0026gt;.)  See \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/50775127/from-compiler-perspective-how-is-reference-for-array-dealt-with-and-why-passi\u0026quot;\u0026gt;From compiler perspective, how is reference for array dealt with, and, why passing by value(not decay) is not allowed?\u0026lt;/a\u0026gt; for an example.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Or if you just want to see how functions pass / receive args of different types, you could use different names but the same prototype so the compiler doesn\u0026apos;t have a definition to inline.  This works with any compiler.  Without a definition, a function is just a black box to the optimizer, governed only by the calling convention / ABI.\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;-ffast-math\u0026lt;/code\u0026gt; will get many libm functions to inline, some to a single instruction (esp. with SSE4 available for \u0026lt;code\u0026gt;roundsd\u0026lt;/code\u0026gt;).  Some will inline with just \u0026lt;code\u0026gt;-fno-math-errno\u0026lt;/code\u0026gt;, or other \u0026quot;safer\u0026quot; parts of \u0026lt;code\u0026gt;-ffast-math\u0026lt;/code\u0026gt;, without the parts that allow the compiler to round differently.  If you have FP code, definitely look at it with/without \u0026lt;code\u0026gt;-ffast-math\u0026lt;/code\u0026gt;.  If you can\u0026apos;t safely enable any of \u0026lt;code\u0026gt;-ffast-math\u0026lt;/code\u0026gt; in your regular build, maybe you\u0026apos;ll get an idea for a safe change you can make in the source to allow the same optimization without \u0026lt;code\u0026gt;-ffast-math\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;code\u0026gt;-O3 -fno-tree-vectorize\u0026lt;/code\u0026gt; will optimize without auto-vectorizing\u0026lt;/strong\u0026gt;, so you can get full optimization without if you want to compare with \u0026lt;code\u0026gt;-O2\u0026lt;/code\u0026gt; (which doesn\u0026apos;t enable autovectorization on gcc11 and earlier, but does on all clang).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;code\u0026gt;-Os\u0026lt;/code\u0026gt; (optimize for size and speed) can be helpful\u0026lt;/strong\u0026gt; to keep the code more compact, which means less code to understand.    clang\u0026apos;s \u0026lt;code\u0026gt;-Oz\u0026lt;/code\u0026gt; optimizes for size even when it hurts speed, even using \u0026lt;code\u0026gt;push 1\u0026lt;/code\u0026gt; / \u0026lt;code\u0026gt;pop rax\u0026lt;/code\u0026gt; instead of \u0026lt;code\u0026gt;mov eax, 1\u0026lt;/code\u0026gt;, so that\u0026apos;s only interesting for \u0026lt;a href=\u0026quot;https://codegolf.stackexchange.com/questions/132981/tips-for-golfing-in-x86-x64-machine-code\u0026quot;\u0026gt;code golf\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Even \u0026lt;code\u0026gt;-Og\u0026lt;/code\u0026gt; (minimal optimization) might be what you want to look at, depending on your goals.  \u0026lt;code\u0026gt;-O0\u0026lt;/code\u0026gt; is full of store/reload noise, which makes it harder to follow, \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/53366394/why-does-clang-produce-inefficient-asm-with-o0-for-this-simple-floating-point\u0026quot;\u0026gt;unless you use \u0026lt;code\u0026gt;register\u0026lt;/code\u0026gt; vars\u0026lt;/a\u0026gt;.  The only upside is that each C statement compiles to a separate block of instructions, and it makes \u0026lt;code\u0026gt;-fverbose-asm\u0026lt;/code\u0026gt; able to use the actual C var names.\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;clang unrolls loops by default, so \u0026lt;strong\u0026gt;\u0026lt;code\u0026gt;-fno-unroll-loops\u0026lt;/code\u0026gt; can be useful in complex functions\u0026lt;/strong\u0026gt;.  You can get a sense of \u0026quot;what the compiler did\u0026quot; without having to wade through the unrolled loops.  (gcc enables \u0026lt;code\u0026gt;-funroll-loops\u0026lt;/code\u0026gt; with \u0026lt;code\u0026gt;-fprofile-use\u0026lt;/code\u0026gt;, but not with \u0026lt;code\u0026gt;-O3\u0026lt;/code\u0026gt;).  (This is a suggestion for human-readable code, not for code that would run faster.)\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Definitely enable some level of optimization, unless you specifically want to know what \u0026lt;code\u0026gt;-O0\u0026lt;/code\u0026gt; did\u0026lt;/strong\u0026gt;.  Its \u0026quot;predictable debug behaviour\u0026quot; requirement makes the compiler store/reload everything between every C statement, so you can modify C variables with a debugger and even \u0026quot;jump\u0026quot; to a different source line within the same function, and have execution continue as if you did that in the C source.  \u0026lt;code\u0026gt;-O0\u0026lt;/code\u0026gt; output is so noisy with stores/reloads (and so slow) not just from lack of optimization, but \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/53366394/why-does-clang-produce-inefficient-asm-with-o0-for-this-simple-floating-point\u0026quot;\u0026gt;forced de-optimization to support debugging\u0026lt;/a\u0026gt;.  (also \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/46638527/when-will-the-trivial-code-that-has-no-effect-code-gets-removed-in-compilation/46640101#46640101\u0026quot;\u0026gt;related\u0026lt;/a\u0026gt;).\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;To get a mix of source and asm\u0026lt;/strong\u0026gt;, use \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/137479/224132\u0026quot;\u0026gt;\u0026lt;code\u0026gt;gcc -Wa,-adhln -c -g foo.c | less\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; to pass extra options to \u0026lt;code\u0026gt;as\u0026lt;/code\u0026gt;.  (More discussion of this in \u0026lt;a href=\u0026quot;http://www.systutorials.com/240/generate-a-mixed-source-and-assembly-listing-using-gcc/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;a blog post\u0026lt;/a\u0026gt;, and \u0026lt;a href=\u0026quot;https://panthema.net/2013/0124-GCC-Output-Assembler-Code/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;another blog\u0026lt;/a\u0026gt;.).  Note that the output of this isn\u0026apos;t valid assembler input, because the C source is there directly, not as an assembler comment.  So don\u0026apos;t call it a \u0026lt;code\u0026gt;.s\u0026lt;/code\u0026gt;.  A \u0026lt;code\u0026gt;.lst\u0026lt;/code\u0026gt; might make sense if you want to save it to a file.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Godbolt\u0026apos;s color highlighting serves a similar purpose, and is great at helping you see when multiple \u0026lt;em\u0026gt;non-contiguous\u0026lt;/em\u0026gt; asm instructions come from the same source line.  I haven\u0026apos;t used that gcc listing command at all, so IDK how well it does, and how easy it is for the eye to see, in that case.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I like the high code density of godbolt\u0026apos;s asm pane, so I don\u0026apos;t think I\u0026apos;d like having source lines mixed in.  At least not for simple functions.  Maybe with a function that was too complex to get a handle on the overall structure of what the asm does...\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;And remember, when you want to just look at the asm, \u0026lt;strong\u0026gt;leave out the \u0026lt;code\u0026gt;main()\u0026lt;/code\u0026gt; and the compile-time constants\u0026lt;/strong\u0026gt;.  You want to see the code for dealing with a function arg in a register, not for the code after constant-propagation turns it into \u0026lt;code\u0026gt;return 42\u0026lt;/code\u0026gt;, or at least optimizes away some stuff.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Removing \u0026lt;code\u0026gt;static\u0026lt;/code\u0026gt; and/or \u0026lt;code\u0026gt;inline\u0026lt;/code\u0026gt; from functions will produce a stand-alone definition for them, as well as a definition for any callers, so you can just look at that.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Don\u0026apos;t put your code in a function called \u0026lt;code\u0026gt;main()\u0026lt;/code\u0026gt;\u0026lt;/strong\u0026gt;.  gcc knows that \u0026lt;code\u0026gt;main\u0026lt;/code\u0026gt; is special and assumes it will only be called once, so it marks it as \u0026quot;cold\u0026quot; and optimizes it less.\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;The other thing you can do: If you did make a \u0026lt;code\u0026gt;main()\u0026lt;/code\u0026gt;, you can run it and use a debugger.  \u0026lt;code\u0026gt;stepi\u0026lt;/code\u0026gt; (\u0026lt;code\u0026gt;si\u0026lt;/code\u0026gt;) steps by instruction.  See the bottom of the \u0026lt;a href=\u0026quot;/questions/tagged/x86\u0026quot; class=\u0026quot;post-tag\u0026quot; title=\u0026quot;show questions tagged \u0026apos;x86\u0026apos;\u0026quot; rel=\u0026quot;tag\u0026quot;\u0026gt;x86\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026quot;https://stackoverflow.com/tags/x86/info\u0026quot;\u0026gt;tag wiki\u0026lt;/a\u0026gt; for instructions.  But remember that code might optimize away after inlining into main with compile-time-constant args.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;__attribute__((noinline))\u0026lt;/code\u0026gt; may help, on a function that you want to not be inlined.  gcc will also make constant-propagation clones of functions, i.e. a special version with one of the args as a constant, for call-sites that know they\u0026apos;re passing a constant.  The symbol name will be \u0026lt;code\u0026gt;.clone.foo.constprop_1234\u0026lt;/code\u0026gt; or something in the asm output. You can use \u0026lt;code\u0026gt;__attribute__((noclone))\u0026lt;/code\u0026gt; to disable that, too.).\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;h2\u0026gt;For example\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;If you want to see how the compiler multiplies two integers:  I put the following code \u0026lt;a href=\u0026quot;http://gcc.godbolt.org/#compilers:!((compiler:g530,options:%27-xc+-std%3Dgnu11+-Wall+-Wextra++-O3+-fverbose-asm+-ffast-math+-march%3Dhaswell%27,source:%27int+constants()+%7B+int+a+%3D+10,+b+%3D+20%3B+return+a+*+b%3B+%7D%0Aint+variables(int+a,+int+b)+%7B+return+a+*+b%3B+%7D%0A%27)),filterAsm:(commentOnly:!t,directives:!t,intel:!t,labels:!t),version:3\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;on the Godbolt compiler explorer\u0026lt;/a\u0026gt; to get the asm (from \u0026lt;code\u0026gt;gcc -O3 -march=haswell -fverbose-asm\u0026lt;/code\u0026gt;) for the wrong way and the right way to test this.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-csharp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// the wrong way, which people often write when they\u0026apos;re used to creating a runnable test-case with a main() and a printf\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// or worse, people will actually look at the asm for such a main()\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;constants\u0026lt;/span\u0026gt;()\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; a = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;, b = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; a * b; }\n    mov     eax, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;200\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;#,\u0026lt;/span\u0026gt;\n    ret                     \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# compiles the same as  return 200;  not interesting\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// the right way: compiler doesn\u0026apos;t know anything about the inputs\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// so we get asm like what would happen when this inlines into a bigger function.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;variables\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; a, \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; b\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; a * b; }\n    mov     eax, edi  \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# D.2345, a\u0026lt;/span\u0026gt;\n    imul    eax, esi        \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# D.2345, b\u0026lt;/span\u0026gt;\n    ret\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;(This mix of asm and C was hand-crafted by copy-pasting the asm output from godbolt into the right place.  I find it\u0026apos;s a good way to show how a short function compiles in SO answers / compiler bug reports / emails.)\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;You can always look at the generated assembly from the object file, instead of using the compilers assembly output. \u0026lt;code\u0026gt;objdump\u0026lt;/code\u0026gt; comes to mind.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You can even tell \u0026lt;code\u0026gt;objdump\u0026lt;/code\u0026gt; to intermix source with assembly, making it easier to figure out what source line corresponds to what instructions. Example session:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-csharp\u0026quot;\u0026gt;$ cat test.\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;cc\n\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; arg\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt;\n{\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; arg * \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;42\u0026lt;/span\u0026gt;;\n}\n\n$ g++ -g -O3 -std=c++\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;14\u0026lt;/span\u0026gt; -c test.cc -o test.o \u0026amp;amp;\u0026amp;amp; objdump -dS -M intel test.o\n\ntest.o:     file format elf64-x86\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-64\u0026lt;/span\u0026gt;\n\n\nDisassembly of section .text:\n\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0000000000000000\u0026lt;/span\u0026gt; \u0026amp;lt;_Z3fooi\u0026amp;gt;:\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; arg\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt;\n{\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; arg + \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;;\n   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;:   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8\u0026lt;/span\u0026gt;d \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;47\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;01\u0026lt;/span\u0026gt;                lea    eax,[rdi+\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0x1\u0026lt;/span\u0026gt;]\n}\n   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;:   c3                      ret    \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Explanation of \u0026lt;code\u0026gt;objdump\u0026lt;/code\u0026gt; flags:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;-d\u0026lt;/code\u0026gt; disassembles all executable sections\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;-S\u0026lt;/code\u0026gt; intermixes assembly with source (\u0026lt;code\u0026gt;-g\u0026lt;/code\u0026gt; required while compiling with \u0026lt;code\u0026gt;g++\u0026lt;/code\u0026gt;)\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;-M intel\u0026lt;/code\u0026gt; choses intel syntax over ugly AT\u0026amp;amp;T syntax (\u0026lt;em\u0026gt;optional\u0026lt;/em\u0026gt;)\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I like to insert labels that I can easily grep out of the objdump output.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;asm\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;volatile\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;interesting_part_begin%=:\u0026quot;\u0026lt;/span\u0026gt;:)\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;do_something\u0026lt;/span\u0026gt;();\n    \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;asm\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;volatile\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;interesting_part_end%=:\u0026quot;\u0026lt;/span\u0026gt;:)\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;I haven\u0026apos;t had a problem with this yet, but \u0026lt;code\u0026gt;asm volatile\u0026lt;/code\u0026gt; can be very hard on a compiler\u0026apos;s optimizer because it tends to leave such code untouched.\u0026lt;/p\u0026gt;\n    "],"id":317,"title":"How to remove \"noise\" from GCC/clang assembly output?","content":"\n                \n\u0026lt;p\u0026gt;I want to inspect the assembly output of applying \u0026lt;code\u0026gt;boost::variant\u0026lt;/code\u0026gt; in my code in order to see which intermediate calls are optimized away.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;When I compile the following example (with GCC 5.3 using \u0026lt;code\u0026gt;g++ -O3 -std=c++14 -S\u0026lt;/code\u0026gt;), it seems as if the compiler optimizes away everything and directly returns 100:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-makefile\u0026quot;\u0026gt;(...)\n\u0026lt;span class=\u0026quot;hljs-section\u0026quot;\u0026gt;main:\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-section\u0026quot;\u0026gt;.LFB9320:\u0026lt;/span\u0026gt;\n    .cfi_startproc\n    movl    $100, %eax\n    ret\n    .cfi_endproc\n(...)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;#\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;include\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026amp;lt;boost/variant.hpp\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;struct\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Foo\u0026lt;/span\u0026gt;\n{\n    \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;get\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{ \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;; }\n};\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;struct\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Bar\u0026lt;/span\u0026gt;\n{\n    \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;get\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{ \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;999\u0026lt;/span\u0026gt;; }\n};\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; Variant = boost::variant\u0026amp;lt;Foo, Bar\u0026amp;gt;;\n\n\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;run\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;(Variant v)\u0026lt;/span\u0026gt;\n\u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; boost::\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;apply_visitor\u0026lt;/span\u0026gt;([](\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;auto\u0026lt;/span\u0026gt;\u0026amp;amp; x){\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; x.\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;get\u0026lt;/span\u0026gt;();}, v);\n}\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt;\n\u0026lt;/span\u0026gt;{\n    Foo f;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;run\u0026lt;/span\u0026gt;(f);\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;However, the full assembly output contains much more than the above excerpt, which to me looks like it is never called. \u0026lt;strong\u0026gt;Is there a way to tell GCC/clang to remove all that \u0026quot;noise\u0026quot; and just output what is actually called when the program is ran?\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;full assembly output:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-perl\u0026quot;\u0026gt;    .file   \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;main1.cpp\u0026quot;\u0026lt;/span\u0026gt;\n    .section    .rodata.str1.\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;aMS\u0026quot;\u0026lt;/span\u0026gt;,@progbits,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n    .align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8\u0026lt;/span\u0026gt;\n.LC\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;:\n    .string \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;/opt/boost/include/boost/variant/detail/forced_return.hpp\u0026quot;\u0026lt;/span\u0026gt;\n    .section    .rodata.str1.\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;aMS\u0026quot;\u0026lt;/span\u0026gt;,@progbits,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n.LC1:\n    .string \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;false\u0026quot;\u0026lt;/span\u0026gt;\n    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIvEET_v,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;axG\u0026quot;\u0026lt;/span\u0026gt;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat\n.LCOLDB2:\n    .section    .text._ZN5boost6detail7variant13forced_returnIvEET_v,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;axG\u0026quot;\u0026lt;/span\u0026gt;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat\n.LHOTB2:\n    .p2align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;,,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;15\u0026lt;/span\u0026gt;\n    .weak   _ZN5boost6detail7variant13forced_returnIvEET_v\n    .type   _ZN5boost6detail7variant13forced_returnIvEET_v, @function\n_ZN5boost6detail7variant13forced_returnIvEET_v:\n.LFB1197:\n    .cfi_startproc\n    subq    $8, %rsp\n    .cfi_def_cfa_offset \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;16\u0026lt;/span\u0026gt;\n    movl    $_ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION__, %ecx\n    movl    $49, %edx\n    movl    $.LC\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, %esi\n    movl    $.LC1, %edi\n    call    __assert_fail\n    .cfi_endproc\n.LFE1197:\n    .size   _ZN5boost6detail7variant13forced_returnIvEET_v, .-_ZN5boost6detail7variant13forced_returnIvEET_v\n    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIvEET_v,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;axG\u0026quot;\u0026lt;/span\u0026gt;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat\n.LCOLDE2:\n    .section    .text._ZN5boost6detail7variant13forced_returnIvEET_v,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;axG\u0026quot;\u0026lt;/span\u0026gt;,@progbits,_ZN5boost6detail7variant13forced_returnIvEET_v,comdat\n.LHOTE2:\n    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIiEET_v,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;axG\u0026quot;\u0026lt;/span\u0026gt;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat\n.LCOLDB3:\n    .section    .text._ZN5boost6detail7variant13forced_returnIiEET_v,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;axG\u0026quot;\u0026lt;/span\u0026gt;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat\n.LHOTB3:\n    .p2align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;,,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;15\u0026lt;/span\u0026gt;\n    .weak   _ZN5boost6detail7variant13forced_returnIiEET_v\n    .type   _ZN5boost6detail7variant13forced_returnIiEET_v, @function\n_ZN5boost6detail7variant13forced_returnIiEET_v:\n.LFB9757:\n    .cfi_startproc\n    subq    $8, %rsp\n    .cfi_def_cfa_offset \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;16\u0026lt;/span\u0026gt;\n    movl    $_ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION__, %ecx\n    movl    $39, %edx\n    movl    $.LC\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, %esi\n    movl    $.LC1, %edi\n    call    __assert_fail\n    .cfi_endproc\n.LFE9757:\n    .size   _ZN5boost6detail7variant13forced_returnIiEET_v, .-_ZN5boost6detail7variant13forced_returnIiEET_v\n    .section    .text.unlikely._ZN5boost6detail7variant13forced_returnIiEET_v,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;axG\u0026quot;\u0026lt;/span\u0026gt;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat\n.LCOLDE3:\n    .section    .text._ZN5boost6detail7variant13forced_returnIiEET_v,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;axG\u0026quot;\u0026lt;/span\u0026gt;,@progbits,_ZN5boost6detail7variant13forced_returnIiEET_v,comdat\n.LHOTE3:\n    .section    .text.unlikely,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ax\u0026quot;\u0026lt;/span\u0026gt;,@progbits\n.LCOLDB4:\n    .text\n.LHOTB4:\n    .p2align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;,,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;15\u0026lt;/span\u0026gt;\n    .globl  _Z3runN5boost7variantI3FooJ3BarEEE\n    .type   _Z3runN5boost7variantI3FooJ3BarEEE, @function\n_Z3runN5boost7variantI3FooJ3BarEEE:\n.LFB931\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;:\n    .cfi_startproc\n    subq    $8, %rsp\n    .cfi_def_cfa_offset \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;16\u0026lt;/span\u0026gt;\n    movl    (%rdi), %eax\n    cltd\n    xorl    %edx, %eax\n    cmpl    $19, %eax\n    ja  .L7\n    jmp *.L9(,%rax,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8\u0026lt;/span\u0026gt;)\n    .section    .rodata\n    .align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8\u0026lt;/span\u0026gt;\n    .align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;\n.L9:\n    .quad   .L3\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n    .quad   .L1\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .quad   .L7\n    .text\n    .p2align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;,,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;\n    .p2align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;\n.L7:\n    call    _ZN5boost6detail7variant13forced_returnIiEET_v\n    .p2align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;,,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;\n    .p2align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;\n.L3\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;:\n    movl    $10\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, %eax\n.L8:\n    addq    $8, %rsp\n    .cfi_remember_state\n    .cfi_def_cfa_offset \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8\u0026lt;/span\u0026gt;\n    ret\n    .p2align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;,,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;\n    .p2align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;\n.L1\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;:\n    .cfi_restore_state\n    movl    $999, %eax\n    jmp .L8\n    .cfi_endproc\n.LFE931\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;:\n    .size   _Z3runN5boost7variantI3FooJ3BarEEE, .-_Z3runN5boost7variantI3FooJ3BarEEE\n    .section    .text.unlikely\n.LCOLDE4:\n    .text\n.LHOTE4:\n    .globl  _Z3runN5boost7variantI3FooI3BarEEE\n    .set    _Z3runN5boost7variantI3FooI3BarEEE,_Z3runN5boost7variantI3FooJ3BarEEE\n    .section    .text.unlikely\n.LCOLDB5:\n    .section    .text.startup,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ax\u0026quot;\u0026lt;/span\u0026gt;,@progbits\n.LHOTB5:\n    .p2align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;,,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;15\u0026lt;/span\u0026gt;\n    .globl  main\n    .type   main, @function\nmain:\n.LFB932\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;:\n    .cfi_startproc\n    movl    $10\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, %eax\n    ret\n    .cfi_endproc\n.LFE932\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;:\n    .size   main, .-main\n    .section    .text.unlikely\n.LCOLDE5:\n    .section    .text.startup\n.LHOTE5:\n    .section    .rodata\n    .align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;32\u0026lt;/span\u0026gt;\n    .type   _ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION_\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;_\u0026lt;/span\u0026gt;, @object\n    .size   _ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION_\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;_\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;58\u0026lt;/span\u0026gt;\n_ZZN5boost6detail7variant13forced_returnIvEET_vE19__PRETTY_FUNCTION_\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;_\u0026lt;/span\u0026gt;:\n    .string \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;T boost::detail::variant::forced_return() [with T = void]\u0026quot;\u0026lt;/span\u0026gt;\n    .align \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;32\u0026lt;/span\u0026gt;\n    .type   _ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION_\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;_\u0026lt;/span\u0026gt;, @object\n    .size   _ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION_\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;_\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;57\u0026lt;/span\u0026gt;\n_ZZN5boost6detail7variant13forced_returnIiEET_vE19__PRETTY_FUNCTION_\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;_\u0026lt;/span\u0026gt;:\n    .string \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;T boost::detail::variant::forced_return() [with T = int]\u0026quot;\u0026lt;/span\u0026gt;\n    .ident  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;GCC: (Ubuntu 5.3.0-3ubuntu1~14.04) 5.3.0 20151204\u0026quot;\u0026lt;/span\u0026gt;\n    .section    .note.GNU-stack,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026quot;\u0026lt;/span\u0026gt;,@progbits\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","slug":"how-to-remove-\"noise\"-from-gccclang-assembly-output-1657387612391","postType":"QUESTION","createdAt":"2022-07-09T17:26:52.000Z","updatedAt":"2022-07-09T17:26:52.000Z","tags":[{"id":1856,"name":"assembly","slug":"assembly","createdAt":"2022-07-09T17:26:52.000Z","updatedAt":"2022-07-09T17:26:52.000Z","Questions_Tags":{"questionId":317,"tagId":1856}},{"id":1858,"name":"clang","slug":"clang","createdAt":"2022-07-09T17:26:52.000Z","updatedAt":"2022-07-09T17:26:52.000Z","Questions_Tags":{"questionId":317,"tagId":1858}},{"id":1859,"name":"compiler-optimization","slug":"compiler-optimization","createdAt":"2022-07-09T17:26:52.000Z","updatedAt":"2022-07-09T17:26:52.000Z","Questions_Tags":{"questionId":317,"tagId":1859}}],"relatedQuestions":[{"title":"How to remove \"noise\" from GCC/clang assembly output?","slug":"how-to-remove-\"noise\"-from-gccclang-assembly-output-1657387612391","tags":[{"name":"assembly","Questions_Tags":{"questionId":317,"tagId":1856}},{"name":"clang","Questions_Tags":{"questionId":317,"tagId":1858}},{"name":"compiler-optimization","Questions_Tags":{"questionId":317,"tagId":1859}}]}]},"randomQuestions":[{"title":"How can I tell if a DOM element is visible in the current viewport?","slug":"how-can-i-tell-if-a-dom-element-is-visible-in-the-current-viewport-1657388316510"},{"title":"Storing Images in DB - Yea or Nay?","slug":"storing-images-in-db-yea-or-nay-1657387248067"},{"title":"How can I convert ereg expressions to preg in PHP?","slug":"how-can-i-convert-ereg-expressions-to-preg-in-php-1657387652855"},{"title":"Strange result when removing item from a list while iterating over it [duplicate]","slug":"strange-result-when-removing-item-from-a-list-while-iterating-over-it-duplicate-1657387735759"},{"title":"What is the JavaScript version of sleep()?","slug":"what-is-the-javascript-version-of-sleep()-1657387391406"},{"title":"Cross-thread operation not valid: Control accessed from a thread other than the thread it was created on","slug":"cross-thread-operation-not-valid:-control-accessed-from-a-thread-other-than-the-thread-it-was-created-on-1657387659019"},{"title":"Correctly allocating multi-dimensional arrays","slug":"correctly-allocating-multi-dimensional-arrays-1657387733756"},{"title":"How do you remove duplicates from a list whilst preserving order?","slug":"how-do-you-remove-duplicates-from-a-list-whilst-preserving-order-1657387877978"},{"title":"What is the difference between single-quoted and double-quoted strings in PHP?","slug":"what-is-the-difference-between-single-quoted-and-double-quoted-strings-in-php-1657384624345"},{"title":"What is the purpose of the var keyword and when should I use it (or omit it)?","slug":"what-is-the-purpose-of-the-var-keyword-and-when-should-i-use-it-(or-omit-it)-1657387525538"},{"title":"HTTP GET with request body","slug":"http-get-with-request-body-1657387379038"},{"title":"Official locator strategies for the webdriver","slug":"official-locator-strategies-for-the-webdriver-1657384353174"},{"title":"How to print without a newline or space","slug":"how-to-print-without-a-newline-or-space-1657387814213"},{"title":"commandButton/commandLink/ajax action/listener method not invoked or input value not set/updated","slug":"commandbuttoncommandlinkajax-actionlistener-method-not-invoked-or-input-value-not-setupdated-1657384667519"},{"title":"How to add JTable in JPanel with null layout?","slug":"how-to-add-jtable-in-jpanel-with-null-layout-1657384590912"},{"title":"How do I match any character across multiple lines in a regular expression?","slug":"how-do-i-match-any-character-across-multiple-lines-in-a-regular-expression-1657387839720"},{"title":"Why is iostream::eof inside a loop condition (i.e. `while (!stream.eof())`) considered wrong?","slug":"why-is-iostream::eof-inside-a-loop-condition-(i.e.-while-(!stream.eof()))-considered-wrong-1657384355427"},{"title":"Of the many findElement(s)/By functions in Selenium, when would you use one over the other?","slug":"of-the-many-findelement(s)by-functions-in-selenium-when-would-you-use-one-over-the-other-1657388412658"},{"title":"Retrieve only the queried element in an object array in MongoDB collection","slug":"retrieve-only-the-queried-element-in-an-object-array-in-mongodb-collection-1657384890457"},{"title":"How do I expire a PHP session after 30 minutes?","slug":"how-do-i-expire-a-php-session-after-30-minutes-1657387990658"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"how-to-remove-\"noise\"-from-gccclang-assembly-output-1657387612391"},"buildId":"TQ2eYlCSdocSK-hq6gkM0","isFallback":false,"gsp":true,"locale":"en","locales":["en"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>