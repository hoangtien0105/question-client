<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find solution for coding, HTML, CSS, JAVASCRIPT, MYSQL, PHP, PYTHON,... quickly. - solutionschecker.com"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><title>Convert Rows to columns using &#x27;Pivot&#x27; in SQL Server | Solutions Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="I have read the stuff on MS pivot tables and I am still having problems getting this correct.

I have a temp table that is being created, we will say that column 1 is a Store number, and column 2 is a week number and lastly column 3 is a total of some type. Also the Week numbers are dynamic, the store numbers are static.

Store      Week     xCount
-------    ----     ------
102        1        96
101        1        138
105        1        37
109        1        59
101        2        282
102        2        212
105        2        78
109        2        97
105        3        60
102        3        123
101        3        220
109        3        87


I would like it to come out as a pivot table, like this:

Store        1          2          3        4        5        6....
----- 
101        138        282        220
102         96        212        123
105         37        
109


Store numbers down the side and weeks across the top.
    "/><meta property="og:title" content="Convert Rows to columns using &#x27;Pivot&#x27; in SQL Server | Solutions Checker"/><meta property="og:description" content="I have read the stuff on MS pivot tables and I am still having problems getting this correct.

I have a temp table that is being created, we will say that column 1 is a Store number, and column 2 is a week number and lastly column 3 is a total of some type. Also the Week numbers are dynamic, the store numbers are static.

Store      Week     xCount
-------    ----     ------
102        1        96
101        1        138
105        1        37
109        1        59
101        2        282
102        2        212
105        2        78
109        2        97
105        3        60
102        3        123
101        3        220
109        3        87


I would like it to come out as a pivot table, like this:

Store        1          2          3        4        5        6....
----- 
101        138        282        220
102         96        212        123
105         37        
109


Store numbers down the side and weeks across the top.
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"Convert Rows to columns using &apos;Pivot&apos; in SQL Server","text":"I have read the stuff on MS pivot tables and I am still having problems getting this correct.\n\nI have a temp table that is being created, we will say that column 1 is a Store number, and column 2 is a week number and lastly column 3 is a total of some type. Also the Week numbers are dynamic, the store numbers are static.\n\nStore      Week     xCount\n-------    ----     ------\n102        1        96\n101        1        138\n105        1        37\n109        1        59\n101        2        282\n102        2        212\n105        2        78\n109        2        97\n105        3        60\n102        3        123\n101        3        220\n109        3        87\n\n\nI would like it to come out as a pivot table, like this:\n\nStore        1          2          3        4        5        6....\n----- \n101        138        282        220\n102         96        212        123\n105         37        \n109\n\n\nStore numbers down the side and weeks across the top.\n    ","answerCount":9,"upVoteCount":500,"suggestedAnswer":[{"text":"If you are using SQL Server 2005+, then you can use the PIVOT function to transform the data from rows into columns.\nIt sounds like you will need to use dynamic sql if the weeks are unknown but it is easier to see the correct code using a hard-coded version initially.\nFirst up, here are some quick table definitions and data for use:\nCREATE TABLE yt \n(\n  [Store] int, \n  [Week] int, \n  [xCount] int\n);\n    \nINSERT INTO yt\n(\n  [Store], \n  [Week], [xCount]\n)\nVALUES\n    (102, 1, 96),\n    (101, 1, 138),\n    (105, 1, 37),\n    (109, 1, 59),\n    (101, 2, 282),\n    (102, 2, 212),\n    (105, 2, 78),\n    (109, 2, 97),\n    (105, 3, 60),\n    (102, 3, 123),\n    (101, 3, 220),\n    (109, 3, 87);\n\nIf your values are known, then you will hard-code the query:\nselect *\nfrom \n(\n  select store, week, xCount\n  from yt \n) src\npivot\n(\n  sum(xcount)\n  for week in ([1], [2], [3])\n) piv;\n\nSee SQL Demo\nThen if you need to generate the week number dynamically, your code will be:\nDECLARE @cols AS NVARCHAR(MAX),\n    @query  AS NVARCHAR(MAX)\n\nselect @cols = STUFF((SELECT &apos;,&apos; + QUOTENAME(Week) \n                    from yt\n                    group by Week\n                    order by Week\n            FOR XML PATH(&apos;&apos;), TYPE\n            ).value(&apos;.&apos;, &apos;NVARCHAR(MAX)&apos;) \n        ,1,1,&apos;&apos;)\n\nset @query = &apos;SELECT store,&apos; + @cols + &apos; from \n             (\n                select store, week, xCount\n                from yt\n            ) x\n            pivot \n            (\n                sum(xCount)\n                for week in (&apos; + @cols + &apos;)\n            ) p &apos;\n\nexecute(@query);\n\nSee SQL Demo.\nThe dynamic version, generates the list of week numbers that should be converted to columns. Both give the same result:\n| STORE |   1 |   2 |   3 |\n---------------------------\n|   101 | 138 | 282 | 220 |\n|   102 |  96 | 212 | 123 |\n|   105 |  37 |  78 |  60 |\n|   109 |  59 |  97 |  87 |\n\n    ","url":"/questions/[slug]#solution1","@type":"Answer","upvoteCount":0},{"text":"This is for dynamic # of weeks.\n\nFull example here:SQL Dynamic Pivot\n\nDECLARE @DynamicPivotQuery AS NVARCHAR(MAX)\nDECLARE @ColumnName AS NVARCHAR(MAX)\n\n--Get distinct values of the PIVOT Column \nSELECT @ColumnName= ISNULL(@ColumnName + &apos;,&apos;,&apos;&apos;) + QUOTENAME(Week)\nFROM (SELECT DISTINCT Week FROM #StoreSales) AS Weeks\n\n--Prepare the PIVOT query using the dynamic \nSET @DynamicPivotQuery = \n  N&apos;SELECT Store, &apos; + @ColumnName + &apos; \n    FROM #StoreSales\n    PIVOT(SUM(xCount) \n          FOR Week IN (&apos; + @ColumnName + &apos;)) AS PVTTable&apos;\n--Execute the Dynamic Pivot Query\nEXEC sp_executesql @DynamicPivotQuery\n\n    ","url":"/questions/[slug]#solution2","@type":"Answer","upvoteCount":0},{"text":"I&apos;ve achieved the same thing before by using subqueries.  So if your original table was called StoreCountsByWeek, and you had a separate table that listed the Store IDs, then it would look like this:\n\nSELECT StoreID, \n    Week1=(SELECT ISNULL(SUM(xCount),0) FROM StoreCountsByWeek WHERE StoreCountsByWeek.StoreID=Store.StoreID AND Week=1),\n    Week2=(SELECT ISNULL(SUM(xCount),0) FROM StoreCountsByWeek WHERE StoreCountsByWeek.StoreID=Store.StoreID AND Week=2),\n    Week3=(SELECT ISNULL(SUM(xCount),0) FROM StoreCountsByWeek WHERE StoreCountsByWeek.StoreID=Store.StoreID AND Week=3)\nFROM Store\nORDER BY StoreID\n\n\nOne advantage to this method is that the syntax is more clear and it makes it easier to join to other tables to pull other fields into the results too.\n\nMy anecdotal results are that running this query over a couple of thousand rows completed in less than one second, and I actually had 7 subqueries.  But as noted in the comments, it is more computationally expensive to do it this way, so be careful about using this method if you expect it to run on large amounts of data .\n    ","url":"/questions/[slug]#solution3","@type":"Answer","upvoteCount":0},{"text":"This is what you can do:\n\nSELECT * \nFROM yourTable\nPIVOT (MAX(xCount) \n       FOR Week in ([1],[2],[3],[4],[5],[6],[7])) AS pvt\n\n\nDEMO\n    ","url":"/questions/[slug]#solution4","@type":"Answer","upvoteCount":0},{"text":"I&apos;m writing an sp that could be useful for this purpose, basically this sp pivot any table and return a new table pivoted or return just the set of data, this is the way to execute it:\n\nExec dbo.rs_pivot_table @schema=dbo,@table=table_name,@column=column_to_pivot,@agg=&apos;sum([column_to_agg]),avg([another_column_to_agg]),&apos;,\n        @sel_cols=&apos;column_to_select1,column_to_select2,column_to_select1&apos;,@new_table=returned_table_pivoted;\n\n\nplease note that in the parameter @agg the column names must be with &apos;[&apos; and the parameter must end with a comma &apos;,&apos;\n\nSP\n\nCreate Procedure [dbo].[rs_pivot_table]\n    @schema sysname=dbo,\n    @table sysname,\n    @column sysname,\n    @agg nvarchar(max),\n    @sel_cols varchar(max),\n    @new_table sysname,\n    @add_to_col_name sysname=null\nAs\n--Exec dbo.rs_pivot_table dbo,##TEMPORAL1,tip_liq,&apos;sum([val_liq]),sum([can_liq]),&apos;,&apos;cod_emp,cod_con,tip_liq&apos;,##TEMPORAL1PVT,&apos;hola&apos;;\nBegin\n\n    Declare @query varchar(max)=&apos;&apos;;\n    Declare @aggDet varchar(100);\n    Declare @opp_agg varchar(5);\n    Declare @col_agg varchar(100);\n    Declare @pivot_col sysname;\n    Declare @query_col_pvt varchar(max)=&apos;&apos;;\n    Declare @full_query_pivot varchar(max)=&apos;&apos;;\n    Declare @ind_tmpTbl int; --Indicador de tabla temporal 1=tabla temporal global 0=Tabla fisica\n\n    Create Table #pvt_column(\n        pivot_col varchar(100)\n    );\n\n    Declare @column_agg table(\n        opp_agg varchar(5),\n        col_agg varchar(100)\n    );\n\n    IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(@table) AND type in (N&apos;U&apos;))\n        Set @ind_tmpTbl=0;\n    ELSE IF OBJECT_ID(&apos;tempdb..&apos;+ltrim(rtrim(@table))) IS NOT NULL\n        Set @ind_tmpTbl=1;\n\n    IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(@new_table) AND type in (N&apos;U&apos;)) OR \n        OBJECT_ID(&apos;tempdb..&apos;+ltrim(rtrim(@new_table))) IS NOT NULL\n    Begin\n        Set @query=&apos;DROP TABLE &apos;+@new_table+&apos;&apos;;\n        Exec (@query);\n    End;\n\n    Select @query=&apos;Select distinct &apos;+@column+&apos; From &apos;+(case when @ind_tmpTbl=1 then &apos;tempdb.&apos; else &apos;&apos; end)+@schema+&apos;.&apos;+@table+&apos; where &apos;+@column+&apos; is not null;&apos;;\n    Print @query;\n\n    Insert into #pvt_column(pivot_col)\n    Exec (@query)\n\n    While charindex(&apos;,&apos;,@agg,1)&gt;0\n    Begin\n        Select @aggDet=Substring(@agg,1,charindex(&apos;,&apos;,@agg,1)-1);\n\n        Insert Into @column_agg(opp_agg,col_agg)\n        Values(substring(@aggDet,1,charindex(&apos;(&apos;,@aggDet,1)-1),ltrim(rtrim(replace(substring(@aggDet,charindex(&apos;[&apos;,@aggDet,1),charindex(&apos;]&apos;,@aggDet,1)-4),&apos;)&apos;,&apos;&apos;))));\n\n        Set @agg=Substring(@agg,charindex(&apos;,&apos;,@agg,1)+1,len(@agg))\n\n    End\n\n    Declare cur_agg cursor read_only forward_only local static for\n    Select \n        opp_agg,col_agg\n    from @column_agg;\n\n    Open cur_agg;\n\n    Fetch Next From cur_agg\n    Into @opp_agg,@col_agg;\n\n    While @@fetch_status=0\n    Begin\n\n        Declare cur_col cursor read_only forward_only local static for\n        Select \n            pivot_col \n        From #pvt_column;\n\n        Open cur_col;\n\n        Fetch Next From cur_col\n        Into @pivot_col;\n\n        While @@fetch_status=0\n        Begin\n\n            Select @query_col_pvt=&apos;isnull(&apos;+@opp_agg+&apos;(case when &apos;+@column+&apos;=&apos;+quotename(@pivot_col,char(39))+&apos; then &apos;+@col_agg+\n            &apos; else null end),0) as [&apos;+lower(Replace(Replace(@opp_agg+&apos;_&apos;+convert(varchar(100),@pivot_col)+&apos;_&apos;+replace(replace(@col_agg,&apos;[&apos;,&apos;&apos;),&apos;]&apos;,&apos;&apos;),&apos; &apos;,&apos;&apos;),&apos;&amp;&apos;,&apos;&apos;))+\n                (case when @add_to_col_name is null then space(0) else &apos;_&apos;+isnull(ltrim(rtrim(@add_to_col_name)),&apos;&apos;) end)+&apos;]&apos;\n            print @query_col_pvt\n            Select @full_query_pivot=@full_query_pivot+@query_col_pvt+&apos;, &apos;\n\n            --print @full_query_pivot\n\n            Fetch Next From cur_col\n            Into @pivot_col;        \n\n        End     \n\n        Close cur_col;\n        Deallocate cur_col;\n\n        Fetch Next From cur_agg\n        Into @opp_agg,@col_agg; \n    End\n\n    Close cur_agg;\n    Deallocate cur_agg;\n\n    Select @full_query_pivot=substring(@full_query_pivot,1,len(@full_query_pivot)-1);\n\n    Select @query=&apos;Select &apos;+@sel_cols+&apos;,&apos;+@full_query_pivot+&apos; into &apos;+@new_table+&apos; From &apos;+(case when @ind_tmpTbl=1 then &apos;tempdb.&apos; else &apos;&apos; end)+\n    @schema+&apos;.&apos;+@table+&apos; Group by &apos;+@sel_cols+&apos;;&apos;;\n\n    print @query;\n    Exec (@query);\n\nEnd;\nGO\n\n\nThis is an example of execution:\n\nExec dbo.rs_pivot_table @schema=dbo,@table=##TEMPORAL1,@column=tip_liq,@agg=&apos;sum([val_liq]),avg([can_liq]),&apos;,@sel_cols=&apos;cod_emp,cod_con,tip_liq&apos;,@new_table=##TEMPORAL1PVT;\n\n\nthen Select * From ##TEMPORAL1PVT would return:\n\n\n    ","url":"/questions/[slug]#solution5","@type":"Answer","upvoteCount":0},{"text":"Here is a revision of @Tayrn answer above that might help you understand pivoting a little easier: \n\nThis may not be the best way to do this, but this is what helped me wrap my head around how to pivot tables.\n\nID = rows you want to pivot\n\nMY_KEY = the column you are selecting from your original table that contains the column names you want to pivot.\n\nVAL = the value you want returning under each column.\n\nMAX(VAL) =&gt; Can be replaced with other aggregiate functions. SUM(VAL), MIN(VAL), ETC...\n\nDECLARE @cols AS NVARCHAR(MAX),\n@query  AS NVARCHAR(MAX)\nselect @cols = STUFF((SELECT &apos;,&apos; + QUOTENAME(MY_KEY) \n                from yt\n                group by MY_KEY\n                order by MY_KEY ASC\n        FOR XML PATH(&apos;&apos;), TYPE\n        ).value(&apos;.&apos;, &apos;NVARCHAR(MAX)&apos;) \n    ,1,1,&apos;&apos;)\nset @query = &apos;SELECT ID,&apos; + @cols + &apos; from \n         (\n            select ID, MY_KEY, VAL \n            from yt\n        ) x\n        pivot \n        (\n            sum(VAL)\n            for MY_KEY in (&apos; + @cols + &apos;)\n        ) p &apos;\n\n        execute(@query);\n\n    ","url":"/questions/[slug]#solution6","@type":"Answer","upvoteCount":0},{"text":"select * from (select name, ID from Empoyee) Visits\n    pivot(sum(ID) for name\n    in ([Emp1],\n    [Emp2],\n    [Emp3]\n    ) ) as pivottable;\n\n    ","url":"/questions/[slug]#solution7","@type":"Answer","upvoteCount":0},{"text":"Just give you some idea how other databases solve this problem. DolphinDB also has built-in support for pivoting and the sql looks much more intuitive and neat. It is as simple as specifying the key column (Store), pivoting column (Week), and the calculated metric (sum(xCount)).\n\n//prepare a 10-million-row table\nn=10000000\nt=table(rand(100, n) + 1 as Store, rand(54, n) + 1 as Week, rand(100, n) + 1 as xCount)\n\n//use pivot clause to generate a pivoted table pivot_t\npivot_t = select sum(xCount) from t pivot by Store, Week\n\n\nDolphinDB is a columnar high performance database. The calculation in the demo costs as low as 546 ms on a dell xps laptop (i7 cpu).  To get more details, please refer to online DolphinDB manual https://www.dolphindb.com/help/index.html?pivotby.html\n    ","url":"/questions/[slug]#solution8","@type":"Answer","upvoteCount":0},{"text":"Pivot is one of the SQL operator which is used to turn the unique data from one column into multiple column in the output. This is also mean by transforming the rows into columns (rotating table). Let us consider this table,\n\nIf I want to filter this data based on the types of product (Speaker, Glass, Headset) by each customer, then use Pivot operator.\nSelect CustmerName, Speaker, Glass, Headset  \nfrom TblCustomer  \n   Pivot  \n    (  \n     Sum(Price) for Product in ([Speaker],[Glass],[Headset])  \n    ) as PivotTable \n\n\n    ","url":"/questions/[slug]#solution9","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/08bcc42a26fe5c92.css" as="style"/><link rel="stylesheet" href="/_next/static/css/08bcc42a26fe5c92.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-ccfab947c79712f4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-08d1a634dea6705e.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/150-b06815e21c943e0d.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/108-87de33c23337ff53.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-79a1437acf654019.js" defer=""></script><script src="/_next/static/Zo3C7AOWQzKM9qqyzx2hf/_buildManifest.js" defer=""></script><script src="/_next/static/Zo3C7AOWQzKM9qqyzx2hf/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h4 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h4></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/convert-rows-to-columns-using-&#x27;pivot&#x27;-in-sql-server-1657388372528#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/convert-rows-to-columns-using-&#x27;pivot&#x27;-in-sql-server-1657388372528"><h1>Convert Rows to columns using &#x27;Pivot&#x27; in SQL Server</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/pivot-table">pivot-table</a></div></div><div class="question-content mt-5">
                
<p>I have read the stuff on MS pivot tables and I am still having problems getting this correct.</p>

<p>I have a temp table that is being created, we will say that column 1 is a Store number, and column 2 is a week number and lastly column 3 is a total of some type. Also the Week numbers are dynamic, the store numbers are static.</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">Store      Week     xCount
<span class="hljs-comment">-------    ----     ------</span>
<span class="hljs-number">102</span>        <span class="hljs-number">1</span>        <span class="hljs-number">96</span>
<span class="hljs-number">101</span>        <span class="hljs-number">1</span>        <span class="hljs-number">138</span>
<span class="hljs-number">105</span>        <span class="hljs-number">1</span>        <span class="hljs-number">37</span>
<span class="hljs-number">109</span>        <span class="hljs-number">1</span>        <span class="hljs-number">59</span>
<span class="hljs-number">101</span>        <span class="hljs-number">2</span>        <span class="hljs-number">282</span>
<span class="hljs-number">102</span>        <span class="hljs-number">2</span>        <span class="hljs-number">212</span>
<span class="hljs-number">105</span>        <span class="hljs-number">2</span>        <span class="hljs-number">78</span>
<span class="hljs-number">109</span>        <span class="hljs-number">2</span>        <span class="hljs-number">97</span>
<span class="hljs-number">105</span>        <span class="hljs-number">3</span>        <span class="hljs-number">60</span>
<span class="hljs-number">102</span>        <span class="hljs-number">3</span>        <span class="hljs-number">123</span>
<span class="hljs-number">101</span>        <span class="hljs-number">3</span>        <span class="hljs-number">220</span>
<span class="hljs-number">109</span>        <span class="hljs-number">3</span>        <span class="hljs-number">87</span>
</code></pre>

<p>I would like it to come out as a pivot table, like this:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">Store        <span class="hljs-number">1</span>          <span class="hljs-number">2</span>          <span class="hljs-number">3</span>        <span class="hljs-number">4</span>        <span class="hljs-number">5</span>        <span class="hljs-number">6.</span>...
<span class="hljs-comment">----- </span>
<span class="hljs-number">101</span>        <span class="hljs-number">138</span>        <span class="hljs-number">282</span>        <span class="hljs-number">220</span>
<span class="hljs-number">102</span>         <span class="hljs-number">96</span>        <span class="hljs-number">212</span>        <span class="hljs-number">123</span>
<span class="hljs-number">105</span>         <span class="hljs-number">37</span>        
<span class="hljs-number">109</span>
</code></pre>

<p>Store numbers down the side and weeks across the top.</p>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li><li class="pagination-solution-item"><span data-id="#solution3" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">3</span></li><li class="pagination-solution-item"><span data-id="#solution4" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">4</span></li><li class="pagination-solution-item"><span data-id="#solution5" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">5</span></li><li class="pagination-solution-item"><span data-id="#solution6" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">6</span></li><li class="pagination-solution-item"><span data-id="#solution7" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">7</span></li><li class="pagination-solution-item"><span data-id="#solution8" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">8</span></li><li class="pagination-solution-item"><span data-id="#solution9" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">9</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/pivot-table">pivot-table</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If you are using SQL Server 2005+, then you can use the <code>PIVOT</code> function to transform the data from rows into columns.</p>
<p>It sounds like you will need to use dynamic sql if the weeks are unknown but it is easier to see the correct code using a hard-coded version initially.</p>
<p>First up, here are some quick table definitions and data for use:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> yt 
(
  [Store] <span class="hljs-type">int</span>, 
  [Week] <span class="hljs-type">int</span>, 
  [xCount] <span class="hljs-type">int</span>
);
    
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> yt
(
  [Store], 
  [Week], [xCount]
)
<span class="hljs-keyword">VALUES</span>
    (<span class="hljs-number">102</span>, <span class="hljs-number">1</span>, <span class="hljs-number">96</span>),
    (<span class="hljs-number">101</span>, <span class="hljs-number">1</span>, <span class="hljs-number">138</span>),
    (<span class="hljs-number">105</span>, <span class="hljs-number">1</span>, <span class="hljs-number">37</span>),
    (<span class="hljs-number">109</span>, <span class="hljs-number">1</span>, <span class="hljs-number">59</span>),
    (<span class="hljs-number">101</span>, <span class="hljs-number">2</span>, <span class="hljs-number">282</span>),
    (<span class="hljs-number">102</span>, <span class="hljs-number">2</span>, <span class="hljs-number">212</span>),
    (<span class="hljs-number">105</span>, <span class="hljs-number">2</span>, <span class="hljs-number">78</span>),
    (<span class="hljs-number">109</span>, <span class="hljs-number">2</span>, <span class="hljs-number">97</span>),
    (<span class="hljs-number">105</span>, <span class="hljs-number">3</span>, <span class="hljs-number">60</span>),
    (<span class="hljs-number">102</span>, <span class="hljs-number">3</span>, <span class="hljs-number">123</span>),
    (<span class="hljs-number">101</span>, <span class="hljs-number">3</span>, <span class="hljs-number">220</span>),
    (<span class="hljs-number">109</span>, <span class="hljs-number">3</span>, <span class="hljs-number">87</span>);
</code></pre>
<p>If your values are known, then you will hard-code the query:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">from</span> 
(
  <span class="hljs-keyword">select</span> store, week, xCount
  <span class="hljs-keyword">from</span> yt 
) src
pivot
(
  <span class="hljs-built_in">sum</span>(xcount)
  <span class="hljs-keyword">for</span> week <span class="hljs-keyword">in</span> ([<span class="hljs-number">1</span>], [<span class="hljs-number">2</span>], [<span class="hljs-number">3</span>])
) piv;
</code></pre>
<p>See <a href="https://data.stackexchange.com/stackoverflow/query/580181" rel="noreferrer">SQL Demo</a></p>
<p>Then if you need to generate the week number dynamically, your code will be:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@cols</span> <span class="hljs-keyword">AS</span> NVARCHAR(MAX),
    <span class="hljs-variable">@query</span>  <span class="hljs-keyword">AS</span> NVARCHAR(MAX)

<span class="hljs-keyword">select</span> <span class="hljs-variable">@cols</span> <span class="hljs-operator">=</span> STUFF((<span class="hljs-keyword">SELECT</span> <span class="hljs-string">','</span> <span class="hljs-operator">+</span> QUOTENAME(Week) 
                    <span class="hljs-keyword">from</span> yt
                    <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> Week
                    <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> Week
            <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>), TYPE
            ).<span class="hljs-keyword">value</span>(<span class="hljs-string">'.'</span>, <span class="hljs-string">'NVARCHAR(MAX)'</span>) 
        ,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-string">''</span>)

<span class="hljs-keyword">set</span> <span class="hljs-variable">@query</span> <span class="hljs-operator">=</span> <span class="hljs-string">'SELECT store,'</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@cols</span> <span class="hljs-operator">+</span> <span class="hljs-string">' from 
             (
                select store, week, xCount
                from yt
            ) x
            pivot 
            (
                sum(xCount)
                for week in ('</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@cols</span> <span class="hljs-operator">+</span> <span class="hljs-string">')
            ) p '</span>

<span class="hljs-keyword">execute</span>(<span class="hljs-variable">@query</span>);
</code></pre>
<p>See <a href="https://data.stackexchange.com/stackoverflow/query/580183" rel="noreferrer">SQL Demo</a>.</p>
<p>The dynamic version, generates the list of <code>week</code> numbers that should be converted to columns. Both give the same result:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-operator">|</span> STORE <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">2</span> <span class="hljs-operator">|</span>   <span class="hljs-number">3</span> <span class="hljs-operator">|</span>
<span class="hljs-comment">---------------------------</span>
<span class="hljs-operator">|</span>   <span class="hljs-number">101</span> <span class="hljs-operator">|</span> <span class="hljs-number">138</span> <span class="hljs-operator">|</span> <span class="hljs-number">282</span> <span class="hljs-operator">|</span> <span class="hljs-number">220</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>   <span class="hljs-number">102</span> <span class="hljs-operator">|</span>  <span class="hljs-number">96</span> <span class="hljs-operator">|</span> <span class="hljs-number">212</span> <span class="hljs-operator">|</span> <span class="hljs-number">123</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>   <span class="hljs-number">105</span> <span class="hljs-operator">|</span>  <span class="hljs-number">37</span> <span class="hljs-operator">|</span>  <span class="hljs-number">78</span> <span class="hljs-operator">|</span>  <span class="hljs-number">60</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>   <span class="hljs-number">109</span> <span class="hljs-operator">|</span>  <span class="hljs-number">59</span> <span class="hljs-operator">|</span>  <span class="hljs-number">97</span> <span class="hljs-operator">|</span>  <span class="hljs-number">87</span> <span class="hljs-operator">|</span>
</code></pre>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/pivot-table">pivot-table</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>This is for dynamic # of weeks.</p>

<p>Full example here:<a href="http://sqlhints.com/2014/03/18/dynamic-pivot-in-sql-server/" rel="noreferrer">SQL Dynamic Pivot</a></p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@DynamicPivotQuery</span> <span class="hljs-keyword">AS</span> NVARCHAR(MAX)
<span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@ColumnName</span> <span class="hljs-keyword">AS</span> NVARCHAR(MAX)

<span class="hljs-comment">--Get distinct values of the PIVOT Column </span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@ColumnName</span><span class="hljs-operator">=</span> ISNULL(<span class="hljs-variable">@ColumnName</span> <span class="hljs-operator">+</span> <span class="hljs-string">','</span>,<span class="hljs-string">''</span>) <span class="hljs-operator">+</span> QUOTENAME(Week)
<span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> Week <span class="hljs-keyword">FROM</span> #StoreSales) <span class="hljs-keyword">AS</span> Weeks

<span class="hljs-comment">--Prepare the PIVOT query using the dynamic </span>
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@DynamicPivotQuery</span> <span class="hljs-operator">=</span> 
  N<span class="hljs-string">'SELECT Store, '</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@ColumnName</span> <span class="hljs-operator">+</span> <span class="hljs-string">' 
    FROM #StoreSales
    PIVOT(SUM(xCount) 
          FOR Week IN ('</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@ColumnName</span> <span class="hljs-operator">+</span> <span class="hljs-string">')) AS PVTTable'</span>
<span class="hljs-comment">--Execute the Dynamic Pivot Query</span>
<span class="hljs-keyword">EXEC</span> sp_executesql <span class="hljs-variable">@DynamicPivotQuery</span>
</code></pre>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/pivot-table">pivot-table</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I've achieved the same thing before by using subqueries.  So if your original table was called StoreCountsByWeek, and you had a separate table that listed the Store IDs, then it would look like this:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> StoreID, 
    Week1<span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> ISNULL(<span class="hljs-built_in">SUM</span>(xCount),<span class="hljs-number">0</span>) <span class="hljs-keyword">FROM</span> StoreCountsByWeek <span class="hljs-keyword">WHERE</span> StoreCountsByWeek.StoreID<span class="hljs-operator">=</span>Store.StoreID <span class="hljs-keyword">AND</span> Week<span class="hljs-operator">=</span><span class="hljs-number">1</span>),
    Week2<span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> ISNULL(<span class="hljs-built_in">SUM</span>(xCount),<span class="hljs-number">0</span>) <span class="hljs-keyword">FROM</span> StoreCountsByWeek <span class="hljs-keyword">WHERE</span> StoreCountsByWeek.StoreID<span class="hljs-operator">=</span>Store.StoreID <span class="hljs-keyword">AND</span> Week<span class="hljs-operator">=</span><span class="hljs-number">2</span>),
    Week3<span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> ISNULL(<span class="hljs-built_in">SUM</span>(xCount),<span class="hljs-number">0</span>) <span class="hljs-keyword">FROM</span> StoreCountsByWeek <span class="hljs-keyword">WHERE</span> StoreCountsByWeek.StoreID<span class="hljs-operator">=</span>Store.StoreID <span class="hljs-keyword">AND</span> Week<span class="hljs-operator">=</span><span class="hljs-number">3</span>)
<span class="hljs-keyword">FROM</span> Store
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> StoreID
</code></pre>

<p>One advantage to this method is that the syntax is more clear and it makes it easier to join to other tables to pull other fields into the results too.</p>

<p>My anecdotal results are that running this query over a couple of thousand rows completed in less than one second, and I actually had 7 subqueries.  But as noted in the comments, it is more computationally expensive to do it this way, so be careful about using this method if you expect it to run on large amounts of data .</p>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/pivot-table">pivot-table</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>This is what you can do:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> 
<span class="hljs-keyword">FROM</span> yourTable
PIVOT (<span class="hljs-built_in">MAX</span>(xCount) 
       <span class="hljs-keyword">FOR</span> Week <span class="hljs-keyword">in</span> ([<span class="hljs-number">1</span>],[<span class="hljs-number">2</span>],[<span class="hljs-number">3</span>],[<span class="hljs-number">4</span>],[<span class="hljs-number">5</span>],[<span class="hljs-number">6</span>],[<span class="hljs-number">7</span>])) <span class="hljs-keyword">AS</span> pvt
</code></pre>

<p><a href="http://www.sqlfiddle.com/#!3/16fd1/1" rel="noreferrer">DEMO</a></p>
    </div></div></div></div><div id="solution5" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/pivot-table">pivot-table</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I'm writing an sp that could be useful for this purpose, basically this sp pivot any table and return a new table pivoted or return just the set of data, this is the way to execute it:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">Exec</span> dbo.rs_pivot_table <span class="hljs-variable">@schema</span><span class="hljs-operator">=</span>dbo,<span class="hljs-variable">@table</span><span class="hljs-operator">=</span>table_name,<span class="hljs-variable">@column</span><span class="hljs-operator">=</span>column_to_pivot,<span class="hljs-variable">@agg</span><span class="hljs-operator">=</span><span class="hljs-string">'sum([column_to_agg]),avg([another_column_to_agg]),'</span>,
        <span class="hljs-variable">@sel</span>_cols<span class="hljs-operator">=</span><span class="hljs-string">'column_to_select1,column_to_select2,column_to_select1'</span>,<span class="hljs-variable">@new</span>_table<span class="hljs-operator">=</span>returned_table_pivoted;
</code></pre>

<p><strong>please note</strong> that in the parameter @agg the column names must be with <code>'['</code> and the parameter must end with a comma <code>','</code></p>

<p>SP</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">Create</span> <span class="hljs-keyword">Procedure</span> [dbo].[rs_pivot_table]
    <span class="hljs-variable">@schema</span> sysname<span class="hljs-operator">=</span>dbo,
    <span class="hljs-variable">@table</span> sysname,
    <span class="hljs-variable">@column</span> sysname,
    <span class="hljs-variable">@agg</span> nvarchar(max),
    <span class="hljs-variable">@sel</span>_cols <span class="hljs-type">varchar</span>(max),
    <span class="hljs-variable">@new</span>_table sysname,
    <span class="hljs-variable">@add</span>_to_col_name sysname<span class="hljs-operator">=</span><span class="hljs-keyword">null</span>
<span class="hljs-keyword">As</span>
<span class="hljs-comment">--Exec dbo.rs_pivot_table dbo,##TEMPORAL1,tip_liq,'sum([val_liq]),sum([can_liq]),','cod_emp,cod_con,tip_liq',##TEMPORAL1PVT,'hola';</span>
<span class="hljs-keyword">Begin</span>

    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@query</span> <span class="hljs-type">varchar</span>(max)<span class="hljs-operator">=</span><span class="hljs-string">''</span>;
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@aggDet</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>);
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@opp</span>_agg <span class="hljs-type">varchar</span>(<span class="hljs-number">5</span>);
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@col</span>_agg <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>);
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@pivot</span>_col sysname;
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@query</span>_col_pvt <span class="hljs-type">varchar</span>(max)<span class="hljs-operator">=</span><span class="hljs-string">''</span>;
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@full</span>_query_pivot <span class="hljs-type">varchar</span>(max)<span class="hljs-operator">=</span><span class="hljs-string">''</span>;
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@ind</span>_tmpTbl <span class="hljs-type">int</span>; <span class="hljs-comment">--Indicador de tabla temporal 1=tabla temporal global 0=Tabla fisica</span>

    <span class="hljs-keyword">Create</span> <span class="hljs-keyword">Table</span> #pvt_column(
        pivot_col <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>)
    );

    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@column</span>_agg <span class="hljs-keyword">table</span>(
        opp_agg <span class="hljs-type">varchar</span>(<span class="hljs-number">5</span>),
        col_agg <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>)
    );

    IF  <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sys.objects <span class="hljs-keyword">WHERE</span> object_id <span class="hljs-operator">=</span> OBJECT_ID(<span class="hljs-variable">@table</span>) <span class="hljs-keyword">AND</span> type <span class="hljs-keyword">in</span> (N<span class="hljs-string">'U'</span>))
        <span class="hljs-keyword">Set</span> <span class="hljs-variable">@ind</span>_tmpTbl<span class="hljs-operator">=</span><span class="hljs-number">0</span>;
    <span class="hljs-keyword">ELSE</span> IF OBJECT_ID(<span class="hljs-string">'tempdb..'</span><span class="hljs-operator">+</span>ltrim(rtrim(<span class="hljs-variable">@table</span>))) <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
        <span class="hljs-keyword">Set</span> <span class="hljs-variable">@ind</span>_tmpTbl<span class="hljs-operator">=</span><span class="hljs-number">1</span>;

    IF  <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sys.objects <span class="hljs-keyword">WHERE</span> object_id <span class="hljs-operator">=</span> OBJECT_ID(<span class="hljs-variable">@new</span>_table) <span class="hljs-keyword">AND</span> type <span class="hljs-keyword">in</span> (N<span class="hljs-string">'U'</span>)) <span class="hljs-keyword">OR</span> 
        OBJECT_ID(<span class="hljs-string">'tempdb..'</span><span class="hljs-operator">+</span>ltrim(rtrim(<span class="hljs-variable">@new</span>_table))) <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
    <span class="hljs-keyword">Begin</span>
        <span class="hljs-keyword">Set</span> <span class="hljs-variable">@query</span><span class="hljs-operator">=</span><span class="hljs-string">'DROP TABLE '</span><span class="hljs-operator">+</span><span class="hljs-variable">@new</span>_table<span class="hljs-operator">+</span><span class="hljs-string">''</span>;
        <span class="hljs-keyword">Exec</span> (<span class="hljs-variable">@query</span>);
    <span class="hljs-keyword">End</span>;

    <span class="hljs-keyword">Select</span> <span class="hljs-variable">@query</span><span class="hljs-operator">=</span><span class="hljs-string">'Select distinct '</span><span class="hljs-operator">+</span><span class="hljs-variable">@column</span><span class="hljs-operator">+</span><span class="hljs-string">' From '</span><span class="hljs-operator">+</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> <span class="hljs-variable">@ind</span>_tmpTbl<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">then</span> <span class="hljs-string">'tempdb.'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">''</span> <span class="hljs-keyword">end</span>)<span class="hljs-operator">+</span><span class="hljs-variable">@schema</span><span class="hljs-operator">+</span><span class="hljs-string">'.'</span><span class="hljs-operator">+</span><span class="hljs-variable">@table</span><span class="hljs-operator">+</span><span class="hljs-string">' where '</span><span class="hljs-operator">+</span><span class="hljs-variable">@column</span><span class="hljs-operator">+</span><span class="hljs-string">' is not null;'</span>;
    Print <span class="hljs-variable">@query</span>;

    <span class="hljs-keyword">Insert</span> <span class="hljs-keyword">into</span> #pvt_column(pivot_col)
    <span class="hljs-keyword">Exec</span> (<span class="hljs-variable">@query</span>)

    While charindex(<span class="hljs-string">','</span>,<span class="hljs-variable">@agg</span>,<span class="hljs-number">1</span>)<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span>
    <span class="hljs-keyword">Begin</span>
        <span class="hljs-keyword">Select</span> <span class="hljs-variable">@aggDet</span><span class="hljs-operator">=</span><span class="hljs-built_in">Substring</span>(<span class="hljs-variable">@agg</span>,<span class="hljs-number">1</span>,charindex(<span class="hljs-string">','</span>,<span class="hljs-variable">@agg</span>,<span class="hljs-number">1</span>)<span class="hljs-number">-1</span>);

        <span class="hljs-keyword">Insert</span> <span class="hljs-keyword">Into</span> <span class="hljs-variable">@column</span>_agg(opp_agg,col_agg)
        <span class="hljs-keyword">Values</span>(<span class="hljs-built_in">substring</span>(<span class="hljs-variable">@aggDet</span>,<span class="hljs-number">1</span>,charindex(<span class="hljs-string">'('</span>,<span class="hljs-variable">@aggDet</span>,<span class="hljs-number">1</span>)<span class="hljs-number">-1</span>),ltrim(rtrim(replace(<span class="hljs-built_in">substring</span>(<span class="hljs-variable">@aggDet</span>,charindex(<span class="hljs-string">'['</span>,<span class="hljs-variable">@aggDet</span>,<span class="hljs-number">1</span>),charindex(<span class="hljs-string">']'</span>,<span class="hljs-variable">@aggDet</span>,<span class="hljs-number">1</span>)<span class="hljs-number">-4</span>),<span class="hljs-string">')'</span>,<span class="hljs-string">''</span>))));

        <span class="hljs-keyword">Set</span> <span class="hljs-variable">@agg</span><span class="hljs-operator">=</span><span class="hljs-built_in">Substring</span>(<span class="hljs-variable">@agg</span>,charindex(<span class="hljs-string">','</span>,<span class="hljs-variable">@agg</span>,<span class="hljs-number">1</span>)<span class="hljs-operator">+</span><span class="hljs-number">1</span>,len(<span class="hljs-variable">@agg</span>))

    <span class="hljs-keyword">End</span>

    <span class="hljs-keyword">Declare</span> cur_agg <span class="hljs-keyword">cursor</span> read_only forward_only <span class="hljs-keyword">local</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">for</span>
    <span class="hljs-keyword">Select</span> 
        opp_agg,col_agg
    <span class="hljs-keyword">from</span> <span class="hljs-variable">@column</span>_agg;

    <span class="hljs-keyword">Open</span> cur_agg;

    <span class="hljs-keyword">Fetch</span> Next <span class="hljs-keyword">From</span> cur_agg
    <span class="hljs-keyword">Into</span> <span class="hljs-variable">@opp</span>_agg,<span class="hljs-variable">@col</span>_agg;

    While @<span class="hljs-variable">@fetch</span>_status<span class="hljs-operator">=</span><span class="hljs-number">0</span>
    <span class="hljs-keyword">Begin</span>

        <span class="hljs-keyword">Declare</span> cur_col <span class="hljs-keyword">cursor</span> read_only forward_only <span class="hljs-keyword">local</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">for</span>
        <span class="hljs-keyword">Select</span> 
            pivot_col 
        <span class="hljs-keyword">From</span> #pvt_column;

        <span class="hljs-keyword">Open</span> cur_col;

        <span class="hljs-keyword">Fetch</span> Next <span class="hljs-keyword">From</span> cur_col
        <span class="hljs-keyword">Into</span> <span class="hljs-variable">@pivot</span>_col;

        While @<span class="hljs-variable">@fetch</span>_status<span class="hljs-operator">=</span><span class="hljs-number">0</span>
        <span class="hljs-keyword">Begin</span>

            <span class="hljs-keyword">Select</span> <span class="hljs-variable">@query</span>_col_pvt<span class="hljs-operator">=</span><span class="hljs-string">'isnull('</span><span class="hljs-operator">+</span><span class="hljs-variable">@opp</span>_agg<span class="hljs-operator">+</span><span class="hljs-string">'(case when '</span><span class="hljs-operator">+</span><span class="hljs-variable">@column</span><span class="hljs-operator">+</span><span class="hljs-string">'='</span><span class="hljs-operator">+</span>quotename(<span class="hljs-variable">@pivot</span>_col,<span class="hljs-type">char</span>(<span class="hljs-number">39</span>))<span class="hljs-operator">+</span><span class="hljs-string">' then '</span><span class="hljs-operator">+</span><span class="hljs-variable">@col</span>_agg<span class="hljs-operator">+</span>
            <span class="hljs-string">' else null end),0) as ['</span><span class="hljs-operator">+</span><span class="hljs-built_in">lower</span>(Replace(Replace(<span class="hljs-variable">@opp</span>_agg<span class="hljs-operator">+</span><span class="hljs-string">'_'</span><span class="hljs-operator">+</span><span class="hljs-keyword">convert</span>(<span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>),<span class="hljs-variable">@pivot</span>_col)<span class="hljs-operator">+</span><span class="hljs-string">'_'</span><span class="hljs-operator">+</span>replace(replace(<span class="hljs-variable">@col</span>_agg,<span class="hljs-string">'['</span>,<span class="hljs-string">''</span>),<span class="hljs-string">']'</span>,<span class="hljs-string">''</span>),<span class="hljs-string">' '</span>,<span class="hljs-string">''</span>),<span class="hljs-string">'&amp;'</span>,<span class="hljs-string">''</span>))<span class="hljs-operator">+</span>
                (<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> <span class="hljs-variable">@add</span>_to_col_name <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">then</span> space(<span class="hljs-number">0</span>) <span class="hljs-keyword">else</span> <span class="hljs-string">'_'</span><span class="hljs-operator">+</span>isnull(ltrim(rtrim(<span class="hljs-variable">@add</span>_to_col_name)),<span class="hljs-string">''</span>) <span class="hljs-keyword">end</span>)<span class="hljs-operator">+</span><span class="hljs-string">']'</span>
            print <span class="hljs-variable">@query</span>_col_pvt
            <span class="hljs-keyword">Select</span> <span class="hljs-variable">@full</span>_query_pivot<span class="hljs-operator">=</span><span class="hljs-variable">@full</span>_query_pivot<span class="hljs-operator">+</span><span class="hljs-variable">@query</span>_col_pvt<span class="hljs-operator">+</span><span class="hljs-string">', '</span>

            <span class="hljs-comment">--print @full_query_pivot</span>

            <span class="hljs-keyword">Fetch</span> Next <span class="hljs-keyword">From</span> cur_col
            <span class="hljs-keyword">Into</span> <span class="hljs-variable">@pivot</span>_col;        

        <span class="hljs-keyword">End</span>     

        <span class="hljs-keyword">Close</span> cur_col;
        <span class="hljs-keyword">Deallocate</span> cur_col;

        <span class="hljs-keyword">Fetch</span> Next <span class="hljs-keyword">From</span> cur_agg
        <span class="hljs-keyword">Into</span> <span class="hljs-variable">@opp</span>_agg,<span class="hljs-variable">@col</span>_agg; 
    <span class="hljs-keyword">End</span>

    <span class="hljs-keyword">Close</span> cur_agg;
    <span class="hljs-keyword">Deallocate</span> cur_agg;

    <span class="hljs-keyword">Select</span> <span class="hljs-variable">@full</span>_query_pivot<span class="hljs-operator">=</span><span class="hljs-built_in">substring</span>(<span class="hljs-variable">@full</span>_query_pivot,<span class="hljs-number">1</span>,len(<span class="hljs-variable">@full</span>_query_pivot)<span class="hljs-number">-1</span>);

    <span class="hljs-keyword">Select</span> <span class="hljs-variable">@query</span><span class="hljs-operator">=</span><span class="hljs-string">'Select '</span><span class="hljs-operator">+</span><span class="hljs-variable">@sel</span>_cols<span class="hljs-operator">+</span><span class="hljs-string">','</span><span class="hljs-operator">+</span><span class="hljs-variable">@full</span>_query_pivot<span class="hljs-operator">+</span><span class="hljs-string">' into '</span><span class="hljs-operator">+</span><span class="hljs-variable">@new</span>_table<span class="hljs-operator">+</span><span class="hljs-string">' From '</span><span class="hljs-operator">+</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> <span class="hljs-variable">@ind</span>_tmpTbl<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">then</span> <span class="hljs-string">'tempdb.'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">''</span> <span class="hljs-keyword">end</span>)<span class="hljs-operator">+</span>
    <span class="hljs-variable">@schema</span><span class="hljs-operator">+</span><span class="hljs-string">'.'</span><span class="hljs-operator">+</span><span class="hljs-variable">@table</span><span class="hljs-operator">+</span><span class="hljs-string">' Group by '</span><span class="hljs-operator">+</span><span class="hljs-variable">@sel</span>_cols<span class="hljs-operator">+</span><span class="hljs-string">';'</span>;

    print <span class="hljs-variable">@query</span>;
    <span class="hljs-keyword">Exec</span> (<span class="hljs-variable">@query</span>);

<span class="hljs-keyword">End</span>;
GO
</code></pre>

<p>This is an example of execution:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">Exec</span> dbo.rs_pivot_table <span class="hljs-variable">@schema</span><span class="hljs-operator">=</span>dbo,<span class="hljs-variable">@table</span><span class="hljs-operator">=</span>##TEMPORAL1,<span class="hljs-variable">@column</span><span class="hljs-operator">=</span>tip_liq,<span class="hljs-variable">@agg</span><span class="hljs-operator">=</span><span class="hljs-string">'sum([val_liq]),avg([can_liq]),'</span>,<span class="hljs-variable">@sel</span>_cols<span class="hljs-operator">=</span><span class="hljs-string">'cod_emp,cod_con,tip_liq'</span>,<span class="hljs-variable">@new</span>_table<span class="hljs-operator">=</span>##TEMPORAL1PVT;
</code></pre>

<p>then <code>Select * From ##TEMPORAL1PVT</code> would return:</p>

<p><a href="https://i.stack.imgur.com/pGHCK.png" rel="noreferrer"><img src="https://i.stack.imgur.com/pGHCK.png" alt="enter image description here"></a></p>
    </div></div></div></div><div id="solution6" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/pivot-table">pivot-table</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Here is a revision of @Tayrn answer above that might help you understand pivoting a little easier: </p>

<p>This may not be the best way to do this, but this is what helped me wrap my head around how to pivot tables.</p>

<p>ID = rows you want to pivot</p>

<p>MY_KEY = the column you are selecting from your original table that contains the column names you want to pivot.</p>

<p>VAL = the value you want returning under each column.</p>

<p>MAX(VAL) =&gt; Can be replaced with other aggregiate functions. SUM(VAL), MIN(VAL), ETC...</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@cols</span> <span class="hljs-keyword">AS</span> NVARCHAR(MAX),
<span class="hljs-variable">@query</span>  <span class="hljs-keyword">AS</span> NVARCHAR(MAX)
<span class="hljs-keyword">select</span> <span class="hljs-variable">@cols</span> <span class="hljs-operator">=</span> STUFF((<span class="hljs-keyword">SELECT</span> <span class="hljs-string">','</span> <span class="hljs-operator">+</span> QUOTENAME(MY_KEY) 
                <span class="hljs-keyword">from</span> yt
                <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> MY_KEY
                <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> MY_KEY <span class="hljs-keyword">ASC</span>
        <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>), TYPE
        ).<span class="hljs-keyword">value</span>(<span class="hljs-string">'.'</span>, <span class="hljs-string">'NVARCHAR(MAX)'</span>) 
    ,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-string">''</span>)
<span class="hljs-keyword">set</span> <span class="hljs-variable">@query</span> <span class="hljs-operator">=</span> <span class="hljs-string">'SELECT ID,'</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@cols</span> <span class="hljs-operator">+</span> <span class="hljs-string">' from 
         (
            select ID, MY_KEY, VAL 
            from yt
        ) x
        pivot 
        (
            sum(VAL)
            for MY_KEY in ('</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@cols</span> <span class="hljs-operator">+</span> <span class="hljs-string">')
        ) p '</span>

        <span class="hljs-keyword">execute</span>(<span class="hljs-variable">@query</span>);
</code></pre>
    </div></div></div></div><div id="solution7" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 7</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/pivot-table">pivot-table</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> name, ID <span class="hljs-keyword">from</span> Empoyee) Visits
    pivot(<span class="hljs-built_in">sum</span>(ID) <span class="hljs-keyword">for</span> name
    <span class="hljs-keyword">in</span> ([Emp1],
    [Emp2],
    [Emp3]
    ) ) <span class="hljs-keyword">as</span> pivottable;
</code></pre>
    </div></div></div></div><div id="solution8" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 8</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/pivot-table">pivot-table</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Just give you some idea how other databases solve this problem. <code>DolphinDB</code> also has built-in support for pivoting and the sql looks much more intuitive and neat. It is as simple as specifying the key column (<code>Store</code>), pivoting column (<code>Week</code>), and the calculated metric (<code>sum(xCount)</code>).</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-keyword">prepare</span> a <span class="hljs-number">10</span><span class="hljs-operator">-</span>million<span class="hljs-operator">-</span><span class="hljs-type">row</span> <span class="hljs-keyword">table</span>
n<span class="hljs-operator">=</span><span class="hljs-number">10000000</span>
t<span class="hljs-operator">=</span><span class="hljs-keyword">table</span>(rand(<span class="hljs-number">100</span>, n) <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> Store, rand(<span class="hljs-number">54</span>, n) <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> Week, rand(<span class="hljs-number">100</span>, n) <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> xCount)

<span class="hljs-operator">/</span><span class="hljs-operator">/</span>use pivot clause <span class="hljs-keyword">to</span> generate a pivoted <span class="hljs-keyword">table</span> pivot_t
pivot_t <span class="hljs-operator">=</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(xCount) <span class="hljs-keyword">from</span> t pivot <span class="hljs-keyword">by</span> Store, Week
</code></pre>

<p>DolphinDB is a columnar high performance database. The calculation in the demo costs as low as 546 ms on a dell xps laptop (i7 cpu).  To get more details, please refer to online DolphinDB manual <a href="https://www.dolphindb.com/help/index.html?pivotby.html" rel="nofollow noreferrer">https://www.dolphindb.com/help/index.html?pivotby.html</a></p>
    </div></div></div></div><div id="solution9" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 9</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/pivot-table">pivot-table</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Pivot is one of the SQL operator which is used to turn the unique data from one column into multiple column in the output. This is also mean by transforming the rows into columns (rotating table). Let us consider this table,</p>
<p><a href="https://i.stack.imgur.com/iEOQ0.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/iEOQ0.png" alt="enter image description here"></a></p>
<p>If I want to filter this data based on the types of product (Speaker, Glass, Headset) by each customer, then use Pivot operator.</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">Select</span> CustmerName, Speaker, Glass, Headset  
<span class="hljs-keyword">from</span> TblCustomer  
   Pivot  
    (  
     <span class="hljs-built_in">Sum</span>(Price) <span class="hljs-keyword">for</span> Product <span class="hljs-keyword">in</span> ([Speaker],[Glass],[Headset])  
    ) <span class="hljs-keyword">as</span> PivotTable 
</code></pre>
<p><a href="https://i.stack.imgur.com/Y1kSv.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/Y1kSv.png" alt="enter image description here"></a></p>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/javascript-function-doesn&#x27;t-work-when-link-is-clicked-1657387767488">javascript function doesn&#x27;t work when link is clicked</a><a href="/questions/how-to-count-the-number-of-set-bits-in-a-32-bit-integer-1657388437370">How to count the number of set bits in a 32-bit integer?</a><a href="/questions/what-does-it-mean-to-%22program-to-an-interface%22-1657384671665">What does it mean to &quot;program to an interface&quot;?</a><a href="/questions/what-is-a-plain-english-explanation-of-%22big-o%22-notation-1657387641953">What is a plain English explanation of &quot;Big O&quot; notation?</a><a href="/questions/what-does-%22list-comprehension%22-and-similar-mean-how-does-it-work-and-how-can-i-use-it-1657387996940">What does &quot;list comprehension&quot; and similar mean? How does it work and how can I use it?</a><a href="/questions/why-does-printf-not-flush-after-the-call-unless-a-newline-is-in-the-format-string-1657387853407">Why does printf not flush after the call unless a newline is in the format string?</a><a href="/questions/make-a-div-fill-the-height-of-the-remaining-screen-space-1657387482387">Make a div fill the height of the remaining screen space</a><a href="/questions/how-do-i-profile-c++-code-running-on-linux-1657384754272">How do I profile C++ code running on Linux?</a><a href="/questions/what-to-do-regular-expression-pattern-doesn&#x27;t-match-anywhere-in-string-1657388095896">What to do Regular expression pattern doesn&#x27;t match anywhere in string?</a><a href="/questions/how-do-i-match-any-character-across-multiple-lines-in-a-regular-expression-1657387839720">How do I match any character across multiple lines in a regular expression?</a><a href="/questions/how-can-i-deserialize-json-with-c-1657388102941">How can I deserialize JSON with C#?</a><a href="/questions/how-do-i-execute-a-program-or-call-a-system-command-1657385465629">How do I execute a program or call a system command?</a><a href="/questions/why-use-integer-instead-of-long-1657388012352">Why Use Integer Instead of Long?</a><a href="/questions/how-do-i-pass-data-between-activities-in-android-application-1657384739839">How do I pass data between Activities in Android application?</a><a href="/questions/swing-gui-listeners-without-awt-1657387522426">Swing GUI listeners without AWT</a><a href="/questions/how-to-use-java.net.urlconnection-to-fire-and-handle-http-requests-1657387245934">How to use java.net.URLConnection to fire and handle HTTP requests</a><a href="/questions/understanding-slicing-1657384397680">Understanding slicing</a><a href="/questions/iterator-invalidation-rules-for-c++-containers-1657387561090">Iterator invalidation rules for C++ containers</a><a href="/questions/why-does-my-arraylist-contain-n-copies-of-the-last-item-added-to-the-list-1657387712003">Why does my ArrayList contain N copies of the last item added to the list?</a><a href="/questions/how-to-choose-the-right-bean-scope-1657387596513">How to choose the right bean scope?</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;If you are using SQL Server 2005+, then you can use the \u0026lt;code\u0026gt;PIVOT\u0026lt;/code\u0026gt; function to transform the data from rows into columns.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;It sounds like you will need to use dynamic sql if the weeks are unknown but it is easier to see the correct code using a hard-coded version initially.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;First up, here are some quick table definitions and data for use:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TABLE\u0026lt;/span\u0026gt; yt \n(\n  [Store] \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;, \n  [Week] \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;, \n  [xCount] \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;\n);\n    \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INTO\u0026lt;/span\u0026gt; yt\n(\n  [Store], \n  [Week], [xCount]\n)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;VALUES\u0026lt;/span\u0026gt;\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;96\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;138\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;37\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;59\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;282\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;212\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;78\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;97\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;60\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;123\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;220\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;87\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;If your values are known, then you will hard-code the query:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \n(\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; store, week, xCount\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; yt \n) src\npivot\n(\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;sum\u0026lt;/span\u0026gt;(xcount)\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; week \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; ([\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;], [\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;], [\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;])\n) piv;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;See \u0026lt;a href=\u0026quot;https://data.stackexchange.com/stackoverflow/query/580181\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;SQL Demo\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Then if you need to generate the week number dynamically, your code will be:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; NVARCHAR(MAX),\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; NVARCHAR(MAX)\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; STUFF((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; QUOTENAME(Week) \n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; yt\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;group\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; Week\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;order\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; Week\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;), TYPE\n            ).\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;.\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;NVARCHAR(MAX)\u0026apos;\u0026lt;/span\u0026gt;) \n        ,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT store,\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; from \n             (\n                select store, week, xCount\n                from yt\n            ) x\n            pivot \n            (\n                sum(xCount)\n                for week in (\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)\n            ) p \u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;execute\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;See \u0026lt;a href=\u0026quot;https://data.stackexchange.com/stackoverflow/query/580183\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;SQL Demo\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The dynamic version, generates the list of \u0026lt;code\u0026gt;week\u0026lt;/code\u0026gt; numbers that should be converted to columns. Both give the same result:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt; STORE \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;---------------------------\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;138\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;282\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;220\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;96\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;212\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;123\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;37\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;78\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;60\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;59\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;97\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;87\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;This is for dynamic # of weeks.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Full example here:\u0026lt;a href=\u0026quot;http://sqlhints.com/2014/03/18/dynamic-pivot-in-sql-server/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;SQL Dynamic Pivot\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@DynamicPivotQuery\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; NVARCHAR(MAX)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ColumnName\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; NVARCHAR(MAX)\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--Get distinct values of the PIVOT Column \u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ColumnName\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; ISNULL(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ColumnName\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; QUOTENAME(Week)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DISTINCT\u0026lt;/span\u0026gt; Week \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; #StoreSales) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; Weeks\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--Prepare the PIVOT query using the dynamic \u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SET\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@DynamicPivotQuery\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \n  N\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT Store, \u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ColumnName\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \n    FROM #StoreSales\n    PIVOT(SUM(xCount) \n          FOR Week IN (\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ColumnName\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)) AS PVTTable\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--Execute the Dynamic Pivot Query\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;EXEC\u0026lt;/span\u0026gt; sp_executesql \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@DynamicPivotQuery\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I\u0026apos;ve achieved the same thing before by using subqueries.  So if your original table was called StoreCountsByWeek, and you had a separate table that listed the Store IDs, then it would look like this:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; StoreID, \n    Week1\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; ISNULL(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUM\u0026lt;/span\u0026gt;(xCount),\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; StoreCountsByWeek \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; StoreCountsByWeek.StoreID\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;Store.StoreID \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AND\u0026lt;/span\u0026gt; Week\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;),\n    Week2\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; ISNULL(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUM\u0026lt;/span\u0026gt;(xCount),\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; StoreCountsByWeek \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; StoreCountsByWeek.StoreID\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;Store.StoreID \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AND\u0026lt;/span\u0026gt; Week\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;),\n    Week3\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; ISNULL(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUM\u0026lt;/span\u0026gt;(xCount),\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; StoreCountsByWeek \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; StoreCountsByWeek.StoreID\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;Store.StoreID \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AND\u0026lt;/span\u0026gt; Week\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Store\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ORDER\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; StoreID\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;One advantage to this method is that the syntax is more clear and it makes it easier to join to other tables to pull other fields into the results too.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;My anecdotal results are that running this query over a couple of thousand rows completed in less than one second, and I actually had 7 subqueries.  But as noted in the comments, it is more computationally expensive to do it this way, so be careful about using this method if you expect it to run on large amounts of data .\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;This is what you can do:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; yourTable\nPIVOT (\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;MAX\u0026lt;/span\u0026gt;(xCount) \n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; Week \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; ([\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;],[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;],[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;],[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;],[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;],[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;6\u0026lt;/span\u0026gt;],[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;7\u0026lt;/span\u0026gt;])) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; pvt\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://www.sqlfiddle.com/#!3/16fd1/1\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;DEMO\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I\u0026apos;m writing an sp that could be useful for this purpose, basically this sp pivot any table and return a new table pivoted or return just the set of data, this is the way to execute it:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Exec\u0026lt;/span\u0026gt; dbo.rs_pivot_table \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@schema\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;dbo,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;table_name,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;column_to_pivot,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;sum([column_to_agg]),avg([another_column_to_agg]),\u0026apos;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sel\u0026lt;/span\u0026gt;_cols\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;column_to_select1,column_to_select2,column_to_select1\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;returned_table_pivoted;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;please note\u0026lt;/strong\u0026gt; that in the parameter @agg the column names must be with \u0026lt;code\u0026gt;\u0026apos;[\u0026apos;\u0026lt;/code\u0026gt; and the parameter must end with a comma \u0026lt;code\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;SP\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Create\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Procedure\u0026lt;/span\u0026gt; [dbo].[rs_pivot_table]\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@schema\u0026lt;/span\u0026gt; sysname\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;dbo,\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt; sysname,\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt; sysname,\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt; nvarchar(max),\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sel\u0026lt;/span\u0026gt;_cols \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(max),\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table sysname,\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@add\u0026lt;/span\u0026gt;_to_col_name sysname\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;As\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--Exec dbo.rs_pivot_table dbo,##TEMPORAL1,tip_liq,\u0026apos;sum([val_liq]),sum([can_liq]),\u0026apos;,\u0026apos;cod_emp,cod_con,tip_liq\u0026apos;,##TEMPORAL1PVT,\u0026apos;hola\u0026apos;;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Begin\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(max)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@opp\u0026lt;/span\u0026gt;_agg \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@col\u0026lt;/span\u0026gt;_agg \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@pivot\u0026lt;/span\u0026gt;_col sysname;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;_col_pvt \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(max)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(max)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ind\u0026lt;/span\u0026gt;_tmpTbl \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--Indicador de tabla temporal 1=tabla temporal global 0=Tabla fisica\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Create\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Table\u0026lt;/span\u0026gt; #pvt_column(\n        pivot_col \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;)\n    );\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;_agg \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt;(\n        opp_agg \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;),\n        col_agg \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;)\n    );\n\n    IF  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;EXISTS\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; sys.objects \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; object_id \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; OBJECT_ID(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AND\u0026lt;/span\u0026gt; type \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; (N\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;U\u0026apos;\u0026lt;/span\u0026gt;))\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ind\u0026lt;/span\u0026gt;_tmpTbl\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ELSE\u0026lt;/span\u0026gt; IF OBJECT_ID(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;tempdb..\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;ltrim(rtrim(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt;))) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;IS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NOT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NULL\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ind\u0026lt;/span\u0026gt;_tmpTbl\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;;\n\n    IF  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;EXISTS\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; sys.objects \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; object_id \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; OBJECT_ID(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AND\u0026lt;/span\u0026gt; type \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; (N\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;U\u0026apos;\u0026lt;/span\u0026gt;)) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;OR\u0026lt;/span\u0026gt; \n        OBJECT_ID(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;tempdb..\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;ltrim(rtrim(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table))) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;IS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NOT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NULL\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Begin\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;DROP TABLE \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Exec\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;End\u0026lt;/span\u0026gt;;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Select distinct \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; From \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;when\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ind\u0026lt;/span\u0026gt;_tmpTbl\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;tempdb.\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;end\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@schema\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;.\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; where \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; is not null;\u0026apos;\u0026lt;/span\u0026gt;;\n    Print \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Insert\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;into\u0026lt;/span\u0026gt; #pvt_column(pivot_col)\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Exec\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;)\n\n    While charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Begin\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Substring\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt;);\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Insert\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Into\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;_agg(opp_agg,col_agg)\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Values\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;substring\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;(\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt;),ltrim(rtrim(replace(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;substring\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt;,charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;[\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;),charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;]\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-4\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;))));\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Substring\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;,charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,len(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;))\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;End\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; cur_agg \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;cursor\u0026lt;/span\u0026gt; read_only forward_only \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;local\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \n        opp_agg,col_agg\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;_agg;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Open\u0026lt;/span\u0026gt; cur_agg;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Fetch\u0026lt;/span\u0026gt; Next \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;From\u0026lt;/span\u0026gt; cur_agg\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Into\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@opp\u0026lt;/span\u0026gt;_agg,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@col\u0026lt;/span\u0026gt;_agg;\n\n    While @\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@fetch\u0026lt;/span\u0026gt;_status\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Begin\u0026lt;/span\u0026gt;\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; cur_col \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;cursor\u0026lt;/span\u0026gt; read_only forward_only \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;local\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \n            pivot_col \n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;From\u0026lt;/span\u0026gt; #pvt_column;\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Open\u0026lt;/span\u0026gt; cur_col;\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Fetch\u0026lt;/span\u0026gt; Next \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;From\u0026lt;/span\u0026gt; cur_col\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Into\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@pivot\u0026lt;/span\u0026gt;_col;\n\n        While @\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@fetch\u0026lt;/span\u0026gt;_status\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Begin\u0026lt;/span\u0026gt;\n\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;_col_pvt\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;isnull(\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@opp\u0026lt;/span\u0026gt;_agg\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;(case when \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;=\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;quotename(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@pivot\u0026lt;/span\u0026gt;_col,\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;char\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;39\u0026lt;/span\u0026gt;))\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; then \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@col\u0026lt;/span\u0026gt;_agg\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; else null end),0) as [\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;lower\u0026lt;/span\u0026gt;(Replace(Replace(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@opp\u0026lt;/span\u0026gt;_agg\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;_\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;convert\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@pivot\u0026lt;/span\u0026gt;_col)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;_\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;replace(replace(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@col\u0026lt;/span\u0026gt;_agg,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;[\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;]\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026amp;amp;\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;))\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\n                (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;when\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@add\u0026lt;/span\u0026gt;_to_col_name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;is\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; space(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;_\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;isnull(ltrim(rtrim(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@add\u0026lt;/span\u0026gt;_to_col_name)),\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;end\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;]\u0026apos;\u0026lt;/span\u0026gt;\n            print \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;_col_pvt\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;_col_pvt\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;, \u0026apos;\u0026lt;/span\u0026gt;\n\n            \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--print @full_query_pivot\u0026lt;/span\u0026gt;\n\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Fetch\u0026lt;/span\u0026gt; Next \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;From\u0026lt;/span\u0026gt; cur_col\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Into\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@pivot\u0026lt;/span\u0026gt;_col;        \n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;End\u0026lt;/span\u0026gt;     \n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Close\u0026lt;/span\u0026gt; cur_col;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Deallocate\u0026lt;/span\u0026gt; cur_col;\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Fetch\u0026lt;/span\u0026gt; Next \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;From\u0026lt;/span\u0026gt; cur_agg\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Into\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@opp\u0026lt;/span\u0026gt;_agg,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@col\u0026lt;/span\u0026gt;_agg; \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;End\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Close\u0026lt;/span\u0026gt; cur_agg;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Deallocate\u0026lt;/span\u0026gt; cur_agg;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;substring\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,len(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot)\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt;);\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Select \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sel\u0026lt;/span\u0026gt;_cols\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; into \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; From \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;when\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ind\u0026lt;/span\u0026gt;_tmpTbl\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;tempdb.\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;end\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@schema\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;.\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; Group by \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sel\u0026lt;/span\u0026gt;_cols\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;;\u0026apos;\u0026lt;/span\u0026gt;;\n\n    print \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Exec\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;End\u0026lt;/span\u0026gt;;\nGO\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;This is an example of execution:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Exec\u0026lt;/span\u0026gt; dbo.rs_pivot_table \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@schema\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;dbo,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;##TEMPORAL1,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;tip_liq,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;sum([val_liq]),avg([can_liq]),\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sel\u0026lt;/span\u0026gt;_cols\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;cod_emp,cod_con,tip_liq\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;##TEMPORAL1PVT;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;then \u0026lt;code\u0026gt;Select * From ##TEMPORAL1PVT\u0026lt;/code\u0026gt; would return:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://i.stack.imgur.com/pGHCK.png\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;https://i.stack.imgur.com/pGHCK.png\u0026quot; alt=\u0026quot;enter image description here\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Here is a revision of @Tayrn answer above that might help you understand pivoting a little easier: \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This may not be the best way to do this, but this is what helped me wrap my head around how to pivot tables.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;ID = rows you want to pivot\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;MY_KEY = the column you are selecting from your original table that contains the column names you want to pivot.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;VAL = the value you want returning under each column.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;MAX(VAL) =\u0026amp;gt; Can be replaced with other aggregiate functions. SUM(VAL), MIN(VAL), ETC...\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; NVARCHAR(MAX),\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; NVARCHAR(MAX)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; STUFF((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; QUOTENAME(MY_KEY) \n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; yt\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;group\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; MY_KEY\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;order\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; MY_KEY \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ASC\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;), TYPE\n        ).\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;.\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;NVARCHAR(MAX)\u0026apos;\u0026lt;/span\u0026gt;) \n    ,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT ID,\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; from \n         (\n            select ID, MY_KEY, VAL \n            from yt\n        ) x\n        pivot \n        (\n            sum(VAL)\n            for MY_KEY in (\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)\n        ) p \u0026apos;\u0026lt;/span\u0026gt;\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;execute\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; name, ID \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; Empoyee) Visits\n    pivot(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;sum\u0026lt;/span\u0026gt;(ID) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; name\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; ([Emp1],\n    [Emp2],\n    [Emp3]\n    ) ) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; pivottable;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Just give you some idea how other databases solve this problem. \u0026lt;code\u0026gt;DolphinDB\u0026lt;/code\u0026gt; also has built-in support for pivoting and the sql looks much more intuitive and neat. It is as simple as specifying the key column (\u0026lt;code\u0026gt;Store\u0026lt;/code\u0026gt;), pivoting column (\u0026lt;code\u0026gt;Week\u0026lt;/code\u0026gt;), and the calculated metric (\u0026lt;code\u0026gt;sum(xCount)\u0026lt;/code\u0026gt;).\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prepare\u0026lt;/span\u0026gt; a \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt;million\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;row\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt;\nn\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10000000\u0026lt;/span\u0026gt;\nt\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt;(rand(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;, n) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; Store, rand(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;54\u0026lt;/span\u0026gt;, n) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; Week, rand(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;, n) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; xCount)\n\n\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;use pivot clause \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;to\u0026lt;/span\u0026gt; generate a pivoted \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt; pivot_t\npivot_t \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;sum\u0026lt;/span\u0026gt;(xCount) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; t pivot \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; Store, Week\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;DolphinDB is a columnar high performance database. The calculation in the demo costs as low as 546 ms on a dell xps laptop (i7 cpu).  To get more details, please refer to online DolphinDB manual \u0026lt;a href=\u0026quot;https://www.dolphindb.com/help/index.html?pivotby.html\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;https://www.dolphindb.com/help/index.html?pivotby.html\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Pivot is one of the SQL operator which is used to turn the unique data from one column into multiple column in the output. This is also mean by transforming the rows into columns (rotating table). Let us consider this table,\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://i.stack.imgur.com/iEOQ0.png\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;https://i.stack.imgur.com/iEOQ0.png\u0026quot; alt=\u0026quot;enter image description here\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;If I want to filter this data based on the types of product (Speaker, Glass, Headset) by each customer, then use Pivot operator.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; CustmerName, Speaker, Glass, Headset  \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; TblCustomer  \n   Pivot  \n    (  \n     \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Sum\u0026lt;/span\u0026gt;(Price) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; Product \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; ([Speaker],[Glass],[Headset])  \n    ) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; PivotTable \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://i.stack.imgur.com/Y1kSv.png\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;https://i.stack.imgur.com/Y1kSv.png\u0026quot; alt=\u0026quot;enter image description here\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    "],"id":543,"title":"Convert Rows to columns using 'Pivot' in SQL Server","content":"\n                \n\u0026lt;p\u0026gt;I have read the stuff on MS pivot tables and I am still having problems getting this correct.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I have a temp table that is being created, we will say that column 1 is a Store number, and column 2 is a week number and lastly column 3 is a total of some type. Also the Week numbers are dynamic, the store numbers are static.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;Store      Week     xCount\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-------    ----     ------\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;96\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;138\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;37\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;59\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;282\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;212\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;78\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;97\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;60\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;123\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;220\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;87\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;I would like it to come out as a pivot table, like this:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;Store        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;          \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;          \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;6.\u0026lt;/span\u0026gt;...\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;----- \u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;138\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;282\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;220\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;         \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;96\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;212\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;123\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;         \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;37\u0026lt;/span\u0026gt;        \n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Store numbers down the side and weeks across the top.\u0026lt;/p\u0026gt;\n    ","slug":"convert-rows-to-columns-using-'pivot'-in-sql-server-1657388372528","postType":"QUESTION","createdAt":"2022-07-09T17:39:32.000Z","updatedAt":"2022-07-09T17:39:32.000Z","tags":[{"id":2653,"name":"pivot-table","slug":"pivot-table","createdAt":"2022-07-09T17:39:32.000Z","updatedAt":"2022-07-09T17:39:32.000Z","Questions_Tags":{"questionId":543,"tagId":2653}}],"relatedQuestions":[{"title":"Convert Rows to columns using 'Pivot' in SQL Server","slug":"convert-rows-to-columns-using-'pivot'-in-sql-server-1657388372528","tags":[{"name":"pivot-table","Questions_Tags":{"questionId":543,"tagId":2653}}]}]},"randomQuestions":[{"title":"javascript function doesn't work when link is clicked","slug":"javascript-function-doesn't-work-when-link-is-clicked-1657387767488"},{"title":"How to count the number of set bits in a 32-bit integer?","slug":"how-to-count-the-number-of-set-bits-in-a-32-bit-integer-1657388437370"},{"title":"What does it mean to \"program to an interface\"?","slug":"what-does-it-mean-to-\"program-to-an-interface\"-1657384671665"},{"title":"What is a plain English explanation of \"Big O\" notation?","slug":"what-is-a-plain-english-explanation-of-\"big-o\"-notation-1657387641953"},{"title":"What does \"list comprehension\" and similar mean? How does it work and how can I use it?","slug":"what-does-\"list-comprehension\"-and-similar-mean-how-does-it-work-and-how-can-i-use-it-1657387996940"},{"title":"Why does printf not flush after the call unless a newline is in the format string?","slug":"why-does-printf-not-flush-after-the-call-unless-a-newline-is-in-the-format-string-1657387853407"},{"title":"Make a div fill the height of the remaining screen space","slug":"make-a-div-fill-the-height-of-the-remaining-screen-space-1657387482387"},{"title":"How do I profile C++ code running on Linux?","slug":"how-do-i-profile-c++-code-running-on-linux-1657384754272"},{"title":"What to do Regular expression pattern doesn't match anywhere in string?","slug":"what-to-do-regular-expression-pattern-doesn't-match-anywhere-in-string-1657388095896"},{"title":"How do I match any character across multiple lines in a regular expression?","slug":"how-do-i-match-any-character-across-multiple-lines-in-a-regular-expression-1657387839720"},{"title":"How can I deserialize JSON with C#?","slug":"how-can-i-deserialize-json-with-c-1657388102941"},{"title":"How do I execute a program or call a system command?","slug":"how-do-i-execute-a-program-or-call-a-system-command-1657385465629"},{"title":"Why Use Integer Instead of Long?","slug":"why-use-integer-instead-of-long-1657388012352"},{"title":"How do I pass data between Activities in Android application?","slug":"how-do-i-pass-data-between-activities-in-android-application-1657384739839"},{"title":"Swing GUI listeners without AWT","slug":"swing-gui-listeners-without-awt-1657387522426"},{"title":"How to use java.net.URLConnection to fire and handle HTTP requests","slug":"how-to-use-java.net.urlconnection-to-fire-and-handle-http-requests-1657387245934"},{"title":"Understanding slicing","slug":"understanding-slicing-1657384397680"},{"title":"Iterator invalidation rules for C++ containers","slug":"iterator-invalidation-rules-for-c++-containers-1657387561090"},{"title":"Why does my ArrayList contain N copies of the last item added to the list?","slug":"why-does-my-arraylist-contain-n-copies-of-the-last-item-added-to-the-list-1657387712003"},{"title":"How to choose the right bean scope?","slug":"how-to-choose-the-right-bean-scope-1657387596513"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"convert-rows-to-columns-using-'pivot'-in-sql-server-1657388372528"},"buildId":"Zo3C7AOWQzKM9qqyzx2hf","isFallback":false,"gsp":true,"locale":"en","locales":["en"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>