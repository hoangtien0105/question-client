<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find the solution to any question. We focus on finding the fastest possible solution for users. Main topics like coding, learning. - solutionschecker.com"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><link name="keywords" content="architecture,model,solutions checker, solution checker, how to, solution for, check for solution, resolve question, what is, what solution for, find solution"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://solutionschecker.com","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@id":"https://solutionschecker.com/questions","name":"Questions"}},{"@type":"ListItem","position":3,"item":{"@id":"https://solutionschecker.com/questions/how-should-a-model-be-structured-in-mvc-closed-1657388394807","name":"Questions"}}]}</script><title>How should a model be structured in MVC? [closed] | Solution Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="
            
        
            
                
                    
                        Closed. This question is opinion-based. It is not currently accepting answers.
                        
                    
                
            
        
            
        
            
                
                        
                            
                        
                    Want to improve this question? Update the question so it can be answered with facts and citations by editing this post.
                
                    
                        Closed 3 years ago.
                    
                

                
            
        
            
                    
                        Improve this question
                    
            


    

I am just getting a grasp on the MVC framework and I often wonder how much code should go in the model. I tend to have a data access class that has methods like this:

public function CheckUsername($connection, $username)
{
    try
    {
        $data = array();
        $data[&#x27;Username&#x27;] = $username;

        //// SQL
        $sql = &quot;SELECT Username FROM&quot; . $this-&gt;usersTableName . &quot; WHERE Username = :Username&quot;;

        //// Execute statement
        return $this-&gt;ExecuteObject($connection, $sql, $data);
    }
    catch(Exception $e)
    {
        throw $e;
    }
}


My models tend to be an entity class that is mapped to the database table.

Should the model object have all the database mapped properties as well as the code above or is it OK to separate that code out that actually does the database work?

Will I end up having four layers?
    "/><meta property="og:title" content="How should a model be structured in MVC? [closed] | Solution Checker"/><meta property="og:description" content="
            
        
            
                
                    
                        Closed. This question is opinion-based. It is not currently accepting answers.
                        
                    
                
            
        
            
        
            
                
                        
                            
                        
                    Want to improve this question? Update the question so it can be answered with facts and citations by editing this post.
                
                    
                        Closed 3 years ago.
                    
                

                
            
        
            
                    
                        Improve this question
                    
            


    

I am just getting a grasp on the MVC framework and I often wonder how much code should go in the model. I tend to have a data access class that has methods like this:

public function CheckUsername($connection, $username)
{
    try
    {
        $data = array();
        $data[&#x27;Username&#x27;] = $username;

        //// SQL
        $sql = &quot;SELECT Username FROM&quot; . $this-&gt;usersTableName . &quot; WHERE Username = :Username&quot;;

        //// Execute statement
        return $this-&gt;ExecuteObject($connection, $sql, $data);
    }
    catch(Exception $e)
    {
        throw $e;
    }
}


My models tend to be an entity class that is mapped to the database table.

Should the model object have all the database mapped properties as well as the code above or is it OK to separate that code out that actually does the database work?

Will I end up having four layers?
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"How should a model be structured in MVC? [closed]","text":"\n            \n        \n            \n                \n                    \n                        Closed. This question is opinion-based. It is not currently accepting answers.\n                        \n                    \n                \n            \n        \n            \n        \n            \n                \n                        \n                            \n                        \n                    Want to improve this question? Update the question so it can be answered with facts and citations by editing this post.\n                \n                    \n                        Closed 3 years ago.\n                    \n                \n\n                \n            \n        \n            \n                    \n                        Improve this question\n                    \n            \n\n\n    \n\nI am just getting a grasp on the MVC framework and I often wonder how much code should go in the model. I tend to have a data access class that has methods like this:\n\npublic function CheckUsername($connection, $username)\n{\n    try\n    {\n        $data = array();\n        $data[&apos;Username&apos;] = $username;\n\n        //// SQL\n        $sql = &quot;SELECT Username FROM&quot; . $this-&gt;usersTableName . &quot; WHERE Username = :Username&quot;;\n\n        //// Execute statement\n        return $this-&gt;ExecuteObject($connection, $sql, $data);\n    }\n    catch(Exception $e)\n    {\n        throw $e;\n    }\n}\n\n\nMy models tend to be an entity class that is mapped to the database table.\n\nShould the model object have all the database mapped properties as well as the code above or is it OK to separate that code out that actually does the database work?\n\nWill I end up having four layers?\n    ","answerCount":5,"upVoteCount":500,"suggestedAnswer":[{"text":"\n  Disclaimer: the following is a description of how I understand MVC-like patterns in the context of PHP-based web applications. All the external links that are used in the content are there to explain terms and concepts, and not to imply my own credibility on the subject.\n\n\nThe first thing that I must clear up is: the model is a layer.\n\nSecond: there is a difference between classical MVC and what we use in web development. Here&apos;s a bit of an older answer I wrote, which briefly describes how they are different.\n\nWhat a model is NOT:\n\nThe model is not a class or any single object. It is a very common mistake to make (I did too, though the original answer was written when I began to learn otherwise), because most frameworks perpetuate this misconception.\n\nNeither is it an Object-Relational Mapping technique (ORM) nor an abstraction of database tables. Anyone who tells you otherwise is most likely trying to &apos;sell&apos; another brand-new ORM or a whole framework.\n\nWhat a model is:\n\nIn proper MVC adaptation, the M contains all the domain business logic and the Model Layer is mostly made from three types of structures:\n\n\nDomain Objects\n\n\n  A domain object is a logical container of purely domain information; it usually represents a logical entity in the problem domain space. Commonly referred to as business logic.\n\n\nThis would be where you define how to validate data before sending an invoice, or to compute the total cost of an order. At the same time, Domain Objects are completely unaware of storage - neither from where (SQL database, REST API, text file, etc.) nor even if they get saved or retrieved.\nData Mappers\n\nThese objects are only responsible for the storage. If you store information in a database, this would be where the SQL lives. Or maybe you use an XML file to store data, and your Data Mappers are parsing from and to XML files.\nServices\n\nYou can think of them as &quot;higher level Domain Objects&quot;, but instead of business logic, Services are responsible for interaction between Domain Objects and Mappers. These structures end up creating a &quot;public&quot; interface for interacting with the domain business logic. You can avoid them, but at the penalty of leaking some domain logic into Controllers.\n\nThere is a related answer to this subject in the ACL implementation question - it might be useful.\n\n\nThe communication between the model layer and other parts of the MVC triad should happen only through Services. The clear separation has a few additional benefits:\n\n\nit helps to enforce the single responsibility principle (SRP)\nprovides additional &apos;wiggle room&apos; in case the logic changes\nkeeps the controller as simple as possible\ngives a clear blueprint, if you ever need an external API\n\n\n \n\nHow to interact with a model?\n\n\n  Prerequisites: watch lectures &quot;Global State and Singletons&quot; and &quot;Don&apos;t Look For Things!&quot; from the Clean Code Talks.\n\n\nGaining access to service instances\n\nFor both the View and Controller instances (what you could call: &quot;UI layer&quot;) to have access these services,  there are two general approaches: \n\n\nYou can inject the required services in the constructors of your views and controllers directly, preferably using a DI container. \nUsing a factory for services as a mandatory dependency for all of your views and controllers. \n\n\nAs you might suspect, the DI container is a lot more elegant solution (while not being the easiest for a beginner). The two libraries, that I recommend considering for this functionality would be Syfmony&apos;s standalone DependencyInjection component or Auryn. \n\nBoth the solutions using a factory and a DI container would let you also share the instances of various servers to be shared between the selected controller and view for a given request-response cycle.\n\nAlteration of model&apos;s state\n\nNow that you can access to the model layer in the controllers, you need to start actually using them: \n\npublic function postLogin(Request $request)\n{\n    $email = $request-&gt;get(&apos;email&apos;);\n    $identity = $this-&gt;identification-&gt;findIdentityByEmailAddress($email);\n    $this-&gt;identification-&gt;loginWithPassword(\n        $identity,\n        $request-&gt;get(&apos;password&apos;)\n    );\n}\n\n\nYour controllers have a very clear task: take the user input and, based on this input, change the current state of business logic. In this example the states that are changed between are &quot;anonymous user&quot; and &quot;logged in user&quot;. \n\nController is not responsible for validating user&apos;s input, because that is part of business rules and controller is definitely not calling SQL queries, like what you would see here or here (please don&apos;t hate on them, they are misguided, not evil).\n\nShowing user the state-change.\n\nOk, user has logged in (or failed). Now what? Said user is still unaware of it. So you need to actually produce a response and that is the responsibility of a view. \n\npublic function postLogin()\n{\n    $path = &apos;/login&apos;;\n    if ($this-&gt;identification-&gt;isUserLoggedIn()) {\n        $path = &apos;/dashboard&apos;;\n    }\n    return new RedirectResponse($path); \n}\n\n\nIn this case, the view produced one of two possible responses, based on the current state of model layer. For a different use-case you would have the view picking different templates to render, based on something like &quot;current selected of article&quot; .\n\nThe presentation layer can actually get quite elaborate, as described here: Understanding MVC Views in PHP.\n\nBut I am just making a REST API!\n\nOf course, there are situations, when this is a overkill.\n\nMVC is just a concrete solution for Separation of Concerns principle. MVC separates user interface from the business logic, and it in the UI it separated handling of user input and the presentation. This is crucial. While often people describe it as a &quot;triad&quot;, it&apos;s not actually made up from three independent parts. The structure is more like this: \n\n\n\nIt means, that, when your presentation layer&apos;s logic is close to none-existent, the pragmatic approach is to keep them as single layer. It also can substantially simplify some aspects of model layer. \n\nUsing this approach the login example (for an API) can be written as:\n\npublic function postLogin(Request $request)\n{\n    $email = $request-&gt;get(&apos;email&apos;);\n    $data = [\n        &apos;status&apos; =&gt; &apos;ok&apos;,\n    ];\n    try {\n        $identity = $this-&gt;identification-&gt;findIdentityByEmailAddress($email);\n        $token = $this-&gt;identification-&gt;loginWithPassword(\n            $identity,\n            $request-&gt;get(&apos;password&apos;)\n        );\n    } catch (FailedIdentification $exception) {\n        $data = [\n            &apos;status&apos; =&gt; &apos;error&apos;,\n            &apos;message&apos; =&gt; &apos;Login failed!&apos;,\n        ]\n    }\n\n    return new JsonResponse($data);\n}\n\n\nWhile this is not sustainable, when you have complicate logic for rendering a response body, this simplification is very useful for more trivial scenarios. But be warned, this approach will become a nightmare, when attempting to use in large codebases with complex presentation logic.\n\n \n\nHow to build the model?\n\nSince there is not a single &quot;Model&quot; class (as explained above), you really do not &quot;build the model&quot;. Instead you start from making Services, which are able to perform certain methods. And then implement Domain Objects and Mappers.\n\nAn example of a service method:\n\nIn the both approaches above there was this login method for the identification service. What would it actually look like. I am using a slightly modified version of the same functionality from a library, that I wrote .. because I am lazy:\n\npublic function loginWithPassword(Identity $identity, string $password): string\n{\n    if ($identity-&gt;matchPassword($password) === false) {\n        $this-&gt;logWrongPasswordNotice($identity, [\n            &apos;email&apos; =&gt; $identity-&gt;getEmailAddress(),\n            &apos;key&apos; =&gt; $password, // this is the wrong password\n        ]);\n\n        throw new PasswordMismatch;\n    }\n\n    $identity-&gt;setPassword($password);\n    $this-&gt;updateIdentityOnUse($identity);\n    $cookie = $this-&gt;createCookieIdentity($identity);\n\n    $this-&gt;logger-&gt;info(&apos;login successful&apos;, [\n        &apos;input&apos; =&gt; [\n            &apos;email&apos; =&gt; $identity-&gt;getEmailAddress(),\n        ],\n        &apos;user&apos; =&gt; [\n            &apos;account&apos; =&gt; $identity-&gt;getAccountId(),\n            &apos;identity&apos; =&gt; $identity-&gt;getId(),\n        ],\n    ]);\n\n    return $cookie-&gt;getToken();\n}\n\n\nAs you can see, at this level of abstraction, there is no indication of where the data was fetched from. It might be a database, but it also might be just a mock object for testing purposes. Even the data mappers, that are actually used for it, are hidden away in the private methods of this service.\n\nprivate function changeIdentityStatus(Entity\\Identity $identity, int $status)\n{\n    $identity-&gt;setStatus($status);\n    $identity-&gt;setLastUsed(time());\n    $mapper = $this-&gt;mapperFactory-&gt;create(Mapper\\Identity::class);\n    $mapper-&gt;store($identity);\n}\n\n\nWays of creating mappers\n\nTo implement an abstraction of persistence, on the most flexible approaches is to create custom data mappers. \n\n\n\nFrom: PoEAA book\n\nIn practice they are implemented for interaction with specific classes or superclasses. Lets say you have Customer and Admin in your code (both inheriting from a User superclass). Both would probably end up having a separate matching mapper, since they contain different fields. But you will also end up with shared and commonly used operations. For example: updating the &quot;last seen online&quot; time. And instead of making the existing mappers more convoluted, the more pragmatic approach is to have a general &quot;User Mapper&quot;, which only update that timestamp.\n\nSome additional comments:\n\n\nDatabase tables and model\n\nWhile sometimes there is a direct 1:1:1 relationship between a database table, Domain Object, and Mapper, in larger projects it might be less common than you expect:\n\n\nInformation used by a single Domain Object might be mapped from different tables, while the object itself has no persistence in the database.\n\nExample: if you are generating a monthly report. This would collect information from different of tables, but there is no magical MonthlyReport table in the database.\nA single Mapper can affect multiple tables.\n\nExample: when you are storing data from the User object, this Domain Object could contain collection of other domain objects - Group instances. If you alter them and store the User, the Data Mapper will have to update and/or insert entries in multiple tables.\nData from a single Domain Object is stored in more than one table.\n\nExample: in large systems (think: a medium-sized social network), it might be pragmatic to store user authentication data and often-accessed data separately from larger chunks of content, which is rarely required. In that case you might still have a single User class, but the information it contains would depend of whether full details were fetched.\nFor every Domain Object there can be more than one mapper\n\nExample: you have a news site with a shared codebased for both public-facing and the management software. But, while both interfaces use the same Article class, the management needs a lot more info populated in it. In this case you would have two separate mappers: &quot;internal&quot; and &quot;external&quot;. Each performing different queries, or even use different databases (as in master or slave).\n\nA view is not a template\n\nView instances in MVC (if you are not using the MVP variation of the pattern) are responsible for the presentational logic. This means that each View will usually juggle at least a few templates. It acquires data from the Model Layer and then, based on the received information, chooses a template and sets values.\n\nOne of the benefits you gain from this is re-usability. If you create a ListView class, then, with well-written code, you can have the same class handing the presentation of user-list and comments below an article. Because they both have the same presentation logic. You just switch templates.\n\nYou can use either native PHP templates or use some third-party templating engine. There also might be some third-party libraries, which are able to fully replace View instances.\nWhat about the old version of the answer?\n\nThe only major change is that, what is called Model in the old version, is actually a Service. The rest of the &quot;library analogy&quot; keeps up pretty well.\n\nThe only flaw that I see is that this would be a really strange library, because it would return you information from the book, but not let you touch the book itself, because otherwise the abstraction would start to &quot;leak&quot;. I might have to think of a more fitting analogy.\nWhat is the relationship between View and Controller instances?\n\nThe MVC structure is composed of two layers: ui and model. The main structures in the UI layer are views and controller. \n\nWhen you are dealing with websites that use MVC design pattern, the best way is to have 1:1 relation between views and controllers. Each view represents a whole page in your website and it has a dedicated controller to handle all the incoming requests for that particular view.\n\nFor example, to represent an opened article, you would have \\Application\\Controller\\Document and \\Application\\View\\Document. This would contain all the main functionality for UI layer, when it comes to dealing with articles (of course you might have some XHR components that are not directly related to articles).\n\n    ","url":"https://solutionschecker.com/questions/how-should-a-model-be-structured-in-mvc-closed-1657388394807#solution1","@type":"Answer","upvoteCount":0},{"text":"Everything that is business logic belongs in a model, whether it is a database query, calculations, a REST call, etc.\n\nYou can have the data access in the model itself, the MVC pattern doesn&apos;t restrict you from doing that. You can sugar coat it with services, mappers and what not, but the actual definition of a model is a layer that handles business logic, nothing more, nothing less. It can be a class, a function, or a complete module with a gazillion objects if that&apos;s what you want.\n\nIt&apos;s always easier to have a separate object that actually executes the database queries instead of having them being executed in the model directly: this will especially come in handy when unit testing (because of the easiness of injecting a mock database dependency in your model):\n\nclass Database {\n   protected $_conn;\n\n   public function __construct($connection) {\n       $this-&gt;_conn = $connection;\n   }\n\n   public function ExecuteObject($sql, $data) {\n       // stuff\n   }\n}\n\nabstract class Model {\n   protected $_db;\n\n   public function __construct(Database $db) {\n       $this-&gt;_db = $db;\n   }\n}\n\nclass User extends Model {\n   public function CheckUsername($username) {\n       // ...\n       $sql = &quot;SELECT Username FROM&quot; . $this-&gt;usersTableName . &quot; WHERE ...&quot;;\n       return $this-&gt;_db-&gt;ExecuteObject($sql, $data);\n   }\n}\n\n$db = new Database($conn);\n$model = new User($db);\n$model-&gt;CheckUsername(&apos;foo&apos;);\n\n\nAlso, in PHP, you rarely need to catch/rethrow exceptions because the backtrace is preserved, especially in a case like your example. Just let the exception be thrown and catch it in the controller instead.\n    ","url":"https://solutionschecker.com/questions/how-should-a-model-be-structured-in-mvc-closed-1657388394807#solution2","@type":"Answer","upvoteCount":0},{"text":"In Web-&quot;MVC&quot; you can do whatever you please.\n\nThe original concept (1) described the model as the business logic. It should represent the application state and enforce some data consistency. That approach is often described as &quot;fat model&quot;.\n\nMost PHP frameworks follow a more shallow approach, where the model is just a database interface. But at the very least these models should still validate the incoming data and relations.\n\nEither way, you&apos;re not very far off if you separate the SQL stuff or database calls into another layer. This way you only need to concern yourself with the real data/behaviour, not with the actual storage API. (It&apos;s however unreasonable to overdo it. You&apos;ll e.g. never be able to replace a database backend with a filestorage if that wasn&apos;t designed ahead.)\n    ","url":"https://solutionschecker.com/questions/how-should-a-model-be-structured-in-mvc-closed-1657388394807#solution3","@type":"Answer","upvoteCount":0},{"text":"More oftenly most of the applications will have data,display and processing part and we just put all  those in the letters M,V and C.  \n\nModel(M)--&gt;Has the attributes that holds state of application and it dont know any thing about V and C.  \n\nView(V)--&gt;Has displaying format for the application and and only knows about how-to-digest model on it and does not bother about C.\n\nController(C)----&gt;Has processing part of application and acts as wiring between M and V and it depends on both M,V unlike M and V.  \n\nAltogether there is separation of concern between each.\nIn future any change or enhancements can be added very easily.\n    ","url":"https://solutionschecker.com/questions/how-should-a-model-be-structured-in-mvc-closed-1657388394807#solution4","@type":"Answer","upvoteCount":0},{"text":"In my case I have a database class that handle all the direct database interaction such as querying, fetching, and such. So if I had to change my database from MySQL to PostgreSQL there won&apos;t be any problem. So adding that extra layer can be useful.\nEach table can have its own class and have its specific methods, but to actually get the data, it lets the database class handle it:\nFile Database.php\nclass Database {\n    private static $connection;\n    private static $current_query;\n    ...\n\n    public static function query($sql) {\n        if (!self::$connection){\n            self::open_connection();\n        }\n        self::$current_query = $sql;\n        $result = mysql_query($sql,self::$connection);\n\n        if (!$result){\n            self::close_connection();\n            // throw custom error\n            // The query failed for some reason. here is query :: self::$current_query\n            $error = new Error(2,&quot;There is an Error in the query.\\n&lt;b&gt;Query:&lt;/b&gt;\\n{$sql}\\n&quot;);\n            $error-&gt;handleError();\n        }\n        return $result;\n    }\n ....\n\n    public static function find_by_sql($sql){\n        if (!is_string($sql))\n            return false;\n\n        $result_set = self::query($sql);\n        $obj_arr = array();\n        while ($row = self::fetch_array($result_set))\n        {\n            $obj_arr[] = self::instantiate($row);\n        }\n        return $obj_arr;\n    }\n}\n\nTable object classL\nclass DomainPeer extends Database {\n\n    public static function getDomainInfoList() {\n        $sql = &apos;SELECT &apos;;\n        $sql .=&apos;d.`id`,&apos;;\n        $sql .=&apos;d.`name`,&apos;;\n        $sql .=&apos;d.`shortName`,&apos;;\n        $sql .=&apos;d.`created_at`,&apos;;\n        $sql .=&apos;d.`updated_at`,&apos;;\n        $sql .=&apos;count(q.id) as queries &apos;;\n        $sql .=&apos;FROM `domains` d &apos;;\n        $sql .=&apos;LEFT JOIN queries q on q.domainId = d.id &apos;;\n        $sql .=&apos;GROUP BY d.id&apos;;\n        return self::find_by_sql($sql);\n    }\n\n    ....\n}\n\nI hope this example helps you create a good structure.\n    ","url":"https://solutionschecker.com/questions/how-should-a-model-be-structured-in-mvc-closed-1657388394807#solution5","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="22"/><script id="google-analytics" data-nscript="beforeInteractive">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NXVLL8B');</script><link rel="preload" href="/_next/static/css/c116652e2d6f4ad0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c116652e2d6f4ad0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-ccfab947c79712f4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-862498b6ec7885c3.js" defer=""></script><script src="/_next/static/chunks/294-106ef8570fa99deb.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-47289857226115f9.js" defer=""></script><script src="/_next/static/xZs8haGjOP63QuDE0kxeX/_buildManifest.js" defer=""></script><script src="/_next/static/xZs8haGjOP63QuDE0kxeX/_ssgManifest.js" defer=""></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NXVLL8B"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h1 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h1></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/how-should-a-model-be-structured-in-mvc-closed-1657388394807#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/how-should-a-model-be-structured-in-mvc-closed-1657388394807"><h1>How should a model be structured in MVC? [closed]</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/architecture">architecture</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/model">model</a></div></div><div class="question-content mt-5">
                    <div>
            <aside class="s-notice s-notice__info post-notice js-post-notice mb16" role="status">
        <div class="d-flex fd-column fw-nowrap">
            <div class="d-flex fw-nowrap">
                <div class="flex--item wmn0 fl1 lh-lg">
                    <div class="flex--item fl1 lh-lg">
                        <b>Closed</b>. This question is <a href="/help/closed-questions">opinion-based</a>. It is not currently accepting answers.
                        
                    </div>
                </div>
            </div>
        </div>
            <hr class="my12 outline-none baw0 bb bc-powder-400">
        <div class="fw-nowrap fc-black-600">
            <div class="d-flex fd-column lh-md">
                <div class="mb0 d-flex">
                        <div class="flex--item mr8">
                            <svg aria-hidden="true" class="svg-icon iconLightbulb" width="18" height="18" viewBox="0 0 18 18"><path d="M15 6.38A6.48 6.48 0 0 0 7.78.04h-.02A6.49 6.49 0 0 0 2.05 5.6a6.31 6.31 0 0 0 2.39 5.75c.49.39.76.93.76 1.5v.24c0 1.07.89 1.9 1.92 1.9h2.75c1.04 0 1.92-.83 1.92-1.9v-.2c0-.6.26-1.15.7-1.48A6.32 6.32 0 0 0 15 6.37ZM4.03 5.85A4.49 4.49 0 0 1 8 2.02a4.48 4.48 0 0 1 5 4.36 4.3 4.3 0 0 1-1.72 3.44c-.98.74-1.5 1.9-1.5 3.08v.1H7.2v-.14c0-1.23-.6-2.34-1.53-3.07a4.32 4.32 0 0 1-1.64-3.94ZM10 18a1 1 0 0 0 0-2H7a1 1 0 1 0 0 2h3Z"></path></svg>
                        </div>
                    <p><b>Want to improve this question?</b> Update the question so it can be answered with facts and citations by <a href="/posts/5863870/edit">editing this post</a>.</p>
                </div>
                    <div class="mb0 mt6 d-flex">
                        <p class="ml24 pl2">Closed <span title="2018-11-22 00:32:07Z" class="relativetime">3 years ago</span>.</p>
                    </div>
                <div class="ml24 pl2">

                </div>
            </div>
        </div>
            <div class="mt24 d-flex gsx gs8">
                    <a class="s-btn s-btn__outlined flex--item js-post-notice-edit-post" href="/posts/5863870/edit">
                        Improve this question
                    </a>
            </div>
</aside>

    </div>

<p>I am just getting a grasp on the MVC framework and I often wonder how much code should go in the model. I tend to have a data access class that has methods like this:</p>

<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">CheckUsername</span>(<span class="hljs-params"><span class="hljs-variable">$connection</span>, <span class="hljs-variable">$username</span></span>)
</span>{
    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-variable">$data</span> = <span class="hljs-keyword">array</span>();
        <span class="hljs-variable">$data</span>[<span class="hljs-string">'Username'</span>] = <span class="hljs-variable">$username</span>;

        <span class="hljs-comment">//// SQL</span>
        <span class="hljs-variable">$sql</span> = <span class="hljs-string">"SELECT Username FROM"</span> . <span class="hljs-variable language_">$this</span>-&gt;usersTableName . <span class="hljs-string">" WHERE Username = :Username"</span>;

        <span class="hljs-comment">//// Execute statement</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">ExecuteObject</span>(<span class="hljs-variable">$connection</span>, <span class="hljs-variable">$sql</span>, <span class="hljs-variable">$data</span>);
    }
    <span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>)
    {
        <span class="hljs-keyword">throw</span> <span class="hljs-variable">$e</span>;
    }
}
</code></pre>

<p>My models tend to be an entity class that is mapped to the database table.</p>

<p>Should the model object have all the database mapped properties as well as the code above or is it OK to separate that code out that actually does the database work?</p>

<p>Will I end up having four layers?</p>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><h1 class="text-lg font-semibold mb-5">Navigate to solutions: </h1><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li><li class="pagination-solution-item"><span data-id="#solution3" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">3</span></li><li class="pagination-solution-item"><span data-id="#solution4" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">4</span></li><li class="pagination-solution-item"><span data-id="#solution5" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">5</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 1</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/architecture">architecture</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/model">model</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<blockquote>
  <p><sub><strong>Disclaimer:</strong> the following is a description of how I understand MVC-like patterns in the context of PHP-based web applications. All the external links that are used in the content are there to explain terms and concepts, and <strong>not</strong> to imply my own credibility on the subject.</sub></p>
</blockquote>

<p>The first thing that I must clear up is: <strong>the model is a layer</strong>.</p>

<p>Second: there is a difference between <em>classical MVC</em> and what we use in web development. <a href="https://stackoverflow.com/a/7622038/727208">Here's</a> a bit of an older answer I wrote, which briefly describes how they are different.</p>

<h3>What a model is NOT:</h3>

<p>The model is not a class or any single object. It is a very common mistake to make <em>(I did too, though the original answer was written when I began to learn otherwise)</em>, because most frameworks perpetuate this misconception.</p>

<p>Neither is it an Object-Relational Mapping technique (ORM) nor an abstraction of database tables. Anyone who tells you otherwise is most likely trying to <em>'sell'</em> another brand-new ORM or a whole framework.</p>

<h3>What a model is:</h3>

<p>In proper MVC adaptation, the M contains all the domain business logic and the <em>Model Layer</em> is <strong>mostly</strong> made from three types of structures:</p>

<ul>
<li><p><a href="http://c2.com/cgi/wiki?DomainObject" rel="noreferrer"><em>Domain Objects</em></a></p>

<blockquote>
  <p>A domain object is a logical container of purely domain information; it usually represents a logical entity in the problem domain space. Commonly referred to as <em>business logic</em>.</p>
</blockquote>

<p>This would be where you define how to validate data before sending an invoice, or to compute the total cost of an order. At the same time, <em>Domain Objects</em> are completely unaware of storage - neither from <em>where</em> (SQL database, REST API, text file, etc.) nor even <em>if</em> they get saved or retrieved.</p></li>
<li><p><a href="http://martinfowler.com/eaaCatalog/dataMapper.html" rel="noreferrer"><em>Data Mappers</em></a></p>

<p>These objects are only responsible for the storage. If you store information in a database, this would be where the SQL lives. Or maybe you use an XML file to store data, and your <em>Data Mappers</em> are parsing from and to XML files.</p></li>
<li><p><a href="http://martinfowler.com/eaaCatalog/serviceLayer.html" rel="noreferrer"><em>Services</em></a></p>

<p>You can think of them as "higher level Domain Objects", but instead of business logic, <em>Services</em> are responsible for interaction between <em>Domain Objects</em> and <em>Mappers</em>. These structures end up creating a "public" interface for interacting with the domain business logic. You can avoid them, but at the penalty of leaking some domain logic into <em>Controllers</em>.</p>

<p>There is a related answer to this subject in the <a href="https://stackoverflow.com/a/9685039/727208">ACL implementation</a> question - it might be useful.</p></li>
</ul>

<p>The communication between the model layer and other parts of the MVC triad should happen only through <em>Services</em>. The clear separation has a few additional benefits:</p>

<ul>
<li>it helps to enforce the <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle" rel="noreferrer">single responsibility principle</a> (SRP)</li>
<li>provides additional 'wiggle room' in case the logic changes</li>
<li>keeps the controller as simple as possible</li>
<li>gives a clear blueprint, if you ever need an external API</li>
</ul>

<p>&nbsp;</p>

<h1>How to interact with a model?</h1>

<blockquote>
  <p><sub><em><strong>Prerequisites:</strong> watch lectures <a href="http://www.youtube.com/watch?v=-FRm3VPhseI" rel="noreferrer">"Global State and Singletons"</a> and <a href="http://www.youtube.com/watch?v=RlfLCWKxHJ0" rel="noreferrer">"Don't Look For Things!"</a> from the Clean Code Talks.</em></sub></p>
</blockquote>

<h3>Gaining access to service instances</h3>

<p>For both the <em>View</em> and <em>Controller</em> instances (what you could call: "UI layer") to have access these services,  there are two general approaches: </p>

<ol>
<li>You can inject the required services in the constructors of your views and controllers directly, preferably using a DI container. </li>
<li>Using a factory for services as a mandatory dependency for all of your views and controllers. </li>
</ol>

<p>As you might suspect, the DI container is a lot more elegant solution (while not being the easiest for a beginner). The two libraries, that I recommend considering for this functionality would be Syfmony's standalone <a href="http://symfony.com/doc/master/components/dependency_injection.html" rel="noreferrer">DependencyInjection component</a> or <a href="https://github.com/rdlowrey/auryn" rel="noreferrer">Auryn</a>. </p>

<p>Both the solutions using a factory and a DI container would let you also share the instances of various servers to be shared between the selected controller and view for a given request-response cycle.</p>

<h3>Alteration of model's state</h3>

<p>Now that you can access to the model layer in the controllers, you need to start actually using them: </p>

<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">postLogin</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)
</span>{
    <span class="hljs-variable">$email</span> = <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'email'</span>);
    <span class="hljs-variable">$identity</span> = <span class="hljs-variable language_">$this</span>-&gt;identification-&gt;<span class="hljs-title function_ invoke__">findIdentityByEmailAddress</span>(<span class="hljs-variable">$email</span>);
    <span class="hljs-variable language_">$this</span>-&gt;identification-&gt;<span class="hljs-title function_ invoke__">loginWithPassword</span>(
        <span class="hljs-variable">$identity</span>,
        <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'password'</span>)
    );
}
</code></pre>

<p>Your controllers have a very clear task: take the user input and, based on this input, change the current state of business logic. In this example the states that are changed between are "anonymous user" and "logged in user". </p>

<p>Controller is not responsible for validating user's input, because that is part of business rules and controller is definitely not calling SQL queries, like what you would see <a href="https://stackoverflow.com/questions/44535565/codeigniniter-insert-data-through-models-and-controller">here</a> or <a href="https://stackoverflow.com/questions/27025412/loading-multiple-select-options-into-array">here</a> (please don't hate on them, they are misguided, not evil).</p>

<h3>Showing user the state-change.</h3>

<p>Ok, user has logged in (or failed). <a href="http://i0.kym-cdn.com/photos/images/original/001/142/233/897.gif" rel="noreferrer">Now what?</a> Said user is still unaware of it. So you need to actually produce a response and that is the responsibility of a view. </p>

<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">postLogin</span>(<span class="hljs-params"></span>)
</span>{
    <span class="hljs-variable">$path</span> = <span class="hljs-string">'/login'</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;identification-&gt;<span class="hljs-title function_ invoke__">isUserLoggedIn</span>()) {
        <span class="hljs-variable">$path</span> = <span class="hljs-string">'/dashboard'</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedirectResponse</span>(<span class="hljs-variable">$path</span>); 
}
</code></pre>

<p>In this case, the view produced one of two possible responses, based on the current state of model layer. For a different use-case you would have the view picking different templates to render, based on something like "current selected of article" .</p>

<p>The presentation layer can actually get quite elaborate, as described here: <a href="https://stackoverflow.com/a/16596704/727208">Understanding MVC Views in PHP</a>.</p>

<h3>But I am just making a REST API!</h3>

<p>Of course, there are situations, when this is a overkill.</p>

<p>MVC is just a concrete solution for <a href="https://en.wikipedia.org/wiki/Separation_of_concerns" rel="noreferrer">Separation of Concerns</a> principle. <em>MVC separates user interface from the business logic, and it in the UI it separated handling of user input and the presentation.</em> This is crucial. While often people describe it as a "triad", it's not actually made up from three independent parts. The structure is more like this: </p>

<p><img src="https://i.stack.imgur.com/iEn76.png" alt="MVC separation"></p>

<p>It means, that, when your presentation layer's logic is close to none-existent, the pragmatic approach is to keep them as single layer. It also can substantially simplify some aspects of model layer. </p>

<p>Using this approach the login example (for an API) can be written as:</p>

<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">postLogin</span>(<span class="hljs-params">Request <span class="hljs-variable">$request</span></span>)
</span>{
    <span class="hljs-variable">$email</span> = <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'email'</span>);
    <span class="hljs-variable">$data</span> = [
        <span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'ok'</span>,
    ];
    <span class="hljs-keyword">try</span> {
        <span class="hljs-variable">$identity</span> = <span class="hljs-variable language_">$this</span>-&gt;identification-&gt;<span class="hljs-title function_ invoke__">findIdentityByEmailAddress</span>(<span class="hljs-variable">$email</span>);
        <span class="hljs-variable">$token</span> = <span class="hljs-variable language_">$this</span>-&gt;identification-&gt;<span class="hljs-title function_ invoke__">loginWithPassword</span>(
            <span class="hljs-variable">$identity</span>,
            <span class="hljs-variable">$request</span>-&gt;<span class="hljs-title function_ invoke__">get</span>(<span class="hljs-string">'password'</span>)
        );
    } <span class="hljs-keyword">catch</span> (FailedIdentification <span class="hljs-variable">$exception</span>) {
        <span class="hljs-variable">$data</span> = [
            <span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'error'</span>,
            <span class="hljs-string">'message'</span> =&gt; <span class="hljs-string">'Login failed!'</span>,
        ]
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonResponse</span>(<span class="hljs-variable">$data</span>);
}
</code></pre>

<p>While this is not sustainable, when you have complicate logic for rendering a response body, this simplification is very useful for more trivial scenarios. But <strong>be warned</strong>, this approach will become a nightmare, when attempting to use in large codebases with complex presentation logic.</p>

<p>&nbsp;</p>

<h1>How to build the model?</h1>

<p>Since there is not a single "Model" class (as explained above), you really do not "build the model". Instead you start from making <em>Services</em>, which are able to perform certain methods. And then implement <em>Domain Objects</em> and <em>Mappers</em>.</p>

<h3>An example of a service method:</h3>

<p>In the both approaches above there was this login method for the identification service. What would it actually look like. I am using a slightly modified version of the same functionality from <a href="https://github.com/teresko/palladium" rel="noreferrer">a library</a>, that I wrote .. because I am lazy:</p>

<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loginWithPassword</span>(<span class="hljs-params">Identity <span class="hljs-variable">$identity</span>, <span class="hljs-keyword">string</span> <span class="hljs-variable">$password</span></span>): <span class="hljs-title">string</span>
</span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$identity</span>-&gt;<span class="hljs-title function_ invoke__">matchPassword</span>(<span class="hljs-variable">$password</span>) === <span class="hljs-literal">false</span>) {
        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">logWrongPasswordNotice</span>(<span class="hljs-variable">$identity</span>, [
            <span class="hljs-string">'email'</span> =&gt; <span class="hljs-variable">$identity</span>-&gt;<span class="hljs-title function_ invoke__">getEmailAddress</span>(),
            <span class="hljs-string">'key'</span> =&gt; <span class="hljs-variable">$password</span>, // this is the wrong password
        ]);

        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PasswordMismatch</span>;
    }

    <span class="hljs-variable">$identity</span>-&gt;<span class="hljs-title function_ invoke__">setPassword</span>(<span class="hljs-variable">$password</span>);
    <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">updateIdentityOnUse</span>(<span class="hljs-variable">$identity</span>);
    <span class="hljs-variable">$cookie</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">createCookieIdentity</span>(<span class="hljs-variable">$identity</span>);

    <span class="hljs-variable language_">$this</span>-&gt;logger-&gt;<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">'login successful'</span>, [
        <span class="hljs-string">'input'</span> =&gt; [
            <span class="hljs-string">'email'</span> =&gt; <span class="hljs-variable">$identity</span>-&gt;<span class="hljs-title function_ invoke__">getEmailAddress</span>(),
        ],
        <span class="hljs-string">'user'</span> =&gt; [
            <span class="hljs-string">'account'</span> =&gt; <span class="hljs-variable">$identity</span>-&gt;<span class="hljs-title function_ invoke__">getAccountId</span>(),
            <span class="hljs-string">'identity'</span> =&gt; <span class="hljs-variable">$identity</span>-&gt;<span class="hljs-title function_ invoke__">getId</span>(),
        ],
    ]);

    <span class="hljs-keyword">return</span> <span class="hljs-variable">$cookie</span>-&gt;<span class="hljs-title function_ invoke__">getToken</span>();
}
</code></pre>

<p>As you can see, at this level of abstraction, there is no indication of where the data was fetched from. It might be a database, but it also might be just a mock object for testing purposes. Even the data mappers, that are actually used for it, are hidden away in the <code>private</code> methods of this service.</p>

<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">changeIdentityStatus</span>(<span class="hljs-params">Entity\Identity <span class="hljs-variable">$identity</span>, <span class="hljs-keyword">int</span> <span class="hljs-variable">$status</span></span>)
</span>{
    <span class="hljs-variable">$identity</span>-&gt;<span class="hljs-title function_ invoke__">setStatus</span>(<span class="hljs-variable">$status</span>);
    <span class="hljs-variable">$identity</span>-&gt;<span class="hljs-title function_ invoke__">setLastUsed</span>(<span class="hljs-title function_ invoke__">time</span>());
    <span class="hljs-variable">$mapper</span> = <span class="hljs-variable language_">$this</span>-&gt;mapperFactory-&gt;<span class="hljs-title function_ invoke__">create</span>(<span class="hljs-title class_">Mapper\Identity</span>::<span class="hljs-variable language_">class</span>);
    <span class="hljs-variable">$mapper</span>-&gt;<span class="hljs-title function_ invoke__">store</span>(<span class="hljs-variable">$identity</span>);
}
</code></pre>

<h3>Ways of creating mappers</h3>

<p>To implement an abstraction of persistence, on the most flexible approaches is to create custom <a href="http://martinfowler.com/eaaCatalog/dataMapper.html" rel="noreferrer">data mappers</a>. </p>

<p><img src="https://ptgmedia.pearsoncmg.com/images/chap3_0321127420/elementLinks/03fig04.gif" alt="Mapper diagram"></p>

<p><sub>From: <a href="https://martinfowler.com/books/eaa.html" rel="noreferrer">PoEAA</a> book</sub></p>

<p>In practice they are implemented for interaction with specific classes or superclasses. Lets say you have <code>Customer</code> and <code>Admin</code> in your code (both inheriting from a <code>User</code> superclass). Both would probably end up having a separate matching mapper, since they contain different fields. But you will also end up with shared and commonly used operations. For example: updating the <em>"last seen online"</em> time. And instead of making the existing mappers more convoluted, the more pragmatic approach is to have a general "User Mapper", which only update that timestamp.</p>

<h2>Some additional comments:</h2>

<ol>
<li><p><strong>Database tables and model</strong></p>

<p>While sometimes there is a direct 1:1:1 relationship between a database table, <em>Domain Object</em>, and <em>Mapper</em>, in larger projects it might be less common than you expect:</p>

<ul>
<li><p>Information used by a single <em>Domain Object</em> might be mapped from different tables, while the object itself has no persistence in the database.</p>

<p><em>Example:</em> if you are generating a monthly report. This would collect information from different of tables, but there is no magical <code>MonthlyReport</code> table in the database.</p></li>
<li><p>A single <em>Mapper</em> can affect multiple tables.</p>

<p><em>Example:</em> when you are storing data from the <code>User</code> object, this <em>Domain Object</em> could contain collection of other domain objects - <code>Group</code> instances. If you alter them and store the <code>User</code>, the <em>Data Mapper</em> will have to update and/or insert entries in multiple tables.</p></li>
<li><p>Data from a single <em>Domain Object</em> is stored in more than one table.</p>

<p><em>Example:</em> in large systems (think: a medium-sized social network), it might be pragmatic to store user authentication data and often-accessed data separately from larger chunks of content, which is rarely required. In that case you might still have a single <code>User</code> class, but the information it contains would depend of whether full details were fetched.</p></li>
<li><p>For every <em>Domain Object</em> there can be more than one mapper</p>

<p><em>Example:</em> you have a news site with a shared codebased for both public-facing and the management software. But, while both interfaces use the same <code>Article</code> class, the management needs a lot more info populated in it. In this case you would have two separate mappers: "internal" and "external". Each performing different queries, or even use different databases (as in master or slave).</p></li>
</ul></li>
<li><p><strong>A view is not a template</strong></p>

<p><em>View</em> instances in MVC (if you are not using the MVP variation of the pattern) are responsible for the presentational logic. This means that each <em>View</em> will usually juggle at least a few templates. It acquires data from the <em>Model Layer</em> and then, based on the received information, chooses a template and sets values.</p>

<p>One of the benefits you gain from this is re-usability. If you create a <code>ListView</code> class, then, with well-written code, you can have the same class handing the presentation of user-list and comments below an article. Because they both have the same presentation logic. You just switch templates.</p>

<p>You can use either <a href="http://codeangel.org/articles/simple-php-template-engine.html" rel="noreferrer">native PHP templates</a> or use some third-party templating engine. There also might be some third-party libraries, which are able to fully replace <em>View</em> instances.</p></li>
<li><p><strong>What about the old version of the answer?</strong></p>

<p>The only major change is that, what is called <em>Model</em> in the old version, is actually a <em>Service</em>. The rest of the "library analogy" keeps up pretty well.</p>

<p>The only flaw that I see is that this would be a really strange library, because it would return you information from the book, but not let you touch the book itself, because otherwise the abstraction would start to "leak". I might have to think of a more fitting analogy.</p></li>
<li><p><strong>What is the relationship between <em>View</em> and <em>Controller</em> instances?</strong></p>

<p>The MVC structure is composed of two layers: ui and model. The main structures in the <em>UI layer</em> are views and controller. </p>

<p>When you are dealing with websites that use MVC design pattern, the best way is to have 1:1 relation between views and controllers. Each view represents a whole page in your website and it has a dedicated controller to handle all the incoming requests for that particular view.</p>

<p>For example, to represent an opened article, you would have <code>\Application\Controller\Document</code> and <code>\Application\View\Document</code>. This would contain all the main functionality for UI layer, when it comes to dealing with articles <em>(of course you might have some <a href="https://developer.mozilla.org/en/xmlhttprequest" rel="noreferrer">XHR</a> components that are not directly related to articles)</em>.</p></li>
</ol>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 2</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/architecture">architecture</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/model">model</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Everything that is <strong>business logic</strong> belongs in a model, whether it is a database query, calculations, a REST call, etc.</p>

<p>You can have the data access in the model itself, the MVC pattern doesn't restrict you from doing that. You can sugar coat it with services, mappers and what not, but the actual definition of a model is a layer that handles business logic, nothing more, nothing less. It can be a class, a function, or a complete module with a gazillion objects if that's what you want.</p>

<p>It's always easier to have a separate object that actually executes the database queries instead of having them being executed in the model directly: this will especially come in handy when unit testing (because of the easiness of injecting a mock database dependency in your model):</p>

<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Database</span> </span>{
   <span class="hljs-keyword">protected</span> <span class="hljs-variable">$_conn</span>;

   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$connection</span></span>) </span>{
       <span class="hljs-variable language_">$this</span>-&gt;_conn = <span class="hljs-variable">$connection</span>;
   }

   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ExecuteObject</span>(<span class="hljs-params"><span class="hljs-variable">$sql</span>, <span class="hljs-variable">$data</span></span>) </span>{
       <span class="hljs-comment">// stuff</span>
   }
}

<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Model</span> </span>{
   <span class="hljs-keyword">protected</span> <span class="hljs-variable">$_db</span>;

   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">Database <span class="hljs-variable">$db</span></span>) </span>{
       <span class="hljs-variable language_">$this</span>-&gt;_db = <span class="hljs-variable">$db</span>;
   }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span> </span>{
   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">CheckUsername</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>) </span>{
       <span class="hljs-comment">// ...</span>
       <span class="hljs-variable">$sql</span> = <span class="hljs-string">"SELECT Username FROM"</span> . <span class="hljs-variable language_">$this</span>-&gt;usersTableName . <span class="hljs-string">" WHERE ..."</span>;
       <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;_db-&gt;<span class="hljs-title function_ invoke__">ExecuteObject</span>(<span class="hljs-variable">$sql</span>, <span class="hljs-variable">$data</span>);
   }
}

<span class="hljs-variable">$db</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Database</span>(<span class="hljs-variable">$conn</span>);
<span class="hljs-variable">$model</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-variable">$db</span>);
<span class="hljs-variable">$model</span>-&gt;<span class="hljs-title function_ invoke__">CheckUsername</span>(<span class="hljs-string">'foo'</span>);
</code></pre>

<p>Also, in PHP, you rarely need to catch/rethrow exceptions because the backtrace is preserved, especially in a case like your example. Just let the exception be thrown and catch it in the controller instead.</p>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 3</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/architecture">architecture</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/model">model</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In Web-"MVC" you can do whatever you please.</p>

<p>The original concept <sup><a href="https://stackoverflow.com/questions/1549857/simple-php-mvc-framework/1549970#1549970">(1)</a></sup> described the model as the business logic. It should represent the application state and enforce some data consistency. That approach is often described as "fat model".</p>

<p>Most PHP frameworks follow a more shallow approach, where the model is just a database interface. But at the very least these models should still validate the incoming data and relations.</p>

<p>Either way, you're not very far off if you separate the SQL stuff or database calls into another layer. This way you only need to concern yourself with the real data/behaviour, not with the actual storage API. (It's however unreasonable to overdo it. You'll e.g. never be able to replace a database backend with a filestorage if that wasn't designed ahead.)</p>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 4</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/architecture">architecture</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/model">model</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>More oftenly most of the applications will have data,display and processing part and we just put all  those in the letters <code>M</code>,<code>V</code> and <code>C</code>.  </p>

<p><em>Model(<code>M</code>)</em>--&gt;Has the attributes that holds state of application and it dont know any thing about <code>V</code> and <code>C</code>.  </p>

<p><em>View(<code>V</code>)</em>--&gt;Has displaying format for the application and and only knows about how-to-digest model on it and does not bother about <code>C</code>.</p>

<p><em>Controller(<code>C</code>)</em>----&gt;Has processing part of application and acts as wiring between M and V and it depends on both <code>M</code>,<code>V</code> unlike <code>M</code> and <code>V</code>.  </p>

<p>Altogether there is separation of concern between each.
In future any change or enhancements can be added very easily.</p>
    </div></div></div></div><div id="solution5" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 5</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/architecture">architecture</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/model">model</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In my case I have a database class that handle all the direct database interaction such as querying, fetching, and such. So if I had to change my database from <a href="http://en.wikipedia.org/wiki/MySQL" rel="nofollow noreferrer">MySQL</a> to <a href="http://en.wikipedia.org/wiki/PostgreSQL" rel="nofollow noreferrer">PostgreSQL</a> there won't be any problem. So adding that extra layer can be useful.</p>
<p>Each table can have its own class and have its specific methods, but to actually get the data, it lets the database class handle it:</p>
<h3>File <code>Database.php</code></h3>
<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Database</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$connection</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$current_query</span>;
    ...

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">query</span>(<span class="hljs-params"><span class="hljs-variable">$sql</span></span>) </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">self</span>::<span class="hljs-variable">$connection</span>){
            <span class="hljs-built_in">self</span>::<span class="hljs-title function_ invoke__">open_connection</span>();
        }
        <span class="hljs-built_in">self</span>::<span class="hljs-variable">$current_query</span> = <span class="hljs-variable">$sql</span>;
        <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-variable">$sql</span>,<span class="hljs-built_in">self</span>::<span class="hljs-variable">$connection</span>);

        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$result</span>){
            <span class="hljs-built_in">self</span>::<span class="hljs-title function_ invoke__">close_connection</span>();
            <span class="hljs-comment">// throw custom error</span>
            <span class="hljs-comment">// The query failed for some reason. here is query :: self::$current_query</span>
            <span class="hljs-variable">$error</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-number">2</span>,<span class="hljs-string">"There is an Error in the query.\n&lt;b&gt;Query:&lt;/b&gt;\n<span class="hljs-subst">{$sql}</span>\n"</span>);
            <span class="hljs-variable">$error</span>-&gt;<span class="hljs-title function_ invoke__">handleError</span>();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;
    }
 ....

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">find_by_sql</span>(<span class="hljs-params"><span class="hljs-variable">$sql</span></span>)</span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$sql</span>))
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

        <span class="hljs-variable">$result_set</span> = <span class="hljs-built_in">self</span>::<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);
        <span class="hljs-variable">$obj_arr</span> = <span class="hljs-keyword">array</span>();
        <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-built_in">self</span>::<span class="hljs-title function_ invoke__">fetch_array</span>(<span class="hljs-variable">$result_set</span>))
        {
            <span class="hljs-variable">$obj_arr</span>[] = <span class="hljs-built_in">self</span>::<span class="hljs-title function_ invoke__">instantiate</span>(<span class="hljs-variable">$row</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$obj_arr</span>;
    }
}
</code></pre>
<p>Table object classL</p>
<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DomainPeer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Database</span> </span>{

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDomainInfoList</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-variable">$sql</span> = <span class="hljs-string">'SELECT '</span>;
        <span class="hljs-variable">$sql</span> .=<span class="hljs-string">'d.`id`,'</span>;
        <span class="hljs-variable">$sql</span> .=<span class="hljs-string">'d.`name`,'</span>;
        <span class="hljs-variable">$sql</span> .=<span class="hljs-string">'d.`shortName`,'</span>;
        <span class="hljs-variable">$sql</span> .=<span class="hljs-string">'d.`created_at`,'</span>;
        <span class="hljs-variable">$sql</span> .=<span class="hljs-string">'d.`updated_at`,'</span>;
        <span class="hljs-variable">$sql</span> .=<span class="hljs-string">'count(q.id) as queries '</span>;
        <span class="hljs-variable">$sql</span> .=<span class="hljs-string">'FROM `domains` d '</span>;
        <span class="hljs-variable">$sql</span> .=<span class="hljs-string">'LEFT JOIN queries q on q.domainId = d.id '</span>;
        <span class="hljs-variable">$sql</span> .=<span class="hljs-string">'GROUP BY d.id'</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">self</span>::<span class="hljs-title function_ invoke__">find_by_sql</span>(<span class="hljs-variable">$sql</span>);
    }

    ....
}
</code></pre>
<p>I hope this example helps you create a good structure.</p>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/most-efficient-method-to-groupby-on-an-array-of-objects-1657387580538">Most efficient method to groupby on an array of objects</a><a href="/questions/how-to-compare-arrays-in-javascript-1657387352277">How to compare arrays in JavaScript?</a><a href="/questions/php-mail-function-doesn&#x27;t-complete-sending-of-e-mail-1657384307499">PHP mail function doesn&#x27;t complete sending of e-mail</a><a href="/questions/percentage-height-html-5css-1657387471048">Percentage Height HTML 5/CSS</a><a href="/questions/how-to-make-a-great-r-reproducible-example-1657384198173">How to make a great R reproducible example</a><a href="/questions/captured-variable-in-a-loop-in-c-1657387696779">Captured variable in a loop in C#</a><a href="/questions/what-does-enctype&#x27;multipartform-data&#x27;-mean-1657388229352">What does enctype=&#x27;multipart/form-data&#x27; mean?</a><a href="/questions/how-do-i-check-if-an-array-includes-a-value-in-javascript-1657387421185">How do I check if an array includes a value in JavaScript?</a><a href="/questions/pandas-conditional-creation-of-a-seriesdataframe-column-1657387461003">Pandas conditional creation of a series/dataframe column</a><a href="/questions/gui-not-working-after-rewriting-to-mvc-1657388388035">GUI not working after rewriting to MVC</a><a href="/questions/what-is-the-difference-between-a-deep-copy-and-a-shallow-copy-1657388445063">What is the difference between a deep copy and a shallow copy?</a><a href="/questions/what-is-sql-injection-duplicate-1657387944486">What is SQL injection? [duplicate]</a><a href="/questions/when-to-use-linkedlist-over-arraylist-in-java-1657388107480">When to use LinkedList over ArrayList in Java?</a><a href="/questions/how-to-fix-java.lang.unsupportedclassversionerror:-unsupported-major.minor-version-1657384863422">How to fix java.lang.UnsupportedClassVersionError: Unsupported major.minor version</a><a href="/questions/how-can-i-change-an-element&#x27;s-class-with-javascript-1657387694695">How can I change an element&#x27;s class with JavaScript?</a><a href="/questions/mysql-error-1093-can&#x27;t-specify-target-table-for-update-in-from-clause-1657388078961">MySQL Error 1093 - Can&#x27;t specify target table for update in FROM clause</a><a href="/questions/google-maps-js-api-v3-simple-multiple-marker-example-1657388073335">Google Maps JS API v3 - Simple Multiple Marker Example</a><a href="/questions/regex-match-open-tags-except-xhtml-self-contained-tags-1657384228245">RegEx match open tags except XHTML self-contained tags</a><a href="/questions/what-is-array-to-pointer-decay-1657384709608">What is array to pointer decay?</a><a href="/questions/how-do-i-compose-a-rotation-matrix-with-human-readable-angles-from-scratch-1657387963457">How do I compose a rotation matrix with human readable angles from scratch?</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;\u0026lt;sub\u0026gt;\u0026lt;strong\u0026gt;Disclaimer:\u0026lt;/strong\u0026gt; the following is a description of how I understand MVC-like patterns in the context of PHP-based web applications. All the external links that are used in the content are there to explain terms and concepts, and \u0026lt;strong\u0026gt;not\u0026lt;/strong\u0026gt; to imply my own credibility on the subject.\u0026lt;/sub\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;The first thing that I must clear up is: \u0026lt;strong\u0026gt;the model is a layer\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Second: there is a difference between \u0026lt;em\u0026gt;classical MVC\u0026lt;/em\u0026gt; and what we use in web development. \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/7622038/727208\u0026quot;\u0026gt;Here\u0026apos;s\u0026lt;/a\u0026gt; a bit of an older answer I wrote, which briefly describes how they are different.\u0026lt;/p\u0026gt;\n\n\u0026lt;h3\u0026gt;What a model is NOT:\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;The model is not a class or any single object. It is a very common mistake to make \u0026lt;em\u0026gt;(I did too, though the original answer was written when I began to learn otherwise)\u0026lt;/em\u0026gt;, because most frameworks perpetuate this misconception.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Neither is it an Object-Relational Mapping technique (ORM) nor an abstraction of database tables. Anyone who tells you otherwise is most likely trying to \u0026lt;em\u0026gt;\u0026apos;sell\u0026apos;\u0026lt;/em\u0026gt; another brand-new ORM or a whole framework.\u0026lt;/p\u0026gt;\n\n\u0026lt;h3\u0026gt;What a model is:\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;In proper MVC adaptation, the M contains all the domain business logic and the \u0026lt;em\u0026gt;Model Layer\u0026lt;/em\u0026gt; is \u0026lt;strong\u0026gt;mostly\u0026lt;/strong\u0026gt; made from three types of structures:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://c2.com/cgi/wiki?DomainObject\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;em\u0026gt;Domain Objects\u0026lt;/em\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;A domain object is a logical container of purely domain information; it usually represents a logical entity in the problem domain space. Commonly referred to as \u0026lt;em\u0026gt;business logic\u0026lt;/em\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;This would be where you define how to validate data before sending an invoice, or to compute the total cost of an order. At the same time, \u0026lt;em\u0026gt;Domain Objects\u0026lt;/em\u0026gt; are completely unaware of storage - neither from \u0026lt;em\u0026gt;where\u0026lt;/em\u0026gt; (SQL database, REST API, text file, etc.) nor even \u0026lt;em\u0026gt;if\u0026lt;/em\u0026gt; they get saved or retrieved.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://martinfowler.com/eaaCatalog/dataMapper.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;em\u0026gt;Data Mappers\u0026lt;/em\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;These objects are only responsible for the storage. If you store information in a database, this would be where the SQL lives. Or maybe you use an XML file to store data, and your \u0026lt;em\u0026gt;Data Mappers\u0026lt;/em\u0026gt; are parsing from and to XML files.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://martinfowler.com/eaaCatalog/serviceLayer.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;em\u0026gt;Services\u0026lt;/em\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You can think of them as \u0026quot;higher level Domain Objects\u0026quot;, but instead of business logic, \u0026lt;em\u0026gt;Services\u0026lt;/em\u0026gt; are responsible for interaction between \u0026lt;em\u0026gt;Domain Objects\u0026lt;/em\u0026gt; and \u0026lt;em\u0026gt;Mappers\u0026lt;/em\u0026gt;. These structures end up creating a \u0026quot;public\u0026quot; interface for interacting with the domain business logic. You can avoid them, but at the penalty of leaking some domain logic into \u0026lt;em\u0026gt;Controllers\u0026lt;/em\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;There is a related answer to this subject in the \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/9685039/727208\u0026quot;\u0026gt;ACL implementation\u0026lt;/a\u0026gt; question - it might be useful.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;The communication between the model layer and other parts of the MVC triad should happen only through \u0026lt;em\u0026gt;Services\u0026lt;/em\u0026gt;. The clear separation has a few additional benefits:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;it helps to enforce the \u0026lt;a href=\u0026quot;https://en.wikipedia.org/wiki/Single_responsibility_principle\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;single responsibility principle\u0026lt;/a\u0026gt; (SRP)\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;provides additional \u0026apos;wiggle room\u0026apos; in case the logic changes\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;keeps the controller as simple as possible\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;gives a clear blueprint, if you ever need an external API\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026amp;nbsp;\u0026lt;/p\u0026gt;\n\n\u0026lt;h1\u0026gt;How to interact with a model?\u0026lt;/h1\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;\u0026lt;sub\u0026gt;\u0026lt;em\u0026gt;\u0026lt;strong\u0026gt;Prerequisites:\u0026lt;/strong\u0026gt; watch lectures \u0026lt;a href=\u0026quot;http://www.youtube.com/watch?v=-FRm3VPhseI\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026quot;Global State and Singletons\u0026quot;\u0026lt;/a\u0026gt; and \u0026lt;a href=\u0026quot;http://www.youtube.com/watch?v=RlfLCWKxHJ0\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026quot;Don\u0026apos;t Look For Things!\u0026quot;\u0026lt;/a\u0026gt; from the Clean Code Talks.\u0026lt;/em\u0026gt;\u0026lt;/sub\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;h3\u0026gt;Gaining access to service instances\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;For both the \u0026lt;em\u0026gt;View\u0026lt;/em\u0026gt; and \u0026lt;em\u0026gt;Controller\u0026lt;/em\u0026gt; instances (what you could call: \u0026quot;UI layer\u0026quot;) to have access these services,  there are two general approaches: \u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;You can inject the required services in the constructors of your views and controllers directly, preferably using a DI container. \u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Using a factory for services as a mandatory dependency for all of your views and controllers. \u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;p\u0026gt;As you might suspect, the DI container is a lot more elegant solution (while not being the easiest for a beginner). The two libraries, that I recommend considering for this functionality would be Syfmony\u0026apos;s standalone \u0026lt;a href=\u0026quot;http://symfony.com/doc/master/components/dependency_injection.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;DependencyInjection component\u0026lt;/a\u0026gt; or \u0026lt;a href=\u0026quot;https://github.com/rdlowrey/auryn\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Auryn\u0026lt;/a\u0026gt;. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Both the solutions using a factory and a DI container would let you also share the instances of various servers to be shared between the selected controller and view for a given request-response cycle.\u0026lt;/p\u0026gt;\n\n\u0026lt;h3\u0026gt;Alteration of model\u0026apos;s state\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;Now that you can access to the model layer in the controllers, you need to start actually using them: \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;postLogin\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;Request \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$request\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;)\n\u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$email\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$request\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;get\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;email\u0026apos;\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;identification-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;findIdentityByEmailAddress\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$email\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;identification-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;loginWithPassword\u0026lt;/span\u0026gt;(\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$request\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;get\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;)\n    );\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Your controllers have a very clear task: take the user input and, based on this input, change the current state of business logic. In this example the states that are changed between are \u0026quot;anonymous user\u0026quot; and \u0026quot;logged in user\u0026quot;. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Controller is not responsible for validating user\u0026apos;s input, because that is part of business rules and controller is definitely not calling SQL queries, like what you would see \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/44535565/codeigniniter-insert-data-through-models-and-controller\u0026quot;\u0026gt;here\u0026lt;/a\u0026gt; or \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/27025412/loading-multiple-select-options-into-array\u0026quot;\u0026gt;here\u0026lt;/a\u0026gt; (please don\u0026apos;t hate on them, they are misguided, not evil).\u0026lt;/p\u0026gt;\n\n\u0026lt;h3\u0026gt;Showing user the state-change.\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;Ok, user has logged in (or failed). \u0026lt;a href=\u0026quot;http://i0.kym-cdn.com/photos/images/original/001/142/233/897.gif\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Now what?\u0026lt;/a\u0026gt; Said user is still unaware of it. So you need to actually produce a response and that is the responsibility of a view. \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;postLogin\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;)\n\u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$path\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/login\u0026apos;\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;identification-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;isUserLoggedIn\u0026lt;/span\u0026gt;()) {\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$path\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/dashboard\u0026apos;\u0026lt;/span\u0026gt;;\n    }\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;RedirectResponse\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$path\u0026lt;/span\u0026gt;); \n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;In this case, the view produced one of two possible responses, based on the current state of model layer. For a different use-case you would have the view picking different templates to render, based on something like \u0026quot;current selected of article\u0026quot; .\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The presentation layer can actually get quite elaborate, as described here: \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/16596704/727208\u0026quot;\u0026gt;Understanding MVC Views in PHP\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;h3\u0026gt;But I am just making a REST API!\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;Of course, there are situations, when this is a overkill.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;MVC is just a concrete solution for \u0026lt;a href=\u0026quot;https://en.wikipedia.org/wiki/Separation_of_concerns\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Separation of Concerns\u0026lt;/a\u0026gt; principle. \u0026lt;em\u0026gt;MVC separates user interface from the business logic, and it in the UI it separated handling of user input and the presentation.\u0026lt;/em\u0026gt; This is crucial. While often people describe it as a \u0026quot;triad\u0026quot;, it\u0026apos;s not actually made up from three independent parts. The structure is more like this: \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;img src=\u0026quot;https://i.stack.imgur.com/iEn76.png\u0026quot; alt=\u0026quot;MVC separation\u0026quot;\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;It means, that, when your presentation layer\u0026apos;s logic is close to none-existent, the pragmatic approach is to keep them as single layer. It also can substantially simplify some aspects of model layer. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Using this approach the login example (for an API) can be written as:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;postLogin\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;Request \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$request\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;)\n\u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$email\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$request\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;get\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;email\u0026apos;\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$data\u0026lt;/span\u0026gt; = [\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;status\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ok\u0026apos;\u0026lt;/span\u0026gt;,\n    ];\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;try\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;identification-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;findIdentityByEmailAddress\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$email\u0026lt;/span\u0026gt;);\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$token\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;identification-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;loginWithPassword\u0026lt;/span\u0026gt;(\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$request\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;get\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;)\n        );\n    } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt; (FailedIdentification \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$exception\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$data\u0026lt;/span\u0026gt; = [\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;status\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;error\u0026apos;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;message\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Login failed!\u0026apos;\u0026lt;/span\u0026gt;,\n        ]\n    }\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;JsonResponse\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$data\u0026lt;/span\u0026gt;);\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;While this is not sustainable, when you have complicate logic for rendering a response body, this simplification is very useful for more trivial scenarios. But \u0026lt;strong\u0026gt;be warned\u0026lt;/strong\u0026gt;, this approach will become a nightmare, when attempting to use in large codebases with complex presentation logic.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026amp;nbsp;\u0026lt;/p\u0026gt;\n\n\u0026lt;h1\u0026gt;How to build the model?\u0026lt;/h1\u0026gt;\n\n\u0026lt;p\u0026gt;Since there is not a single \u0026quot;Model\u0026quot; class (as explained above), you really do not \u0026quot;build the model\u0026quot;. Instead you start from making \u0026lt;em\u0026gt;Services\u0026lt;/em\u0026gt;, which are able to perform certain methods. And then implement \u0026lt;em\u0026gt;Domain Objects\u0026lt;/em\u0026gt; and \u0026lt;em\u0026gt;Mappers\u0026lt;/em\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;h3\u0026gt;An example of a service method:\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;In the both approaches above there was this login method for the identification service. What would it actually look like. I am using a slightly modified version of the same functionality from \u0026lt;a href=\u0026quot;https://github.com/teresko/palladium\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;a library\u0026lt;/a\u0026gt;, that I wrote .. because I am lazy:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;loginWithPassword\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;Identity \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;): \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt;\n\u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;matchPassword\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;) === \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;logWrongPasswordNotice\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;, [\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;email\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;getEmailAddress\u0026lt;/span\u0026gt;(),\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;key\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;, // this is the wrong password\n        ]);\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;throw\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;PasswordMismatch\u0026lt;/span\u0026gt;;\n    }\n\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;setPassword\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;updateIdentityOnUse\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$cookie\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;createCookieIdentity\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;);\n\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;logger-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;info\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;login successful\u0026apos;\u0026lt;/span\u0026gt;, [\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;input\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; [\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;email\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;getEmailAddress\u0026lt;/span\u0026gt;(),\n        ],\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;user\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; [\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;account\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;getAccountId\u0026lt;/span\u0026gt;(),\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;identity\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;getId\u0026lt;/span\u0026gt;(),\n        ],\n    ]);\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$cookie\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;getToken\u0026lt;/span\u0026gt;();\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;As you can see, at this level of abstraction, there is no indication of where the data was fetched from. It might be a database, but it also might be just a mock object for testing purposes. Even the data mappers, that are actually used for it, are hidden away in the \u0026lt;code\u0026gt;private\u0026lt;/code\u0026gt; methods of this service.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;private\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;changeIdentityStatus\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;Entity\\Identity \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$status\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;)\n\u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;setStatus\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$status\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;setLastUsed\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;time\u0026lt;/span\u0026gt;());\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mapper\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;mapperFactory-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;create\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Mapper\\Identity\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$mapper\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;store\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$identity\u0026lt;/span\u0026gt;);\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;h3\u0026gt;Ways of creating mappers\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;To implement an abstraction of persistence, on the most flexible approaches is to create custom \u0026lt;a href=\u0026quot;http://martinfowler.com/eaaCatalog/dataMapper.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;data mappers\u0026lt;/a\u0026gt;. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;img src=\u0026quot;https://ptgmedia.pearsoncmg.com/images/chap3_0321127420/elementLinks/03fig04.gif\u0026quot; alt=\u0026quot;Mapper diagram\u0026quot;\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;sub\u0026gt;From: \u0026lt;a href=\u0026quot;https://martinfowler.com/books/eaa.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;PoEAA\u0026lt;/a\u0026gt; book\u0026lt;/sub\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;In practice they are implemented for interaction with specific classes or superclasses. Lets say you have \u0026lt;code\u0026gt;Customer\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;Admin\u0026lt;/code\u0026gt; in your code (both inheriting from a \u0026lt;code\u0026gt;User\u0026lt;/code\u0026gt; superclass). Both would probably end up having a separate matching mapper, since they contain different fields. But you will also end up with shared and commonly used operations. For example: updating the \u0026lt;em\u0026gt;\u0026quot;last seen online\u0026quot;\u0026lt;/em\u0026gt; time. And instead of making the existing mappers more convoluted, the more pragmatic approach is to have a general \u0026quot;User Mapper\u0026quot;, which only update that timestamp.\u0026lt;/p\u0026gt;\n\n\u0026lt;h2\u0026gt;Some additional comments:\u0026lt;/h2\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Database tables and model\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;While sometimes there is a direct 1:1:1 relationship between a database table, \u0026lt;em\u0026gt;Domain Object\u0026lt;/em\u0026gt;, and \u0026lt;em\u0026gt;Mapper\u0026lt;/em\u0026gt;, in larger projects it might be less common than you expect:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Information used by a single \u0026lt;em\u0026gt;Domain Object\u0026lt;/em\u0026gt; might be mapped from different tables, while the object itself has no persistence in the database.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Example:\u0026lt;/em\u0026gt; if you are generating a monthly report. This would collect information from different of tables, but there is no magical \u0026lt;code\u0026gt;MonthlyReport\u0026lt;/code\u0026gt; table in the database.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;A single \u0026lt;em\u0026gt;Mapper\u0026lt;/em\u0026gt; can affect multiple tables.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Example:\u0026lt;/em\u0026gt; when you are storing data from the \u0026lt;code\u0026gt;User\u0026lt;/code\u0026gt; object, this \u0026lt;em\u0026gt;Domain Object\u0026lt;/em\u0026gt; could contain collection of other domain objects - \u0026lt;code\u0026gt;Group\u0026lt;/code\u0026gt; instances. If you alter them and store the \u0026lt;code\u0026gt;User\u0026lt;/code\u0026gt;, the \u0026lt;em\u0026gt;Data Mapper\u0026lt;/em\u0026gt; will have to update and/or insert entries in multiple tables.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Data from a single \u0026lt;em\u0026gt;Domain Object\u0026lt;/em\u0026gt; is stored in more than one table.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Example:\u0026lt;/em\u0026gt; in large systems (think: a medium-sized social network), it might be pragmatic to store user authentication data and often-accessed data separately from larger chunks of content, which is rarely required. In that case you might still have a single \u0026lt;code\u0026gt;User\u0026lt;/code\u0026gt; class, but the information it contains would depend of whether full details were fetched.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;For every \u0026lt;em\u0026gt;Domain Object\u0026lt;/em\u0026gt; there can be more than one mapper\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Example:\u0026lt;/em\u0026gt; you have a news site with a shared codebased for both public-facing and the management software. But, while both interfaces use the same \u0026lt;code\u0026gt;Article\u0026lt;/code\u0026gt; class, the management needs a lot more info populated in it. In this case you would have two separate mappers: \u0026quot;internal\u0026quot; and \u0026quot;external\u0026quot;. Each performing different queries, or even use different databases (as in master or slave).\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;A view is not a template\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;View\u0026lt;/em\u0026gt; instances in MVC (if you are not using the MVP variation of the pattern) are responsible for the presentational logic. This means that each \u0026lt;em\u0026gt;View\u0026lt;/em\u0026gt; will usually juggle at least a few templates. It acquires data from the \u0026lt;em\u0026gt;Model Layer\u0026lt;/em\u0026gt; and then, based on the received information, chooses a template and sets values.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;One of the benefits you gain from this is re-usability. If you create a \u0026lt;code\u0026gt;ListView\u0026lt;/code\u0026gt; class, then, with well-written code, you can have the same class handing the presentation of user-list and comments below an article. Because they both have the same presentation logic. You just switch templates.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You can use either \u0026lt;a href=\u0026quot;http://codeangel.org/articles/simple-php-template-engine.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;native PHP templates\u0026lt;/a\u0026gt; or use some third-party templating engine. There also might be some third-party libraries, which are able to fully replace \u0026lt;em\u0026gt;View\u0026lt;/em\u0026gt; instances.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;What about the old version of the answer?\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The only major change is that, what is called \u0026lt;em\u0026gt;Model\u0026lt;/em\u0026gt; in the old version, is actually a \u0026lt;em\u0026gt;Service\u0026lt;/em\u0026gt;. The rest of the \u0026quot;library analogy\u0026quot; keeps up pretty well.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The only flaw that I see is that this would be a really strange library, because it would return you information from the book, but not let you touch the book itself, because otherwise the abstraction would start to \u0026quot;leak\u0026quot;. I might have to think of a more fitting analogy.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;What is the relationship between \u0026lt;em\u0026gt;View\u0026lt;/em\u0026gt; and \u0026lt;em\u0026gt;Controller\u0026lt;/em\u0026gt; instances?\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The MVC structure is composed of two layers: ui and model. The main structures in the \u0026lt;em\u0026gt;UI layer\u0026lt;/em\u0026gt; are views and controller. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;When you are dealing with websites that use MVC design pattern, the best way is to have 1:1 relation between views and controllers. Each view represents a whole page in your website and it has a dedicated controller to handle all the incoming requests for that particular view.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For example, to represent an opened article, you would have \u0026lt;code\u0026gt;\\Application\\Controller\\Document\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;\\Application\\View\\Document\u0026lt;/code\u0026gt;. This would contain all the main functionality for UI layer, when it comes to dealing with articles \u0026lt;em\u0026gt;(of course you might have some \u0026lt;a href=\u0026quot;https://developer.mozilla.org/en/xmlhttprequest\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;XHR\u0026lt;/a\u0026gt; components that are not directly related to articles)\u0026lt;/em\u0026gt;.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Everything that is \u0026lt;strong\u0026gt;business logic\u0026lt;/strong\u0026gt; belongs in a model, whether it is a database query, calculations, a REST call, etc.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You can have the data access in the model itself, the MVC pattern doesn\u0026apos;t restrict you from doing that. You can sugar coat it with services, mappers and what not, but the actual definition of a model is a layer that handles business logic, nothing more, nothing less. It can be a class, a function, or a complete module with a gazillion objects if that\u0026apos;s what you want.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;It\u0026apos;s always easier to have a separate object that actually executes the database queries instead of having them being executed in the model directly: this will especially come in handy when unit testing (because of the easiness of injecting a mock database dependency in your model):\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-class\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;Database\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;protected\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_conn\u0026lt;/span\u0026gt;;\n\n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;__construct\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$connection\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n       \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;_conn = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$connection\u0026lt;/span\u0026gt;;\n   }\n\n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;ExecuteObject\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$data\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n       \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// stuff\u0026lt;/span\u0026gt;\n   }\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;abstract\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-class\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;Model\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;protected\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_db\u0026lt;/span\u0026gt;;\n\n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;__construct\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;Database \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$db\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n       \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;_db = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$db\u0026lt;/span\u0026gt;;\n   }\n}\n\n\u0026lt;span class=\u0026quot;hljs-class\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;User\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;extends\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;Model\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;CheckUsername\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$username\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n       \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// ...\u0026lt;/span\u0026gt;\n       \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT Username FROM\u0026quot;\u0026lt;/span\u0026gt; . \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;usersTableName . \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot; WHERE ...\u0026quot;\u0026lt;/span\u0026gt;;\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;_db-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;ExecuteObject\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$data\u0026lt;/span\u0026gt;);\n   }\n}\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$db\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Database\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$conn\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$model\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;User\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$db\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$model\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;CheckUsername\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;foo\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Also, in PHP, you rarely need to catch/rethrow exceptions because the backtrace is preserved, especially in a case like your example. Just let the exception be thrown and catch it in the controller instead.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In Web-\u0026quot;MVC\u0026quot; you can do whatever you please.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The original concept \u0026lt;sup\u0026gt;\u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/1549857/simple-php-mvc-framework/1549970#1549970\u0026quot;\u0026gt;(1)\u0026lt;/a\u0026gt;\u0026lt;/sup\u0026gt; described the model as the business logic. It should represent the application state and enforce some data consistency. That approach is often described as \u0026quot;fat model\u0026quot;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Most PHP frameworks follow a more shallow approach, where the model is just a database interface. But at the very least these models should still validate the incoming data and relations.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Either way, you\u0026apos;re not very far off if you separate the SQL stuff or database calls into another layer. This way you only need to concern yourself with the real data/behaviour, not with the actual storage API. (It\u0026apos;s however unreasonable to overdo it. You\u0026apos;ll e.g. never be able to replace a database backend with a filestorage if that wasn\u0026apos;t designed ahead.)\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;More oftenly most of the applications will have data,display and processing part and we just put all  those in the letters \u0026lt;code\u0026gt;M\u0026lt;/code\u0026gt;,\u0026lt;code\u0026gt;V\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;C\u0026lt;/code\u0026gt;.  \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Model(\u0026lt;code\u0026gt;M\u0026lt;/code\u0026gt;)\u0026lt;/em\u0026gt;--\u0026amp;gt;Has the attributes that holds state of application and it dont know any thing about \u0026lt;code\u0026gt;V\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;C\u0026lt;/code\u0026gt;.  \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;View(\u0026lt;code\u0026gt;V\u0026lt;/code\u0026gt;)\u0026lt;/em\u0026gt;--\u0026amp;gt;Has displaying format for the application and and only knows about how-to-digest model on it and does not bother about \u0026lt;code\u0026gt;C\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Controller(\u0026lt;code\u0026gt;C\u0026lt;/code\u0026gt;)\u0026lt;/em\u0026gt;----\u0026amp;gt;Has processing part of application and acts as wiring between M and V and it depends on both \u0026lt;code\u0026gt;M\u0026lt;/code\u0026gt;,\u0026lt;code\u0026gt;V\u0026lt;/code\u0026gt; unlike \u0026lt;code\u0026gt;M\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;V\u0026lt;/code\u0026gt;.  \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Altogether there is separation of concern between each.\nIn future any change or enhancements can be added very easily.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In my case I have a database class that handle all the direct database interaction such as querying, fetching, and such. So if I had to change my database from \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/MySQL\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;MySQL\u0026lt;/a\u0026gt; to \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/PostgreSQL\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;PostgreSQL\u0026lt;/a\u0026gt; there won\u0026apos;t be any problem. So adding that extra layer can be useful.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Each table can have its own class and have its specific methods, but to actually get the data, it lets the database class handle it:\u0026lt;/p\u0026gt;\n\u0026lt;h3\u0026gt;File \u0026lt;code\u0026gt;Database.php\u0026lt;/code\u0026gt;\u0026lt;/h3\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-class\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;Database\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;private\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$connection\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;private\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$current_query\u0026lt;/span\u0026gt;;\n    ...\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;query\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;self\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$connection\u0026lt;/span\u0026gt;){\n            \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;self\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;open_connection\u0026lt;/span\u0026gt;();\n        }\n        \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;self\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$current_query\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$result\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mysql_query\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;self\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$connection\u0026lt;/span\u0026gt;);\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$result\u0026lt;/span\u0026gt;){\n            \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;self\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;close_connection\u0026lt;/span\u0026gt;();\n            \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// throw custom error\u0026lt;/span\u0026gt;\n            \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// The query failed for some reason. here is query :: self::$current_query\u0026lt;/span\u0026gt;\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$error\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;There is an Error in the query.\\n\u0026amp;lt;b\u0026amp;gt;Query:\u0026amp;lt;/b\u0026amp;gt;\\n\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;{$sql}\u0026lt;/span\u0026gt;\\n\u0026quot;\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$error\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;handleError\u0026lt;/span\u0026gt;();\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$result\u0026lt;/span\u0026gt;;\n    }\n ....\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;find_by_sql\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;is_string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt;))\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;;\n\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$result_set\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;self\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;query\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt;);\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$obj_arr\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;();\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$row\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;self\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;fetch_array\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$result_set\u0026lt;/span\u0026gt;))\n        {\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$obj_arr\u0026lt;/span\u0026gt;[] = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;self\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;instantiate\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$row\u0026lt;/span\u0026gt;);\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$obj_arr\u0026lt;/span\u0026gt;;\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Table object classL\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-class\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;DomainPeer\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;extends\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;Database\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;getDomainInfoList\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT \u0026apos;\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt; .=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;d.`id`,\u0026apos;\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt; .=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;d.`name`,\u0026apos;\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt; .=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;d.`shortName`,\u0026apos;\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt; .=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;d.`created_at`,\u0026apos;\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt; .=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;d.`updated_at`,\u0026apos;\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt; .=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;count(q.id) as queries \u0026apos;\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt; .=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;FROM `domains` d \u0026apos;\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt; .=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;LEFT JOIN queries q on q.domainId = d.id \u0026apos;\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt; .=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;GROUP BY d.id\u0026apos;\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;self\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;find_by_sql\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt;);\n    }\n\n    ....\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;I hope this example helps you create a good structure.\u0026lt;/p\u0026gt;\n    "],"id":551,"title":"How should a model be structured in MVC? [closed]","content":"\n                    \u0026lt;div\u0026gt;\n            \u0026lt;aside class=\u0026quot;s-notice s-notice__info post-notice js-post-notice mb16\u0026quot; role=\u0026quot;status\u0026quot;\u0026gt;\n        \u0026lt;div class=\u0026quot;d-flex fd-column fw-nowrap\u0026quot;\u0026gt;\n            \u0026lt;div class=\u0026quot;d-flex fw-nowrap\u0026quot;\u0026gt;\n                \u0026lt;div class=\u0026quot;flex--item wmn0 fl1 lh-lg\u0026quot;\u0026gt;\n                    \u0026lt;div class=\u0026quot;flex--item fl1 lh-lg\u0026quot;\u0026gt;\n                        \u0026lt;b\u0026gt;Closed\u0026lt;/b\u0026gt;. This question is \u0026lt;a href=\u0026quot;/help/closed-questions\u0026quot;\u0026gt;opinion-based\u0026lt;/a\u0026gt;. It is not currently accepting answers.\n                        \n                    \u0026lt;/div\u0026gt;\n                \u0026lt;/div\u0026gt;\n            \u0026lt;/div\u0026gt;\n        \u0026lt;/div\u0026gt;\n            \u0026lt;hr class=\u0026quot;my12 outline-none baw0 bb bc-powder-400\u0026quot;\u0026gt;\n        \u0026lt;div class=\u0026quot;fw-nowrap fc-black-600\u0026quot;\u0026gt;\n            \u0026lt;div class=\u0026quot;d-flex fd-column lh-md\u0026quot;\u0026gt;\n                \u0026lt;div class=\u0026quot;mb0 d-flex\u0026quot;\u0026gt;\n                        \u0026lt;div class=\u0026quot;flex--item mr8\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;svg-icon iconLightbulb\u0026quot; width=\u0026quot;18\u0026quot; height=\u0026quot;18\u0026quot; viewBox=\u0026quot;0 0 18 18\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;M15 6.38A6.48 6.48 0 0 0 7.78.04h-.02A6.49 6.49 0 0 0 2.05 5.6a6.31 6.31 0 0 0 2.39 5.75c.49.39.76.93.76 1.5v.24c0 1.07.89 1.9 1.92 1.9h2.75c1.04 0 1.92-.83 1.92-1.9v-.2c0-.6.26-1.15.7-1.48A6.32 6.32 0 0 0 15 6.37ZM4.03 5.85A4.49 4.49 0 0 1 8 2.02a4.48 4.48 0 0 1 5 4.36 4.3 4.3 0 0 1-1.72 3.44c-.98.74-1.5 1.9-1.5 3.08v.1H7.2v-.14c0-1.23-.6-2.34-1.53-3.07a4.32 4.32 0 0 1-1.64-3.94ZM10 18a1 1 0 0 0 0-2H7a1 1 0 1 0 0 2h3Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/div\u0026gt;\n                    \u0026lt;p\u0026gt;\u0026lt;b\u0026gt;Want to improve this question?\u0026lt;/b\u0026gt; Update the question so it can be answered with facts and citations by \u0026lt;a href=\u0026quot;/posts/5863870/edit\u0026quot;\u0026gt;editing this post\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n                \u0026lt;/div\u0026gt;\n                    \u0026lt;div class=\u0026quot;mb0 mt6 d-flex\u0026quot;\u0026gt;\n                        \u0026lt;p class=\u0026quot;ml24 pl2\u0026quot;\u0026gt;Closed \u0026lt;span title=\u0026quot;2018-11-22 00:32:07Z\u0026quot; class=\u0026quot;relativetime\u0026quot;\u0026gt;3 years ago\u0026lt;/span\u0026gt;.\u0026lt;/p\u0026gt;\n                    \u0026lt;/div\u0026gt;\n                \u0026lt;div class=\u0026quot;ml24 pl2\u0026quot;\u0026gt;\n\n                \u0026lt;/div\u0026gt;\n            \u0026lt;/div\u0026gt;\n        \u0026lt;/div\u0026gt;\n            \u0026lt;div class=\u0026quot;mt24 d-flex gsx gs8\u0026quot;\u0026gt;\n                    \u0026lt;a class=\u0026quot;s-btn s-btn__outlined flex--item js-post-notice-edit-post\u0026quot; href=\u0026quot;/posts/5863870/edit\u0026quot;\u0026gt;\n                        Improve this question\n                    \u0026lt;/a\u0026gt;\n            \u0026lt;/div\u0026gt;\n\u0026lt;/aside\u0026gt;\n\n    \u0026lt;/div\u0026gt;\n\n\u0026lt;p\u0026gt;I am just getting a grasp on the MVC framework and I often wonder how much code should go in the model. I tend to have a data access class that has methods like this:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;CheckUsername\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$connection\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$username\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;)\n\u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;try\u0026lt;/span\u0026gt;\n    {\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$data\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;();\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$data\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Username\u0026apos;\u0026lt;/span\u0026gt;] = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$username\u0026lt;/span\u0026gt;;\n\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//// SQL\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT Username FROM\u0026quot;\u0026lt;/span\u0026gt; . \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;usersTableName . \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot; WHERE Username = :Username\u0026quot;\u0026lt;/span\u0026gt;;\n\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//// Execute statement\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;ExecuteObject\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$connection\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$sql\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$data\u0026lt;/span\u0026gt;);\n    }\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Exception\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$e\u0026lt;/span\u0026gt;)\n    {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;throw\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$e\u0026lt;/span\u0026gt;;\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;My models tend to be an entity class that is mapped to the database table.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Should the model object have all the database mapped properties as well as the code above or is it OK to separate that code out that actually does the database work?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Will I end up having four layers?\u0026lt;/p\u0026gt;\n    ","slug":"how-should-a-model-be-structured-in-mvc-closed-1657388394807","postType":"QUESTION","createdAt":"2022-07-09T17:39:54.000Z","updatedAt":"2022-07-09T17:39:54.000Z","tags":[{"id":2680,"name":"architecture","slug":"architecture","createdAt":"2022-07-09T17:39:55.000Z","updatedAt":"2022-07-09T17:39:55.000Z","Questions_Tags":{"questionId":551,"tagId":2680}},{"id":2681,"name":"model","slug":"model","createdAt":"2022-07-09T17:39:55.000Z","updatedAt":"2022-07-09T17:39:55.000Z","Questions_Tags":{"questionId":551,"tagId":2681}}],"relatedQuestions":[{"title":"How should a model be structured in MVC? [closed]","slug":"how-should-a-model-be-structured-in-mvc-closed-1657388394807","tags":[{"name":"architecture","Questions_Tags":{"questionId":551,"tagId":2680}},{"name":"model","Questions_Tags":{"questionId":551,"tagId":2681}}]}]},"randomQuestions":[{"title":"Most efficient method to groupby on an array of objects","slug":"most-efficient-method-to-groupby-on-an-array-of-objects-1657387580538"},{"title":"How to compare arrays in JavaScript?","slug":"how-to-compare-arrays-in-javascript-1657387352277"},{"title":"PHP mail function doesn't complete sending of e-mail","slug":"php-mail-function-doesn't-complete-sending-of-e-mail-1657384307499"},{"title":"Percentage Height HTML 5/CSS","slug":"percentage-height-html-5css-1657387471048"},{"title":"How to make a great R reproducible example","slug":"how-to-make-a-great-r-reproducible-example-1657384198173"},{"title":"Captured variable in a loop in C#","slug":"captured-variable-in-a-loop-in-c-1657387696779"},{"title":"What does enctype='multipart/form-data' mean?","slug":"what-does-enctype'multipartform-data'-mean-1657388229352"},{"title":"How do I check if an array includes a value in JavaScript?","slug":"how-do-i-check-if-an-array-includes-a-value-in-javascript-1657387421185"},{"title":"Pandas conditional creation of a series/dataframe column","slug":"pandas-conditional-creation-of-a-seriesdataframe-column-1657387461003"},{"title":"GUI not working after rewriting to MVC","slug":"gui-not-working-after-rewriting-to-mvc-1657388388035"},{"title":"What is the difference between a deep copy and a shallow copy?","slug":"what-is-the-difference-between-a-deep-copy-and-a-shallow-copy-1657388445063"},{"title":"What is SQL injection? [duplicate]","slug":"what-is-sql-injection-duplicate-1657387944486"},{"title":"When to use LinkedList over ArrayList in Java?","slug":"when-to-use-linkedlist-over-arraylist-in-java-1657388107480"},{"title":"How to fix java.lang.UnsupportedClassVersionError: Unsupported major.minor version","slug":"how-to-fix-java.lang.unsupportedclassversionerror:-unsupported-major.minor-version-1657384863422"},{"title":"How can I change an element's class with JavaScript?","slug":"how-can-i-change-an-element's-class-with-javascript-1657387694695"},{"title":"MySQL Error 1093 - Can't specify target table for update in FROM clause","slug":"mysql-error-1093-can't-specify-target-table-for-update-in-from-clause-1657388078961"},{"title":"Google Maps JS API v3 - Simple Multiple Marker Example","slug":"google-maps-js-api-v3-simple-multiple-marker-example-1657388073335"},{"title":"RegEx match open tags except XHTML self-contained tags","slug":"regex-match-open-tags-except-xhtml-self-contained-tags-1657384228245"},{"title":"What is array to pointer decay?","slug":"what-is-array-to-pointer-decay-1657384709608"},{"title":"How do I compose a rotation matrix with human readable angles from scratch?","slug":"how-do-i-compose-a-rotation-matrix-with-human-readable-angles-from-scratch-1657387963457"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"how-should-a-model-be-structured-in-mvc-closed-1657388394807"},"buildId":"xZs8haGjOP63QuDE0kxeX","isFallback":false,"gsp":true,"locale":"en","locales":["en"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>