<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find the solution to any question. We focus on finding the fastest possible solution for users. Main topics like coding, learning. - solutionschecker.com"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><link name="keywords" content="solutions checker, solution checker, how to, solution for, check for solution, resolve question, what is, what solution for, find solution"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://solutionschecker.com","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@id":"https://solutionschecker.com/questions","name":"Questions"}},{"@type":"ListItem","position":3,"item":{"@id":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006","name":"Questions"}}]}</script><title>How do I convert an existing callback API to promises? | Solution Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="I want to work with promises but I have a callback API in a format like:

1. DOM load or other one time event:

window.onload; // set to callback
...
window.onload = function() {

};


2. Plain callback:

function request(onChangeHandler) {
    ...
}
request(function() {
    // change happened
    ...
});


3. Node style callback (&quot;nodeback&quot;):

function getStuff(dat, callback) {
    ...
}
getStuff(&quot;dataParam&quot;, function(err, data) {
    ...
})


4. A whole library with node style callbacks:

API;
API.one(function(err, data) {
    API.two(function(err, data2) {
        API.three(function(err, data3) {
            ...
        });
    });
});


How do I work with the API in promises, how do I &quot;promisify&quot; it?
    "/><meta property="og:title" content="How do I convert an existing callback API to promises? | Solution Checker"/><meta property="og:description" content="I want to work with promises but I have a callback API in a format like:

1. DOM load or other one time event:

window.onload; // set to callback
...
window.onload = function() {

};


2. Plain callback:

function request(onChangeHandler) {
    ...
}
request(function() {
    // change happened
    ...
});


3. Node style callback (&quot;nodeback&quot;):

function getStuff(dat, callback) {
    ...
}
getStuff(&quot;dataParam&quot;, function(err, data) {
    ...
})


4. A whole library with node style callbacks:

API;
API.one(function(err, data) {
    API.two(function(err, data2) {
        API.three(function(err, data3) {
            ...
        });
    });
});


How do I work with the API in promises, how do I &quot;promisify&quot; it?
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"How do I convert an existing callback API to promises?","text":"I want to work with promises but I have a callback API in a format like:\n\n1. DOM load or other one time event:\n\nwindow.onload; // set to callback\n...\nwindow.onload = function() {\n\n};\n\n\n2. Plain callback:\n\nfunction request(onChangeHandler) {\n    ...\n}\nrequest(function() {\n    // change happened\n    ...\n});\n\n\n3. Node style callback (&quot;nodeback&quot;):\n\nfunction getStuff(dat, callback) {\n    ...\n}\ngetStuff(&quot;dataParam&quot;, function(err, data) {\n    ...\n})\n\n\n4. A whole library with node style callbacks:\n\nAPI;\nAPI.one(function(err, data) {\n    API.two(function(err, data2) {\n        API.three(function(err, data3) {\n            ...\n        });\n    });\n});\n\n\nHow do I work with the API in promises, how do I &quot;promisify&quot; it?\n    ","answerCount":24,"upVoteCount":500,"suggestedAnswer":[{"text":"Promises have state, they start as pending and can settle to:\n\n\nfulfilled meaning that the computation completed successfully.\nrejected meaning that the computation failed.\n\n\nPromise returning functions should never throw, they should return rejections instead. Throwing from a promise returning function will force you to use both a } catch { and a .catch. People using promisified APIs do not expect promises to throw. If you&apos;re not sure how async APIs work in JS - please see this answer first.\n\n1. DOM load or other one time event:\n\nSo, creating promises generally means specifying when they settle - that means when they move to the fulfilled or rejected phase to indicate the data is available (and can be accessed with .then).\n\nWith modern promise implementations that support the Promise constructor like native ES6 promises:\n\nfunction load() {\n    return new Promise(function(resolve, reject) {\n        window.onload = resolve;\n    });\n}\n\n\nYou would then use the resulting promise like so:\n\nload().then(function() {\n    // Do things after onload\n});\n\n\nWith libraries that support deferred (Let&apos;s use $q for this example here, but we&apos;ll also use jQuery later):\n\nfunction load() {\n    var d = $q.defer();\n    window.onload = function() { d.resolve(); };\n    return d.promise;\n}\n\n\nOr with a jQuery like API, hooking on an event happening once:\n\nfunction done() {\n    var d = $.Deferred();\n    $(&quot;#myObject&quot;).once(&quot;click&quot;,function() {\n        d.resolve();\n    });\n    return d.promise();\n}\n\n\n2. Plain callback:\n\nThese APIs are rather common since well callbacks are common in JS. Let&apos;s look at the common case of having onSuccess and onFail:\n\nfunction getUserData(userId, onLoad, onFail) { \n\n\nWith modern promise implementations that support the Promise constructor like native ES6 promises:\n\nfunction getUserDataAsync(userId) {\n    return new Promise(function(resolve, reject) {\n        getUserData(userId, resolve, reject);\n    });\n}\n\n\nWith libraries that support deferred (Let&apos;s use jQuery for this example here, but we&apos;ve also used $q above):\n\nfunction getUserDataAsync(userId) {\n    var d = $.Deferred();\n    getUserData(userId, function(res){ d.resolve(res); }, function(err){ d.reject(err); });\n    return d.promise();\n}\n\n\njQuery also offers a $.Deferred(fn) form, which has the advantage of allowing us to write an expression that emulates very closely the new Promise(fn) form, as follows:\n\nfunction getUserDataAsync(userId) {\n    return $.Deferred(function(dfrd) {\n        getUserData(userId, dfrd.resolve, dfrd.reject);\n    }).promise();\n}\n\n\nNote: Here we exploit the fact that a jQuery deferred&apos;s resolve and reject methods are &quot;detachable&quot;; ie. they are bound to the instance of a jQuery.Deferred(). Not all libs offer this feature.\n\n3. Node style callback (&quot;nodeback&quot;):\n\nNode style callbacks (nodebacks) have a particular format where the callbacks is always the last argument and its first parameter is an error. Let&apos;s first promisify one manually:\n\ngetStuff(&quot;dataParam&quot;, function(err, data) { \n\n\nTo:\n\nfunction getStuffAsync(param) {\n    return new Promise(function(resolve, reject) {\n        getStuff(param, function(err, data) {\n            if (err !== null) reject(err);\n            else resolve(data);\n        });\n    });\n}\n\n\nWith deferreds you can do the following (let&apos;s use Q for this example, although Q now supports the new syntax which you should prefer): \n\nfunction getStuffAsync(param) {\n    var d = Q.defer();\n    getStuff(param, function(err, data) {\n        if (err !== null) d.reject(err);\n        else d.resolve(data);\n    });\n    return d.promise;   \n}\n\n\nIn general, you should not promisify things manually too much, most promise libraries that were designed with Node in mind as well as native promises in Node 8+ have a built in method for promisifying nodebacks. For example\n\nvar getStuffAsync = Promise.promisify(getStuff); // Bluebird\nvar getStuffAsync = Q.denodeify(getStuff); // Q\nvar getStuffAsync = util.promisify(getStuff); // Native promises, node only\n\n\n4. A whole library with node style callbacks:\n\nThere is no golden rule here, you promisify them one by one. However, some promise implementations allow you to do this in bulk, for example in Bluebird, converting a nodeback API to a promise API is as simple as:\n\nPromise.promisifyAll(API);\n\n\nOr with native promises in Node:\n\nconst { promisify } = require(&apos;util&apos;);\nconst promiseAPI = Object.entries(API).map(([key, v]) =&gt; ({key, fn: promisify(v)}))\n                         .reduce((o, p) =&gt; Object.assign(o, {[p.key]: p.fn}), {});\n\n\nNotes:\n\n\nOf course, when you are in a .then handler you do not need to promisify things. Returning a promise from a .then handler will resolve or reject with that promise&apos;s value. Throwing from a .then handler is also good practice and will reject the promise - this is the famous promise throw safety. \nIn an actual onload case, you should use addEventListener rather than onX.\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution1","@type":"Answer","upvoteCount":0},{"text":"Today, I can use Promise in Node.js as a plain Javascript method.\n\nA simple and basic example to Promise (with KISS way):\n\nPlain Javascript Async API code:\n\nfunction divisionAPI (number, divider, successCallback, errorCallback) {\n\n    if (divider == 0) {\n        return errorCallback( new Error(&quot;Division by zero&quot;) )\n    }\n\n    successCallback( number / divider )\n\n}\n\n\nPromise Javascript Async API code:\n\nfunction divisionAPI (number, divider) {\n\n    return new Promise(function (fulfilled, rejected) {\n\n        if (divider == 0) {\n            return rejected( new Error(&quot;Division by zero&quot;) )\n        }\n\n        fulfilled( number / divider )\n\n     })\n\n}\n\n\n(I recommend visiting this beautiful source)\n\nAlso Promise can be used with together async\\await in ES7 to make the program flow wait for a fullfiled result like the following:\n\nfunction getName () {\n\n    return new Promise(function (fulfilled, rejected) {\n\n        var name = &quot;John Doe&quot;;\n\n        // wait 3000 milliseconds before calling fulfilled() method\n        setTimeout ( \n            function() {\n                fulfilled( name )\n            }, \n            3000\n        )\n\n    })\n\n}\n\n\nasync function foo () {\n\n    var name = await getName(); // awaits for a fulfilled result!\n\n    console.log(name); // the console writes &quot;John Doe&quot; after 3000 milliseconds\n\n}\n\n\nfoo() // calling the foo() method to run the code\n\n\nAnother usage with the same code by using .then() method\n\nfunction getName () {\n\n    return new Promise(function (fulfilled, rejected) {\n\n        var name = &quot;John Doe&quot;;\n\n        // wait 3000 milliseconds before calling fulfilled() method\n        setTimeout ( \n            function() {\n                fulfilled( name )\n            }, \n            3000\n        )\n\n    })\n\n}\n\n\n// the console writes &quot;John Doe&quot; after 3000 milliseconds\ngetName().then(function(name){ console.log(name) })\n\n\nPromise can also be used on any platform that is based on Node.js like react-native.\n\nBonus: An hybrid method \n(The callback method is assumed to have two parameters as error and result)\n\nfunction divisionAPI (number, divider, callback) {\n\n    return new Promise(function (fulfilled, rejected) {\n\n        if (divider == 0) {\n            let error = new Error(&quot;Division by zero&quot;)\n            callback &amp;&amp; callback( error )\n            return rejected( error )\n        }\n\n        let result = number / divider\n        callback &amp;&amp; callback( null, result )\n        fulfilled( result )\n\n     })\n\n}\n\n\nThe above method can respond result for old fashion callback and Promise usages.\n\nHope this helps.\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution2","@type":"Answer","upvoteCount":0},{"text":"Before converting a function as promise In Node.JS\n\nvar request = require(&apos;request&apos;); //http wrapped module\n\nfunction requestWrapper(url, callback) {\n    request.get(url, function (err, response) {\n      if (err) {\n        callback(err);\n      }else{\n        callback(null, response);             \n      }      \n    })\n}\n\n\nrequestWrapper(url, function (err, response) {\n    console.log(err, response)\n})\n\n\nAfter Converting It\n\nvar request = require(&apos;request&apos;);\n\nfunction requestWrapper(url) {\n  return new Promise(function (resolve, reject) { //returning promise\n    request.get(url, function (err, response) {\n      if (err) {\n        reject(err); //promise reject\n      }else{\n        resolve(response); //promise resolve\n      }\n    })\n  })\n}\n\n\nrequestWrapper(&apos;http://localhost:8080/promise_request/1&apos;).then(function(response){\n    console.log(response) //resolve callback(success)\n}).catch(function(error){\n    console.log(error) //reject callback(failure)\n})\n\n\nIncase you need to handle multiple request \n\nvar allRequests = [];\nallRequests.push(requestWrapper(&apos;http://localhost:8080/promise_request/1&apos;)) \nallRequests.push(requestWrapper(&apos;http://localhost:8080/promise_request/2&apos;))\nallRequests.push(requestWrapper(&apos;http://localhost:8080/promise_request/5&apos;))    \n\nPromise.all(allRequests).then(function (results) {\n  console.log(results);//result will be array which contains each promise response\n}).catch(function (err) {\n  console.log(err)\n});\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution3","@type":"Answer","upvoteCount":0},{"text":"I don&apos;t think the window.onload suggestion by @Benjamin will work all the time, as it doesn&apos;t detect whether it is called after the load. I have been bitten by that many times. Here is a version which should always work:\n\nfunction promiseDOMready() {\n    return new Promise(function(resolve) {\n        if (document.readyState === &quot;complete&quot;) return resolve();\n        document.addEventListener(&quot;DOMContentLoaded&quot;, resolve);\n    });\n}\npromiseDOMready().then(initOnLoad);\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution4","@type":"Answer","upvoteCount":0},{"text":"Node.js 8.0.0 includes a new util.promisify() API that allows standard Node.js callback style APIs to be wrapped in a function that returns a Promise. An example use of util.promisify() is shown below.\nconst fs = require(&apos;fs&apos;);\nconst util = require(&apos;util&apos;);\n\nconst readFile = util.promisify(fs.readFile);\n\nreadFile(&apos;/some/file&apos;)\n  .then((data) =&gt; { /* ... */ })\n  .catch((err) =&gt; { /* ... */ });\n\nSee Improved support for Promises\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution5","@type":"Answer","upvoteCount":0},{"text":"A simple generic function I normally use.\nconst promisify = (fn, ...args) =&gt; {\n  return new Promise((resolve, reject) =&gt; {\n    fn(...args, (err, data) =&gt; {\n      if (err) {\n        return reject(err);\n      }\n      resolve(data);\n    });\n  });\n};\n\nHow to use it\n\nThe function promisify accepts a function with a callback:\n\n   const cb = (result) =&gt; `The result is ${result}`;\n\n   const sum = (a, b, cb) =&gt; {\n    const result = a + b;\n    cb(result); // passing args to the callback function\n   }\n\n\n  // using the util\n  promise = promisify(sum, 3, 1, cb);\n  promise.then(x =&gt; console.log(x)) // 4\n\nYou are probably not looking for this answer, but this will help understand the inner workings of the available utils\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution6","@type":"Answer","upvoteCount":0},{"text":"In release candidate for Node.js 8.0.0, there&apos;s a new utility, util.promisify (I&apos;ve written about util.promisify), that encapsulates the capacity of promisifying whatever function.\n\nIt is not much different from the approaches suggested in the other answers, but has the advantage of being a core method, and not requiring additional dependencies. \n\nconst fs = require(&apos;fs&apos;);\nconst util = require(&apos;util&apos;);\n\nconst readFile = util.promisify(fs.readFile);\n\n\nThen you&apos;ve a readFile method that returns a native Promise.\n\nreadFile(&apos;./notes.txt&apos;)\n  .then(txt =&gt; console.log(txt))\n  .catch(...);\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution7","@type":"Answer","upvoteCount":0},{"text":"You can use JavaScript native promises with Node JS.\n\nMy Cloud 9 code link: https://ide.c9.io/adx2803/native-promises-in-node\n\n/**\n* Created by dixit-lab on 20/6/16.\n*/\n\nvar express = require(&apos;express&apos;);\nvar request = require(&apos;request&apos;);   //Simplified HTTP request client.\n\n\nvar app = express();\n\nfunction promisify(url) {\n    return new Promise(function (resolve, reject) {\n        request.get(url, function (error, response, body) {\n            if (!error &amp;&amp; response.statusCode == 200) {\n                resolve(body);\n            }\n            else {\n                reject(error);\n            }\n        })\n    });\n}\n\n//get all the albums of a user who have posted post 100\napp.get(&apos;/listAlbums&apos;, function (req, res) {\n    //get the post with post id 100\n    promisify(&apos;http://jsonplaceholder.typicode.com/posts/100&apos;).then(function (result) {\n        var obj = JSON.parse(result);\n        return promisify(&apos;http://jsonplaceholder.typicode.com/users/&apos; + obj.userId + &apos;/albums&apos;)\n    })\n    .catch(function (e) {\n        console.log(e);\n    })\n    .then(function (result) {\n        res.end(result);\n    })\n})\n\nvar server = app.listen(8081, function () {\n    var host = server.address().address\n    var port = server.address().port\n\n    console.log(&quot;Example app listening at http://%s:%s&quot;, host, port)\n})\n\n//run webservice on browser : http://localhost:8081/listAlbums\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution8","@type":"Answer","upvoteCount":0},{"text":"With plain old vanilla javaScript, here&apos;s a solution to promisify an api callback.\n\nfunction get(url, callback) {\n        var xhr = new XMLHttpRequest();\n        xhr.open(&apos;get&apos;, url);\n        xhr.addEventListener(&apos;readystatechange&apos;, function () {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    console.log(&apos;successful ... should call callback ... &apos;);\n                    callback(null, JSON.parse(xhr.responseText));\n                } else {\n                    console.log(&apos;error ... callback with error data ... &apos;);\n                    callback(xhr, null);\n                }\n            }\n        });\n        xhr.send();\n    }\n\n/**\n     * @function promisify: convert api based callbacks to promises\n     * @description takes in a factory function and promisifies it\n     * @params {function} input function to promisify\n     * @params {array} an array of inputs to the function to be promisified\n     * @return {function} promisified function\n     * */\n    function promisify(fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return new Promise(function(resolve, reject) {\n                fn.apply(null, args.concat(function (err, result) {\n                    if (err) reject(err);\n                    else resolve(result);\n                }));\n            });\n        }\n    }\n\nvar get_promisified = promisify(get);\nvar promise = get_promisified(&apos;some_url&apos;);\npromise.then(function (data) {\n        // corresponds to the resolve function\n        console.log(&apos;successful operation: &apos;, data);\n}, function (error) {\n        console.log(error);\n});\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution9","@type":"Answer","upvoteCount":0},{"text":"The Q library by kriskowal includes callback-to-promise functions.\nA method like this:\n\nobj.prototype.dosomething(params, cb) {\n  ...blah blah...\n  cb(error, results);\n}\n\n\ncan be converted with Q.ninvoke\n\nQ.ninvoke(obj,&quot;dosomething&quot;,params).\nthen(function(results) {\n});\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution10","@type":"Answer","upvoteCount":0},{"text":"When you have a few functions that take a callback and you want them to return a promise instead you can use this function to do the conversion.\n\nfunction callbackToPromise(func){\n\n    return function(){\n\n        // change this to use what ever promise lib you are using\n        // In this case i&apos;m using angular $q that I exposed on a util module\n\n        var defered = util.$q.defer();\n\n        var cb = (val) =&gt; {\n            defered.resolve(val);\n        }\n\n        var args = Array.prototype.slice.call(arguments);\n        args.push(cb);    \n        func.apply(this, args);\n\n        return defered.promise;\n    }\n}\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution11","@type":"Answer","upvoteCount":0},{"text":"Under node v7.6+ which has built in promises and async:\n\n// promisify.js\nlet promisify = fn =&gt; (...args) =&gt;\n    new Promise((resolve, reject) =&gt;\n        fn(...args, (err, result) =&gt; {\n            if (err) return reject(err);\n            return resolve(result);\n        })\n    );\n\nmodule.exports = promisify;\n\n\nHow to use:\n\nlet readdir = require(&apos;fs&apos;).readdir;\nlet promisify = require(&apos;./promisify&apos;);\nlet readdirP = promisify(readdir);\n\nasync function myAsyncFn(path) {\n    let entries = await readdirP(path);\n    return entries;\n}\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution12","@type":"Answer","upvoteCount":0},{"text":"In Node.js 8 you can promisify object methods on the fly using this npm module:\n\nhttps://www.npmjs.com/package/doasync\n\nIt uses util.promisify and Proxies so that your objects stay unchanged. Memoization is also done with the use of WeakMaps). Here are some examples:\n\nWith objects:\n\nconst fs = require(&apos;fs&apos;);\nconst doAsync = require(&apos;doasync&apos;);\n\ndoAsync(fs).readFile(&apos;package.json&apos;, &apos;utf8&apos;)\n  .then(result =&gt; {\n    console.dir(JSON.parse(result), {colors: true});\n  });\n\n\nWith functions:\n\ndoAsync(request)(&apos;http://www.google.com&apos;)\n  .then(({body}) =&gt; {\n    console.log(body);\n    // ...\n  });\n\n\nYou can even use native call and apply to bind some context:\n\ndoAsync(myFunc).apply(context, params)\n  .then(result =&gt; { /*...*/ });\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution13","@type":"Answer","upvoteCount":0},{"text":"You can use native Promise in ES6, for exemple dealing with setTimeout:\n\nenqueue(data) {\n\n    const queue = this;\n    // returns the Promise\n    return new Promise(function (resolve, reject) {\n        setTimeout(()=&gt; {\n                queue.source.push(data);\n                resolve(queue); //call native resolve when finish\n            }\n            , 10); // resolve() will be called in 10 ms\n    });\n\n}\n\n\nIn this exemple, the Promise has no reason to fail, so reject() is never called.\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution14","@type":"Answer","upvoteCount":0},{"text":"The callback style function always like this(almost all function in node.js is this style):\n\n//fs.readdir(path[, options], callback)\nfs.readdir(&apos;mypath&apos;,(err,files)=&gt;console.log(files))\n\n\nThis style has same feature: \n\n\nthe callback function is passed by last argument. \nthe callback function always accept the error object as it&apos;s first argument. \n\n\nSo, you could write a function for convert a function with this style like this:\n\nconst R =require(&apos;ramda&apos;)\n\n/**\n * A convenient function for handle error in callback function.\n * Accept two function res(resolve) and rej(reject) ,\n * return a wrap function that accept a list arguments,\n * the first argument as error, if error is null,\n * the res function will call,else the rej function.\n * @param {function} res the function which will call when no error throw\n * @param {function} rej the function which will call when  error occur\n * @return {function} return a function that accept a list arguments,\n * the first argument as error, if error is null, the res function\n * will call,else the rej function\n **/\nconst checkErr = (res, rej) =&gt; (err, ...data) =&gt; R.ifElse(\n    R.propEq(&apos;err&apos;, null),\n    R.compose(\n        res,\n        R.prop(&apos;data&apos;)\n    ),\n    R.compose(\n        rej,\n        R.prop(&apos;err&apos;)\n    )\n)({err, data})\n\n/**\n * wrap the callback style function to Promise style function,\n * the callback style function must restrict by convention:\n * 1. the function must put the callback function where the last of arguments,\n * such as (arg1,arg2,arg3,arg...,callback)\n * 2. the callback function must call as callback(err,arg1arg2,arg...)\n * @param {function} fun the callback style function to transform\n * @return {function} return the new function that will return a Promise,\n * while the origin function throw a error, the Promise will be Promise.reject(error),\n * while the origin function work fine, the Promise will be Promise.resolve(args: array),\n * the args is which callback function accept\n * */\n const toPromise = (fun) =&gt; (...args) =&gt; new Promise(\n    (res, rej) =&gt; R.apply(\n        fun,\n        R.append(\n            checkErr(res, rej),\n            args\n        )\n    )\n)\n\n\nFor more concise, above example used ramda.js. Ramda.js is a excellent library for functional programming. In above code, we used it&apos;s apply(like javascript function.prototype.apply) and append(like javascript function.prototype.push ).\nSo, we could convert the a callback style function to promise style function now:\n\nconst {readdir} = require(&apos;fs&apos;)\nconst readdirP = toPromise(readdir)\nreaddir(Path)\n    .then(\n        (files) =&gt; console.log(files),\n        (err) =&gt; console.log(err)\n    )\n\n\ntoPromise and checkErr function is own by berserk library, it&apos;s a functional programming library fork by ramda.js(create by me).\n\nHope this answer is useful for you.\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution15","@type":"Answer","upvoteCount":0},{"text":"es6-promisify converts callback-based functions to Promise-based functions.\n\nconst promisify = require(&apos;es6-promisify&apos;);\n\nconst promisedFn = promisify(callbackedFn, args);\n\n\nRef: https://www.npmjs.com/package/es6-promisify\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution16","@type":"Answer","upvoteCount":0},{"text":"You can do something like this\n\n// @flow\n\nconst toPromise = (f: (any) =&gt; void) =&gt; {\n  return new Promise&lt;any&gt;((resolve, reject) =&gt; {\n    try {\n      f((result) =&gt; {\n        resolve(result)\n      })\n    } catch (e) {\n      reject(e)\n    }\n  })\n}\n\nexport default toPromise\n\n\nThen use it\n\nasync loadData() {\n  const friends = await toPromise(FriendsManager.loadFriends)\n\n  console.log(friends)\n}\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution17","@type":"Answer","upvoteCount":0},{"text":"My promisify version of a callback function is the P function:\n\n\n\nvar P = function() {\n  var self = this;\n  var method = arguments[0];\n  var params = Array.prototype.slice.call(arguments, 1);\n  return new Promise((resolve, reject) =&gt; {\n    if (method &amp;&amp; typeof(method) == &apos;function&apos;) {\n      params.push(function(err, state) {\n        if (!err) return resolve(state)\n        else return reject(err);\n      });\n      method.apply(self, params);\n    } else return reject(new Error(&apos;not a function&apos;));\n  });\n}\nvar callback = function(par, callback) {\n  var rnd = Math.floor(Math.random() * 2) + 1;\n  return rnd &gt; 1 ? callback(null, par) : callback(new Error(&quot;trap&quot;));\n}\n\ncallback(&quot;callback&quot;, (err, state) =&gt; err ? console.error(err) : console.log(state))\ncallback(&quot;callback&quot;, (err, state) =&gt; err ? console.error(err) : console.log(state))\ncallback(&quot;callback&quot;, (err, state) =&gt; err ? console.error(err) : console.log(state))\ncallback(&quot;callback&quot;, (err, state) =&gt; err ? console.error(err) : console.log(state))\n\nP(callback, &quot;promise&quot;).then(v =&gt; console.log(v)).catch(e =&gt; console.error(e))\nP(callback, &quot;promise&quot;).then(v =&gt; console.log(v)).catch(e =&gt; console.error(e))\nP(callback, &quot;promise&quot;).then(v =&gt; console.log(v)).catch(e =&gt; console.error(e))\nP(callback, &quot;promise&quot;).then(v =&gt; console.log(v)).catch(e =&gt; console.error(e))\n Run code snippetHide resultsExpand snippet\n\n\n\nThe P function requires that the callback signature must be callback(error,result).\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution18","@type":"Answer","upvoteCount":0},{"text":"Below is the implementation of how a function (callback API) can be converted to a promise.\n\nfunction promisify(functionToExec) {\n  return function() {\n    var array = Object.values(arguments);\n    return new Promise((resolve, reject) =&gt; {\n      array.push(resolve)\n      try {\n         functionToExec.apply(null, array);\n      } catch (error) {\n         reject(error)\n      }\n    })\n  }\n}\n\n// USE SCENARIO\n\nfunction apiFunction (path, callback) { // Not a promise\n  // Logic\n}\n\nvar promisedFunction = promisify(apiFunction);\n\npromisedFunction(&apos;path&apos;).then(()=&gt;{\n  // Receive the result here (callback)\n})\n\n// Or use it with await like this\nlet result = await promisedFunction(&apos;path&apos;);\n\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution19","@type":"Answer","upvoteCount":0},{"text":"Perhaps already answered, but this is how I do it typically:\n// given you&apos;ve defined this `Future` fn somewhere:\nconst Future = fn =&gt; {return new Promise((r,t) =&gt; fn(r,t))}\n\n// define an eventFn that takes a promise `resolver`\nconst eventFn = resolve =&gt; {\n  // do event related closure actions here. When finally done, call `resolve()`\n  something.oneventfired = e =&gt; {resolve(e)}\n}\n\n// invoke eventFn in an `async` workflowFn using `Future`\n// to obtain a `promise` wrapper\nconst workflowFn = async () =&gt; {await Future(eventFn)}\n\n\nEspecially for things like indexedDb event wrappers to simplify usage.\n\nOr you might find this variation of Future to be more general purpose\nclass PromiseEx extends Promise {\n  resolve(v,...a) {\n    this.settled = true; this.settledValue = v;\n    return(this.resolve_(v,...a))\n  }\n  reject(v,...a) {\n    this.settled = false; this.settledValue = v;\n    return(this.reject_(v,...a))\n  }\n  static Future(fn,...args) {\n    let r,t,ft = new PromiseEx((r_,t_) =&gt; {r=r_;t=t_})\n    ft.resolve_ = r; ft.reject_ = t; fn(ft,...args);\n    return(ft)\n  }\n}\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution20","@type":"Answer","upvoteCount":0},{"text":"Necromancing a little, bit this link may be useful....\n\nTLDR; look at the snippet example at the end of this answer\n\nwrite/convert functions that can be called expecting\na cb(error,result) or new Promise (...) format\n\n\npromiseToCB converts and exports an existing function that&apos;s been previously coded to return a promise\ncbToPromise converts and exports an existing function that&apos;s been previously coded to call the last argument with (error,result)\n\nif wrapped function supplies more than 1 result, the result will be an array of results\neg cb(undefined,path,stat) ---&gt; resolve([path,stat]) / cb(undefined,[path,stat])\n\n\nasPromise lets you code a new function to return a promise, but it can be called either way\nasCallback lets you code a new function to call cb(err,result), but it can be invoked either way\n\nsample functions\neach sample takes 2 arguments, and resolves/rejects/errors based on random number.\narg2 can be also be used to force pass or fail. (looks for &quot;-pass&quot; or &quot;-fail&quot;).\nwrap existing functions\n\nexports the function to current &quot;this&quot; (or use promiseToCB(function myFunc(){},newThis); )\n\n\n\n    promiseToCB(function sampleFunc1(arg1,arg2) {\n        console.log(&quot;deciding:&quot;,arg1,arg2);\n        return new Promise(function(resolve,reject){\n       \n           const timer = setTimeout(function(){reject([arg1,arg2,&quot;ouch&quot;].join(&quot;-&quot;));},5000);\n           \n           setTimeout(function(){\n               if (arg2.endsWith(&quot;-pass&quot;) || (!arg2.endsWith(&quot;-fail&quot;) &amp;&amp; Math.random()&lt;0.5)) {\n    \n                   console.log(&quot;complete:&quot;,arg1,arg2);\n                   clearTimeout(timer);\n                   resolve([arg1,arg2,&quot;all good&quot;].join(&quot;-&quot;));\n               }\n           },2000);\n        \n        });\n    });\n    \n    cbToPromise(&apos;sampleFunc2&apos;,function someOtherName(arg1,arg2,cb) {\n       console.log(&quot;deciding:&quot;,arg1,arg2);\n       const timer = setTimeout(function(){cb([arg1,arg2,&quot;ouch&quot;].join(&quot;-&quot;));},5000);\n       \n       setTimeout(function(){\n           if (arg2.endsWith(&quot;-pass&quot;) || (!arg2.endsWith(&quot;-fail&quot;) &amp;&amp; Math.random()&lt;0.5)) {\n               console.log(&quot;complete:&quot;,arg1,arg2);\n               clearTimeout(timer);\n               cb(undefined,[arg1,arg2,&quot;all good&quot;].join(&quot;-&quot;));\n           }\n       },2000);\n        \n    },local);\n    \n\nor code new functions, which embed a wrapper.\n     function sampleFunc3(arg1,arg2) {return asPromise(arguments,function(resolve,reject){\n       console.log(&quot;deciding:&quot;,arg1,arg2);\n       const timer = setTimeout(function(){reject([arg1,arg2,&quot;ouch&quot;].join(&quot;-&quot;));},5000);\n       \n       setTimeout(function(){\n           if (arg2.endsWith(&quot;-pass&quot;) || (!arg2.endsWith(&quot;-fail&quot;) &amp;&amp; Math.random()&lt;0.5)) {\n               console.log(&quot;complete:&quot;,arg1,arg2);\n               clearTimeout(timer);\n               resolve([arg1,arg2,&quot;all good&quot;].join(&quot;-&quot;));\n           }\n       },2000);\n        \n    });}\n    \n    function sampleFunc4(arg1,arg2) {return asCallback(arguments,function(cb){\n       console.log(&quot;deciding:&quot;,arg1,arg2);\n       const timer = setTimeout(function(){cb([arg1,arg2,&quot;ouch&quot;].join(&quot;-&quot;));},5000);\n       \n       setTimeout(function(){\n           if (arg2.endsWith(&quot;-pass&quot;) || (!arg2.endsWith(&quot;-fail&quot;) &amp;&amp; Math.random()&lt;0.5)) {\n               console.log(&quot;complete:&quot;,arg1,arg2);\n               clearTimeout(timer);\n               cb(undefined,[arg1,arg2,&quot;all good&quot;].join(&quot;-&quot;));\n           }\n       },2000);\n        \n    });}\n\ntest scipt for above functions\n\n    const local = {}; \n    promiseToCB(function sampleFunc1(arg1,arg2) {\n        console.log(&quot;deciding:&quot;,arg1,arg2);\n        return new Promise(function(resolve,reject){\n       \n           const timer = setTimeout(function(){reject([arg1,arg2,&quot;ouch&quot;].join(&quot;-&quot;));},5000);\n           \n           setTimeout(function(){\n               if (arg2.endsWith(&quot;-pass&quot;) || (!arg2.endsWith(&quot;-fail&quot;) &amp;&amp; Math.random()&lt;0.5)) {\n    \n                   console.log(&quot;complete:&quot;,arg1,arg2);\n                   clearTimeout(timer);\n                   resolve([arg1,arg2,&quot;all good&quot;].join(&quot;-&quot;));\n               }\n           },2000);\n        \n        });\n    });\n    \n    cbToPromise(&apos;sampleFunc2&apos;,function someOtherName(arg1,arg2,cb) {\n       console.log(&quot;deciding:&quot;,arg1,arg2);\n       const timer = setTimeout(function(){cb([arg1,arg2,&quot;ouch&quot;].join(&quot;-&quot;));},5000);\n       \n       setTimeout(function(){\n           if (arg2.endsWith(&quot;-pass&quot;) || (!arg2.endsWith(&quot;-fail&quot;) &amp;&amp; Math.random()&lt;0.5)) {\n               console.log(&quot;complete:&quot;,arg1,arg2);\n               clearTimeout(timer);\n               cb(undefined,[arg1,arg2,&quot;all good&quot;].join(&quot;-&quot;));\n           }\n       },2000);\n        \n    },local);\n    \n    function sampleFunc3(arg1,arg2) {return asPromise(arguments,function(resolve,reject){\n       console.log(&quot;deciding:&quot;,arg1,arg2);\n       const timer = setTimeout(function(){reject([arg1,arg2,&quot;ouch&quot;].join(&quot;-&quot;));},5000);\n       \n       setTimeout(function(){\n           if (arg2.endsWith(&quot;-pass&quot;) || (!arg2.endsWith(&quot;-fail&quot;) &amp;&amp; Math.random()&lt;0.5)) {\n               console.log(&quot;complete:&quot;,arg1,arg2);\n               clearTimeout(timer);\n               resolve([arg1,arg2,&quot;all good&quot;].join(&quot;-&quot;));\n           }\n       },2000);\n        \n    });}\n    \n    function sampleFunc4(arg1,arg2) {return asCallback(arguments,function(cb){\n       console.log(&quot;deciding:&quot;,arg1,arg2);\n       const timer = setTimeout(function(){cb([arg1,arg2,&quot;ouch&quot;].join(&quot;-&quot;));},5000);\n       \n       setTimeout(function(){\n           if (arg2.endsWith(&quot;-pass&quot;) || (!arg2.endsWith(&quot;-fail&quot;) &amp;&amp; Math.random()&lt;0.5)) {\n               console.log(&quot;complete:&quot;,arg1,arg2);\n               clearTimeout(timer);\n               cb(undefined,[arg1,arg2,&quot;all good&quot;].join(&quot;-&quot;));\n           }\n       },2000);\n        \n    });}\n    \n    const log=console.log.bind(console),info=console.info.bind(console),error=console.error.bind(console);\n    \n    sampleFunc1(&quot;sample1&quot;,&quot;promise&quot;).then (log).catch(error);\n    local.sampleFunc2(&quot;sample2&quot;,&quot;promise&quot;).then (log).catch(error);\n    sampleFunc3(&quot;sample3&quot;,&quot;promise&quot;).then (log).catch(error);\n    sampleFunc4(&quot;sample4&quot;,&quot;promise&quot;).then (log).catch(error);\n\n    sampleFunc1(&quot;sample1&quot;,&quot;callback&quot;,info);\n    local.sampleFunc2(&quot;sample2&quot;,&quot;callback&quot;,info);\n    sampleFunc3(&quot;sample3&quot;,&quot;callback&quot;,info);\n    sampleFunc4(&quot;sample4&quot;,&quot;callback&quot;,info);\n    \n    sampleFunc1(&quot;sample1&quot;,&quot;promise-pass&quot;).then (log).catch(error);\n    local.sampleFunc2(&quot;sample2&quot;,&quot;promise-pass&quot;).then (log).catch(error);\n    sampleFunc3(&quot;sample3&quot;,&quot;promise-pass&quot;).then (log).catch(error);\n    sampleFunc4(&quot;sample4&quot;,&quot;promise-pass&quot;).then (log).catch(error);\n\n    sampleFunc1(&quot;sample1&quot;,&quot;callback-pass&quot;,info);\n    local.sampleFunc2(&quot;sample2&quot;,&quot;callback-pass&quot;,info);\n    sampleFunc3(&quot;sample3&quot;,&quot;callback-pass&quot;,info);\n    sampleFunc4(&quot;sample4&quot;,&quot;callback-pass&quot;,info);\n    \n    \n    sampleFunc1(&quot;sample1&quot;,&quot;promise-fail&quot;).then (log).catch(error);\n    local.sampleFunc2(&quot;sample2&quot;,&quot;promise-fail&quot;).then (log).catch(error);\n    sampleFunc3(&quot;sample3&quot;,&quot;promise-fail&quot;).then (log).catch(error);\n    sampleFunc4(&quot;sample4&quot;,&quot;promise-fail&quot;).then (log).catch(error);\n    \n    sampleFunc1(&quot;sample1&quot;,&quot;callback-fail&quot;,info);\n    local.sampleFunc2(&quot;sample2&quot;,&quot;callback-fail&quot;,info);\n    sampleFunc3(&quot;sample3&quot;,&quot;callback-fail&quot;,info);\n    sampleFunc4(&quot;sample4&quot;,&quot;callback-fail&quot;,info);\n \n\n\n\n    var cpArgs = Array.prototype.slice.call.bind(Array.prototype.slice);\n\n    function promiseToCB (nm,fn,THIS) {\n        if (typeof nm===&apos;function&apos;) {\n            THIS=fn;fn=nm;nm=fn.name;\n        }\n        THIS=THIS||this;\n        const func = function () {\n           let args = cpArgs(arguments);\n            if (typeof args[args.length-1]===&apos;function&apos;) {\n                const cb = args.pop();\n                return fn.apply(THIS,args).then(function(r){\n                   cb (undefined,r);\n                }).catch(cb);  \n            } else {\n                return fn.apply(THIS,args);\n            }\n        };\n        Object.defineProperty(func,&apos;name&apos;,{value:nm,enumerable:false,configurable: true});\n        if (THIS[nm]) delete THIS[nm];\n        Object.defineProperty(THIS,nm,{value:func,enumerable:false,configurable: true});\n        return func;\n    }\n\n    function cbToPromise (nm,fn,THIS) {\n        if (typeof nm===&apos;function&apos;) {\n            THIS=fn;fn=nm;nm=fn.name;\n        }\n        THIS=THIS||this;\n        const func = function () {\n           let args = cpArgs(arguments);\n            if (typeof args[args.length-1]===&apos;function&apos;) {\n                return fn.apply(THIS,args);\n            } else {\n                return new Promise(function(resolve,reject){\n                    \n                    args.push(function(err,result){\n                          if (err) return reject(err);\n                          if (arguments.length==2) {\n                             return resolve(result);\n                          }\n                          return resolve(cpArgs(arguments,1));\n                    });\n                              \n                    fn.apply(THIS,args);\n                    \n                });\n            }\n        };\n        Object.defineProperty(func,&apos;name&apos;,{value:nm,enumerable:false,configurable: true});\n        if (THIS[nm]) delete THIS[nm];\n        Object.defineProperty(THIS,nm,{value:func,enumerable:false,configurable: true});\n        return func;\n\n    }\n\n    function asPromise (args,resolver,no_err) {\n        const cb = args[args.length-1],\n        promise  = new Promise(resolver);\n        return (typeof cb===&apos;function&apos;)  ? promise.then(function(result){return cb(no_err,result)}).catch(cb) : promise;\n    }\n\n    function asCallback (args,wrap,no_err) {\n        const cb = args[args.length-1],\n        promise=new Promise(function resolver(resolve,reject) {\n            return wrap (function (err,result) {\n                 if (err) return reject(err);\n                 resolve(result);\n            });\n        });\n        return (typeof cb===&apos;function&apos;)  ? promise.then(function(result){return cb(no_err,result)}).catch(cb) : promise;\n    }\n\n\n    function cbPromiseTest(){\n        /*global sampleFunc1,sampleFunc2*/\n        \n        const local = {}; \n        promiseToCB(function sampleFunc1(arg1,arg2) {\n            console.log(&quot;deciding:&quot;,arg1,arg2);\n            return new Promise(function(resolve,reject){\n           \n               const timer = setTimeout(function(){reject([arg1,arg2,&quot;ouch&quot;].join(&quot;-&quot;));},5000);\n               \n               setTimeout(function(){\n                   if (arg2.endsWith(&quot;-pass&quot;) || (!arg2.endsWith(&quot;-fail&quot;) &amp;&amp; Math.random()&lt;0.5)) {\n        \n                       console.log(&quot;complete:&quot;,arg1,arg2);\n                       clearTimeout(timer);\n                       resolve([arg1,arg2,&quot;all good&quot;].join(&quot;-&quot;));\n                   }\n               },2000);\n            \n            });\n        });\n        \n        cbToPromise(&apos;sampleFunc2&apos;,function someOtherName(arg1,arg2,cb) {\n           console.log(&quot;deciding:&quot;,arg1,arg2);\n           const timer = setTimeout(function(){cb([arg1,arg2,&quot;ouch&quot;].join(&quot;-&quot;));},5000);\n           \n           setTimeout(function(){\n               if (arg2.endsWith(&quot;-pass&quot;) || (!arg2.endsWith(&quot;-fail&quot;) &amp;&amp; Math.random()&lt;0.5)) {\n                   console.log(&quot;complete:&quot;,arg1,arg2);\n                   clearTimeout(timer);\n                   cb(undefined,[arg1,arg2,&quot;all good&quot;].join(&quot;-&quot;));\n               }\n           },2000);\n            \n        },local);\n        \n        function sampleFunc3(arg1,arg2) {return asPromise(arguments,function(resolve,reject){\n           console.log(&quot;deciding:&quot;,arg1,arg2);\n           const timer = setTimeout(function(){reject([arg1,arg2,&quot;ouch&quot;].join(&quot;-&quot;));},5000);\n           \n           setTimeout(function(){\n               if (arg2.endsWith(&quot;-pass&quot;) || (!arg2.endsWith(&quot;-fail&quot;) &amp;&amp; Math.random()&lt;0.5)) {\n                   console.log(&quot;complete:&quot;,arg1,arg2);\n                   clearTimeout(timer);\n                   resolve([arg1,arg2,&quot;all good&quot;].join(&quot;-&quot;));\n               }\n           },2000);\n            \n        });}\n        \n        function sampleFunc4(arg1,arg2) {return asCallback(arguments,function(cb){\n           console.log(&quot;deciding:&quot;,arg1,arg2);\n           const timer = setTimeout(function(){cb([arg1,arg2,&quot;ouch&quot;].join(&quot;-&quot;));},5000);\n           \n           setTimeout(function(){\n               if (arg2.endsWith(&quot;-pass&quot;) || (!arg2.endsWith(&quot;-fail&quot;) &amp;&amp; Math.random()&lt;0.5)) {\n                   console.log(&quot;complete:&quot;,arg1,arg2);\n                   clearTimeout(timer);\n                   cb(undefined,[arg1,arg2,&quot;all good&quot;].join(&quot;-&quot;));\n               }\n           },2000);\n            \n        });}\n        \n        const log=console.log.bind(console),info=console.info.bind(console),error=console.error.bind(console);\n        \n        sampleFunc1(&quot;sample1&quot;,&quot;promise&quot;).then (log).catch(error);\n        local.sampleFunc2(&quot;sample2&quot;,&quot;promise&quot;).then (log).catch(error);\n        sampleFunc3(&quot;sample3&quot;,&quot;promise&quot;).then (log).catch(error);\n        sampleFunc4(&quot;sample4&quot;,&quot;promise&quot;).then (log).catch(error);\n\n        sampleFunc1(&quot;sample1&quot;,&quot;callback&quot;,info);\n        local.sampleFunc2(&quot;sample2&quot;,&quot;callback&quot;,info);\n        sampleFunc3(&quot;sample3&quot;,&quot;callback&quot;,info);\n        sampleFunc4(&quot;sample4&quot;,&quot;callback&quot;,info);\n        \n        sampleFunc1(&quot;sample1&quot;,&quot;promise-pass&quot;).then (log).catch(error);\n        local.sampleFunc2(&quot;sample2&quot;,&quot;promise-pass&quot;).then (log).catch(error);\n        sampleFunc3(&quot;sample3&quot;,&quot;promise-pass&quot;).then (log).catch(error);\n        sampleFunc4(&quot;sample4&quot;,&quot;promise-pass&quot;).then (log).catch(error);\n\n        sampleFunc1(&quot;sample1&quot;,&quot;callback-pass&quot;,info);\n        local.sampleFunc2(&quot;sample2&quot;,&quot;callback-pass&quot;,info);\n        sampleFunc3(&quot;sample3&quot;,&quot;callback-pass&quot;,info);\n        sampleFunc4(&quot;sample4&quot;,&quot;callback-pass&quot;,info);\n        \n        \n        sampleFunc1(&quot;sample1&quot;,&quot;promise-fail&quot;).then (log).catch(error);\n        local.sampleFunc2(&quot;sample2&quot;,&quot;promise-fail&quot;).then (log).catch(error);\n        sampleFunc3(&quot;sample3&quot;,&quot;promise-fail&quot;).then (log).catch(error);\n        sampleFunc4(&quot;sample4&quot;,&quot;promise-fail&quot;).then (log).catch(error);\n        \n        sampleFunc1(&quot;sample1&quot;,&quot;callback-fail&quot;,info);\n        local.sampleFunc2(&quot;sample2&quot;,&quot;callback-fail&quot;,info);\n        sampleFunc3(&quot;sample3&quot;,&quot;callback-fail&quot;,info);\n        sampleFunc4(&quot;sample4&quot;,&quot;callback-fail&quot;,info);\n     \n    }\n    cbPromiseTest();\n Run code snippetHide resultsExpand snippet\n\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution21","@type":"Answer","upvoteCount":0},{"text":"Promises always have a resolve and a reject. When you write an async wrapper, just call the resolve and there you go.\nYou can write a wrapper function for pretty much any function taking a callback like so:\nconst myAsyncWrapper = (...params) =&gt;\n  new Promise((resolve, reject) =&gt; \n    someFunctionWithCallback(...params, (error, response) =&gt;\n      error ? reject(error) : resolve(response)\n    )\n  );\n\nYou can take this further to write a conversion function of callbacks to promises:\nconst promisify =\n  (functionWithCallback) =&gt;\n  (...params) =&gt;\n    new Promise((resolve, reject) =&gt;\n      functionWithCallback(...params, (error, response) =&gt;\n        error ? reject(error) : resolve(response)\n      )\n    );\n\nThis concept of wrapper functions is especially useful when using older libraries or SDKs. For example, consider the Facebook Graph API&apos;s JavaScript SDK, which uses a similar callback structure for making API requests.\nFB.api(apiURL, options, function (request) {\n  if (request.error || !request) return;\n  // handle request\n});\n\nIn modern applications, it is much more useful to use a promise-based API.\nIf you use a function only once or twice, it may be better to promisify the response individually:\n// in an async function\nconst response = await new Promise((resolve, reject) =&gt;\n  FB.api(apiURL, (res) =&gt; (res?.error ? reject(res?.error) : resolve(res)))\n);\n\nIf you use the function a lot, you can use the same wrapper concept to write a function like so:\nconst apiWrapper = (...params) =&gt;\n  new Promise((resolve, reject) =&gt; \n    FB.api(...params, (res) =&gt; (res?.error ? reject(res?.error) : resolve(res)))\n  );\n\nAlthough promisifiers are great sometimes, they won&apos;t work for specific instances like this. In times like these, look on Github for a modern wrapper, or write your own like this.\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution22","@type":"Answer","upvoteCount":0},{"text":"since we know the characteristics of a callback-based function in advance,\nwe can create a function that transforms a callback-based function\ninto an equivalent function returning a Promise.\n\nThe callback is the last argument of the function\n\nIf there is an error, it always the first argument passed to the callback\n\nAny return value is passed after the error to the callback\n function promisify(yourCallbackApi) {\n    return function promisified(...args) {\n      return new Promise((resolve, reject) =&gt; {\n        // newArgs=[..args,callback]\n        const newArgs = [\n          ...args,\n          function (err, result) {\n            if (err) {\n              return reject(err);\n            }\n            resolve(result);\n          },\n        ];\n        // invoke yourCallbackApi with the new list of arguments\n        yourCallbackApi(...newArgs);\n      });\n    };\n  }\n\n\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution23","@type":"Answer","upvoteCount":0},{"text":"It is like 5 years late, but I wanted to post here my promesify version which takes functions from callbacks API and turns them into promises\n\nconst promesify = fn =&gt; {\n  return (...params) =&gt; ({\n    then: cbThen =&gt; ({\n      catch: cbCatch =&gt; {\n        fn(...params, cbThen, cbCatch);\n      }\n    })\n  });\n};\n\n\nTake a look to this very simple version here:\nhttps://gist.github.com/jdtorregrosas/aeee96dd07558a5d18db1ff02f31e21a\n    ","url":"https://solutionschecker.com/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#solution24","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="22"/><script id="google-analytics" data-nscript="beforeInteractive">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NXVLL8B');</script><link rel="preload" href="/_next/static/css/c116652e2d6f4ad0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c116652e2d6f4ad0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-ccfab947c79712f4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-862498b6ec7885c3.js" defer=""></script><script src="/_next/static/chunks/294-106ef8570fa99deb.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-47289857226115f9.js" defer=""></script><script src="/_next/static/xZs8haGjOP63QuDE0kxeX/_buildManifest.js" defer=""></script><script src="/_next/static/xZs8haGjOP63QuDE0kxeX/_ssgManifest.js" defer=""></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NXVLL8B"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h1 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h1></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/how-do-i-convert-an-existing-callback-api-to-promises-1657384694006"><h1>How do I convert an existing callback API to promises?</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"></div></div><div class="question-content mt-5">
                
<p>I want to work with promises but I have a callback API in a format like:</p>

<h3>1. DOM load or other one time event:</h3>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span>; <span class="hljs-comment">// set to callback</span>
...
<span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {

};
</code></pre>

<h3>2. Plain callback:</h3>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">request</span>(<span class="hljs-params">onChangeHandler</span>) {
    ...
}
<span class="hljs-title function_">request</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
    <span class="hljs-comment">// change happened</span>
    ...
});
</code></pre>

<h3>3. Node style callback ("nodeback"):</h3>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getStuff</span>(<span class="hljs-params">dat, callback</span>) {
    ...
}
<span class="hljs-title function_">getStuff</span>(<span class="hljs-string">"dataParam"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) {
    ...
})
</code></pre>

<h3>4. A whole library with node style callbacks:</h3>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-variable constant_">API</span>;
<span class="hljs-variable constant_">API</span>.<span class="hljs-title function_">one</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) {
    <span class="hljs-variable constant_">API</span>.<span class="hljs-title function_">two</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err, data2</span>) {
        <span class="hljs-variable constant_">API</span>.<span class="hljs-title function_">three</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err, data3</span>) {
            ...
        });
    });
});
</code></pre>

<h3>How do I work with the API in promises, how do I "promisify" it?</h3>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><h1 class="text-lg font-semibold mb-5">Navigate to solutions: </h1><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li><li class="pagination-solution-item"><span data-id="#solution3" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">3</span></li><li class="pagination-solution-item"><span data-id="#solution4" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">4</span></li><li class="pagination-solution-item"><span data-id="#solution5" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">5</span></li><li class="pagination-solution-item"><span data-id="#solution6" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">6</span></li><li class="pagination-solution-item"><span data-id="#solution7" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">7</span></li><li class="pagination-solution-item"><span data-id="#solution8" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">8</span></li><li class="pagination-solution-item"><span data-id="#solution9" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">9</span></li><li class="pagination-solution-item"><span data-id="#solution10" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">10</span></li><li class="pagination-solution-item"><span data-id="#solution11" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">11</span></li><li class="pagination-solution-item"><span data-id="#solution12" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">12</span></li><li class="pagination-solution-item"><span data-id="#solution13" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">13</span></li><li class="pagination-solution-item"><span data-id="#solution14" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">14</span></li><li class="pagination-solution-item"><span data-id="#solution15" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">15</span></li><li class="pagination-solution-item"><span data-id="#solution16" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">16</span></li><li class="pagination-solution-item"><span data-id="#solution17" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">17</span></li><li class="pagination-solution-item"><span data-id="#solution18" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">18</span></li><li class="pagination-solution-item"><span data-id="#solution19" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">19</span></li><li class="pagination-solution-item"><span data-id="#solution20" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">20</span></li><li class="pagination-solution-item"><span data-id="#solution21" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">21</span></li><li class="pagination-solution-item"><span data-id="#solution22" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">22</span></li><li class="pagination-solution-item"><span data-id="#solution23" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">23</span></li><li class="pagination-solution-item"><span data-id="#solution24" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">24</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 1</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Promises have state, they start as pending and can settle to:</p>

<ul>
<li><strong>fulfilled</strong> meaning that the computation completed successfully.</li>
<li><strong>rejected</strong> meaning that the computation failed.</li>
</ul>

<p>Promise returning functions <a href="https://stackoverflow.com/q/21887856/1048572"><em>should never throw</em></a>, they should return rejections instead. Throwing from a promise returning function will force you to use both a <code>} catch {</code> <em>and</em> a <code>.catch</code>. People using promisified APIs do not expect promises to throw. If you're not sure how async APIs work in JS - please <a href="https://stackoverflow.com/questions/14220321/how-to-return-the-response-from-an-asynchronous-call/16825593#16825593">see this answer</a> first.</p>

<h3>1. DOM load or other one time event:</h3>

<p>So, creating promises generally means specifying when they settle - that means when they move to the fulfilled or rejected phase to indicate the data is available (and can be accessed with <code>.then</code>).</p>

<p>With modern promise implementations that support the <code>Promise</code> constructor like native ES6 promises:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">load</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = resolve;
    });
}
</code></pre>

<p>You would then use the resulting promise like so:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title function_">load</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
    <span class="hljs-comment">// Do things after onload</span>
});
</code></pre>

<p>With libraries that support deferred (Let's use $q for this example here, but we'll also use jQuery later):</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">load</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">var</span> d = $q.<span class="hljs-title function_">defer</span>();
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) { d.<span class="hljs-title function_">resolve</span>(); };
    <span class="hljs-keyword">return</span> d.<span class="hljs-property">promise</span>;
}
</code></pre>

<p>Or with a jQuery like API, hooking on an event happening once:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">done</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">var</span> d = $.<span class="hljs-title class_">Deferred</span>();
    $(<span class="hljs-string">"#myObject"</span>).<span class="hljs-title function_">once</span>(<span class="hljs-string">"click"</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
        d.<span class="hljs-title function_">resolve</span>();
    });
    <span class="hljs-keyword">return</span> d.<span class="hljs-title function_">promise</span>();
}
</code></pre>

<h3>2. Plain callback:</h3>

<p>These APIs are rather common since well callbacks are common in JS. Let's look at the common case of having <code>onSuccess</code> and <code>onFail</code>:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserData</span>(<span class="hljs-params">userId, onLoad, onFail</span>) { 
</code></pre>

<p>With modern promise implementations that support the <code>Promise</code> constructor like native ES6 promises:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserDataAsync</span>(<span class="hljs-params">userId</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) {
        <span class="hljs-title function_">getUserData</span>(userId, resolve, reject);
    });
}
</code></pre>

<p>With libraries that support deferred (Let's use jQuery for this example here, but we've also used $q above):</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserDataAsync</span>(<span class="hljs-params">userId</span>) {
    <span class="hljs-keyword">var</span> d = $.<span class="hljs-title class_">Deferred</span>();
    <span class="hljs-title function_">getUserData</span>(userId, <span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>){ d.<span class="hljs-title function_">resolve</span>(res); }, <span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>){ d.<span class="hljs-title function_">reject</span>(err); });
    <span class="hljs-keyword">return</span> d.<span class="hljs-title function_">promise</span>();
}
</code></pre>

<p>jQuery also offers a <code>$.Deferred(fn)</code> form, which has the advantage of allowing us to write an expression that emulates very closely the <code>new Promise(fn)</code> form, as follows:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserDataAsync</span>(<span class="hljs-params">userId</span>) {
    <span class="hljs-keyword">return</span> $.<span class="hljs-title class_">Deferred</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">dfrd</span>) {
        <span class="hljs-title function_">getUserData</span>(userId, dfrd.<span class="hljs-property">resolve</span>, dfrd.<span class="hljs-property">reject</span>);
    }).<span class="hljs-title function_">promise</span>();
}
</code></pre>

<p>Note: Here we exploit the fact that a jQuery deferred's <code>resolve</code> and <code>reject</code> methods are "detachable"; ie. they are bound to the <em>instance</em> of a jQuery.Deferred(). Not all libs offer this feature.</p>

<h3>3. Node style callback ("nodeback"):</h3>

<p>Node style callbacks (nodebacks) have a particular format where the callbacks is always the last argument and its first parameter is an error. Let's first promisify one manually:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title function_">getStuff</span>(<span class="hljs-string">"dataParam"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) { 
</code></pre>

<p>To:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getStuffAsync</span>(<span class="hljs-params">param</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) {
        <span class="hljs-title function_">getStuff</span>(param, <span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) {
            <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">null</span>) <span class="hljs-title function_">reject</span>(err);
            <span class="hljs-keyword">else</span> <span class="hljs-title function_">resolve</span>(data);
        });
    });
}
</code></pre>

<p>With deferreds you can do the following (let's use Q for this example, although Q now supports the new syntax <a href="https://stackoverflow.com/q/28687566/1048572">which you should prefer</a>): </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getStuffAsync</span>(<span class="hljs-params">param</span>) {
    <span class="hljs-keyword">var</span> d = Q.<span class="hljs-title function_">defer</span>();
    <span class="hljs-title function_">getStuff</span>(param, <span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) {
        <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">null</span>) d.<span class="hljs-title function_">reject</span>(err);
        <span class="hljs-keyword">else</span> d.<span class="hljs-title function_">resolve</span>(data);
    });
    <span class="hljs-keyword">return</span> d.<span class="hljs-property">promise</span>;   
}
</code></pre>

<p>In general, you should not promisify things manually too much, most promise libraries that were designed with Node in mind as well as native promises in Node 8+ have a built in method for promisifying nodebacks. For example</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> getStuffAsync = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">promisify</span>(getStuff); <span class="hljs-comment">// Bluebird</span>
<span class="hljs-keyword">var</span> getStuffAsync = Q.<span class="hljs-title function_">denodeify</span>(getStuff); <span class="hljs-comment">// Q</span>
<span class="hljs-keyword">var</span> getStuffAsync = util.<span class="hljs-title function_">promisify</span>(getStuff); <span class="hljs-comment">// Native promises, node only</span>
</code></pre>

<h3>4. A whole library with node style callbacks:</h3>

<p>There is no golden rule here, you promisify them one by one. However, some promise implementations allow you to do this in bulk, for example in Bluebird, converting a nodeback API to a promise API is as simple as:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">promisifyAll</span>(<span class="hljs-variable constant_">API</span>);
</code></pre>

<p>Or with <em>native promises</em> in <strong>Node</strong>:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> { promisify } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">const</span> promiseAPI = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-variable constant_">API</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[key, v]</span>) =&gt;</span> ({key, <span class="hljs-attr">fn</span>: <span class="hljs-title function_">promisify</span>(v)}))
                         .<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">o, p</span>) =&gt;</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(o, {[p.<span class="hljs-property">key</span>]: p.<span class="hljs-property">fn</span>}), {});
</code></pre>

<p>Notes:</p>

<ul>
<li>Of course, when you are in a <code>.then</code> handler you do not need to promisify things. Returning a promise from a <code>.then</code> handler will resolve or reject with that promise's value. Throwing from a <code>.then</code> handler is also good practice and will reject the promise - this is the famous promise throw safety. </li>
<li>In an actual <code>onload</code> case, you should use <code>addEventListener</code> rather than <code>onX</code>.</li>
</ul>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 2</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Today, I can use <code>Promise</code> in <code>Node.js</code> as a plain Javascript method.</p>

<p>A simple and basic example to <code>Promise</code> (with <strong><a href="https://en.wikipedia.org/wiki/KISS_principle" rel="noreferrer">KISS</a></strong> way):</p>

<p><strong>Plain</strong> Javascript Async API code:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">divisionAPI</span> (number, divider, successCallback, errorCallback) {

    <span class="hljs-keyword">if</span> (divider == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">errorCallback</span>( <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Division by zero"</span>) )
    }

    <span class="hljs-title function_">successCallback</span>( number / divider )

}
</code></pre>

<p><strong><code>Promise</code></strong> Javascript Async API code:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">divisionAPI</span> (number, divider) {

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">fulfilled, rejected</span>) {

        <span class="hljs-keyword">if</span> (divider == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">rejected</span>( <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Division by zero"</span>) )
        }

        <span class="hljs-title function_">fulfilled</span>( number / divider )

     })

}
</code></pre>

<p>(I recommend visiting <a href="http://exploringjs.com/es6/ch_promises.html" rel="noreferrer">this beautiful source</a>)</p>

<p>Also <code>Promise</code> can be used with together <code>async\await</code> in <code>ES7</code> to make the program flow wait for a <code>fullfiled</code> result like the following:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getName</span> () {

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">fulfilled, rejected</span>) {

        <span class="hljs-keyword">var</span> name = <span class="hljs-string">"John Doe"</span>;

        <span class="hljs-comment">// wait 3000 milliseconds before calling fulfilled() method</span>
        <span class="hljs-built_in">setTimeout</span> ( 
            <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
                <span class="hljs-title function_">fulfilled</span>( name )
            }, 
            <span class="hljs-number">3000</span>
        )

    })

}


<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span> () {

    <span class="hljs-keyword">var</span> name = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getName</span>(); <span class="hljs-comment">// awaits for a fulfilled result!</span>

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name); <span class="hljs-comment">// the console writes "John Doe" after 3000 milliseconds</span>

}


<span class="hljs-title function_">foo</span>() <span class="hljs-comment">// calling the foo() method to run the code</span>
</code></pre>

<p>Another usage with the same code by using <code>.then()</code> method</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getName</span> () {

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">fulfilled, rejected</span>) {

        <span class="hljs-keyword">var</span> name = <span class="hljs-string">"John Doe"</span>;

        <span class="hljs-comment">// wait 3000 milliseconds before calling fulfilled() method</span>
        <span class="hljs-built_in">setTimeout</span> ( 
            <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
                <span class="hljs-title function_">fulfilled</span>( name )
            }, 
            <span class="hljs-number">3000</span>
        )

    })

}


<span class="hljs-comment">// the console writes "John Doe" after 3000 milliseconds</span>
<span class="hljs-title function_">getName</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>){ <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name) })
</code></pre>

<p><code>Promise</code> can also be used on any platform that is based on Node.js like <code>react-native</code>.</p>

<p><strong>Bonus</strong>: An <strong>hybrid</strong> method <br>
(The callback method is assumed to have two parameters as error and result)</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">divisionAPI</span> (number, divider, callback) {

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">fulfilled, rejected</span>) {

        <span class="hljs-keyword">if</span> (divider == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">let</span> error = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Division by zero"</span>)
            callback &amp;&amp; <span class="hljs-title function_">callback</span>( error )
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">rejected</span>( error )
        }

        <span class="hljs-keyword">let</span> result = number / divider
        callback &amp;&amp; <span class="hljs-title function_">callback</span>( <span class="hljs-literal">null</span>, result )
        <span class="hljs-title function_">fulfilled</span>( result )

     })

}
</code></pre>

<p>The above method can respond result for old fashion callback and Promise usages.</p>

<p>Hope this helps.</p>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 3</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><strong>Before converting a function as promise In Node.JS</strong></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request'</span>); <span class="hljs-comment">//http wrapped module</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">requestWrapper</span>(<span class="hljs-params">url, callback</span>) {
    request.<span class="hljs-title function_">get</span>(url, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, response</span>) {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-title function_">callback</span>(err);
      }<span class="hljs-keyword">else</span>{
        <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, response);             
      }      
    })
}


<span class="hljs-title function_">requestWrapper</span>(url, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, response</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err, response)
})
</code></pre>

<p><strong>After Converting It</strong></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">requestWrapper</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) { <span class="hljs-comment">//returning promise</span>
    request.<span class="hljs-title function_">get</span>(url, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, response</span>) {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-title function_">reject</span>(err); <span class="hljs-comment">//promise reject</span>
      }<span class="hljs-keyword">else</span>{
        <span class="hljs-title function_">resolve</span>(response); <span class="hljs-comment">//promise resolve</span>
      }
    })
  })
}


<span class="hljs-title function_">requestWrapper</span>(<span class="hljs-string">'http://localhost:8080/promise_request/1'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>){
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response) <span class="hljs-comment">//resolve callback(success)</span>
}).<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>){
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error) <span class="hljs-comment">//reject callback(failure)</span>
})
</code></pre>

<p><strong>Incase you need to handle multiple request</strong> </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> allRequests = [];
allRequests.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">requestWrapper</span>(<span class="hljs-string">'http://localhost:8080/promise_request/1'</span>)) 
allRequests.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">requestWrapper</span>(<span class="hljs-string">'http://localhost:8080/promise_request/2'</span>))
allRequests.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">requestWrapper</span>(<span class="hljs-string">'http://localhost:8080/promise_request/5'</span>))    

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(allRequests).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">results</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(results);<span class="hljs-comment">//result will be array which contains each promise response</span>
}).<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)
});
</code></pre>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 4</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I don't think the <code>window.onload</code> suggestion by @Benjamin will work all the time, as it doesn't detect whether it is called after the load. I have been bitten by that many times. Here is a version which should always work:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">promiseDOMready</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-property">readyState</span> === <span class="hljs-string">"complete"</span>) <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>();
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"DOMContentLoaded"</span>, resolve);
    });
}
<span class="hljs-title function_">promiseDOMready</span>().<span class="hljs-title function_">then</span>(initOnLoad);
</code></pre>
    </div></div></div></div><div id="solution5" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 5</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Node.js 8.0.0 includes a new <code>util.promisify()</code> API that allows standard Node.js callback style APIs to be wrapped in a function that returns a Promise. An example use of <code>util.promisify()</code> is shown below.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">const</span> readFile = util.<span class="hljs-title function_">promisify</span>(fs.<span class="hljs-property">readFile</span>);

<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'/some/file'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> { <span class="hljs-comment">/* ... */</span> })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> { <span class="hljs-comment">/* ... */</span> });
</code></pre>
<p>See <a href="https://nodejs.org/en/blog/release/v8.0.0/#improved-support-for-promises" rel="nofollow noreferrer">Improved support for Promises</a></p>
    </div></div></div></div><div id="solution6" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 6</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<h2>A simple generic function I normally use.</h2>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">promisify</span> = (<span class="hljs-params">fn, ...args</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-title function_">fn</span>(...args, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(err);
      }
      <span class="hljs-title function_">resolve</span>(data);
    });
  });
};
</code></pre>
<h2>How to use it</h2>
<ul>
<li>The function <code>promisify</code> accepts a function with a callback:</li>
</ul>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">   <span class="hljs-keyword">const</span> <span class="hljs-title function_">cb</span> = (<span class="hljs-params">result</span>) =&gt; <span class="hljs-string">`The result is <span class="hljs-subst">${result}</span>`</span>;

   <span class="hljs-keyword">const</span> <span class="hljs-title function_">sum</span> = (<span class="hljs-params">a, b, cb</span>) =&gt; {
    <span class="hljs-keyword">const</span> result = a + b;
    <span class="hljs-title function_">cb</span>(result); <span class="hljs-comment">// passing args to the callback function</span>
   }


  <span class="hljs-comment">// using the util</span>
  promise = <span class="hljs-title function_">promisify</span>(sum, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, cb);
  promise.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x)) <span class="hljs-comment">// 4</span>
</code></pre>
<p>You are probably not looking for this answer, but this will help understand the inner workings of the available utils</p>
    </div></div></div></div><div id="solution7" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 7</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In release candidate for Node.js 8.0.0, there's a new utility, <code>util.promisify</code> (I've written about <a href="https://brunoscopelliti.com/new-util-promisify-in-nodejs/" rel="noreferrer">util.promisify</a>), that encapsulates the capacity of promisifying whatever function.</p>

<p>It is not much different from the approaches suggested in the other answers, but has the advantage of being a core method, and not requiring additional dependencies. </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

<span class="hljs-keyword">const</span> readFile = util.<span class="hljs-title function_">promisify</span>(fs.<span class="hljs-property">readFile</span>);
</code></pre>

<p>Then you've a <code>readFile</code> method that returns a native <code>Promise</code>.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title function_">readFile</span>(<span class="hljs-string">'./notes.txt'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">txt</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(txt))
  .<span class="hljs-title function_">catch</span>(...);
</code></pre>
    </div></div></div></div><div id="solution8" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 8</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You can use JavaScript native promises with Node JS.</p>

<p>My Cloud 9 code link: <a href="https://ide.c9.io/adx2803/native-promises-in-node" rel="noreferrer">https://ide.c9.io/adx2803/native-promises-in-node</a></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">/**
* Created by dixit-lab on 20/6/16.
*/</span>

<span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'request'</span>);   <span class="hljs-comment">//Simplified HTTP request client.</span>


<span class="hljs-keyword">var</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">promisify</span>(<span class="hljs-params">url</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
        request.<span class="hljs-title function_">get</span>(url, <span class="hljs-keyword">function</span> (<span class="hljs-params">error, response, body</span>) {
            <span class="hljs-keyword">if</span> (!error &amp;&amp; response.<span class="hljs-property">statusCode</span> == <span class="hljs-number">200</span>) {
                <span class="hljs-title function_">resolve</span>(body);
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-title function_">reject</span>(error);
            }
        })
    });
}

<span class="hljs-comment">//get all the albums of a user who have posted post 100</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/listAlbums'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) {
    <span class="hljs-comment">//get the post with post id 100</span>
    <span class="hljs-title function_">promisify</span>(<span class="hljs-string">'http://jsonplaceholder.typicode.com/posts/100'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) {
        <span class="hljs-keyword">var</span> obj = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(result);
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">promisify</span>(<span class="hljs-string">'http://jsonplaceholder.typicode.com/users/'</span> + obj.<span class="hljs-property">userId</span> + <span class="hljs-string">'/albums'</span>)
    })
    .<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e);
    })
    .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) {
        res.<span class="hljs-title function_">end</span>(result);
    })
})

<span class="hljs-keyword">var</span> server = app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8081</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    <span class="hljs-keyword">var</span> host = server.<span class="hljs-title function_">address</span>().<span class="hljs-property">address</span>
    <span class="hljs-keyword">var</span> port = server.<span class="hljs-title function_">address</span>().<span class="hljs-property">port</span>

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Example app listening at http://%s:%s"</span>, host, port)
})

<span class="hljs-comment">//run webservice on browser : http://localhost:8081/listAlbums</span>
</code></pre>
    </div></div></div></div><div id="solution9" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 9</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>With plain old vanilla javaScript, here's a solution to promisify an api callback.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">url, callback</span>) {
        <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();
        xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">'get'</span>, url);
        xhr.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'readystatechange'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
            <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">readyState</span> === <span class="hljs-number">4</span>) {
                <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'successful ... should call callback ... '</span>);
                    <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(xhr.<span class="hljs-property">responseText</span>));
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'error ... callback with error data ... '</span>);
                    <span class="hljs-title function_">callback</span>(xhr, <span class="hljs-literal">null</span>);
                }
            }
        });
        xhr.<span class="hljs-title function_">send</span>();
    }

<span class="hljs-comment">/**
     * <span class="hljs-doctag">@function</span> promisify: convert api based callbacks to promises
     * <span class="hljs-doctag">@description</span> takes in a factory function and promisifies it
     * <span class="hljs-doctag">@params</span> {<span class="hljs-type">function</span>} input function to promisify
     * <span class="hljs-doctag">@params</span> {<span class="hljs-type">array</span>} an array of inputs to the function to be promisified
     * <span class="hljs-doctag">@return</span> {<span class="hljs-type">function</span>} promisified function
     * */</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">promisify</span>(<span class="hljs-params">fn</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
            <span class="hljs-keyword">var</span> args = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve, reject</span>) {
                fn.<span class="hljs-title function_">apply</span>(<span class="hljs-literal">null</span>, args.<span class="hljs-title function_">concat</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">err, result</span>) {
                    <span class="hljs-keyword">if</span> (err) <span class="hljs-title function_">reject</span>(err);
                    <span class="hljs-keyword">else</span> <span class="hljs-title function_">resolve</span>(result);
                }));
            });
        }
    }

<span class="hljs-keyword">var</span> get_promisified = <span class="hljs-title function_">promisify</span>(get);
<span class="hljs-keyword">var</span> promise = <span class="hljs-title function_">get_promisified</span>(<span class="hljs-string">'some_url'</span>);
promise.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) {
        <span class="hljs-comment">// corresponds to the resolve function</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'successful operation: '</span>, data);
}, <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);
});
</code></pre>
    </div></div></div></div><div id="solution10" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 10</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The Q library by kriskowal includes callback-to-promise functions.
A method like this:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">obj.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-title function_">dosomething</span>(<span class="hljs-params">params, cb</span>) {
  ...blah blah...
  <span class="hljs-title function_">cb</span>(error, results);
}
</code></pre>

<p>can be converted with Q.ninvoke</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">Q.<span class="hljs-title function_">ninvoke</span>(obj,<span class="hljs-string">"dosomething"</span>,params).
<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">results</span>) {
});
</code></pre>
    </div></div></div></div><div id="solution11" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 11</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>When you have a few functions that take a callback and you want them to return a promise instead you can use this function to do the conversion.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">callbackToPromise</span>(<span class="hljs-params">func</span>){

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){

        <span class="hljs-comment">// change this to use what ever promise lib you are using</span>
        <span class="hljs-comment">// In this case i'm using angular $q that I exposed on a util module</span>

        <span class="hljs-keyword">var</span> defered = util.<span class="hljs-property">$q</span>.<span class="hljs-title function_">defer</span>();

        <span class="hljs-keyword">var</span> <span class="hljs-title function_">cb</span> = (<span class="hljs-params">val</span>) =&gt; {
            defered.<span class="hljs-title function_">resolve</span>(val);
        }

        <span class="hljs-keyword">var</span> args = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>);
        args.<span class="hljs-title function_">push</span>(cb);    
        func.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);

        <span class="hljs-keyword">return</span> defered.<span class="hljs-property">promise</span>;
    }
}
</code></pre>
    </div></div></div></div><div id="solution12" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 12</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Under node v7.6+ which has built in promises and async:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// promisify.js</span>
<span class="hljs-keyword">let</span> <span class="hljs-title function_">promisify</span> = fn =&gt; <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span>
        <span class="hljs-title function_">fn</span>(...args, <span class="hljs-function">(<span class="hljs-params">err, result</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(err);
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>(result);
        })
    );

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = promisify;
</code></pre>

<p>How to use:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">let</span> readdir = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>).<span class="hljs-property">readdir</span>;
<span class="hljs-keyword">let</span> promisify = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./promisify'</span>);
<span class="hljs-keyword">let</span> readdirP = <span class="hljs-title function_">promisify</span>(readdir);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myAsyncFn</span>(<span class="hljs-params">path</span>) {
    <span class="hljs-keyword">let</span> entries = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readdirP</span>(path);
    <span class="hljs-keyword">return</span> entries;
}
</code></pre>
    </div></div></div></div><div id="solution13" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 13</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In Node.js 8 you can <strong>promisify</strong> object methods <em>on the fly</em> using this npm module:</p>

<p><a href="https://www.npmjs.com/package/doasync" rel="nofollow noreferrer">https://www.npmjs.com/package/doasync</a></p>

<p>It uses <strong>util.promisify</strong> and <strong>Proxies</strong> so that your objects stay unchanged. <strong>Memoization</strong> is also done with the use of WeakMaps). Here are some examples:</p>

<p>With objects:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> doAsync = <span class="hljs-built_in">require</span>(<span class="hljs-string">'doasync'</span>);

<span class="hljs-title function_">doAsync</span>(fs).<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'package.json'</span>, <span class="hljs-string">'utf8'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">dir</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(result), {<span class="hljs-attr">colors</span>: <span class="hljs-literal">true</span>});
  });
</code></pre>

<p>With functions:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title function_">doAsync</span>(request)(<span class="hljs-string">'http://www.google.com'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">{body}</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(body);
    <span class="hljs-comment">// ...</span>
  });
</code></pre>

<p>You can even use native <code>call</code> and <code>apply</code> to bind some context:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title function_">doAsync</span>(myFunc).<span class="hljs-title function_">apply</span>(context, params)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> { <span class="hljs-comment">/*...*/</span> });
</code></pre>
    </div></div></div></div><div id="solution14" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 14</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You can use <strong>native Promise</strong> in ES6, for exemple dealing with setTimeout:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title function_">enqueue</span>(<span class="hljs-params">data</span>) {

    <span class="hljs-keyword">const</span> queue = <span class="hljs-variable language_">this</span>;
    <span class="hljs-comment">// returns the Promise</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span> {
                queue.<span class="hljs-property">source</span>.<span class="hljs-title function_">push</span>(data);
                <span class="hljs-title function_">resolve</span>(queue); <span class="hljs-comment">//call native resolve when finish</span>
            }
            , <span class="hljs-number">10</span>); <span class="hljs-comment">// resolve() will be called in 10 ms</span>
    });

}
</code></pre>

<p>In this exemple, the Promise has no reason to fail, so <code>reject()</code> is never called.</p>
    </div></div></div></div><div id="solution15" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 15</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The <strong>callback style</strong> function always like this(almost all function in node.js is this style):</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">//fs.readdir(path[, options], callback)</span>
fs.<span class="hljs-title function_">readdir</span>(<span class="hljs-string">'mypath'</span>,<span class="hljs-function">(<span class="hljs-params">err,files</span>)=&gt;</span><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(files))
</code></pre>

<p>This style has same feature: </p>

<ol>
<li><p>the callback function is passed by last argument. </p></li>
<li><p>the callback function always accept the error object as it's first argument. </p></li>
</ol>

<p>So, you could write a function for convert a function with this style like this:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> R =<span class="hljs-built_in">require</span>(<span class="hljs-string">'ramda'</span>)

<span class="hljs-comment">/**
 * A convenient function for handle error in callback function.
 * Accept two function res(resolve) and rej(reject) ,
 * return a wrap function that accept a list arguments,
 * the first argument as error, if error is null,
 * the res function will call,else the rej function.
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">function</span>} res the function which will call when no error throw
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">function</span>} rej the function which will call when  error occur
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">function</span>} return a function that accept a list arguments,
 * the first argument as error, if error is null, the res function
 * will call,else the rej function
 **/</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkErr</span> = (<span class="hljs-params">res, rej</span>) =&gt; <span class="hljs-function">(<span class="hljs-params">err, ...data</span>) =&gt;</span> R.<span class="hljs-title function_">ifElse</span>(
    R.<span class="hljs-title function_">propEq</span>(<span class="hljs-string">'err'</span>, <span class="hljs-literal">null</span>),
    R.<span class="hljs-title function_">compose</span>(
        res,
        R.<span class="hljs-title function_">prop</span>(<span class="hljs-string">'data'</span>)
    ),
    R.<span class="hljs-title function_">compose</span>(
        rej,
        R.<span class="hljs-title function_">prop</span>(<span class="hljs-string">'err'</span>)
    )
)({err, data})

<span class="hljs-comment">/**
 * wrap the callback style function to Promise style function,
 * the callback style function must restrict by convention:
 * 1. the function must put the callback function where the last of arguments,
 * such as (arg1,arg2,arg3,arg...,callback)
 * 2. the callback function must call as callback(err,arg1arg2,arg...)
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">function</span>} fun the callback style function to transform
 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">function</span>} return the new function that will return a Promise,
 * while the origin function throw a error, the Promise will be Promise.reject(error),
 * while the origin function work fine, the Promise will be Promise.resolve(args: array),
 * the args is which callback function accept
 * */</span>
 <span class="hljs-keyword">const</span> <span class="hljs-title function_">toPromise</span> = (<span class="hljs-params">fun</span>) =&gt; <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(
    <span class="hljs-function">(<span class="hljs-params">res, rej</span>) =&gt;</span> R.<span class="hljs-title function_">apply</span>(
        fun,
        R.<span class="hljs-title function_">append</span>(
            <span class="hljs-title function_">checkErr</span>(res, rej),
            args
        )
    )
)
</code></pre>

<p>For more concise, above example used ramda.js. Ramda.js is a excellent library for functional programming. In above code, we used it's <strong>apply</strong>(like javascript <code>function.prototype.apply</code>) and append(like javascript <code>function.prototype.push</code> ).
So, we could convert the a callback style function to promise style function now:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> {readdir} = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">const</span> readdirP = <span class="hljs-title function_">toPromise</span>(readdir)
<span class="hljs-title function_">readdir</span>(<span class="hljs-title class_">Path</span>)
    .<span class="hljs-title function_">then</span>(
        <span class="hljs-function">(<span class="hljs-params">files</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(files),
        <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)
    )
</code></pre>

<p><strong>toPromise</strong> and <strong>checkErr</strong> function is own by <a href="https://github.com/jituanlin/berserk" rel="nofollow noreferrer">berserk</a> library, it's a functional programming library fork by <strong>ramda.js</strong>(create by me).</p>

<p>Hope this answer is useful for you.</p>
    </div></div></div></div><div id="solution16" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 16</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><code>es6-promisify</code> converts callback-based functions to Promise-based functions.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> promisify = <span class="hljs-built_in">require</span>(<span class="hljs-string">'es6-promisify'</span>);

<span class="hljs-keyword">const</span> promisedFn = <span class="hljs-title function_">promisify</span>(callbackedFn, args);
</code></pre>

<p>Ref: <a href="https://www.npmjs.com/package/es6-promisify" rel="nofollow noreferrer">https://www.npmjs.com/package/es6-promisify</a></p>
    </div></div></div></div><div id="solution17" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 17</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You can do something like this</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// @flow</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">toPromise</span> = (<span class="hljs-params">f: (any) =&gt; <span class="hljs-keyword">void</span></span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;any&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-title function_">f</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
        <span class="hljs-title function_">resolve</span>(result)
      })
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-title function_">reject</span>(e)
    }
  })
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> toPromise
</code></pre>

<p>Then use it</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-title function_">loadData</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> friends = <span class="hljs-keyword">await</span> <span class="hljs-title function_">toPromise</span>(<span class="hljs-title class_">FriendsManager</span>.<span class="hljs-property">loadFriends</span>)

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(friends)
}
</code></pre>
    </div></div></div></div><div id="solution18" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 18</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>My promisify version of a <code>callback</code> function is the <code>P</code> function:</p>

<p></p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
<div class="snippet-code">
<pre class="snippet-code-js lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> P = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">var</span> self = <span class="hljs-variable language_">this</span>;
  <span class="hljs-keyword">var</span> method = <span class="hljs-variable language_">arguments</span>[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">var</span> params = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>, <span class="hljs-number">1</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (method &amp;&amp; <span class="hljs-title function_">typeof</span>(method) == <span class="hljs-string">'function'</span>) {
      params.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err, state</span>) {
        <span class="hljs-keyword">if</span> (!err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>(state)
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(err);
      });
      method.<span class="hljs-title function_">apply</span>(self, params);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'not a function'</span>));
  });
}
<span class="hljs-keyword">var</span> callback = <span class="hljs-keyword">function</span>(<span class="hljs-params">par, callback</span>) {
  <span class="hljs-keyword">var</span> rnd = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">2</span>) + <span class="hljs-number">1</span>;
  <span class="hljs-keyword">return</span> rnd &gt; <span class="hljs-number">1</span> ? <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, par) : <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"trap"</span>));
}

<span class="hljs-title function_">callback</span>(<span class="hljs-string">"callback"</span>, <span class="hljs-function">(<span class="hljs-params">err, state</span>) =&gt;</span> err ? <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err) : <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state))
<span class="hljs-title function_">callback</span>(<span class="hljs-string">"callback"</span>, <span class="hljs-function">(<span class="hljs-params">err, state</span>) =&gt;</span> err ? <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err) : <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state))
<span class="hljs-title function_">callback</span>(<span class="hljs-string">"callback"</span>, <span class="hljs-function">(<span class="hljs-params">err, state</span>) =&gt;</span> err ? <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err) : <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state))
<span class="hljs-title function_">callback</span>(<span class="hljs-string">"callback"</span>, <span class="hljs-function">(<span class="hljs-params">err, state</span>) =&gt;</span> err ? <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err) : <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state))

<span class="hljs-title function_">P</span>(callback, <span class="hljs-string">"promise"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v)).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e))
<span class="hljs-title function_">P</span>(callback, <span class="hljs-string">"promise"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v)).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e))
<span class="hljs-title function_">P</span>(callback, <span class="hljs-string">"promise"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v)).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e))
<span class="hljs-title function_">P</span>(callback, <span class="hljs-string">"promise"</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v)).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e))</code></pre>
<div class="snippet-result"><div class="snippet-ctas"><button type="button" class="s-btn s-btn__primary"><span class="icon-play-white _hover"></span><span> Run code snippet</span></button><input class="copySnippet s-btn s-btn__filled" type="button" value="Copy snippet to answer" style="display: none;"><button type="button" class="s-btn hideResults" style="display: none;">Hide results</button><div class="popout-code"><a class="snippet-expand-link">Expand snippet</a></div></div><div class="snippet-result-code" style="display: none;"><iframe name="sif1" sandbox="allow-forms allow-modals allow-scripts" class="snippet-box-edit snippet-box-result" frameborder="0"></iframe></div></div></div>
</div>
<p></p>

<p>The <code>P</code> function requires that the callback signature must be <code>callback(error,result)</code>.</p>
    </div></div></div></div><div id="solution19" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 19</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Below is the implementation of how a function (callback API) can be converted to a promise.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">promisify</span>(<span class="hljs-params">functionToExec</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">var</span> array = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">values</span>(<span class="hljs-variable language_">arguments</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      array.<span class="hljs-title function_">push</span>(resolve)
      <span class="hljs-keyword">try</span> {
         functionToExec.<span class="hljs-title function_">apply</span>(<span class="hljs-literal">null</span>, array);
      } <span class="hljs-keyword">catch</span> (error) {
         <span class="hljs-title function_">reject</span>(error)
      }
    })
  }
}

<span class="hljs-comment">// USE SCENARIO</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">apiFunction</span> (path, callback) { <span class="hljs-comment">// Not a promise</span>
  <span class="hljs-comment">// Logic</span>
}

<span class="hljs-keyword">var</span> promisedFunction = <span class="hljs-title function_">promisify</span>(apiFunction);

<span class="hljs-title function_">promisedFunction</span>(<span class="hljs-string">'path'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span>{
  <span class="hljs-comment">// Receive the result here (callback)</span>
})

<span class="hljs-comment">// Or use it with await like this</span>
<span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">promisedFunction</span>(<span class="hljs-string">'path'</span>);

</code></pre>
    </div></div></div></div><div id="solution20" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 20</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<h2>Perhaps already answered, but this is how I do it typically:<br></h2>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// given you've defined this `Future` fn somewhere:</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">Future</span> = fn =&gt; {<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">r,t</span>) =&gt;</span> <span class="hljs-title function_">fn</span>(r,t))}

<span class="hljs-comment">// define an eventFn that takes a promise `resolver`</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">eventFn</span> = resolve =&gt; {
  <span class="hljs-comment">// do event related closure actions here. When finally done, call `resolve()`</span>
  something.<span class="hljs-property">oneventfired</span> = <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {<span class="hljs-title function_">resolve</span>(e)}
}

<span class="hljs-comment">// invoke eventFn in an `async` workflowFn using `Future`</span>
<span class="hljs-comment">// to obtain a `promise` wrapper</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">workflowFn</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {<span class="hljs-keyword">await</span> <span class="hljs-title class_">Future</span>(eventFn)}
</code></pre>
<blockquote>
<p>Especially for things like <code>indexedDb</code> event wrappers to simplify usage.</p>
</blockquote>
<p>Or you might find this variation of <code>Future</code> to be more general purpose</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PromiseEx</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Promise</span> {
  <span class="hljs-title function_">resolve</span>(<span class="hljs-params">v,...a</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">settled</span> = <span class="hljs-literal">true</span>; <span class="hljs-variable language_">this</span>.<span class="hljs-property">settledValue</span> = v;
    <span class="hljs-keyword">return</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">resolve_</span>(v,...a))
  }
  <span class="hljs-title function_">reject</span>(<span class="hljs-params">v,...a</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">settled</span> = <span class="hljs-literal">false</span>; <span class="hljs-variable language_">this</span>.<span class="hljs-property">settledValue</span> = v;
    <span class="hljs-keyword">return</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reject_</span>(v,...a))
  }
  <span class="hljs-keyword">static</span> <span class="hljs-title class_">Future</span>(fn,...args) {
    <span class="hljs-keyword">let</span> r,t,ft = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PromiseEx</span>(<span class="hljs-function">(<span class="hljs-params">r_,t_</span>) =&gt;</span> {r=r_;t=t_})
    ft.<span class="hljs-property">resolve_</span> = r; ft.<span class="hljs-property">reject_</span> = t; <span class="hljs-title function_">fn</span>(ft,...args);
    <span class="hljs-keyword">return</span>(ft)
  }
}
</code></pre>
    </div></div></div></div><div id="solution21" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 21</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Necromancing a little, bit this <a href="https://gist.github.com/jonathan-annett/1a8ae0cc504427317ba2912d2620aae5" rel="nofollow noreferrer">link</a> may be useful....</p>
<hr>
<h2>TLDR; look at the snippet example at the end of this answer</h2>
<hr>
<h1>write/convert functions that can be called expecting</h1>
<h1>a <code>cb(error,result)</code> or <code>new Promise (...)</code> format</h1>
<hr>
<ul>
<li><code>promiseToCB</code> converts and exports an existing function that's been previously coded to return a promise</li>
<li><code>cbToPromise</code> converts and exports an existing function that's been previously coded to call the last argument with (error,result)
<ul>
<li>if wrapped function supplies more than 1 result, the result will be an array of results</li>
<li>eg <code>cb(undefined,path,stat)</code> ---&gt; <code>resolve([path,stat])</code> / <code>cb(undefined,[path,stat])</code></li>
</ul>
</li>
<li><code>asPromise</code> lets you code a new function to return a promise, but it can be called either way</li>
<li><code>asCallback</code> lets you code a new function to call <code>cb(err,result)</code>, but it can be invoked either way</li>
</ul>
<h2>sample functions</h2>
<p>each sample takes 2 arguments, and resolves/rejects/errors based on random number.</p>
<p>arg2 can be also be used to force pass or fail. (looks for "-pass" or "-fail").</p>
<h2>wrap existing functions</h2>
<ul>
<li>exports the function to current "this" (or use <code>promiseToCB(function myFunc(){},newThis);</code> )</li>
</ul>
<hr>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">
    <span class="hljs-title function_">promiseToCB</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-params">arg1,arg2</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"deciding:"</span>,arg1,arg2);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve,reject</span>){
       
           <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-title function_">reject</span>([arg1,arg2,<span class="hljs-string">"ouch"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));},<span class="hljs-number">5000</span>);
           
           <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
               <span class="hljs-keyword">if</span> (arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-pass"</span>) || (!arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-fail"</span>) &amp;&amp; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()&lt;<span class="hljs-number">0.5</span>)) {
    
                   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"complete:"</span>,arg1,arg2);
                   <span class="hljs-built_in">clearTimeout</span>(timer);
                   <span class="hljs-title function_">resolve</span>([arg1,arg2,<span class="hljs-string">"all good"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));
               }
           },<span class="hljs-number">2000</span>);
        
        });
    });
    
    <span class="hljs-title function_">cbToPromise</span>(<span class="hljs-string">'sampleFunc2'</span>,<span class="hljs-keyword">function</span> <span class="hljs-title function_">someOtherName</span>(<span class="hljs-params">arg1,arg2,cb</span>) {
       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"deciding:"</span>,arg1,arg2);
       <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-title function_">cb</span>([arg1,arg2,<span class="hljs-string">"ouch"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));},<span class="hljs-number">5000</span>);
       
       <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
           <span class="hljs-keyword">if</span> (arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-pass"</span>) || (!arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-fail"</span>) &amp;&amp; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()&lt;<span class="hljs-number">0.5</span>)) {
               <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"complete:"</span>,arg1,arg2);
               <span class="hljs-built_in">clearTimeout</span>(timer);
               <span class="hljs-title function_">cb</span>(<span class="hljs-literal">undefined</span>,[arg1,arg2,<span class="hljs-string">"all good"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));
           }
       },<span class="hljs-number">2000</span>);
        
    },local);
    
</code></pre>
<h2>or code new functions, which embed a wrapper.</h2>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">     <span class="hljs-keyword">function</span> <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-params">arg1,arg2</span>) {<span class="hljs-keyword">return</span> <span class="hljs-title function_">asPromise</span>(<span class="hljs-variable language_">arguments</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve,reject</span>){
       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"deciding:"</span>,arg1,arg2);
       <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-title function_">reject</span>([arg1,arg2,<span class="hljs-string">"ouch"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));},<span class="hljs-number">5000</span>);
       
       <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
           <span class="hljs-keyword">if</span> (arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-pass"</span>) || (!arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-fail"</span>) &amp;&amp; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()&lt;<span class="hljs-number">0.5</span>)) {
               <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"complete:"</span>,arg1,arg2);
               <span class="hljs-built_in">clearTimeout</span>(timer);
               <span class="hljs-title function_">resolve</span>([arg1,arg2,<span class="hljs-string">"all good"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));
           }
       },<span class="hljs-number">2000</span>);
        
    });}
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-params">arg1,arg2</span>) {<span class="hljs-keyword">return</span> <span class="hljs-title function_">asCallback</span>(<span class="hljs-variable language_">arguments</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>){
       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"deciding:"</span>,arg1,arg2);
       <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-title function_">cb</span>([arg1,arg2,<span class="hljs-string">"ouch"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));},<span class="hljs-number">5000</span>);
       
       <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
           <span class="hljs-keyword">if</span> (arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-pass"</span>) || (!arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-fail"</span>) &amp;&amp; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()&lt;<span class="hljs-number">0.5</span>)) {
               <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"complete:"</span>,arg1,arg2);
               <span class="hljs-built_in">clearTimeout</span>(timer);
               <span class="hljs-title function_">cb</span>(<span class="hljs-literal">undefined</span>,[arg1,arg2,<span class="hljs-string">"all good"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));
           }
       },<span class="hljs-number">2000</span>);
        
    });}
</code></pre>
<h2>test scipt for above functions</h2>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">
    <span class="hljs-keyword">const</span> local = {}; 
    <span class="hljs-title function_">promiseToCB</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-params">arg1,arg2</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"deciding:"</span>,arg1,arg2);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve,reject</span>){
       
           <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-title function_">reject</span>([arg1,arg2,<span class="hljs-string">"ouch"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));},<span class="hljs-number">5000</span>);
           
           <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
               <span class="hljs-keyword">if</span> (arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-pass"</span>) || (!arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-fail"</span>) &amp;&amp; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()&lt;<span class="hljs-number">0.5</span>)) {
    
                   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"complete:"</span>,arg1,arg2);
                   <span class="hljs-built_in">clearTimeout</span>(timer);
                   <span class="hljs-title function_">resolve</span>([arg1,arg2,<span class="hljs-string">"all good"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));
               }
           },<span class="hljs-number">2000</span>);
        
        });
    });
    
    <span class="hljs-title function_">cbToPromise</span>(<span class="hljs-string">'sampleFunc2'</span>,<span class="hljs-keyword">function</span> <span class="hljs-title function_">someOtherName</span>(<span class="hljs-params">arg1,arg2,cb</span>) {
       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"deciding:"</span>,arg1,arg2);
       <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-title function_">cb</span>([arg1,arg2,<span class="hljs-string">"ouch"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));},<span class="hljs-number">5000</span>);
       
       <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
           <span class="hljs-keyword">if</span> (arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-pass"</span>) || (!arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-fail"</span>) &amp;&amp; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()&lt;<span class="hljs-number">0.5</span>)) {
               <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"complete:"</span>,arg1,arg2);
               <span class="hljs-built_in">clearTimeout</span>(timer);
               <span class="hljs-title function_">cb</span>(<span class="hljs-literal">undefined</span>,[arg1,arg2,<span class="hljs-string">"all good"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));
           }
       },<span class="hljs-number">2000</span>);
        
    },local);
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-params">arg1,arg2</span>) {<span class="hljs-keyword">return</span> <span class="hljs-title function_">asPromise</span>(<span class="hljs-variable language_">arguments</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve,reject</span>){
       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"deciding:"</span>,arg1,arg2);
       <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-title function_">reject</span>([arg1,arg2,<span class="hljs-string">"ouch"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));},<span class="hljs-number">5000</span>);
       
       <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
           <span class="hljs-keyword">if</span> (arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-pass"</span>) || (!arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-fail"</span>) &amp;&amp; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()&lt;<span class="hljs-number">0.5</span>)) {
               <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"complete:"</span>,arg1,arg2);
               <span class="hljs-built_in">clearTimeout</span>(timer);
               <span class="hljs-title function_">resolve</span>([arg1,arg2,<span class="hljs-string">"all good"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));
           }
       },<span class="hljs-number">2000</span>);
        
    });}
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-params">arg1,arg2</span>) {<span class="hljs-keyword">return</span> <span class="hljs-title function_">asCallback</span>(<span class="hljs-variable language_">arguments</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>){
       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"deciding:"</span>,arg1,arg2);
       <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-title function_">cb</span>([arg1,arg2,<span class="hljs-string">"ouch"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));},<span class="hljs-number">5000</span>);
       
       <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
           <span class="hljs-keyword">if</span> (arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-pass"</span>) || (!arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-fail"</span>) &amp;&amp; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()&lt;<span class="hljs-number">0.5</span>)) {
               <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"complete:"</span>,arg1,arg2);
               <span class="hljs-built_in">clearTimeout</span>(timer);
               <span class="hljs-title function_">cb</span>(<span class="hljs-literal">undefined</span>,[arg1,arg2,<span class="hljs-string">"all good"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));
           }
       },<span class="hljs-number">2000</span>);
        
    });}
    
    <span class="hljs-keyword">const</span> log=<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">console</span>),info=<span class="hljs-variable language_">console</span>.<span class="hljs-property">info</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">console</span>),error=<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">console</span>);
    
    <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-string">"sample1"</span>,<span class="hljs-string">"promise"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
    local.<span class="hljs-title function_">sampleFunc2</span>(<span class="hljs-string">"sample2"</span>,<span class="hljs-string">"promise"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
    <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-string">"sample3"</span>,<span class="hljs-string">"promise"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
    <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-string">"sample4"</span>,<span class="hljs-string">"promise"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);

    <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-string">"sample1"</span>,<span class="hljs-string">"callback"</span>,info);
    local.<span class="hljs-title function_">sampleFunc2</span>(<span class="hljs-string">"sample2"</span>,<span class="hljs-string">"callback"</span>,info);
    <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-string">"sample3"</span>,<span class="hljs-string">"callback"</span>,info);
    <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-string">"sample4"</span>,<span class="hljs-string">"callback"</span>,info);
    
    <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-string">"sample1"</span>,<span class="hljs-string">"promise-pass"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
    local.<span class="hljs-title function_">sampleFunc2</span>(<span class="hljs-string">"sample2"</span>,<span class="hljs-string">"promise-pass"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
    <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-string">"sample3"</span>,<span class="hljs-string">"promise-pass"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
    <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-string">"sample4"</span>,<span class="hljs-string">"promise-pass"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);

    <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-string">"sample1"</span>,<span class="hljs-string">"callback-pass"</span>,info);
    local.<span class="hljs-title function_">sampleFunc2</span>(<span class="hljs-string">"sample2"</span>,<span class="hljs-string">"callback-pass"</span>,info);
    <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-string">"sample3"</span>,<span class="hljs-string">"callback-pass"</span>,info);
    <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-string">"sample4"</span>,<span class="hljs-string">"callback-pass"</span>,info);
    
    
    <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-string">"sample1"</span>,<span class="hljs-string">"promise-fail"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
    local.<span class="hljs-title function_">sampleFunc2</span>(<span class="hljs-string">"sample2"</span>,<span class="hljs-string">"promise-fail"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
    <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-string">"sample3"</span>,<span class="hljs-string">"promise-fail"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
    <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-string">"sample4"</span>,<span class="hljs-string">"promise-fail"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
    
    <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-string">"sample1"</span>,<span class="hljs-string">"callback-fail"</span>,info);
    local.<span class="hljs-title function_">sampleFunc2</span>(<span class="hljs-string">"sample2"</span>,<span class="hljs-string">"callback-fail"</span>,info);
    <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-string">"sample3"</span>,<span class="hljs-string">"callback-fail"</span>,info);
    <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-string">"sample4"</span>,<span class="hljs-string">"callback-fail"</span>,info);
 
</code></pre>
<p></p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
<div class="snippet-code">
<pre class="snippet-code-js lang-js s-code-block"><code class="hljs language-javascript">    <span class="hljs-keyword">var</span> cpArgs = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>.<span class="hljs-property">call</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">slice</span>);

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">promiseToCB</span> (nm,fn,<span class="hljs-variable constant_">THIS</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> nm===<span class="hljs-string">'function'</span>) {
            <span class="hljs-variable constant_">THIS</span>=fn;fn=nm;nm=fn.<span class="hljs-property">name</span>;
        }
        <span class="hljs-variable constant_">THIS</span>=<span class="hljs-variable constant_">THIS</span>||<span class="hljs-variable language_">this</span>;
        <span class="hljs-keyword">const</span> func = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
           <span class="hljs-keyword">let</span> args = <span class="hljs-title function_">cpArgs</span>(<span class="hljs-variable language_">arguments</span>);
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> args[args.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>]===<span class="hljs-string">'function'</span>) {
                <span class="hljs-keyword">const</span> cb = args.<span class="hljs-title function_">pop</span>();
                <span class="hljs-keyword">return</span> fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable constant_">THIS</span>,args).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">r</span>){
                   cb (<span class="hljs-literal">undefined</span>,r);
                }).<span class="hljs-title function_">catch</span>(cb);  
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable constant_">THIS</span>,args);
            }
        };
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(func,<span class="hljs-string">'name'</span>,{<span class="hljs-attr">value</span>:nm,<span class="hljs-attr">enumerable</span>:<span class="hljs-literal">false</span>,<span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>});
        <span class="hljs-keyword">if</span> (<span class="hljs-variable constant_">THIS</span>[nm]) <span class="hljs-keyword">delete</span> <span class="hljs-variable constant_">THIS</span>[nm];
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable constant_">THIS</span>,nm,{<span class="hljs-attr">value</span>:func,<span class="hljs-attr">enumerable</span>:<span class="hljs-literal">false</span>,<span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>});
        <span class="hljs-keyword">return</span> func;
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">cbToPromise</span> (nm,fn,<span class="hljs-variable constant_">THIS</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> nm===<span class="hljs-string">'function'</span>) {
            <span class="hljs-variable constant_">THIS</span>=fn;fn=nm;nm=fn.<span class="hljs-property">name</span>;
        }
        <span class="hljs-variable constant_">THIS</span>=<span class="hljs-variable constant_">THIS</span>||<span class="hljs-variable language_">this</span>;
        <span class="hljs-keyword">const</span> func = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
           <span class="hljs-keyword">let</span> args = <span class="hljs-title function_">cpArgs</span>(<span class="hljs-variable language_">arguments</span>);
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> args[args.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>]===<span class="hljs-string">'function'</span>) {
                <span class="hljs-keyword">return</span> fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable constant_">THIS</span>,args);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve,reject</span>){
                    
                    args.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">err,result</span>){
                          <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(err);
                          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span>==<span class="hljs-number">2</span>) {
                             <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>(result);
                          }
                          <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">cpArgs</span>(<span class="hljs-variable language_">arguments</span>,<span class="hljs-number">1</span>));
                    });
                              
                    fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable constant_">THIS</span>,args);
                    
                });
            }
        };
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(func,<span class="hljs-string">'name'</span>,{<span class="hljs-attr">value</span>:nm,<span class="hljs-attr">enumerable</span>:<span class="hljs-literal">false</span>,<span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>});
        <span class="hljs-keyword">if</span> (<span class="hljs-variable constant_">THIS</span>[nm]) <span class="hljs-keyword">delete</span> <span class="hljs-variable constant_">THIS</span>[nm];
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable constant_">THIS</span>,nm,{<span class="hljs-attr">value</span>:func,<span class="hljs-attr">enumerable</span>:<span class="hljs-literal">false</span>,<span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>});
        <span class="hljs-keyword">return</span> func;

    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">asPromise</span> (args,resolver,no_err) {
        <span class="hljs-keyword">const</span> cb = args[args.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>],
        promise  = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(resolver);
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">typeof</span> cb===<span class="hljs-string">'function'</span>)  ? promise.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>){<span class="hljs-keyword">return</span> <span class="hljs-title function_">cb</span>(no_err,result)}).<span class="hljs-title function_">catch</span>(cb) : promise;
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">asCallback</span> (args,wrap,no_err) {
        <span class="hljs-keyword">const</span> cb = args[args.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>],
        promise=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">resolver</span>(<span class="hljs-params">resolve,reject</span>) {
            <span class="hljs-keyword">return</span> wrap (<span class="hljs-keyword">function</span> (<span class="hljs-params">err,result</span>) {
                 <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(err);
                 <span class="hljs-title function_">resolve</span>(result);
            });
        });
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">typeof</span> cb===<span class="hljs-string">'function'</span>)  ? promise.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>){<span class="hljs-keyword">return</span> <span class="hljs-title function_">cb</span>(no_err,result)}).<span class="hljs-title function_">catch</span>(cb) : promise;
    }


    <span class="hljs-keyword">function</span> <span class="hljs-title function_">cbPromiseTest</span>(<span class="hljs-params"></span>){
        <span class="hljs-comment">/*global sampleFunc1,sampleFunc2*/</span>
        
        <span class="hljs-keyword">const</span> local = {}; 
        <span class="hljs-title function_">promiseToCB</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-params">arg1,arg2</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"deciding:"</span>,arg1,arg2);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve,reject</span>){
           
               <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-title function_">reject</span>([arg1,arg2,<span class="hljs-string">"ouch"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));},<span class="hljs-number">5000</span>);
               
               <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
                   <span class="hljs-keyword">if</span> (arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-pass"</span>) || (!arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-fail"</span>) &amp;&amp; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()&lt;<span class="hljs-number">0.5</span>)) {
        
                       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"complete:"</span>,arg1,arg2);
                       <span class="hljs-built_in">clearTimeout</span>(timer);
                       <span class="hljs-title function_">resolve</span>([arg1,arg2,<span class="hljs-string">"all good"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));
                   }
               },<span class="hljs-number">2000</span>);
            
            });
        });
        
        <span class="hljs-title function_">cbToPromise</span>(<span class="hljs-string">'sampleFunc2'</span>,<span class="hljs-keyword">function</span> <span class="hljs-title function_">someOtherName</span>(<span class="hljs-params">arg1,arg2,cb</span>) {
           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"deciding:"</span>,arg1,arg2);
           <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-title function_">cb</span>([arg1,arg2,<span class="hljs-string">"ouch"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));},<span class="hljs-number">5000</span>);
           
           <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
               <span class="hljs-keyword">if</span> (arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-pass"</span>) || (!arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-fail"</span>) &amp;&amp; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()&lt;<span class="hljs-number">0.5</span>)) {
                   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"complete:"</span>,arg1,arg2);
                   <span class="hljs-built_in">clearTimeout</span>(timer);
                   <span class="hljs-title function_">cb</span>(<span class="hljs-literal">undefined</span>,[arg1,arg2,<span class="hljs-string">"all good"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));
               }
           },<span class="hljs-number">2000</span>);
            
        },local);
        
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-params">arg1,arg2</span>) {<span class="hljs-keyword">return</span> <span class="hljs-title function_">asPromise</span>(<span class="hljs-variable language_">arguments</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">resolve,reject</span>){
           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"deciding:"</span>,arg1,arg2);
           <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-title function_">reject</span>([arg1,arg2,<span class="hljs-string">"ouch"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));},<span class="hljs-number">5000</span>);
           
           <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
               <span class="hljs-keyword">if</span> (arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-pass"</span>) || (!arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-fail"</span>) &amp;&amp; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()&lt;<span class="hljs-number">0.5</span>)) {
                   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"complete:"</span>,arg1,arg2);
                   <span class="hljs-built_in">clearTimeout</span>(timer);
                   <span class="hljs-title function_">resolve</span>([arg1,arg2,<span class="hljs-string">"all good"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));
               }
           },<span class="hljs-number">2000</span>);
            
        });}
        
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-params">arg1,arg2</span>) {<span class="hljs-keyword">return</span> <span class="hljs-title function_">asCallback</span>(<span class="hljs-variable language_">arguments</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>){
           <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"deciding:"</span>,arg1,arg2);
           <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-title function_">cb</span>([arg1,arg2,<span class="hljs-string">"ouch"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));},<span class="hljs-number">5000</span>);
           
           <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
               <span class="hljs-keyword">if</span> (arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-pass"</span>) || (!arg2.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">"-fail"</span>) &amp;&amp; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()&lt;<span class="hljs-number">0.5</span>)) {
                   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"complete:"</span>,arg1,arg2);
                   <span class="hljs-built_in">clearTimeout</span>(timer);
                   <span class="hljs-title function_">cb</span>(<span class="hljs-literal">undefined</span>,[arg1,arg2,<span class="hljs-string">"all good"</span>].<span class="hljs-title function_">join</span>(<span class="hljs-string">"-"</span>));
               }
           },<span class="hljs-number">2000</span>);
            
        });}
        
        <span class="hljs-keyword">const</span> log=<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">console</span>),info=<span class="hljs-variable language_">console</span>.<span class="hljs-property">info</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">console</span>),error=<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">console</span>);
        
        <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-string">"sample1"</span>,<span class="hljs-string">"promise"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
        local.<span class="hljs-title function_">sampleFunc2</span>(<span class="hljs-string">"sample2"</span>,<span class="hljs-string">"promise"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
        <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-string">"sample3"</span>,<span class="hljs-string">"promise"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
        <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-string">"sample4"</span>,<span class="hljs-string">"promise"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);

        <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-string">"sample1"</span>,<span class="hljs-string">"callback"</span>,info);
        local.<span class="hljs-title function_">sampleFunc2</span>(<span class="hljs-string">"sample2"</span>,<span class="hljs-string">"callback"</span>,info);
        <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-string">"sample3"</span>,<span class="hljs-string">"callback"</span>,info);
        <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-string">"sample4"</span>,<span class="hljs-string">"callback"</span>,info);
        
        <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-string">"sample1"</span>,<span class="hljs-string">"promise-pass"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
        local.<span class="hljs-title function_">sampleFunc2</span>(<span class="hljs-string">"sample2"</span>,<span class="hljs-string">"promise-pass"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
        <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-string">"sample3"</span>,<span class="hljs-string">"promise-pass"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
        <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-string">"sample4"</span>,<span class="hljs-string">"promise-pass"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);

        <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-string">"sample1"</span>,<span class="hljs-string">"callback-pass"</span>,info);
        local.<span class="hljs-title function_">sampleFunc2</span>(<span class="hljs-string">"sample2"</span>,<span class="hljs-string">"callback-pass"</span>,info);
        <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-string">"sample3"</span>,<span class="hljs-string">"callback-pass"</span>,info);
        <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-string">"sample4"</span>,<span class="hljs-string">"callback-pass"</span>,info);
        
        
        <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-string">"sample1"</span>,<span class="hljs-string">"promise-fail"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
        local.<span class="hljs-title function_">sampleFunc2</span>(<span class="hljs-string">"sample2"</span>,<span class="hljs-string">"promise-fail"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
        <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-string">"sample3"</span>,<span class="hljs-string">"promise-fail"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
        <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-string">"sample4"</span>,<span class="hljs-string">"promise-fail"</span>).<span class="hljs-property">then</span> (log).<span class="hljs-title function_">catch</span>(error);
        
        <span class="hljs-title function_">sampleFunc1</span>(<span class="hljs-string">"sample1"</span>,<span class="hljs-string">"callback-fail"</span>,info);
        local.<span class="hljs-title function_">sampleFunc2</span>(<span class="hljs-string">"sample2"</span>,<span class="hljs-string">"callback-fail"</span>,info);
        <span class="hljs-title function_">sampleFunc3</span>(<span class="hljs-string">"sample3"</span>,<span class="hljs-string">"callback-fail"</span>,info);
        <span class="hljs-title function_">sampleFunc4</span>(<span class="hljs-string">"sample4"</span>,<span class="hljs-string">"callback-fail"</span>,info);
     
    }
    <span class="hljs-title function_">cbPromiseTest</span>();</code></pre>
<div class="snippet-result"><div class="snippet-ctas"><button type="button" class="s-btn s-btn__primary"><span class="icon-play-white _hover"></span><span> Run code snippet</span></button><input class="copySnippet s-btn s-btn__filled" type="button" value="Copy snippet to answer" style="display: none;"><button type="button" class="s-btn hideResults" style="display: none;">Hide results</button><div class="popout-code"><a class="snippet-expand-link">Expand snippet</a></div></div><div class="snippet-result-code" style="display: none;"><iframe name="sif2" sandbox="allow-forms allow-modals allow-scripts" class="snippet-box-edit snippet-box-result" frameborder="0"></iframe></div></div></div>
</div>
<p></p>
    </div></div></div></div><div id="solution22" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 22</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Promises always have a <code>resolve</code> and a <code>reject</code>. When you write an async wrapper, just call the resolve and there you go.</p>
<p>You can write a wrapper function for pretty much any function taking a callback like so:</p>
<pre class="lang-javascript s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">myAsyncWrapper</span> = (<span class="hljs-params">...params</span>) =&gt;
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> 
    <span class="hljs-title function_">someFunctionWithCallback</span>(...params, <span class="hljs-function">(<span class="hljs-params">error, response</span>) =&gt;</span>
      error ? <span class="hljs-title function_">reject</span>(error) : <span class="hljs-title function_">resolve</span>(response)
    )
  );
</code></pre>
<p>You can take this further to write a conversion function of callbacks to promises:</p>
<pre class="lang-javascript s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">promisify</span> =
  (<span class="hljs-params">functionWithCallback</span>) =&gt;
  <span class="hljs-function">(<span class="hljs-params">...params</span>) =&gt;</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span>
      <span class="hljs-title function_">functionWithCallback</span>(...params, <span class="hljs-function">(<span class="hljs-params">error, response</span>) =&gt;</span>
        error ? <span class="hljs-title function_">reject</span>(error) : <span class="hljs-title function_">resolve</span>(response)
      )
    );
</code></pre>
<p>This concept of wrapper functions is especially useful when using older libraries or SDKs. For example, consider the Facebook Graph API's JavaScript SDK, which uses a similar callback structure for making API requests.</p>
<pre class="lang-javascript s-code-block"><code class="hljs language-javascript"><span class="hljs-variable constant_">FB</span>.<span class="hljs-title function_">api</span>(apiURL, options, <span class="hljs-keyword">function</span> (<span class="hljs-params">request</span>) {
  <span class="hljs-keyword">if</span> (request.<span class="hljs-property">error</span> || !request) <span class="hljs-keyword">return</span>;
  <span class="hljs-comment">// handle request</span>
});
</code></pre>
<p>In modern applications, it is much more useful to use a promise-based API.
If you use a function only once or twice, it may be better to promisify the response individually:</p>
<pre class="lang-javascript s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// in an async function</span>
<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span>
  <span class="hljs-variable constant_">FB</span>.<span class="hljs-title function_">api</span>(apiURL, <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> (res?.<span class="hljs-property">error</span> ? <span class="hljs-title function_">reject</span>(res?.<span class="hljs-property">error</span>) : <span class="hljs-title function_">resolve</span>(res)))
);
</code></pre>
<p>If you use the function a lot, you can use the same wrapper concept to write a function like so:</p>
<pre class="lang-javascript s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">apiWrapper</span> = (<span class="hljs-params">...params</span>) =&gt;
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> 
    <span class="hljs-variable constant_">FB</span>.<span class="hljs-title function_">api</span>(...params, <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> (res?.<span class="hljs-property">error</span> ? <span class="hljs-title function_">reject</span>(res?.<span class="hljs-property">error</span>) : <span class="hljs-title function_">resolve</span>(res)))
  );
</code></pre>
<p>Although promisifiers are great sometimes, they won't work for specific instances like this. In times like these, look on Github for a modern wrapper, or write your own like this.</p>
    </div></div></div></div><div id="solution23" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 23</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>since we know the characteristics of a callback-based function in advance,
we can create a function that transforms a callback-based function
into an equivalent function returning a Promise.</p>
<ul>
<li><p>The callback is the last argument of the function</p>
</li>
<li><p>If there is an error, it always the first argument passed to the callback</p>
</li>
<li><p>Any return value is passed after the error to the callback</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"> <span class="hljs-keyword">function</span> <span class="hljs-title function_">promisify</span>(<span class="hljs-params">yourCallbackApi</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">promisified</span>(<span class="hljs-params">...args</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-comment">// newArgs=[..args,callback]</span>
        <span class="hljs-keyword">const</span> newArgs = [
          ...args,
          <span class="hljs-keyword">function</span> (<span class="hljs-params">err, result</span>) {
            <span class="hljs-keyword">if</span> (err) {
              <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(err);
            }
            <span class="hljs-title function_">resolve</span>(result);
          },
        ];
        <span class="hljs-comment">// invoke yourCallbackApi with the new list of arguments</span>
        <span class="hljs-title function_">yourCallbackApi</span>(...newArgs);
      });
    };
  }
</code></pre>
</li>
</ul>
    </div></div></div></div><div id="solution24" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 24</h1><div class="tags-wrap h-max space-x-8"><div class="tags"></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>It is like 5 years late, but I wanted to post here my promesify version which takes functions from callbacks API and turns them into promises</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">promesify</span> = fn =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...params</span>) =&gt;</span> ({
    <span class="hljs-attr">then</span>: <span class="hljs-function"><span class="hljs-params">cbThen</span> =&gt;</span> ({
      <span class="hljs-attr">catch</span>: <span class="hljs-function"><span class="hljs-params">cbCatch</span> =&gt;</span> {
        <span class="hljs-title function_">fn</span>(...params, cbThen, cbCatch);
      }
    })
  });
};
</code></pre>

<p>Take a look to this very simple version here:
<a href="https://gist.github.com/jdtorregrosas/aeee96dd07558a5d18db1ff02f31e21a" rel="nofollow noreferrer">https://gist.github.com/jdtorregrosas/aeee96dd07558a5d18db1ff02f31e21a</a></p>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/how-do-i-print-my-java-object-without-getting-%22sometype@2f92e0f4%22-1657384731950">How do I print my Java object without getting &quot;SomeType@2f92e0f4&quot;?</a><a href="/questions/flatten-an-irregular-list-of-lists-1657387315571">Flatten an irregular list of lists</a><a href="/questions/what-is-a-raw-type-and-why-shouldn&#x27;t-we-use-it-1657384481079">What is a raw type and why shouldn&#x27;t we use it?</a><a href="/questions/why-is-%22using-namespace-std%22-considered-bad-practice-1657384296377">Why is &quot;using namespace std;&quot; considered bad practice?</a><a href="/questions/get-top-1-row-of-each-group-1657387438304">Get top 1 row of each group</a><a href="/questions/pandas-merging-101-1657384447080">Pandas Merging 101</a><a href="/questions/center-one-and-rightleft-align-other-flexbox-element-1657387899083">Center one and right/left align other flexbox element</a><a href="/questions/error-in-finding-last-used-cell-in-excel-with-vba-1657384584748">Error in finding last used cell in Excel with VBA</a><a href="/questions/how-do-we-control-web-page-caching-across-all-browsers-1657387529059">How do we control web page caching, across all browsers?</a><a href="/questions/android-permission-doesn&#x27;t-work-even-if-i-have-declared-it-1657387726990">Android permission doesn&#x27;t work even if I have declared it</a><a href="/questions/variables-are-not-behaving-as-expected-1657384865672">Variables are not behaving as expected</a><a href="/questions/get-the-data-received-in-a-flask-request-1657387804432">Get the data received in a Flask request</a><a href="/questions/what-is-__init__.py-for-1657388415243">What is __init__.py for?</a><a href="/questions/how-do-i-make-a-list-of-data-frames-1657385480437">How do I make a list of data frames?</a><a href="/questions/truth-value-of-a-series-is-ambiguous.-use-a.empty-a.bool()-a.item()-a.any()-or-a.all()-1657387724259">Truth value of a Series is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all()</a><a href="/questions/what-is-the-difference-between-and-equals()-in-java-1657387729654">What is the difference between == and equals() in Java?</a><a href="/questions/swing-gui-listeners-without-awt-1657387522426">Swing GUI listeners without AWT</a><a href="/questions/my-attempt-at-value-initialization-is-interpreted-as-a-function-declaration-and-why-doesn&#x27;t-a-a(())-solve-it-1657388474057">My attempt at value initialization is interpreted as a function declaration, and why doesn&#x27;t A a(()); solve it?</a><a href="/questions/captured-variable-in-a-loop-in-c-1657387696779">Captured variable in a loop in C#</a><a href="/questions/unfortunately-myapp-has-stopped.-how-can-i-solve-this-1657384402171">Unfortunately MyApp has stopped. How can I solve this?</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;Promises have state, they start as pending and can settle to:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;strong\u0026gt;fulfilled\u0026lt;/strong\u0026gt; meaning that the computation completed successfully.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;strong\u0026gt;rejected\u0026lt;/strong\u0026gt; meaning that the computation failed.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;Promise returning functions \u0026lt;a href=\u0026quot;https://stackoverflow.com/q/21887856/1048572\u0026quot;\u0026gt;\u0026lt;em\u0026gt;should never throw\u0026lt;/em\u0026gt;\u0026lt;/a\u0026gt;, they should return rejections instead. Throwing from a promise returning function will force you to use both a \u0026lt;code\u0026gt;} catch {\u0026lt;/code\u0026gt; \u0026lt;em\u0026gt;and\u0026lt;/em\u0026gt; a \u0026lt;code\u0026gt;.catch\u0026lt;/code\u0026gt;. People using promisified APIs do not expect promises to throw. If you\u0026apos;re not sure how async APIs work in JS - please \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/14220321/how-to-return-the-response-from-an-asynchronous-call/16825593#16825593\u0026quot;\u0026gt;see this answer\u0026lt;/a\u0026gt; first.\u0026lt;/p\u0026gt;\n\n\u0026lt;h3\u0026gt;1. DOM load or other one time event:\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;So, creating promises generally means specifying when they settle - that means when they move to the fulfilled or rejected phase to indicate the data is available (and can be accessed with \u0026lt;code\u0026gt;.then\u0026lt;/code\u0026gt;).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;With modern promise implementations that support the \u0026lt;code\u0026gt;Promise\u0026lt;/code\u0026gt; constructor like native ES6 promises:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;load\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;window\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;onload\u0026lt;/span\u0026gt; = resolve;\n    });\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;You would then use the resulting promise like so:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;load\u0026lt;/span\u0026gt;().\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Do things after onload\u0026lt;/span\u0026gt;\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;With libraries that support deferred (Let\u0026apos;s use $q for this example here, but we\u0026apos;ll also use jQuery later):\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;load\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; d = $q.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;defer\u0026lt;/span\u0026gt;();\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;window\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;onload\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) { d.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(); };\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; d.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;promise\u0026lt;/span\u0026gt;;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Or with a jQuery like API, hooking on an event happening once:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;done\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; d = $.\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Deferred\u0026lt;/span\u0026gt;();\n    $(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;#myObject\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;once\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;click\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n        d.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;();\n    });\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; d.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promise\u0026lt;/span\u0026gt;();\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;h3\u0026gt;2. Plain callback:\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;These APIs are rather common since well callbacks are common in JS. Let\u0026apos;s look at the common case of having \u0026lt;code\u0026gt;onSuccess\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;onFail\u0026lt;/code\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getUserData\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;userId, onLoad, onFail\u0026lt;/span\u0026gt;) { \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;With modern promise implementations that support the \u0026lt;code\u0026gt;Promise\u0026lt;/code\u0026gt; constructor like native ES6 promises:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getUserDataAsync\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;userId\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getUserData\u0026lt;/span\u0026gt;(userId, resolve, reject);\n    });\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;With libraries that support deferred (Let\u0026apos;s use jQuery for this example here, but we\u0026apos;ve also used $q above):\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getUserDataAsync\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;userId\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; d = $.\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Deferred\u0026lt;/span\u0026gt;();\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getUserData\u0026lt;/span\u0026gt;(userId, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;res\u0026lt;/span\u0026gt;){ d.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(res); }, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err\u0026lt;/span\u0026gt;){ d.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(err); });\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; d.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promise\u0026lt;/span\u0026gt;();\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;jQuery also offers a \u0026lt;code\u0026gt;$.Deferred(fn)\u0026lt;/code\u0026gt; form, which has the advantage of allowing us to write an expression that emulates very closely the \u0026lt;code\u0026gt;new Promise(fn)\u0026lt;/code\u0026gt; form, as follows:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getUserDataAsync\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;userId\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; $.\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Deferred\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;dfrd\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getUserData\u0026lt;/span\u0026gt;(userId, dfrd.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;, dfrd.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;);\n    }).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promise\u0026lt;/span\u0026gt;();\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Note: Here we exploit the fact that a jQuery deferred\u0026apos;s \u0026lt;code\u0026gt;resolve\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;reject\u0026lt;/code\u0026gt; methods are \u0026quot;detachable\u0026quot;; ie. they are bound to the \u0026lt;em\u0026gt;instance\u0026lt;/em\u0026gt; of a jQuery.Deferred(). Not all libs offer this feature.\u0026lt;/p\u0026gt;\n\n\u0026lt;h3\u0026gt;3. Node style callback (\u0026quot;nodeback\u0026quot;):\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;Node style callbacks (nodebacks) have a particular format where the callbacks is always the last argument and its first parameter is an error. Let\u0026apos;s first promisify one manually:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getStuff\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;dataParam\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, data\u0026lt;/span\u0026gt;) { \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;To:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getStuffAsync\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;param\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getStuff\u0026lt;/span\u0026gt;(param, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, data\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (err !== \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(err);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(data);\n        });\n    });\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;With deferreds you can do the following (let\u0026apos;s use Q for this example, although Q now supports the new syntax \u0026lt;a href=\u0026quot;https://stackoverflow.com/q/28687566/1048572\u0026quot;\u0026gt;which you should prefer\u0026lt;/a\u0026gt;): \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getStuffAsync\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;param\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; d = Q.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;defer\u0026lt;/span\u0026gt;();\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getStuff\u0026lt;/span\u0026gt;(param, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, data\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (err !== \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;) d.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(err);\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; d.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(data);\n    });\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; d.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;promise\u0026lt;/span\u0026gt;;   \n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;In general, you should not promisify things manually too much, most promise libraries that were designed with Node in mind as well as native promises in Node 8+ have a built in method for promisifying nodebacks. For example\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; getStuffAsync = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(getStuff); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Bluebird\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; getStuffAsync = Q.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;denodeify\u0026lt;/span\u0026gt;(getStuff); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Q\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; getStuffAsync = util.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(getStuff); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Native promises, node only\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;h3\u0026gt;4. A whole library with node style callbacks:\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;There is no golden rule here, you promisify them one by one. However, some promise implementations allow you to do this in bulk, for example in Bluebird, converting a nodeback API to a promise API is as simple as:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisifyAll\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;API\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Or with \u0026lt;em\u0026gt;native promises\u0026lt;/em\u0026gt; in \u0026lt;strong\u0026gt;Node\u0026lt;/strong\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; { promisify } = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;util\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; promiseAPI = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Object\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;entries\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;API\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;[key, v]\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; ({key, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(v)}))\n                         .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reduce\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;o, p\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Object\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;assign\u0026lt;/span\u0026gt;(o, {[p.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;key\u0026lt;/span\u0026gt;]: p.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;}), {});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Notes:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Of course, when you are in a \u0026lt;code\u0026gt;.then\u0026lt;/code\u0026gt; handler you do not need to promisify things. Returning a promise from a \u0026lt;code\u0026gt;.then\u0026lt;/code\u0026gt; handler will resolve or reject with that promise\u0026apos;s value. Throwing from a \u0026lt;code\u0026gt;.then\u0026lt;/code\u0026gt; handler is also good practice and will reject the promise - this is the famous promise throw safety. \u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;In an actual \u0026lt;code\u0026gt;onload\u0026lt;/code\u0026gt; case, you should use \u0026lt;code\u0026gt;addEventListener\u0026lt;/code\u0026gt; rather than \u0026lt;code\u0026gt;onX\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Today, I can use \u0026lt;code\u0026gt;Promise\u0026lt;/code\u0026gt; in \u0026lt;code\u0026gt;Node.js\u0026lt;/code\u0026gt; as a plain Javascript method.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;A simple and basic example to \u0026lt;code\u0026gt;Promise\u0026lt;/code\u0026gt; (with \u0026lt;strong\u0026gt;\u0026lt;a href=\u0026quot;https://en.wikipedia.org/wiki/KISS_principle\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;KISS\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt; way):\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Plain\u0026lt;/strong\u0026gt; Javascript Async API code:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;divisionAPI\u0026lt;/span\u0026gt; (number, divider, successCallback, errorCallback) {\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (divider == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;errorCallback\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Division by zero\u0026quot;\u0026lt;/span\u0026gt;) )\n    }\n\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;successCallback\u0026lt;/span\u0026gt;( number / divider )\n\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;code\u0026gt;Promise\u0026lt;/code\u0026gt;\u0026lt;/strong\u0026gt; Javascript Async API code:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;divisionAPI\u0026lt;/span\u0026gt; (number, divider) {\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;fulfilled, rejected\u0026lt;/span\u0026gt;) {\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (divider == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;rejected\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Division by zero\u0026quot;\u0026lt;/span\u0026gt;) )\n        }\n\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fulfilled\u0026lt;/span\u0026gt;( number / divider )\n\n     })\n\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;(I recommend visiting \u0026lt;a href=\u0026quot;http://exploringjs.com/es6/ch_promises.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;this beautiful source\u0026lt;/a\u0026gt;)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Also \u0026lt;code\u0026gt;Promise\u0026lt;/code\u0026gt; can be used with together \u0026lt;code\u0026gt;async\\await\u0026lt;/code\u0026gt; in \u0026lt;code\u0026gt;ES7\u0026lt;/code\u0026gt; to make the program flow wait for a \u0026lt;code\u0026gt;fullfiled\u0026lt;/code\u0026gt; result like the following:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getName\u0026lt;/span\u0026gt; () {\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;fulfilled, rejected\u0026lt;/span\u0026gt;) {\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; name = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;John Doe\u0026quot;\u0026lt;/span\u0026gt;;\n\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// wait 3000 milliseconds before calling fulfilled() method\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt; ( \n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n                \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fulfilled\u0026lt;/span\u0026gt;( name )\n            }, \n            \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3000\u0026lt;/span\u0026gt;\n        )\n\n    })\n\n}\n\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt; () {\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; name = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getName\u0026lt;/span\u0026gt;(); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// awaits for a fulfilled result!\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(name); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// the console writes \u0026quot;John Doe\u0026quot; after 3000 milliseconds\u0026lt;/span\u0026gt;\n\n}\n\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt;() \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// calling the foo() method to run the code\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Another usage with the same code by using \u0026lt;code\u0026gt;.then()\u0026lt;/code\u0026gt; method\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getName\u0026lt;/span\u0026gt; () {\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;fulfilled, rejected\u0026lt;/span\u0026gt;) {\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; name = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;John Doe\u0026quot;\u0026lt;/span\u0026gt;;\n\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// wait 3000 milliseconds before calling fulfilled() method\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt; ( \n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n                \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fulfilled\u0026lt;/span\u0026gt;( name )\n            }, \n            \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3000\u0026lt;/span\u0026gt;\n        )\n\n    })\n\n}\n\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// the console writes \u0026quot;John Doe\u0026quot; after 3000 milliseconds\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getName\u0026lt;/span\u0026gt;().\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;name\u0026lt;/span\u0026gt;){ \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(name) })\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;Promise\u0026lt;/code\u0026gt; can also be used on any platform that is based on Node.js like \u0026lt;code\u0026gt;react-native\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Bonus\u0026lt;/strong\u0026gt;: An \u0026lt;strong\u0026gt;hybrid\u0026lt;/strong\u0026gt; method \u0026lt;br\u0026gt;\n(The callback method is assumed to have two parameters as error and result)\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;divisionAPI\u0026lt;/span\u0026gt; (number, divider, callback) {\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;fulfilled, rejected\u0026lt;/span\u0026gt;) {\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (divider == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; error = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Division by zero\u0026quot;\u0026lt;/span\u0026gt;)\n            callback \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;( error )\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;rejected\u0026lt;/span\u0026gt;( error )\n        }\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; result = number / divider\n        callback \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;, result )\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fulfilled\u0026lt;/span\u0026gt;( result )\n\n     })\n\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;The above method can respond result for old fashion callback and Promise usages.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Hope this helps.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Before converting a function as promise In Node.JS\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; request = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;request\u0026apos;\u0026lt;/span\u0026gt;); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//http wrapped module\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;requestWrapper\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;url, callback\u0026lt;/span\u0026gt;) {\n    request.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;get\u0026lt;/span\u0026gt;(url, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, response\u0026lt;/span\u0026gt;) {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (err) {\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;(err);\n      }\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;, response);             \n      }      \n    })\n}\n\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;requestWrapper\u0026lt;/span\u0026gt;(url, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, response\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(err, response)\n})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;After Converting It\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; request = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;request\u0026apos;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;requestWrapper\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;url\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) { \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//returning promise\u0026lt;/span\u0026gt;\n    request.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;get\u0026lt;/span\u0026gt;(url, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, response\u0026lt;/span\u0026gt;) {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (err) {\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(err); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//promise reject\u0026lt;/span\u0026gt;\n      }\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(response); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//promise resolve\u0026lt;/span\u0026gt;\n      }\n    })\n  })\n}\n\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;requestWrapper\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;http://localhost:8080/promise_request/1\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;response\u0026lt;/span\u0026gt;){\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(response) \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//resolve callback(success)\u0026lt;/span\u0026gt;\n}).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;){\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(error) \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//reject callback(failure)\u0026lt;/span\u0026gt;\n})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Incase you need to handle multiple request\u0026lt;/strong\u0026gt; \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; allRequests = [];\nallRequests.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;requestWrapper\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;http://localhost:8080/promise_request/1\u0026apos;\u0026lt;/span\u0026gt;)) \nallRequests.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;requestWrapper\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;http://localhost:8080/promise_request/2\u0026apos;\u0026lt;/span\u0026gt;))\nallRequests.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;requestWrapper\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;http://localhost:8080/promise_request/5\u0026apos;\u0026lt;/span\u0026gt;))    \n\n\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;(allRequests).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;results\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(results);\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//result will be array which contains each promise response\u0026lt;/span\u0026gt;\n}).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(err)\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I don\u0026apos;t think the \u0026lt;code\u0026gt;window.onload\u0026lt;/code\u0026gt; suggestion by @Benjamin will work all the time, as it doesn\u0026apos;t detect whether it is called after the load. I have been bitten by that many times. Here is a version which should always work:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promiseDOMready\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;readyState\u0026lt;/span\u0026gt; === \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;complete\u0026quot;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;();\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;document\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;addEventListener\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;DOMContentLoaded\u0026quot;\u0026lt;/span\u0026gt;, resolve);\n    });\n}\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promiseDOMready\u0026lt;/span\u0026gt;().\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(initOnLoad);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Node.js 8.0.0 includes a new \u0026lt;code\u0026gt;util.promisify()\u0026lt;/code\u0026gt; API that allows standard Node.js callback style APIs to be wrapped in a function that returns a Promise. An example use of \u0026lt;code\u0026gt;util.promisify()\u0026lt;/code\u0026gt; is shown below.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; fs = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; util = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;util\u0026apos;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; readFile = util.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(fs.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/some/file\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;data\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/* ... */\u0026lt;/span\u0026gt; })\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/* ... */\u0026lt;/span\u0026gt; });\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;See \u0026lt;a href=\u0026quot;https://nodejs.org/en/blog/release/v8.0.0/#improved-support-for-promises\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Improved support for Promises\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;h2\u0026gt;A simple generic function I normally use.\u0026lt;/h2\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;fn, ...args\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;(...args, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, data\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (err) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(err);\n      }\n      \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(data);\n    });\n  });\n};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;h2\u0026gt;How to use it\u0026lt;/h2\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The function \u0026lt;code\u0026gt;promisify\u0026lt;/code\u0026gt; accepts a function with a callback:\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;result\u0026lt;/span\u0026gt;) =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`The result is \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${result}\u0026lt;/span\u0026gt;`\u0026lt;/span\u0026gt;;\n\n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sum\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;a, b, cb\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; result = a + b;\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;(result); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// passing args to the callback function\u0026lt;/span\u0026gt;\n   }\n\n\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// using the util\u0026lt;/span\u0026gt;\n  promise = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(sum, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, cb);\n  promise.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;x\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(x)) \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// 4\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;You are probably not looking for this answer, but this will help understand the inner workings of the available utils\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In release candidate for Node.js 8.0.0, there\u0026apos;s a new utility, \u0026lt;code\u0026gt;util.promisify\u0026lt;/code\u0026gt; (I\u0026apos;ve written about \u0026lt;a href=\u0026quot;https://brunoscopelliti.com/new-util-promisify-in-nodejs/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;util.promisify\u0026lt;/a\u0026gt;), that encapsulates the capacity of promisifying whatever function.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;It is not much different from the approaches suggested in the other answers, but has the advantage of being a core method, and not requiring additional dependencies. \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; fs = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; util = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;util\u0026apos;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; readFile = util.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(fs.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Then you\u0026apos;ve a \u0026lt;code\u0026gt;readFile\u0026lt;/code\u0026gt; method that returns a native \u0026lt;code\u0026gt;Promise\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;./notes.txt\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;txt\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(txt))\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(...);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;You can use JavaScript native promises with Node JS.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;My Cloud 9 code link: \u0026lt;a href=\u0026quot;https://ide.c9.io/adx2803/native-promises-in-node\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;https://ide.c9.io/adx2803/native-promises-in-node\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/**\n* Created by dixit-lab on 20/6/16.\n*/\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; express = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;express\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; request = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;request\u0026apos;\u0026lt;/span\u0026gt;);   \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//Simplified HTTP request client.\u0026lt;/span\u0026gt;\n\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; app = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;express\u0026lt;/span\u0026gt;();\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;url\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) {\n        request.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;get\u0026lt;/span\u0026gt;(url, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;error, response, body\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!error \u0026amp;amp;\u0026amp;amp; response.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;statusCode\u0026lt;/span\u0026gt; == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;200\u0026lt;/span\u0026gt;) {\n                \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(body);\n            }\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; {\n                \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(error);\n            }\n        })\n    });\n}\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//get all the albums of a user who have posted post 100\u0026lt;/span\u0026gt;\napp.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;get\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/listAlbums\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;req, res\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//get the post with post id 100\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;http://jsonplaceholder.typicode.com/posts/100\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;result\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; obj = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;JSON\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;parse\u0026lt;/span\u0026gt;(result);\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;http://jsonplaceholder.typicode.com/users/\u0026apos;\u0026lt;/span\u0026gt; + obj.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;userId\u0026lt;/span\u0026gt; + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/albums\u0026apos;\u0026lt;/span\u0026gt;)\n    })\n    .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;e\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(e);\n    })\n    .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;result\u0026lt;/span\u0026gt;) {\n        res.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;end\u0026lt;/span\u0026gt;(result);\n    })\n})\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; server = app.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;listen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8081\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; host = server.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;address\u0026lt;/span\u0026gt;().\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;address\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; port = server.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;address\u0026lt;/span\u0026gt;().\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;port\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Example app listening at http://%s:%s\u0026quot;\u0026lt;/span\u0026gt;, host, port)\n})\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//run webservice on browser : http://localhost:8081/listAlbums\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;With plain old vanilla javaScript, here\u0026apos;s a solution to promisify an api callback.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;get\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;url, callback\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; xhr = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;XMLHttpRequest\u0026lt;/span\u0026gt;();\n        xhr.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;open\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;get\u0026apos;\u0026lt;/span\u0026gt;, url);\n        xhr.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;addEventListener\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;readystatechange\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (xhr.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;readyState\u0026lt;/span\u0026gt; === \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;) {\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (xhr.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;status\u0026lt;/span\u0026gt; === \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;200\u0026lt;/span\u0026gt;) {\n                    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;successful ... should call callback ... \u0026apos;\u0026lt;/span\u0026gt;);\n                    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;JSON\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;parse\u0026lt;/span\u0026gt;(xhr.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;responseText\u0026lt;/span\u0026gt;));\n                } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; {\n                    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;error ... callback with error data ... \u0026apos;\u0026lt;/span\u0026gt;);\n                    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;(xhr, \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;);\n                }\n            }\n        });\n        xhr.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;send\u0026lt;/span\u0026gt;();\n    }\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/**\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@function\u0026lt;/span\u0026gt; promisify: convert api based callbacks to promises\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@description\u0026lt;/span\u0026gt; takes in a factory function and promisifies it\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@params\u0026lt;/span\u0026gt; {\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;} input function to promisify\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@params\u0026lt;/span\u0026gt; {\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;} an array of inputs to the function to be promisified\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@return\u0026lt;/span\u0026gt; {\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;} promisified function\n     * */\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; args = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;slice\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;call\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) {\n                fn.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;apply\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;, args.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;concat\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, result\u0026lt;/span\u0026gt;) {\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (err) \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(err);\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(result);\n                }));\n            });\n        }\n    }\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; get_promisified = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(get);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; promise = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;get_promisified\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;some_url\u0026apos;\u0026lt;/span\u0026gt;);\npromise.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;data\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// corresponds to the resolve function\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;successful operation: \u0026apos;\u0026lt;/span\u0026gt;, data);\n}, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(error);\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The Q library by kriskowal includes callback-to-promise functions.\nA method like this:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;obj.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;dosomething\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;params, cb\u0026lt;/span\u0026gt;) {\n  ...blah blah...\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;(error, results);\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;can be converted with Q.ninvoke\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;Q.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;ninvoke\u0026lt;/span\u0026gt;(obj,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;dosomething\u0026quot;\u0026lt;/span\u0026gt;,params).\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;results\u0026lt;/span\u0026gt;) {\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;When you have a few functions that take a callback and you want them to return a promise instead you can use this function to do the conversion.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callbackToPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;func\u0026lt;/span\u0026gt;){\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// change this to use what ever promise lib you are using\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// In this case i\u0026apos;m using angular $q that I exposed on a util module\u0026lt;/span\u0026gt;\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; defered = util.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;$q\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;defer\u0026lt;/span\u0026gt;();\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;val\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n            defered.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(val);\n        }\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; args = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;slice\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;call\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;);\n        args.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(cb);    \n        func.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;apply\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;, args);\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; defered.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;promise\u0026lt;/span\u0026gt;;\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Under node v7.6+ which has built in promises and async:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// promisify.js\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt; = fn =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;...args\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;(...args, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, result\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (err) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(err);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(result);\n        })\n    );\n\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;module\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;exports\u0026lt;/span\u0026gt; = promisify;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;How to use:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; readdir = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;readdir\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; promisify = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;./promisify\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; readdirP = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(readdir);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;myAsyncFn\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;path\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; entries = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readdirP\u0026lt;/span\u0026gt;(path);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; entries;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In Node.js 8 you can \u0026lt;strong\u0026gt;promisify\u0026lt;/strong\u0026gt; object methods \u0026lt;em\u0026gt;on the fly\u0026lt;/em\u0026gt; using this npm module:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://www.npmjs.com/package/doasync\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;https://www.npmjs.com/package/doasync\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;It uses \u0026lt;strong\u0026gt;util.promisify\u0026lt;/strong\u0026gt; and \u0026lt;strong\u0026gt;Proxies\u0026lt;/strong\u0026gt; so that your objects stay unchanged. \u0026lt;strong\u0026gt;Memoization\u0026lt;/strong\u0026gt; is also done with the use of WeakMaps). Here are some examples:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;With objects:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; fs = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; doAsync = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;doasync\u0026apos;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;doAsync\u0026lt;/span\u0026gt;(fs).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;package.json\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;result\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;dir\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;JSON\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;parse\u0026lt;/span\u0026gt;(result), {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;colors\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;});\n  });\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;With functions:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;doAsync\u0026lt;/span\u0026gt;(request)(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;http://www.google.com\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;{body}\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(body);\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// ...\u0026lt;/span\u0026gt;\n  });\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;You can even use native \u0026lt;code\u0026gt;call\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;apply\u0026lt;/code\u0026gt; to bind some context:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;doAsync\u0026lt;/span\u0026gt;(myFunc).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;apply\u0026lt;/span\u0026gt;(context, params)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;result\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/*...*/\u0026lt;/span\u0026gt; });\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;You can use \u0026lt;strong\u0026gt;native Promise\u0026lt;/strong\u0026gt; in ES6, for exemple dealing with setTimeout:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;enqueue\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;data\u0026lt;/span\u0026gt;) {\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; queue = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// returns the Promise\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;()=\u0026amp;gt;\u0026lt;/span\u0026gt; {\n                queue.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;source\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(data);\n                \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(queue); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//call native resolve when finish\u0026lt;/span\u0026gt;\n            }\n            , \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// resolve() will be called in 10 ms\u0026lt;/span\u0026gt;\n    });\n\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;In this exemple, the Promise has no reason to fail, so \u0026lt;code\u0026gt;reject()\u0026lt;/code\u0026gt; is never called.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The \u0026lt;strong\u0026gt;callback style\u0026lt;/strong\u0026gt; function always like this(almost all function in node.js is this style):\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//fs.readdir(path[, options], callback)\u0026lt;/span\u0026gt;\nfs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readdir\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;mypath\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err,files\u0026lt;/span\u0026gt;)=\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(files))\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;This style has same feature: \u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;the callback function is passed by last argument. \u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;the callback function always accept the error object as it\u0026apos;s first argument. \u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;p\u0026gt;So, you could write a function for convert a function with this style like this:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; R =\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ramda\u0026apos;\u0026lt;/span\u0026gt;)\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/**\n * A convenient function for handle error in callback function.\n * Accept two function res(resolve) and rej(reject) ,\n * return a wrap function that accept a list arguments,\n * the first argument as error, if error is null,\n * the res function will call,else the rej function.\n * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@param\u0026lt;/span\u0026gt; {\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;} res the function which will call when no error throw\n * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@param\u0026lt;/span\u0026gt; {\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;} rej the function which will call when  error occur\n * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@return\u0026lt;/span\u0026gt; {\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;} return a function that accept a list arguments,\n * the first argument as error, if error is null, the res function\n * will call,else the rej function\n **/\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;checkErr\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;res, rej\u0026lt;/span\u0026gt;) =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, ...data\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; R.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;ifElse\u0026lt;/span\u0026gt;(\n    R.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;propEq\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;err\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;),\n    R.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;compose\u0026lt;/span\u0026gt;(\n        res,\n        R.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;prop\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;data\u0026apos;\u0026lt;/span\u0026gt;)\n    ),\n    R.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;compose\u0026lt;/span\u0026gt;(\n        rej,\n        R.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;prop\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;err\u0026apos;\u0026lt;/span\u0026gt;)\n    )\n)({err, data})\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/**\n * wrap the callback style function to Promise style function,\n * the callback style function must restrict by convention:\n * 1. the function must put the callback function where the last of arguments,\n * such as (arg1,arg2,arg3,arg...,callback)\n * 2. the callback function must call as callback(err,arg1arg2,arg...)\n * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@param\u0026lt;/span\u0026gt; {\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;} fun the callback style function to transform\n * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@return\u0026lt;/span\u0026gt; {\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;} return the new function that will return a Promise,\n * while the origin function throw a error, the Promise will be Promise.reject(error),\n * while the origin function work fine, the Promise will be Promise.resolve(args: array),\n * the args is which callback function accept\n * */\u0026lt;/span\u0026gt;\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;toPromise\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;fun\u0026lt;/span\u0026gt;) =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;...args\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\n    \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;res, rej\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; R.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;apply\u0026lt;/span\u0026gt;(\n        fun,\n        R.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;append\u0026lt;/span\u0026gt;(\n            \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;checkErr\u0026lt;/span\u0026gt;(res, rej),\n            args\n        )\n    )\n)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;For more concise, above example used ramda.js. Ramda.js is a excellent library for functional programming. In above code, we used it\u0026apos;s \u0026lt;strong\u0026gt;apply\u0026lt;/strong\u0026gt;(like javascript \u0026lt;code\u0026gt;function.prototype.apply\u0026lt;/code\u0026gt;) and append(like javascript \u0026lt;code\u0026gt;function.prototype.push\u0026lt;/code\u0026gt; ).\nSo, we could convert the a callback style function to promise style function now:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; {readdir} = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs\u0026apos;\u0026lt;/span\u0026gt;)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; readdirP = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;toPromise\u0026lt;/span\u0026gt;(readdir)\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readdir\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Path\u0026lt;/span\u0026gt;)\n    .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\n        \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;files\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(files),\n        \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(err)\n    )\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;toPromise\u0026lt;/strong\u0026gt; and \u0026lt;strong\u0026gt;checkErr\u0026lt;/strong\u0026gt; function is own by \u0026lt;a href=\u0026quot;https://github.com/jituanlin/berserk\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;berserk\u0026lt;/a\u0026gt; library, it\u0026apos;s a functional programming library fork by \u0026lt;strong\u0026gt;ramda.js\u0026lt;/strong\u0026gt;(create by me).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Hope this answer is useful for you.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;es6-promisify\u0026lt;/code\u0026gt; converts callback-based functions to Promise-based functions.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; promisify = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;es6-promisify\u0026apos;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; promisedFn = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(callbackedFn, args);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Ref: \u0026lt;a href=\u0026quot;https://www.npmjs.com/package/es6-promisify\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;https://www.npmjs.com/package/es6-promisify\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;You can do something like this\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// @flow\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;toPromise\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;f: (any) =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;void\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;\u0026amp;lt;any\u0026amp;gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;try\u0026lt;/span\u0026gt; {\n      \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;f\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;result\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(result)\n      })\n    } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt; (e) {\n      \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(e)\n    }\n  })\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;export\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;default\u0026lt;/span\u0026gt; toPromise\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Then use it\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;loadData\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; friends = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;toPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;FriendsManager\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;loadFriends\u0026lt;/span\u0026gt;)\n\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(friends)\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;My promisify version of a \u0026lt;code\u0026gt;callback\u0026lt;/code\u0026gt; function is the \u0026lt;code\u0026gt;P\u0026lt;/code\u0026gt; function:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\u0026lt;div class=\u0026quot;snippet\u0026quot; data-lang=\u0026quot;js\u0026quot; data-hide=\u0026quot;false\u0026quot; data-console=\u0026quot;true\u0026quot; data-babel=\u0026quot;false\u0026quot;\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-code\u0026quot;\u0026gt;\n\u0026lt;pre class=\u0026quot;snippet-code-js lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; P = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; self = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; method = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;];\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; params = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;slice\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;call\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (method \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;typeof\u0026lt;/span\u0026gt;(method) == \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;function\u0026apos;\u0026lt;/span\u0026gt;) {\n      params.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, state\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!err) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(state)\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(err);\n      });\n      method.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;apply\u0026lt;/span\u0026gt;(self, params);\n    } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;not a function\u0026apos;\u0026lt;/span\u0026gt;));\n  });\n}\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; callback = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;par, callback\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; rnd = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;floor\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;() * \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;) + \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; rnd \u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; ? \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;, par) : \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;trap\u0026quot;\u0026lt;/span\u0026gt;));\n}\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, state\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; err ? \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;(err) : \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(state))\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, state\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; err ? \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;(err) : \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(state))\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, state\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; err ? \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;(err) : \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(state))\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, state\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; err ? \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;(err) : \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(state))\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;P\u0026lt;/span\u0026gt;(callback, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;v\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(v)).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;e\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;(e))\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;P\u0026lt;/span\u0026gt;(callback, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;v\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(v)).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;e\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;(e))\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;P\u0026lt;/span\u0026gt;(callback, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;v\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(v)).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;e\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;(e))\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;P\u0026lt;/span\u0026gt;(callback, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;v\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(v)).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;e\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;(e))\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-result\u0026quot;\u0026gt;\u0026lt;div class=\u0026quot;snippet-ctas\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn s-btn__primary\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;icon-play-white _hover\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;span\u0026gt; Run code snippet\u0026lt;/span\u0026gt;\u0026lt;/button\u0026gt;\u0026lt;input class=\u0026quot;copySnippet s-btn s-btn__filled\u0026quot; type=\u0026quot;button\u0026quot; value=\u0026quot;Copy snippet to answer\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn hideResults\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;Hide results\u0026lt;/button\u0026gt;\u0026lt;div class=\u0026quot;popout-code\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;snippet-expand-link\u0026quot;\u0026gt;Expand snippet\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;div class=\u0026quot;snippet-result-code\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;iframe name=\u0026quot;sif1\u0026quot; sandbox=\u0026quot;allow-forms allow-modals allow-scripts\u0026quot; class=\u0026quot;snippet-box-edit snippet-box-result\u0026quot; frameborder=\u0026quot;0\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The \u0026lt;code\u0026gt;P\u0026lt;/code\u0026gt; function requires that the callback signature must be \u0026lt;code\u0026gt;callback(error,result)\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Below is the implementation of how a function (callback API) can be converted to a promise.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;functionToExec\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; array = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Object\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;values\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n      array.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(resolve)\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;try\u0026lt;/span\u0026gt; {\n         functionToExec.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;apply\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;, array);\n      } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt; (error) {\n         \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(error)\n      }\n    })\n  }\n}\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// USE SCENARIO\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;apiFunction\u0026lt;/span\u0026gt; (path, callback) { \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Not a promise\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Logic\u0026lt;/span\u0026gt;\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; promisedFunction = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(apiFunction);\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisedFunction\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;path\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;()=\u0026amp;gt;\u0026lt;/span\u0026gt;{\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Receive the result here (callback)\u0026lt;/span\u0026gt;\n})\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Or use it with await like this\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; result = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisedFunction\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;path\u0026apos;\u0026lt;/span\u0026gt;);\n\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;h2\u0026gt;Perhaps already answered, but this is how I do it typically:\u0026lt;br\u0026gt;\u0026lt;/h2\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// given you\u0026apos;ve defined this `Future` fn somewhere:\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;Future\u0026lt;/span\u0026gt; = fn =\u0026amp;gt; {\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;r,t\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;(r,t))}\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// define an eventFn that takes a promise `resolver`\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;eventFn\u0026lt;/span\u0026gt; = resolve =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// do event related closure actions here. When finally done, call `resolve()`\u0026lt;/span\u0026gt;\n  something.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;oneventfired\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;e\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; {\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(e)}\n}\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// invoke eventFn in an `async` workflowFn using `Future`\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// to obtain a `promise` wrapper\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;workflowFn\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Future\u0026lt;/span\u0026gt;(eventFn)}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;Especially for things like \u0026lt;code\u0026gt;indexedDb\u0026lt;/code\u0026gt; event wrappers to simplify usage.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;Or you might find this variation of \u0026lt;code\u0026gt;Future\u0026lt;/code\u0026gt; to be more general purpose\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;PromiseEx\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;extends\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_ inherited__\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt; {\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;v,...a\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;settled\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;settledValue\u0026lt;/span\u0026gt; = v;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve_\u0026lt;/span\u0026gt;(v,...a))\n  }\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;v,...a\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;settled\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;settledValue\u0026lt;/span\u0026gt; = v;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject_\u0026lt;/span\u0026gt;(v,...a))\n  }\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Future\u0026lt;/span\u0026gt;(fn,...args) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; r,t,ft = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;PromiseEx\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;r_,t_\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {r=r_;t=t_})\n    ft.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;resolve_\u0026lt;/span\u0026gt; = r; ft.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;reject_\u0026lt;/span\u0026gt; = t; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;(ft,...args);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt;(ft)\n  }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Necromancing a little, bit this \u0026lt;a href=\u0026quot;https://gist.github.com/jonathan-annett/1a8ae0cc504427317ba2912d2620aae5\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;link\u0026lt;/a\u0026gt; may be useful....\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;h2\u0026gt;TLDR; look at the snippet example at the end of this answer\u0026lt;/h2\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;h1\u0026gt;write/convert functions that can be called expecting\u0026lt;/h1\u0026gt;\n\u0026lt;h1\u0026gt;a \u0026lt;code\u0026gt;cb(error,result)\u0026lt;/code\u0026gt; or \u0026lt;code\u0026gt;new Promise (...)\u0026lt;/code\u0026gt; format\u0026lt;/h1\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;promiseToCB\u0026lt;/code\u0026gt; converts and exports an existing function that\u0026apos;s been previously coded to return a promise\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;cbToPromise\u0026lt;/code\u0026gt; converts and exports an existing function that\u0026apos;s been previously coded to call the last argument with (error,result)\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;if wrapped function supplies more than 1 result, the result will be an array of results\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;eg \u0026lt;code\u0026gt;cb(undefined,path,stat)\u0026lt;/code\u0026gt; ---\u0026amp;gt; \u0026lt;code\u0026gt;resolve([path,stat])\u0026lt;/code\u0026gt; / \u0026lt;code\u0026gt;cb(undefined,[path,stat])\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;asPromise\u0026lt;/code\u0026gt; lets you code a new function to return a promise, but it can be called either way\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;asCallback\u0026lt;/code\u0026gt; lets you code a new function to call \u0026lt;code\u0026gt;cb(err,result)\u0026lt;/code\u0026gt;, but it can be invoked either way\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;h2\u0026gt;sample functions\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;each sample takes 2 arguments, and resolves/rejects/errors based on random number.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;arg2 can be also be used to force pass or fail. (looks for \u0026quot;-pass\u0026quot; or \u0026quot;-fail\u0026quot;).\u0026lt;/p\u0026gt;\n\u0026lt;h2\u0026gt;wrap existing functions\u0026lt;/h2\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;exports the function to current \u0026quot;this\u0026quot; (or use \u0026lt;code\u0026gt;promiseToCB(function myFunc(){},newThis);\u0026lt;/code\u0026gt; )\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promiseToCB\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arg1,arg2\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deciding:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve,reject\u0026lt;/span\u0026gt;){\n       \n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timer = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ouch\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));},\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5000\u0026lt;/span\u0026gt;);\n           \n           \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n               \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-pass\u0026quot;\u0026lt;/span\u0026gt;) || (!arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-fail\u0026quot;\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;()\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.5\u0026lt;/span\u0026gt;)) {\n    \n                   \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;complete:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n                   \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;clearTimeout\u0026lt;/span\u0026gt;(timer);\n                   \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;all good\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));\n               }\n           },\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n        \n        });\n    });\n    \n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cbToPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;sampleFunc2\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someOtherName\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arg1,arg2,cb\u0026lt;/span\u0026gt;) {\n       \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deciding:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timer = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ouch\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));},\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5000\u0026lt;/span\u0026gt;);\n       \n       \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-pass\u0026quot;\u0026lt;/span\u0026gt;) || (!arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-fail\u0026quot;\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;()\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.5\u0026lt;/span\u0026gt;)) {\n               \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;complete:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n               \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;clearTimeout\u0026lt;/span\u0026gt;(timer);\n               \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;undefined\u0026lt;/span\u0026gt;,[arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;all good\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));\n           }\n       },\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n        \n    },local);\n    \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;h2\u0026gt;or code new functions, which embed a wrapper.\u0026lt;/h2\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arg1,arg2\u0026lt;/span\u0026gt;) {\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve,reject\u0026lt;/span\u0026gt;){\n       \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deciding:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timer = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ouch\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));},\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5000\u0026lt;/span\u0026gt;);\n       \n       \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-pass\u0026quot;\u0026lt;/span\u0026gt;) || (!arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-fail\u0026quot;\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;()\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.5\u0026lt;/span\u0026gt;)) {\n               \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;complete:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n               \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;clearTimeout\u0026lt;/span\u0026gt;(timer);\n               \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;all good\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));\n           }\n       },\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n        \n    });}\n    \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arg1,arg2\u0026lt;/span\u0026gt;) {\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asCallback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;){\n       \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deciding:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timer = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ouch\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));},\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5000\u0026lt;/span\u0026gt;);\n       \n       \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-pass\u0026quot;\u0026lt;/span\u0026gt;) || (!arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-fail\u0026quot;\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;()\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.5\u0026lt;/span\u0026gt;)) {\n               \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;complete:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n               \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;clearTimeout\u0026lt;/span\u0026gt;(timer);\n               \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;undefined\u0026lt;/span\u0026gt;,[arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;all good\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));\n           }\n       },\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n        \n    });}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;h2\u0026gt;test scipt for above functions\u0026lt;/h2\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; local = {}; \n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promiseToCB\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arg1,arg2\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deciding:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve,reject\u0026lt;/span\u0026gt;){\n       \n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timer = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ouch\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));},\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5000\u0026lt;/span\u0026gt;);\n           \n           \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n               \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-pass\u0026quot;\u0026lt;/span\u0026gt;) || (!arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-fail\u0026quot;\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;()\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.5\u0026lt;/span\u0026gt;)) {\n    \n                   \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;complete:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n                   \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;clearTimeout\u0026lt;/span\u0026gt;(timer);\n                   \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;all good\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));\n               }\n           },\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n        \n        });\n    });\n    \n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cbToPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;sampleFunc2\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someOtherName\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arg1,arg2,cb\u0026lt;/span\u0026gt;) {\n       \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deciding:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timer = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ouch\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));},\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5000\u0026lt;/span\u0026gt;);\n       \n       \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-pass\u0026quot;\u0026lt;/span\u0026gt;) || (!arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-fail\u0026quot;\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;()\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.5\u0026lt;/span\u0026gt;)) {\n               \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;complete:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n               \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;clearTimeout\u0026lt;/span\u0026gt;(timer);\n               \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;undefined\u0026lt;/span\u0026gt;,[arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;all good\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));\n           }\n       },\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n        \n    },local);\n    \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arg1,arg2\u0026lt;/span\u0026gt;) {\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve,reject\u0026lt;/span\u0026gt;){\n       \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deciding:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timer = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ouch\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));},\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5000\u0026lt;/span\u0026gt;);\n       \n       \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-pass\u0026quot;\u0026lt;/span\u0026gt;) || (!arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-fail\u0026quot;\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;()\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.5\u0026lt;/span\u0026gt;)) {\n               \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;complete:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n               \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;clearTimeout\u0026lt;/span\u0026gt;(timer);\n               \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;all good\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));\n           }\n       },\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n        \n    });}\n    \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arg1,arg2\u0026lt;/span\u0026gt;) {\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asCallback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;){\n       \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deciding:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timer = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ouch\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));},\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5000\u0026lt;/span\u0026gt;);\n       \n       \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-pass\u0026quot;\u0026lt;/span\u0026gt;) || (!arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-fail\u0026quot;\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;()\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.5\u0026lt;/span\u0026gt;)) {\n               \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;complete:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n               \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;clearTimeout\u0026lt;/span\u0026gt;(timer);\n               \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;undefined\u0026lt;/span\u0026gt;,[arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;all good\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));\n           }\n       },\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n        \n    });}\n    \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; log=\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;bind\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;),info=\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;info\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;bind\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;),error=\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;bind\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;);\n    \n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample1\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n    local.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc2\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample2\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample3\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample4\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample1\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback\u0026quot;\u0026lt;/span\u0026gt;,info);\n    local.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc2\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample2\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback\u0026quot;\u0026lt;/span\u0026gt;,info);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample3\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback\u0026quot;\u0026lt;/span\u0026gt;,info);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample4\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback\u0026quot;\u0026lt;/span\u0026gt;,info);\n    \n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample1\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-pass\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n    local.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc2\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample2\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-pass\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample3\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-pass\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample4\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-pass\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample1\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-pass\u0026quot;\u0026lt;/span\u0026gt;,info);\n    local.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc2\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample2\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-pass\u0026quot;\u0026lt;/span\u0026gt;,info);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample3\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-pass\u0026quot;\u0026lt;/span\u0026gt;,info);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample4\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-pass\u0026quot;\u0026lt;/span\u0026gt;,info);\n    \n    \n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample1\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-fail\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n    local.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc2\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample2\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-fail\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample3\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-fail\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample4\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-fail\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n    \n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample1\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-fail\u0026quot;\u0026lt;/span\u0026gt;,info);\n    local.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc2\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample2\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-fail\u0026quot;\u0026lt;/span\u0026gt;,info);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample3\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-fail\u0026quot;\u0026lt;/span\u0026gt;,info);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample4\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-fail\u0026quot;\u0026lt;/span\u0026gt;,info);\n \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\u0026lt;div class=\u0026quot;snippet\u0026quot; data-lang=\u0026quot;js\u0026quot; data-hide=\u0026quot;false\u0026quot; data-console=\u0026quot;true\u0026quot; data-babel=\u0026quot;false\u0026quot;\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-code\u0026quot;\u0026gt;\n\u0026lt;pre class=\u0026quot;snippet-code-js lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; cpArgs = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;slice\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;call\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;bind\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;slice\u0026lt;/span\u0026gt;);\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promiseToCB\u0026lt;/span\u0026gt; (nm,fn,\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;typeof\u0026lt;/span\u0026gt; nm===\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;function\u0026apos;\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;=fn;fn=nm;nm=fn.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;name\u0026lt;/span\u0026gt;;\n        }\n        \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;||\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; func = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; args = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cpArgs\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;typeof\u0026lt;/span\u0026gt; args[args.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;-\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;]===\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;function\u0026apos;\u0026lt;/span\u0026gt;) {\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; cb = args.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;pop\u0026lt;/span\u0026gt;();\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; fn.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;apply\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;,args).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;r\u0026lt;/span\u0026gt;){\n                   cb (\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;undefined\u0026lt;/span\u0026gt;,r);\n                }).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(cb);  \n            } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; {\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; fn.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;apply\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;,args);\n            }\n        };\n        \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Object\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;defineProperty\u0026lt;/span\u0026gt;(func,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;name\u0026apos;\u0026lt;/span\u0026gt;,{\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;:nm,\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;enumerable\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;configurable\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;});\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;[nm]) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;delete\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;[nm];\n        \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Object\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;defineProperty\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;,nm,{\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;:func,\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;enumerable\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;configurable\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;});\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; func;\n    }\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cbToPromise\u0026lt;/span\u0026gt; (nm,fn,\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;typeof\u0026lt;/span\u0026gt; nm===\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;function\u0026apos;\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;=fn;fn=nm;nm=fn.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;name\u0026lt;/span\u0026gt;;\n        }\n        \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;||\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; func = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; args = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cpArgs\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;typeof\u0026lt;/span\u0026gt; args[args.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;-\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;]===\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;function\u0026apos;\u0026lt;/span\u0026gt;) {\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; fn.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;apply\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;,args);\n            } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; {\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve,reject\u0026lt;/span\u0026gt;){\n                    \n                    args.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err,result\u0026lt;/span\u0026gt;){\n                          \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (err) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(err);\n                          \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;==\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;) {\n                             \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(result);\n                          }\n                          \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cpArgs\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;));\n                    });\n                              \n                    fn.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;apply\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;,args);\n                    \n                });\n            }\n        };\n        \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Object\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;defineProperty\u0026lt;/span\u0026gt;(func,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;name\u0026apos;\u0026lt;/span\u0026gt;,{\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;:nm,\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;enumerable\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;configurable\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;});\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;[nm]) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;delete\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;[nm];\n        \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Object\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;defineProperty\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;THIS\u0026lt;/span\u0026gt;,nm,{\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;:func,\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;enumerable\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;configurable\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;});\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; func;\n\n    }\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asPromise\u0026lt;/span\u0026gt; (args,resolver,no_err) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; cb = args[args.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;-\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;],\n        promise  = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(resolver);\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;typeof\u0026lt;/span\u0026gt; cb===\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;function\u0026apos;\u0026lt;/span\u0026gt;)  ? promise.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;result\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;(no_err,result)}).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(cb) : promise;\n    }\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asCallback\u0026lt;/span\u0026gt; (args,wrap,no_err) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; cb = args[args.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;-\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;],\n        promise=\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolver\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve,reject\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; wrap (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err,result\u0026lt;/span\u0026gt;) {\n                 \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (err) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(err);\n                 \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(result);\n            });\n        });\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;typeof\u0026lt;/span\u0026gt; cb===\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;function\u0026apos;\u0026lt;/span\u0026gt;)  ? promise.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;result\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;(no_err,result)}).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(cb) : promise;\n    }\n\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cbPromiseTest\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/*global sampleFunc1,sampleFunc2*/\u0026lt;/span\u0026gt;\n        \n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; local = {}; \n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promiseToCB\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arg1,arg2\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deciding:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve,reject\u0026lt;/span\u0026gt;){\n           \n               \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timer = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ouch\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));},\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5000\u0026lt;/span\u0026gt;);\n               \n               \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n                   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-pass\u0026quot;\u0026lt;/span\u0026gt;) || (!arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-fail\u0026quot;\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;()\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.5\u0026lt;/span\u0026gt;)) {\n        \n                       \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;complete:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n                       \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;clearTimeout\u0026lt;/span\u0026gt;(timer);\n                       \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;all good\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));\n                   }\n               },\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n            \n            });\n        });\n        \n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cbToPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;sampleFunc2\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someOtherName\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arg1,arg2,cb\u0026lt;/span\u0026gt;) {\n           \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deciding:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timer = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ouch\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));},\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5000\u0026lt;/span\u0026gt;);\n           \n           \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n               \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-pass\u0026quot;\u0026lt;/span\u0026gt;) || (!arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-fail\u0026quot;\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;()\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.5\u0026lt;/span\u0026gt;)) {\n                   \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;complete:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n                   \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;clearTimeout\u0026lt;/span\u0026gt;(timer);\n                   \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;undefined\u0026lt;/span\u0026gt;,[arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;all good\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));\n               }\n           },\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n            \n        },local);\n        \n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arg1,arg2\u0026lt;/span\u0026gt;) {\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve,reject\u0026lt;/span\u0026gt;){\n           \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deciding:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timer = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ouch\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));},\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5000\u0026lt;/span\u0026gt;);\n           \n           \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n               \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-pass\u0026quot;\u0026lt;/span\u0026gt;) || (!arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-fail\u0026quot;\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;()\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.5\u0026lt;/span\u0026gt;)) {\n                   \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;complete:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n                   \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;clearTimeout\u0026lt;/span\u0026gt;(timer);\n                   \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;all good\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));\n               }\n           },\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n            \n        });}\n        \n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arg1,arg2\u0026lt;/span\u0026gt;) {\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asCallback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;){\n           \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deciding:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timer = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;([arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ouch\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));},\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5000\u0026lt;/span\u0026gt;);\n           \n           \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n               \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-pass\u0026quot;\u0026lt;/span\u0026gt;) || (!arg2.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endsWith\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-fail\u0026quot;\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;()\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.5\u0026lt;/span\u0026gt;)) {\n                   \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;complete:\u0026quot;\u0026lt;/span\u0026gt;,arg1,arg2);\n                   \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;clearTimeout\u0026lt;/span\u0026gt;(timer);\n                   \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;undefined\u0026lt;/span\u0026gt;,[arg1,arg2,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;all good\u0026quot;\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;-\u0026quot;\u0026lt;/span\u0026gt;));\n               }\n           },\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n            \n        });}\n        \n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; log=\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;bind\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;),info=\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;info\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;bind\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;),error=\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;bind\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;);\n        \n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample1\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n        local.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc2\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample2\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample3\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample4\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample1\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback\u0026quot;\u0026lt;/span\u0026gt;,info);\n        local.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc2\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample2\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback\u0026quot;\u0026lt;/span\u0026gt;,info);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample3\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback\u0026quot;\u0026lt;/span\u0026gt;,info);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample4\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback\u0026quot;\u0026lt;/span\u0026gt;,info);\n        \n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample1\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-pass\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n        local.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc2\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample2\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-pass\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample3\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-pass\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample4\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-pass\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample1\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-pass\u0026quot;\u0026lt;/span\u0026gt;,info);\n        local.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc2\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample2\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-pass\u0026quot;\u0026lt;/span\u0026gt;,info);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample3\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-pass\u0026quot;\u0026lt;/span\u0026gt;,info);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample4\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-pass\u0026quot;\u0026lt;/span\u0026gt;,info);\n        \n        \n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample1\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-fail\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n        local.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc2\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample2\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-fail\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample3\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-fail\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample4\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;promise-fail\u0026quot;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; (log).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(error);\n        \n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc1\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample1\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-fail\u0026quot;\u0026lt;/span\u0026gt;,info);\n        local.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc2\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample2\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-fail\u0026quot;\u0026lt;/span\u0026gt;,info);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc3\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample3\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-fail\u0026quot;\u0026lt;/span\u0026gt;,info);\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sampleFunc4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sample4\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;callback-fail\u0026quot;\u0026lt;/span\u0026gt;,info);\n     \n    }\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cbPromiseTest\u0026lt;/span\u0026gt;();\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-result\u0026quot;\u0026gt;\u0026lt;div class=\u0026quot;snippet-ctas\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn s-btn__primary\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;icon-play-white _hover\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;span\u0026gt; Run code snippet\u0026lt;/span\u0026gt;\u0026lt;/button\u0026gt;\u0026lt;input class=\u0026quot;copySnippet s-btn s-btn__filled\u0026quot; type=\u0026quot;button\u0026quot; value=\u0026quot;Copy snippet to answer\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn hideResults\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;Hide results\u0026lt;/button\u0026gt;\u0026lt;div class=\u0026quot;popout-code\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;snippet-expand-link\u0026quot;\u0026gt;Expand snippet\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;div class=\u0026quot;snippet-result-code\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;iframe name=\u0026quot;sif2\u0026quot; sandbox=\u0026quot;allow-forms allow-modals allow-scripts\u0026quot; class=\u0026quot;snippet-box-edit snippet-box-result\u0026quot; frameborder=\u0026quot;0\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Promises always have a \u0026lt;code\u0026gt;resolve\u0026lt;/code\u0026gt; and a \u0026lt;code\u0026gt;reject\u0026lt;/code\u0026gt;. When you write an async wrapper, just call the resolve and there you go.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;You can write a wrapper function for pretty much any function taking a callback like so:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;myAsyncWrapper\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;...params\u0026lt;/span\u0026gt;) =\u0026amp;gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; \n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someFunctionWithCallback\u0026lt;/span\u0026gt;(...params, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;error, response\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt;\n      error ? \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(error) : \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(response)\n    )\n  );\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;You can take this further to write a conversion function of callbacks to promises:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt; =\n  (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;functionWithCallback\u0026lt;/span\u0026gt;) =\u0026amp;gt;\n  \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;...params\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;functionWithCallback\u0026lt;/span\u0026gt;(...params, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;error, response\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt;\n        error ? \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(error) : \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(response)\n      )\n    );\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;This concept of wrapper functions is especially useful when using older libraries or SDKs. For example, consider the Facebook Graph API\u0026apos;s JavaScript SDK, which uses a similar callback structure for making API requests.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;FB\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;api\u0026lt;/span\u0026gt;(apiURL, options, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;request\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (request.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt; || !request) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt;;\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// handle request\u0026lt;/span\u0026gt;\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;In modern applications, it is much more useful to use a promise-based API.\nIf you use a function only once or twice, it may be better to promisify the response individually:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// in an async function\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; response = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;FB\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;api\u0026lt;/span\u0026gt;(apiURL, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;res\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; (res?.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt; ? \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(res?.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;) : \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(res)))\n);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;If you use the function a lot, you can use the same wrapper concept to write a function like so:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;apiWrapper\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;...params\u0026lt;/span\u0026gt;) =\u0026amp;gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; \n    \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;FB\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;api\u0026lt;/span\u0026gt;(...params, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;res\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; (res?.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt; ? \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(res?.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;) : \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(res)))\n  );\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Although promisifiers are great sometimes, they won\u0026apos;t work for specific instances like this. In times like these, look on Github for a modern wrapper, or write your own like this.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;since we know the characteristics of a callback-based function in advance,\nwe can create a function that transforms a callback-based function\ninto an equivalent function returning a Promise.\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;The callback is the last argument of the function\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;If there is an error, it always the first argument passed to the callback\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Any return value is passed after the error to the callback\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisify\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;yourCallbackApi\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promisified\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;...args\u0026lt;/span\u0026gt;) {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// newArgs=[..args,callback]\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; newArgs = [\n          ...args,\n          \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, result\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (err) {\n              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reject\u0026lt;/span\u0026gt;(err);\n            }\n            \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(result);\n          },\n        ];\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// invoke yourCallbackApi with the new list of arguments\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;yourCallbackApi\u0026lt;/span\u0026gt;(...newArgs);\n      });\n    };\n  }\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","\n\u0026lt;p\u0026gt;It is like 5 years late, but I wanted to post here my promesify version which takes functions from callbacks API and turns them into promises\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promesify\u0026lt;/span\u0026gt; = fn =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;...params\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; ({\n    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;cbThen\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; ({\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;cbCatch\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;(...params, cbThen, cbCatch);\n      }\n    })\n  });\n};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Take a look to this very simple version here:\n\u0026lt;a href=\u0026quot;https://gist.github.com/jdtorregrosas/aeee96dd07558a5d18db1ff02f31e21a\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;https://gist.github.com/jdtorregrosas/aeee96dd07558a5d18db1ff02f31e21a\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    "],"id":124,"title":"How do I convert an existing callback API to promises?","content":"\n                \n\u0026lt;p\u0026gt;I want to work with promises but I have a callback API in a format like:\u0026lt;/p\u0026gt;\n\n\u0026lt;h3\u0026gt;1. DOM load or other one time event:\u0026lt;/h3\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;window\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;onload\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// set to callback\u0026lt;/span\u0026gt;\n...\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;window\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;onload\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n\n};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;h3\u0026gt;2. Plain callback:\u0026lt;/h3\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;request\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;onChangeHandler\u0026lt;/span\u0026gt;) {\n    ...\n}\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;request\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// change happened\u0026lt;/span\u0026gt;\n    ...\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;h3\u0026gt;3. Node style callback (\u0026quot;nodeback\u0026quot;):\u0026lt;/h3\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getStuff\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;dat, callback\u0026lt;/span\u0026gt;) {\n    ...\n}\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getStuff\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;dataParam\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, data\u0026lt;/span\u0026gt;) {\n    ...\n})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;h3\u0026gt;4. A whole library with node style callbacks:\u0026lt;/h3\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;API\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;API\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;one\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, data\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;API\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;two\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, data2\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;API\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;three\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, data3\u0026lt;/span\u0026gt;) {\n            ...\n        });\n    });\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;h3\u0026gt;How do I work with the API in promises, how do I \u0026quot;promisify\u0026quot; it?\u0026lt;/h3\u0026gt;\n    ","slug":"how-do-i-convert-an-existing-callback-api-to-promises-1657384694006","postType":"QUESTION","createdAt":"2022-07-09T16:38:14.000Z","updatedAt":"2022-07-09T16:38:14.000Z","tags":[],"relatedQuestions":[]},"randomQuestions":[{"title":"How do I print my Java object without getting \"SomeType@2f92e0f4\"?","slug":"how-do-i-print-my-java-object-without-getting-\"sometype@2f92e0f4\"-1657384731950"},{"title":"Flatten an irregular list of lists","slug":"flatten-an-irregular-list-of-lists-1657387315571"},{"title":"What is a raw type and why shouldn't we use it?","slug":"what-is-a-raw-type-and-why-shouldn't-we-use-it-1657384481079"},{"title":"Why is \"using namespace std;\" considered bad practice?","slug":"why-is-\"using-namespace-std\"-considered-bad-practice-1657384296377"},{"title":"Get top 1 row of each group","slug":"get-top-1-row-of-each-group-1657387438304"},{"title":"Pandas Merging 101","slug":"pandas-merging-101-1657384447080"},{"title":"Center one and right/left align other flexbox element","slug":"center-one-and-rightleft-align-other-flexbox-element-1657387899083"},{"title":"Error in finding last used cell in Excel with VBA","slug":"error-in-finding-last-used-cell-in-excel-with-vba-1657384584748"},{"title":"How do we control web page caching, across all browsers?","slug":"how-do-we-control-web-page-caching-across-all-browsers-1657387529059"},{"title":"Android permission doesn't work even if I have declared it","slug":"android-permission-doesn't-work-even-if-i-have-declared-it-1657387726990"},{"title":"Variables are not behaving as expected","slug":"variables-are-not-behaving-as-expected-1657384865672"},{"title":"Get the data received in a Flask request","slug":"get-the-data-received-in-a-flask-request-1657387804432"},{"title":"What is __init__.py for?","slug":"what-is-__init__.py-for-1657388415243"},{"title":"How do I make a list of data frames?","slug":"how-do-i-make-a-list-of-data-frames-1657385480437"},{"title":"Truth value of a Series is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all()","slug":"truth-value-of-a-series-is-ambiguous.-use-a.empty-a.bool()-a.item()-a.any()-or-a.all()-1657387724259"},{"title":"What is the difference between == and equals() in Java?","slug":"what-is-the-difference-between-and-equals()-in-java-1657387729654"},{"title":"Swing GUI listeners without AWT","slug":"swing-gui-listeners-without-awt-1657387522426"},{"title":"My attempt at value initialization is interpreted as a function declaration, and why doesn't A a(()); solve it?","slug":"my-attempt-at-value-initialization-is-interpreted-as-a-function-declaration-and-why-doesn't-a-a(())-solve-it-1657388474057"},{"title":"Captured variable in a loop in C#","slug":"captured-variable-in-a-loop-in-c-1657387696779"},{"title":"Unfortunately MyApp has stopped. How can I solve this?","slug":"unfortunately-myapp-has-stopped.-how-can-i-solve-this-1657384402171"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"how-do-i-convert-an-existing-callback-api-to-promises-1657384694006"},"buildId":"xZs8haGjOP63QuDE0kxeX","isFallback":false,"gsp":true,"locale":"en","locales":["en"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>