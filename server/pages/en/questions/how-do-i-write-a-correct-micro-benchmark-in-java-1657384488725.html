<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find the solution to any question. We focus on finding the fastest possible solution for users. Main topics like coding, learning. - solutionschecker.com"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><link name="keywords" content="jvm,benchmarking,jvm-hotspot,microbenchmark,solutions checker, solution checker, how to, solution for, check for solution, resolve question, what is, what solution for, find solution"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://solutionschecker.com","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@id":"https://solutionschecker.com/questions","name":"Questions"}},{"@type":"ListItem","position":3,"item":{"@id":"https://solutionschecker.com/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725","name":"Questions"}}]}</script><title>How do I write a correct micro-benchmark in Java? | Solution Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="How do you write (and run) a correct micro-benchmark in Java?

I&#x27;m looking for some code samples and comments illustrating various things to think about.

Example: Should the benchmark measure time/iteration or iterations/time, and why?

Related: Is stopwatch benchmarking acceptable?
    "/><meta property="og:title" content="How do I write a correct micro-benchmark in Java? | Solution Checker"/><meta property="og:description" content="How do you write (and run) a correct micro-benchmark in Java?

I&#x27;m looking for some code samples and comments illustrating various things to think about.

Example: Should the benchmark measure time/iteration or iterations/time, and why?

Related: Is stopwatch benchmarking acceptable?
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"How do I write a correct micro-benchmark in Java?","text":"How do you write (and run) a correct micro-benchmark in Java?\n\nI&apos;m looking for some code samples and comments illustrating various things to think about.\n\nExample: Should the benchmark measure time/iteration or iterations/time, and why?\n\nRelated: Is stopwatch benchmarking acceptable?\n    ","answerCount":11,"upVoteCount":500,"suggestedAnswer":[{"text":"Tips about writing micro benchmarks from the creators of Java HotSpot:\n\nRule 0: Read a reputable paper on JVMs and micro-benchmarking. A good one is Brian Goetz, 2005. Do not expect too much from micro-benchmarks; they measure only a limited range of JVM performance characteristics.\n\nRule 1: Always include a warmup phase which runs your test kernel all the way through, enough to trigger all initializations and compilations before timing phase(s). (Fewer iterations is OK on the warmup phase. The rule of thumb is several tens of thousands of inner loop iterations.)\n\nRule 2: Always run with -XX:+PrintCompilation, -verbose:gc, etc., so you can verify that the compiler and other parts of the JVM are not doing unexpected work during your timing phase.\n\nRule 2.1: Print messages at the beginning and end of timing and warmup phases, so you can verify that there is no output from Rule 2 during the timing phase.\n\nRule 3: Be aware of the difference between -client and -server, and OSR and regular compilations. The -XX:+PrintCompilation flag reports OSR compilations with an at-sign to denote the non-initial entry point, for example: Trouble$1::run @ 2 (41 bytes). Prefer server to client, and regular to OSR, if you are after best performance.\n\nRule 4: Be aware of initialization effects. Do not print for the first time during your timing phase, since printing loads and initializes classes. Do not load new classes outside of the warmup phase (or final reporting phase), unless you are testing class loading specifically (and in that case load only the test classes). Rule 2 is your first line of defense against such effects.\n\nRule 5: Be aware of deoptimization and recompilation effects. Do not take any code path for the first time in the timing phase, because the compiler may junk and recompile the code, based on an earlier optimistic assumption that the path was not going to be used at all. Rule 2 is your first line of defense against such effects.\n\nRule 6: Use appropriate tools to read the compiler&apos;s mind, and expect to be surprised by the code it produces. Inspect the code yourself before forming theories about what makes something faster or slower.\n\nRule 7: Reduce noise in your measurements. Run your benchmark on a quiet machine, and run it several times, discarding outliers. Use -Xbatch to serialize the compiler with the application, and consider setting -XX:CICompilerCount=1 to prevent the compiler from running in parallel with itself. Try your best to reduce GC overhead, set Xmx(large enough) equals Xms and use UseEpsilonGC if it is available.\n\nRule 8: Use a library for your benchmark as it is probably more efficient and was already debugged for this sole purpose. Such as JMH, Caliper or Bill and Paul&apos;s Excellent UCSD Benchmarks for Java.  \n    ","url":"https://solutionschecker.com/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725#solution1","@type":"Answer","upvoteCount":0},{"text":"I know this question has been marked as answered but I wanted to mention two libraries that help us to write micro benchmarks\nCaliper from Google\nGetting started tutorials\n\nhttp://codingjunkie.net/micro-benchmarking-with-caliper/\nhttp://vertexlabs.co.uk/blog/caliper\n\nJMH from OpenJDK\nGetting started tutorials\n\nAvoiding Benchmarking Pitfalls on the JVM\nUsing JMH for Java Microbenchmarking\nIntroduction to JMH\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725#solution2","@type":"Answer","upvoteCount":0},{"text":"Important things for Java benchmarks are:\n\n\nWarm up the JIT first by running the code several times before timing it\nMake sure you run it for long enough to be able to measure the results in seconds or (better) tens of seconds\nWhile you can&apos;t call System.gc() between iterations, it&apos;s a good idea to run it between tests, so that each test will hopefully get a &quot;clean&quot; memory space to work with. (Yes, gc() is more of a hint than a guarantee, but it&apos;s very likely that it really will garbage collect in my experience.)\nI like to display iterations and time, and a score of time/iteration which can be scaled such that the &quot;best&quot; algorithm gets a score of 1.0 and others are scored in a relative fashion. This means you can run all algorithms for a longish time, varying both number of iterations and time, but still getting comparable results.\n\n\nI&apos;m just in the process of blogging about the design of a benchmarking framework in .NET. I&apos;ve got a couple of earlier posts which may be able to give you some ideas - not everything will be appropriate, of course, but some of it may be.\n    ","url":"https://solutionschecker.com/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725#solution3","@type":"Answer","upvoteCount":0},{"text":"jmh is a recent addition to OpenJDK and has been written by some performance engineers from Oracle. Certainly worth a look.\n\n\n  The jmh is a Java harness for building, running, and analysing nano/micro/macro benchmarks written in Java and other languages targetting the JVM.\n\n\nVery interesting pieces of information buried in the sample tests comments.\n\nSee also:\n\n\nAvoiding Benchmarking Pitfalls on the JVM\nDiscussion on the main strengths of jmh.\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725#solution4","@type":"Answer","upvoteCount":0},{"text":"\n  Should the benchmark measure time/iteration or iterations/time, and why?\n\n\nIt depends on what you are trying to test.  \n\nIf you are interested in latency, use time/iteration and if you are interested in throughput, use iterations/time.\n    ","url":"https://solutionschecker.com/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725#solution5","@type":"Answer","upvoteCount":0},{"text":"Make sure you somehow use results which are computed in benchmarked code. Otherwise your code can be optimized away.\n    ","url":"https://solutionschecker.com/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725#solution6","@type":"Answer","upvoteCount":0},{"text":"If you are trying to compare two algorithms, do at least two benchmarks for each, alternating the order.  i.e.:\n\nfor(i=1..n)\n  alg1();\nfor(i=1..n)\n  alg2();\nfor(i=1..n)\n  alg2();\nfor(i=1..n)\n  alg1();\n\n\nI have found some noticeable differences (5-10% sometimes) in the runtime of the same algorithm in different passes..\n\nAlso, make sure that n is very large, so that the runtime of each loop is at the very least 10 seconds or so.  The more iterations, the more significant figures in your benchmark time and the more reliable that data is.\n    ","url":"https://solutionschecker.com/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725#solution7","@type":"Answer","upvoteCount":0},{"text":"There are many possible pitfalls for writing micro-benchmarks in Java.\n\nFirst: You have to calculate with all sorts of events that take time more or less random: Garbage collection, caching effects (of OS for files and of CPU for memory), IO etc.\n\nSecond: You cannot trust the accuracy of the measured times for very short intervals.\n\nThird: The JVM optimizes your code while executing. So different runs in the same JVM-instance will become faster and faster.\n\nMy recommendations: Make your benchmark run some seconds, that is more reliable than a runtime over milliseconds. Warm up the JVM (means running the benchmark at least once without measuring, that the JVM can run optimizations). And run your benchmark multiple times (maybe 5 times) and take the median-value. Run every micro-benchmark in a new JVM-instance (call for every benchmark new Java) otherwise optimization effects of the JVM can influence later running tests. Don&apos;t execute things, that aren&apos;t executed in the warmup-phase (as this could trigger class-load and recompilation).\n    ","url":"https://solutionschecker.com/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725#solution8","@type":"Answer","upvoteCount":0},{"text":"It should also be noted that it might also be important to analyze the results of the micro benchmark when comparing different implementations. Therefore a significance test should be made.\n\nThis is because implementation A might be faster during most of the runs of the benchmark than implementation B. But A might also have a higher spread, so the measured performance benefit of A won&apos;t be of any significance when compared with B.\n\nSo it is also important to write and run a micro benchmark correctly, but also to analyze it correctly.\n    ","url":"https://solutionschecker.com/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725#solution9","@type":"Answer","upvoteCount":0},{"text":"To add to the other excellent advice, I&apos;d also be mindful of the following:\n\nFor some CPUs (e.g. Intel Core i5 range with TurboBoost), the temperature (and number of cores currently being used, as well as thier utilisation percent) affects the clock speed. Since CPUs are dynamically clocked, this can affect your results. For example, if you have a single-threaded application, the maximum clock speed (with TurboBoost) is higher than for an application using all cores. This can therefore interfere with comparisons of single and multi-threaded performance on some systems. Bear in mind that the temperature and volatages also affect how long Turbo frequency is maintained.\n\nPerhaps a more fundamentally important aspect that you have direct control over: make sure you&apos;re measuring the right thing! For example, if you&apos;re using System.nanoTime() to benchmark a particular bit of code, put the calls to the assignment in places that make sense to avoid measuring things which you aren&apos;t interested in. For example, don&apos;t do:\n\nlong startTime = System.nanoTime();\n//code here...\nSystem.out.println(&quot;Code took &quot;+(System.nanoTime()-startTime)+&quot;nano seconds&quot;);\n\n\nProblem is you&apos;re not immediately getting the end time when the code has finished. Instead, try the following:\n\nfinal long endTime, startTime = System.nanoTime();\n//code here...\nendTime = System.nanoTime();\nSystem.out.println(&quot;Code took &quot;+(endTime-startTime)+&quot;nano seconds&quot;);\n\n    ","url":"https://solutionschecker.com/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725#solution10","@type":"Answer","upvoteCount":0},{"text":"http://opt.sourceforge.net/ Java Micro Benchmark - control tasks required to determine the comparative performance characteristics of the computer system on different platforms. Can be used to guide optimization decisions and to compare different Java implementations.\n    ","url":"https://solutionschecker.com/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725#solution11","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="22"/><script id="google-analytics" data-nscript="beforeInteractive">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NXVLL8B');</script><link rel="preload" href="/_next/static/css/c116652e2d6f4ad0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c116652e2d6f4ad0.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-ccfab947c79712f4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-862498b6ec7885c3.js" defer=""></script><script src="/_next/static/chunks/294-106ef8570fa99deb.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-47289857226115f9.js" defer=""></script><script src="/_next/static/xZs8haGjOP63QuDE0kxeX/_buildManifest.js" defer=""></script><script src="/_next/static/xZs8haGjOP63QuDE0kxeX/_ssgManifest.js" defer=""></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NXVLL8B"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h1 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h1></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725"><h1>How do I write a correct micro-benchmark in Java?</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/jvm">jvm</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/benchmarking">benchmarking</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/jvm-hotspot">jvm-hotspot</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/microbenchmark">microbenchmark</a></div></div><div class="question-content mt-5">
                
<p>How do you write (and run) a correct micro-benchmark in Java?</p>

<p>I'm looking for some code samples and comments illustrating various things to think about.</p>

<p>Example: Should the benchmark measure time/iteration or iterations/time, and why?</p>

<p>Related: <a href="https://stackoverflow.com/questions/410437/is-stopwatch-benchmarking-acceptable">Is stopwatch benchmarking acceptable?</a></p>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><h1 class="text-lg font-semibold mb-5">Navigate to solutions: </h1><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li><li class="pagination-solution-item"><span data-id="#solution3" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">3</span></li><li class="pagination-solution-item"><span data-id="#solution4" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">4</span></li><li class="pagination-solution-item"><span data-id="#solution5" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">5</span></li><li class="pagination-solution-item"><span data-id="#solution6" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">6</span></li><li class="pagination-solution-item"><span data-id="#solution7" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">7</span></li><li class="pagination-solution-item"><span data-id="#solution8" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">8</span></li><li class="pagination-solution-item"><span data-id="#solution9" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">9</span></li><li class="pagination-solution-item"><span data-id="#solution10" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">10</span></li><li class="pagination-solution-item"><span data-id="#solution11" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">11</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 1</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm">jvm</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/benchmarking">benchmarking</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm-hotspot">jvm-hotspot</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/microbenchmark">microbenchmark</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Tips about writing micro benchmarks <a href="https://wiki.openjdk.java.net/display/HotSpot/Main" rel="noreferrer">from the creators of Java HotSpot</a>:</p>

<p><strong>Rule 0:</strong> Read a reputable paper on JVMs and micro-benchmarking. A good one is <a href="http://www.ibm.com/developerworks/java/library/j-jtp02225" rel="noreferrer">Brian Goetz, 2005</a>. Do not expect too much from micro-benchmarks; they measure only a limited range of JVM performance characteristics.</p>

<p><strong>Rule 1:</strong> Always include a warmup phase which runs your test kernel all the way through, enough to trigger all initializations and compilations before timing phase(s). (Fewer iterations is OK on the warmup phase. The rule of thumb is several tens of thousands of inner loop iterations.)</p>

<p><strong>Rule 2:</strong> Always run with <code>-XX:+PrintCompilation</code>, <code>-verbose:gc</code>, etc., so you can verify that the compiler and other parts of the JVM are not doing unexpected work during your timing phase.</p>

<p><strong>Rule 2.1:</strong> Print messages at the beginning and end of timing and warmup phases, so you can verify that there is no output from Rule 2 during the timing phase.</p>

<p><strong>Rule 3:</strong> Be aware of the difference between <code>-client</code> and <code>-server</code>, and OSR and regular compilations. The <code>-XX:+PrintCompilation</code> flag reports OSR compilations with an at-sign to denote the non-initial entry point, for example: <code>Trouble$1::run @ 2 (41 bytes)</code>. Prefer server to client, and regular to OSR, if you are after best performance.</p>

<p><strong>Rule 4:</strong> Be aware of initialization effects. Do not print for the first time during your timing phase, since printing loads and initializes classes. Do not load new classes outside of the warmup phase (or final reporting phase), unless you are testing class loading specifically (and in that case load only the test classes). Rule 2 is your first line of defense against such effects.</p>

<p><strong>Rule 5:</strong> Be aware of deoptimization and recompilation effects. Do not take any code path for the first time in the timing phase, because the compiler may junk and recompile the code, based on an earlier optimistic assumption that the path was not going to be used at all. Rule 2 is your first line of defense against such effects.</p>

<p><strong>Rule 6:</strong> Use appropriate tools to read the compiler's mind, and expect to be surprised by the code it produces. Inspect the code yourself before forming theories about what makes something faster or slower.</p>

<p><strong>Rule 7:</strong> Reduce noise in your measurements. Run your benchmark on a quiet machine, and run it several times, discarding outliers. Use <code>-Xbatch</code> to serialize the compiler with the application, and consider setting <code>-XX:CICompilerCount=1</code> to prevent the compiler from running in parallel with itself. Try your best to reduce GC overhead, set <code>Xmx</code>(large enough) equals <code>Xms</code> and use <a href="http://openjdk.java.net/jeps/318" rel="noreferrer"><code>UseEpsilonGC</code></a> if it is available.</p>

<p><strong>Rule 8:</strong> Use a library for your benchmark as it is probably more efficient and was already debugged for this sole purpose. Such as <a href="http://openjdk.java.net/projects/code-tools/jmh/" rel="noreferrer">JMH</a>, <a href="https://github.com/google/caliper" rel="noreferrer">Caliper</a> or <a href="http://cseweb.ucsd.edu/users/wgg/JavaProf/javaprof.html" rel="noreferrer">Bill and Paul's Excellent UCSD Benchmarks for Java</a>.  </p>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 2</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm">jvm</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/benchmarking">benchmarking</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm-hotspot">jvm-hotspot</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/microbenchmark">microbenchmark</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I know this question has been marked as answered but I wanted to mention two libraries that help us to write micro benchmarks</p>
<p><strong><a href="https://github.com/google/caliper" rel="noreferrer">Caliper from Google</a></strong></p>
<p><em>Getting started tutorials</em></p>
<ol>
<li><a href="http://codingjunkie.net/micro-benchmarking-with-caliper/" rel="noreferrer">http://codingjunkie.net/micro-benchmarking-with-caliper/</a></li>
<li><a href="http://vertexlabs.co.uk/blog/caliper" rel="noreferrer">http://vertexlabs.co.uk/blog/caliper</a></li>
</ol>
<p><strong><a href="http://openjdk.java.net/projects/code-tools/jmh/" rel="noreferrer">JMH from OpenJDK</a></strong></p>
<p><em>Getting started tutorials</em></p>
<ol>
<li><a href="http://www.oracle.com/technetwork/articles/java/architect-benchmarking-2266277.html" rel="noreferrer">Avoiding Benchmarking Pitfalls on the JVM</a></li>
<li><a href="http://nitschinger.at/Using-JMH-for-Java-Microbenchmarking" rel="noreferrer">Using JMH for Java Microbenchmarking</a></li>
<li><a href="https://web.archive.org/web/20181018130828/http://java-performance.info:80/jmh" rel="noreferrer">Introduction to JMH</a></li>
</ol>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 3</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm">jvm</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/benchmarking">benchmarking</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm-hotspot">jvm-hotspot</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/microbenchmark">microbenchmark</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Important things for Java benchmarks are:</p>

<ul>
<li>Warm up the JIT first by running the code several times <strong>before timing</strong> it</li>
<li>Make sure you run it for long enough to be able to measure the results in seconds or (better) tens of seconds</li>
<li>While you can't call <code>System.gc()</code> between iterations, it's a good idea to run it between tests, so that each test will hopefully get a "clean" memory space to work with. (Yes, <code>gc()</code> is more of a hint than a guarantee, but it's very <em>likely</em> that it really will garbage collect in my experience.)</li>
<li>I like to display iterations and time, and a score of time/iteration which can be scaled such that the "best" algorithm gets a score of 1.0 and others are scored in a relative fashion. This means you can run <em>all</em> algorithms for a longish time, varying both number of iterations and time, but still getting comparable results.</li>
</ul>

<p>I'm just in the process of blogging about the design of a benchmarking framework in .NET. I've got a <a href="http://msmvps.com/blogs/jon_skeet/archive/2009/01/26/benchmarking-made-easy.aspx" rel="noreferrer">couple</a> of <a href="http://msmvps.com/blogs/jon_skeet/archive/2009/01/29/for-vs-foreach-on-arrays-and-lists.aspx" rel="noreferrer">earlier posts</a> which may be able to give you some ideas - not everything will be appropriate, of course, but some of it may be.</p>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 4</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm">jvm</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/benchmarking">benchmarking</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm-hotspot">jvm-hotspot</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/microbenchmark">microbenchmark</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><a href="http://openjdk.java.net/projects/code-tools/jmh/" rel="nofollow noreferrer">jmh</a> is a recent addition to OpenJDK and has been written by some performance engineers from Oracle. Certainly worth a look.</p>

<blockquote>
  <p>The jmh is a Java harness for building, running, and analysing nano/micro/macro benchmarks written in Java and other languages targetting the JVM.</p>
</blockquote>

<p>Very interesting pieces of information buried in <a href="http://hg.openjdk.java.net/code-tools/jmh/file/tip/jmh-samples/src/main/java/org/openjdk/jmh/samples/" rel="nofollow noreferrer">the sample tests comments</a>.</p>

<p>See also:</p>

<ul>
<li><a href="http://www.oracle.com/technetwork/articles/java/architect-benchmarking-2266277.html" rel="nofollow noreferrer">Avoiding Benchmarking Pitfalls on the JVM</a></li>
<li><a href="https://groups.google.com/forum/#!msg/mechanical-sympathy/m4opvy4xq3U/7lY8x8SvHgwJ" rel="nofollow noreferrer">Discussion on the main strengths of jmh</a>.</li>
</ul>
    </div></div></div></div><div id="solution5" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 5</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm">jvm</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/benchmarking">benchmarking</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm-hotspot">jvm-hotspot</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/microbenchmark">microbenchmark</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<blockquote>
  <p>Should the benchmark measure time/iteration or iterations/time, and why?</p>
</blockquote>

<p>It depends on <strong>what</strong> you are trying to test.  </p>

<p>If you are interested in <strong>latency</strong>, use time/iteration and if you are interested in <strong>throughput</strong>, use iterations/time.</p>
    </div></div></div></div><div id="solution6" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 6</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm">jvm</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/benchmarking">benchmarking</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm-hotspot">jvm-hotspot</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/microbenchmark">microbenchmark</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Make sure you somehow use results which are computed in benchmarked code. Otherwise your code can be optimized away.</p>
    </div></div></div></div><div id="solution7" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 7</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm">jvm</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/benchmarking">benchmarking</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm-hotspot">jvm-hotspot</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/microbenchmark">microbenchmark</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If you are trying to compare two algorithms, do at least two benchmarks for each, alternating the order.  i.e.:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">for</span>(i=<span class="hljs-number">1.</span>.n)
  alg1();
<span class="hljs-keyword">for</span>(i=<span class="hljs-number">1.</span>.n)
  alg2();
<span class="hljs-keyword">for</span>(i=<span class="hljs-number">1.</span>.n)
  alg2();
<span class="hljs-keyword">for</span>(i=<span class="hljs-number">1.</span>.n)
  alg1();
</code></pre>

<p>I have found some noticeable differences (5-10% sometimes) in the runtime of the same algorithm in different passes..</p>

<p>Also, make sure that <em>n</em> is very large, so that the runtime of each loop is at the very least 10 seconds or so.  The more iterations, the more significant figures in your benchmark time and the more reliable that data is.</p>
    </div></div></div></div><div id="solution8" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 8</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm">jvm</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/benchmarking">benchmarking</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm-hotspot">jvm-hotspot</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/microbenchmark">microbenchmark</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>There are many possible pitfalls for writing micro-benchmarks in Java.</p>

<p>First: You have to calculate with all sorts of events that take time more or less random: Garbage collection, caching effects (of OS for files and of CPU for memory), IO etc.</p>

<p>Second: You cannot trust the accuracy of the measured times for very short intervals.</p>

<p>Third: The JVM optimizes your code while executing. So different runs in the same JVM-instance will become faster and faster.</p>

<p>My recommendations: Make your benchmark run some seconds, that is more reliable than a runtime over milliseconds. Warm up the JVM (means running the benchmark at least once without measuring, that the JVM can run optimizations). And run your benchmark multiple times (maybe 5 times) and take the median-value. Run every micro-benchmark in a new JVM-instance (call for every benchmark new Java) otherwise optimization effects of the JVM can influence later running tests. Don't execute things, that aren't executed in the warmup-phase (as this could trigger class-load and recompilation).</p>
    </div></div></div></div><div id="solution9" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 9</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm">jvm</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/benchmarking">benchmarking</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm-hotspot">jvm-hotspot</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/microbenchmark">microbenchmark</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>It should also be noted that it might also be important to analyze the results of the micro benchmark when comparing different implementations. Therefore a <a href="http://en.wikipedia.org/wiki/Significance_testing" rel="noreferrer">significance test</a> should be made.</p>

<p>This is because implementation <code>A</code> might be faster during most of the runs of the benchmark than implementation <code>B</code>. But <code>A</code> might also have a higher spread, so the measured performance benefit of <code>A</code> won't be of any significance when compared with <code>B</code>.</p>

<p>So it is also important to write and run a micro benchmark correctly, but also to analyze it correctly.</p>
    </div></div></div></div><div id="solution10" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 10</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm">jvm</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/benchmarking">benchmarking</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm-hotspot">jvm-hotspot</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/microbenchmark">microbenchmark</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>To add to the other excellent advice, I'd also be mindful of the following:</p>

<p>For some CPUs (e.g. Intel Core i5 range with TurboBoost), the temperature (and number of cores currently being used, as well as thier utilisation percent) affects the clock speed. Since CPUs are dynamically clocked, this can affect your results. For example, if you have a single-threaded application, the maximum clock speed (with TurboBoost) is higher than for an application using all cores. This can therefore interfere with comparisons of single and multi-threaded performance on some systems. Bear in mind that the temperature and volatages also affect how long Turbo frequency is maintained.</p>

<p>Perhaps a more fundamentally important aspect that you have direct control over: make sure you're measuring the right thing! For example, if you're using <code>System.nanoTime()</code> to benchmark a particular bit of code, put the calls to the assignment in places that make sense to avoid measuring things which you aren't interested in. For example, don't do:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.nanoTime();
<span class="hljs-comment">//code here...</span>
System.out.println(<span class="hljs-string">"Code took "</span>+(System.nanoTime()-startTime)+<span class="hljs-string">"nano seconds"</span>);
</code></pre>

<p>Problem is you're not immediately getting the end time when the code has finished. Instead, try the following:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">final</span> <span class="hljs-type">long</span> endTime, startTime = System.nanoTime();
<span class="hljs-comment">//code here...</span>
endTime = System.nanoTime();
System.out.println(<span class="hljs-string">"Code took "</span>+(endTime-startTime)+<span class="hljs-string">"nano seconds"</span>);
</code></pre>
    </div></div></div></div><div id="solution11" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h1 class="text-4xl font-semibold mb-5">Solution 11</h1><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm">jvm</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/benchmarking">benchmarking</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/jvm-hotspot">jvm-hotspot</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/microbenchmark">microbenchmark</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><a href="http://opt.sourceforge.net/" rel="noreferrer">http://opt.sourceforge.net/</a> Java Micro Benchmark - control tasks required to determine the comparative performance characteristics of the computer system on different platforms. Can be used to guide optimization decisions and to compare different Java implementations.</p>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/why-does-this-unboundlocalerror-occur-(closure)-duplicate-1657388531538">Why does this UnboundLocalError occur (closure)? [duplicate]</a><a href="/questions/why-is-the-gets-function-so-dangerous-that-it-should-not-be-used-1657384544362">Why is the gets function so dangerous that it should not be used?</a><a href="/questions/query-based-on-multiple-where-clauses-in-firebase-1657387494547">Query based on multiple where clauses in Firebase</a><a href="/questions/how-do-i-undo-the-most-recent-local-commits-in-git-1657388262945">How do I undo the most recent local commits in Git?</a><a href="/questions/how-can-i-sanitize-user-input-with-php-1657387892329">How can I sanitize user input with PHP?</a><a href="/questions/what-is-this-weird-colon-member-(%22-:-%22)-syntax-in-the-constructor-1657387264047">What is this weird colon-member (&quot; : &quot;) syntax in the constructor?</a><a href="/questions/what-is-pecs-(producer-extends-consumer-super)-1657384828870">What is PECS (Producer Extends Consumer Super)?</a><a href="/questions/how-can-i-do-a-full-outer-join-in-mysql-1657388175444">How can I do a FULL OUTER JOIN in MySQL?</a><a href="/questions/how-to-deal-with-settingwithcopywarning-in-pandas-1657384778377">How to deal with SettingWithCopyWarning in Pandas</a><a href="/questions/parameterize-an-sql-in-clause-1657387536064">Parameterize an SQL IN clause</a><a href="/questions/creating-multiline-strings-in-javascript-1657388025414">Creating multiline strings in JavaScript</a><a href="/questions/prefer-composition-over-inheritance-1657387399409">Prefer composition over inheritance?</a><a href="/questions/how-do-i-return-the-response-from-an-asynchronous-call-1657384208012">How do I return the response from an asynchronous call?</a><a href="/questions/how-to-make-a-great-r-reproducible-example-1657384198173">How to make a great R reproducible example</a><a href="/questions/sort-(order)-data-frame-rows-by-multiple-columns-1657388355671">Sort (order) data frame rows by multiple columns</a><a href="/questions/how-do-i-set-a-variable-to-the-output-of-a-command-in-bash-1657387250909">How do I set a variable to the output of a command in Bash?</a><a href="/questions/how-can-i-avoid-java-code-in-jsp-files-using-jsp-2-1657384618866">How can I avoid Java code in JSP files, using JSP 2?</a><a href="/questions/how-can-you-represent-inheritance-in-a-database-1657388076553">How can you represent inheritance in a database?</a><a href="/questions/find-object-by-id-in-an-array-of-javascript-objects-1657387572087">Find object by id in an array of JavaScript objects</a><a href="/questions/do-dom-tree-elements-with-ids-become-global-properties-1657387475110">Do DOM tree elements with IDs become global properties?</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;Tips about writing micro benchmarks \u0026lt;a href=\u0026quot;https://wiki.openjdk.java.net/display/HotSpot/Main\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;from the creators of Java HotSpot\u0026lt;/a\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 0:\u0026lt;/strong\u0026gt; Read a reputable paper on JVMs and micro-benchmarking. A good one is \u0026lt;a href=\u0026quot;http://www.ibm.com/developerworks/java/library/j-jtp02225\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Brian Goetz, 2005\u0026lt;/a\u0026gt;. Do not expect too much from micro-benchmarks; they measure only a limited range of JVM performance characteristics.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 1:\u0026lt;/strong\u0026gt; Always include a warmup phase which runs your test kernel all the way through, enough to trigger all initializations and compilations before timing phase(s). (Fewer iterations is OK on the warmup phase. The rule of thumb is several tens of thousands of inner loop iterations.)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 2:\u0026lt;/strong\u0026gt; Always run with \u0026lt;code\u0026gt;-XX:+PrintCompilation\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;-verbose:gc\u0026lt;/code\u0026gt;, etc., so you can verify that the compiler and other parts of the JVM are not doing unexpected work during your timing phase.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 2.1:\u0026lt;/strong\u0026gt; Print messages at the beginning and end of timing and warmup phases, so you can verify that there is no output from Rule 2 during the timing phase.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 3:\u0026lt;/strong\u0026gt; Be aware of the difference between \u0026lt;code\u0026gt;-client\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;-server\u0026lt;/code\u0026gt;, and OSR and regular compilations. The \u0026lt;code\u0026gt;-XX:+PrintCompilation\u0026lt;/code\u0026gt; flag reports OSR compilations with an at-sign to denote the non-initial entry point, for example: \u0026lt;code\u0026gt;Trouble$1::run @ 2 (41 bytes)\u0026lt;/code\u0026gt;. Prefer server to client, and regular to OSR, if you are after best performance.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 4:\u0026lt;/strong\u0026gt; Be aware of initialization effects. Do not print for the first time during your timing phase, since printing loads and initializes classes. Do not load new classes outside of the warmup phase (or final reporting phase), unless you are testing class loading specifically (and in that case load only the test classes). Rule 2 is your first line of defense against such effects.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 5:\u0026lt;/strong\u0026gt; Be aware of deoptimization and recompilation effects. Do not take any code path for the first time in the timing phase, because the compiler may junk and recompile the code, based on an earlier optimistic assumption that the path was not going to be used at all. Rule 2 is your first line of defense against such effects.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 6:\u0026lt;/strong\u0026gt; Use appropriate tools to read the compiler\u0026apos;s mind, and expect to be surprised by the code it produces. Inspect the code yourself before forming theories about what makes something faster or slower.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 7:\u0026lt;/strong\u0026gt; Reduce noise in your measurements. Run your benchmark on a quiet machine, and run it several times, discarding outliers. Use \u0026lt;code\u0026gt;-Xbatch\u0026lt;/code\u0026gt; to serialize the compiler with the application, and consider setting \u0026lt;code\u0026gt;-XX:CICompilerCount=1\u0026lt;/code\u0026gt; to prevent the compiler from running in parallel with itself. Try your best to reduce GC overhead, set \u0026lt;code\u0026gt;Xmx\u0026lt;/code\u0026gt;(large enough) equals \u0026lt;code\u0026gt;Xms\u0026lt;/code\u0026gt; and use \u0026lt;a href=\u0026quot;http://openjdk.java.net/jeps/318\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;UseEpsilonGC\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; if it is available.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 8:\u0026lt;/strong\u0026gt; Use a library for your benchmark as it is probably more efficient and was already debugged for this sole purpose. Such as \u0026lt;a href=\u0026quot;http://openjdk.java.net/projects/code-tools/jmh/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;JMH\u0026lt;/a\u0026gt;, \u0026lt;a href=\u0026quot;https://github.com/google/caliper\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Caliper\u0026lt;/a\u0026gt; or \u0026lt;a href=\u0026quot;http://cseweb.ucsd.edu/users/wgg/JavaProf/javaprof.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Bill and Paul\u0026apos;s Excellent UCSD Benchmarks for Java\u0026lt;/a\u0026gt;.  \u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I know this question has been marked as answered but I wanted to mention two libraries that help us to write micro benchmarks\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;a href=\u0026quot;https://github.com/google/caliper\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Caliper from Google\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Getting started tutorials\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://codingjunkie.net/micro-benchmarking-with-caliper/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;http://codingjunkie.net/micro-benchmarking-with-caliper/\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://vertexlabs.co.uk/blog/caliper\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;http://vertexlabs.co.uk/blog/caliper\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;a href=\u0026quot;http://openjdk.java.net/projects/code-tools/jmh/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;JMH from OpenJDK\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Getting started tutorials\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://www.oracle.com/technetwork/articles/java/architect-benchmarking-2266277.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Avoiding Benchmarking Pitfalls on the JVM\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://nitschinger.at/Using-JMH-for-Java-Microbenchmarking\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Using JMH for Java Microbenchmarking\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;https://web.archive.org/web/20181018130828/http://java-performance.info:80/jmh\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Introduction to JMH\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Important things for Java benchmarks are:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Warm up the JIT first by running the code several times \u0026lt;strong\u0026gt;before timing\u0026lt;/strong\u0026gt; it\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Make sure you run it for long enough to be able to measure the results in seconds or (better) tens of seconds\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;While you can\u0026apos;t call \u0026lt;code\u0026gt;System.gc()\u0026lt;/code\u0026gt; between iterations, it\u0026apos;s a good idea to run it between tests, so that each test will hopefully get a \u0026quot;clean\u0026quot; memory space to work with. (Yes, \u0026lt;code\u0026gt;gc()\u0026lt;/code\u0026gt; is more of a hint than a guarantee, but it\u0026apos;s very \u0026lt;em\u0026gt;likely\u0026lt;/em\u0026gt; that it really will garbage collect in my experience.)\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;I like to display iterations and time, and a score of time/iteration which can be scaled such that the \u0026quot;best\u0026quot; algorithm gets a score of 1.0 and others are scored in a relative fashion. This means you can run \u0026lt;em\u0026gt;all\u0026lt;/em\u0026gt; algorithms for a longish time, varying both number of iterations and time, but still getting comparable results.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;I\u0026apos;m just in the process of blogging about the design of a benchmarking framework in .NET. I\u0026apos;ve got a \u0026lt;a href=\u0026quot;http://msmvps.com/blogs/jon_skeet/archive/2009/01/26/benchmarking-made-easy.aspx\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;couple\u0026lt;/a\u0026gt; of \u0026lt;a href=\u0026quot;http://msmvps.com/blogs/jon_skeet/archive/2009/01/29/for-vs-foreach-on-arrays-and-lists.aspx\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;earlier posts\u0026lt;/a\u0026gt; which may be able to give you some ideas - not everything will be appropriate, of course, but some of it may be.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://openjdk.java.net/projects/code-tools/jmh/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;jmh\u0026lt;/a\u0026gt; is a recent addition to OpenJDK and has been written by some performance engineers from Oracle. Certainly worth a look.\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;The jmh is a Java harness for building, running, and analysing nano/micro/macro benchmarks written in Java and other languages targetting the JVM.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;Very interesting pieces of information buried in \u0026lt;a href=\u0026quot;http://hg.openjdk.java.net/code-tools/jmh/file/tip/jmh-samples/src/main/java/org/openjdk/jmh/samples/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;the sample tests comments\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;See also:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://www.oracle.com/technetwork/articles/java/architect-benchmarking-2266277.html\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Avoiding Benchmarking Pitfalls on the JVM\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;https://groups.google.com/forum/#!msg/mechanical-sympathy/m4opvy4xq3U/7lY8x8SvHgwJ\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Discussion on the main strengths of jmh\u0026lt;/a\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;Should the benchmark measure time/iteration or iterations/time, and why?\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;It depends on \u0026lt;strong\u0026gt;what\u0026lt;/strong\u0026gt; you are trying to test.  \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;If you are interested in \u0026lt;strong\u0026gt;latency\u0026lt;/strong\u0026gt;, use time/iteration and if you are interested in \u0026lt;strong\u0026gt;throughput\u0026lt;/strong\u0026gt;, use iterations/time.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Make sure you somehow use results which are computed in benchmarked code. Otherwise your code can be optimized away.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;If you are trying to compare two algorithms, do at least two benchmarks for each, alternating the order.  i.e.:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(i=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1.\u0026lt;/span\u0026gt;.n)\n  alg1();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(i=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1.\u0026lt;/span\u0026gt;.n)\n  alg2();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(i=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1.\u0026lt;/span\u0026gt;.n)\n  alg2();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(i=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1.\u0026lt;/span\u0026gt;.n)\n  alg1();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;I have found some noticeable differences (5-10% sometimes) in the runtime of the same algorithm in different passes..\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Also, make sure that \u0026lt;em\u0026gt;n\u0026lt;/em\u0026gt; is very large, so that the runtime of each loop is at the very least 10 seconds or so.  The more iterations, the more significant figures in your benchmark time and the more reliable that data is.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;There are many possible pitfalls for writing micro-benchmarks in Java.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;First: You have to calculate with all sorts of events that take time more or less random: Garbage collection, caching effects (of OS for files and of CPU for memory), IO etc.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Second: You cannot trust the accuracy of the measured times for very short intervals.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Third: The JVM optimizes your code while executing. So different runs in the same JVM-instance will become faster and faster.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;My recommendations: Make your benchmark run some seconds, that is more reliable than a runtime over milliseconds. Warm up the JVM (means running the benchmark at least once without measuring, that the JVM can run optimizations). And run your benchmark multiple times (maybe 5 times) and take the median-value. Run every micro-benchmark in a new JVM-instance (call for every benchmark new Java) otherwise optimization effects of the JVM can influence later running tests. Don\u0026apos;t execute things, that aren\u0026apos;t executed in the warmup-phase (as this could trigger class-load and recompilation).\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;It should also be noted that it might also be important to analyze the results of the micro benchmark when comparing different implementations. Therefore a \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Significance_testing\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;significance test\u0026lt;/a\u0026gt; should be made.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This is because implementation \u0026lt;code\u0026gt;A\u0026lt;/code\u0026gt; might be faster during most of the runs of the benchmark than implementation \u0026lt;code\u0026gt;B\u0026lt;/code\u0026gt;. But \u0026lt;code\u0026gt;A\u0026lt;/code\u0026gt; might also have a higher spread, so the measured performance benefit of \u0026lt;code\u0026gt;A\u0026lt;/code\u0026gt; won\u0026apos;t be of any significance when compared with \u0026lt;code\u0026gt;B\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;So it is also important to write and run a micro benchmark correctly, but also to analyze it correctly.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;To add to the other excellent advice, I\u0026apos;d also be mindful of the following:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For some CPUs (e.g. Intel Core i5 range with TurboBoost), the temperature (and number of cores currently being used, as well as thier utilisation percent) affects the clock speed. Since CPUs are dynamically clocked, this can affect your results. For example, if you have a single-threaded application, the maximum clock speed (with TurboBoost) is higher than for an application using all cores. This can therefore interfere with comparisons of single and multi-threaded performance on some systems. Bear in mind that the temperature and volatages also affect how long Turbo frequency is maintained.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Perhaps a more fundamentally important aspect that you have direct control over: make sure you\u0026apos;re measuring the right thing! For example, if you\u0026apos;re using \u0026lt;code\u0026gt;System.nanoTime()\u0026lt;/code\u0026gt; to benchmark a particular bit of code, put the calls to the assignment in places that make sense to avoid measuring things which you aren\u0026apos;t interested in. For example, don\u0026apos;t do:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;long\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;startTime\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; System.nanoTime();\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//code here...\u0026lt;/span\u0026gt;\nSystem.out.println(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Code took \u0026quot;\u0026lt;/span\u0026gt;+(System.nanoTime()-startTime)+\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;nano seconds\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Problem is you\u0026apos;re not immediately getting the end time when the code has finished. Instead, try the following:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;final\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;long\u0026lt;/span\u0026gt; endTime, startTime = System.nanoTime();\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//code here...\u0026lt;/span\u0026gt;\nendTime = System.nanoTime();\nSystem.out.println(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Code took \u0026quot;\u0026lt;/span\u0026gt;+(endTime-startTime)+\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;nano seconds\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://opt.sourceforge.net/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;http://opt.sourceforge.net/\u0026lt;/a\u0026gt; Java Micro Benchmark - control tasks required to determine the comparative performance characteristics of the computer system on different platforms. Can be used to guide optimization decisions and to compare different Java implementations.\u0026lt;/p\u0026gt;\n    "],"id":73,"title":"How do I write a correct micro-benchmark in Java?","content":"\n                \n\u0026lt;p\u0026gt;How do you write (and run) a correct micro-benchmark in Java?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I\u0026apos;m looking for some code samples and comments illustrating various things to think about.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Example: Should the benchmark measure time/iteration or iterations/time, and why?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Related: \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/410437/is-stopwatch-benchmarking-acceptable\u0026quot;\u0026gt;Is stopwatch benchmarking acceptable?\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","slug":"how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725","postType":"QUESTION","createdAt":"2022-07-09T16:34:48.000Z","updatedAt":"2022-07-09T16:34:48.000Z","tags":[{"id":265,"name":"jvm","slug":"jvm","createdAt":"2022-07-09T16:34:48.000Z","updatedAt":"2022-07-09T16:34:48.000Z","Questions_Tags":{"questionId":73,"tagId":265}},{"id":266,"name":"benchmarking","slug":"benchmarking","createdAt":"2022-07-09T16:34:48.000Z","updatedAt":"2022-07-09T16:34:48.000Z","Questions_Tags":{"questionId":73,"tagId":266}},{"id":267,"name":"jvm-hotspot","slug":"jvm-hotspot","createdAt":"2022-07-09T16:34:48.000Z","updatedAt":"2022-07-09T16:34:48.000Z","Questions_Tags":{"questionId":73,"tagId":267}},{"id":268,"name":"microbenchmark","slug":"microbenchmark","createdAt":"2022-07-09T16:34:48.000Z","updatedAt":"2022-07-09T16:34:48.000Z","Questions_Tags":{"questionId":73,"tagId":268}}],"relatedQuestions":[{"title":"How do I write a correct micro-benchmark in Java?","slug":"how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725","tags":[{"name":"jvm","Questions_Tags":{"questionId":73,"tagId":265}},{"name":"benchmarking","Questions_Tags":{"questionId":73,"tagId":266}},{"name":"jvm-hotspot","Questions_Tags":{"questionId":73,"tagId":267}},{"name":"microbenchmark","Questions_Tags":{"questionId":73,"tagId":268}}]}]},"randomQuestions":[{"title":"Why does this UnboundLocalError occur (closure)? [duplicate]","slug":"why-does-this-unboundlocalerror-occur-(closure)-duplicate-1657388531538"},{"title":"Why is the gets function so dangerous that it should not be used?","slug":"why-is-the-gets-function-so-dangerous-that-it-should-not-be-used-1657384544362"},{"title":"Query based on multiple where clauses in Firebase","slug":"query-based-on-multiple-where-clauses-in-firebase-1657387494547"},{"title":"How do I undo the most recent local commits in Git?","slug":"how-do-i-undo-the-most-recent-local-commits-in-git-1657388262945"},{"title":"How can I sanitize user input with PHP?","slug":"how-can-i-sanitize-user-input-with-php-1657387892329"},{"title":"What is this weird colon-member (\" : \") syntax in the constructor?","slug":"what-is-this-weird-colon-member-(\"-:-\")-syntax-in-the-constructor-1657387264047"},{"title":"What is PECS (Producer Extends Consumer Super)?","slug":"what-is-pecs-(producer-extends-consumer-super)-1657384828870"},{"title":"How can I do a FULL OUTER JOIN in MySQL?","slug":"how-can-i-do-a-full-outer-join-in-mysql-1657388175444"},{"title":"How to deal with SettingWithCopyWarning in Pandas","slug":"how-to-deal-with-settingwithcopywarning-in-pandas-1657384778377"},{"title":"Parameterize an SQL IN clause","slug":"parameterize-an-sql-in-clause-1657387536064"},{"title":"Creating multiline strings in JavaScript","slug":"creating-multiline-strings-in-javascript-1657388025414"},{"title":"Prefer composition over inheritance?","slug":"prefer-composition-over-inheritance-1657387399409"},{"title":"How do I return the response from an asynchronous call?","slug":"how-do-i-return-the-response-from-an-asynchronous-call-1657384208012"},{"title":"How to make a great R reproducible example","slug":"how-to-make-a-great-r-reproducible-example-1657384198173"},{"title":"Sort (order) data frame rows by multiple columns","slug":"sort-(order)-data-frame-rows-by-multiple-columns-1657388355671"},{"title":"How do I set a variable to the output of a command in Bash?","slug":"how-do-i-set-a-variable-to-the-output-of-a-command-in-bash-1657387250909"},{"title":"How can I avoid Java code in JSP files, using JSP 2?","slug":"how-can-i-avoid-java-code-in-jsp-files-using-jsp-2-1657384618866"},{"title":"How can you represent inheritance in a database?","slug":"how-can-you-represent-inheritance-in-a-database-1657388076553"},{"title":"Find object by id in an array of JavaScript objects","slug":"find-object-by-id-in-an-array-of-javascript-objects-1657387572087"},{"title":"Do DOM tree elements with IDs become global properties?","slug":"do-dom-tree-elements-with-ids-become-global-properties-1657387475110"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725"},"buildId":"xZs8haGjOP63QuDE0kxeX","isFallback":false,"gsp":true,"locale":"en","locales":["en"],"defaultLocale":"en","scriptLoader":[]}</script></body></html>