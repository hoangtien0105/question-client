<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find solution for coding, HTML, CSS, JAVASCRIPT, MYSQL, PHP, PYTHON,... quickly. - solutionschecker.com"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><title>Using async/await with a forEach loop | Solutions Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="Are there any issues with using async/await in a forEach loop? I&#x27;m trying to loop through an array of files and await on the contents of each file.
import fs from &#x27;fs-promise&#x27;

async function printFiles () {
  const files = await getFilePaths() // Assume this works fine

  files.forEach(async (file) =&gt; {
    const contents = await fs.readFile(file, &#x27;utf8&#x27;)
    console.log(contents)
  })
}

printFiles()

This code does work, but could something go wrong with this? I had someone tell me that you&#x27;re not supposed to use async/await in a higher-order function like this, so I just wanted to ask if there was any issue with this.
    "/><meta property="og:title" content="Using async/await with a forEach loop | Solutions Checker"/><meta property="og:description" content="Are there any issues with using async/await in a forEach loop? I&#x27;m trying to loop through an array of files and await on the contents of each file.
import fs from &#x27;fs-promise&#x27;

async function printFiles () {
  const files = await getFilePaths() // Assume this works fine

  files.forEach(async (file) =&gt; {
    const contents = await fs.readFile(file, &#x27;utf8&#x27;)
    console.log(contents)
  })
}

printFiles()

This code does work, but could something go wrong with this? I had someone tell me that you&#x27;re not supposed to use async/await in a higher-order function like this, so I just wanted to ask if there was any issue with this.
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"Using async/await with a forEach loop","text":"Are there any issues with using async/await in a forEach loop? I&apos;m trying to loop through an array of files and await on the contents of each file.\nimport fs from &apos;fs-promise&apos;\n\nasync function printFiles () {\n  const files = await getFilePaths() // Assume this works fine\n\n  files.forEach(async (file) =&gt; {\n    const contents = await fs.readFile(file, &apos;utf8&apos;)\n    console.log(contents)\n  })\n}\n\nprintFiles()\n\nThis code does work, but could something go wrong with this? I had someone tell me that you&apos;re not supposed to use async/await in a higher-order function like this, so I just wanted to ask if there was any issue with this.\n    ","answerCount":30,"upVoteCount":500,"suggestedAnswer":[{"text":"Sure the code does work, but I&apos;m pretty sure it doesn&apos;t do what you expect it to do. It just fires off multiple asynchronous calls, but the printFiles function does immediately return after that.\n\nReading in sequence\n\nIf you want to read the files in sequence, you cannot use forEach indeed. Just use a modern for  of loop instead, in which await will work as expected:\n\nasync function printFiles () {\n  const files = await getFilePaths();\n\n  for (const file of files) {\n    const contents = await fs.readFile(file, &apos;utf8&apos;);\n    console.log(contents);\n  }\n}\n\n\nReading in parallel\n\nIf you want to read the files in parallel, you cannot use forEach indeed. Each of the async callback function calls does return a promise, but you&apos;re throwing them away instead of awaiting them. Just use map instead, and you can await the array of promises that you&apos;ll get with Promise.all:\n\nasync function printFiles () {\n  const files = await getFilePaths();\n\n  await Promise.all(files.map(async (file) =&gt; {\n    const contents = await fs.readFile(file, &apos;utf8&apos;)\n    console.log(contents)\n  }));\n}\n\n    ","url":"/questions/[slug]#solution1","@type":"Answer","upvoteCount":0},{"text":"With ES2018, you are able to greatly simplify all of the above answers to:\nasync function printFiles () {\n  const files = await getFilePaths()\n\n  for await (const contents of files.map(file =&gt; fs.readFile(file, &apos;utf8&apos;))) {\n    console.log(contents)\n  }\n}\n\nSee spec: proposal-async-iteration\nSimplified:\n  for await (const results of array) {\n    await longRunningTask()\n  }\n  console.log(&apos;I will wait&apos;)\n\n\n2018-09-10: This answer has been getting a lot of attention recently, please see Axel Rauschmayer&apos;s blog post for further information about asynchronous iteration.\n    ","url":"/questions/[slug]#solution2","@type":"Answer","upvoteCount":0},{"text":"Instead of Promise.all in conjunction with Array.prototype.map (which does not guarantee the order in which the Promises are resolved), I use Array.prototype.reduce, starting with a resolved Promise:\n\nasync function printFiles () {\n  const files = await getFilePaths();\n\n  await files.reduce(async (promise, file) =&gt; {\n    // This line will wait for the last async function to finish.\n    // The first iteration uses an already resolved Promise\n    // so, it will immediately continue.\n    await promise;\n    const contents = await fs.readFile(file, &apos;utf8&apos;);\n    console.log(contents);\n  }, Promise.resolve());\n}\n\n    ","url":"/questions/[slug]#solution3","@type":"Answer","upvoteCount":0},{"text":"The p-iteration module on npm implements the Array iteration methods so they can be used in a very straightforward way with async/await.\n\nAn example with your case:\n\nconst { forEach } = require(&apos;p-iteration&apos;);\nconst fs = require(&apos;fs-promise&apos;);\n\n(async function printFiles () {\n  const files = await getFilePaths();\n\n  await forEach(files, async (file) =&gt; {\n    const contents = await fs.readFile(file, &apos;utf8&apos;);\n    console.log(contents);\n  });\n})();\n\n    ","url":"/questions/[slug]#solution4","@type":"Answer","upvoteCount":0},{"text":"Here are some forEachAsync prototypes. Note you&apos;ll need to await them:\n\nArray.prototype.forEachAsync = async function (fn) {\n    for (let t of this) { await fn(t) }\n}\n\nArray.prototype.forEachAsyncParallel = async function (fn) {\n    await Promise.all(this.map(fn));\n}\n\n\nNote while you may include this in your own code, you should not include this in libraries you distribute to others (to avoid polluting their globals).\n    ","url":"/questions/[slug]#solution5","@type":"Answer","upvoteCount":0},{"text":"Picture worth 1000 words - For Sequential Approach Only\n\nBackground : I was in similar situation last night. I used async function as foreach argument. The result was un-predictable. When I did testing for my code 3 times, it ran without issues 2 times and failed 1 time. (something weird)\nFinally I got my head around &amp; did some scratch pad testing.\nScenario 1 - How un-sequential it can get with async in foreach\n\nconst getPromise = (time) =&gt; { \n  return new Promise((resolve, reject) =&gt; {\n    setTimeout(() =&gt; {\n      resolve(`Promise resolved for ${time}s`)\n    }, time)\n  })\n}\n\nconst main = async () =&gt; {\n  const myPromiseArray = [getPromise(1000), getPromise(500), getPromise(3000)]\n  console.log(&apos;Before For Each Loop&apos;)\n\n  myPromiseArray.forEach(async (element, index) =&gt; {\n    let result = await element;\n    console.log(result);\n  })\n\n  console.log(&apos;After For Each Loop&apos;)\n}\n\nmain();\n\nScenario 2 - Using for - of loop as @Bergi above suggested\n\nconst getPromise = (time) =&gt; { \n  return new Promise((resolve, reject) =&gt; {\n    setTimeout(() =&gt; {\n      resolve(`Promise resolved for ${time}s`)\n    }, time)\n  })\n}\n\nconst main = async () =&gt; {\n  const myPromiseArray = [getPromise(1000), getPromise(500), getPromise(3000)]\n  console.log(&apos;Before For Each Loop&apos;)\n\n  // AVOID USING THIS\n  // myPromiseArray.forEach(async (element, index) =&gt; {\n  //   let result = await element;\n  //   console.log(result);\n  // })\n\n  // This works well\n  for (const element of myPromiseArray) {\n    let result = await element;\n    console.log(result)\n  }\n\n  console.log(&apos;After For Each Loop&apos;)\n}\n\nmain();\n\nIf you are little old school like me, you could simply use the classic for loop, that works too :)\nconst getPromise = (time) =&gt; { \n  return new Promise((resolve, reject) =&gt; {\n    setTimeout(() =&gt; {\n      resolve(`Promise resolved for ${time}s`)\n    }, time)\n  })\n}\n\nconst main = async () =&gt; {\n  const myPromiseArray = [getPromise(1000), getPromise(500), getPromise(3000)]\n  console.log(&apos;Before For Each Loop&apos;)\n\n  // AVOID USING THIS\n  // myPromiseArray.forEach(async (element, index) =&gt; {\n  //   let result = await element;\n  //   console.log(result);\n  // })\n\n  // This works well too - the classic for loop :)\n  for (let i = 0; i &lt; myPromiseArray.length; i++) {\n    const result = await myPromiseArray[i];\n    console.log(result);\n  }\n\n  console.log(&apos;After For Each Loop&apos;)\n}\n\nmain();\n\nI hope this helps someone, good day, cheers!\n    ","url":"/questions/[slug]#solution6","@type":"Answer","upvoteCount":0},{"text":"@Bergi has already gave the answer on how to handle this particular case properly. I&apos;ll not duplicate here.\nI&apos;d like to address the difference between using forEach and for loop when it comes to async and await\nhow forEach works\nLet&apos;s look at how forEach works. According to ECMAScript Specification, MDN provides an implementation which can be used as a polyfill. I copy it and paste here with comments removal.\nArray.prototype.forEach = function (callback, thisArg) {\n  if (this == null) { throw new TypeError(&apos;Array.prototype.forEach called on null or undefined&apos;); }\n  var T, k;\n  var O = Object(this);\n  var len = O.length &gt;&gt;&gt; 0;\n  if (typeof callback !== &quot;function&quot;) { throw new TypeError(callback + &apos; is not a function&apos;); }\n  if (arguments.length &gt; 1) { T = thisArg; }\n  k = 0;\n  while (k &lt; len) {\n    var kValue;\n    if (k in O) {\n      kValue = O[k];\n      callback.call(T, kValue, k, O); // pay attention to this line\n    }\n    k++;\n  }\n};\n\nLet&apos;s back to your code, let&apos;s extract the callback as a function.\nasync function callback(file){\n  const contents = await fs.readFile(file, &apos;utf8&apos;)\n  console.log(contents)\n}\n\nSo, basically callback returns a promise since it&apos;s declared with async. Inside forEach, callback is just called in a normal way, if the callback itself returns a promise, the javascript engine will not wait it to be resolved or rejected. Instead, it puts the promise in a job queue, and continues executing the loop.\nHow about await fs.readFile(file, &apos;utf8&apos;) inside the callback?\nBasically, when your async callback gets the chance to be executed, the js engine will pause until fs.readFile(file, &apos;utf8&apos;) to be resolved or rejected, and resume execution of the async function after fulfillment. So the contents variable store the actual result from fs.readFile, not a promise. So, console.log(contents) logs out the file content not a Promise\nWhy for ... of works?\nwhen we write a generic for of loop, we gain more control than forEach. Let&apos;s refactor printFiles.\nasync function printFiles () {\n  const files = await getFilePaths() // Assume this works fine\n\n  for (const file of files) {\n    const contents = await fs.readFile(file, &apos;utf8&apos;)\n    console.log(contents)\n    // or await callback(file)\n  }\n}\n\nWhen evaluate for loop, we have await promise inside the async function, the execution will pause until the await promise is settled. So, you can think of that the files are read one by one in a determined order.\nExecute sequentially\nSometimes, we really need the the async functions to be executed in a sequential order. For example, I have a few new records stored in an array to be saved to database, and I want them to be saved in sequential order which means first record in array should be saved first, then second, until last one is saved.\nHere is an example:\n\n\nconst records = [1, 2, 3, 4];\n\nasync function saveRecord(record) {\n  return new Promise((resolved, rejected) =&gt; {\n    setTimeout(()=&gt; {\n      resolved(`record ${record} saved`)\n    }, Math.random() * 500)\n  });\n}\n\nasync function forEachSaveRecords(records) {\n  records.forEach(async (record) =&gt; {\n    const res = await saveRecord(record);\n    console.log(res);\n  })\n}\n\nasync function forofSaveRecords(records) {\n  for (const record of records) {\n    const res = await saveRecord(record);\n    console.log(res);\n  }\n}\n(async () =&gt; {\n  console.log(&quot;=== for of save records ===&quot;)\n  await forofSaveRecords(records)\n  \n  console.log(&quot;=== forEach save records ===&quot;)\n  await forEachSaveRecords(records)\n})()\n Run code snippetHide resultsExpand snippet\n\n\nI use setTimeout to simulate the process of saving a record to database - it&apos;s asynchronous and cost a random time. Using forEach, the records are saved in an undetermined order, but using for..of, they are saved sequentially.\n    ","url":"/questions/[slug]#solution7","@type":"Answer","upvoteCount":0},{"text":"This solution is also memory-optimized so you can run it on 10,000&apos;s of data items and requests. Some of the other solutions here will crash the server on large data sets.\nIn TypeScript:\nexport async function asyncForEach&lt;T&gt;(array: Array&lt;T&gt;, callback: (item: T, index: number) =&gt; Promise&lt;void&gt;) {\n        for (let index = 0; index &lt; array.length; index++) {\n            await callback(array[index], index);\n        }\n    }\n\nHow to use?\nawait asyncForEach(receipts, async (eachItem) =&gt; {\n    await ...\n})\n\n    ","url":"/questions/[slug]#solution8","@type":"Answer","upvoteCount":0},{"text":"\nfiles.forEach(async (file) =&gt; {\n    const contents = await fs.readFile(file, &apos;utf8&apos;)\n})\n\n\nThe issue is, the promise returned by the iteration function is ignored by forEach(). As a result, all the fs.readFile functions\nare invoked in the same round of the event loop, which means they are started in parallel, not in sequential, and the execution continues immediately after invoking forEach(), without\nwaiting for all the fs.readFile operations to complete. Since forEach does not wait for each promise to resolve, the loop actually finishes iterating before promises are resolved.  You may end up trying to access values that are not available yet.\n    ","url":"/questions/[slug]#solution9","@type":"Answer","upvoteCount":0},{"text":"In addition to @Bergis answer, Id like to offer a third alternative. It&apos;s very similar to @Bergis 2nd example, but instead of awaiting each readFile individually, you create an array of promises, each which you await at the end.\n\nimport fs from &apos;fs-promise&apos;;\nasync function printFiles () {\n  const files = await getFilePaths();\n\n  const promises = files.map((file) =&gt; fs.readFile(file, &apos;utf8&apos;))\n\n  const contents = await Promise.all(promises)\n\n  contents.forEach(console.log);\n}\n\n\nNote that the function passed to .map() does not need to be async, since fs.readFile returns a Promise object anyway. Therefore promises is an array of Promise objects, which can be sent to Promise.all().\n\nIn @Bergis answer, the console may log file contents in the order theyre read. For example if a really small file finishes reading before a really large file, it will be logged first, even if the small file comes after the large file in the files array. However, in my method above, you are guaranteed the console will log the files in the same order as the provided array.\n    ","url":"/questions/[slug]#solution10","@type":"Answer","upvoteCount":0},{"text":"A simple drop-in solution for replacing a forEach() await loop that is not working is replacing forEach with map and adding Promise.all( to the beginning.\nFor example:\nawait y.forEach(async (x) =&gt; {\nto\nawait Promise.all(y.map(async (x) =&gt; {\nAn extra ) is needed at the end.\n    ","url":"/questions/[slug]#solution11","@type":"Answer","upvoteCount":0},{"text":"it&apos;s pretty painless to pop a couple methods in a file that will handle asynchronous data in a serialized order and give a more conventional flavour to your code.  For example:\n\nmodule.exports = function () {\n  var self = this;\n\n  this.each = async (items, fn) =&gt; {\n    if (items &amp;&amp; items.length) {\n      await Promise.all(\n        items.map(async (item) =&gt; {\n          await fn(item);\n        }));\n    }\n  };\n\n  this.reduce = async (items, fn, initialValue) =&gt; {\n    await self.each(\n      items, async (item) =&gt; {\n        initialValue = await fn(initialValue, item);\n      });\n    return initialValue;\n  };\n};\n\n\nnow, assuming that&apos;s saved at &apos;./myAsync.js&apos; you can do something similar to the below in an adjacent file:\n\n...\n/* your server setup here */\n...\nvar MyAsync = require(&apos;./myAsync&apos;);\nvar Cat = require(&apos;./models/Cat&apos;);\nvar Doje = require(&apos;./models/Doje&apos;);\nvar example = async () =&gt; {\n  var myAsync = new MyAsync();\n  var doje = await Doje.findOne({ name: &apos;Doje&apos;, noises: [] }).save();\n  var cleanParams = [];\n\n  // FOR EACH EXAMPLE\n  await myAsync.each([&apos;bork&apos;, &apos;concern&apos;, &apos;heck&apos;], \n    async (elem) =&gt; {\n      if (elem !== &apos;heck&apos;) {\n        await doje.update({ $push: { &apos;noises&apos;: elem }});\n      }\n    });\n\n  var cat = await Cat.findOne({ name: &apos;Nyan&apos; });\n\n  // REDUCE EXAMPLE\n  var friendsOfNyanCat = await myAsync.reduce(cat.friends,\n    async (catArray, friendId) =&gt; {\n      var friend = await Friend.findById(friendId);\n      if (friend.name !== &apos;Long cat&apos;) {\n        catArray.push(friend.name);\n      }\n    }, []);\n  // Assuming Long Cat was a friend of Nyan Cat...\n  assert(friendsOfNyanCat.length === (cat.friends.length - 1));\n}\n\n    ","url":"/questions/[slug]#solution12","@type":"Answer","upvoteCount":0},{"text":"Bergi&apos;s solution works nicely when fs is promise based.\nYou can use bluebird, fs-extra or fs-promise for this.\n\nHowever, solution for node&apos;s native fs libary is as follows:\n\nconst result = await Promise.all(filePaths\n    .map( async filePath =&gt; {\n      const fileContents = await getAssetFromCache(filePath, async function() {\n\n        // 1. Wrap with Promise    \n        // 2. Return the result of the Promise\n        return await new Promise((res, rej) =&gt; {\n          fs.readFile(filePath, &apos;utf8&apos;, function(err, data) {\n            if (data) {\n              res(data);\n            }\n          });\n        });\n      });\n\n      return fileContents;\n    }));\n\n\nNote:\nrequire(&apos;fs&apos;) compulsorily takes function as 3rd arguments, otherwise throws error:\n\nTypeError [ERR_INVALID_CALLBACK]: Callback must be a function\n\n    ","url":"/questions/[slug]#solution13","@type":"Answer","upvoteCount":0},{"text":"It is not good to call an asynchronous method from a loop. This is because each loop iteration will be delayed until the entire asynchronous operation completes. That is not very performant. It also averts the advantages of parallelization benefits of async/await.\nA better solution would be to create all promises at once, then get access to the results using Promise.all(). Otherwise, each successive operation will not start until the previous one has completed.\nConsequently, the code may be refactored as follows;\nconst printFiles = async () =&gt; {\n  const files = await getFilePaths();\n  const results = [];\n  files.forEach((file) =&gt; {\n    results.push(fs.readFile(file, &apos;utf8&apos;));\n  });\n  const contents = await Promise.all(results);\n  console.log(contents);\n}\n\n    ","url":"/questions/[slug]#solution14","@type":"Answer","upvoteCount":0},{"text":"One important caveat is: The await + for .. of method and the forEach + async way actually have different effect. \n\nHaving await inside a real for loop will make sure all async calls are executed one by one. And the forEach + async way will fire off all promises at the same time, which is faster but sometimes overwhelmed(if you do some DB query or visit some web services with volume restrictions and do not want to fire 100,000 calls at a time). \n\nYou can also use reduce + promise(less elegant) if you do not use async/await and want to make sure files are read one after another. \n\nfiles.reduce((lastPromise, file) =&gt; \n lastPromise.then(() =&gt; \n   fs.readFile(file, &apos;utf8&apos;)\n ), Promise.resolve()\n)\n\n\nOr you can create a forEachAsync to help but basically use the same for loop underlying.\n\nArray.prototype.forEachAsync = async function(cb){\n    for(let x of this){\n        await cb(x);\n    }\n}\n\n    ","url":"/questions/[slug]#solution15","@type":"Answer","upvoteCount":0},{"text":"Both the solutions above work, however, Antonio&apos;s does the job with less code, here is how it helped me resolve data from my database, from several different child refs and then pushing them all into an array and resolving it in a promise after all is done:\n\nPromise.all(PacksList.map((pack)=&gt;{\n    return fireBaseRef.child(pack.folderPath).once(&apos;value&apos;,(snap)=&gt;{\n        snap.forEach( childSnap =&gt; {\n            const file = childSnap.val()\n            file.id = childSnap.key;\n            allItems.push( file )\n        })\n    })\n})).then(()=&gt;store.dispatch( actions.allMockupItems(allItems)))\n\n    ","url":"/questions/[slug]#solution16","@type":"Answer","upvoteCount":0},{"text":"Just adding to the original answer\n\n\nThe parallel reading syntax in the original answer is sometimes confusing and difficult to read, maybe we can write it in a different approach\n\n\nasync function printFiles() {\n  const files = await getFilePaths();\n  const fileReadPromises = [];\n\n  const readAndLogFile = async filePath =&gt; {\n    const contents = await fs.readFile(file, &quot;utf8&quot;);\n    console.log(contents);\n    return contents;\n  };\n\n  files.forEach(file =&gt; {\n    fileReadPromises.push(readAndLogFile(file));\n  });\n\n  await Promise.all(fileReadPromises);\n}\n\n\n\n\nFor sequential operation, not just for...of, normal for loop will also work\n\n\nasync function printFiles() {\n  const files = await getFilePaths();\n\n  for (let i = 0; i &lt; files.length; i++) {\n    const file = files[i];\n    const contents = await fs.readFile(file, &quot;utf8&quot;);\n    console.log(contents);\n  }\n}\n\n\n    ","url":"/questions/[slug]#solution17","@type":"Answer","upvoteCount":0},{"text":"Like @Bergi&apos;s response, but with one difference.\n\nPromise.all rejects all promises if one gets rejected.\n\nSo, use a recursion.\n\nconst readFilesQueue = async (files, index = 0) {\n    const contents = await fs.readFile(files[index], &apos;utf8&apos;)\n    console.log(contents)\n\n    return files.length &lt;= index\n        ? readFilesQueue(files, ++index)\n        : files\n\n}\n\nconst printFiles async = () =&gt; {\n    const files = await getFilePaths();\n    const printContents = await readFilesQueue(files)\n\n    return printContents\n}\n\nprintFiles()\n\n\nPS\n\nreadFilesQueue is outside of printFiles cause the side effect* introduced by console.log, it&apos;s better to mock, test, and or spy so, it&apos;s not cool to have a function that returns the content(sidenote).\n\nTherefore, the code can simply be designed by that: three separated functions that are &quot;pure&quot;** and introduce no side effects, process the entire list and can easily be modified to handle failed cases.\n\nconst files = await getFilesPath()\n\nconst printFile = async (file) =&gt; {\n    const content = await fs.readFile(file, &apos;utf8&apos;)\n    console.log(content)\n}\n\nconst readFiles = async = (files, index = 0) =&gt; {\n    await printFile(files[index])\n\n    return files.lengh &lt;= index\n        ? readFiles(files, ++index)\n        : files\n}\n\nreadFiles(files)\n\n\nFuture edit/current state\n\nNode supports top-level await (this doesn&apos;t have a plugin yet, won&apos;t have and can be enabled via harmony flags), it&apos;s cool but doesn&apos;t solve one problem (strategically I work only on LTS versions). How to get the files?\n\nUsing composition. Given the code, causes to me a sensation that this is inside a module, so, should have a function to do it. If not, you should use an IIFE to wrap the role code into an async function creating simple module that&apos;s do all for you, or you can go with the right way, there is, composition.\n\n// more complex version with IIFE to a single module\n(async (files) =&gt; readFiles(await files())(getFilesPath)\n\n\nNote that the name of variable changes due to semantics. You pass a functor (a function that can be invoked by another function) and recieves a pointer on memory that contains the initial block of logic of the application.\n\nBut, if&apos;s not a module and you need to export the logic?\n\nWrap the functions in a async function.\n\nexport const readFilesQueue = async () =&gt; {\n    // ... to code goes here\n}\n\n\nOr change the names of variables, whatever...\n\n\n\n* by side effect menans any colacteral effect of application  that can change the statate/behaviour or introuce bugs in the application, like IO.\n\n** by &quot;pure&quot;, it&apos;s in apostrophe since the functions it&apos;s not pure and the code can be converged to a pure version, when there&apos;s no console output, only data manipulations.\n\nAside this, to be pure, you&apos;ll need to work with monads that handles the side effect, that are error prone, and treats that error separately of the application. \n    ","url":"/questions/[slug]#solution18","@type":"Answer","upvoteCount":0},{"text":"Today I came across multiple solutions for this. Running the async await functions in the forEach Loop. By building the wrapper around we can make this happen.\n\nMore detailed explanation on how it works internally, for the native forEach and why it is not able to make a async function call and other details on the various methods are provided in link here\n\nThe multiple ways through which it can be done and they are as follows,\n\nMethod 1 : Using the wrapper.\n\nawait (()=&gt;{\n     return new Promise((resolve,reject)=&gt;{\n       items.forEach(async (item,index)=&gt;{\n           try{\n               await someAPICall();\n           } catch(e) {\n              console.log(e)\n           }\n           count++;\n           if(index === items.length-1){\n             resolve(&apos;Done&apos;)\n           }\n         });\n     });\n    })();\n\n\nMethod 2: Using the same as a generic function of Array.prototype\n\nArray.prototype.forEachAsync.js\n\nif(!Array.prototype.forEachAsync) {\n    Array.prototype.forEachAsync = function (fn){\n      return new Promise((resolve,reject)=&gt;{\n        this.forEach(async(item,index,array)=&gt;{\n            await fn(item,index,array);\n            if(index === array.length-1){\n                resolve(&apos;done&apos;);\n            }\n        })\n      });\n    };\n  }\n\n\nUsage : \n\nrequire(&apos;./Array.prototype.forEachAsync&apos;);\n\nlet count = 0;\n\nlet hello = async (items) =&gt; {\n\n// Method 1 - Using the Array.prototype.forEach \n\n    await items.forEachAsync(async () =&gt; {\n         try{\n               await someAPICall();\n           } catch(e) {\n              console.log(e)\n           }\n        count++;\n    });\n\n    console.log(&quot;count = &quot; + count);\n}\n\nsomeAPICall = () =&gt; {\n    return new Promise((resolve, reject) =&gt; {\n        setTimeout(() =&gt; {\n            resolve(&quot;done&quot;) // or reject(&apos;error&apos;)\n        }, 100);\n    })\n}\n\nhello([&apos;&apos;, &apos;&apos;, &apos;&apos;, &apos;&apos;]); // hello([]) empty array is also be handled by default\n\n\nMethod 3 :\n\nUsing Promise.all\n\n  await Promise.all(items.map(async (item) =&gt; {\n        await someAPICall();\n        count++;\n    }));\n\n    console.log(&quot;count = &quot; + count);\n\n\nMethod 4 : Traditional for loop or modern for loop\n\n// Method 4 - using for loop directly\n\n// 1. Using the modern for(.. in..) loop\n   for(item in items){\n\n        await someAPICall();\n        count++;\n    }\n\n//2. Using the traditional for loop \n\n    for(let i=0;i&lt;items.length;i++){\n\n        await someAPICall();\n        count++;\n    }\n\n\n    console.log(&quot;count = &quot; + count);\n\n    ","url":"/questions/[slug]#solution19","@type":"Answer","upvoteCount":0},{"text":"You can use Array.prototype.forEach, but async/await is not so compatible. This is because the promise returned from an async callback expects to be resolved, but Array.prototype.forEach does not resolve any promises from the execution of its callback. So then, you can use forEach, but you&apos;ll have to handle the promise resolution yourself.\n\nHere is a way to read and print each file in series using Array.prototype.forEach\n\nasync function printFilesInSeries () {\n  const files = await getFilePaths()\n\n  let promiseChain = Promise.resolve()\n  files.forEach((file) =&gt; {\n    promiseChain = promiseChain.then(() =&gt; {\n      fs.readFile(file, &apos;utf8&apos;).then((contents) =&gt; {\n        console.log(contents)\n      })\n    })\n  })\n  await promiseChain\n}\n\n\nHere is a way (still using Array.prototype.forEach) to print the contents of files in parallel\n\nasync function printFilesInParallel () {\n  const files = await getFilePaths()\n\n  const promises = []\n  files.forEach((file) =&gt; {\n    promises.push(\n      fs.readFile(file, &apos;utf8&apos;).then((contents) =&gt; {\n        console.log(contents)\n      })\n    )\n  })\n  await Promise.all(promises)\n}\n\n    ","url":"/questions/[slug]#solution20","@type":"Answer","upvoteCount":0},{"text":"Currently the Array.forEach prototype property doesn&apos;t support async operations, but we can create our own poly-fill to meet our needs.\n\n// Example of asyncForEach Array poly-fill for NodeJs\n// file: asyncForEach.js\n// Define asynForEach function \nasync function asyncForEach(iteratorFunction){\n  let indexer = 0\n  for(let data of this){\n    await iteratorFunction(data, indexer)\n    indexer++\n  }\n}\n// Append it as an Array prototype property\nArray.prototype.asyncForEach = asyncForEach\nmodule.exports = {Array}\n\n\nAnd that&apos;s it! You now have an async forEach method available on any arrays that are defined after these to operations.\n\nLet&apos;s test it...\n\n// Nodejs style\n// file: someOtherFile.js\n\nconst readline = require(&apos;readline&apos;)\nArray = require(&apos;./asyncForEach&apos;).Array\nconst log = console.log\n\n// Create a stream interface\nfunction createReader(options={prompt: &apos;&gt;&apos;}){\n  return readline.createInterface({\n    input: process.stdin\n    ,output: process.stdout\n    ,prompt: options.prompt !== undefined ? options.prompt : &apos;&gt;&apos;\n  })\n}\n// Create a cli stream reader\nasync function getUserIn(question, options={prompt:&apos;&gt;&apos;}){\n  log(question)\n  let reader = createReader(options)\n  return new Promise((res)=&gt;{\n    reader.on(&apos;line&apos;, (answer)=&gt;{\n      process.stdout.cursorTo(0, 0)\n      process.stdout.clearScreenDown()\n      reader.close()\n      res(answer)\n    })\n  })\n}\n\nlet questions = [\n  `What&apos;s your name`\n  ,`What&apos;s your favorite programming language`\n  ,`What&apos;s your favorite async function`\n]\nlet responses = {}\n\nasync function getResponses(){\n// Notice we have to prepend await before calling the async Array function\n// in order for it to function as expected\n  await questions.asyncForEach(async function(question, index){\n    let answer = await getUserIn(question)\n    responses[question] = answer\n  })\n}\n\nasync function main(){\n  await getResponses()\n  log(responses)\n}\nmain()\n// Should prompt user for an answer to each question and then \n// log each question and answer as an object to the terminal\n\n\nWe could do the same for some of the other array functions like map...\n\nasync function asyncMap(iteratorFunction){\n  let newMap = []\n  let indexer = 0\n  for(let data of this){\n    newMap[indexer] = await iteratorFunction(data, indexer, this)\n    indexer++\n  }\n  return newMap\n}\n\nArray.prototype.asyncMap = asyncMap\n\n\n... and so on :)\n\nSome things to note:\n\n\nYour iteratorFunction must be an async function or promise\nAny arrays created before Array.prototype.&lt;yourAsyncFunc&gt; = &lt;yourAsyncFunc&gt; will not have this feature available\n\n    ","url":"/questions/[slug]#solution21","@type":"Answer","upvoteCount":0},{"text":"To see how that can go wrong, print console.log at the end of the method.\n\nThings that can go wrong in general:\n\n\nArbitrary order.\nprintFiles can finish running before printing files.\nPoor performance.\n\n\nThese are not always wrong but frequently are in standard use cases.\n\nGenerally, using forEach will result in all but the last. It&apos;ll call each function without awaiting for the function meaning it tells all of the functions to start then finishes without waiting for the functions to finish.\n\nimport fs from &apos;fs-promise&apos;\n\nasync function printFiles () {\n  const files = (await getFilePaths()).map(file =&gt; fs.readFile(file, &apos;utf8&apos;))\n\n  for(const file of files)\n    console.log(await file)\n}\n\nprintFiles()\n\n\nThis is an example in native JS that will preserve order, prevent the function from returning prematurely and in theory retain optimal performance.\n\nThis will:\n\n\nInitiate all of the file reads to happen in parallel.\nPreserve the order via the use of map to map file names to promises to wait for.\nWait for each promise in the order defined by the array.\n\n\nWith this solution the first file will be shown as soon as it is available without having to wait for the others to be available first.\n\nIt will also be loading all files at the same time rather than having to wait for the first to finish before the second file read can be started.\n\nThe only draw back of this and the original version is that if multiple reads are started at once then it&apos;s more difficult to handle errors on account of having more errors that can happen at a time.\n\nWith versions that read a file at a time then then will stop on a failure without wasting time trying to read any more files. Even with an elaborate cancellation system it can be hard to avoid it failing on the first file but reading most of the other files already as well.\n\nPerformance is not always predictable. While many systems will be faster with parallel file reads some will prefer sequential. Some are dynamic and may shift under load, optimisations that offer latency do not always yield good throughput under heavy contention.\n\nThere is also no error handling in that example. If something requires them to either all be successfully shown or not at all it won&apos;t do that.\n\nIn depth experimentation is recommended with console.log at each stage and fake file read solutions (random delay instead). Although many solutions appear to do the same in simple cases all have subtle differences that take some extra scrutiny to squeeze out.\n\nUse this mock to help tell the difference between solutions:\n\n(async () =&gt; {\n  const start = +new Date();\n  const mock = () =&gt; {\n    return {\n      fs: {readFile: file =&gt; new Promise((resolve, reject) =&gt; {\n        // Instead of this just make three files and try each timing arrangement.\n        // IE, all same, [100, 200, 300], [300, 200, 100], [100, 300, 200], etc.\n        const time = Math.round(100 + Math.random() * 4900);\n        console.log(`Read of ${file} started at ${new Date() - start} and will take ${time}ms.`)\n        setTimeout(() =&gt; {\n          // Bonus material here if random reject instead.\n          console.log(`Read of ${file} finished, resolving promise at ${new Date() - start}.`);\n          resolve(file);\n        }, time);\n      })},\n      console: {log: file =&gt; console.log(`Console Log of ${file} finished at ${new Date() - start}.`)},\n      getFilePaths: () =&gt; [&apos;A&apos;, &apos;B&apos;, &apos;C&apos;, &apos;D&apos;, &apos;E&apos;]\n    };\n  };\n\n  const printFiles = (({fs, console, getFilePaths}) =&gt; {\n    return async function() {\n      const files = (await getFilePaths()).map(file =&gt; fs.readFile(file, &apos;utf8&apos;));\n\n      for(const file of files)\n        console.log(await file);\n    };\n  })(mock());\n\n  console.log(`Running at ${new Date() - start}`);\n  await printFiles();\n  console.log(`Finished running at ${new Date() - start}`);\n})();\n\n\n    ","url":"/questions/[slug]#solution22","@type":"Answer","upvoteCount":0},{"text":"Using Task, futurize, and a traversable List, you can simply do\n\nasync function printFiles() {\n  const files = await getFiles();\n\n  List(files).traverse( Task.of, f =&gt; readFile( f, &apos;utf-8&apos;))\n    .fork( console.error, console.log)\n}\n\n\nHere is how you&apos;d set this up\n\nimport fs from &apos;fs&apos;;\nimport { futurize } from &apos;futurize&apos;;\nimport Task from &apos;data.task&apos;;\nimport { List } from &apos;immutable-ext&apos;;\n\nconst future = futurizeP(Task)\nconst readFile = future(fs.readFile)\n\n\nAnother way to have structured the desired code would be\n\nconst printFiles = files =&gt; \n  List(files).traverse( Task.of, fn =&gt; readFile( fn, &apos;utf-8&apos;))\n    .fork( console.error, console.log)\n\n\nOr perhaps even more functionally oriented\n\n// 90% of encodings are utf-8, making that use case super easy is prudent\n\n// handy-library.js\nexport const readFile = f =&gt;\n  future(fs.readFile)( f, &apos;utf-8&apos; )\n\nexport const arrayToTaskList = list =&gt; taskFn =&gt; \n  List(files).traverse( Task.of, taskFn ) \n\nexport const readFiles = files =&gt;\n  arrayToTaskList( files, readFile )\n\nexport const printFiles = files =&gt; \n  readFiles(files).fork( console.error, console.log)\n\n\nThen from the parent function\n\nasync function main() {\n  /* awesome code with side-effects before */\n  printFiles( await getFiles() );\n  /* awesome code with side-effects after */\n}\n\n\nIf you really wanted more flexibility in encoding, you could just do this (for fun, I&apos;m using the proposed Pipe Forward operator )\n\nimport { curry, flip } from &apos;ramda&apos;\n\nexport const readFile = fs.readFile \n  |&gt; future,\n  |&gt; curry,\n  |&gt; flip\n\nexport const readFileUtf8 = readFile(&apos;utf-8&apos;)\n\n\nPS - I didn&apos;t try this code on the console, might have some typos... &quot;straight freestyle, off the top of the dome!&quot; as the 90s kids would say. :-p\n    ","url":"/questions/[slug]#solution23","@type":"Answer","upvoteCount":0},{"text":"Here is a great example for using async in forEach loop.\nWrite your own asyncForEach\nasync function asyncForEach(array, callback) {  \n    for (let index = 0; index &lt; array.length; index++) {\n        await callback(array[index], index, array)\n    }\n}\n\nYou can use it like this\nawait asyncForEach(array, async function(item,index,array){\n     //await here\n   }\n)\n\n    ","url":"/questions/[slug]#solution24","@type":"Answer","upvoteCount":0},{"text":"The OP&apos;s orignal question\n\nAre there any issues with using async/await in a forEach loop? ...\n\nwas covered to an extent in @Bergi&apos;s selected answer,\nwhich showed how to process in serial and in parallel.  However there are other issues noted with parallelism -\n\nOrder -- @chharvey notes that -\n\n\nFor example if a really small file finishes reading before a really large file, it will be logged first, even if the small file comes after the large file in the files array.\n\n\nPossibly opening too many files at once -- A comment by Bergi under another answer\n\n\nIt is also not good to open thousands of files at once to read them concurrently. One always has to do an assessment whether a sequential, parallel, or mixed approach is better.\n\nSo let&apos;s address these issues showing actual code that is brief and concise, and does not use third party libraries.  Something easily cut, paste, and modifiable.\nReading in parallel (all at once), printing in serial (as early as possible per file).\nThe easiest improvement is perform full parallelism as in @Bergi&apos;s answer, but make a small change so that each file is printed as soon as possible while preserving order.\nasync function printFiles2() {\n  const readProms = (await getFilePaths()).map((file) =&gt;\n    fs.readFile(file, &quot;utf8&quot;)\n  );\n  await Promise.all([\n    await Promise.all(readProms),                      // branch 1\n    (async () =&gt; {                                     // branch 2\n      for (const p of readProms) console.log(await p);\n    })(),\n  ]);\n}\n\nAbove, two seperate branches are run concurrently.\n\nbranch 1: Reading in parallel, all at once,\nbranch 2: Reading in serial to force order, but waiting no longer than necessary\n\nThat was easy.\nReading in parallel with a concurrency limit, printing in serial (as early as possible per file).\nA &quot;concurrecy limit&quot; means that no more than N files will ever being read at the same time.\nLike a store that only allows in so many customers at a time (at least during COVID).\nFirst a helper function is introduced -\nfunction bootablePromise(kickMe: () =&gt; Promise&lt;any&gt;) {\n  let resolve: (value: unknown) =&gt; void = () =&gt; {};\n  const promise = new Promise((res) =&gt; { resolve = res; });\n  const boot = () =&gt; { resolve(kickMe()); };\n  return { promise, boot };\n}\n\nThe funciton bootablePromise(kickMe:() =&gt; Promise&lt;any&gt;) takes an\nfunction kickMe as an argumment to start a task (in our case readFile).  But it is not started immediately.\nbootablePromise returns a couple of properties\n\npromise of type Promise\nboot of type function ()=&gt;void\n\npromise has two stages in life\n\nBeing a promise to start a task\nBeing a promise complete a task it has already started.\n\npromise transitions from the first to the second state when boot() is called.\nbootablePromise is used in printFiles --\nasync function printFiles4() {\n  const files = await getFilePaths();\n  const boots: (() =&gt; void)[] = [];\n  const set: Set&lt;Promise&lt;{ pidx: number }&gt;&gt; = new Set&lt;Promise&lt;any&gt;&gt;();\n  const bootableProms = files.map((file,pidx) =&gt; {\n    const { promise, boot } = bootablePromise(() =&gt; fs.readFile(file, &quot;utf8&quot;));\n    boots.push(boot);\n    set.add(promise.then(() =&gt; ({ pidx })));\n    return promise;\n  });\n  const concurLimit = 2;\n  await Promise.all([\n    (async () =&gt; {                                       // branch 1\n      let idx = 0;\n      boots.slice(0, concurLimit).forEach((b) =&gt; { b(); idx++; });\n      while (idx&lt;boots.length) {\n        const { pidx } = await Promise.race([...set]);\n        set.delete([...set][pidx]);\n        boots[idx++]();\n      }\n    })(),\n    (async () =&gt; {                                       // branch 2\n      for (const p of bootableProms) console.log(await p);\n    })(),\n  ]);\n}\n\nAs before there are two branches\n\nbranch 1:   For running and handling concurrecy.\nbranch 2:   For printing\n\nThe difference now is the never more than concurLimit promises are allowed to run concurrently.\nThe important variables are\n\nboots: The array of functions to call to force it&apos;s corresponding promise to transition. It is used only in branch 1.\nset: There are promises in a random acces container so that they can be easily removed once fulfilled.  This contianer is used only in branch 1.\nbootableProms:  These are the smae promises as initally in set, but it is an array not a set, and the array is never changed.  It is used only in branch 2.\n\nRunning with a mock fs.readFile that takes times as follows (filename vs. time in ms).\nconst timeTable = {\n  &quot;1&quot;: 600,\n  &quot;2&quot;: 500,\n  &quot;3&quot;: 400,\n  &quot;4&quot;: 300,\n  &quot;5&quot;: 200,\n  &quot;6&quot;: 100,\n};\n\ntest run times such as this are seen, showing the concurrency is working --\n[1]0--0.601\n[2]0--0.502\n[3]0.503--0.904\n[4]0.608--0.908\n[5]0.905--1.105\n[6]0.905--1.005\n\nAvailable as executable in the typescript playground sandbox\n    ","url":"/questions/[slug]#solution25","@type":"Answer","upvoteCount":0},{"text":"As other answers have mentioned, you&apos;re probably wanting it to be executed in sequence rather in parallel. Ie. run for first file, wait until it&apos;s done, then once it&apos;s done run for second file. That&apos;s not what will happen.\nI think it&apos;s important to address why this doesn&apos;t happen.\nThink about how forEach works. I can&apos;t find the source, but I presume it works something like this:\nconst forEach = (arr, cb) =&gt; {\n  for (let i = 0; i &lt; arr.length; i++) {\n    cb(arr[i]);\n  }\n};\n\nNow think about what happens when you do something like this:\nforEach(files, async logFile(file) {\n  const contents = await fs.readFile(file, &apos;utf8&apos;);\n  console.log(contents);\n});\n\nInside forEach&apos;s for loop we&apos;re calling cb(arr[i]), which ends up being logFile(file). The logFile function has an await inside it, so maybe the for loop will wait for this await before proceeding to i++?\nNo, it won&apos;t. Confusingly, that&apos;s not how await works. From the docs:\n\nAn await splits execution flow, allowing the caller of the async function to resume execution. After the await defers the continuation of the async function, execution of subsequent statements ensues. If this await is the last expression executed by its function execution continues by returning to the function&apos;s caller a pending Promise for completion of the await&apos;s function and resuming execution of that caller.\n\nSo if you have the following, the numbers won&apos;t be logged before &quot;b&quot;:\nconst delay = (ms) =&gt; {\n  return new Promise((resolve) =&gt; {\n    setTimeout(resolve, ms);\n  });\n};\n\nconst logNumbers = async () =&gt; {\n  console.log(1);\n  await delay(2000);\n  console.log(2);\n  await delay(2000);\n  console.log(3);\n};\n\nconst main = () =&gt; {\n  console.log(&quot;a&quot;);\n  logNumbers();\n  console.log(&quot;b&quot;);\n};\n\nmain();\n\nCircling back to forEach, forEach is like main and logFile is like logNumbers. main won&apos;t stop just because logNumbers does some awaiting, and forEach won&apos;t stop just because logFile does some awaiting.\n    ","url":"/questions/[slug]#solution26","@type":"Answer","upvoteCount":0},{"text":"Similar to Antonio Val&apos;s p-iteration, an alternative npm module is async-af:\n\nconst AsyncAF = require(&apos;async-af&apos;);\nconst fs = require(&apos;fs-promise&apos;);\n\nfunction printFiles() {\n  // since AsyncAF accepts promises or non-promises, there&apos;s no need to await here\n  const files = getFilePaths();\n\n  AsyncAF(files).forEach(async file =&gt; {\n    const contents = await fs.readFile(file, &apos;utf8&apos;);\n    console.log(contents);\n  });\n}\n\nprintFiles();\n\n\nAlternatively, async-af has a static method (log/logAF) that logs the results of promises:\n\nconst AsyncAF = require(&apos;async-af&apos;);\nconst fs = require(&apos;fs-promise&apos;);\n\nfunction printFiles() {\n  const files = getFilePaths();\n\n  AsyncAF(files).forEach(file =&gt; {\n    AsyncAF.log(fs.readFile(file, &apos;utf8&apos;));\n  });\n}\n\nprintFiles();\n\n\nHowever, the main advantage of the library is that you can chain asynchronous methods to do something like:\n\nconst aaf = require(&apos;async-af&apos;);\nconst fs = require(&apos;fs-promise&apos;);\n\nconst printFiles = () =&gt; aaf(getFilePaths())\n  .map(file =&gt; fs.readFile(file, &apos;utf8&apos;))\n  .forEach(file =&gt; aaf.log(file));\n\nprintFiles();\n\n\nasync-af\n    ","url":"/questions/[slug]#solution27","@type":"Answer","upvoteCount":0},{"text":"In 2022 I would still advise using external libraries to handle all this async flow.  I&apos;ve created the module alot for similar things.\nYour example would be:\nimport fs from &apos;fs-promise&apos;\nimport alot from &apos;alot&apos;\n\nasync function printFiles () {\n    const files = await getFilePaths() // Assume this works fine\n\n    await alot(files)\n        .forEachAsync(async file =&gt; {\n            let content = await fs.readFile(file, &apos;utf8&apos;);\n            console.log(content);\n        })\n        .toArrayAsync({ threads: 4 });\n    }\n}\nprintFiles()\n\nFor simple examples surely the async for..of would do the job, but as soon the task is more complicated you have to use some utility for this.\nAlot has dozens of other methods that you can chain, like mapAsync, filterAsync, groupAsync, etc.\nAs an example:\n\nLoad JSON files with products meta\nExtract ProductID\nLoad products from the server\nFilter those with a price &gt; 100$\nOrder by price ascending\nTake top 50\n\n\nimport fs from &apos;fs-promise&apos;\nimport alot from &apos;alot&apos;\nimport axios from &apos;axios&apos;\nimport { File } from &apos;atma-io&apos;\n\nlet paths = await getFilePaths();\nlet products = await alot(paths)\n    .mapAsync(async path =&gt; await File.readAsync&lt;IProductMeta&gt;(path))\n    .mapAsync(async meta =&gt; await axios.get(`${server}/api/product/${meta.productId}`))\n    .mapAsync(resp =&gt; resp.data)\n    .filterAsync(product =&gt; product.price &gt; 100)\n    .sortBy(product =&gt; product.price, &apos;asc&apos;)\n    .takeAsync(50)\n    .toArrayAsync({ threads: 5, errors: &apos;include&apos; });\n\n    ","url":"/questions/[slug]#solution28","@type":"Answer","upvoteCount":0},{"text":"If you&apos;d like to iterate over all elements concurrently:\nasync function asyncForEach(arr, fn) {\n  await Promise.all(arr.map(fn));\n}\n\nIf you&apos;d like to iterate over all elements non-concurrently (e.g. when your mapping function has side effects or running mapper over all array elements at once would be too resource costly):\nOption A: Promises\nfunction asyncForEachStrict(arr, fn) {\n  return new Promise((resolve) =&gt; {\n    arr.reduce(\n      (promise, cur, idx) =&gt; promise\n        .then(() =&gt; fn(cur, idx, arr)),\n      Promise.resolve(),\n    ).then(() =&gt; resolve());\n  });\n}\n\nOption B: async/await\nasync function asyncForEachStrict(arr, fn) {\n  for (let idx = 0; idx &lt; arr.length; idx += 1) {\n    const cur = arr[idx];\n\n    await fn(cur, idx, arr);\n  }\n}\n\n    ","url":"/questions/[slug]#solution29","@type":"Answer","upvoteCount":0},{"text":"If you can&apos;t use async/await (IE11, old packer, etc.) then you can try this recursive function. I used fetch as my asynchronous call, but you could use any function that returns a promise.\nvar urlsToGet = [&apos;https://google.com&apos;, &apos;https://yahoo.com&apos;];\n\nfetchOneAtATime(urlsToGet);\n\nfunction fetchOneAtATime(urls) {\n    if (urls.length === 0) {\n        return;\n    }\n    fetch(urls[0]).finally(() =&gt; fetchOneAtATime(urls.slice(1)));\n}\n\n    ","url":"/questions/[slug]#solution30","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/08bcc42a26fe5c92.css" as="style"/><link rel="stylesheet" href="/_next/static/css/08bcc42a26fe5c92.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-08d1a634dea6705e.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/150-12e9794e898cd5f3.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/108-87de33c23337ff53.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-928c5d1eb8fb0bba.js" defer=""></script><script src="/_next/static/BnkbnjkWYxefPXjTJLVVv/_buildManifest.js" defer=""></script><script src="/_next/static/BnkbnjkWYxefPXjTJLVVv/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h4 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h4></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/using-asyncawait-with-a-foreach-loop-1657384512667#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/using-asyncawait-with-a-foreach-loop-1657384512667"><h1>Using async/await with a forEach loop</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div><div class="question-content mt-5">
                
<p>Are there any issues with using <code>async</code>/<code>await</code> in a <code>forEach</code> loop? I'm trying to loop through an array of files and <code>await</code> on the contents of each file.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs-promise'</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span> () {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>() <span class="hljs-comment">// Assume this works fine</span>

  files.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">async</span> (file) =&gt; {
    <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents)
  })
}

<span class="hljs-title function_">printFiles</span>()
</code></pre>
<p>This code does work, but could something go wrong with this? I had someone tell me that you're not supposed to use <code>async</code>/<code>await</code> in a higher-order function like this, so I just wanted to ask if there was any issue with this.</p>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li><li class="pagination-solution-item"><span data-id="#solution3" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">3</span></li><li class="pagination-solution-item"><span data-id="#solution4" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">4</span></li><li class="pagination-solution-item"><span data-id="#solution5" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">5</span></li><li class="pagination-solution-item"><span data-id="#solution6" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">6</span></li><li class="pagination-solution-item"><span data-id="#solution7" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">7</span></li><li class="pagination-solution-item"><span data-id="#solution8" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">8</span></li><li class="pagination-solution-item"><span data-id="#solution9" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">9</span></li><li class="pagination-solution-item"><span data-id="#solution10" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">10</span></li><li class="pagination-solution-item"><span data-id="#solution11" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">11</span></li><li class="pagination-solution-item"><span data-id="#solution12" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">12</span></li><li class="pagination-solution-item"><span data-id="#solution13" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">13</span></li><li class="pagination-solution-item"><span data-id="#solution14" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">14</span></li><li class="pagination-solution-item"><span data-id="#solution15" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">15</span></li><li class="pagination-solution-item"><span data-id="#solution16" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">16</span></li><li class="pagination-solution-item"><span data-id="#solution17" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">17</span></li><li class="pagination-solution-item"><span data-id="#solution18" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">18</span></li><li class="pagination-solution-item"><span data-id="#solution19" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">19</span></li><li class="pagination-solution-item"><span data-id="#solution20" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">20</span></li><li class="pagination-solution-item"><span data-id="#solution21" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">21</span></li><li class="pagination-solution-item"><span data-id="#solution22" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">22</span></li><li class="pagination-solution-item"><span data-id="#solution23" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">23</span></li><li class="pagination-solution-item"><span data-id="#solution24" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">24</span></li><li class="pagination-solution-item"><span data-id="#solution25" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">25</span></li><li class="pagination-solution-item"><span data-id="#solution26" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">26</span></li><li class="pagination-solution-item"><span data-id="#solution27" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">27</span></li><li class="pagination-solution-item"><span data-id="#solution28" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">28</span></li><li class="pagination-solution-item"><span data-id="#solution29" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">29</span></li><li class="pagination-solution-item"><span data-id="#solution30" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">30</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Sure the code does work, but I'm pretty sure it doesn't do what you expect it to do. It just fires off multiple asynchronous calls, but the <code>printFiles</code> function does immediately return after that.</p>

<h3>Reading in sequence</h3>

<p>If you want to read the files in sequence, <strong>you cannot use <code>forEach</code></strong> indeed. Just use a modern <code>for  of</code> loop instead, in which <code>await</code> will work as expected:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span> () {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>();

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files) {
    <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents);
  }
}
</code></pre>

<h3>Reading in parallel</h3>

<p>If you want to read the files in parallel, <strong>you cannot use <code>forEach</code></strong> indeed. Each of the <code>async</code> callback function calls does return a promise, but you're throwing them away instead of awaiting them. Just use <code>map</code> instead, and you can await the array of promises that you'll get with <code>Promise.all</code>:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span> () {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>();

  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(files.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (file) =&gt; {
    <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents)
  }));
}
</code></pre>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>With ES2018, you are able to greatly simplify all of the above answers to:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span> () {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>()

  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> contents <span class="hljs-keyword">of</span> files.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>))) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents)
  }
}
</code></pre>
<p>See spec: <a href="https://github.com/tc39/proposal-async-iteration" rel="noreferrer">proposal-async-iteration</a></p>
<p><strong>Simplified:</strong></p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> results <span class="hljs-keyword">of</span> array) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">longRunningTask</span>()
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'I will wait'</span>)
</code></pre>
<hr>
<p>2018-09-10: This answer has been getting a lot of attention recently, please see <a href="http://2ality.com/2016/10/asynchronous-iteration.html" rel="noreferrer">Axel Rauschmayer's blog post</a> for further information about asynchronous iteration.</p>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">


<p>Instead of <code>Promise.all</code> in conjunction with <code>Array.prototype.map</code> (which does not guarantee the order in which the <code>Promise</code>s are resolved), I use <code>Array.prototype.reduce</code>, starting with a resolved <code>Promise</code>:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span> () {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>();

  <span class="hljs-keyword">await</span> files.<span class="hljs-title function_">reduce</span>(<span class="hljs-keyword">async</span> (promise, file) =&gt; {
    <span class="hljs-comment">// This line will wait for the last async function to finish.</span>
    <span class="hljs-comment">// The first iteration uses an already resolved Promise</span>
    <span class="hljs-comment">// so, it will immediately continue.</span>
    <span class="hljs-keyword">await</span> promise;
    <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents);
  }, <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>());
}
</code></pre>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The <a href="https://github.com/toniov/p-iteration" rel="noreferrer">p-iteration</a> module on npm implements the Array iteration methods so they can be used in a very straightforward way with async/await.</p>

<p>An example with your case:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> { forEach } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'p-iteration'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-promise'</span>);

(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span> () {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>();

  <span class="hljs-keyword">await</span> <span class="hljs-title function_">forEach</span>(files, <span class="hljs-keyword">async</span> (file) =&gt; {
    <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents);
  });
})();
</code></pre>
    </div></div></div></div><div id="solution5" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Here are some <code>forEachAsync</code> prototypes. Note you'll need to <code>await</code> them:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">forEachAsync</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> t <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>) { <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>(t) }
}

<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">forEachAsyncParallel</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) {
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">map</span>(fn));
}
</code></pre>

<p><strong>Note</strong> while you may include this in your own code, you should not include this in libraries you distribute to others (to avoid polluting their globals).</p>
    </div></div></div></div><div id="solution6" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<h2>Picture worth 1000 words - For Sequential Approach Only</h2>
<hr>
<p><strong>Background</strong> : I was in similar situation last night. I used async function as foreach argument. The result was un-predictable. When I did testing for my code 3 times, it ran without issues 2 times and failed 1 time. (something weird)</p>
<p>Finally I got my head around &amp; did some scratch pad testing.</p>
<h3>Scenario 1 - How un-sequential it can get with async in foreach</h3>
<p><a href="https://i.stack.imgur.com/VGXEa.png" rel="noreferrer"><img src="https://i.stack.imgur.com/VGXEa.png" alt="enter image description here"></a></p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getPromise</span> = (<span class="hljs-params">time</span>) =&gt; { 
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">`Promise resolved for <span class="hljs-subst">${time}</span>s`</span>)
    }, time)
  })
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">main</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> myPromiseArray = [<span class="hljs-title function_">getPromise</span>(<span class="hljs-number">1000</span>), <span class="hljs-title function_">getPromise</span>(<span class="hljs-number">500</span>), <span class="hljs-title function_">getPromise</span>(<span class="hljs-number">3000</span>)]
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Before For Each Loop'</span>)

  myPromiseArray.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">async</span> (element, index) =&gt; {
    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> element;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);
  })

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'After For Each Loop'</span>)
}

<span class="hljs-title function_">main</span>();
</code></pre>
<h3>Scenario 2 - Using <code>for - of</code> loop as @Bergi above suggested</h3>
<p><a href="https://i.stack.imgur.com/QWbRI.png" rel="noreferrer"><img src="https://i.stack.imgur.com/QWbRI.png" alt="enter image description here"></a></p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getPromise</span> = (<span class="hljs-params">time</span>) =&gt; { 
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">`Promise resolved for <span class="hljs-subst">${time}</span>s`</span>)
    }, time)
  })
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">main</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> myPromiseArray = [<span class="hljs-title function_">getPromise</span>(<span class="hljs-number">1000</span>), <span class="hljs-title function_">getPromise</span>(<span class="hljs-number">500</span>), <span class="hljs-title function_">getPromise</span>(<span class="hljs-number">3000</span>)]
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Before For Each Loop'</span>)

  <span class="hljs-comment">// AVOID USING THIS</span>
  <span class="hljs-comment">// myPromiseArray.forEach(async (element, index) =&gt; {</span>
  <span class="hljs-comment">//   let result = await element;</span>
  <span class="hljs-comment">//   console.log(result);</span>
  <span class="hljs-comment">// })</span>

  <span class="hljs-comment">// This works well</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> element <span class="hljs-keyword">of</span> myPromiseArray) {
    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> element;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result)
  }

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'After For Each Loop'</span>)
}

<span class="hljs-title function_">main</span>();
</code></pre>
<p>If you are little old school like me, you could simply use the classic for loop, that works too :)</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getPromise</span> = (<span class="hljs-params">time</span>) =&gt; { 
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">`Promise resolved for <span class="hljs-subst">${time}</span>s`</span>)
    }, time)
  })
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">main</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> myPromiseArray = [<span class="hljs-title function_">getPromise</span>(<span class="hljs-number">1000</span>), <span class="hljs-title function_">getPromise</span>(<span class="hljs-number">500</span>), <span class="hljs-title function_">getPromise</span>(<span class="hljs-number">3000</span>)]
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Before For Each Loop'</span>)

  <span class="hljs-comment">// AVOID USING THIS</span>
  <span class="hljs-comment">// myPromiseArray.forEach(async (element, index) =&gt; {</span>
  <span class="hljs-comment">//   let result = await element;</span>
  <span class="hljs-comment">//   console.log(result);</span>
  <span class="hljs-comment">// })</span>

  <span class="hljs-comment">// This works well too - the classic for loop :)</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; myPromiseArray.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> myPromiseArray[i];
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);
  }

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'After For Each Loop'</span>)
}

<span class="hljs-title function_">main</span>();
</code></pre>
<p>I hope this helps someone, good day, cheers!</p>
    </div></div></div></div><div id="solution7" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 7</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>@Bergi has already gave the answer on how to handle this particular case properly. I'll not duplicate here.</p>
<p>I'd like to address the difference between using <code>forEach</code> and <code>for</code> loop when it comes to <code>async</code> and <code>await</code></p>
<p><strong>how <code>forEach</code> works</strong></p>
<p>Let's look at how <code>forEach</code> works. According to <a href="https://tc39.es/ecma262/multipage/indexed-collections.html#sec-array.prototype.foreach" rel="noreferrer">ECMAScript Specification</a>, MDN provides an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach#polyfill" rel="noreferrer">implementation</a> which can be used as a polyfill. I copy it and paste here with comments removal.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">forEach</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">callback, thisArg</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span> == <span class="hljs-literal">null</span>) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Array.prototype.forEach called on null or undefined'</span>); }
  <span class="hljs-keyword">var</span> T, k;
  <span class="hljs-keyword">var</span> O = <span class="hljs-title class_">Object</span>(<span class="hljs-variable language_">this</span>);
  <span class="hljs-keyword">var</span> len = O.<span class="hljs-property">length</span> &gt;&gt;&gt; <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback !== <span class="hljs-string">"function"</span>) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(callback + <span class="hljs-string">' is not a function'</span>); }
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) { T = thisArg; }
  k = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (k &lt; len) {
    <span class="hljs-keyword">var</span> kValue;
    <span class="hljs-keyword">if</span> (k <span class="hljs-keyword">in</span> O) {
      kValue = O[k];
      callback.<span class="hljs-title function_">call</span>(T, kValue, k, O); <span class="hljs-comment">// pay attention to this line</span>
    }
    k++;
  }
};
</code></pre>
<p>Let's back to your code, let's extract the callback as a function.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">callback</span>(<span class="hljs-params">file</span>){
  <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents)
}
</code></pre>
<p>So, basically <code>callback</code> returns a promise since it's declared with <code>async</code>. Inside <code>forEach</code>, <code>callback</code> is just called in a normal way, if the callback itself returns a promise, the javascript engine will not wait it to be resolved or rejected. Instead, it puts the <code>promise</code> in a job queue, and continues executing the loop.</p>
<p><strong>How about <code>await fs.readFile(file, 'utf8')</code> inside the <code>callback</code>?</strong></p>
<p>Basically, when your async <code>callback</code> gets the chance to be executed, the js engine will pause until <code>fs.readFile(file, 'utf8')</code> to be resolved or rejected, and resume execution of the async function after fulfillment. So the <code>contents</code> variable store the actual result from <code>fs.readFile</code>, not a <code>promise</code>. So, <code>console.log(contents)</code> logs out the file content not a <code>Promise</code></p>
<p><strong>Why <code>for ... of</code> works?</strong></p>
<p>when we write a generic <code>for of</code> loop, we gain more control than <code>forEach</code>. Let's refactor <code>printFiles</code>.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span> () {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>() <span class="hljs-comment">// Assume this works fine</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files) {
    <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents)
    <span class="hljs-comment">// or await callback(file)</span>
  }
}
</code></pre>
<p>When evaluate <code>for</code> loop, we have <code>await</code> promise inside the <code>async</code> function, the execution will pause until the <code>await</code> promise is settled. So, you can think of that the files are read one by one in a determined order.</p>
<p><strong>Execute sequentially</strong></p>
<p>Sometimes, we really need the the async functions to be executed in a sequential order. For example, I have a few new records stored in an array to be saved to database, and I want them to be saved in sequential order which means first record in array should be saved first, then second, until last one is saved.</p>
<p>Here is an example:</p>
<p></p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
<div class="snippet-code">
<pre class="snippet-code-js lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> records = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">saveRecord</span>(<span class="hljs-params">record</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolved, rejected</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=&gt;</span> {
      <span class="hljs-title function_">resolved</span>(<span class="hljs-string">`record <span class="hljs-subst">${record}</span> saved`</span>)
    }, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">500</span>)
  });
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">forEachSaveRecords</span>(<span class="hljs-params">records</span>) {
  records.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">async</span> (record) =&gt; {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveRecord</span>(record);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
  })
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">forofSaveRecords</span>(<span class="hljs-params">records</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> record <span class="hljs-keyword">of</span> records) {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveRecord</span>(record);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
  }
}
(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== for of save records ==="</span>)
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">forofSaveRecords</span>(records)
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"=== forEach save records ==="</span>)
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">forEachSaveRecords</span>(records)
})()</code></pre>
<div class="snippet-result"><div class="snippet-ctas"><button type="button" class="s-btn s-btn__primary"><span class="icon-play-white _hover"></span><span> Run code snippet</span></button><input class="copySnippet s-btn s-btn__filled" type="button" value="Copy snippet to answer" style="display: none;"><button type="button" class="s-btn hideResults" style="display: none;">Hide results</button><div class="popout-code"><a class="snippet-expand-link">Expand snippet</a></div></div><div class="snippet-result-code" style="display: none;"><iframe name="sif1" sandbox="allow-forms allow-modals allow-scripts" class="snippet-box-edit snippet-box-result" frameborder="0"></iframe></div></div></div>
</div>
<p></p>
<p>I use <code>setTimeout</code> to simulate the process of saving a record to database - it's asynchronous and cost a random time. Using <code>forEach</code>, the records are saved in an undetermined order, but using <code>for..of</code>, they are saved sequentially.</p>
    </div></div></div></div><div id="solution8" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 8</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>This solution is also memory-optimized so you can run it on 10,000's of data items and requests. Some of the other solutions here will crash the server on large data sets.</p>
<p><strong>In TypeScript:</strong></p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> asyncForEach&lt;T&gt;(<span class="hljs-attr">array</span>: <span class="hljs-title class_">Array</span>&lt;T&gt;, <span class="hljs-attr">callback</span>: <span class="hljs-function">(<span class="hljs-params">item: T, index: number</span>) =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt;) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; array.<span class="hljs-property">length</span>; index++) {
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">callback</span>(array[index], index);
        }
    }
</code></pre>
<p><strong>How to use?</strong></p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">await</span> <span class="hljs-title function_">asyncForEach</span>(receipts, <span class="hljs-keyword">async</span> (eachItem) =&gt; {
    <span class="hljs-keyword">await</span> ...
})
</code></pre>
    </div></div></div></div><div id="solution9" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 9</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<blockquote>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">files.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">async</span> (file) =&gt; {
    <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>)
})
</code></pre>
</blockquote>
<p>The issue is, the promise returned by the iteration function is ignored by <code>forEach()</code>. As a result, all the <code>fs.readFile</code> functions
are invoked in the same round of the event loop, which means they are started in parallel, not in sequential, and the execution continues immediately after invoking forEach(), without
waiting for all the <code>fs.readFile</code> operations to complete. Since forEach does not wait for each promise to resolve, the loop actually finishes iterating before promises are resolved.  You may end up trying to access values that are not available yet.</p>
    </div></div></div></div><div id="solution10" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 10</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In addition to <a href="https://stackoverflow.com/a/37576787/877703">@Bergis answer</a>, Id like to offer a third alternative. It's very similar to @Bergis 2nd example, but instead of awaiting each <code>readFile</code> individually, you create an array of promises, each which you await at the end.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs-promise'</span>;
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span> () {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>();

  <span class="hljs-keyword">const</span> promises = files.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>))

  <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(promises)

  contents.<span class="hljs-title function_">forEach</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>);
}
</code></pre>

<p>Note that the function passed to <code>.map()</code> does not need to be <code>async</code>, since <code>fs.readFile</code> returns a Promise object anyway. Therefore <code>promises</code> is an array of Promise objects, which can be sent to <code>Promise.all()</code>.</p>

<p>In @Bergis answer, the console may log file contents in the order theyre read. For example if a really small file finishes reading before a really large file, it will be logged first, even if the small file comes <em>after</em> the large file in the <code>files</code> array. However, in my method above, you are guaranteed the console will log the files in the same order as the provided array.</p>
    </div></div></div></div><div id="solution11" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 11</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>A simple drop-in solution for replacing a <code>forEach()</code> await loop that is not working is replacing <code>forEach</code> with <code>map</code> and adding <code>Promise.all(</code> to the beginning.</p>
<p>For example:</p>
<p><code>await y.forEach(async (x) =&gt; {</code></p>
<p>to</p>
<p><code>await Promise.all(y.map(async (x) =&gt; {</code></p>
<p>An extra <code>)</code> is needed at the end.</p>
    </div></div></div></div><div id="solution12" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 12</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>it's pretty painless to pop a couple methods in a file that will handle asynchronous data in a serialized order and give a more conventional flavour to your code.  For example:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
  <span class="hljs-keyword">var</span> self = <span class="hljs-variable language_">this</span>;

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">each</span> = <span class="hljs-keyword">async</span> (items, fn) =&gt; {
    <span class="hljs-keyword">if</span> (items &amp;&amp; items.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
        items.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (item) =&gt; {
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>(item);
        }));
    }
  };

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">reduce</span> = <span class="hljs-keyword">async</span> (items, fn, initialValue) =&gt; {
    <span class="hljs-keyword">await</span> self.<span class="hljs-title function_">each</span>(
      items, <span class="hljs-keyword">async</span> (item) =&gt; {
        initialValue = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>(initialValue, item);
      });
    <span class="hljs-keyword">return</span> initialValue;
  };
};
</code></pre>

<p>now, assuming that's saved at './myAsync.js' you can do something similar to the below in an adjacent file:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">...
<span class="hljs-comment">/* your server setup here */</span>
...
<span class="hljs-keyword">var</span> <span class="hljs-title class_">MyAsync</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./myAsync'</span>);
<span class="hljs-keyword">var</span> <span class="hljs-title class_">Cat</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./models/Cat'</span>);
<span class="hljs-keyword">var</span> <span class="hljs-title class_">Doje</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./models/Doje'</span>);
<span class="hljs-keyword">var</span> <span class="hljs-title function_">example</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">var</span> myAsync = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyAsync</span>();
  <span class="hljs-keyword">var</span> doje = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Doje</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Doje'</span>, <span class="hljs-attr">noises</span>: [] }).<span class="hljs-title function_">save</span>();
  <span class="hljs-keyword">var</span> cleanParams = [];

  <span class="hljs-comment">// FOR EACH EXAMPLE</span>
  <span class="hljs-keyword">await</span> myAsync.<span class="hljs-title function_">each</span>([<span class="hljs-string">'bork'</span>, <span class="hljs-string">'concern'</span>, <span class="hljs-string">'heck'</span>], 
    <span class="hljs-keyword">async</span> (elem) =&gt; {
      <span class="hljs-keyword">if</span> (elem !== <span class="hljs-string">'heck'</span>) {
        <span class="hljs-keyword">await</span> doje.<span class="hljs-title function_">update</span>({ <span class="hljs-attr">$push</span>: { <span class="hljs-string">'noises'</span>: elem }});
      }
    });

  <span class="hljs-keyword">var</span> cat = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Cat</span>.<span class="hljs-title function_">findOne</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Nyan'</span> });

  <span class="hljs-comment">// REDUCE EXAMPLE</span>
  <span class="hljs-keyword">var</span> friendsOfNyanCat = <span class="hljs-keyword">await</span> myAsync.<span class="hljs-title function_">reduce</span>(cat.<span class="hljs-property">friends</span>,
    <span class="hljs-keyword">async</span> (catArray, friendId) =&gt; {
      <span class="hljs-keyword">var</span> friend = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Friend</span>.<span class="hljs-title function_">findById</span>(friendId);
      <span class="hljs-keyword">if</span> (friend.<span class="hljs-property">name</span> !== <span class="hljs-string">'Long cat'</span>) {
        catArray.<span class="hljs-title function_">push</span>(friend.<span class="hljs-property">name</span>);
      }
    }, []);
  <span class="hljs-comment">// Assuming Long Cat was a friend of Nyan Cat...</span>
  <span class="hljs-title function_">assert</span>(friendsOfNyanCat.<span class="hljs-property">length</span> === (cat.<span class="hljs-property">friends</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>));
}
</code></pre>
    </div></div></div></div><div id="solution13" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 13</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><a href="https://stackoverflow.com/a/37576787/3241111">Bergi's solution</a> works nicely when <code>fs</code> is promise based.
You can use <code>bluebird</code>, <code>fs-extra</code> or <code>fs-promise</code> for this.</p>

<p><strong>However, solution for</strong> node's native <code>fs</code> libary is as follows:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(filePaths
    .<span class="hljs-title function_">map</span>( <span class="hljs-keyword">async</span> filePath =&gt; {
      <span class="hljs-keyword">const</span> fileContents = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getAssetFromCache</span>(filePath, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {

        <span class="hljs-comment">// 1. Wrap with Promise    </span>
        <span class="hljs-comment">// 2. Return the result of the Promise</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">res, rej</span>) =&gt;</span> {
          fs.<span class="hljs-title function_">readFile</span>(filePath, <span class="hljs-string">'utf8'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) {
            <span class="hljs-keyword">if</span> (data) {
              <span class="hljs-title function_">res</span>(data);
            }
          });
        });
      });

      <span class="hljs-keyword">return</span> fileContents;
    }));
</code></pre>

<p><strong>Note:</strong>
<code>require('fs')</code> compulsorily takes function as 3rd arguments, otherwise throws error:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title class_">TypeError</span> [<span class="hljs-variable constant_">ERR_INVALID_CALLBACK</span>]: <span class="hljs-title class_">Callback</span> must be a <span class="hljs-keyword">function</span>
</code></pre>
    </div></div></div></div><div id="solution14" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 14</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>It is not good to call an asynchronous method from a loop. This is because each loop iteration will be delayed until the entire asynchronous operation completes. That is not very performant. It also averts the advantages of parallelization benefits of <code>async</code>/<code>await</code>.</p>
<p>A better solution would be to create all promises at once, then get access to the results using <code>Promise.all()</code>. Otherwise, each successive operation will not start until the previous one has completed.</p>
<p>Consequently, the code may be refactored as follows;</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">printFiles</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>();
  <span class="hljs-keyword">const</span> results = [];
  files.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> {
    results.<span class="hljs-title function_">push</span>(fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>));
  });
  <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(results);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents);
}
</code></pre>
    </div></div></div></div><div id="solution15" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 15</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>One important <strong>caveat</strong> is: The <code>await + for .. of</code> method and the <code>forEach + async</code> way actually have different effect. </p>

<p>Having <code>await</code> inside a real <code>for</code> loop will make sure all async calls are executed one by one. And the <code>forEach + async</code> way will fire off all promises at the same time, which is faster but sometimes overwhelmed(<strong>if you do some DB query or visit some web services with volume restrictions</strong> and do not want to fire 100,000 calls at a time). </p>

<p>You can also use <code>reduce + promise</code>(less elegant) if you do not use <code>async/await</code> and want to make sure files are read <strong>one after another</strong>. </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">files.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">lastPromise, file</span>) =&gt;</span> 
 lastPromise.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> 
   fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>)
 ), <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
)
</code></pre>

<p>Or you can create a forEachAsync to help but basically use the same for loop underlying.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">forEachAsync</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>){
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> x <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>){
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">cb</span>(x);
    }
}
</code></pre>
    </div></div></div></div><div id="solution16" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 16</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Both the solutions above work, however, Antonio's does the job with less code, here is how it helped me resolve data from my database, from several different child refs and then pushing them all into an array and resolving it in a promise after all is done:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(<span class="hljs-title class_">PacksList</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">pack</span>)=&gt;</span>{
    <span class="hljs-keyword">return</span> fireBaseRef.<span class="hljs-title function_">child</span>(pack.<span class="hljs-property">folderPath</span>).<span class="hljs-title function_">once</span>(<span class="hljs-string">'value'</span>,<span class="hljs-function">(<span class="hljs-params">snap</span>)=&gt;</span>{
        snap.<span class="hljs-title function_">forEach</span>( <span class="hljs-function"><span class="hljs-params">childSnap</span> =&gt;</span> {
            <span class="hljs-keyword">const</span> file = childSnap.<span class="hljs-title function_">val</span>()
            file.<span class="hljs-property">id</span> = childSnap.<span class="hljs-property">key</span>;
            allItems.<span class="hljs-title function_">push</span>( file )
        })
    })
})).<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span>store.<span class="hljs-title function_">dispatch</span>( actions.<span class="hljs-title function_">allMockupItems</span>(allItems)))
</code></pre>
    </div></div></div></div><div id="solution17" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 17</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Just adding to the original answer</p>

<ul>
<li>The parallel reading syntax in the original answer is sometimes confusing and difficult to read, maybe we can write it in a different approach</li>
</ul>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>();
  <span class="hljs-keyword">const</span> fileReadPromises = [];

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">readAndLogFile</span> = <span class="hljs-keyword">async</span> filePath =&gt; {
    <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">"utf8"</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents);
    <span class="hljs-keyword">return</span> contents;
  };

  files.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
    fileReadPromises.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">readAndLogFile</span>(file));
  });

  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(fileReadPromises);
}

</code></pre>

<ul>
<li>For sequential operation, not just <strong>for...of</strong>, normal for loop will also work</li>
</ul>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>();

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; files.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> file = files[i];
    <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">"utf8"</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents);
  }
}

</code></pre>
    </div></div></div></div><div id="solution18" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 18</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Like @Bergi's response, but with one difference.</p>

<p><code>Promise.all</code> rejects all promises if one gets rejected.</p>

<p>So, use a recursion.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> readFilesQueue = <span class="hljs-keyword">async</span> (files, index = <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(files[index], <span class="hljs-string">'utf8'</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents)

    <span class="hljs-keyword">return</span> files.<span class="hljs-property">length</span> &lt;= index
        ? <span class="hljs-title function_">readFilesQueue</span>(files, ++index)
        : files

}

<span class="hljs-keyword">const</span> printFiles <span class="hljs-keyword">async</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>();
    <span class="hljs-keyword">const</span> printContents = <span class="hljs-keyword">await</span> <span class="hljs-title function_">readFilesQueue</span>(files)

    <span class="hljs-keyword">return</span> printContents
}

<span class="hljs-title function_">printFiles</span>()
</code></pre>

<p><strong>PS</strong></p>

<p><code>readFilesQueue</code> is outside of <code>printFiles</code> cause the side effect* introduced by <code>console.log</code>, it's better to mock, test, and or spy so, it's not cool to have a function that returns the content(sidenote).</p>

<p>Therefore, the code can simply be designed by that: three separated functions that are "pure"** and introduce no side effects, process the entire list and can easily be modified to handle failed cases.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilesPath</span>()

<span class="hljs-keyword">const</span> <span class="hljs-title function_">printFile</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">file</span>) =&gt; {
    <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(content)
}

<span class="hljs-keyword">const</span> readFiles = <span class="hljs-keyword">async</span> = <span class="hljs-function">(<span class="hljs-params">files, index = <span class="hljs-number">0</span></span>) =&gt;</span> {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">printFile</span>(files[index])

    <span class="hljs-keyword">return</span> files.<span class="hljs-property">lengh</span> &lt;= index
        ? <span class="hljs-title function_">readFiles</span>(files, ++index)
        : files
}

<span class="hljs-title function_">readFiles</span>(files)
</code></pre>

<p><strong>Future edit/current state</strong></p>

<p>Node supports top-level await (this doesn't have a plugin yet, won't have and can be enabled via harmony flags), it's cool but doesn't solve one problem (strategically I work only on LTS versions). How to get the files?</p>

<p>Using composition. Given the code, causes to me a sensation that this is inside a module, so, should have a function to do it. If not, you should use an IIFE to wrap the role code into an async function creating simple module that's do all for you, or you can go with the right way, there is, composition.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// more complex version with IIFE to a single module</span>
(<span class="hljs-keyword">async</span> (files) =&gt; <span class="hljs-title function_">readFiles</span>(<span class="hljs-keyword">await</span> <span class="hljs-title function_">files</span>())(getFilesPath)
</code></pre>

<p>Note that the name of variable changes due to semantics. You pass a functor (a function that can be invoked by another function) and recieves a pointer on memory that contains the initial block of logic of the application.</p>

<p>But, if's not a module and you need to export the logic?</p>

<p>Wrap the functions in a async function.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">readFilesQueue</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-comment">// ... to code goes here</span>
}
</code></pre>

<p>Or change the names of variables, whatever...</p>

<hr>

<p><code>*</code> by side effect menans any colacteral effect of application  that can change the statate/behaviour or introuce bugs in the application, like IO.</p>

<p><code>**</code> by "pure", it's in apostrophe since the functions it's not pure and the code can be converged to a pure version, when there's no console output, only data manipulations.</p>

<p>Aside this, to be pure, you'll need to work with monads that handles the side effect, that are error prone, and treats that error separately of the application. </p>
    </div></div></div></div><div id="solution19" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 19</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Today I came across multiple solutions for this. Running the async await functions in the forEach Loop. By building the wrapper around we can make this happen.</p>

<p><a href="https://www.creospiders.com/2019/11/api-call-or-async-await-not-working-in.html" rel="noreferrer">More detailed explanation on how it works internally, for the native forEach and why it is not able to make a async function call and other details on the various methods are provided in link here</a></p>

<p>The multiple ways through which it can be done and they are as follows,</p>

<p>Method 1 : Using the wrapper.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">await</span> (<span class="hljs-function">()=&gt;</span>{
     <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>)=&gt;</span>{
       items.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">async</span> (item,index)=&gt;{
           <span class="hljs-keyword">try</span>{
               <span class="hljs-keyword">await</span> <span class="hljs-title function_">someAPICall</span>();
           } <span class="hljs-keyword">catch</span>(e) {
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e)
           }
           count++;
           <span class="hljs-keyword">if</span>(index === items.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>){
             <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'Done'</span>)
           }
         });
     });
    })();
</code></pre>

<p>Method 2: Using the same as a generic function of Array.prototype</p>

<p>Array.prototype.forEachAsync.js</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">if</span>(!<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">forEachAsync</span>) {
    <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">forEachAsync</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>){
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>)=&gt;</span>{
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-title function_">async</span>(item,index,array)=&gt;{
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>(item,index,array);
            <span class="hljs-keyword">if</span>(index === array.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>){
                <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'done'</span>);
            }
        })
      });
    };
  }
</code></pre>

<p>Usage : </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-built_in">require</span>(<span class="hljs-string">'./Array.prototype.forEachAsync'</span>);

<span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;

<span class="hljs-keyword">let</span> <span class="hljs-title function_">hello</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">items</span>) =&gt; {

<span class="hljs-comment">// Method 1 - Using the Array.prototype.forEach </span>

    <span class="hljs-keyword">await</span> items.<span class="hljs-title function_">forEachAsync</span>(<span class="hljs-keyword">async</span> () =&gt; {
         <span class="hljs-keyword">try</span>{
               <span class="hljs-keyword">await</span> <span class="hljs-title function_">someAPICall</span>();
           } <span class="hljs-keyword">catch</span>(e) {
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e)
           }
        count++;
    });

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"count = "</span> + count);
}

someAPICall = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"done"</span>) <span class="hljs-comment">// or reject('error')</span>
        }, <span class="hljs-number">100</span>);
    })
}

<span class="hljs-title function_">hello</span>([<span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>, <span class="hljs-string">''</span>]); <span class="hljs-comment">// hello([]) empty array is also be handled by default</span>
</code></pre>

<p>Method 3 :</p>

<p>Using Promise.all</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(items.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> (item) =&gt; {
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">someAPICall</span>();
        count++;
    }));

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"count = "</span> + count);
</code></pre>

<p>Method 4 : Traditional for loop or modern for loop</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// Method 4 - using for loop directly</span>

<span class="hljs-comment">// 1. Using the modern for(.. in..) loop</span>
   <span class="hljs-keyword">for</span>(item <span class="hljs-keyword">in</span> items){

        <span class="hljs-keyword">await</span> <span class="hljs-title function_">someAPICall</span>();
        count++;
    }

<span class="hljs-comment">//2. Using the traditional for loop </span>

    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>;i&lt;items.<span class="hljs-property">length</span>;i++){

        <span class="hljs-keyword">await</span> <span class="hljs-title function_">someAPICall</span>();
        count++;
    }


    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"count = "</span> + count);
</code></pre>
    </div></div></div></div><div id="solution20" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 20</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You can use <code>Array.prototype.forEach</code>, but async/await is not so compatible. This is because the promise returned from an async callback expects to be resolved, but <code>Array.prototype.forEach</code> does not resolve any promises from the execution of its callback. So then, you can use forEach, but you'll have to handle the promise resolution yourself.</p>

<p>Here is a way to read and print each file in series using <code>Array.prototype.forEach</code></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFilesInSeries</span> () {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>()

  <span class="hljs-keyword">let</span> promiseChain = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>()
  files.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> {
    promiseChain = promiseChain.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">contents</span>) =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents)
      })
    })
  })
  <span class="hljs-keyword">await</span> promiseChain
}
</code></pre>

<p>Here is a way (still using <code>Array.prototype.forEach</code>) to print the contents of files in parallel</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFilesInParallel</span> () {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>()

  <span class="hljs-keyword">const</span> promises = []
  files.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> {
    promises.<span class="hljs-title function_">push</span>(
      fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">contents</span>) =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents)
      })
    )
  })
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(promises)
}
</code></pre>
    </div></div></div></div><div id="solution21" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 21</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Currently the Array.forEach prototype property doesn't support async operations, but we can create our own poly-fill to meet our needs.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// Example of asyncForEach Array poly-fill for NodeJs</span>
<span class="hljs-comment">// file: asyncForEach.js</span>
<span class="hljs-comment">// Define asynForEach function </span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncForEach</span>(<span class="hljs-params">iteratorFunction</span>){
  <span class="hljs-keyword">let</span> indexer = <span class="hljs-number">0</span>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> data <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>){
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">iteratorFunction</span>(data, indexer)
    indexer++
  }
}
<span class="hljs-comment">// Append it as an Array prototype property</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">asyncForEach</span> = asyncForEach
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {<span class="hljs-title class_">Array</span>}
</code></pre>

<p>And that's it! You now have an async forEach method available on any arrays that are defined after these to operations.</p>

<p>Let's test it...</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// Nodejs style</span>
<span class="hljs-comment">// file: someOtherFile.js</span>

<span class="hljs-keyword">const</span> readline = <span class="hljs-built_in">require</span>(<span class="hljs-string">'readline'</span>)
<span class="hljs-title class_">Array</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./asyncForEach'</span>).<span class="hljs-property">Array</span>
<span class="hljs-keyword">const</span> log = <span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>

<span class="hljs-comment">// Create a stream interface</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createReader</span>(<span class="hljs-params">options={prompt: <span class="hljs-string">'&gt;'</span>}</span>){
  <span class="hljs-keyword">return</span> readline.<span class="hljs-title function_">createInterface</span>({
    <span class="hljs-attr">input</span>: process.<span class="hljs-property">stdin</span>
    ,<span class="hljs-attr">output</span>: process.<span class="hljs-property">stdout</span>
    ,<span class="hljs-attr">prompt</span>: options.<span class="hljs-property">prompt</span> !== <span class="hljs-literal">undefined</span> ? options.<span class="hljs-property">prompt</span> : <span class="hljs-string">'&gt;'</span>
  })
}
<span class="hljs-comment">// Create a cli stream reader</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserIn</span>(<span class="hljs-params">question, options={prompt:<span class="hljs-string">'&gt;'</span>}</span>){
  <span class="hljs-title function_">log</span>(question)
  <span class="hljs-keyword">let</span> reader = <span class="hljs-title function_">createReader</span>(options)
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>{
    reader.<span class="hljs-title function_">on</span>(<span class="hljs-string">'line'</span>, <span class="hljs-function">(<span class="hljs-params">answer</span>)=&gt;</span>{
      process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">cursorTo</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
      process.<span class="hljs-property">stdout</span>.<span class="hljs-title function_">clearScreenDown</span>()
      reader.<span class="hljs-title function_">close</span>()
      <span class="hljs-title function_">res</span>(answer)
    })
  })
}

<span class="hljs-keyword">let</span> questions = [
  <span class="hljs-string">`What's your name`</span>
  ,<span class="hljs-string">`What's your favorite programming language`</span>
  ,<span class="hljs-string">`What's your favorite async function`</span>
]
<span class="hljs-keyword">let</span> responses = {}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getResponses</span>(<span class="hljs-params"></span>){
<span class="hljs-comment">// Notice we have to prepend await before calling the async Array function</span>
<span class="hljs-comment">// in order for it to function as expected</span>
  <span class="hljs-keyword">await</span> questions.<span class="hljs-title function_">asyncForEach</span>(<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">question, index</span>){
    <span class="hljs-keyword">let</span> answer = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserIn</span>(question)
    responses[question] = answer
  })
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>){
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">getResponses</span>()
  <span class="hljs-title function_">log</span>(responses)
}
<span class="hljs-title function_">main</span>()
<span class="hljs-comment">// Should prompt user for an answer to each question and then </span>
<span class="hljs-comment">// log each question and answer as an object to the terminal</span>
</code></pre>

<p>We could do the same for some of the other array functions like map...</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncMap</span>(<span class="hljs-params">iteratorFunction</span>){
  <span class="hljs-keyword">let</span> newMap = []
  <span class="hljs-keyword">let</span> indexer = <span class="hljs-number">0</span>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> data <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>){
    newMap[indexer] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">iteratorFunction</span>(data, indexer, <span class="hljs-variable language_">this</span>)
    indexer++
  }
  <span class="hljs-keyword">return</span> newMap
}

<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">asyncMap</span> = asyncMap
</code></pre>

<p>... and so on :)</p>

<p>Some things to note:</p>

<ul>
<li>Your iteratorFunction must be an async function or promise</li>
<li>Any arrays created before <code>Array.prototype.&lt;yourAsyncFunc&gt; = &lt;yourAsyncFunc&gt;</code> will not have this feature available</li>
</ul>
    </div></div></div></div><div id="solution22" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 22</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>To see how that can go wrong, print console.log at the end of the method.</p>

<p>Things that can go wrong in general:</p>

<ul>
<li>Arbitrary order.</li>
<li>printFiles can finish running before printing files.</li>
<li>Poor performance.</li>
</ul>

<p>These are not always wrong but frequently are in standard use cases.</p>

<p>Generally, using forEach will result in all but the last. It'll call each function without awaiting for the function meaning it tells all of the functions to start then finishes without waiting for the functions to finish.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs-promise'</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span> () {
  <span class="hljs-keyword">const</span> files = (<span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>()).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>))

  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">await</span> file)
}

<span class="hljs-title function_">printFiles</span>()
</code></pre>

<p>This is an example in native JS that will preserve order, prevent the function from returning prematurely and in theory retain optimal performance.</p>

<p>This will:</p>

<ul>
<li>Initiate all of the file reads to happen in parallel.</li>
<li>Preserve the order via the use of map to map file names to promises to wait for.</li>
<li>Wait for each promise in the order defined by the array.</li>
</ul>

<p>With this solution the first file will be shown as soon as it is available without having to wait for the others to be available first.</p>

<p>It will also be loading all files at the same time rather than having to wait for the first to finish before the second file read can be started.</p>

<p>The only draw back of this and the original version is that if multiple reads are started at once then it's more difficult to handle errors on account of having more errors that can happen at a time.</p>

<p>With versions that read a file at a time then then will stop on a failure without wasting time trying to read any more files. Even with an elaborate cancellation system it can be hard to avoid it failing on the first file but reading most of the other files already as well.</p>

<p>Performance is not always predictable. While many systems will be faster with parallel file reads some will prefer sequential. Some are dynamic and may shift under load, optimisations that offer latency do not always yield good throughput under heavy contention.</p>

<p>There is also no error handling in that example. If something requires them to either all be successfully shown or not at all it won't do that.</p>

<p>In depth experimentation is recommended with console.log at each stage and fake file read solutions (random delay instead). Although many solutions appear to do the same in simple cases all have subtle differences that take some extra scrutiny to squeeze out.</p>

<p>Use this mock to help tell the difference between solutions:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> start = +<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">mock</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">fs</span>: {<span class="hljs-attr">readFile</span>: <span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-comment">// Instead of this just make three files and try each timing arrangement.</span>
        <span class="hljs-comment">// IE, all same, [100, 200, 300], [300, 200, 100], [100, 300, 200], etc.</span>
        <span class="hljs-keyword">const</span> time = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-number">100</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">4900</span>);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Read of <span class="hljs-subst">${file}</span> started at <span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>() - start}</span> and will take <span class="hljs-subst">${time}</span>ms.`</span>)
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-comment">// Bonus material here if random reject instead.</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Read of <span class="hljs-subst">${file}</span> finished, resolving promise at <span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>() - start}</span>.`</span>);
          <span class="hljs-title function_">resolve</span>(file);
        }, time);
      })},
      <span class="hljs-attr">console</span>: {<span class="hljs-attr">log</span>: <span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Console Log of <span class="hljs-subst">${file}</span> finished at <span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>() - start}</span>.`</span>)},
      <span class="hljs-attr">getFilePaths</span>: <span class="hljs-function">() =&gt;</span> [<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'C'</span>, <span class="hljs-string">'D'</span>, <span class="hljs-string">'E'</span>]
    };
  };

  <span class="hljs-keyword">const</span> printFiles = (<span class="hljs-function">(<span class="hljs-params">{fs, <span class="hljs-variable language_">console</span>, getFilePaths}</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
      <span class="hljs-keyword">const</span> files = (<span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>()).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>));

      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files)
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">await</span> file);
    };
  })(<span class="hljs-title function_">mock</span>());

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Running at <span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>() - start}</span>`</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">printFiles</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Finished running at <span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>() - start}</span>`</span>);
})();

</code></pre>
    </div></div></div></div><div id="solution23" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 23</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Using Task, futurize, and a traversable List, you can simply do</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFiles</span>();

  <span class="hljs-title class_">List</span>(files).<span class="hljs-title function_">traverse</span>( <span class="hljs-title class_">Task</span>.<span class="hljs-property">of</span>, <span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> <span class="hljs-title function_">readFile</span>( f, <span class="hljs-string">'utf-8'</span>))
    .<span class="hljs-title function_">fork</span>( <span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>, <span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>)
}
</code></pre>

<p>Here is how you'd set this up</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>;
<span class="hljs-keyword">import</span> { futurize } <span class="hljs-keyword">from</span> <span class="hljs-string">'futurize'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Task</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'data.task'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">List</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'immutable-ext'</span>;

<span class="hljs-keyword">const</span> future = <span class="hljs-title function_">futurizeP</span>(<span class="hljs-title class_">Task</span>)
<span class="hljs-keyword">const</span> readFile = <span class="hljs-title function_">future</span>(fs.<span class="hljs-property">readFile</span>)
</code></pre>

<p>Another way to have structured the desired code would be</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">printFiles</span> = files =&gt; 
  <span class="hljs-title class_">List</span>(files).<span class="hljs-title function_">traverse</span>( <span class="hljs-title class_">Task</span>.<span class="hljs-property">of</span>, <span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> <span class="hljs-title function_">readFile</span>( fn, <span class="hljs-string">'utf-8'</span>))
    .<span class="hljs-title function_">fork</span>( <span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>, <span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>)
</code></pre>

<p>Or perhaps even more functionally oriented</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// 90% of encodings are utf-8, making that use case super easy is prudent</span>

<span class="hljs-comment">// handy-library.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">readFile</span> = f =&gt;
  <span class="hljs-title function_">future</span>(fs.<span class="hljs-property">readFile</span>)( f, <span class="hljs-string">'utf-8'</span> )

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">arrayToTaskList</span> = list =&gt; <span class="hljs-function"><span class="hljs-params">taskFn</span> =&gt;</span> 
  <span class="hljs-title class_">List</span>(files).<span class="hljs-title function_">traverse</span>( <span class="hljs-title class_">Task</span>.<span class="hljs-property">of</span>, taskFn ) 

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">readFiles</span> = files =&gt;
  <span class="hljs-title function_">arrayToTaskList</span>( files, readFile )

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">printFiles</span> = files =&gt; 
  <span class="hljs-title function_">readFiles</span>(files).<span class="hljs-title function_">fork</span>( <span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>, <span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>)
</code></pre>

<p>Then from the parent function</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">/* awesome code with side-effects before */</span>
  <span class="hljs-title function_">printFiles</span>( <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFiles</span>() );
  <span class="hljs-comment">/* awesome code with side-effects after */</span>
}
</code></pre>

<p>If you really wanted more flexibility in encoding, you could just do this (for fun, I'm using the proposed <a href="https://github.com/tc39/proposal-pipeline-operator" rel="nofollow noreferrer">Pipe Forward operator</a> )</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { curry, flip } <span class="hljs-keyword">from</span> <span class="hljs-string">'ramda'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> readFile = fs.<span class="hljs-property">readFile</span> 
  |&gt; future,
  |&gt; curry,
  |&gt; flip

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> readFileUtf8 = <span class="hljs-title function_">readFile</span>(<span class="hljs-string">'utf-8'</span>)
</code></pre>

<p>PS - I didn't try this code on the console, might have some typos... "straight freestyle, off the top of the dome!" as the 90s kids would say. :-p</p>
    </div></div></div></div><div id="solution24" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 24</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<h3>Here is a great example for using async in forEach loop.</h3>
<p><strong>Write your own asyncForEach</strong></p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncForEach</span>(<span class="hljs-params">array, callback</span>) {  
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; array.<span class="hljs-property">length</span>; index++) {
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">callback</span>(array[index], index, array)
    }
}
</code></pre>
<p><strong>You can use it like this</strong></p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">await</span> <span class="hljs-title function_">asyncForEach</span>(array, <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">item,index,array</span>){
     <span class="hljs-comment">//await here</span>
   }
)
</code></pre>
    </div></div></div></div><div id="solution25" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 25</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The OP's orignal question</p>
<blockquote>
<p>Are there any issues with using async/await in a forEach loop? ...</p>
</blockquote>
<p>was covered to an extent in @Bergi's <a href="https://stackoverflow.com/a/37576787/4376643">selected answer</a>,
which showed how to process in serial and in parallel.  However there are other issues noted with parallelism -</p>
<ol>
<li>Order -- <a href="https://stackoverflow.com/a/48939529/4376643">@chharvey</a> notes that -</li>
</ol>
<blockquote>
<p>For example if a really small file finishes reading before a really large file, it will be logged first, even if the small file comes after the large file in the files array.</p>
</blockquote>
<ol start="2">
<li>Possibly opening too many files at once -- A comment by Bergi under another <a href="https://stackoverflow.com/a/66919921/4376643">answer</a></li>
</ol>
<blockquote>
<p>It is also not good to open thousands of files at once to read them concurrently. One always has to do an assessment whether a sequential, parallel, or mixed approach is better.</p>
</blockquote>
<p>So let's address these issues showing actual code that is brief and concise, and does <em>not</em> use third party libraries.  Something easily cut, paste, and modifiable.</p>
<h3>Reading in parallel (all at once), printing in serial (as early as possible per file).</h3>
<p>The easiest improvement is perform full parallelism as in <a href="https://stackoverflow.com/a/37576787/4376643">@Bergi's answer</a>, but make a small change so that each file is <em>printed as soon as possible while preserving order</em>.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles2</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> readProms = (<span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>()).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span>
    fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">"utf8"</span>)
  );
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(readProms),                      <span class="hljs-comment">// branch 1</span>
    (<span class="hljs-keyword">async</span> () =&gt; {                                     <span class="hljs-comment">// branch 2</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> p <span class="hljs-keyword">of</span> readProms) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">await</span> p);
    })(),
  ]);
}
</code></pre>
<p>Above, two seperate branches are run concurrently.</p>
<ul>
<li>branch 1: Reading in parallel, all at once,</li>
<li>branch 2: Reading in serial to force order, but waiting no longer than necessary</li>
</ul>
<p>That was easy.</p>
<h3>Reading in parallel with a concurrency limit, printing in serial (as early as possible per file).</h3>
<p>A "concurrecy limit" means that no more than <code>N</code> files will ever being read at the same time.<br>
Like a store that only allows in so many customers at a time (at least during COVID).</p>
<p>First a helper function is introduced -</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">bootablePromise</span>(<span class="hljs-params">kickMe: () =&gt; <span class="hljs-built_in">Promise</span>&lt;any&gt;</span>) {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">resolve</span>: <span class="hljs-function">(<span class="hljs-params">value: unknown</span>) =&gt;</span> <span class="hljs-keyword">void</span> = <span class="hljs-function">() =&gt;</span> {};
  <span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> { resolve = res; });
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">boot</span> = (<span class="hljs-params"></span>) =&gt; { <span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">kickMe</span>()); };
  <span class="hljs-keyword">return</span> { promise, boot };
}
</code></pre>
<p>The funciton <code>bootablePromise(kickMe:() =&gt; Promise&lt;any&gt;)</code> takes an
function <code>kickMe</code> as an argumment to start a task (in our case <code>readFile</code>).  But it is not started immediately.</p>
<p><code>bootablePromise</code> returns a couple of properties</p>
<ul>
<li><code>promise</code> of type <code>Promise</code></li>
<li><code>boot</code> of type function <code>()=&gt;void</code></li>
</ul>
<p><code>promise</code> has two stages in life</p>
<ol>
<li>Being a promise to start a task</li>
<li>Being a promise complete a task it has already started.</li>
</ol>
<p><code>promise</code> transitions from the first to the second state when <code>boot()</code> is called.</p>
<p><code>bootablePromise</code> is used in <code>printFiles</code> --</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles4</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>();
  <span class="hljs-keyword">const</span> <span class="hljs-attr">boots</span>: (<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">void</span>)[] = [];
  <span class="hljs-keyword">const</span> <span class="hljs-attr">set</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">Promise</span>&lt;{ <span class="hljs-attr">pidx</span>: number }&gt;&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>&lt;<span class="hljs-title class_">Promise</span>&lt;any&gt;&gt;();
  <span class="hljs-keyword">const</span> bootableProms = files.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">file,pidx</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { promise, boot } = <span class="hljs-title function_">bootablePromise</span>(<span class="hljs-function">() =&gt;</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">"utf8"</span>));
    boots.<span class="hljs-title function_">push</span>(boot);
    set.<span class="hljs-title function_">add</span>(promise.<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> ({ pidx })));
    <span class="hljs-keyword">return</span> promise;
  });
  <span class="hljs-keyword">const</span> concurLimit = <span class="hljs-number">2</span>;
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
    (<span class="hljs-keyword">async</span> () =&gt; {                                       <span class="hljs-comment">// branch 1</span>
      <span class="hljs-keyword">let</span> idx = <span class="hljs-number">0</span>;
      boots.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, concurLimit).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">b</span>) =&gt;</span> { <span class="hljs-title function_">b</span>(); idx++; });
      <span class="hljs-keyword">while</span> (idx&lt;boots.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> { pidx } = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([...set]);
        set.<span class="hljs-title function_">delete</span>([...set][pidx]);
        boots[idx++]();
      }
    })(),
    (<span class="hljs-keyword">async</span> () =&gt; {                                       <span class="hljs-comment">// branch 2</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> p <span class="hljs-keyword">of</span> bootableProms) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">await</span> p);
    })(),
  ]);
}
</code></pre>
<p>As before there are two branches</p>
<ul>
<li>branch 1:   For running and handling concurrecy.</li>
<li>branch 2:   For printing</li>
</ul>
<p>The difference now is the never more than <code>concurLimit</code> promises are allowed to run concurrently.</p>
<p>The important variables are</p>
<ul>
<li><code>boots</code>: The array of functions to call to force it's corresponding promise to transition. It is used only in branch 1.</li>
<li><code>set</code>: There are promises in a random acces container so that they can be easily removed once fulfilled.  This contianer is used only in branch 1.</li>
<li><code>bootableProms</code>:  These are the smae promises as initally in <code>set</code>, but it is an array not a set, and the array is never changed.  It is used only in branch 2.</li>
</ul>
<p>Running with a mock <code>fs.readFile</code> that takes times as follows (filename vs. time in ms).</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> timeTable = {
  <span class="hljs-string">"1"</span>: <span class="hljs-number">600</span>,
  <span class="hljs-string">"2"</span>: <span class="hljs-number">500</span>,
  <span class="hljs-string">"3"</span>: <span class="hljs-number">400</span>,
  <span class="hljs-string">"4"</span>: <span class="hljs-number">300</span>,
  <span class="hljs-string">"5"</span>: <span class="hljs-number">200</span>,
  <span class="hljs-string">"6"</span>: <span class="hljs-number">100</span>,
};
</code></pre>
<p>test run times such as this are seen, showing the concurrency is working --</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">[<span class="hljs-number">1</span>]<span class="hljs-number">0</span>--<span class="hljs-number">0.601</span>
[<span class="hljs-number">2</span>]<span class="hljs-number">0</span>--<span class="hljs-number">0.502</span>
[<span class="hljs-number">3</span>]<span class="hljs-number">0.503</span>--<span class="hljs-number">0.904</span>
[<span class="hljs-number">4</span>]<span class="hljs-number">0.608</span>--<span class="hljs-number">0.908</span>
[<span class="hljs-number">5</span>]<span class="hljs-number">0.905</span>--<span class="hljs-number">1.105</span>
[<span class="hljs-number">6</span>]<span class="hljs-number">0.905</span>--<span class="hljs-number">1.005</span>
</code></pre>
<p>Available as executable in the <a href="https://www.typescriptlang.org/play?#code/FAYw9gdgzgLgBDAlgWwKYBUCGAjANquAXjgG9g44AiARkoC44A2ABmYBpyqAmeuAVlYcKlAMy8ALIM6VxvEVOF9eXBVUa9qUgL4BuYKEiw4sTACcY6InAAimGKgB0EMAHcAFAEpgAMwCuEECRIOAATVFwYTDcADzoIX2RsVFMPElNUGF9TCDgYgFoTc3QPAHpNVh0tfUwoAE8AuD8AoJyAcwyAMUR8AAU7AAsoTwYe0zBkRChUAB5YU0QIVoBtAF0APlJOdMzsuAB5bAArVECHAGtUWqGkNCw8VA89KoNoeG8oKzIKGvqQOHTMCEuvg3N5uqgGHMFq02HAHPCzK0oAxMBBaqsPCMxhMprMYPNFhsvhQ4OBXnAkq0FpZiLZ7E5XJ5OBRtlkcpgXJhEPAIKgXHBRuNJjMoYS3G50lBYelDh4iETmSTFRQphYUKgwL4YOK5YQFSSDaTDPBUBAQjSbHZHM53F5DSTJW4AAZLAAkJDB+C0K3dYQiUUp1I8WjyeV94UiblN5uDTseyrgWlhbhuGBw+DgNUzaI8S09qBWcAA-EW4Mx4watBXExxdPofP5AohgtgwGBIvdBTjUG4zogQGcALIQ3K6jZd4XTVG1NaYkgAB2xwroE9x07WbFb7bonj1ADcwIgQlpNhR8PBJWBcHuR2495hcL4R-4zjaIGO4Aej1ZPPLSHWKDJIxFyFKYrF5flVx7CVUCgD8SH+WCrxvKxJR0RNqyA+At3gYhfz1UhEKgZCez7Adh08R5Ez0FkMjZQiQO7WEcOo4Bnh+BomibYJFwWGBgVg8Rf2JLDGnBD5iA5Ll4HafjwT6GBBk8GijXJHDkVyfCNi-EJc0LYhVhU0TVQYABlDJpig6YEPnI9YjgeJEmSRM1g2YgILgcyYEspc1zRVzlM4UScPTVAuwksT8CgBxkEwedxXzNhbJCaJ4MVUSbN81BmLbeAT2IELOyynU-3eBwASBcFQXBWFKC1bwAA5KA8asKHUhx518KB+jcHDWuMDIHEBEI3EY4UHEU00SoItwbLsjCWpU2idhyMaphUqsjONVSQCyAAZFBuSsLgVKko6oKG3BcDcJZFTcDi-i009DXPOB5uIZglpJdqoFwfse3YHb9sOmAPAcbwwFMABRTAQB63r4IpZS3pSgBqVH0M2hMXH6cFcjs6Z2vwRZFLlYl7QyuBkuiRMrDO+ALtMWGeyWeEHFVFZ+oNYK-QyVAQisVUHF5+wbrZjmlmpzmvoNdSljs9GVkC+0qkrDxPCEEl7rqBonvJkkIdMXJRPnOAwG8ClctC8K5SAq9HFwMBWnuzkjvnfqqw1zhpbY-Rtd+Uc-2JemqYJOSoqE+NPfjIA" rel="nofollow noreferrer">typescript playground sandbox</a></p>
    </div></div></div></div><div id="solution26" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 26</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>As other answers have mentioned, you're probably wanting it to be executed in sequence rather in parallel. Ie. run for first file, wait until it's done, <em>then</em> once it's done run for second file. That's not what will happen.</p>
<p>I think it's important to address <em>why</em> this doesn't happen.</p>
<p>Think about how <code>forEach</code> works. I can't find the source, but I presume it works something like this:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">forEach</span> = (<span class="hljs-params">arr, cb</span>) =&gt; {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-title function_">cb</span>(arr[i]);
  }
};
</code></pre>
<p>Now think about what happens when you do something like this:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-title function_">forEach</span>(files, <span class="hljs-keyword">async</span> <span class="hljs-title function_">logFile</span>(<span class="hljs-params">file</span>) {
  <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents);
});
</code></pre>
<p>Inside <code>forEach</code>'s <code>for</code> loop we're calling <code>cb(arr[i])</code>, which ends up being <code>logFile(file)</code>. The <code>logFile</code> function has an <code>await</code> inside it, so maybe the <code>for</code> loop will wait for this <code>await</code> before proceeding to <code>i++</code>?</p>
<p>No, it won't. Confusingly, that's not how <code>await</code> works. From <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await" rel="nofollow noreferrer">the docs</a>:</p>
<blockquote>
<p>An await splits execution flow, allowing the caller of the async function to resume execution. After the await defers the continuation of the async function, execution of subsequent statements ensues. If this await is the last expression executed by its function execution continues by returning to the function's caller a pending Promise for completion of the await's function and resuming execution of that caller.</p>
</blockquote>
<p>So if you have the following, the numbers won't be logged before <code>"b"</code>:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">delay</span> = (<span class="hljs-params">ms</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(resolve, ms);
  });
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">logNumbers</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">2000</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">2</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">2000</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">3</span>);
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">main</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"a"</span>);
  <span class="hljs-title function_">logNumbers</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"b"</span>);
};

<span class="hljs-title function_">main</span>();
</code></pre>
<p>Circling back to <code>forEach</code>, <code>forEach</code> is like <code>main</code> and <code>logFile</code> is like <code>logNumbers</code>. <code>main</code> won't stop just because <code>logNumbers</code> does some <code>await</code>ing, and <code>forEach</code> won't stop just because <code>logFile</code> does some <code>await</code>ing.</p>
    </div></div></div></div><div id="solution27" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 27</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Similar to Antonio Val's <a href="https://stackoverflow.com/a/45006966/8550747"><code>p-iteration</code></a>, an alternative npm module is <a href="https://async-af.js.org/AsyncAF.html#forEachAF" rel="nofollow noreferrer"><code>async-af</code></a>:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncAF</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'async-af'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-promise'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// since AsyncAF accepts promises or non-promises, there's no need to await here</span>
  <span class="hljs-keyword">const</span> files = <span class="hljs-title function_">getFilePaths</span>();

  <span class="hljs-title class_">AsyncAF</span>(files).<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">async</span> file =&gt; {
    <span class="hljs-keyword">const</span> contents = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(contents);
  });
}

<span class="hljs-title function_">printFiles</span>();
</code></pre>

<p>Alternatively, <a href="https://async-af.js.org/AsyncAF.html#logAF" rel="nofollow noreferrer"><code>async-af</code></a> has a static method (log/logAF) that logs the results of promises:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncAF</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'async-af'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-promise'</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> files = <span class="hljs-title function_">getFilePaths</span>();

  <span class="hljs-title class_">AsyncAF</span>(files).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
    <span class="hljs-title class_">AsyncAF</span>.<span class="hljs-title function_">log</span>(fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>));
  });
}

<span class="hljs-title function_">printFiles</span>();
</code></pre>

<p>However, the main advantage of the library is that you can chain asynchronous methods to do something like:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">const</span> aaf = <span class="hljs-built_in">require</span>(<span class="hljs-string">'async-af'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-promise'</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">printFiles</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">aaf</span>(<span class="hljs-title function_">getFilePaths</span>())
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>))
  .<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> aaf.<span class="hljs-title function_">log</span>(file));

<span class="hljs-title function_">printFiles</span>();
</code></pre>

<p><a href="https://async-af.js.org/AsyncAF" rel="nofollow noreferrer"><code>async-af</code></a></p>
    </div></div></div></div><div id="solution28" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 28</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In 2022 I would still advise using external libraries to handle all this async flow.  I've created the module <a href="https://github.com/atmajs/alot" rel="nofollow noreferrer">alot</a> for similar things.</p>
<p>Your example would be:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs-promise'</span>
<span class="hljs-keyword">import</span> alot <span class="hljs-keyword">from</span> <span class="hljs-string">'alot'</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printFiles</span> () {
    <span class="hljs-keyword">const</span> files = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>() <span class="hljs-comment">// Assume this works fine</span>

    <span class="hljs-keyword">await</span> <span class="hljs-title function_">alot</span>(files)
        .<span class="hljs-title function_">forEachAsync</span>(<span class="hljs-keyword">async</span> file =&gt; {
            <span class="hljs-keyword">let</span> content = <span class="hljs-keyword">await</span> fs.<span class="hljs-title function_">readFile</span>(file, <span class="hljs-string">'utf8'</span>);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(content);
        })
        .<span class="hljs-title function_">toArrayAsync</span>({ <span class="hljs-attr">threads</span>: <span class="hljs-number">4</span> });
    }
}
<span class="hljs-title function_">printFiles</span>()
</code></pre>
<p>For simple examples surely the async <code>for..of</code> would do the job, but as soon the task is more complicated you have to use some utility for this.</p>
<p>Alot has dozens of other methods that you can chain, like <code>mapAsync</code>, <code>filterAsync</code>, <code>groupAsync</code>, etc.</p>
<p>As an example:</p>
<ul>
<li>Load JSON files with products meta</li>
<li>Extract <code>ProductID</code></li>
<li>Load products from the server</li>
<li>Filter those with a price &gt; 100$</li>
<li>Order by price ascending</li>
<li>Take top 50</li>
</ul>
<hr>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs-promise'</span>
<span class="hljs-keyword">import</span> alot <span class="hljs-keyword">from</span> <span class="hljs-string">'alot'</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">File</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'atma-io'</span>

<span class="hljs-keyword">let</span> paths = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFilePaths</span>();
<span class="hljs-keyword">let</span> products = <span class="hljs-keyword">await</span> <span class="hljs-title function_">alot</span>(paths)
    .<span class="hljs-title function_">mapAsync</span>(<span class="hljs-keyword">async</span> path =&gt; <span class="hljs-keyword">await</span> <span class="hljs-title class_">File</span>.<span class="hljs-property">readAsync</span>&lt;<span class="hljs-title class_">IProductMeta</span>&gt;(path))
    .<span class="hljs-title function_">mapAsync</span>(<span class="hljs-keyword">async</span> meta =&gt; <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">`<span class="hljs-subst">${server}</span>/api/product/<span class="hljs-subst">${meta.productId}</span>`</span>))
    .<span class="hljs-title function_">mapAsync</span>(<span class="hljs-function"><span class="hljs-params">resp</span> =&gt;</span> resp.<span class="hljs-property">data</span>)
    .<span class="hljs-title function_">filterAsync</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> product.<span class="hljs-property">price</span> &gt; <span class="hljs-number">100</span>)
    .<span class="hljs-title function_">sortBy</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> product.<span class="hljs-property">price</span>, <span class="hljs-string">'asc'</span>)
    .<span class="hljs-title function_">takeAsync</span>(<span class="hljs-number">50</span>)
    .<span class="hljs-title function_">toArrayAsync</span>({ <span class="hljs-attr">threads</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">errors</span>: <span class="hljs-string">'include'</span> });
</code></pre>
    </div></div></div></div><div id="solution29" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 29</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If you'd like to iterate over all elements concurrently:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncForEach</span>(<span class="hljs-params">arr, fn</span>) {
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(arr.<span class="hljs-title function_">map</span>(fn));
}
</code></pre>
<p>If you'd like to iterate over all elements non-concurrently (e.g. when your mapping function has side effects or running mapper over all array elements at once would be too resource costly):</p>
<p>Option A: Promises</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncForEachStrict</span>(<span class="hljs-params">arr, fn</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    arr.<span class="hljs-title function_">reduce</span>(
      <span class="hljs-function">(<span class="hljs-params">promise, cur, idx</span>) =&gt;</span> promise
        .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">fn</span>(cur, idx, arr)),
      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(),
    ).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>());
  });
}
</code></pre>
<p>Option B: async/await</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncForEachStrict</span>(<span class="hljs-params">arr, fn</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> idx = <span class="hljs-number">0</span>; idx &lt; arr.<span class="hljs-property">length</span>; idx += <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">const</span> cur = arr[idx];

    <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>(cur, idx, arr);
  }
}
</code></pre>
    </div></div></div></div><div id="solution30" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 30</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/node.js">node.js</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/async-await">async-await</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/ecmascript-2017">ecmascript-2017</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><strong>If you can't use async/await</strong> (IE11, old packer, etc.) then you can try this recursive function. I used <code>fetch</code> as my asynchronous call, but you could use any function that returns a promise.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> urlsToGet = [<span class="hljs-string">'https://google.com'</span>, <span class="hljs-string">'https://yahoo.com'</span>];

<span class="hljs-title function_">fetchOneAtATime</span>(urlsToGet);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchOneAtATime</span>(<span class="hljs-params">urls</span>) {
    <span class="hljs-keyword">if</span> (urls.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-title function_">fetch</span>(urls[<span class="hljs-number">0</span>]).<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">fetchOneAtATime</span>(urls.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>)));
}
</code></pre>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/how-do-i-modify-the-url-without-reloading-the-page-1657387509731">How do I modify the URL without reloading the page?</a><a href="/questions/when-to-use-virtual-destructors-1657388152135">When to use virtual destructors?</a><a href="/questions/correctly-allocating-multi-dimensional-arrays-1657387733756">Correctly allocating multi-dimensional arrays</a><a href="/questions/how-to-make-good-reproducible-pandas-examples-1657384310402">How to make good reproducible pandas examples</a><a href="/questions/flatten-an-irregular-list-of-lists-1657387315571">Flatten an irregular list of lists</a><a href="/questions/why-do-regex-constructors-need-to-be-double-escaped-1657388004942">Why do regex constructors need to be double escaped?</a><a href="/questions/what-is-the-best-way-to-detect-a-mobile-device-1657387665025">What is the best way to detect a mobile device?</a><a href="/questions/how-does-the-%22this%22-keyword-work-and-when-should-it-be-used-1657384384385">How does the &quot;this&quot; keyword work, and when should it be used?</a><a href="/questions/what&#x27;s-the-meaning-of-%22greater%22-(an-arrow-formed-from-equals-and-greater-than)-in-javascript-1657387977118">What&#x27;s the meaning of &quot;=&gt;&quot; (an arrow formed from equals &amp; greater than) in JavaScript?</a><a href="/questions/how-to-use-variables-in-sql-statement-in-python-1657388479077">How to use variables in SQL statement in Python?</a><a href="/questions/why-is-my-variable-unaltered-after-i-modify-it-inside-of-a-function-asynchronous-code-reference-1657384288966">Why is my variable unaltered after I modify it inside of a function? - Asynchronous code reference</a><a href="/questions/how-do-i-detect-collision-in-pygame-1657387496338">How do I detect collision in pygame?</a><a href="/questions/how-do-i-use-extern-to-share-variables-between-source-files-1657387453605">How do I use extern to share variables between source files?</a><a href="/questions/how-do-i-generate-random-integers-within-a-specific-range-in-java-1657385458888">How do I generate random integers within a specific range in Java?</a><a href="/questions/how-do-i-compose-a-rotation-matrix-with-human-readable-angles-from-scratch-1657387963457">How do I compose a rotation matrix with human readable angles from scratch?</a><a href="/questions/how-to-choose-the-right-bean-scope-1657387596513">How to choose the right bean scope?</a><a href="/questions/how-can-i-read-inputs-as-numbers-1657384503324">How can I read inputs as numbers?</a><a href="/questions/what-do-&#x27;lazy&#x27;-and-&#x27;greedy&#x27;-mean-in-the-context-of-regular-expressions-1657388200552">What do &#x27;lazy&#x27; and &#x27;greedy&#x27; mean in the context of regular expressions?</a><a href="/questions/align-inline-block-divs-to-top-of-container-element-1657387489610">Align inline-block DIVs to top of container element</a><a href="/questions/mysqli-or-die-does-it-have-to-die-1657388533922">mysqli or die, does it have to die?</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;Sure the code does work, but I\u0026apos;m pretty sure it doesn\u0026apos;t do what you expect it to do. It just fires off multiple asynchronous calls, but the \u0026lt;code\u0026gt;printFiles\u0026lt;/code\u0026gt; function does immediately return after that.\u0026lt;/p\u0026gt;\n\n\u0026lt;h3\u0026gt;Reading in sequence\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;If you want to read the files in sequence, \u0026lt;strong\u0026gt;you cannot use \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt;\u0026lt;/strong\u0026gt; indeed. Just use a modern \u0026lt;code\u0026gt;for  of\u0026lt;/code\u0026gt; loop instead, in which \u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt; will work as expected:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; () {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;();\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; file \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; files) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents);\n  }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;h3\u0026gt;Reading in parallel\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;If you want to read the files in parallel, \u0026lt;strong\u0026gt;you cannot use \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt;\u0026lt;/strong\u0026gt; indeed. Each of the \u0026lt;code\u0026gt;async\u0026lt;/code\u0026gt; callback function calls does return a promise, but you\u0026apos;re throwing them away instead of awaiting them. Just use \u0026lt;code\u0026gt;map\u0026lt;/code\u0026gt; instead, and you can await the array of promises that you\u0026apos;ll get with \u0026lt;code\u0026gt;Promise.all\u0026lt;/code\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; () {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;();\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;(files.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (file) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;)\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents)\n  }));\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;With ES2018, you are able to greatly simplify all of the above answers to:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; () {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;()\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; files.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;))) {\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents)\n  }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;See spec: \u0026lt;a href=\u0026quot;https://github.com/tc39/proposal-async-iteration\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;proposal-async-iteration\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Simplified:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; results \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; array) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;longRunningTask\u0026lt;/span\u0026gt;()\n  }\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;I will wait\u0026apos;\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;2018-09-10: This answer has been getting a lot of attention recently, please see \u0026lt;a href=\u0026quot;http://2ality.com/2016/10/asynchronous-iteration.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Axel Rauschmayer\u0026apos;s blog post\u0026lt;/a\u0026gt; for further information about asynchronous iteration.\u0026lt;/p\u0026gt;\n    ","\n\n\n\u0026lt;p\u0026gt;Instead of \u0026lt;code\u0026gt;Promise.all\u0026lt;/code\u0026gt; in conjunction with \u0026lt;code\u0026gt;Array.prototype.map\u0026lt;/code\u0026gt; (which does not guarantee the order in which the \u0026lt;code\u0026gt;Promise\u0026lt;/code\u0026gt;s are resolved), I use \u0026lt;code\u0026gt;Array.prototype.reduce\u0026lt;/code\u0026gt;, starting with a resolved \u0026lt;code\u0026gt;Promise\u0026lt;/code\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; () {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;();\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; files.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reduce\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (promise, file) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// This line will wait for the last async function to finish.\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// The first iteration uses an already resolved Promise\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// so, it will immediately continue.\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; promise;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents);\n  }, \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;());\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The \u0026lt;a href=\u0026quot;https://github.com/toniov/p-iteration\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;p-iteration\u0026lt;/a\u0026gt; module on npm implements the Array iteration methods so they can be used in a very straightforward way with async/await.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;An example with your case:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; { forEach } = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;p-iteration\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; fs = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs-promise\u0026apos;\u0026lt;/span\u0026gt;);\n\n(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; () {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;();\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(files, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (file) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents);\n  });\n})();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Here are some \u0026lt;code\u0026gt;forEachAsync\u0026lt;/code\u0026gt; prototypes. Note you\u0026apos;ll need to \u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt; them:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;forEachAsync\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; t \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;) { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;(t) }\n}\n\n\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;forEachAsyncParallel\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(fn));\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Note\u0026lt;/strong\u0026gt; while you may include this in your own code, you should not include this in libraries you distribute to others (to avoid polluting their globals).\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;h2\u0026gt;Picture worth 1000 words - For Sequential Approach Only\u0026lt;/h2\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Background\u0026lt;/strong\u0026gt; : I was in similar situation last night. I used async function as foreach argument. The result was un-predictable. When I did testing for my code 3 times, it ran without issues 2 times and failed 1 time. (something weird)\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Finally I got my head around \u0026amp;amp; did some scratch pad testing.\u0026lt;/p\u0026gt;\n\u0026lt;h3\u0026gt;Scenario 1 - How un-sequential it can get with async in foreach\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://i.stack.imgur.com/VGXEa.png\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;https://i.stack.imgur.com/VGXEa.png\u0026quot; alt=\u0026quot;enter image description here\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getPromise\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;time\u0026lt;/span\u0026gt;) =\u0026amp;gt; { \n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n      \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`Promise resolved for \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${time}\u0026lt;/span\u0026gt;s`\u0026lt;/span\u0026gt;)\n    }, time)\n  })\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; myPromiseArray = [\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1000\u0026lt;/span\u0026gt;), \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;500\u0026lt;/span\u0026gt;), \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3000\u0026lt;/span\u0026gt;)]\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Before For Each Loop\u0026apos;\u0026lt;/span\u0026gt;)\n\n  myPromiseArray.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (element, index) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; result = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; element;\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(result);\n  })\n\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;After For Each Loop\u0026apos;\u0026lt;/span\u0026gt;)\n}\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;h3\u0026gt;Scenario 2 - Using \u0026lt;code\u0026gt;for - of\u0026lt;/code\u0026gt; loop as @Bergi above suggested\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://i.stack.imgur.com/QWbRI.png\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;https://i.stack.imgur.com/QWbRI.png\u0026quot; alt=\u0026quot;enter image description here\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getPromise\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;time\u0026lt;/span\u0026gt;) =\u0026amp;gt; { \n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n      \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`Promise resolved for \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${time}\u0026lt;/span\u0026gt;s`\u0026lt;/span\u0026gt;)\n    }, time)\n  })\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; myPromiseArray = [\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1000\u0026lt;/span\u0026gt;), \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;500\u0026lt;/span\u0026gt;), \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3000\u0026lt;/span\u0026gt;)]\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Before For Each Loop\u0026apos;\u0026lt;/span\u0026gt;)\n\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// AVOID USING THIS\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// myPromiseArray.forEach(async (element, index) =\u0026amp;gt; {\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//   let result = await element;\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//   console.log(result);\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// })\u0026lt;/span\u0026gt;\n\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// This works well\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; element \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; myPromiseArray) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; result = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; element;\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(result)\n  }\n\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;After For Each Loop\u0026apos;\u0026lt;/span\u0026gt;)\n}\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;If you are little old school like me, you could simply use the classic for loop, that works too :)\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getPromise\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;time\u0026lt;/span\u0026gt;) =\u0026amp;gt; { \n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n      \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`Promise resolved for \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${time}\u0026lt;/span\u0026gt;s`\u0026lt;/span\u0026gt;)\n    }, time)\n  })\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; myPromiseArray = [\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1000\u0026lt;/span\u0026gt;), \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;500\u0026lt;/span\u0026gt;), \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getPromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3000\u0026lt;/span\u0026gt;)]\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Before For Each Loop\u0026apos;\u0026lt;/span\u0026gt;)\n\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// AVOID USING THIS\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// myPromiseArray.forEach(async (element, index) =\u0026amp;gt; {\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//   let result = await element;\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//   console.log(result);\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// })\u0026lt;/span\u0026gt;\n\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// This works well too - the classic for loop :)\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; i = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; myPromiseArray.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;; i++) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; result = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; myPromiseArray[i];\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(result);\n  }\n\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;After For Each Loop\u0026apos;\u0026lt;/span\u0026gt;)\n}\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;I hope this helps someone, good day, cheers!\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;@Bergi has already gave the answer on how to handle this particular case properly. I\u0026apos;ll not duplicate here.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I\u0026apos;d like to address the difference between using \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;for\u0026lt;/code\u0026gt; loop when it comes to \u0026lt;code\u0026gt;async\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;how \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt; works\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Let\u0026apos;s look at how \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt; works. According to \u0026lt;a href=\u0026quot;https://tc39.es/ecma262/multipage/indexed-collections.html#sec-array.prototype.foreach\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;ECMAScript Specification\u0026lt;/a\u0026gt;, MDN provides an \u0026lt;a href=\u0026quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach#polyfill\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;implementation\u0026lt;/a\u0026gt; which can be used as a polyfill. I copy it and paste here with comments removal.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;callback, thisArg\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt; == \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;) { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;throw\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;TypeError\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Array.prototype.forEach called on null or undefined\u0026apos;\u0026lt;/span\u0026gt;); }\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; T, k;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; O = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Object\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; len = O.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt; \u0026amp;gt;\u0026amp;gt;\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;typeof\u0026lt;/span\u0026gt; callback !== \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;function\u0026quot;\u0026lt;/span\u0026gt;) { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;throw\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;TypeError\u0026lt;/span\u0026gt;(callback + \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; is not a function\u0026apos;\u0026lt;/span\u0026gt;); }\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;arguments\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt; \u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;) { T = thisArg; }\n  k = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt; (k \u0026amp;lt; len) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; kValue;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (k \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; O) {\n      kValue = O[k];\n      callback.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;call\u0026lt;/span\u0026gt;(T, kValue, k, O); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// pay attention to this line\u0026lt;/span\u0026gt;\n    }\n    k++;\n  }\n};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Let\u0026apos;s back to your code, let\u0026apos;s extract the callback as a function.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt;){\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;)\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents)\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;So, basically \u0026lt;code\u0026gt;callback\u0026lt;/code\u0026gt; returns a promise since it\u0026apos;s declared with \u0026lt;code\u0026gt;async\u0026lt;/code\u0026gt;. Inside \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;callback\u0026lt;/code\u0026gt; is just called in a normal way, if the callback itself returns a promise, the javascript engine will not wait it to be resolved or rejected. Instead, it puts the \u0026lt;code\u0026gt;promise\u0026lt;/code\u0026gt; in a job queue, and continues executing the loop.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;How about \u0026lt;code\u0026gt;await fs.readFile(file, \u0026apos;utf8\u0026apos;)\u0026lt;/code\u0026gt; inside the \u0026lt;code\u0026gt;callback\u0026lt;/code\u0026gt;?\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Basically, when your async \u0026lt;code\u0026gt;callback\u0026lt;/code\u0026gt; gets the chance to be executed, the js engine will pause until \u0026lt;code\u0026gt;fs.readFile(file, \u0026apos;utf8\u0026apos;)\u0026lt;/code\u0026gt; to be resolved or rejected, and resume execution of the async function after fulfillment. So the \u0026lt;code\u0026gt;contents\u0026lt;/code\u0026gt; variable store the actual result from \u0026lt;code\u0026gt;fs.readFile\u0026lt;/code\u0026gt;, not a \u0026lt;code\u0026gt;promise\u0026lt;/code\u0026gt;. So, \u0026lt;code\u0026gt;console.log(contents)\u0026lt;/code\u0026gt; logs out the file content not a \u0026lt;code\u0026gt;Promise\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Why \u0026lt;code\u0026gt;for ... of\u0026lt;/code\u0026gt; works?\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;when we write a generic \u0026lt;code\u0026gt;for of\u0026lt;/code\u0026gt; loop, we gain more control than \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt;. Let\u0026apos;s refactor \u0026lt;code\u0026gt;printFiles\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; () {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;() \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Assume this works fine\u0026lt;/span\u0026gt;\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; file \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; files) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;)\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents)\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// or await callback(file)\u0026lt;/span\u0026gt;\n  }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;When evaluate \u0026lt;code\u0026gt;for\u0026lt;/code\u0026gt; loop, we have \u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt; promise inside the \u0026lt;code\u0026gt;async\u0026lt;/code\u0026gt; function, the execution will pause until the \u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt; promise is settled. So, you can think of that the files are read one by one in a determined order.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Execute sequentially\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Sometimes, we really need the the async functions to be executed in a sequential order. For example, I have a few new records stored in an array to be saved to database, and I want them to be saved in sequential order which means first record in array should be saved first, then second, until last one is saved.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Here is an example:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\u0026lt;div class=\u0026quot;snippet\u0026quot; data-lang=\u0026quot;js\u0026quot; data-hide=\u0026quot;false\u0026quot; data-console=\u0026quot;true\u0026quot; data-babel=\u0026quot;false\u0026quot;\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-code\u0026quot;\u0026gt;\n\u0026lt;pre class=\u0026quot;snippet-code-js lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; records = [\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;];\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;saveRecord\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;record\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolved, rejected\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;()=\u0026amp;gt;\u0026lt;/span\u0026gt; {\n      \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolved\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`record \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${record}\u0026lt;/span\u0026gt; saved`\u0026lt;/span\u0026gt;)\n    }, \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;() * \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;500\u0026lt;/span\u0026gt;)\n  });\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEachSaveRecords\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;records\u0026lt;/span\u0026gt;) {\n  records.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (record) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; res = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;saveRecord\u0026lt;/span\u0026gt;(record);\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(res);\n  })\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forofSaveRecords\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;records\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; record \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; records) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; res = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;saveRecord\u0026lt;/span\u0026gt;(record);\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(res);\n  }\n}\n(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; () =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;=== for of save records ===\u0026quot;\u0026lt;/span\u0026gt;)\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forofSaveRecords\u0026lt;/span\u0026gt;(records)\n  \n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;=== forEach save records ===\u0026quot;\u0026lt;/span\u0026gt;)\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEachSaveRecords\u0026lt;/span\u0026gt;(records)\n})()\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-result\u0026quot;\u0026gt;\u0026lt;div class=\u0026quot;snippet-ctas\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn s-btn__primary\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;icon-play-white _hover\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;span\u0026gt; Run code snippet\u0026lt;/span\u0026gt;\u0026lt;/button\u0026gt;\u0026lt;input class=\u0026quot;copySnippet s-btn s-btn__filled\u0026quot; type=\u0026quot;button\u0026quot; value=\u0026quot;Copy snippet to answer\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn hideResults\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;Hide results\u0026lt;/button\u0026gt;\u0026lt;div class=\u0026quot;popout-code\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;snippet-expand-link\u0026quot;\u0026gt;Expand snippet\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;div class=\u0026quot;snippet-result-code\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;iframe name=\u0026quot;sif1\u0026quot; sandbox=\u0026quot;allow-forms allow-modals allow-scripts\u0026quot; class=\u0026quot;snippet-box-edit snippet-box-result\u0026quot; frameborder=\u0026quot;0\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I use \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt; to simulate the process of saving a record to database - it\u0026apos;s asynchronous and cost a random time. Using \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt;, the records are saved in an undetermined order, but using \u0026lt;code\u0026gt;for..of\u0026lt;/code\u0026gt;, they are saved sequentially.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;This solution is also memory-optimized so you can run it on 10,000\u0026apos;s of data items and requests. Some of the other solutions here will crash the server on large data sets.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;In TypeScript:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;export\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; asyncForEach\u0026amp;lt;T\u0026amp;gt;(\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;\u0026amp;lt;T\u0026amp;gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;item: T, index: number\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;void\u0026lt;/span\u0026gt;\u0026amp;gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; index = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; index \u0026amp;lt; array.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;; index++) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;(array[index], index);\n        }\n    }\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;How to use?\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asyncForEach\u0026lt;/span\u0026gt;(receipts, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (eachItem) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; ...\n})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;blockquote\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;files.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (file) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;)\n})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;The issue is, the promise returned by the iteration function is ignored by \u0026lt;code\u0026gt;forEach()\u0026lt;/code\u0026gt;. As a result, all the \u0026lt;code\u0026gt;fs.readFile\u0026lt;/code\u0026gt; functions\nare invoked in the same round of the event loop, which means they are started in parallel, not in sequential, and the execution continues immediately after invoking forEach(), without\nwaiting for all the \u0026lt;code\u0026gt;fs.readFile\u0026lt;/code\u0026gt; operations to complete. Since forEach does not wait for each promise to resolve, the loop actually finishes iterating before promises are resolved.  You may end up trying to access values that are not available yet.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In addition to \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/37576787/877703\u0026quot;\u0026gt;@Bergis answer\u0026lt;/a\u0026gt;, Id like to offer a third alternative. It\u0026apos;s very similar to @Bergis 2nd example, but instead of awaiting each \u0026lt;code\u0026gt;readFile\u0026lt;/code\u0026gt; individually, you create an array of promises, each which you await at the end.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; fs \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs-promise\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; () {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;();\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; promises = files.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;))\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;(promises)\n\n  contents.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;);\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Note that the function passed to \u0026lt;code\u0026gt;.map()\u0026lt;/code\u0026gt; does not need to be \u0026lt;code\u0026gt;async\u0026lt;/code\u0026gt;, since \u0026lt;code\u0026gt;fs.readFile\u0026lt;/code\u0026gt; returns a Promise object anyway. Therefore \u0026lt;code\u0026gt;promises\u0026lt;/code\u0026gt; is an array of Promise objects, which can be sent to \u0026lt;code\u0026gt;Promise.all()\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;In @Bergis answer, the console may log file contents in the order theyre read. For example if a really small file finishes reading before a really large file, it will be logged first, even if the small file comes \u0026lt;em\u0026gt;after\u0026lt;/em\u0026gt; the large file in the \u0026lt;code\u0026gt;files\u0026lt;/code\u0026gt; array. However, in my method above, you are guaranteed the console will log the files in the same order as the provided array.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;A simple drop-in solution for replacing a \u0026lt;code\u0026gt;forEach()\u0026lt;/code\u0026gt; await loop that is not working is replacing \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt; with \u0026lt;code\u0026gt;map\u0026lt;/code\u0026gt; and adding \u0026lt;code\u0026gt;Promise.all(\u0026lt;/code\u0026gt; to the beginning.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For example:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;await y.forEach(async (x) =\u0026amp;gt; {\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;to\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;await Promise.all(y.map(async (x) =\u0026amp;gt; {\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;An extra \u0026lt;code\u0026gt;)\u0026lt;/code\u0026gt; is needed at the end.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;it\u0026apos;s pretty painless to pop a couple methods in a file that will handle asynchronous data in a serialized order and give a more conventional flavour to your code.  For example:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;module\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;exports\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; self = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;;\n\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;each\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (items, fn) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (items \u0026amp;amp;\u0026amp;amp; items.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;) {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;(\n        items.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (item) =\u0026amp;gt; {\n          \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;(item);\n        }));\n    }\n  };\n\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;reduce\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (items, fn, initialValue) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; self.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;each\u0026lt;/span\u0026gt;(\n      items, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (item) =\u0026amp;gt; {\n        initialValue = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;(initialValue, item);\n      });\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; initialValue;\n  };\n};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;now, assuming that\u0026apos;s saved at \u0026apos;./myAsync.js\u0026apos; you can do something similar to the below in an adjacent file:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;...\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/* your server setup here */\u0026lt;/span\u0026gt;\n...\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;MyAsync\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;./myAsync\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Cat\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;./models/Cat\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Doje\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;./models/Doje\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;example\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; myAsync = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;MyAsync\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; doje = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Doje\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;findOne\u0026lt;/span\u0026gt;({ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;name\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Doje\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;noises\u0026lt;/span\u0026gt;: [] }).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;save\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; cleanParams = [];\n\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// FOR EACH EXAMPLE\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; myAsync.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;each\u0026lt;/span\u0026gt;([\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;bork\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;concern\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;heck\u0026apos;\u0026lt;/span\u0026gt;], \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (elem) =\u0026amp;gt; {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (elem !== \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;heck\u0026apos;\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; doje.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;update\u0026lt;/span\u0026gt;({ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$push\u0026lt;/span\u0026gt;: { \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;noises\u0026apos;\u0026lt;/span\u0026gt;: elem }});\n      }\n    });\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; cat = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Cat\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;findOne\u0026lt;/span\u0026gt;({ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;name\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Nyan\u0026apos;\u0026lt;/span\u0026gt; });\n\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// REDUCE EXAMPLE\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; friendsOfNyanCat = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; myAsync.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reduce\u0026lt;/span\u0026gt;(cat.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;friends\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (catArray, friendId) =\u0026amp;gt; {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; friend = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Friend\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;findById\u0026lt;/span\u0026gt;(friendId);\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (friend.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;name\u0026lt;/span\u0026gt; !== \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Long cat\u0026apos;\u0026lt;/span\u0026gt;) {\n        catArray.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(friend.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;name\u0026lt;/span\u0026gt;);\n      }\n    }, []);\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Assuming Long Cat was a friend of Nyan Cat...\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;assert\u0026lt;/span\u0026gt;(friendsOfNyanCat.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt; === (cat.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;friends\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt; - \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;));\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://stackoverflow.com/a/37576787/3241111\u0026quot;\u0026gt;Bergi\u0026apos;s solution\u0026lt;/a\u0026gt; works nicely when \u0026lt;code\u0026gt;fs\u0026lt;/code\u0026gt; is promise based.\nYou can use \u0026lt;code\u0026gt;bluebird\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;fs-extra\u0026lt;/code\u0026gt; or \u0026lt;code\u0026gt;fs-promise\u0026lt;/code\u0026gt; for this.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;However, solution for\u0026lt;/strong\u0026gt; node\u0026apos;s native \u0026lt;code\u0026gt;fs\u0026lt;/code\u0026gt; libary is as follows:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; result = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;(filePaths\n    .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; filePath =\u0026amp;gt; {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; fileContents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getAssetFromCache\u0026lt;/span\u0026gt;(filePath, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// 1. Wrap with Promise    \u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// 2. Return the result of the Promise\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;res, rej\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n          fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(filePath, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;err, data\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (data) {\n              \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;res\u0026lt;/span\u0026gt;(data);\n            }\n          });\n        });\n      });\n\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; fileContents;\n    }));\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Note:\u0026lt;/strong\u0026gt;\n\u0026lt;code\u0026gt;require(\u0026apos;fs\u0026apos;)\u0026lt;/code\u0026gt; compulsorily takes function as 3rd arguments, otherwise throws error:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;TypeError\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;ERR_INVALID_CALLBACK\u0026lt;/span\u0026gt;]: \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Callback\u0026lt;/span\u0026gt; must be a \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;It is not good to call an asynchronous method from a loop. This is because each loop iteration will be delayed until the entire asynchronous operation completes. That is not very performant. It also averts the advantages of parallelization benefits of \u0026lt;code\u0026gt;async\u0026lt;/code\u0026gt;/\u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;A better solution would be to create all promises at once, then get access to the results using \u0026lt;code\u0026gt;Promise.all()\u0026lt;/code\u0026gt;. Otherwise, each successive operation will not start until the previous one has completed.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Consequently, the code may be refactored as follows;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; results = [];\n  files.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    results.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;));\n  });\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;(results);\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents);\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;One important \u0026lt;strong\u0026gt;caveat\u0026lt;/strong\u0026gt; is: The \u0026lt;code\u0026gt;await + for .. of\u0026lt;/code\u0026gt; method and the \u0026lt;code\u0026gt;forEach + async\u0026lt;/code\u0026gt; way actually have different effect. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Having \u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt; inside a real \u0026lt;code\u0026gt;for\u0026lt;/code\u0026gt; loop will make sure all async calls are executed one by one. And the \u0026lt;code\u0026gt;forEach + async\u0026lt;/code\u0026gt; way will fire off all promises at the same time, which is faster but sometimes overwhelmed(\u0026lt;strong\u0026gt;if you do some DB query or visit some web services with volume restrictions\u0026lt;/strong\u0026gt; and do not want to fire 100,000 calls at a time). \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You can also use \u0026lt;code\u0026gt;reduce + promise\u0026lt;/code\u0026gt;(less elegant) if you do not use \u0026lt;code\u0026gt;async/await\u0026lt;/code\u0026gt; and want to make sure files are read \u0026lt;strong\u0026gt;one after another\u0026lt;/strong\u0026gt;. \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;files.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reduce\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;lastPromise, file\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; \n lastPromise.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; \n   fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;)\n ), \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;()\n)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Or you can create a forEachAsync to help but basically use the same for loop underlying.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;forEachAsync\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;){\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; x \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;){\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;(x);\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Both the solutions above work, however, Antonio\u0026apos;s does the job with less code, here is how it helped me resolve data from my database, from several different child refs and then pushing them all into an array and resolving it in a promise after all is done:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;PacksList\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;pack\u0026lt;/span\u0026gt;)=\u0026amp;gt;\u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; fireBaseRef.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;child\u0026lt;/span\u0026gt;(pack.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;folderPath\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;once\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;value\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;snap\u0026lt;/span\u0026gt;)=\u0026amp;gt;\u0026lt;/span\u0026gt;{\n        snap.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;childSnap\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; file = childSnap.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;val\u0026lt;/span\u0026gt;()\n            file.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt; = childSnap.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;key\u0026lt;/span\u0026gt;;\n            allItems.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;( file )\n        })\n    })\n})).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;()=\u0026amp;gt;\u0026lt;/span\u0026gt;store.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;dispatch\u0026lt;/span\u0026gt;( actions.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;allMockupItems\u0026lt;/span\u0026gt;(allItems)))\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Just adding to the original answer\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The parallel reading syntax in the original answer is sometimes confusing and difficult to read, maybe we can write it in a different approach\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; fileReadPromises = [];\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readAndLogFile\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; filePath =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;utf8\u0026quot;\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; contents;\n  };\n\n  files.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    fileReadPromises.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readAndLogFile\u0026lt;/span\u0026gt;(file));\n  });\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;(fileReadPromises);\n}\n\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;For sequential operation, not just \u0026lt;strong\u0026gt;for...of\u0026lt;/strong\u0026gt;, normal for loop will also work\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;();\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; i = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; files.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;; i++) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; file = files[i];\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;utf8\u0026quot;\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents);\n  }\n}\n\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Like @Bergi\u0026apos;s response, but with one difference.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;Promise.all\u0026lt;/code\u0026gt; rejects all promises if one gets rejected.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;So, use a recursion.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; readFilesQueue = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (files, index = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(files[index], \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;)\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents)\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; files.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt; \u0026amp;lt;= index\n        ? \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFilesQueue\u0026lt;/span\u0026gt;(files, ++index)\n        : files\n\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; printFiles \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;();\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; printContents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFilesQueue\u0026lt;/span\u0026gt;(files)\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; printContents\n}\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;()\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;PS\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;readFilesQueue\u0026lt;/code\u0026gt; is outside of \u0026lt;code\u0026gt;printFiles\u0026lt;/code\u0026gt; cause the side effect* introduced by \u0026lt;code\u0026gt;console.log\u0026lt;/code\u0026gt;, it\u0026apos;s better to mock, test, and or spy so, it\u0026apos;s not cool to have a function that returns the content(sidenote).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Therefore, the code can simply be designed by that: three separated functions that are \u0026quot;pure\u0026quot;** and introduce no side effects, process the entire list and can easily be modified to handle failed cases.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilesPath\u0026lt;/span\u0026gt;()\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFile\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; content = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;)\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(content)\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; readFiles = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;files, index = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFile\u0026lt;/span\u0026gt;(files[index])\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; files.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;lengh\u0026lt;/span\u0026gt; \u0026amp;lt;= index\n        ? \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFiles\u0026lt;/span\u0026gt;(files, ++index)\n        : files\n}\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFiles\u0026lt;/span\u0026gt;(files)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Future edit/current state\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Node supports top-level await (this doesn\u0026apos;t have a plugin yet, won\u0026apos;t have and can be enabled via harmony flags), it\u0026apos;s cool but doesn\u0026apos;t solve one problem (strategically I work only on LTS versions). How to get the files?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Using composition. Given the code, causes to me a sensation that this is inside a module, so, should have a function to do it. If not, you should use an IIFE to wrap the role code into an async function creating simple module that\u0026apos;s do all for you, or you can go with the right way, there is, composition.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// more complex version with IIFE to a single module\u0026lt;/span\u0026gt;\n(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (files) =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFiles\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;files\u0026lt;/span\u0026gt;())(getFilesPath)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Note that the name of variable changes due to semantics. You pass a functor (a function that can be invoked by another function) and recieves a pointer on memory that contains the initial block of logic of the application.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;But, if\u0026apos;s not a module and you need to export the logic?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Wrap the functions in a async function.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;export\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFilesQueue\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// ... to code goes here\u0026lt;/span\u0026gt;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Or change the names of variables, whatever...\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;*\u0026lt;/code\u0026gt; by side effect menans any colacteral effect of application  that can change the statate/behaviour or introuce bugs in the application, like IO.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;**\u0026lt;/code\u0026gt; by \u0026quot;pure\u0026quot;, it\u0026apos;s in apostrophe since the functions it\u0026apos;s not pure and the code can be converged to a pure version, when there\u0026apos;s no console output, only data manipulations.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Aside this, to be pure, you\u0026apos;ll need to work with monads that handles the side effect, that are error prone, and treats that error separately of the application. \u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Today I came across multiple solutions for this. Running the async await functions in the forEach Loop. By building the wrapper around we can make this happen.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://www.creospiders.com/2019/11/api-call-or-async-await-not-working-in.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;More detailed explanation on how it works internally, for the native forEach and why it is not able to make a async function call and other details on the various methods are provided in link here\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The multiple ways through which it can be done and they are as follows,\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Method 1 : Using the wrapper.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;()=\u0026amp;gt;\u0026lt;/span\u0026gt;{\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve,reject\u0026lt;/span\u0026gt;)=\u0026amp;gt;\u0026lt;/span\u0026gt;{\n       items.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (item,index)=\u0026amp;gt;{\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;try\u0026lt;/span\u0026gt;{\n               \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someAPICall\u0026lt;/span\u0026gt;();\n           } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(e) {\n              \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(e)\n           }\n           count++;\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;(index === items.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;-\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;){\n             \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Done\u0026apos;\u0026lt;/span\u0026gt;)\n           }\n         });\n     });\n    })();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Method 2: Using the same as a generic function of Array.prototype\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Array.prototype.forEachAsync.js\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;(!\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;forEachAsync\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;forEachAsync\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;){\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve,reject\u0026lt;/span\u0026gt;)=\u0026amp;gt;\u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt;(item,index,array)=\u0026amp;gt;{\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;(item,index,array);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;(index === array.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;-\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;){\n                \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;done\u0026apos;\u0026lt;/span\u0026gt;);\n            }\n        })\n      });\n    };\n  }\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Usage : \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;./Array.prototype.forEachAsync\u0026apos;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; count = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;hello\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;items\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Method 1 - Using the Array.prototype.forEach \u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; items.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEachAsync\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; () =\u0026amp;gt; {\n         \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;try\u0026lt;/span\u0026gt;{\n               \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someAPICall\u0026lt;/span\u0026gt;();\n           } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(e) {\n              \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(e)\n           }\n        count++;\n    });\n\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;count = \u0026quot;\u0026lt;/span\u0026gt; + count);\n}\n\nsomeAPICall = \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n            \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;done\u0026quot;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// or reject(\u0026apos;error\u0026apos;)\u0026lt;/span\u0026gt;\n        }, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;);\n    })\n}\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;hello\u0026lt;/span\u0026gt;([\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;]); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// hello([]) empty array is also be handled by default\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Method 3 :\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Using Promise.all\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;(items.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (item) =\u0026amp;gt; {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someAPICall\u0026lt;/span\u0026gt;();\n        count++;\n    }));\n\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;count = \u0026quot;\u0026lt;/span\u0026gt; + count);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Method 4 : Traditional for loop or modern for loop\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Method 4 - using for loop directly\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// 1. Using the modern for(.. in..) loop\u0026lt;/span\u0026gt;\n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(item \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; items){\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someAPICall\u0026lt;/span\u0026gt;();\n        count++;\n    }\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//2. Using the traditional for loop \u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; i=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;i\u0026amp;lt;items.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;;i++){\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;someAPICall\u0026lt;/span\u0026gt;();\n        count++;\n    }\n\n\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;count = \u0026quot;\u0026lt;/span\u0026gt; + count);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;You can use \u0026lt;code\u0026gt;Array.prototype.forEach\u0026lt;/code\u0026gt;, but async/await is not so compatible. This is because the promise returned from an async callback expects to be resolved, but \u0026lt;code\u0026gt;Array.prototype.forEach\u0026lt;/code\u0026gt; does not resolve any promises from the execution of its callback. So then, you can use forEach, but you\u0026apos;ll have to handle the promise resolution yourself.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Here is a way to read and print each file in series using \u0026lt;code\u0026gt;Array.prototype.forEach\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFilesInSeries\u0026lt;/span\u0026gt; () {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;()\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; promiseChain = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;()\n  files.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    promiseChain = promiseChain.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n      fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;contents\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents)\n      })\n    })\n  })\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; promiseChain\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Here is a way (still using \u0026lt;code\u0026gt;Array.prototype.forEach\u0026lt;/code\u0026gt;) to print the contents of files in parallel\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFilesInParallel\u0026lt;/span\u0026gt; () {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;()\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; promises = []\n  files.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    promises.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(\n      fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;contents\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents)\n      })\n    )\n  })\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;(promises)\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Currently the Array.forEach prototype property doesn\u0026apos;t support async operations, but we can create our own poly-fill to meet our needs.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Example of asyncForEach Array poly-fill for NodeJs\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// file: asyncForEach.js\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Define asynForEach function \u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asyncForEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;iteratorFunction\u0026lt;/span\u0026gt;){\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; indexer = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; data \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;){\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;iteratorFunction\u0026lt;/span\u0026gt;(data, indexer)\n    indexer++\n  }\n}\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Append it as an Array prototype property\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;asyncForEach\u0026lt;/span\u0026gt; = asyncForEach\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;module\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;exports\u0026lt;/span\u0026gt; = {\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;And that\u0026apos;s it! You now have an async forEach method available on any arrays that are defined after these to operations.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Let\u0026apos;s test it...\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Nodejs style\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// file: someOtherFile.js\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; readline = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;readline\u0026apos;\u0026lt;/span\u0026gt;)\n\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;./asyncForEach\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; log = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Create a stream interface\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;createReader\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;options={prompt: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026amp;gt;\u0026apos;\u0026lt;/span\u0026gt;}\u0026lt;/span\u0026gt;){\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; readline.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;createInterface\u0026lt;/span\u0026gt;({\n    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;input\u0026lt;/span\u0026gt;: process.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;stdin\u0026lt;/span\u0026gt;\n    ,\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;output\u0026lt;/span\u0026gt;: process.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;stdout\u0026lt;/span\u0026gt;\n    ,\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;prompt\u0026lt;/span\u0026gt;: options.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;prompt\u0026lt;/span\u0026gt; !== \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;undefined\u0026lt;/span\u0026gt; ? options.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;prompt\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026amp;gt;\u0026apos;\u0026lt;/span\u0026gt;\n  })\n}\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Create a cli stream reader\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getUserIn\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;question, options={prompt:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026amp;gt;\u0026apos;\u0026lt;/span\u0026gt;}\u0026lt;/span\u0026gt;){\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(question)\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; reader = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;createReader\u0026lt;/span\u0026gt;(options)\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;res\u0026lt;/span\u0026gt;)=\u0026amp;gt;\u0026lt;/span\u0026gt;{\n    reader.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;on\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;line\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;answer\u0026lt;/span\u0026gt;)=\u0026amp;gt;\u0026lt;/span\u0026gt;{\n      process.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;stdout\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cursorTo\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)\n      process.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;stdout\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;clearScreenDown\u0026lt;/span\u0026gt;()\n      reader.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;close\u0026lt;/span\u0026gt;()\n      \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;res\u0026lt;/span\u0026gt;(answer)\n    })\n  })\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; questions = [\n  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`What\u0026apos;s your name`\u0026lt;/span\u0026gt;\n  ,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`What\u0026apos;s your favorite programming language`\u0026lt;/span\u0026gt;\n  ,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`What\u0026apos;s your favorite async function`\u0026lt;/span\u0026gt;\n]\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; responses = {}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getResponses\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Notice we have to prepend await before calling the async Array function\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// in order for it to function as expected\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; questions.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asyncForEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;question, index\u0026lt;/span\u0026gt;){\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; answer = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getUserIn\u0026lt;/span\u0026gt;(question)\n    responses[question] = answer\n  })\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getResponses\u0026lt;/span\u0026gt;()\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(responses)\n}\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;()\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Should prompt user for an answer to each question and then \u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// log each question and answer as an object to the terminal\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;We could do the same for some of the other array functions like map...\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asyncMap\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;iteratorFunction\u0026lt;/span\u0026gt;){\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; newMap = []\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; indexer = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; data \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;){\n    newMap[indexer] = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;iteratorFunction\u0026lt;/span\u0026gt;(data, indexer, \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;)\n    indexer++\n  }\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; newMap\n}\n\n\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Array\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;asyncMap\u0026lt;/span\u0026gt; = asyncMap\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;... and so on :)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Some things to note:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Your iteratorFunction must be an async function or promise\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Any arrays created before \u0026lt;code\u0026gt;Array.prototype.\u0026amp;lt;yourAsyncFunc\u0026amp;gt; = \u0026amp;lt;yourAsyncFunc\u0026amp;gt;\u0026lt;/code\u0026gt; will not have this feature available\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","\n\u0026lt;p\u0026gt;To see how that can go wrong, print console.log at the end of the method.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Things that can go wrong in general:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Arbitrary order.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;printFiles can finish running before printing files.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Poor performance.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;These are not always wrong but frequently are in standard use cases.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Generally, using forEach will result in all but the last. It\u0026apos;ll call each function without awaiting for the function meaning it tells all of the functions to start then finishes without waiting for the functions to finish.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; fs \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs-promise\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; () {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;()).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;))\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; file \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; files)\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; file)\n}\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;()\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;This is an example in native JS that will preserve order, prevent the function from returning prematurely and in theory retain optimal performance.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This will:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Initiate all of the file reads to happen in parallel.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Preserve the order via the use of map to map file names to promises to wait for.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Wait for each promise in the order defined by the array.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;With this solution the first file will be shown as soon as it is available without having to wait for the others to be available first.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;It will also be loading all files at the same time rather than having to wait for the first to finish before the second file read can be started.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The only draw back of this and the original version is that if multiple reads are started at once then it\u0026apos;s more difficult to handle errors on account of having more errors that can happen at a time.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;With versions that read a file at a time then then will stop on a failure without wasting time trying to read any more files. Even with an elaborate cancellation system it can be hard to avoid it failing on the first file but reading most of the other files already as well.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Performance is not always predictable. While many systems will be faster with parallel file reads some will prefer sequential. Some are dynamic and may shift under load, optimisations that offer latency do not always yield good throughput under heavy contention.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;There is also no error handling in that example. If something requires them to either all be successfully shown or not at all it won\u0026apos;t do that.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;In depth experimentation is recommended with console.log at each stage and fake file read solutions (random delay instead). Although many solutions appear to do the same in simple cases all have subtle differences that take some extra scrutiny to squeeze out.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Use this mock to help tell the difference between solutions:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; () =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; start = +\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Date\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;mock\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; {\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;fs\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve, reject\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Instead of this just make three files and try each timing arrangement.\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// IE, all same, [100, 200, 300], [300, 200, 100], [100, 300, 200], etc.\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; time = \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;round\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt; + \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Math\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;random\u0026lt;/span\u0026gt;() * \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4900\u0026lt;/span\u0026gt;);\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`Read of \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${file}\u0026lt;/span\u0026gt; started at \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Date\u0026lt;/span\u0026gt;() - start}\u0026lt;/span\u0026gt; and will take \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${time}\u0026lt;/span\u0026gt;ms.`\u0026lt;/span\u0026gt;)\n        \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n          \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Bonus material here if random reject instead.\u0026lt;/span\u0026gt;\n          \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`Read of \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${file}\u0026lt;/span\u0026gt; finished, resolving promise at \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Date\u0026lt;/span\u0026gt;() - start}\u0026lt;/span\u0026gt;.`\u0026lt;/span\u0026gt;);\n          \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(file);\n        }, time);\n      })},\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`Console Log of \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${file}\u0026lt;/span\u0026gt; finished at \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Date\u0026lt;/span\u0026gt;() - start}\u0026lt;/span\u0026gt;.`\u0026lt;/span\u0026gt;)},\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;A\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;B\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;C\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;D\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;E\u0026apos;\u0026lt;/span\u0026gt;]\n    };\n  };\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; printFiles = (\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;{fs, \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;, getFilePaths}\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;()).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;));\n\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; file \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; files)\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; file);\n    };\n  })(\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;mock\u0026lt;/span\u0026gt;());\n\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`Running at \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Date\u0026lt;/span\u0026gt;() - start}\u0026lt;/span\u0026gt;`\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`Finished running at \u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Date\u0026lt;/span\u0026gt;() - start}\u0026lt;/span\u0026gt;`\u0026lt;/span\u0026gt;);\n})();\n\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Using Task, futurize, and a traversable List, you can simply do\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFiles\u0026lt;/span\u0026gt;();\n\n  \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;List\u0026lt;/span\u0026gt;(files).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;traverse\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Task\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;f\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;( f, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf-8\u0026apos;\u0026lt;/span\u0026gt;))\n    .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fork\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;)\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Here is how you\u0026apos;d set this up\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; fs \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { futurize } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;futurize\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Task\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;data.task\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;List\u0026lt;/span\u0026gt; } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;immutable-ext\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; future = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;futurizeP\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Task\u0026lt;/span\u0026gt;)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; readFile = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;future\u0026lt;/span\u0026gt;(fs.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Another way to have structured the desired code would be\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; = files =\u0026amp;gt; \n  \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;List\u0026lt;/span\u0026gt;(files).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;traverse\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Task\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;( fn, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf-8\u0026apos;\u0026lt;/span\u0026gt;))\n    .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fork\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Or perhaps even more functionally oriented\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// 90% of encodings are utf-8, making that use case super easy is prudent\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// handy-library.js\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;export\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt; = f =\u0026amp;gt;\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;future\u0026lt;/span\u0026gt;(fs.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;)( f, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf-8\u0026apos;\u0026lt;/span\u0026gt; )\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;export\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;arrayToTaskList\u0026lt;/span\u0026gt; = list =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;taskFn\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \n  \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;List\u0026lt;/span\u0026gt;(files).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;traverse\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Task\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt;, taskFn ) \n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;export\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFiles\u0026lt;/span\u0026gt; = files =\u0026amp;gt;\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;arrayToTaskList\u0026lt;/span\u0026gt;( files, readFile )\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;export\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; = files =\u0026amp;gt; \n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFiles\u0026lt;/span\u0026gt;(files).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fork\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;error\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Then from the parent function\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/* awesome code with side-effects before */\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFiles\u0026lt;/span\u0026gt;() );\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/* awesome code with side-effects after */\u0026lt;/span\u0026gt;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;If you really wanted more flexibility in encoding, you could just do this (for fun, I\u0026apos;m using the proposed \u0026lt;a href=\u0026quot;https://github.com/tc39/proposal-pipeline-operator\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Pipe Forward operator\u0026lt;/a\u0026gt; )\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { curry, flip } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ramda\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;export\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; readFile = fs.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt; \n  |\u0026amp;gt; future,\n  |\u0026amp;gt; curry,\n  |\u0026amp;gt; flip\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;export\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; readFileUtf8 = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf-8\u0026apos;\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;PS - I didn\u0026apos;t try this code on the console, might have some typos... \u0026quot;straight freestyle, off the top of the dome!\u0026quot; as the 90s kids would say. :-p\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;h3\u0026gt;Here is a great example for using async in forEach loop.\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Write your own asyncForEach\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asyncForEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;array, callback\u0026lt;/span\u0026gt;) {  \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; index = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; index \u0026amp;lt; array.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;; index++) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;callback\u0026lt;/span\u0026gt;(array[index], index, array)\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;You can use it like this\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asyncForEach\u0026lt;/span\u0026gt;(array, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;item,index,array\u0026lt;/span\u0026gt;){\n     \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//await here\u0026lt;/span\u0026gt;\n   }\n)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The OP\u0026apos;s orignal question\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;Are there any issues with using async/await in a forEach loop? ...\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;was covered to an extent in @Bergi\u0026apos;s \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/37576787/4376643\u0026quot;\u0026gt;selected answer\u0026lt;/a\u0026gt;,\nwhich showed how to process in serial and in parallel.  However there are other issues noted with parallelism -\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;Order -- \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/48939529/4376643\u0026quot;\u0026gt;@chharvey\u0026lt;/a\u0026gt; notes that -\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;For example if a really small file finishes reading before a really large file, it will be logged first, even if the small file comes after the large file in the files array.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;ol start=\u0026quot;2\u0026quot;\u0026gt;\n\u0026lt;li\u0026gt;Possibly opening too many files at once -- A comment by Bergi under another \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/66919921/4376643\u0026quot;\u0026gt;answer\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;It is also not good to open thousands of files at once to read them concurrently. One always has to do an assessment whether a sequential, parallel, or mixed approach is better.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;So let\u0026apos;s address these issues showing actual code that is brief and concise, and does \u0026lt;em\u0026gt;not\u0026lt;/em\u0026gt; use third party libraries.  Something easily cut, paste, and modifiable.\u0026lt;/p\u0026gt;\n\u0026lt;h3\u0026gt;Reading in parallel (all at once), printing in serial (as early as possible per file).\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;The easiest improvement is perform full parallelism as in \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/37576787/4376643\u0026quot;\u0026gt;@Bergi\u0026apos;s answer\u0026lt;/a\u0026gt;, but make a small change so that each file is \u0026lt;em\u0026gt;printed as soon as possible while preserving order\u0026lt;/em\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles2\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; readProms = (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;()).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt;\n    fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;utf8\u0026quot;\u0026lt;/span\u0026gt;)\n  );\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;([\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;(readProms),                      \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// branch 1\u0026lt;/span\u0026gt;\n    (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; () =\u0026amp;gt; {                                     \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// branch 2\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; p \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; readProms) \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; p);\n    })(),\n  ]);\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Above, two seperate branches are run concurrently.\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;branch 1: Reading in parallel, all at once,\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;branch 2: Reading in serial to force order, but waiting no longer than necessary\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;p\u0026gt;That was easy.\u0026lt;/p\u0026gt;\n\u0026lt;h3\u0026gt;Reading in parallel with a concurrency limit, printing in serial (as early as possible per file).\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;A \u0026quot;concurrecy limit\u0026quot; means that no more than \u0026lt;code\u0026gt;N\u0026lt;/code\u0026gt; files will ever being read at the same time.\u0026lt;br\u0026gt;\nLike a store that only allows in so many customers at a time (at least during COVID).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;First a helper function is introduced -\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;bootablePromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;kickMe: () =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;\u0026amp;lt;any\u0026amp;gt;\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;value: unknown\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;void\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; {};\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; promise = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;res\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; { resolve = res; });\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;boot\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; { \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;kickMe\u0026lt;/span\u0026gt;()); };\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; { promise, boot };\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;The funciton \u0026lt;code\u0026gt;bootablePromise(kickMe:() =\u0026amp;gt; Promise\u0026amp;lt;any\u0026amp;gt;)\u0026lt;/code\u0026gt; takes an\nfunction \u0026lt;code\u0026gt;kickMe\u0026lt;/code\u0026gt; as an argumment to start a task (in our case \u0026lt;code\u0026gt;readFile\u0026lt;/code\u0026gt;).  But it is not started immediately.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;bootablePromise\u0026lt;/code\u0026gt; returns a couple of properties\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;promise\u0026lt;/code\u0026gt; of type \u0026lt;code\u0026gt;Promise\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;boot\u0026lt;/code\u0026gt; of type function \u0026lt;code\u0026gt;()=\u0026amp;gt;void\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;promise\u0026lt;/code\u0026gt; has two stages in life\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;Being a promise to start a task\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Being a promise complete a task it has already started.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;promise\u0026lt;/code\u0026gt; transitions from the first to the second state when \u0026lt;code\u0026gt;boot()\u0026lt;/code\u0026gt; is called.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;bootablePromise\u0026lt;/code\u0026gt; is used in \u0026lt;code\u0026gt;printFiles\u0026lt;/code\u0026gt; --\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles4\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;boots\u0026lt;/span\u0026gt;: (\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;void\u0026lt;/span\u0026gt;)[] = [];\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;set\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Set\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;\u0026amp;lt;{ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;pidx\u0026lt;/span\u0026gt;: number }\u0026amp;gt;\u0026amp;gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Set\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;\u0026amp;lt;any\u0026amp;gt;\u0026amp;gt;();\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; bootableProms = files.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file,pidx\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; { promise, boot } = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;bootablePromise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;utf8\u0026quot;\u0026lt;/span\u0026gt;));\n    boots.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(boot);\n    set.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;add\u0026lt;/span\u0026gt;(promise.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; ({ pidx })));\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; promise;\n  });\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; concurLimit = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;([\n    (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; () =\u0026amp;gt; {                                       \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// branch 1\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; idx = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n      boots.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;slice\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, concurLimit).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;b\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;b\u0026lt;/span\u0026gt;(); idx++; });\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt; (idx\u0026amp;lt;boots.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; { pidx } = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;race\u0026lt;/span\u0026gt;([...set]);\n        set.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;delete\u0026lt;/span\u0026gt;([...set][pidx]);\n        boots[idx++]();\n      }\n    })(),\n    (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; () =\u0026amp;gt; {                                       \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// branch 2\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; p \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;of\u0026lt;/span\u0026gt; bootableProms) \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; p);\n    })(),\n  ]);\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;As before there are two branches\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;branch 1:   For running and handling concurrecy.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;branch 2:   For printing\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;p\u0026gt;The difference now is the never more than \u0026lt;code\u0026gt;concurLimit\u0026lt;/code\u0026gt; promises are allowed to run concurrently.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The important variables are\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;boots\u0026lt;/code\u0026gt;: The array of functions to call to force it\u0026apos;s corresponding promise to transition. It is used only in branch 1.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;set\u0026lt;/code\u0026gt;: There are promises in a random acces container so that they can be easily removed once fulfilled.  This contianer is used only in branch 1.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;bootableProms\u0026lt;/code\u0026gt;:  These are the smae promises as initally in \u0026lt;code\u0026gt;set\u0026lt;/code\u0026gt;, but it is an array not a set, and the array is never changed.  It is used only in branch 2.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;p\u0026gt;Running with a mock \u0026lt;code\u0026gt;fs.readFile\u0026lt;/code\u0026gt; that takes times as follows (filename vs. time in ms).\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; timeTable = {\n  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;1\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;600\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;2\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;500\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;3\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;400\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;4\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;300\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;5\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;200\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;6\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;,\n};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;test run times such as this are seen, showing the concurrency is working --\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;]\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;--\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.601\u0026lt;/span\u0026gt;\n[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;]\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;--\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.502\u0026lt;/span\u0026gt;\n[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;]\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.503\u0026lt;/span\u0026gt;--\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.904\u0026lt;/span\u0026gt;\n[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;]\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.608\u0026lt;/span\u0026gt;--\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.908\u0026lt;/span\u0026gt;\n[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;]\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.905\u0026lt;/span\u0026gt;--\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1.105\u0026lt;/span\u0026gt;\n[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;6\u0026lt;/span\u0026gt;]\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0.905\u0026lt;/span\u0026gt;--\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1.005\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Available as executable in the \u0026lt;a href=\u0026quot;https://www.typescriptlang.org/play?#code/FAYw9gdgzgLgBDAlgWwKYBUCGAjANquAXjgG9g44AiARkoC44A2ABmYBpyqAmeuAVlYcKlAMy8ALIM6VxvEVOF9eXBVUa9qUgL4BuYKEiw4sTACcY6InAAimGKgB0EMAHcAFAEpgAMwCuEECRIOAATVFwYTDcADzoIX2RsVFMPElNUGF9TCDgYgFoTc3QPAHpNVh0tfUwoAE8AuD8AoJyAcwyAMUR8AAU7AAsoTwYe0zBkRChUAB5YU0QIVoBtAF0APlJOdMzsuAB5bAArVECHAGtUWqGkNCw8VA89KoNoeG8oKzIKGvqQOHTMCEuvg3N5uqgGHMFq02HAHPCzK0oAxMBBaqsPCMxhMprMYPNFhsvhQ4OBXnAkq0FpZiLZ7E5XJ5OBRtlkcpgXJhEPAIKgXHBRuNJjMoYS3G50lBYelDh4iETmSTFRQphYUKgwL4YOK5YQFSSDaTDPBUBAQjSbHZHM53F5DSTJW4AAZLAAkJDB+C0K3dYQiUUp1I8WjyeV94UiblN5uDTseyrgWlhbhuGBw+DgNUzaI8S09qBWcAA-EW4Mx4watBXExxdPofP5AohgtgwGBIvdBTjUG4zogQGcALIQ3K6jZd4XTVG1NaYkgAB2xwroE9x07WbFb7bonj1ADcwIgQlpNhR8PBJWBcHuR2495hcL4R-4zjaIGO4Aej1ZPPLSHWKDJIxFyFKYrF5flVx7CVUCgD8SH+WCrxvKxJR0RNqyA+At3gYhfz1UhEKgZCez7Adh08R5Ez0FkMjZQiQO7WEcOo4Bnh+BomibYJFwWGBgVg8Rf2JLDGnBD5iA5Ll4HafjwT6GBBk8GijXJHDkVyfCNi-EJc0LYhVhU0TVQYABlDJpig6YEPnI9YjgeJEmSRM1g2YgILgcyYEspc1zRVzlM4UScPTVAuwksT8CgBxkEwedxXzNhbJCaJ4MVUSbN81BmLbeAT2IELOyynU-3eBwASBcFQXBWFKC1bwAA5KA8asKHUhx518KB+jcHDWuMDIHEBEI3EY4UHEU00SoItwbLsjCWpU2idhyMaphUqsjONVSQCyAAZFBuSsLgVKko6oKG3BcDcJZFTcDi-i009DXPOB5uIZglpJdqoFwfse3YHb9sOmAPAcbwwFMABRTAQB63r4IpZS3pSgBqVH0M2hMXH6cFcjs6Z2vwRZFLlYl7QyuBkuiRMrDO+ALtMWGeyWeEHFVFZ+oNYK-QyVAQisVUHF5+wbrZjmlmpzmvoNdSljs9GVkC+0qkrDxPCEEl7rqBonvJkkIdMXJRPnOAwG8ClctC8K5SAq9HFwMBWnuzkjvnfqqw1zhpbY-Rtd+Uc-2JemqYJOSoqE+NPfjIA\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;typescript playground sandbox\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;As other answers have mentioned, you\u0026apos;re probably wanting it to be executed in sequence rather in parallel. Ie. run for first file, wait until it\u0026apos;s done, \u0026lt;em\u0026gt;then\u0026lt;/em\u0026gt; once it\u0026apos;s done run for second file. That\u0026apos;s not what will happen.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I think it\u0026apos;s important to address \u0026lt;em\u0026gt;why\u0026lt;/em\u0026gt; this doesn\u0026apos;t happen.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Think about how \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt; works. I can\u0026apos;t find the source, but I presume it works something like this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arr, cb\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; i = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; arr.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;; i++) {\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;cb\u0026lt;/span\u0026gt;(arr[i]);\n  }\n};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Now think about what happens when you do something like this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(files, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;logFile\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents);\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Inside \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt;\u0026apos;s \u0026lt;code\u0026gt;for\u0026lt;/code\u0026gt; loop we\u0026apos;re calling \u0026lt;code\u0026gt;cb(arr[i])\u0026lt;/code\u0026gt;, which ends up being \u0026lt;code\u0026gt;logFile(file)\u0026lt;/code\u0026gt;. The \u0026lt;code\u0026gt;logFile\u0026lt;/code\u0026gt; function has an \u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt; inside it, so maybe the \u0026lt;code\u0026gt;for\u0026lt;/code\u0026gt; loop will wait for this \u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt; before proceeding to \u0026lt;code\u0026gt;i++\u0026lt;/code\u0026gt;?\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;No, it won\u0026apos;t. Confusingly, that\u0026apos;s not how \u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt; works. From \u0026lt;a href=\u0026quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;the docs\u0026lt;/a\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;An await splits execution flow, allowing the caller of the async function to resume execution. After the await defers the continuation of the async function, execution of subsequent statements ensues. If this await is the last expression executed by its function execution continues by returning to the function\u0026apos;s caller a pending Promise for completion of the await\u0026apos;s function and resuming execution of that caller.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;So if you have the following, the numbers won\u0026apos;t be logged before \u0026lt;code\u0026gt;\u0026quot;b\u0026quot;\u0026lt;/code\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;delay\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;ms\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(resolve, ms);\n  });\n};\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;logNumbers\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;delay\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;delay\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2000\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;);\n};\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; {\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;a\u0026quot;\u0026lt;/span\u0026gt;);\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;logNumbers\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;b\u0026quot;\u0026lt;/span\u0026gt;);\n};\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Circling back to \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt; is like \u0026lt;code\u0026gt;main\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;logFile\u0026lt;/code\u0026gt; is like \u0026lt;code\u0026gt;logNumbers\u0026lt;/code\u0026gt;. \u0026lt;code\u0026gt;main\u0026lt;/code\u0026gt; won\u0026apos;t stop just because \u0026lt;code\u0026gt;logNumbers\u0026lt;/code\u0026gt; does some \u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt;ing, and \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt; won\u0026apos;t stop just because \u0026lt;code\u0026gt;logFile\u0026lt;/code\u0026gt; does some \u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt;ing.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Similar to Antonio Val\u0026apos;s \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/45006966/8550747\u0026quot;\u0026gt;\u0026lt;code\u0026gt;p-iteration\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;, an alternative npm module is \u0026lt;a href=\u0026quot;https://async-af.js.org/AsyncAF.html#forEachAF\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;async-af\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;AsyncAF\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;async-af\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; fs = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs-promise\u0026apos;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// since AsyncAF accepts promises or non-promises, there\u0026apos;s no need to await here\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;();\n\n  \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;AsyncAF\u0026lt;/span\u0026gt;(files).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; file =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents);\n  });\n}\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Alternatively, \u0026lt;a href=\u0026quot;https://async-af.js.org/AsyncAF.html#logAF\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;async-af\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; has a static method (log/logAF) that logs the results of promises:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;AsyncAF\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;async-af\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; fs = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs-promise\u0026apos;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;();\n\n  \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;AsyncAF\u0026lt;/span\u0026gt;(files).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;AsyncAF\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;));\n  });\n}\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;However, the main advantage of the library is that you can chain asynchronous methods to do something like:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; aaf = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;async-af\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; fs = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;require\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs-promise\u0026apos;\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;aaf\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;())\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;))\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;file\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; aaf.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(file));\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://async-af.js.org/AsyncAF\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;async-af\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In 2022 I would still advise using external libraries to handle all this async flow.  I\u0026apos;ve created the module \u0026lt;a href=\u0026quot;https://github.com/atmajs/alot\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;alot\u0026lt;/a\u0026gt; for similar things.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Your example would be:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; fs \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs-promise\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; alot \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;alot\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; () {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;() \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Assume this works fine\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;alot\u0026lt;/span\u0026gt;(files)\n        .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEachAsync\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; file =\u0026amp;gt; {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; content = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(content);\n        })\n        .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;toArrayAsync\u0026lt;/span\u0026gt;({ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;threads\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt; });\n    }\n}\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;()\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;For simple examples surely the async \u0026lt;code\u0026gt;for..of\u0026lt;/code\u0026gt; would do the job, but as soon the task is more complicated you have to use some utility for this.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Alot has dozens of other methods that you can chain, like \u0026lt;code\u0026gt;mapAsync\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;filterAsync\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;groupAsync\u0026lt;/code\u0026gt;, etc.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;As an example:\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Load JSON files with products meta\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Extract \u0026lt;code\u0026gt;ProductID\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Load products from the server\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Filter those with a price \u0026amp;gt; 100$\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Order by price ascending\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Take top 50\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; fs \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs-promise\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; alot \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;alot\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; axios \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;axios\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;File\u0026lt;/span\u0026gt; } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;atma-io\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; paths = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; products = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;alot\u0026lt;/span\u0026gt;(paths)\n    .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;mapAsync\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; path =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;File\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;readAsync\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;IProductMeta\u0026lt;/span\u0026gt;\u0026amp;gt;(path))\n    .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;mapAsync\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; meta =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; axios.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;get\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;`\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${server}\u0026lt;/span\u0026gt;/api/product/\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;${meta.productId}\u0026lt;/span\u0026gt;`\u0026lt;/span\u0026gt;))\n    .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;mapAsync\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resp\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; resp.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;data\u0026lt;/span\u0026gt;)\n    .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;filterAsync\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;product\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; product.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;price\u0026lt;/span\u0026gt; \u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;)\n    .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sortBy\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;product\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; product.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;price\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;asc\u0026apos;\u0026lt;/span\u0026gt;)\n    .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;takeAsync\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;50\u0026lt;/span\u0026gt;)\n    .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;toArrayAsync\u0026lt;/span\u0026gt;({ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;threads\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;errors\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;include\u0026apos;\u0026lt;/span\u0026gt; });\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;If you\u0026apos;d like to iterate over all elements concurrently:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asyncForEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arr, fn\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;(arr.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(fn));\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;If you\u0026apos;d like to iterate over all elements non-concurrently (e.g. when your mapping function has side effects or running mapper over all array elements at once would be too resource costly):\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Option A: Promises\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asyncForEachStrict\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arr, fn\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; {\n    arr.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reduce\u0026lt;/span\u0026gt;(\n      \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;promise, cur, idx\u0026lt;/span\u0026gt;) =\u0026amp;gt;\u0026lt;/span\u0026gt; promise\n        .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;(cur, idx, arr)),\n      \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Promise\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;(),\n    ).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;resolve\u0026lt;/span\u0026gt;());\n  });\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Option B: async/await\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;asyncForEachStrict\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;arr, fn\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; idx = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; idx \u0026amp;lt; arr.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt;; idx += \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; cur = arr[idx];\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fn\u0026lt;/span\u0026gt;(cur, idx, arr);\n  }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;If you can\u0026apos;t use async/await\u0026lt;/strong\u0026gt; (IE11, old packer, etc.) then you can try this recursive function. I used \u0026lt;code\u0026gt;fetch\u0026lt;/code\u0026gt; as my asynchronous call, but you could use any function that returns a promise.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; urlsToGet = [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;https://google.com\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;https://yahoo.com\u0026apos;\u0026lt;/span\u0026gt;];\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fetchOneAtATime\u0026lt;/span\u0026gt;(urlsToGet);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fetchOneAtATime\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;urls\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (urls.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;length\u0026lt;/span\u0026gt; === \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt;;\n    }\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fetch\u0026lt;/span\u0026gt;(urls[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;]).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;finally\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;() =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;fetchOneAtATime\u0026lt;/span\u0026gt;(urls.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;slice\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)));\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    "],"id":79,"title":"Using async/await with a forEach loop","content":"\n                \n\u0026lt;p\u0026gt;Are there any issues with using \u0026lt;code\u0026gt;async\u0026lt;/code\u0026gt;/\u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt; in a \u0026lt;code\u0026gt;forEach\u0026lt;/code\u0026gt; loop? I\u0026apos;m trying to loop through an array of files and \u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt; on the contents of each file.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;import\u0026lt;/span\u0026gt; fs \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;fs-promise\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt; () {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; files = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getFilePaths\u0026lt;/span\u0026gt;() \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Assume this works fine\u0026lt;/span\u0026gt;\n\n  files.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;async\u0026lt;/span\u0026gt; (file) =\u0026amp;gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; contents = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; fs.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;readFile\u0026lt;/span\u0026gt;(file, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;utf8\u0026apos;\u0026lt;/span\u0026gt;)\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(contents)\n  })\n}\n\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;printFiles\u0026lt;/span\u0026gt;()\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;This code does work, but could something go wrong with this? I had someone tell me that you\u0026apos;re not supposed to use \u0026lt;code\u0026gt;async\u0026lt;/code\u0026gt;/\u0026lt;code\u0026gt;await\u0026lt;/code\u0026gt; in a higher-order function like this, so I just wanted to ask if there was any issue with this.\u0026lt;/p\u0026gt;\n    ","slug":"using-asyncawait-with-a-foreach-loop-1657384512667","postType":"QUESTION","createdAt":"2022-07-09T16:35:12.000Z","updatedAt":"2022-07-09T16:35:12.000Z","tags":[{"id":288,"name":"node.js","slug":"node.js","createdAt":"2022-07-09T16:35:12.000Z","updatedAt":"2022-07-09T16:35:12.000Z","Questions_Tags":{"questionId":79,"tagId":288}},{"id":290,"name":"async-await","slug":"async-await","createdAt":"2022-07-09T16:35:12.000Z","updatedAt":"2022-07-09T16:35:12.000Z","Questions_Tags":{"questionId":79,"tagId":290}},{"id":291,"name":"ecmascript-2017","slug":"ecmascript-2017","createdAt":"2022-07-09T16:35:12.000Z","updatedAt":"2022-07-09T16:35:12.000Z","Questions_Tags":{"questionId":79,"tagId":291}}],"relatedQuestions":[{"title":"Using async/await with a forEach loop","slug":"using-asyncawait-with-a-foreach-loop-1657384512667","tags":[{"name":"node.js","Questions_Tags":{"questionId":79,"tagId":288}},{"name":"async-await","Questions_Tags":{"questionId":79,"tagId":290}},{"name":"ecmascript-2017","Questions_Tags":{"questionId":79,"tagId":291}}]}]},"randomQuestions":[{"title":"How do I modify the URL without reloading the page?","slug":"how-do-i-modify-the-url-without-reloading-the-page-1657387509731"},{"title":"When to use virtual destructors?","slug":"when-to-use-virtual-destructors-1657388152135"},{"title":"Correctly allocating multi-dimensional arrays","slug":"correctly-allocating-multi-dimensional-arrays-1657387733756"},{"title":"How to make good reproducible pandas examples","slug":"how-to-make-good-reproducible-pandas-examples-1657384310402"},{"title":"Flatten an irregular list of lists","slug":"flatten-an-irregular-list-of-lists-1657387315571"},{"title":"Why do regex constructors need to be double escaped?","slug":"why-do-regex-constructors-need-to-be-double-escaped-1657388004942"},{"title":"What is the best way to detect a mobile device?","slug":"what-is-the-best-way-to-detect-a-mobile-device-1657387665025"},{"title":"How does the \"this\" keyword work, and when should it be used?","slug":"how-does-the-\"this\"-keyword-work-and-when-should-it-be-used-1657384384385"},{"title":"What's the meaning of \"=\u003e\" (an arrow formed from equals \u0026 greater than) in JavaScript?","slug":"what's-the-meaning-of-\"greater\"-(an-arrow-formed-from-equals-and-greater-than)-in-javascript-1657387977118"},{"title":"How to use variables in SQL statement in Python?","slug":"how-to-use-variables-in-sql-statement-in-python-1657388479077"},{"title":"Why is my variable unaltered after I modify it inside of a function? - Asynchronous code reference","slug":"why-is-my-variable-unaltered-after-i-modify-it-inside-of-a-function-asynchronous-code-reference-1657384288966"},{"title":"How do I detect collision in pygame?","slug":"how-do-i-detect-collision-in-pygame-1657387496338"},{"title":"How do I use extern to share variables between source files?","slug":"how-do-i-use-extern-to-share-variables-between-source-files-1657387453605"},{"title":"How do I generate random integers within a specific range in Java?","slug":"how-do-i-generate-random-integers-within-a-specific-range-in-java-1657385458888"},{"title":"How do I compose a rotation matrix with human readable angles from scratch?","slug":"how-do-i-compose-a-rotation-matrix-with-human-readable-angles-from-scratch-1657387963457"},{"title":"How to choose the right bean scope?","slug":"how-to-choose-the-right-bean-scope-1657387596513"},{"title":"How can I read inputs as numbers?","slug":"how-can-i-read-inputs-as-numbers-1657384503324"},{"title":"What do 'lazy' and 'greedy' mean in the context of regular expressions?","slug":"what-do-'lazy'-and-'greedy'-mean-in-the-context-of-regular-expressions-1657388200552"},{"title":"Align inline-block DIVs to top of container element","slug":"align-inline-block-divs-to-top-of-container-element-1657387489610"},{"title":"mysqli or die, does it have to die?","slug":"mysqli-or-die-does-it-have-to-die-1657388533922"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"using-asyncawait-with-a-foreach-loop-1657384512667"},"buildId":"BnkbnjkWYxefPXjTJLVVv","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>