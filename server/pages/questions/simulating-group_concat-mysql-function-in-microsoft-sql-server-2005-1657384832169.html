<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2eccd4d47c856f2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2eccd4d47c856f2b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-20edbe0b078add93.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/613-1e0aa2b2023820bb.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/471-84c36aa98dd4107c.js" defer=""></script><script src="/_next/static/chunks/81-096e453de8a27667.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-e3d1b60e109d3ba1.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_buildManifest.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">.hFcsiD code{padding:5px;color:hsl(210deg 8% 15%);background-color:hsl(210deg 8% 90%);border-radius:3px;}/*!sc*/
data-styled.g5[id="sc-6e32c308-0"]{content:"hFcsiD,"}/*!sc*/
.ljvTUN .comment-item .comment-body .d-inline-flex.ai-center{text-align:right;}/*!sc*/
.ljvTUN .comment-item .comment-body .comment-date{float:right;}/*!sc*/
data-styled.g6[id="sc-6e32c308-1"]{content:"ljvTUN,"}/*!sc*/
</style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="https://flowbite.com/docs/images/logo.svg" class="mr-3 h-6 sm:h-9" alt="Flowbite Logo"/><span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Hunter</span></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/simulating-group_concat-mysql-function-in-microsoft-sql-server-2005-1657384832169#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="sc-6e32c308-0 hFcsiD flex question-header items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/simulating-group_concat-mysql-function-in-microsoft-sql-server-2005-1657384832169">Simulating group_concat MySQL function in Microsoft SQL Server 2005?</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/sql-server">sql-server</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/sql-server-2005">sql-server-2005</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/string-aggregation">string-aggregation</a></div></div><div class="question-content mt-5">
                
<p>I'm trying to migrate a MySQL-based app over to Microsoft SQL Server 2005 (not by choice, but that's life).</p>

<p>In the original app, we used <em>almost</em> entirely ANSI-SQL compliant statements, with one significant exception -- we used MySQL's <code>group_concat</code> function fairly frequently.</p>

<p><code>group_concat</code>, by the way, does this: given a table of, say, employee names and projects...</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> empName, projID <span class="hljs-keyword">FROM</span> project_members;
</code></pre>

<p>returns:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">ANDY   <span class="hljs-operator">|</span>  A100
ANDY   <span class="hljs-operator">|</span>  B391
ANDY   <span class="hljs-operator">|</span>  X010
TOM    <span class="hljs-operator">|</span>  A100
TOM    <span class="hljs-operator">|</span>  A510
</code></pre>

<p>... and here's what you get with group_concat:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> 
    empName, group_concat(projID SEPARATOR <span class="hljs-string">' / '</span>) 
<span class="hljs-keyword">FROM</span> 
    project_members 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    empName;
</code></pre>

<p>returns:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">ANDY   <span class="hljs-operator">|</span>  A100 <span class="hljs-operator">/</span> B391 <span class="hljs-operator">/</span> X010
TOM    <span class="hljs-operator">|</span>  A100 <span class="hljs-operator">/</span> A510
</code></pre>

<p>So what I'd like to know is: Is it possible to write, say, a user-defined function in SQL Server which emulates the functionality of <code>group_concat</code>? </p>

<p>I have almost no experience using UDFs, stored procedures, or anything like that, just straight-up SQL, so please err on the side of too much explanation :)</p>
    </div></div></div><div class="sc-6e32c308-1 ljvTUN flex text-xs pl-10 flex-col comment items-center justify-center"><h4 class="text-left mt-10 text-lg font-semibold">Comments</h4><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">A couple of handy links: <a href="http://www.postgresonline.com/journal/archives/191-stringagg.html" rel="nofollow noreferrer">postgresonline.com/journal/archives/191-stringagg.html</a> and <a href="http://consultingblogs.emc.com/jamiethomson/archive/2009/07/16/string-aggregation-in-t-sql-amp-pl-sql.aspx" rel="nofollow noreferrer">consultingblogs.emc.com/jamiethomson/archive/2009/07/16/</a></span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/137471/bernhof" title="6,110 reputation" class="comment-user">bernhof</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment8783619_451415"><span title="2011-09-03 08:53:17Z, License: CC BY-SA 3.0" class="relativetime-clean">Sep 3, 2011 at 8:53</span></a></span>
                        <span title="this comment was edited 1 time">
                            <svg aria-hidden="true" class="va-text-bottom o50 svg-icon iconPencilSm" width="14" height="14" viewBox="0 0 14 14"><path d="m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z"></path></svg>
                        </span>
            </div>
        </div><span class="divide-x-8 "></span><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">This is an old question, but I like <a href="http://stackoverflow.com/a/9779711/498609">the CLR solution given here</a>.</span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/498609/diego" title="17,499 reputation" class="comment-user">Diego</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment42386499_451415"><span title="2012-03-20 01:54:26Z, License: CC BY-SA 3.0" class="relativetime-clean">Mar 20, 2012 at 1:54</span></a></span>
            </div>
        </div><span class="divide-x-8 "></span><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">possible duplicate of <a href="http://stackoverflow.com/questions/1817985/how-do-i-create-a-comma-separated-list-using-a-sql-query">How do I Create a Comma-Separated List using a SQL Query?</a> - that post is broader so I would choose that one as canonical</span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/684229/tomas" title="55,121 reputation" class="comment-user">Tomas</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment26373363_451415"><span title="2013-08-03 06:43:56Z, License: CC BY-SA 3.0" class="relativetime-clean">Aug 3, 2013 at 6:43</span></a></span>
                        <span title="this comment was edited 1 time">
                            <svg aria-hidden="true" class="va-text-bottom o50 svg-icon iconPencilSm" width="14" height="14" viewBox="0 0 14 14"><path d="m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z"></path></svg>
                        </span>
            </div>
        </div><span class="divide-x-8 "></span><button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">See more</button></div><div class="sc-6e32c308-2 bFXWFO"><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>No REAL easy way to do this. Lots of ideas out there, though.</p>

<p><a href="http://blog.shlomoid.com/2008/11/emulating-mysqls-groupconcat-function.html" rel="noreferrer">Best one I've found</a>:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> table_name, <span class="hljs-keyword">LEFT</span>(column_names , LEN(column_names )<span class="hljs-number">-1</span>) <span class="hljs-keyword">AS</span> column_names
<span class="hljs-keyword">FROM</span> information_schema.columns <span class="hljs-keyword">AS</span> extern
<span class="hljs-keyword">CROSS</span> APPLY
(
    <span class="hljs-keyword">SELECT</span> column_name <span class="hljs-operator">+</span> <span class="hljs-string">','</span>
    <span class="hljs-keyword">FROM</span> information_schema.columns <span class="hljs-keyword">AS</span> intern
    <span class="hljs-keyword">WHERE</span> extern.table_name <span class="hljs-operator">=</span> intern.table_name
    <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>)
) pre_trimmed (column_names)
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> table_name, column_names;
</code></pre>

<p>Or a version that works correctly if the data might contain characters such as <code>&lt;</code></p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">WITH</span> extern
     <span class="hljs-keyword">AS</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> table_name
         <span class="hljs-keyword">FROM</span>   INFORMATION_SCHEMA.COLUMNS)
<span class="hljs-keyword">SELECT</span> table_name,
       <span class="hljs-keyword">LEFT</span>(y.column_names, LEN(y.column_names) <span class="hljs-operator">-</span> <span class="hljs-number">1</span>) <span class="hljs-keyword">AS</span> column_names
<span class="hljs-keyword">FROM</span>   extern
       <span class="hljs-keyword">CROSS</span> APPLY (<span class="hljs-keyword">SELECT</span> column_name <span class="hljs-operator">+</span> <span class="hljs-string">','</span>
                    <span class="hljs-keyword">FROM</span>   INFORMATION_SCHEMA.COLUMNS <span class="hljs-keyword">AS</span> intern
                    <span class="hljs-keyword">WHERE</span>  extern.table_name <span class="hljs-operator">=</span> intern.table_name
                    <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>), TYPE) x (column_names)
       <span class="hljs-keyword">CROSS</span> APPLY (<span class="hljs-keyword">SELECT</span> x.column_names.value(<span class="hljs-string">'.'</span>, <span class="hljs-string">'NVARCHAR(MAX)'</span>)) y(column_names) 
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I may be a bit late to the party but this method works for me and is easier than the COALESCE method.</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> STUFF(
             (<span class="hljs-keyword">SELECT</span> <span class="hljs-string">','</span> <span class="hljs-operator">+</span> Column_Name 
              <span class="hljs-keyword">FROM</span> Table_Name
              <span class="hljs-keyword">FOR</span> XML PATH (<span class="hljs-string">''</span>))
             , <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-string">''</span>)
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><strong>SQL Server 2017</strong> does introduce a new aggregate function</p>

<p><a href="https://msdn.microsoft.com/en-us/library/mt790580.aspx" rel="noreferrer"><code>STRING_AGG ( expression, separator)</code></a>.</p>

<blockquote>
  <p>Concatenates the values of string expressions and places separator
  values between them. The separator is not added at the end of string.</p>
</blockquote>

<p>The concatenated elements can be ordered by appending <code>WITHIN GROUP (ORDER BY some_expression)</code></p>

<p><strong>For versions 2005-2016</strong> I typically use the XML method in the accepted answer.</p>

<p>This can fail in some circumstances however. e.g. if the data to be concatenated contains <code>CHAR(29)</code> you see</p>

<blockquote>
  <p>FOR XML could not serialize the data ... because it
  contains a character (0x001D) which is not allowed in XML.</p>
</blockquote>

<p>A more robust method that can deal with all characters would be to use a CLR aggregate. However applying an ordering to the concatenated elements is more difficult with this approach.</p>

<p>The method of assigning to a variable is <a href="https://stackoverflow.com/questions/15138593/nvarchar-concatenation-index-nvarcharmax-inexplicable-behavior/15163136#15163136">not guaranteed</a> and should be avoided in production code.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Possibly too late to be of benefit now, but is this not the easiest way to do things?</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span>     empName, projIDs <span class="hljs-operator">=</span> replace
                          ((<span class="hljs-keyword">SELECT</span> Surname <span class="hljs-keyword">AS</span> [data()]
                              <span class="hljs-keyword">FROM</span> project_members
                              <span class="hljs-keyword">WHERE</span>  empName <span class="hljs-operator">=</span> a.empName
                              <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> empName <span class="hljs-keyword">FOR</span> xml path(<span class="hljs-string">''</span>)), <span class="hljs-string">' '</span>, REQUIRED SEPERATOR)
<span class="hljs-keyword">FROM</span>         project_members a
<span class="hljs-keyword">WHERE</span>     empName <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> empName
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Have a look at the <a href="https://github.com/orlando-colamatteo/ms-sql-server-group-concat-sqlclr" rel="noreferrer">GROUP_CONCAT</a> project on Github, I think I does exactly what you are searching for:</p>

<blockquote>
  <p>This project contains a set of SQLCLR User-defined Aggregate functions (SQLCLR UDAs) that collectively offer similar functionality to the MySQL GROUP_CONCAT function. There are multiple functions to ensure the best performance based on the functionality required...</p>
</blockquote>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>To concatenate all the project manager names from projects that have multiple project managers write:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> a.project_id,a.project_name,Stuff((<span class="hljs-keyword">SELECT</span> N<span class="hljs-string">'/ '</span> <span class="hljs-operator">+</span> first_name <span class="hljs-operator">+</span> <span class="hljs-string">', '</span><span class="hljs-operator">+</span>last_name <span class="hljs-keyword">FROM</span> projects_v 
<span class="hljs-keyword">where</span> a.project_id<span class="hljs-operator">=</span>project_id
 <span class="hljs-keyword">FOR</span>
 XML PATH(<span class="hljs-string">''</span>),TYPE).<span class="hljs-keyword">value</span>(<span class="hljs-string">'text()[1]'</span>,<span class="hljs-string">'nvarchar(max)'</span>),<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,N<span class="hljs-string">''</span>
) mgr_names
<span class="hljs-keyword">from</span> projects_v a
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a.project_id,a.project_name
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 7</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>With the below code you have to set PermissionLevel=External on your project properties before you deploy, and change the database to trust external code (be sure to read elsewhere about security risks and alternatives [like certificates]) by running "ALTER DATABASE database_name SET TRUSTWORTHY ON".</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">using</span> <span class="hljs-keyword">System</span>;
<span class="hljs-keyword">using</span> System.Collections.Generic;
<span class="hljs-keyword">using</span> System.Data.SqlTypes;
<span class="hljs-keyword">using</span> System.IO;
<span class="hljs-keyword">using</span> System.Runtime.Serialization;
<span class="hljs-keyword">using</span> System.Runtime.Serialization.Formatters.Binary;
<span class="hljs-keyword">using</span> Microsoft.SqlServer.Server;

[Serializable]
[SqlUserDefinedAggregate(Format.UserDefined,
MaxByteSize<span class="hljs-operator">=</span><span class="hljs-number">8000</span>,
IsInvariantToDuplicates<span class="hljs-operator">=</span><span class="hljs-literal">true</span>,
IsInvariantToNulls<span class="hljs-operator">=</span><span class="hljs-literal">true</span>,
IsInvariantToOrder<span class="hljs-operator">=</span><span class="hljs-literal">true</span>,
IsNullIfEmpty<span class="hljs-operator">=</span><span class="hljs-literal">true</span>)]
    public struct CommaDelimit : IBinarySerialize
{


[Serializable]
 private class StringList : List<span class="hljs-operator">&lt;</span>string<span class="hljs-operator">&gt;</span>
 { }

 private StringList List;

 public void Init()
 {
  this.List <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> StringList();
 }

 public void Accumulate(SqlString <span class="hljs-keyword">value</span>)
 {
  if (<span class="hljs-operator">!</span>value.IsNull)
   this.Add(value.Value);
 }

 private void <span class="hljs-keyword">Add</span>(string <span class="hljs-keyword">value</span>)
 {
  if (<span class="hljs-operator">!</span>this.List.Contains(<span class="hljs-keyword">value</span>))
   this.List.Add(<span class="hljs-keyword">value</span>);
 }

 public void <span class="hljs-keyword">Merge</span>(CommaDelimit <span class="hljs-keyword">group</span>)
 {
  foreach (string s <span class="hljs-keyword">in</span> group.List)
  {
   this.Add(s);
  }
 }

 void IBinarySerialize.Read(BinaryReader reader)
 {
    IFormatter formatter <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> BinaryFormatter();
    this.List <span class="hljs-operator">=</span> (StringList)formatter.Deserialize(reader.BaseStream);
 }

 public SqlString Terminate()
 {
  if (this.List.Count <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">0</span>)
   <span class="hljs-keyword">return</span> SqlString.Null;

  const string Separator <span class="hljs-operator">=</span> ", ";

  this.List.Sort();

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SqlString(String.Join(Separator, this.List.ToArray()));
 }

 void IBinarySerialize.Write(BinaryWriter writer)
 {
  IFormatter formatter <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> BinaryFormatter();
  formatter.Serialize(writer.BaseStream, this.List);
 }
    }
</code></pre>

<p>I've tested this using a query that looks like:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> 
 dbo.CommaDelimit(X.value) [delimited] 
<span class="hljs-keyword">FROM</span> 
 (
  <span class="hljs-keyword">SELECT</span> <span class="hljs-string">'D'</span> [<span class="hljs-keyword">value</span>] 
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-string">'B'</span> [<span class="hljs-keyword">value</span>] 
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-string">'B'</span> [<span class="hljs-keyword">value</span>] <span class="hljs-comment">-- intentional duplicate</span>
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-string">'A'</span> [<span class="hljs-keyword">value</span>] 
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-string">'C'</span> [<span class="hljs-keyword">value</span>] 
 ) X 
</code></pre>

<p>And yields: A, B, C, D</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 8</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Tried these but for my purposes in MS SQL Server 2005 the following was most useful, which I found at <a href="http://www.xaprb.com/blog/2005/09/28/simulating-the-group-concat-function/" rel="noreferrer">xaprb</a></p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">declare</span> <span class="hljs-variable">@result</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">8000</span>);

<span class="hljs-keyword">set</span> <span class="hljs-variable">@result</span> <span class="hljs-operator">=</span> <span class="hljs-string">''</span>;

<span class="hljs-keyword">select</span> <span class="hljs-variable">@result</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@result</span> <span class="hljs-operator">+</span> name <span class="hljs-operator">+</span> <span class="hljs-string">' '</span>

<span class="hljs-keyword">from</span> master.dbo.systypes;

<span class="hljs-keyword">select</span> rtrim(<span class="hljs-variable">@result</span>);
</code></pre>

<p>@Mark as you mentioned it was the space character that caused issues for me.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 9</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>About J Hardiman's answer, how about:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> empName, projIDs<span class="hljs-operator">=</span>
  REPLACE(
    REPLACE(
      (<span class="hljs-keyword">SELECT</span> REPLACE(projID, <span class="hljs-string">' '</span>, <span class="hljs-string">'-somebody-puts-microsoft-out-of-his-misery-please-'</span>) <span class="hljs-keyword">AS</span> [data()] <span class="hljs-keyword">FROM</span> project_members <span class="hljs-keyword">WHERE</span> empName<span class="hljs-operator">=</span>a.empName <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>)), 
      <span class="hljs-string">' '</span>, 
      <span class="hljs-string">' / '</span>), 
    <span class="hljs-string">'-somebody-puts-microsoft-out-of-his-misery-please-'</span>,
    <span class="hljs-string">' '</span>) 
  <span class="hljs-keyword">FROM</span> project_members a <span class="hljs-keyword">WHERE</span> empName <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> empName
</code></pre>

<p>By the way, is the use of "Surname" a typo or am i not understanding a concept here?</p>

<p>Anyway, thanks a lot guys cuz it saved me quite some time :)</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 10</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<h3>2021</h3>
<p>@AbdusSalamAzad's answer is the correct one.</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> STRING_AGG(my_col, <span class="hljs-string">','</span>) <span class="hljs-keyword">AS</span> my_result <span class="hljs-keyword">FROM</span> my_tbl;
</code></pre>
<p>If the result is too big, you may get error "<strong>STRING_AGG aggregation result exceeded the limit of 8000 bytes. Use LOB types to avoid result truncation.</strong>" , which can be fixed by changing the query to this:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> STRING_AGG(<span class="hljs-keyword">convert</span>(<span class="hljs-type">varchar</span>(max), my_col), <span class="hljs-string">','</span>) <span class="hljs-keyword">AS</span> my_result <span class="hljs-keyword">FROM</span> my_tbl;
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 11</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>UPDATE 2020: <strong>SQL Server 2016+</strong> <strong>JSON</strong> Serialization and De-serialization Examples</p>
<p>The data provided by the OP inserted into a temporary table called #project_members</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> #project_members;
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> #project_members(
  empName        <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,
  projID         <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>);
go
<span class="hljs-keyword">insert</span> #project_members(empName, projID) <span class="hljs-keyword">values</span>
(<span class="hljs-string">'ANDY'</span>, <span class="hljs-string">'A100'</span>),
(<span class="hljs-string">'ANDY'</span>, <span class="hljs-string">'B391'</span>),
(<span class="hljs-string">'ANDY'</span>, <span class="hljs-string">'X010'</span>),
(<span class="hljs-string">'TOM'</span>, <span class="hljs-string">'A100'</span>),
(<span class="hljs-string">'TOM'</span>, <span class="hljs-string">'A510'</span>);
</code></pre>
<p>How to serialize this data into a single JSON string with a nested array containing projID's</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> empName, (<span class="hljs-keyword">select</span> pm_json.projID 
                 <span class="hljs-keyword">from</span> #project_members pm_json 
                 <span class="hljs-keyword">where</span> pm.empName<span class="hljs-operator">=</span>pm_json.empName 
                 <span class="hljs-keyword">for</span> json path, root(<span class="hljs-string">'projList'</span>)) projJSON
<span class="hljs-keyword">from</span> #project_members pm
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> empName
<span class="hljs-keyword">for</span> json path;
</code></pre>
<p>Result</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-string">'[
  {
    "empName": "ANDY",
    "projJSON": {
      "projList": [
        { "projID": "A100" },
        { "projID": "B391" },
        { "projID": "X010" }
      ]
    }
  },
  {
    "empName": "TOM",
    "projJSON": {
      "projList": [
        { "projID": "A100" },
        { "projID": "A510" }
      ]
    }
  }
]'</span>
</code></pre>
<p>How to de-serialize this data from a single JSON string back to it's original rows and columns</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">declare</span> <span class="hljs-variable">@json</span>           nvarchar(max)<span class="hljs-operator">=</span>N<span class="hljs-string">'[{"empName":"ANDY","projJSON":{"projList":[{"projID":"A100"},
                                         {"projID":"B391"},{"projID":"X010"}]}},{"empName":"TOM","projJSON":
                                         {"projList":[{"projID":"A100"},{"projID":"A510"}]}}]'</span>;

<span class="hljs-keyword">select</span> oj.empName, noj.projID 
<span class="hljs-keyword">from</span> openjson(<span class="hljs-variable">@json</span>) <span class="hljs-keyword">with</span> (empName        <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),
                           projJSON       nvarchar(max) <span class="hljs-keyword">as</span> json) oj
     <span class="hljs-keyword">cross</span> apply openjson(oj.projJSON, <span class="hljs-string">'$.projList'</span>) <span class="hljs-keyword">with</span> (projID    <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>)) noj;
</code></pre>
<p>Results</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql">empName projID
ANDY    A100
ANDY    B391
ANDY    X010
TOM     A100
TOM     A510
</code></pre>
<p>How to persist the unique empName to a table and store the projID's in a nested JSON array</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> if <span class="hljs-keyword">exists</span> #project_members_with_json;
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> #project_members_with_json(
  empName        <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">unique</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,
  projJSON       nvarchar(max) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>);
go
<span class="hljs-keyword">insert</span> #project_members_with_json(empName, projJSON) 
<span class="hljs-keyword">select</span> empName, (<span class="hljs-keyword">select</span> pm_json.projID 
                 <span class="hljs-keyword">from</span> #project_members pm_json 
                 <span class="hljs-keyword">where</span> pm.empName<span class="hljs-operator">=</span>pm_json.empName 
                 <span class="hljs-keyword">for</span> json path, root(<span class="hljs-string">'projList'</span>)) 
<span class="hljs-keyword">from</span> #project_members pm
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> empName;
</code></pre>
<p>Results</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql">empName projJSON
ANDY    {"projList":[{"projID":"A100"},{"projID":"B391"},{"projID":"X010"}]}
TOM     {"projList":[{"projID":"A100"},{"projID":"A510"}]}
</code></pre>
<p>How to de-serialize from a table with unique empName and nested JSON array column containing projID's</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> wj.empName, oj.projID
<span class="hljs-keyword">from</span>
  #project_members_with_json wj
 <span class="hljs-keyword">cross</span> apply
  openjson(wj.projJSON, <span class="hljs-string">'$.projList'</span>) <span class="hljs-keyword">with</span> (projID    <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>)) oj;
</code></pre>
<p>Results</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql">empName projID
ANDY    A100
ANDY    B391
ANDY    X010
TOM     A100
TOM     A510
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 12</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>For SQL Server 2017+, use  STRING_AGG() function</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql">    <span class="hljs-keyword">SELECT</span> STRING_AGG(Genre, <span class="hljs-string">','</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">Result</span>
    <span class="hljs-keyword">FROM</span> Genres;
</code></pre>
<p>Sample result:</p>
<h2 id="result">Result</h2>
<p>Rock,Jazz,Country,Pop,Blues,Hip Hop,Rap,Punk</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 13</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>For my fellow Googlers out there, here's a very simple plug-and-play solution that worked for me after struggling with the more complex solutions for a while:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span>
<span class="hljs-keyword">distinct</span> empName,
NewColumnName<span class="hljs-operator">=</span>STUFF((<span class="hljs-keyword">SELECT</span> <span class="hljs-string">','</span><span class="hljs-operator">+</span> <span class="hljs-keyword">CONVERT</span>(<span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>), projID ) 
                     <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">returns</span> 
                     <span class="hljs-keyword">WHERE</span> empName<span class="hljs-operator">=</span>t.empName <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>)) , <span class="hljs-number">1</span> , <span class="hljs-number">1</span> , <span class="hljs-string">''</span> )
<span class="hljs-keyword">FROM</span> 
<span class="hljs-keyword">returns</span> t
</code></pre>

<p>Notice that I had to convert the ID into a VARCHAR in order to concatenate it as a string. If you don't have to do that, here's an even simpler version:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span>
<span class="hljs-keyword">distinct</span> empName,
NewColumnName<span class="hljs-operator">=</span>STUFF((<span class="hljs-keyword">SELECT</span> <span class="hljs-string">','</span><span class="hljs-operator">+</span> projID
                     <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">returns</span> 
                     <span class="hljs-keyword">WHERE</span> empName<span class="hljs-operator">=</span>t.empName <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>)) , <span class="hljs-number">1</span> , <span class="hljs-number">1</span> , <span class="hljs-string">''</span> )
<span class="hljs-keyword">FROM</span> 
<span class="hljs-keyword">returns</span> t
</code></pre>

<p>All credit for this goes to here:
<a href="https://social.msdn.microsoft.com/Forums/sqlserver/en-US/9508abc2-46e7-4186-b57f-7f368374e084/replicating-groupconcat-function-of-mysql-in-sql-server?forum=transactsql" rel="nofollow noreferrer">https://social.msdn.microsoft.com/Forums/sqlserver/en-US/9508abc2-46e7-4186-b57f-7f368374e084/replicating-groupconcat-function-of-mysql-in-sql-server?forum=transactsql</a></p>
    </div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;No REAL easy way to do this. Lots of ideas out there, though.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://blog.shlomoid.com/2008/11/emulating-mysqls-groupconcat-function.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Best one I\u0026apos;ve found\u0026lt;/a\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; table_name, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;LEFT\u0026lt;/span\u0026gt;(column_names , LEN(column_names )\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; column_names\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; information_schema.columns \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; extern\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CROSS\u0026lt;/span\u0026gt; APPLY\n(\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; column_name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; information_schema.columns \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; intern\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; extern.table_name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; intern.table_name\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)\n) pre_trimmed (column_names)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;GROUP\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; table_name, column_names;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Or a version that works correctly if the data might contain characters such as \u0026lt;code\u0026gt;\u0026amp;lt;\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WITH\u0026lt;/span\u0026gt; extern\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DISTINCT\u0026lt;/span\u0026gt; table_name\n         \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt;   INFORMATION_SCHEMA.COLUMNS)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; table_name,\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;LEFT\u0026lt;/span\u0026gt;(y.column_names, LEN(y.column_names) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; column_names\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt;   extern\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CROSS\u0026lt;/span\u0026gt; APPLY (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; column_name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt;   INFORMATION_SCHEMA.COLUMNS \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; intern\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt;  extern.table_name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; intern.table_name\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;), TYPE) x (column_names)\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CROSS\u0026lt;/span\u0026gt; APPLY (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; x.column_names.value(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;.\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;NVARCHAR(MAX)\u0026apos;\u0026lt;/span\u0026gt;)) y(column_names) \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I may be a bit late to the party but this method works for me and is easier than the COALESCE method.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; STUFF(\n             (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; Column_Name \n              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Table_Name\n              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;))\n             , \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;SQL Server 2017\u0026lt;/strong\u0026gt; does introduce a new aggregate function\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://msdn.microsoft.com/en-us/library/mt790580.aspx\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;STRING_AGG ( expression, separator)\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;Concatenates the values of string expressions and places separator\n  values between them. The separator is not added at the end of string.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;The concatenated elements can be ordered by appending \u0026lt;code\u0026gt;WITHIN GROUP (ORDER BY some_expression)\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;For versions 2005-2016\u0026lt;/strong\u0026gt; I typically use the XML method in the accepted answer.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This can fail in some circumstances however. e.g. if the data to be concatenated contains \u0026lt;code\u0026gt;CHAR(29)\u0026lt;/code\u0026gt; you see\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;FOR XML could not serialize the data ... because it\n  contains a character (0x001D) which is not allowed in XML.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;A more robust method that can deal with all characters would be to use a CLR aggregate. However applying an ordering to the concatenated elements is more difficult with this approach.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The method of assigning to a variable is \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/15138593/nvarchar-concatenation-index-nvarcharmax-inexplicable-behavior/15163136#15163136\u0026quot;\u0026gt;not guaranteed\u0026lt;/a\u0026gt; and should be avoided in production code.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Possibly too late to be of benefit now, but is this not the easiest way to do things?\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt;     empName, projIDs \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; replace\n                          ((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; Surname \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; [data()]\n                              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; project_members\n                              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt;  empName \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; a.empName\n                              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ORDER\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; empName \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; xml path(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)), \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \u0026apos;\u0026lt;/span\u0026gt;, REQUIRED SEPERATOR)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt;         project_members a\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt;     empName \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;IS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NOT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NULL\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;GROUP\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; empName\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Have a look at the \u0026lt;a href=\u0026quot;https://github.com/orlando-colamatteo/ms-sql-server-group-concat-sqlclr\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;GROUP_CONCAT\u0026lt;/a\u0026gt; project on Github, I think I does exactly what you are searching for:\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;This project contains a set of SQLCLR User-defined Aggregate functions (SQLCLR UDAs) that collectively offer similar functionality to the MySQL GROUP_CONCAT function. There are multiple functions to ensure the best performance based on the functionality required...\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n    ","\n\u0026lt;p\u0026gt;To concatenate all the project manager names from projects that have multiple project managers write:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; a.project_id,a.project_name,Stuff((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; N\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/ \u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; first_name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;, \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;last_name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; projects_v \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; a.project_id\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;project_id\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt;\n XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;),TYPE).\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;text()[1]\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;nvarchar(max)\u0026apos;\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;,N\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;\n) mgr_names\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; projects_v a\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;group\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; a.project_id,a.project_name\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;With the below code you have to set PermissionLevel=External on your project properties before you deploy, and change the database to trust external code (be sure to read elsewhere about security risks and alternatives [like certificates]) by running \u0026quot;ALTER DATABASE database_name SET TRUSTWORTHY ON\u0026quot;.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;System\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; System.Collections.Generic;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; System.Data.SqlTypes;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; System.IO;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; System.Runtime.Serialization;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; System.Runtime.Serialization.Formatters.Binary;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; Microsoft.SqlServer.Server;\n\n[Serializable]\n[SqlUserDefinedAggregate(Format.UserDefined,\nMaxByteSize\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8000\u0026lt;/span\u0026gt;,\nIsInvariantToDuplicates\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;,\nIsInvariantToNulls\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;,\nIsInvariantToOrder\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;,\nIsNullIfEmpty\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;)]\n    public struct CommaDelimit : IBinarySerialize\n{\n\n\n[Serializable]\n private class StringList : List\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;string\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n { }\n\n private StringList List;\n\n public void Init()\n {\n  this.List \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; StringList();\n }\n\n public void Accumulate(SqlString \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;)\n {\n  if (\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;!\u0026lt;/span\u0026gt;value.IsNull)\n   this.Add(value.Value);\n }\n\n private void \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Add\u0026lt;/span\u0026gt;(string \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;)\n {\n  if (\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;!\u0026lt;/span\u0026gt;this.List.Contains(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;))\n   this.List.Add(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;);\n }\n\n public void \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Merge\u0026lt;/span\u0026gt;(CommaDelimit \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;group\u0026lt;/span\u0026gt;)\n {\n  foreach (string s \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; group.List)\n  {\n   this.Add(s);\n  }\n }\n\n void IBinarySerialize.Read(BinaryReader reader)\n {\n    IFormatter formatter \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; BinaryFormatter();\n    this.List \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; (StringList)formatter.Deserialize(reader.BaseStream);\n }\n\n public SqlString Terminate()\n {\n  if (this.List.Count \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)\n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; SqlString.Null;\n\n  const string Separator \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026quot;, \u0026quot;;\n\n  this.List.Sort();\n\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlString(String.Join(Separator, this.List.ToArray()));\n }\n\n void IBinarySerialize.Write(BinaryWriter writer)\n {\n  IFormatter formatter \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; BinaryFormatter();\n  formatter.Serialize(writer.BaseStream, this.List);\n }\n    }\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;I\u0026apos;ve tested this using a query that looks like:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \n dbo.CommaDelimit(X.value) [delimited] \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \n (\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;D\u0026apos;\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;] \n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;UNION\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ALL\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;B\u0026apos;\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;] \n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;UNION\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ALL\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;B\u0026apos;\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;] \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- intentional duplicate\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;UNION\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ALL\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;A\u0026apos;\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;] \n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;UNION\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ALL\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;C\u0026apos;\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;] \n ) X \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;And yields: A, B, C, D\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Tried these but for my purposes in MS SQL Server 2005 the following was most useful, which I found at \u0026lt;a href=\u0026quot;http://www.xaprb.com/blog/2005/09/28/simulating-the-group-concat-function/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;xaprb\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@result\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8000\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@result\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@result\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@result\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; master.dbo.systypes;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; rtrim(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@result\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;@Mark as you mentioned it was the space character that caused issues for me.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;About J Hardiman\u0026apos;s answer, how about:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; empName, projIDs\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\n  REPLACE(\n    REPLACE(\n      (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; REPLACE(projID, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;-somebody-puts-microsoft-out-of-his-misery-please-\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; [data()] \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; project_members \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; empName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;a.empName \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)), \n      \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \u0026apos;\u0026lt;/span\u0026gt;, \n      \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; / \u0026apos;\u0026lt;/span\u0026gt;), \n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;-somebody-puts-microsoft-out-of-his-misery-please-\u0026apos;\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \u0026apos;\u0026lt;/span\u0026gt;) \n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; project_members a \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; empName \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;IS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NOT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NULL\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;GROUP\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; empName\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;By the way, is the use of \u0026quot;Surname\u0026quot; a typo or am i not understanding a concept here?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Anyway, thanks a lot guys cuz it saved me quite some time :)\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;h3\u0026gt;2021\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;@AbdusSalamAzad\u0026apos;s answer is the correct one.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; STRING_AGG(my_col, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; my_result \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; my_tbl;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;If the result is too big, you may get error \u0026quot;\u0026lt;strong\u0026gt;STRING_AGG aggregation result exceeded the limit of 8000 bytes. Use LOB types to avoid result truncation.\u0026lt;/strong\u0026gt;\u0026quot; , which can be fixed by changing the query to this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; STRING_AGG(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;convert\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(max), my_col), \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; my_result \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; my_tbl;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;UPDATE 2020: \u0026lt;strong\u0026gt;SQL Server 2016+\u0026lt;/strong\u0026gt; \u0026lt;strong\u0026gt;JSON\u0026lt;/strong\u0026gt; Serialization and De-serialization Examples\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The data provided by the OP inserted into a temporary table called #project_members\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;drop\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt; if \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;exists\u0026lt;/span\u0026gt; #project_members;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;create\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt; #project_members(\n  empName        \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;not\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;,\n  projID         \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;not\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;);\ngo\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;insert\u0026lt;/span\u0026gt; #project_members(empName, projID) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;values\u0026lt;/span\u0026gt;\n(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ANDY\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;A100\u0026apos;\u0026lt;/span\u0026gt;),\n(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ANDY\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;B391\u0026apos;\u0026lt;/span\u0026gt;),\n(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ANDY\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;X010\u0026apos;\u0026lt;/span\u0026gt;),\n(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;TOM\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;A100\u0026apos;\u0026lt;/span\u0026gt;),\n(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;TOM\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;A510\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;How to serialize this data into a single JSON string with a nested array containing projID\u0026apos;s\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; empName, (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; pm_json.projID \n                 \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; #project_members pm_json \n                 \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; pm.empName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;pm_json.empName \n                 \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; json path, root(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;projList\u0026apos;\u0026lt;/span\u0026gt;)) projJSON\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; #project_members pm\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;group\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; empName\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; json path;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Result\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;[\n  {\n    \u0026quot;empName\u0026quot;: \u0026quot;ANDY\u0026quot;,\n    \u0026quot;projJSON\u0026quot;: {\n      \u0026quot;projList\u0026quot;: [\n        { \u0026quot;projID\u0026quot;: \u0026quot;A100\u0026quot; },\n        { \u0026quot;projID\u0026quot;: \u0026quot;B391\u0026quot; },\n        { \u0026quot;projID\u0026quot;: \u0026quot;X010\u0026quot; }\n      ]\n    }\n  },\n  {\n    \u0026quot;empName\u0026quot;: \u0026quot;TOM\u0026quot;,\n    \u0026quot;projJSON\u0026quot;: {\n      \u0026quot;projList\u0026quot;: [\n        { \u0026quot;projID\u0026quot;: \u0026quot;A100\u0026quot; },\n        { \u0026quot;projID\u0026quot;: \u0026quot;A510\u0026quot; }\n      ]\n    }\n  }\n]\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;How to de-serialize this data from a single JSON string back to it\u0026apos;s original rows and columns\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@json\u0026lt;/span\u0026gt;           nvarchar(max)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;N\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;[{\u0026quot;empName\u0026quot;:\u0026quot;ANDY\u0026quot;,\u0026quot;projJSON\u0026quot;:{\u0026quot;projList\u0026quot;:[{\u0026quot;projID\u0026quot;:\u0026quot;A100\u0026quot;},\n                                         {\u0026quot;projID\u0026quot;:\u0026quot;B391\u0026quot;},{\u0026quot;projID\u0026quot;:\u0026quot;X010\u0026quot;}]}},{\u0026quot;empName\u0026quot;:\u0026quot;TOM\u0026quot;,\u0026quot;projJSON\u0026quot;:\n                                         {\u0026quot;projList\u0026quot;:[{\u0026quot;projID\u0026quot;:\u0026quot;A100\u0026quot;},{\u0026quot;projID\u0026quot;:\u0026quot;A510\u0026quot;}]}}]\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; oj.empName, noj.projID \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; openjson(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@json\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;with\u0026lt;/span\u0026gt; (empName        \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;),\n                           projJSON       nvarchar(max) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; json) oj\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;cross\u0026lt;/span\u0026gt; apply openjson(oj.projJSON, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$.projList\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;with\u0026lt;/span\u0026gt; (projID    \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;)) noj;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Results\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;empName projID\nANDY    A100\nANDY    B391\nANDY    X010\nTOM     A100\nTOM     A510\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;How to persist the unique empName to a table and store the projID\u0026apos;s in a nested JSON array\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;drop\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt; if \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;exists\u0026lt;/span\u0026gt; #project_members_with_json;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;create\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt; #project_members_with_json(\n  empName        \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;unique\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;not\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;,\n  projJSON       nvarchar(max) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;not\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;);\ngo\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;insert\u0026lt;/span\u0026gt; #project_members_with_json(empName, projJSON) \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; empName, (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; pm_json.projID \n                 \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; #project_members pm_json \n                 \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; pm.empName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;pm_json.empName \n                 \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; json path, root(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;projList\u0026apos;\u0026lt;/span\u0026gt;)) \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; #project_members pm\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;group\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; empName;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Results\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;empName projJSON\nANDY    {\u0026quot;projList\u0026quot;:[{\u0026quot;projID\u0026quot;:\u0026quot;A100\u0026quot;},{\u0026quot;projID\u0026quot;:\u0026quot;B391\u0026quot;},{\u0026quot;projID\u0026quot;:\u0026quot;X010\u0026quot;}]}\nTOM     {\u0026quot;projList\u0026quot;:[{\u0026quot;projID\u0026quot;:\u0026quot;A100\u0026quot;},{\u0026quot;projID\u0026quot;:\u0026quot;A510\u0026quot;}]}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;How to de-serialize from a table with unique empName and nested JSON array column containing projID\u0026apos;s\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; wj.empName, oj.projID\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt;\n  #project_members_with_json wj\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;cross\u0026lt;/span\u0026gt; apply\n  openjson(wj.projJSON, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$.projList\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;with\u0026lt;/span\u0026gt; (projID    \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;)) oj;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Results\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;empName projID\nANDY    A100\nANDY    B391\nANDY    X010\nTOM     A100\nTOM     A510\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;For SQL Server 2017+, use  STRING_AGG() function\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; STRING_AGG(Genre, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Result\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Genres;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Sample result:\u0026lt;/p\u0026gt;\n\u0026lt;h2 id=\u0026quot;result\u0026quot;\u0026gt;Result\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;Rock,Jazz,Country,Pop,Blues,Hip Hop,Rap,Punk\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;For my fellow Googlers out there, here\u0026apos;s a very simple plug-and-play solution that worked for me after struggling with the more complex solutions for a while:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;distinct\u0026lt;/span\u0026gt; empName,\nNewColumnName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;STUFF((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CONVERT\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;), projID ) \n                     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;returns\u0026lt;/span\u0026gt; \n                     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; empName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;t.empName \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)) , \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; , \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; , \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt; )\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;returns\u0026lt;/span\u0026gt; t\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Notice that I had to convert the ID into a VARCHAR in order to concatenate it as a string. If you don\u0026apos;t have to do that, here\u0026apos;s an even simpler version:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;distinct\u0026lt;/span\u0026gt; empName,\nNewColumnName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;STUFF((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; projID\n                     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;returns\u0026lt;/span\u0026gt; \n                     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; empName\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;t.empName \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)) , \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; , \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; , \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt; )\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;returns\u0026lt;/span\u0026gt; t\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;All credit for this goes to here:\n\u0026lt;a href=\u0026quot;https://social.msdn.microsoft.com/Forums/sqlserver/en-US/9508abc2-46e7-4186-b57f-7f368374e084/replicating-groupconcat-function-of-mysql-in-sql-server?forum=transactsql\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;https://social.msdn.microsoft.com/Forums/sqlserver/en-US/9508abc2-46e7-4186-b57f-7f368374e084/replicating-groupconcat-function-of-mysql-in-sql-server?forum=transactsql\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    "],"comment":["\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;A couple of handy links: \u0026lt;a href=\u0026quot;http://www.postgresonline.com/journal/archives/191-stringagg.html\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;postgresonline.com/journal/archives/191-stringagg.html\u0026lt;/a\u0026gt; and \u0026lt;a href=\u0026quot;http://consultingblogs.emc.com/jamiethomson/archive/2009/07/16/string-aggregation-in-t-sql-amp-pl-sql.aspx\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;consultingblogs.emc.com/jamiethomson/archive/2009/07/16/\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/137471/bernhof\u0026quot; title=\u0026quot;6,110 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;bernhof\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment8783619_451415\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2011-09-03 08:53:17Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 3, 2011 at 8:53\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;This is an old question, but I like \u0026lt;a href=\u0026quot;http://stackoverflow.com/a/9779711/498609\u0026quot;\u0026gt;the CLR solution given here\u0026lt;/a\u0026gt;.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/498609/diego\u0026quot; title=\u0026quot;17,499 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Diego\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment42386499_451415\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2012-03-20 01:54:26Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Mar 20, 2012 at 1:54\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;possible duplicate of \u0026lt;a href=\u0026quot;http://stackoverflow.com/questions/1817985/how-do-i-create-a-comma-separated-list-using-a-sql-query\u0026quot;\u0026gt;How do I Create a Comma-Separated List using a SQL Query?\u0026lt;/a\u0026gt; - that post is broader so I would choose that one as canonical\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/684229/tomas\u0026quot; title=\u0026quot;55,121 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Tomas\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment26373363_451415\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-08-03 06:43:56Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 3, 2013 at 6:43\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;possible duplicate of \u0026lt;a href=\u0026quot;http://stackoverflow.com/questions/8868604/sql-group-concat-function-in-sql-server\u0026quot;\u0026gt;SQL group_concat function in SQL Server\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1215724/trikaldarshiii\u0026quot; title=\u0026quot;11,044 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Trikaldarshiii\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment26744109_451415\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-08-14 19:23:21Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 14, 2013 at 19:23\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;How do you know which order the list by should be built, e.g. you show A100 / B391 / X010 but given there is no implicit ordering in a relational database it could just as easily be X010 / A100 / B391 or any other combination.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1750324/steve-ford\u0026quot; title=\u0026quot;7,173 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Steve Ford\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment34300119_451415\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2014-03-20 16:09:44Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Mar 20, 2014 at 16:09\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;This example worked for me, but I tried doing another aggregation and it didn\u0026apos;t work, gave me an error: \u0026quot;the correlation name \u0026apos;pre_trimmed\u0026apos; is specified multiple times in a FROM clause.\u0026quot;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/14392/philchuang\u0026quot; title=\u0026quot;2,506 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;PhilChuang\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment2056814_451441\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2010-01-22 19:24:46Z, License: CC BY-SA 2.5\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 22, 2010 at 19:24\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;\u0026apos;pre_trimmed\u0026apos; is just an alias for the subquery. Aliases are required for subqueries and have to be unique, so for another subquery change it to something unique...\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/192961/koen\u0026quot; title=\u0026quot;3,580 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Koen\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment12284819_451441\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2012-03-12 16:57:51Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Mar 12, 2012 at 16:57\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;can you show an example without table_name as a column name it\u0026apos;s confusing.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2193409/s-mason\u0026quot; title=\u0026quot;3,229 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;S.Mason\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment81672355_451441\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2017-11-17 21:47:18Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Nov 17, 2017 at 21:47\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;This only shows how to concat values - group_concat concats them by group, which is more challenging (and what the OP appears to require). See the accepted answer to SO 15154644 for how to do this - the WHERE clause is the critical addition\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1280840/djdave\u0026quot; title=\u0026quot;847 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;DJDave\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment83397194_5981860\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2018-01-11 13:26:45Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 11, 2018 at 13:26\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@DJDave was referring to \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/15154723/1518546\u0026quot;\u0026gt;this answer\u0026lt;/a\u0026gt;. See also \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/17591536/1518546\u0026quot;\u0026gt;the accepted answer to a similar question\u0026lt;/a\u0026gt;.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1518546/john-cummings\u0026quot; title=\u0026quot;1,642 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;John Cummings\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment96593997_5981860\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2019-02-27 20:19:21Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Feb 27, 2019 at 20:19\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;This is also available now in Azure SQL : \u0026lt;a href=\u0026quot;https://azure.microsoft.com/en-us/roadmap/new-t-sql-string-functions-in-azure-sql-database/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;azure.microsoft.com/en-us/roadmap/\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/16940/simon-weaver\u0026quot; title=\u0026quot;131,456 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Simon_Weaver\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment79383657_40692104\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2017-09-14 04:01:27Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 14, 2017 at 4:01\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Interesting.  I\u0026apos;ve already finished the project at hand, but I\u0026apos;ll give this method a try.  Thanks!\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/47450/danm\u0026quot; title=\u0026quot;6,867 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;DanM\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment2306663_2324093\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2010-02-25 16:59:00Z, License: CC BY-SA 2.5\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Feb 25, 2010 at 16:59\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Nice trick -- only problem is for surnames with spaces it will replace the space with the separator.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/21441/mark-elliot\u0026quot; title=\u0026quot;72,434 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Mark Elliot\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment3356141_2324093\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2010-07-14 16:16:51Z, License: CC BY-SA 2.5\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 14, 2010 at 16:16\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;I have encountered such a problem myself, Mark. Unfortunately, until MSSQL gets with the times and introduces GROUP_CONCAT, this is the least of the overhead-intensive methods I have been able to come up with for what is needed here.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/280090/j-hardiman\u0026quot; title=\u0026quot;519 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;J Hardiman\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment3456026_2324093\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2010-07-26 01:40:58Z, License: CC BY-SA 2.5\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 26, 2010 at 1:40\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Thanks for this! Here\u0026apos;s a SQL Fiddle showing it working: \u0026lt;a href=\u0026quot;http://sqlfiddle.com/#!6/c5d56/3\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;sqlfiddle.com/#!6/c5d56/3\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2648723/fleed\u0026quot; title=\u0026quot;611 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;fleed\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment53398616_2324093\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-09-25 10:30:43Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 25, 2015 at 10:30\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@MaxiWheat: a lot of guys don\u0026apos;t read question or answer carefully before clicking down vote. It affects to owner post directly due to their mistake.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/3558663/steve-lam\u0026quot; title=\u0026quot;917 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Steve Lam\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment54651045_13995658\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-10-30 08:17:17Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 30, 2015 at 8:17\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Works great. The only feature I am missing is the ability to sort on a column which MySQL group_concat() can like: \u0026lt;code\u0026gt;GROUP_CONCAT(klascode,\u0026apos;(\u0026apos;,name,\u0026apos;)\u0026apos; ORDER BY klascode ASC SEPARATOR \u0026apos;, \u0026apos;)\u0026lt;/code\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2386040/jan\u0026quot; title=\u0026quot;2,028 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Jan\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment93044743_13995658\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2018-10-30 21:33:08Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 30, 2018 at 21:33\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;I think that the engine does not really guarantee any order with this method, because the variables are computed as data flows depending on the exec plan.  It seems to work most of the time so far though.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/369665/phil-w\u0026quot; title=\u0026quot;1,164 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;phil_w\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment97454259_3884368\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2019-03-26 19:58:06Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Mar 26, 2019 at 19:58\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Rather unfriendly answer if you ask me and not at all helpful as an answer.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/90764/tim-meers\u0026quot; title=\u0026quot;908 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Tim Meers\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment12449454_3497435\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2012-03-20 02:04:45Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Mar 20, 2012 at 2:04\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;only seeing that now... I didn\u0026apos;t mean it in a mean way, at the time I was very frustrated with sql server (still am). answers from this post really were helpful actually; EDIT: why wasn\u0026apos;t it helpful btw? it did the trick for me\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/422190/user422190\u0026quot; title=\u0026quot;107 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;user422190\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment24427502_3497435\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-06-04 15:43:32Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jun 4, 2013 at 15:43\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;With this many answers already posted, I think it would be better if you incorporated your perfectly valid note about the 8000-byte limit problem, as well as the solution to it, into the \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/40692104\u0026quot;\u0026gt;answer that first suggested \u0026lt;code\u0026gt;STRING_AGG\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/297408/andriy-m\u0026quot; title=\u0026quot;73,982 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Andriy M\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment122873730_69389890\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2021-10-10 16:49:23Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 10, 2021 at 16:49\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Don\u0026apos;t see how this is relevant for the question asked, to be honest. The OP asked very specifically about simulating MySQL\u0026apos;s \u0026lt;code\u0026gt;GROUP_CONCAT\u0026lt;/code\u0026gt; behaviour. The string that \u0026lt;code\u0026gt;GROUP_CONCAT\u0026lt;/code\u0026gt; produces is just a list of values separated by a delimiter. A JSON-formatted string is much more than that.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/297408/andriy-m\u0026quot; title=\u0026quot;73,982 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Andriy M\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment112718704_63674567\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2020-09-04 14:27:13Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 4, 2020 at 14:27\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Valid solution but it \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/40692104\u0026quot;\u0026gt;has already been suggested\u0026lt;/a\u0026gt;.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/297408/andriy-m\u0026quot; title=\u0026quot;73,982 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Andriy M\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment121139720_68495106\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2021-07-27 13:14:24Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 27, 2021 at 13:14\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        "],"id":164,"title":"Simulating group_concat MySQL function in Microsoft SQL Server 2005?","content":"\n                \n\u0026lt;p\u0026gt;I\u0026apos;m trying to migrate a MySQL-based app over to Microsoft SQL Server 2005 (not by choice, but that\u0026apos;s life).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;In the original app, we used \u0026lt;em\u0026gt;almost\u0026lt;/em\u0026gt; entirely ANSI-SQL compliant statements, with one significant exception -- we used MySQL\u0026apos;s \u0026lt;code\u0026gt;group_concat\u0026lt;/code\u0026gt; function fairly frequently.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;group_concat\u0026lt;/code\u0026gt;, by the way, does this: given a table of, say, employee names and projects...\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; empName, projID \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; project_members;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;returns:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;ANDY   \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  A100\nANDY   \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  B391\nANDY   \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  X010\nTOM    \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  A100\nTOM    \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  A510\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;... and here\u0026apos;s what you get with group_concat:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \n    empName, group_concat(projID SEPARATOR \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; / \u0026apos;\u0026lt;/span\u0026gt;) \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \n    project_members \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;GROUP\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; \n    empName;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;returns:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;ANDY   \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  A100 \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt; B391 \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt; X010\nTOM    \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  A100 \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt; A510\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;So what I\u0026apos;d like to know is: Is it possible to write, say, a user-defined function in SQL Server which emulates the functionality of \u0026lt;code\u0026gt;group_concat\u0026lt;/code\u0026gt;? \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I have almost no experience using UDFs, stored procedures, or anything like that, just straight-up SQL, so please err on the side of too much explanation :)\u0026lt;/p\u0026gt;\n    ","slug":"simulating-group_concat-mysql-function-in-microsoft-sql-server-2005-1657384832169","postType":"QUESTION","createdAt":"2022-07-09T16:40:32.000Z","updatedAt":"2022-07-09T16:40:32.000Z","tags":[{"id":602,"name":"sql-server","slug":"sql-server","createdAt":"2022-07-09T16:40:32.000Z","updatedAt":"2022-07-09T16:40:32.000Z","Questions_Tags":{"questionId":164,"tagId":602}},{"id":603,"name":"sql-server-2005","slug":"sql-server-2005","createdAt":"2022-07-09T16:40:32.000Z","updatedAt":"2022-07-09T16:40:32.000Z","Questions_Tags":{"questionId":164,"tagId":603}},{"id":604,"name":"string-aggregation","slug":"string-aggregation","createdAt":"2022-07-09T16:40:32.000Z","updatedAt":"2022-07-09T16:40:32.000Z","Questions_Tags":{"questionId":164,"tagId":604}}]}},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"simulating-group_concat-mysql-function-in-microsoft-sql-server-2005-1657384832169"},"buildId":"4Y8KGE-c2lolBeBmcum_I","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>