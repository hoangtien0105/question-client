{"pageProps":{"data":{"answer":["\n&lt;p&gt;Using &lt;code&gt;password_hash&lt;/code&gt; is the recommended way to store passwords. Don&apos;t separate them to DB and files.&lt;/p&gt;\n&lt;p&gt;Let&apos;s say we have the following input:&lt;/p&gt;\n&lt;pre class=&quot;lang-php s-code-block&quot;&gt;&lt;code class=&quot;hljs language-php&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$password&lt;/span&gt; = &lt;span class=&quot;hljs-variable&quot;&gt;$_POST&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;password&apos;&lt;/span&gt;];\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;You first hash the password by doing this:&lt;/p&gt;\n&lt;pre class=&quot;lang-php s-code-block&quot;&gt;&lt;code class=&quot;hljs language-php&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$hashed_password&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;password_hash&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$password&lt;/span&gt;, PASSWORD_DEFAULT);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;Then see the output:&lt;/p&gt;\n&lt;pre class=&quot;lang-php s-code-block&quot;&gt;&lt;code class=&quot;hljs language-php&quot;&gt;&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;var_dump&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$hashed_password&lt;/span&gt;);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;As you can see it&apos;s hashed. (I assume you did those steps).&lt;/p&gt;\n&lt;p&gt;Now you store this hashed password in your database, &lt;strong&gt;ensuring your password column is large enough to hold the hashed value (at least 60 characters or longer)&lt;/strong&gt;. When a user asks to log them in, you check the password input with this hash value in the database, by doing this:&lt;/p&gt;\n&lt;pre class=&quot;lang-php s-code-block&quot;&gt;&lt;code class=&quot;hljs language-php&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Query the database for username and password&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;// ...&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;password_verify&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$password&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$hashed_password&lt;/span&gt;)) {\n    &lt;span class=&quot;hljs-comment&quot;&gt;// If the password inputs matched the hashed password in the database&lt;/span&gt;\n    &lt;span class=&quot;hljs-comment&quot;&gt;// Do something, you know... log them in.&lt;/span&gt;\n} \n\n&lt;span class=&quot;hljs-comment&quot;&gt;// Else, Redirect them back to the login page.&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;a href=&quot;http://php.net/manual/en/function.password-hash.php&quot; rel=&quot;noreferrer&quot;&gt;Official Reference&lt;/a&gt;&lt;/p&gt;\n    ","\n&lt;p&gt;Yes you understood it correctly, the function password_hash() will generate a salt on its own, and includes it in the resulting hash-value. Storing the salt in the database is absolutely correct, it does its job even if known.&lt;/p&gt;\n\n&lt;pre class=&quot;lang-php s-code-block&quot;&gt;&lt;code class=&quot;hljs language-php&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;// Hash a new password for storing in the database.&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;// The function automatically generates a cryptographically safe salt.&lt;/span&gt;\n&lt;span class=&quot;hljs-variable&quot;&gt;$hashToStoreInDb&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;password_hash&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$_POST&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;password&apos;&lt;/span&gt;], PASSWORD_DEFAULT);\n\n&lt;span class=&quot;hljs-comment&quot;&gt;// Check if the hash of the entered login password, matches the stored hash.&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;// The salt and the cost factor will be extracted from $existingHashFromDb.&lt;/span&gt;\n&lt;span class=&quot;hljs-variable&quot;&gt;$isPasswordCorrect&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;password_verify&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$_POST&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;password&apos;&lt;/span&gt;], &lt;span class=&quot;hljs-variable&quot;&gt;$existingHashFromDb&lt;/span&gt;);\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;The second salt you mentioned (the one stored in a file), is actually a pepper or a server side key. If you add it before hashing (like the salt), then you add a pepper. There is a better way though, you could first calculate the hash, and afterwards encrypt (two-way) the hash with a server-side key. This gives you the possibility to change the key when necessary.&lt;/p&gt;\n\n&lt;p&gt;In contrast to the salt, this key should be kept secret. People often mix it up and try to hide the salt, but it is better to let the salt do its job and add the secret with a key.&lt;/p&gt;\n    ","\n&lt;p&gt;Yes, it&apos;s true. Why do you doubt the php faq on the function? :)&lt;/p&gt;\n\n&lt;p&gt;The result of running &lt;code&gt;password_hash()&lt;/code&gt; has has four parts:&lt;/p&gt;\n\n&lt;ol&gt;\n&lt;li&gt;the algorithm used&lt;/li&gt;\n&lt;li&gt;parameters&lt;/li&gt;\n&lt;li&gt;salt&lt;/li&gt;\n&lt;li&gt;actual password hash&lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;p&gt;So as you can see, the hash is a part of it.&lt;/p&gt;\n\n&lt;p&gt;Sure, you could have an additional salt for an added layer of security, but I honestly think that&apos;s overkill in a regular php application. The default bcrypt algorithm is good, and the optional blowfish one is arguably even better.&lt;/p&gt;\n    ","\n&lt;p&gt;There is a distinct lack of discussion on backwards and forwards compatibility that is built in to PHP&apos;s password functions. Notably:&lt;/p&gt;\n\n&lt;ol&gt;\n&lt;li&gt;&lt;strong&gt;Backwards Compatibility:&lt;/strong&gt; The password functions are essentially a well-written wrapper around &lt;a href=&quot;http://php.net/manual/en/function.crypt.php&quot; rel=&quot;noreferrer&quot;&gt;&lt;code&gt;crypt()&lt;/code&gt;&lt;/a&gt;, and are inherently backwards-compatible with &lt;code&gt;crypt()&lt;/code&gt;-format hashes, even if they use obsolete and/or insecure hash algorithms.&lt;/li&gt;\n&lt;li&gt;&lt;strong&gt;Forwards Compatibilty:&lt;/strong&gt; Inserting &lt;a href=&quot;http://php.net/manual/en/function.password-needs-rehash.php&quot; rel=&quot;noreferrer&quot;&gt;&lt;code&gt;password_needs_rehash()&lt;/code&gt;&lt;/a&gt; and a bit of logic into your authentication workflow can keep you your hashes up to date with current and future algorithms with potentially zero future changes to the workflow. Note: Any string that does not match the specified algorithm will be flagged for needing a rehash, including non-crypt-compatible hashes.&lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;p&gt;Eg:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-php s-code-block&quot;&gt;&lt;code class=&quot;hljs language-php&quot;&gt;&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;FakeDB&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;__call&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$name&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$args&lt;/span&gt;&lt;/span&gt;) &lt;/span&gt;{\n        &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;%s::%s(%s)\\n&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-keyword&quot;&gt;__CLASS__&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$name&lt;/span&gt;, &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;json_encode&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$args&lt;/span&gt;));\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;;\n    }\n}\n\n&lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;MyAuth&lt;/span&gt; &lt;/span&gt;{\n    &lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$dbh&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$fakeUsers&lt;/span&gt; = [\n        &lt;span class=&quot;hljs-comment&quot;&gt;// old crypt-md5 format&lt;/span&gt;\n        &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; =&amp;gt; [&lt;span class=&quot;hljs-string&quot;&gt;&apos;password&apos;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;$1$AVbfJOzY$oIHHCHlD76Aw1xmjfTpm5.&apos;&lt;/span&gt;],\n        &lt;span class=&quot;hljs-comment&quot;&gt;// old salted md5 format&lt;/span&gt;\n        &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt; =&amp;gt; [&lt;span class=&quot;hljs-string&quot;&gt;&apos;password&apos;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;3858f62230ac3c915f300c664312c63f&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;salt&apos;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;bar&apos;&lt;/span&gt;],\n        &lt;span class=&quot;hljs-comment&quot;&gt;// current bcrypt format&lt;/span&gt;\n        &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt; =&amp;gt; [&lt;span class=&quot;hljs-string&quot;&gt;&apos;password&apos;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;$2y$10$3eUn9Rnf04DR.aj8R3WbHuBO9EdoceH9uKf6vMiD7tz766rMNOyTO&apos;&lt;/span&gt;]\n    ];\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;__construct&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$dbh&lt;/span&gt;&lt;/span&gt;) &lt;/span&gt;{\n        &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;dbh = &lt;span class=&quot;hljs-variable&quot;&gt;$dbh&lt;/span&gt;;\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;getuser&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$id&lt;/span&gt;&lt;/span&gt;) &lt;/span&gt;{\n        &lt;span class=&quot;hljs-comment&quot;&gt;// just pretend these are coming from the DB&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;fakeUsers[&lt;span class=&quot;hljs-variable&quot;&gt;$id&lt;/span&gt;];\n    }\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;authUser&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$id&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$password&lt;/span&gt;&lt;/span&gt;) &lt;/span&gt;{\n        &lt;span class=&quot;hljs-variable&quot;&gt;$userInfo&lt;/span&gt; = &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;getUser&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$id&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// Do you have old, turbo-legacy, non-crypt hashes?&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;( &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strpos&lt;/span&gt;( &lt;span class=&quot;hljs-variable&quot;&gt;$userInfo&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;password&apos;&lt;/span&gt;], &lt;span class=&quot;hljs-string&quot;&gt;&apos;$&apos;&lt;/span&gt; ) !== &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt; ) {\n            &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;%s::legacy_hash\\n&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-keyword&quot;&gt;__METHOD__&lt;/span&gt;);\n            &lt;span class=&quot;hljs-variable&quot;&gt;$res&lt;/span&gt; = &lt;span class=&quot;hljs-variable&quot;&gt;$userInfo&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;password&apos;&lt;/span&gt;] === &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;md5&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$password&lt;/span&gt; . &lt;span class=&quot;hljs-variable&quot;&gt;$userInfo&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;salt&apos;&lt;/span&gt;]);\n        } &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; {\n            &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;%s::password_verify\\n&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-keyword&quot;&gt;__METHOD__&lt;/span&gt;);\n            &lt;span class=&quot;hljs-variable&quot;&gt;$res&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;password_verify&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$password&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$userInfo&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;password&apos;&lt;/span&gt;]);\n        }\n\n        &lt;span class=&quot;hljs-comment&quot;&gt;// once we&apos;ve passed validation we can check if the hash needs updating.&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;( &lt;span class=&quot;hljs-variable&quot;&gt;$res&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;password_needs_rehash&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$userInfo&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;password&apos;&lt;/span&gt;], PASSWORD_DEFAULT) ) {\n            &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;%s::rehash\\n&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-keyword&quot;&gt;__METHOD__&lt;/span&gt;);\n            &lt;span class=&quot;hljs-variable&quot;&gt;$stmt&lt;/span&gt; = &lt;span class=&quot;hljs-variable language_&quot;&gt;$this&lt;/span&gt;-&amp;gt;dbh-&amp;gt;&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;prepare&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;UPDATE users SET pass = ? WHERE user_id = ?&apos;&lt;/span&gt;);\n            &lt;span class=&quot;hljs-variable&quot;&gt;$stmt&lt;/span&gt;-&amp;gt;&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;execute&lt;/span&gt;([&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;password_hash&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$password&lt;/span&gt;, PASSWORD_DEFAULT), &lt;span class=&quot;hljs-variable&quot;&gt;$id&lt;/span&gt;]);\n        }\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$res&lt;/span&gt;;\n    }\n}\n\n&lt;span class=&quot;hljs-variable&quot;&gt;$auth&lt;/span&gt; = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title class_&quot;&gt;MyAuth&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;FakeDB&lt;/span&gt;());\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;( &lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt;=&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;; &lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt;&amp;lt;=&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;; &lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt;++) {\n    &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;var_dump&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$auth&lt;/span&gt;-&amp;gt;&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;authuser&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;foo&apos;&lt;/span&gt;));\n    &lt;span class=&quot;hljs-keyword&quot;&gt;echo&lt;/span&gt; PHP_EOL;\n}\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;Output:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-php s-code-block&quot;&gt;&lt;code class=&quot;hljs language-php&quot;&gt;&lt;span class=&quot;hljs-title class_&quot;&gt;MyAuth&lt;/span&gt;::&lt;span class=&quot;hljs-variable constant_&quot;&gt;authUser&lt;/span&gt;::&lt;span class=&quot;hljs-variable constant_&quot;&gt;password_verify&lt;/span&gt;\n&lt;span class=&quot;hljs-title class_&quot;&gt;MyAuth&lt;/span&gt;::&lt;span class=&quot;hljs-variable constant_&quot;&gt;authUser&lt;/span&gt;::&lt;span class=&quot;hljs-variable constant_&quot;&gt;rehash&lt;/span&gt;\nFakeDB::&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;prepare&lt;/span&gt;([&lt;span class=&quot;hljs-string&quot;&gt;&quot;UPDATE users SET pass = ? WHERE user_id = ?&quot;&lt;/span&gt;])\nFakeDB::&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;execute&lt;/span&gt;([[&lt;span class=&quot;hljs-string&quot;&gt;&quot;&lt;span class=&quot;hljs-subst&quot;&gt;$2y&lt;/span&gt;&lt;span class=&quot;hljs-subst&quot;&gt;$10&lt;/span&gt;&lt;span class=&quot;hljs-subst&quot;&gt;$zNjPwqQX&lt;/span&gt;\\/RxjHiwkeUEzwOpkucNw49yN4jjiRY70viZpAx5x69kv.&quot;&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;]])\n&lt;span class=&quot;hljs-keyword&quot;&gt;bool&lt;/span&gt;(&lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;)\n\n&lt;span class=&quot;hljs-title class_&quot;&gt;MyAuth&lt;/span&gt;::&lt;span class=&quot;hljs-variable constant_&quot;&gt;authUser&lt;/span&gt;::&lt;span class=&quot;hljs-variable constant_&quot;&gt;legacy_hash&lt;/span&gt;\n&lt;span class=&quot;hljs-title class_&quot;&gt;MyAuth&lt;/span&gt;::&lt;span class=&quot;hljs-variable constant_&quot;&gt;authUser&lt;/span&gt;::&lt;span class=&quot;hljs-variable constant_&quot;&gt;rehash&lt;/span&gt;\nFakeDB::&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;prepare&lt;/span&gt;([&lt;span class=&quot;hljs-string&quot;&gt;&quot;UPDATE users SET pass = ? WHERE user_id = ?&quot;&lt;/span&gt;])\nFakeDB::&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;execute&lt;/span&gt;([[&lt;span class=&quot;hljs-string&quot;&gt;&quot;&lt;span class=&quot;hljs-subst&quot;&gt;$2y&lt;/span&gt;&lt;span class=&quot;hljs-subst&quot;&gt;$10&lt;/span&gt;&lt;span class=&quot;hljs-subst&quot;&gt;$VRTu4pgIkGUvilTDRTXYeOQSEYqe2GjsPoWvDUeYdV2x&lt;/span&gt;\\/\\/StjZYHu&quot;&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;]])\n&lt;span class=&quot;hljs-keyword&quot;&gt;bool&lt;/span&gt;(&lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;)\n\n&lt;span class=&quot;hljs-title class_&quot;&gt;MyAuth&lt;/span&gt;::&lt;span class=&quot;hljs-variable constant_&quot;&gt;authUser&lt;/span&gt;::&lt;span class=&quot;hljs-variable constant_&quot;&gt;password_verify&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;bool&lt;/span&gt;(&lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;)\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;As a final note, given that you can only re-hash a user&apos;s password on login you should consider &quot;sunsetting&quot; insecure legacy hashes to protect your users. By this I mean that after a certain grace period you remove all insecure [eg: bare MD5/SHA/otherwise weak] hashes and have your users rely on your application&apos;s password reset mechanisms.&lt;/p&gt;\n    ","\n&lt;p&gt;Class Password full code:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-php s-code-block&quot;&gt;&lt;code class=&quot;hljs language-php&quot;&gt;Class Password {\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;__construct&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;{}\n\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * Hash the password using the specified algorithm\n     *\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; string $password The password to hash\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; int    $algo     The algorithm to use (Defined by PASSWORD_* constants)\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; array  $options  The options for the algorithm to use\n     *\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@return&lt;/span&gt; string|false The hashed password, or false on error.\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;password_hash&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$password&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$algo&lt;/span&gt;, &lt;span class=&quot;hljs-keyword&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$options&lt;/span&gt; = &lt;span class=&quot;hljs-keyword&quot;&gt;array&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;) &lt;/span&gt;{\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;function_exists&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;crypt&apos;&lt;/span&gt;)) {\n            &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trigger_error&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Crypt must be loaded for password_hash to function&quot;&lt;/span&gt;, E_USER_WARNING);\n            &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;is_string&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$password&lt;/span&gt;)) {\n            &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trigger_error&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;password_hash(): Password must be a string&quot;&lt;/span&gt;, E_USER_WARNING);\n            &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;is_int&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$algo&lt;/span&gt;)) {\n            &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trigger_error&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;password_hash() expects parameter 2 to be long, &quot;&lt;/span&gt; . &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;gettype&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$algo&lt;/span&gt;) . &lt;span class=&quot;hljs-string&quot;&gt;&quot; given&quot;&lt;/span&gt;, E_USER_WARNING);\n            &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;switch&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$algo&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; PASSWORD_BCRYPT :\n                &lt;span class=&quot;hljs-comment&quot;&gt;// Note that this is a C constant, but not exposed to PHP, so we don&apos;t define it here.&lt;/span&gt;\n                &lt;span class=&quot;hljs-variable&quot;&gt;$cost&lt;/span&gt; = &lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;;\n                &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;isset&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$options&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;cost&apos;&lt;/span&gt;])) {\n                    &lt;span class=&quot;hljs-variable&quot;&gt;$cost&lt;/span&gt; = &lt;span class=&quot;hljs-variable&quot;&gt;$options&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;cost&apos;&lt;/span&gt;];\n                    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$cost&lt;/span&gt; &amp;lt; &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt; || &lt;span class=&quot;hljs-variable&quot;&gt;$cost&lt;/span&gt; &amp;gt; &lt;span class=&quot;hljs-number&quot;&gt;31&lt;/span&gt;) {\n                        &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trigger_error&lt;/span&gt;(&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;password_hash(): Invalid bcrypt cost parameter specified: %d&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$cost&lt;/span&gt;), E_USER_WARNING);\n                        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n                    }\n                }\n                &lt;span class=&quot;hljs-comment&quot;&gt;// The length of salt to generate&lt;/span&gt;\n                &lt;span class=&quot;hljs-variable&quot;&gt;$raw_salt_len&lt;/span&gt; = &lt;span class=&quot;hljs-number&quot;&gt;16&lt;/span&gt;;\n                &lt;span class=&quot;hljs-comment&quot;&gt;// The length required in the final serialization&lt;/span&gt;\n                &lt;span class=&quot;hljs-variable&quot;&gt;$required_salt_len&lt;/span&gt; = &lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;;\n                &lt;span class=&quot;hljs-variable&quot;&gt;$hash_format&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;&lt;span class=&quot;hljs-subst&quot;&gt;$2y&lt;/span&gt;$%02d$&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$cost&lt;/span&gt;);\n                &lt;span class=&quot;hljs-keyword&quot;&gt;break&lt;/span&gt;;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;default&lt;/span&gt; :\n                &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trigger_error&lt;/span&gt;(&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;password_hash(): Unknown password hashing algorithm: %s&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$algo&lt;/span&gt;), E_USER_WARNING);\n                &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;isset&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$options&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;salt&apos;&lt;/span&gt;])) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;switch&lt;/span&gt; (&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;gettype&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$options&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;salt&apos;&lt;/span&gt;])) {\n                &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;NULL&apos;&lt;/span&gt; :\n                &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;boolean&apos;&lt;/span&gt; :\n                &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;integer&apos;&lt;/span&gt; :\n                &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;double&apos;&lt;/span&gt; :\n                &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;string&apos;&lt;/span&gt; :\n                    &lt;span class=&quot;hljs-variable&quot;&gt;$salt&lt;/span&gt; = (&lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt;)&lt;span class=&quot;hljs-variable&quot;&gt;$options&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;salt&apos;&lt;/span&gt;];\n                    &lt;span class=&quot;hljs-keyword&quot;&gt;break&lt;/span&gt;;\n                &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;object&apos;&lt;/span&gt; :\n                    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;method_exists&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$options&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;salt&apos;&lt;/span&gt;], &lt;span class=&quot;hljs-string&quot;&gt;&apos;__tostring&apos;&lt;/span&gt;)) {\n                        &lt;span class=&quot;hljs-variable&quot;&gt;$salt&lt;/span&gt; = (&lt;span class=&quot;hljs-keyword&quot;&gt;string&lt;/span&gt;)&lt;span class=&quot;hljs-variable&quot;&gt;$options&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;salt&apos;&lt;/span&gt;];\n                        &lt;span class=&quot;hljs-keyword&quot;&gt;break&lt;/span&gt;;\n                    }\n                &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;array&apos;&lt;/span&gt; :\n                &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;resource&apos;&lt;/span&gt; :\n                &lt;span class=&quot;hljs-keyword&quot;&gt;default&lt;/span&gt; :\n                    &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trigger_error&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;password_hash(): Non-string salt parameter supplied&apos;&lt;/span&gt;, E_USER_WARNING);\n                    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n            }\n            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strlen&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$salt&lt;/span&gt;) &amp;lt; &lt;span class=&quot;hljs-variable&quot;&gt;$required_salt_len&lt;/span&gt;) {\n                &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trigger_error&lt;/span&gt;(&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;sprintf&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;password_hash(): Provided salt is too short: %d expecting %d&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strlen&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$salt&lt;/span&gt;), &lt;span class=&quot;hljs-variable&quot;&gt;$required_salt_len&lt;/span&gt;), E_USER_WARNING);\n                &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;null&lt;/span&gt;;\n            } &lt;span class=&quot;hljs-keyword&quot;&gt;elseif&lt;/span&gt; (&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt; == &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;preg_match&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;#^[a-zA-Z0-9./]+$#D&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$salt&lt;/span&gt;)) {\n                &lt;span class=&quot;hljs-variable&quot;&gt;$salt&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;str_replace&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;+&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;.&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;base64_encode&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$salt&lt;/span&gt;));\n            }\n        } &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; {\n            &lt;span class=&quot;hljs-variable&quot;&gt;$salt&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;str_replace&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;+&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;.&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;base64_encode&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$this&lt;/span&gt;-&amp;gt;&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;generate_entropy&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$required_salt_len&lt;/span&gt;)));\n        }\n        &lt;span class=&quot;hljs-variable&quot;&gt;$salt&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;substr&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$salt&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$required_salt_len&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt; = &lt;span class=&quot;hljs-variable&quot;&gt;$hash_format&lt;/span&gt; . &lt;span class=&quot;hljs-variable&quot;&gt;$salt&lt;/span&gt;;\n\n        &lt;span class=&quot;hljs-variable&quot;&gt;$ret&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;crypt&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$password&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;is_string&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$ret&lt;/span&gt;) || &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strlen&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$ret&lt;/span&gt;) &amp;lt;= &lt;span class=&quot;hljs-number&quot;&gt;13&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;;\n        }\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$ret&lt;/span&gt;;\n    }\n\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * Generates Entropy using the safest available method, falling back to less preferred methods depending on support\n     *\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; int $bytes\n     *\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@return&lt;/span&gt; string Returns raw bytes\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;generate_entropy&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$bytes&lt;/span&gt;&lt;/span&gt;)&lt;/span&gt;{\n        &lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt; = &lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;;\n        &lt;span class=&quot;hljs-variable&quot;&gt;$buffer_valid&lt;/span&gt; = &lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;function_exists&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;mcrypt_create_iv&apos;&lt;/span&gt;) &amp;amp;&amp;amp; !&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;defined&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;PHALANGER&apos;&lt;/span&gt;)) {\n            &lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;mcrypt_create_iv&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$bytes&lt;/span&gt;, MCRYPT_DEV_URANDOM);\n            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt;) {\n                &lt;span class=&quot;hljs-variable&quot;&gt;$buffer_valid&lt;/span&gt; = &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\n            }\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;hljs-variable&quot;&gt;$buffer_valid&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;function_exists&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;openssl_random_pseudo_bytes&apos;&lt;/span&gt;)) {\n            &lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;openssl_random_pseudo_bytes&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$bytes&lt;/span&gt;);\n            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt;) {\n                &lt;span class=&quot;hljs-variable&quot;&gt;$buffer_valid&lt;/span&gt; = &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\n            }\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;hljs-variable&quot;&gt;$buffer_valid&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;is_readable&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;/dev/urandom&apos;&lt;/span&gt;)) {\n            &lt;span class=&quot;hljs-variable&quot;&gt;$f&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;fopen&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;/dev/urandom&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;r&apos;&lt;/span&gt;);\n            &lt;span class=&quot;hljs-variable&quot;&gt;$read&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strlen&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt;);\n            &lt;span class=&quot;hljs-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$read&lt;/span&gt; &amp;lt; &lt;span class=&quot;hljs-variable&quot;&gt;$bytes&lt;/span&gt;) {\n                &lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt; .= &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;fread&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$f&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$bytes&lt;/span&gt; - &lt;span class=&quot;hljs-variable&quot;&gt;$read&lt;/span&gt;);\n                &lt;span class=&quot;hljs-variable&quot;&gt;$read&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strlen&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt;);\n            }\n            &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;fclose&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$f&lt;/span&gt;);\n            &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$read&lt;/span&gt; &amp;gt;= &lt;span class=&quot;hljs-variable&quot;&gt;$bytes&lt;/span&gt;) {\n                &lt;span class=&quot;hljs-variable&quot;&gt;$buffer_valid&lt;/span&gt; = &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\n            }\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;hljs-variable&quot;&gt;$buffer_valid&lt;/span&gt; || &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strlen&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt;) &amp;lt; &lt;span class=&quot;hljs-variable&quot;&gt;$bytes&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-variable&quot;&gt;$bl&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strlen&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt;);\n            &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt; = &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;; &lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt; &amp;lt; &lt;span class=&quot;hljs-variable&quot;&gt;$bytes&lt;/span&gt;; &lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt;++) {\n                &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt; &amp;lt; &lt;span class=&quot;hljs-variable&quot;&gt;$bl&lt;/span&gt;) {\n                    &lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt;[&lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt;] = &lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt;[&lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt;] ^ &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;chr&lt;/span&gt;(&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;mt_rand&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;255&lt;/span&gt;));\n                } &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; {\n                    &lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt; .= &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;chr&lt;/span&gt;(&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;mt_rand&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;255&lt;/span&gt;));\n                }\n            }\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$buffer&lt;/span&gt;;\n    }\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * Get information about the password hash. Returns an array of the information\n     * that was used to generate the password hash.\n     *\n     * array(\n     *    &apos;algo&apos; =&amp;gt; 1,\n     *    &apos;algoName&apos; =&amp;gt; &apos;bcrypt&apos;,\n     *    &apos;options&apos; =&amp;gt; array(\n     *        &apos;cost&apos; =&amp;gt; 10,\n     *    ),\n     * )\n     *\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; string $hash The password hash to extract info from\n     *\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@return&lt;/span&gt; array The array of information about the hash.\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;password_get_info&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt;&lt;/span&gt;) &lt;/span&gt;{\n        &lt;span class=&quot;hljs-variable&quot;&gt;$return&lt;/span&gt; = &lt;span class=&quot;hljs-keyword&quot;&gt;array&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;algo&apos;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;algoName&apos;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;unknown&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;options&apos;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-keyword&quot;&gt;array&lt;/span&gt;(), );\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;substr&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;) == &lt;span class=&quot;hljs-string&quot;&gt;&apos;$2y$&apos;&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strlen&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt;) == &lt;span class=&quot;hljs-number&quot;&gt;60&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-variable&quot;&gt;$return&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;algo&apos;&lt;/span&gt;] = PASSWORD_BCRYPT;\n            &lt;span class=&quot;hljs-variable&quot;&gt;$return&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;algoName&apos;&lt;/span&gt;] = &lt;span class=&quot;hljs-string&quot;&gt;&apos;bcrypt&apos;&lt;/span&gt;;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;list&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$cost&lt;/span&gt;) = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;sscanf&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;&lt;span class=&quot;hljs-subst&quot;&gt;$2y&lt;/span&gt;$%d$&quot;&lt;/span&gt;);\n            &lt;span class=&quot;hljs-variable&quot;&gt;$return&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;options&apos;&lt;/span&gt;][&lt;span class=&quot;hljs-string&quot;&gt;&apos;cost&apos;&lt;/span&gt;] = &lt;span class=&quot;hljs-variable&quot;&gt;$cost&lt;/span&gt;;\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$return&lt;/span&gt;;\n    }\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * Determine if the password hash needs to be rehashed according to the options provided\n     *\n     * If the answer is true, after validating the password using password_verify, rehash it.\n     *\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; string $hash    The hash to test\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; int    $algo    The algorithm used for new password hashes\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; array  $options The options array passed to password_hash\n     *\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@return&lt;/span&gt; boolean True if the password needs to be rehashed.\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;password_needs_rehash&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$algo&lt;/span&gt;, &lt;span class=&quot;hljs-keyword&quot;&gt;array&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$options&lt;/span&gt; = &lt;span class=&quot;hljs-keyword&quot;&gt;array&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;/span&gt;)&lt;/span&gt;) &lt;/span&gt;{\n        &lt;span class=&quot;hljs-variable&quot;&gt;$info&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;password_get_info&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt;);\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$info&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;algo&apos;&lt;/span&gt;] != &lt;span class=&quot;hljs-variable&quot;&gt;$algo&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;switch&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$algo&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; PASSWORD_BCRYPT :\n                &lt;span class=&quot;hljs-variable&quot;&gt;$cost&lt;/span&gt; = &lt;span class=&quot;hljs-keyword&quot;&gt;isset&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$options&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;cost&apos;&lt;/span&gt;]) ? &lt;span class=&quot;hljs-variable&quot;&gt;$options&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;cost&apos;&lt;/span&gt;] : &lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;;\n                &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$cost&lt;/span&gt; != &lt;span class=&quot;hljs-variable&quot;&gt;$info&lt;/span&gt;[&lt;span class=&quot;hljs-string&quot;&gt;&apos;options&apos;&lt;/span&gt;][&lt;span class=&quot;hljs-string&quot;&gt;&apos;cost&apos;&lt;/span&gt;]) {\n                    &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;;\n                }\n                &lt;span class=&quot;hljs-keyword&quot;&gt;break&lt;/span&gt;;\n        }\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;;\n    }\n\n    &lt;span class=&quot;hljs-comment&quot;&gt;/**\n     * Verify a password against a hash using a timing attack resistant approach\n     *\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; string $password The password to verify\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@param&lt;/span&gt; string $hash     The hash to verify against\n     *\n     * &lt;span class=&quot;hljs-doctag&quot;&gt;@return&lt;/span&gt; boolean If the password matches the hash\n     */&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;password_verify&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$password&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt;&lt;/span&gt;) &lt;/span&gt;{\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;function_exists&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;crypt&apos;&lt;/span&gt;)) {\n            &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;trigger_error&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Crypt must be loaded for password_verify to function&quot;&lt;/span&gt;, E_USER_WARNING);\n            &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;;\n        }\n        &lt;span class=&quot;hljs-variable&quot;&gt;$ret&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;crypt&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$password&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt;);\n        &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;is_string&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$ret&lt;/span&gt;) || &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strlen&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$ret&lt;/span&gt;) != &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strlen&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt;) || &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strlen&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$ret&lt;/span&gt;) &amp;lt;= &lt;span class=&quot;hljs-number&quot;&gt;13&lt;/span&gt;) {\n            &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;;\n        }\n\n        &lt;span class=&quot;hljs-variable&quot;&gt;$status&lt;/span&gt; = &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt; = &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;; &lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt; &amp;lt; &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;strlen&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$ret&lt;/span&gt;); &lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt;++) {\n            &lt;span class=&quot;hljs-variable&quot;&gt;$status&lt;/span&gt; |= (&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;ord&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$ret&lt;/span&gt;[&lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt;]) ^ &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;ord&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt;[&lt;span class=&quot;hljs-variable&quot;&gt;$i&lt;/span&gt;]));\n        }\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$status&lt;/span&gt; === &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Ive built a function I use all the time for password validation and to create passwords, e.g. to store them in a MySQL database. It uses a randomly generated salt which is way more secure than using a static salt.&lt;/p&gt;\n\n&lt;pre class=&quot;lang-php s-code-block&quot;&gt;&lt;code class=&quot;hljs language-php&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;secure_password&lt;/span&gt;(&lt;span class=&quot;hljs-params&quot;&gt;&lt;span class=&quot;hljs-variable&quot;&gt;$user_pwd&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$multi&lt;/span&gt;&lt;/span&gt;) &lt;/span&gt;{\n\n&lt;span class=&quot;hljs-comment&quot;&gt;/*\n    secure_password ( string $user_pwd, boolean/string $multi ) \n\n    *** Description: \n        This function verifies a password against a (database-) stored password&apos;s hash or\n        returns $hash for a given password if $multi is set to either true or false\n\n    *** Examples:\n        // To check a password against its hash\n        if(secure_password($user_password, $row[&apos;user_password&apos;])) {\n            login_function();\n        } \n        // To create a password-hash\n        $my_password = &apos;uber_sEcUrE_pass&apos;;\n        $hash = secure_password($my_password, true);\n        echo $hash;\n*/&lt;/span&gt;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;// Set options for encryption and build unique random hash&lt;/span&gt;\n&lt;span class=&quot;hljs-variable&quot;&gt;$crypt_options&lt;/span&gt; = [&lt;span class=&quot;hljs-string&quot;&gt;&apos;cost&apos;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;salt&apos;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;mcrypt_create_iv&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;, MCRYPT_DEV_URANDOM)];\n&lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt; = &lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;password_hash&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$user_pwd&lt;/span&gt;, PASSWORD_BCRYPT, &lt;span class=&quot;hljs-variable&quot;&gt;$crypt_options&lt;/span&gt;);\n\n&lt;span class=&quot;hljs-comment&quot;&gt;// If $multi is not boolean check password and return validation state true/false&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$multi&lt;/span&gt;!==&lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;hljs-variable&quot;&gt;$multi&lt;/span&gt;!==&lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;) {\n    &lt;span class=&quot;hljs-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;hljs-title function_ invoke__&quot;&gt;password_verify&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;$user_pwd&lt;/span&gt;, &lt;span class=&quot;hljs-variable&quot;&gt;$table_pwd&lt;/span&gt; = &lt;span class=&quot;hljs-variable&quot;&gt;$multi&lt;/span&gt;)) {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;true&lt;/span&gt;; &lt;span class=&quot;hljs-comment&quot;&gt;// valid password&lt;/span&gt;\n    } &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; {\n        &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-literal&quot;&gt;false&lt;/span&gt;; &lt;span class=&quot;hljs-comment&quot;&gt;// invalid password&lt;/span&gt;\n    }\n&lt;span class=&quot;hljs-comment&quot;&gt;// If $multi is boolean return $hash&lt;/span&gt;\n} &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;$hash&lt;/span&gt;;\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n    "],"comment":["\n            &lt;div class=&quot;comment-body js-comment-edit-hide&quot;&gt;\n                \n                &lt;span class=&quot;comment-copy&quot;&gt;No. Let the function take care of the salt. Double salting will cause you trouble and there&apos;s no need for it.&lt;/span&gt;\n                \n              &lt;div class=&quot;d-inline-flex ai-center&quot;&gt;\n&amp;nbsp;&lt;a href=&quot;/users/1415724/funk-forty-niner&quot; title=&quot;74,253 reputation&quot; class=&quot;comment-user&quot;&gt;Funk Forty Niner&lt;/a&gt;\n                &lt;/div&gt;\n                &lt;span class=&quot;comment-date&quot; dir=&quot;ltr&quot;&gt;&lt;a class=&quot;comment-link&quot; href=&quot;#comment48657108_30279321&quot;&gt;&lt;span title=&quot;2015-05-16 18:43:56Z, License: CC BY-SA 3.0&quot; class=&quot;relativetime-clean&quot;&gt;May 16, 2015 at 18:43&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;\n            &lt;/div&gt;\n        ","\n            &lt;div class=&quot;comment-body js-comment-edit-hide&quot;&gt;\n                \n                &lt;span class=&quot;comment-copy&quot;&gt;As @martinstoeckli mentions in their answer, what&apos;s being described here is known as a &quot;pepper&quot; and is often recommended these days. You were a trailblazer, Josh! :D&lt;/span&gt;\n                \n              &lt;div class=&quot;d-inline-flex ai-center&quot;&gt;\n&amp;nbsp;&lt;a href=&quot;/users/915762/joloco&quot; title=&quot;1,345 reputation&quot; class=&quot;comment-user&quot;&gt;JoLoCo&lt;/a&gt;\n                &lt;/div&gt;\n                &lt;span class=&quot;comment-date&quot; dir=&quot;ltr&quot;&gt;&lt;a class=&quot;comment-link&quot; href=&quot;#comment125471149_30279321&quot;&gt;&lt;span title=&quot;2022-02-03 17:55:15Z, License: CC BY-SA 4.0&quot; class=&quot;relativetime-clean&quot;&gt;Feb 3 at 17:55&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;\n            &lt;/div&gt;\n        ","\n            &lt;div class=&quot;comment-body js-comment-edit-hide&quot;&gt;\n                \n                &lt;span class=&quot;comment-copy&quot;&gt;Ok, I just tried this and it worked. I doubted the function because it seemed almost too easy. How long do you recommend I make the length of my varchar? 225?&lt;/span&gt;\n                \n              &lt;div class=&quot;d-inline-flex ai-center&quot;&gt;\n&amp;nbsp;&lt;a href=&quot;/users/4772456/josh-potter&quot; title=&quot;1,479 reputation&quot; class=&quot;comment-user owner&quot;&gt;Josh Potter&lt;/a&gt;\n                &lt;/div&gt;\n                &lt;span class=&quot;comment-date&quot; dir=&quot;ltr&quot;&gt;&lt;a class=&quot;comment-link&quot; href=&quot;#comment48657611_30279440&quot;&gt;&lt;span title=&quot;2015-05-16 19:11:05Z, License: CC BY-SA 3.0&quot; class=&quot;relativetime-clean&quot;&gt;May 16, 2015 at 19:11&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;\n                        &lt;span title=&quot;this comment was edited 1 time&quot;&gt;\n                            &lt;svg aria-hidden=&quot;true&quot; class=&quot;va-text-bottom o50 svg-icon iconPencilSm&quot; width=&quot;14&quot; height=&quot;14&quot; viewBox=&quot;0 0 14 14&quot;&gt;&lt;path d=&quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;\n                        &lt;/span&gt;\n            &lt;/div&gt;\n        ","\n            &lt;div class=&quot;comment-body js-comment-edit-hide&quot;&gt;\n                \n                &lt;span class=&quot;comment-copy&quot;&gt;This is already in the manuals &lt;a href=&quot;http://php.net/manual/en/function.password-hash.php&quot; rel=&quot;nofollow noreferrer&quot;&gt;php.net/manual/en/function.password-hash.php&lt;/a&gt; --- &lt;a href=&quot;http://php.net/manual/en/function.password-verify.php&quot; rel=&quot;nofollow noreferrer&quot;&gt;php.net/manual/en/function.password-verify.php&lt;/a&gt; that the OP probably didn&apos;t read or understood. This question&apos;s been asked more often than none.&lt;/span&gt;\n                \n              &lt;div class=&quot;d-inline-flex ai-center&quot;&gt;\n&amp;nbsp;&lt;a href=&quot;/users/1415724/funk-forty-niner&quot; title=&quot;74,253 reputation&quot; class=&quot;comment-user&quot;&gt;Funk Forty Niner&lt;/a&gt;\n                &lt;/div&gt;\n                &lt;span class=&quot;comment-date&quot; dir=&quot;ltr&quot;&gt;&lt;a class=&quot;comment-link&quot; href=&quot;#comment48657712_30279440&quot;&gt;&lt;span title=&quot;2015-05-16 19:16:49Z, License: CC BY-SA 3.0&quot; class=&quot;relativetime-clean&quot;&gt;May 16, 2015 at 19:16&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;\n            &lt;/div&gt;\n        ","\n            &lt;div class=&quot;comment-body js-comment-edit-hide&quot;&gt;\n                \n                &lt;span class=&quot;comment-copy&quot;&gt;@FunkFortyNiner, b/c Josh asked the question, I found it, 2 years later, and it helped me. That&apos;s the point of SO. That manual is about as clear as mud.&lt;/span&gt;\n                \n              &lt;div class=&quot;d-inline-flex ai-center&quot;&gt;\n&amp;nbsp;&lt;a href=&quot;/users/1045881/toddmo&quot; title=&quot;18,680 reputation&quot; class=&quot;comment-user&quot;&gt;toddmo&lt;/a&gt;\n                &lt;/div&gt;\n                &lt;span class=&quot;comment-date&quot; dir=&quot;ltr&quot;&gt;&lt;a class=&quot;comment-link&quot; href=&quot;#comment86960439_30279440&quot;&gt;&lt;span title=&quot;2018-04-23 01:22:31Z, License: CC BY-SA 3.0&quot; class=&quot;relativetime-clean&quot;&gt;Apr 23, 2018 at 1:22&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;\n            &lt;/div&gt;\n        ","\n            &lt;div class=&quot;comment-body js-comment-edit-hide&quot;&gt;\n                \n                &lt;span class=&quot;comment-copy&quot;&gt;As for the length, from the PHP manual on password_hash, there&apos;s a  comment in an example -- &quot;Beware that DEFAULT may change over time, so you would want to prepare by allowing your storage to expand past 60 characters (255 would be good)&quot;&lt;/span&gt;\n                \n              &lt;div class=&quot;d-inline-flex ai-center&quot;&gt;\n&amp;nbsp;&lt;a href=&quot;/users/1231948/sheamus&quot; title=&quot;6,375 reputation&quot; class=&quot;comment-user&quot;&gt;Sheamus&lt;/a&gt;\n                &lt;/div&gt;\n                &lt;span class=&quot;comment-date&quot; dir=&quot;ltr&quot;&gt;&lt;a class=&quot;comment-link&quot; href=&quot;#comment110054017_30279440&quot;&gt;&lt;span title=&quot;2020-06-06 03:37:58Z, License: CC BY-SA 4.0&quot; class=&quot;relativetime-clean&quot;&gt;Jun 6, 2020 at 3:37&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;\n            &lt;/div&gt;\n        ","\n            &lt;div class=&quot;comment-body js-comment-edit-hide&quot;&gt;\n                \n                &lt;span class=&quot;comment-copy&quot;&gt;@toddmo : To second your comment, I&apos;ve just come to this question in June 2020 and the discussion has saved me hours of frustration. I, too, find the PHP manual about as clear as mud most of the time.&lt;/span&gt;\n                \n              &lt;div class=&quot;d-inline-flex ai-center&quot;&gt;\n&amp;nbsp;&lt;a href=&quot;/users/4566846/thomas-murphy&quot; title=&quot;105 reputation&quot; class=&quot;comment-user&quot;&gt;Thomas Murphy&lt;/a&gt;\n                &lt;/div&gt;\n                &lt;span class=&quot;comment-date&quot; dir=&quot;ltr&quot;&gt;&lt;a class=&quot;comment-link&quot; href=&quot;#comment110189532_30279440&quot;&gt;&lt;span title=&quot;2020-06-10 12:25:42Z, License: CC BY-SA 4.0&quot; class=&quot;relativetime-clean&quot;&gt;Jun 10, 2020 at 12:25&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;\n            &lt;/div&gt;\n        ","\n            &lt;div class=&quot;comment-body js-comment-edit-hide&quot;&gt;\n                \n                &lt;span class=&quot;comment-copy&quot;&gt;BCrypt is a &lt;i&gt;hashing&lt;/i&gt; function, while Blowfish is an algorithm for &lt;i&gt;encryption&lt;/i&gt;. BCrypt originates from the Blowfish algorithm though.&lt;/span&gt;\n                \n              &lt;div class=&quot;d-inline-flex ai-center&quot;&gt;\n&amp;nbsp;&lt;a href=&quot;/users/575765/martinstoeckli&quot; title=&quot;22,371 reputation&quot; class=&quot;comment-user&quot;&gt;martinstoeckli&lt;/a&gt;\n                &lt;/div&gt;\n                &lt;span class=&quot;comment-date&quot; dir=&quot;ltr&quot;&gt;&lt;a class=&quot;comment-link&quot; href=&quot;#comment48657096_30279381&quot;&gt;&lt;span title=&quot;2015-05-16 18:43:13Z, License: CC BY-SA 3.0&quot; class=&quot;relativetime-clean&quot;&gt;May 16, 2015 at 18:43&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;\n            &lt;/div&gt;\n        ","\n            &lt;div class=&quot;comment-body js-comment-edit-hide&quot;&gt;\n                \n                &lt;span class=&quot;comment-copy&quot;&gt;Yup. When I was changing our password security to use &lt;code&gt;password_hash&lt;/code&gt;, I deliberately used a low &lt;code&gt;cost&lt;/code&gt; value, so I could later increase it and check that &lt;code&gt;password_needs_rehash()&lt;/code&gt; worked as intended. (The version with the low &lt;code&gt;cost&lt;/code&gt; never went to production.)&lt;/span&gt;\n                \n              &lt;div class=&quot;d-inline-flex ai-center&quot;&gt;\n&amp;nbsp;&lt;a href=&quot;/users/209139/trig&quot; title=&quot;9,706 reputation&quot; class=&quot;comment-user&quot;&gt;TRiG&lt;/a&gt;\n                &lt;/div&gt;\n                &lt;span class=&quot;comment-date&quot; dir=&quot;ltr&quot;&gt;&lt;a class=&quot;comment-link&quot; href=&quot;#comment122104922_51051609&quot;&gt;&lt;span title=&quot;2021-09-07 12:01:34Z, License: CC BY-SA 4.0&quot; class=&quot;relativetime-clean&quot;&gt;Sep 7, 2021 at 12:01&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;\n            &lt;/div&gt;\n        ","\n            &lt;div class=&quot;comment-body js-comment-edit-hide&quot;&gt;\n                \n                &lt;span class=&quot;comment-copy&quot;&gt;It is best to omit the &lt;code&gt;salt&lt;/code&gt; parameter, it will be automatically generated by the &lt;a href=&quot;http://www.php.net/manual/en/function.password-hash.php&quot; rel=&quot;nofollow noreferrer&quot;&gt;password_hash()&lt;/a&gt; function, following best practices. Instead of &lt;code&gt;PASSWORD_BCRYPT&lt;/code&gt; one can use &lt;code&gt;PASSWORD_DEFAULT&lt;/code&gt;to write future proof code.&lt;/span&gt;\n                \n              &lt;div class=&quot;d-inline-flex ai-center&quot;&gt;\n&amp;nbsp;&lt;a href=&quot;/users/575765/martinstoeckli&quot; title=&quot;22,371 reputation&quot; class=&quot;comment-user&quot;&gt;martinstoeckli&lt;/a&gt;\n                &lt;/div&gt;\n                &lt;span class=&quot;comment-date&quot; dir=&quot;ltr&quot;&gt;&lt;a class=&quot;comment-link&quot; href=&quot;#comment78633973_45815632&quot;&gt;&lt;span title=&quot;2017-08-23 11:29:03Z, License: CC BY-SA 3.0&quot; class=&quot;relativetime-clean&quot;&gt;Aug 23, 2017 at 11:29&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;\n            &lt;/div&gt;\n        ","\n            &lt;div class=&quot;comment-body js-comment-edit-hide&quot;&gt;\n                \n                &lt;span class=&quot;comment-copy&quot;&gt;According to &lt;a href=&quot;https://secure.php.net/manual/en/function.password-hash.php&quot; rel=&quot;nofollow noreferrer&quot;&gt;secure.php.net/manual/en/function.password-hash.php&lt;/a&gt; &quot;The salt option has been deprecated as of PHP 7.0.0. It is now preferred to simply use the salt that is generated by default.&quot;&lt;/span&gt;\n                \n              &lt;div class=&quot;d-inline-flex ai-center&quot;&gt;\n&amp;nbsp;&lt;a href=&quot;/users/1496890/jmng&quot; title=&quot;2,240 reputation&quot; class=&quot;comment-user&quot;&gt;jmng&lt;/a&gt;\n                &lt;/div&gt;\n                &lt;span class=&quot;comment-date&quot; dir=&quot;ltr&quot;&gt;&lt;a class=&quot;comment-link&quot; href=&quot;#comment84963196_45815632&quot;&gt;&lt;span title=&quot;2018-02-25 22:18:51Z, License: CC BY-SA 3.0&quot; class=&quot;relativetime-clean&quot;&gt;Feb 25, 2018 at 22:18&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;\n            &lt;/div&gt;\n        "],"id":381,"title":"How to use PHP's password_hash to hash and verify passwords","content":"\n                \n&lt;p&gt;Recently I have been trying to implement my own security on a log in script I stumbled upon on the internet. After struggling of trying to learn how to make my own script to generate a salt for each user, I stumbled upon &lt;code&gt;password_hash&lt;/code&gt;. &lt;/p&gt;\n\n&lt;p&gt;From what I understand (based off of the reading on &lt;a href=&quot;http://php.net/manual/en/faq.passwords.php&quot; rel=&quot;noreferrer&quot;&gt;this page&lt;/a&gt;), salt is already generated in the row when you use &lt;code&gt;password_hash&lt;/code&gt;. Is this true? &lt;/p&gt;\n\n&lt;p&gt;Another question I had was, wouldn&apos;t it be smart to have 2 salts? One directly in the file and one in the DB? That way, if someone compromises your salt in the DB, you still have the one directly in the file? I read on here that storing salts is never a smart idea, but it always confused me what people meant by that. &lt;/p&gt;\n    ","slug":"how-to-use-php's-password_hash-to-hash-and-verify-passwords-1657387808784","postType":"QUESTION","createdAt":"2022-07-09T17:30:08.000Z","updatedAt":"2022-07-09T17:30:08.000Z","tags":[{"id":2079,"name":"salt","slug":"salt","createdAt":"2022-07-09T17:30:08.000Z","updatedAt":"2022-07-09T17:30:08.000Z","Questions_Tags":{"questionId":381,"tagId":2079}},{"id":2080,"name":"password-hash","slug":"password-hash","createdAt":"2022-07-09T17:30:08.000Z","updatedAt":"2022-07-09T17:30:08.000Z","Questions_Tags":{"questionId":381,"tagId":2080}},{"id":2081,"name":"php-password-hash","slug":"php-password-hash","createdAt":"2022-07-09T17:30:08.000Z","updatedAt":"2022-07-09T17:30:08.000Z","Questions_Tags":{"questionId":381,"tagId":2081}}]}},"__N_SSG":true}