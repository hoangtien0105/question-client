{"pageProps":{"data":{"answer":["\n&lt;p&gt;There are several ways that you can transform data from multiple rows into columns.&lt;/p&gt;\n\n&lt;h2&gt;Using &lt;code&gt;PIVOT&lt;/code&gt;&lt;/h2&gt;\n\n&lt;p&gt;In SQL Server you can use the &lt;code&gt;PIVOT&lt;/code&gt; function to transform the data from rows to columns:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; Firstname, Amount, PostalCode, LastName, AccountNumber\n&lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt;\n(\n  &lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;value&lt;/span&gt;, columnname\n  &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; yourtable\n) d\npivot\n(\n  &lt;span class=&quot;hljs-built_in&quot;&gt;max&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;value&lt;/span&gt;)\n  &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; columnname &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; (Firstname, Amount, PostalCode, LastName, AccountNumber)\n) piv;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;See &lt;a href=&quot;https://data.stackexchange.com/stackoverflow/query/497432&quot; rel=&quot;noreferrer&quot;&gt;Demo&lt;/a&gt;.&lt;/p&gt;\n\n&lt;h3&gt;Pivot with unknown number of &lt;code&gt;columnnames&lt;/code&gt;&lt;/h3&gt;\n\n&lt;p&gt;If you have an unknown number of &lt;code&gt;columnnames&lt;/code&gt; that you want to transpose, then you can use dynamic SQL:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@cols&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; NVARCHAR(MAX),\n    &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;  &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; NVARCHAR(MAX)\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@cols&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; STUFF((&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; QUOTENAME(ColumnName) \n                    &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; yourtable\n                    &lt;span class=&quot;hljs-keyword&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;by&lt;/span&gt; ColumnName, id\n                    &lt;span class=&quot;hljs-keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;by&lt;/span&gt; id\n            &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt; XML PATH(&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;), TYPE\n            ).&lt;span class=&quot;hljs-keyword&quot;&gt;value&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;.&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;NVARCHAR(MAX)&apos;&lt;/span&gt;) \n        ,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;)\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; N&lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@cols&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; N&lt;span class=&quot;hljs-string&quot;&gt;&apos; from \n             (\n                select value, ColumnName\n                from yourtable\n            ) x\n            pivot \n            (\n                max(value)\n                for ColumnName in (&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@cols&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; N&lt;span class=&quot;hljs-string&quot;&gt;&apos;)\n            ) p &apos;&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;exec&lt;/span&gt; sp_executesql &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;See &lt;a href=&quot;https://data.stackexchange.com/stackoverflow/query/497433&quot; rel=&quot;noreferrer&quot;&gt;Demo&lt;/a&gt;.&lt;/p&gt;\n\n&lt;h2&gt;Using an aggregate function&lt;/h2&gt;\n\n&lt;p&gt;If you do not want to use the &lt;code&gt;PIVOT&lt;/code&gt; function, then you can use an aggregate function with a &lt;code&gt;CASE&lt;/code&gt; expression:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt;\n  &lt;span class=&quot;hljs-built_in&quot;&gt;max&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;when&lt;/span&gt; columnname &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;FirstName&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;) Firstname,\n  &lt;span class=&quot;hljs-built_in&quot;&gt;max&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;when&lt;/span&gt; columnname &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;Amount&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;) Amount,\n  &lt;span class=&quot;hljs-built_in&quot;&gt;max&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;when&lt;/span&gt; columnname &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;PostalCode&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;) PostalCode,\n  &lt;span class=&quot;hljs-built_in&quot;&gt;max&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;when&lt;/span&gt; columnname &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;LastName&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;) LastName,\n  &lt;span class=&quot;hljs-built_in&quot;&gt;max&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;when&lt;/span&gt; columnname &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;AccountNumber&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;) AccountNumber\n&lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; yourtable\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;See &lt;a href=&quot;https://data.stackexchange.com/stackoverflow/query/497434&quot; rel=&quot;noreferrer&quot;&gt;Demo&lt;/a&gt;.&lt;/p&gt;\n\n&lt;h2&gt;Using multiple joins&lt;/h2&gt;\n\n&lt;p&gt;This could also be completed using multiple joins, but you will need some column to associate each of the rows which you do not have in your sample data. But the basic syntax would be:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; fn.value &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; FirstName,\n  a.value &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; Amount,\n  pc.value &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; PostalCode,\n  ln.value &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; LastName,\n  an.value &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; AccountNumber\n&lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; yourtable fn\n&lt;span class=&quot;hljs-keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt; yourtable a\n  &lt;span class=&quot;hljs-keyword&quot;&gt;on&lt;/span&gt; fn.somecol &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; a.somecol\n  &lt;span class=&quot;hljs-keyword&quot;&gt;and&lt;/span&gt; a.columnname &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;Amount&apos;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt; yourtable pc\n  &lt;span class=&quot;hljs-keyword&quot;&gt;on&lt;/span&gt; fn.somecol &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; pc.somecol\n  &lt;span class=&quot;hljs-keyword&quot;&gt;and&lt;/span&gt; pc.columnname &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;PostalCode&apos;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt; yourtable ln\n  &lt;span class=&quot;hljs-keyword&quot;&gt;on&lt;/span&gt; fn.somecol &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; ln.somecol\n  &lt;span class=&quot;hljs-keyword&quot;&gt;and&lt;/span&gt; ln.columnname &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;LastName&apos;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;join&lt;/span&gt; yourtable an\n  &lt;span class=&quot;hljs-keyword&quot;&gt;on&lt;/span&gt; fn.somecol &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; an.somecol\n  &lt;span class=&quot;hljs-keyword&quot;&gt;and&lt;/span&gt; an.columnname &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;AccountNumber&apos;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;where&lt;/span&gt; fn.columnname &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;Firstname&apos;&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;This is rather a method than just a single script but gives you much more flexibility.&lt;/p&gt;\n\n&lt;p&gt;First of all There are 3 objects:&lt;/p&gt;\n\n&lt;ol&gt;\n&lt;li&gt;User defined TABLE type [&lt;code&gt;ColumnActionList&lt;/code&gt;] -&amp;gt; holds data as\nparameter &lt;/li&gt;\n&lt;li&gt;SP [&lt;code&gt;proc_PivotPrepare&lt;/code&gt;] -&amp;gt; prepares our data&lt;/li&gt;\n&lt;li&gt;SP [&lt;code&gt;proc_PivotExecute&lt;/code&gt;] -&amp;gt; execute the script&lt;/li&gt;\n&lt;/ol&gt;\n\n&lt;p&gt;CREATE TYPE [dbo].[ColumnActionList] AS TABLE\n(\n[ID] [smallint] NOT NULL,\n[ColumnName] nvarchar NOT NULL,\n[Action] nchar NOT NULL\n);\nGO&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;    &lt;span class=&quot;hljs-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;PROCEDURE&lt;/span&gt; [dbo].[proc_PivotPrepare] \n    (\n    &lt;span class=&quot;hljs-variable&quot;&gt;@DB&lt;/span&gt;_Name        nvarchar(&lt;span class=&quot;hljs-number&quot;&gt;128&lt;/span&gt;),\n    &lt;span class=&quot;hljs-variable&quot;&gt;@TableName&lt;/span&gt;      nvarchar(&lt;span class=&quot;hljs-number&quot;&gt;128&lt;/span&gt;)\n    )\n    &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DB&lt;/span&gt;_Name &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; ISNULL(&lt;span class=&quot;hljs-variable&quot;&gt;@DB&lt;/span&gt;_Name,db_name())\n    &lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_Code nvarchar(max)\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@MyTab&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; (ID &lt;span class=&quot;hljs-type&quot;&gt;smallint&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;identity&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;), [Column_Name] nvarchar(&lt;span class=&quot;hljs-number&quot;&gt;128&lt;/span&gt;), [Type] &lt;span class=&quot;hljs-type&quot;&gt;nchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;), [&lt;span class=&quot;hljs-keyword&quot;&gt;Set&lt;/span&gt; Action &lt;span class=&quot;hljs-keyword&quot;&gt;SQL&lt;/span&gt;] nvarchar(max));\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_Code        &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;   &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT [&amp;lt;| SQL_Code |&amp;gt;] = &apos;&apos; &apos;&apos; &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;----------------------------------------------------------------------------------------------------&apos;&apos; &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;-----| Declare user defined type [ID] / [ColumnName] / [PivotAction] &apos;&apos; &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;----------------------------------------------------------------------------------------------------&apos;&apos; &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;DECLARE @ColumnListWithActions ColumnActionList;&apos;&apos;&apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;----------------------------------------------------------------------------------------------------&apos;&apos; &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;-----| Set [PivotAction] (&apos;&apos;&apos;&apos;S&apos;&apos;&apos;&apos; as default) to select dimentions and values &apos;&apos; &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;-----|&apos;&apos;&apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;-----| &apos;&apos;&apos;&apos;S&apos;&apos;&apos;&apos; = Stable column || &apos;&apos;&apos;&apos;D&apos;&apos;&apos;&apos; = Dimention column || &apos;&apos;&apos;&apos;V&apos;&apos;&apos;&apos; = Value column &apos;&apos; &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;----------------------------------------------------------------------------------------------------&apos;&apos; &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;INSERT INTO  @ColumnListWithActions VALUES (&apos;&apos; + CAST( ROW_NUMBER() OVER (ORDER BY [NAME]) as nvarchar(10)) + &apos;&apos;, &apos;&apos; + &apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos; + [NAME] + &apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;+ &apos;&apos;, &apos;&apos;&apos;&apos;S&apos;&apos;&apos;&apos;);&apos;&apos;&apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;FROM [&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DB&lt;/span&gt;_Name &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;].sys.columns  &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;WHERE object_id = object_id(&apos;&apos;[&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DB&lt;/span&gt;_Name &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;]..[&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@TableName&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;]&apos;&apos;) &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;----------------------------------------------------------------------------------------------------&apos;&apos; &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;-----| Execute sp_PivotExecute with parameters: columns and dimentions and main table name&apos;&apos; &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;----------------------------------------------------------------------------------------------------&apos;&apos; &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;EXEC [dbo].[sp_PivotExecute] @ColumnListWithActions, &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&apos;&apos;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@TableName&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&apos;&apos;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;;&apos;&apos;&apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;UNION ALL &apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT &apos;&apos;----------------------------------------------------------------------------------------------------&apos;&apos; &apos;&lt;/span&gt;                            \n&lt;span class=&quot;hljs-keyword&quot;&gt;EXECUTE&lt;/span&gt; SP_EXECUTESQL &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_Code;\n\nGO\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;PROCEDURE&lt;/span&gt; [dbo].[sp_PivotExecute]\n(\n&lt;span class=&quot;hljs-variable&quot;&gt;@ColumnListWithActions&lt;/span&gt;  ColumnActionList ReadOnly\n,&lt;span class=&quot;hljs-variable&quot;&gt;@TableName&lt;/span&gt;                     nvarchar(&lt;span class=&quot;hljs-number&quot;&gt;128&lt;/span&gt;)\n)\n&lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt;\n\n\n&lt;span class=&quot;hljs-comment&quot;&gt;--#######################################################################################################################&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--###| Step 1 - Select our user-defined-table-variable into temp table&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--#######################################################################################################################&lt;/span&gt;\n\nIF OBJECT_ID(&lt;span class=&quot;hljs-string&quot;&gt;&apos;tempdb.dbo.#ColumnListWithActions&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;U&apos;&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; #ColumnListWithActions; \n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; #ColumnListWithActions &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnListWithActions&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;--#######################################################################################################################&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--###| Step 2 - Preparing lists of column groups as strings:&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--#######################################################################################################################&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt;                     nvarchar(&lt;span class=&quot;hljs-number&quot;&gt;128&lt;/span&gt;)\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@Destiny&lt;/span&gt;                        &lt;span class=&quot;hljs-type&quot;&gt;nchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;)\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Stable           nvarchar(max)\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Dimension    nvarchar(max)\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Variable     nvarchar(max)\n&lt;span class=&quot;hljs-comment&quot;&gt;--############################&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--###| Cursor for List of Stable Columns&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--############################&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; ColumnListStringCreator_S &lt;span class=&quot;hljs-keyword&quot;&gt;CURSOR&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt;      [ColumnName]\n&lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt;        #ColumnListWithActions\n&lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt;       [Action] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;S&apos;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;OPEN&lt;/span&gt; ColumnListStringCreator_S;\n&lt;span class=&quot;hljs-keyword&quot;&gt;FETCH&lt;/span&gt; NEXT &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; ColumnListStringCreator_S\n&lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt;\n  WHILE @&lt;span class=&quot;hljs-variable&quot;&gt;@FETCH&lt;/span&gt;_STATUS &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n\n   &lt;span class=&quot;hljs-keyword&quot;&gt;BEGIN&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Stable &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; ISNULL(&lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Stable, &lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; [&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;] ,&apos;&lt;/span&gt;;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;FETCH&lt;/span&gt; NEXT &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; ColumnListStringCreator_S &lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt;\n   &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;CLOSE&lt;/span&gt; ColumnListStringCreator_S;\n&lt;span class=&quot;hljs-keyword&quot;&gt;DEALLOCATE&lt;/span&gt; ColumnListStringCreator_S;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;--############################&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--###| Cursor for List of Dimension Columns&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--############################&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; ColumnListStringCreator_D &lt;span class=&quot;hljs-keyword&quot;&gt;CURSOR&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt;      [ColumnName]\n&lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt;        #ColumnListWithActions\n&lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt;       [Action] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;D&apos;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;OPEN&lt;/span&gt; ColumnListStringCreator_D;\n&lt;span class=&quot;hljs-keyword&quot;&gt;FETCH&lt;/span&gt; NEXT &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; ColumnListStringCreator_D\n&lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt;\n  WHILE @&lt;span class=&quot;hljs-variable&quot;&gt;@FETCH&lt;/span&gt;_STATUS &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n\n   &lt;span class=&quot;hljs-keyword&quot;&gt;BEGIN&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Dimension &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; ISNULL(&lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Dimension, &lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; [&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;] ,&apos;&lt;/span&gt;;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;FETCH&lt;/span&gt; NEXT &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; ColumnListStringCreator_D &lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt;\n   &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;CLOSE&lt;/span&gt; ColumnListStringCreator_D;\n&lt;span class=&quot;hljs-keyword&quot;&gt;DEALLOCATE&lt;/span&gt; ColumnListStringCreator_D;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;--############################&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--###| Cursor for List of Variable Columns&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--############################&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; ColumnListStringCreator_V &lt;span class=&quot;hljs-keyword&quot;&gt;CURSOR&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt;      [ColumnName]\n&lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt;        #ColumnListWithActions\n&lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt;       [Action] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;V&apos;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;OPEN&lt;/span&gt; ColumnListStringCreator_V;\n&lt;span class=&quot;hljs-keyword&quot;&gt;FETCH&lt;/span&gt; NEXT &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; ColumnListStringCreator_V\n&lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt;\n  WHILE @&lt;span class=&quot;hljs-variable&quot;&gt;@FETCH&lt;/span&gt;_STATUS &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n\n   &lt;span class=&quot;hljs-keyword&quot;&gt;BEGIN&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Variable &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; ISNULL(&lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Variable, &lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; [&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;] ,&apos;&lt;/span&gt;;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;FETCH&lt;/span&gt; NEXT &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; ColumnListStringCreator_V &lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt;\n   &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;CLOSE&lt;/span&gt; ColumnListStringCreator_V;\n&lt;span class=&quot;hljs-keyword&quot;&gt;DEALLOCATE&lt;/span&gt; ColumnListStringCreator_V;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Variable      &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;LEFT&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Variable, LEN(&lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Variable) &lt;span class=&quot;hljs-operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;);\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Dimension &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;LEFT&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Dimension, LEN(&lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Dimension) &lt;span class=&quot;hljs-operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;);\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Stable            &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;LEFT&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Stable, LEN(&lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Stable) &lt;span class=&quot;hljs-operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;);\n\n&lt;span class=&quot;hljs-comment&quot;&gt;--#######################################################################################################################&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--###| Step 3 - Preparing table with all possible connections between Dimension columns excluding NULLs&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--#######################################################################################################################&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; ([DIM_ID] &lt;span class=&quot;hljs-type&quot;&gt;smallint&lt;/span&gt;, [ColumnName] nvarchar(&lt;span class=&quot;hljs-number&quot;&gt;128&lt;/span&gt;))\n&lt;span class=&quot;hljs-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_TAB \n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [DIM_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;ROW_NUMBER&lt;/span&gt;() &lt;span class=&quot;hljs-keyword&quot;&gt;OVER&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;BY&lt;/span&gt; [ColumnName]), [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; #ColumnListWithActions &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [Action] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;D&apos;&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_ID &lt;span class=&quot;hljs-type&quot;&gt;smallint&lt;/span&gt;;\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt;      &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_ID &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;\n\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_Dimentions nvarchar(max);\n\nIF OBJECT_ID(&lt;span class=&quot;hljs-string&quot;&gt;&apos;tempdb.dbo.##ALL_Dimentions&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;U&apos;&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; ##ALL_Dimentions; \n\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_Dimentions      &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT [xxx_ID_xxx] = ROW_NUMBER() OVER (ORDER BY &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Dimension &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;), &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Dimension\n                                            &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; INTO ##ALL_Dimentions &apos;&lt;/span&gt;\n                                            &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; FROM (SELECT DISTINCT&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Dimension &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; FROM  &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@TableName&lt;/span&gt;\n                                            &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; WHERE &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [DIM_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_ID) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; IS NOT NULL &apos;&lt;/span&gt;;\n                                            &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_ID &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_ID &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;\n            WHILE &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_ID &lt;span class=&quot;hljs-operator&quot;&gt;&amp;lt;=&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;MAX&lt;/span&gt;([DIM_ID]) &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_TAB)\n            &lt;span class=&quot;hljs-keyword&quot;&gt;BEGIN&lt;/span&gt;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_Dimentions &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_Dimentions &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;AND &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [DIM_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_ID) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;  &lt;span class=&quot;hljs-string&quot;&gt;&apos; IS NOT NULL &apos;&lt;/span&gt;;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_ID &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_ID &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_Dimentions   &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_Dimentions &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; )x&apos;&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;EXECUTE&lt;/span&gt; SP_EXECUTESQL  &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_Dimentions;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;--#######################################################################################################################&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--###| Step 4 - Preparing table with all possible connections between Stable columns excluding NULLs&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--#######################################################################################################################&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; ([StabPos_ID] &lt;span class=&quot;hljs-type&quot;&gt;smallint&lt;/span&gt;, [ColumnName] nvarchar(&lt;span class=&quot;hljs-number&quot;&gt;128&lt;/span&gt;))\n&lt;span class=&quot;hljs-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_TAB \n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [StabPos_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;ROW_NUMBER&lt;/span&gt;() &lt;span class=&quot;hljs-keyword&quot;&gt;OVER&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;BY&lt;/span&gt; [ColumnName]), [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; #ColumnListWithActions &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [Action] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;S&apos;&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_ID &lt;span class=&quot;hljs-type&quot;&gt;smallint&lt;/span&gt;;\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt;      &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_ID &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;\n\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_MainStableColumnTable nvarchar(max);\n\nIF OBJECT_ID(&lt;span class=&quot;hljs-string&quot;&gt;&apos;tempdb.dbo.##ALL_StableColumns&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;U&apos;&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; ##ALL_StableColumns; \n\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_MainStableColumnTable       &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT xxx_ID_xxx = ROW_NUMBER() OVER (ORDER BY &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Stable &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;), &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Stable\n                                            &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; INTO ##ALL_StableColumns &apos;&lt;/span&gt;\n                                            &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; FROM (SELECT DISTINCT&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Stable &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; FROM  &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@TableName&lt;/span&gt;\n                                            &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; WHERE &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [StabPos_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_ID) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; IS NOT NULL &apos;&lt;/span&gt;;\n                                            &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_ID &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_ID &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;\n            WHILE &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_ID &lt;span class=&quot;hljs-operator&quot;&gt;&amp;lt;=&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;MAX&lt;/span&gt;([StabPos_ID]) &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_TAB)\n            &lt;span class=&quot;hljs-keyword&quot;&gt;BEGIN&lt;/span&gt;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_MainStableColumnTable &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_MainStableColumnTable &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;AND &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [StabPos_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_ID) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;  &lt;span class=&quot;hljs-string&quot;&gt;&apos; IS NOT NULL &apos;&lt;/span&gt;;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_ID &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@StabPos&lt;/span&gt;_ID &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;\n            &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_MainStableColumnTable    &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_MainStableColumnTable &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; )x&apos;&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;EXECUTE&lt;/span&gt; SP_EXECUTESQL  &lt;span class=&quot;hljs-variable&quot;&gt;@SQL&lt;/span&gt;_MainStableColumnTable;\n\n&lt;span class=&quot;hljs-comment&quot;&gt;--#######################################################################################################################&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--###| Step 5 - Preparing table with all options ID&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--#######################################################################################################################&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FULL&lt;/span&gt;_SQL_1 NVARCHAR(MAX)\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FULL&lt;/span&gt;_SQL_1 &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@i&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;smallint&lt;/span&gt;\n\nIF OBJECT_ID(&lt;span class=&quot;hljs-string&quot;&gt;&apos;tempdb.dbo.##FinalTab&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;U&apos;&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; ##FinalTab; \n\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FULL&lt;/span&gt;_SQL_1 &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT t.*, dim.[xxx_ID_xxx] &apos;&lt;/span&gt;\n                                    &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; INTO ##FinalTab &apos;&lt;/span&gt;\n                                    &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;   &lt;span class=&quot;hljs-string&quot;&gt;&apos;FROM &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@TableName&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; t &apos;&lt;/span&gt;\n                                    &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;   &lt;span class=&quot;hljs-string&quot;&gt;&apos;JOIN ##ALL_Dimentions dim &apos;&lt;/span&gt;\n                                    &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;   &lt;span class=&quot;hljs-string&quot;&gt;&apos;ON t.&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [DIM_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; = dim.&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [DIM_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;);\n                                &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@i&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;                               \n                                WHILE &lt;span class=&quot;hljs-variable&quot;&gt;@i&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;&amp;lt;=&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;MAX&lt;/span&gt;([DIM_ID]) &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_TAB)\n                                    &lt;span class=&quot;hljs-keyword&quot;&gt;BEGIN&lt;/span&gt;\n                                    &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FULL&lt;/span&gt;_SQL_1 &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FULL&lt;/span&gt;_SQL_1 &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; AND t.&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [DIM_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@i&lt;/span&gt;) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; = dim.&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DIM&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [DIM_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@i&lt;/span&gt;)\n                                    &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@i&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@i&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n                                &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;EXECUTE&lt;/span&gt; SP_EXECUTESQL &lt;span class=&quot;hljs-variable&quot;&gt;@FULL&lt;/span&gt;_SQL_1\n\n&lt;span class=&quot;hljs-comment&quot;&gt;--#######################################################################################################################&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--###| Step 6 - Selecting final data&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--#######################################################################################################################&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@STAB&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; ([STAB_ID] &lt;span class=&quot;hljs-type&quot;&gt;smallint&lt;/span&gt;, [ColumnName] nvarchar(&lt;span class=&quot;hljs-number&quot;&gt;128&lt;/span&gt;))\n&lt;span class=&quot;hljs-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@STAB&lt;/span&gt;_TAB \n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [STAB_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;ROW_NUMBER&lt;/span&gt;() &lt;span class=&quot;hljs-keyword&quot;&gt;OVER&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;BY&lt;/span&gt; [ColumnName]), [ColumnName]\n&lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; #ColumnListWithActions &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [Action] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;S&apos;&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@VAR&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; ([VAR_ID] &lt;span class=&quot;hljs-type&quot;&gt;smallint&lt;/span&gt;, [ColumnName] nvarchar(&lt;span class=&quot;hljs-number&quot;&gt;128&lt;/span&gt;))\n&lt;span class=&quot;hljs-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@VAR&lt;/span&gt;_TAB \n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [VAR_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;ROW_NUMBER&lt;/span&gt;() &lt;span class=&quot;hljs-keyword&quot;&gt;OVER&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;BY&lt;/span&gt; [ColumnName]), [ColumnName]\n&lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; #ColumnListWithActions &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [Action] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;V&apos;&lt;/span&gt;;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;smallint&lt;/span&gt;;\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@x&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;smallint&lt;/span&gt;;\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@z&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;smallint&lt;/span&gt;;\n\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FinalCode&lt;/span&gt; nvarchar(max)\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FinalCode&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; SELECT ID1.*&apos;&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n                                        WHILE &lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;&amp;lt;=&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;MAX&lt;/span&gt;([xxx_ID_xxx]) &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; ##FinalTab)\n                                            &lt;span class=&quot;hljs-keyword&quot;&gt;BEGIN&lt;/span&gt;\n                                                &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@z&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n                                                WHILE &lt;span class=&quot;hljs-variable&quot;&gt;@z&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;&amp;lt;=&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;MAX&lt;/span&gt;([VAR_ID]) &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@VAR&lt;/span&gt;_TAB)\n                                                    &lt;span class=&quot;hljs-keyword&quot;&gt;BEGIN&lt;/span&gt;\n                                                        &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FinalCode&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FinalCode&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;    &lt;span class=&quot;hljs-string&quot;&gt;&apos;, [ID&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;CAST&lt;/span&gt;((&lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;)) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;.&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@VAR&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [VAR_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@z&lt;/span&gt;) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;] =  ID&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;CAST&lt;/span&gt;((&lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;)) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;.&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@VAR&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [VAR_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@z&lt;/span&gt;)\n                                                        &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@z&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@z&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n                                                    &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt;\n                                                    &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n                                                &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FinalCode&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FinalCode&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; \n                                        &lt;span class=&quot;hljs-string&quot;&gt;&apos; FROM ( SELECT * FROM ##ALL_StableColumns)ID1&apos;&lt;/span&gt;;\n                                        &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n                                        WHILE &lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;&amp;lt;=&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;MAX&lt;/span&gt;([xxx_ID_xxx]) &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; ##FinalTab)\n                                        &lt;span class=&quot;hljs-keyword&quot;&gt;BEGIN&lt;/span&gt;\n                                            &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@x&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n                                            &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FinalCode&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FinalCode&lt;/span&gt; \n                                                                                &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; LEFT JOIN (SELECT &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;  &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Stable &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; , &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ListOfColumns&lt;/span&gt;_Variable \n                                                                                &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; FROM ##FinalTab WHERE [xxx_ID_xxx] = &apos;&lt;/span&gt; \n                                                                                &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;CAST&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;)) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; )ID&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;CAST&lt;/span&gt;((&lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;))  \n                                                                                &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; ON 1 = 1&apos;&lt;/span&gt; \n                                                                                WHILE &lt;span class=&quot;hljs-variable&quot;&gt;@x&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;&amp;lt;=&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;MAX&lt;/span&gt;([STAB_ID]) &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@STAB&lt;/span&gt;_TAB)\n                                                                                &lt;span class=&quot;hljs-keyword&quot;&gt;BEGIN&lt;/span&gt;\n                                                                                    &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FinalCode&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@FinalCode&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; AND ID1.&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@STAB&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [STAB_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@x&lt;/span&gt;) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; = ID&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;CAST&lt;/span&gt;((&lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;)) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;.&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; [ColumnName] &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@STAB&lt;/span&gt;_TAB &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; [STAB_ID] &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@x&lt;/span&gt;)\n                                                                                    &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@x&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@x&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n                                                                                &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt;\n                                            &lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@y&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;\n                                        &lt;span class=&quot;hljs-keyword&quot;&gt;END&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; ##ALL_Dimentions;\n&lt;span class=&quot;hljs-keyword&quot;&gt;EXECUTE&lt;/span&gt; SP_EXECUTESQL &lt;span class=&quot;hljs-variable&quot;&gt;@FinalCode&lt;/span&gt;;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;From executing the first query (by passing source DB and table name) you will get a pre-created execution query for the second SP, all you have to do is define is the column from your source:\n+ Stable\n+ Value (will be used to concentrate values based on that)\n+ Dim (column you want to use to pivot by)&lt;/p&gt;\n\n&lt;p&gt;Names and datatypes will be defined automatically!&lt;/p&gt;\n\n&lt;p&gt;I cant recommend it for any production environments but does the job for adhoc BI requests. &lt;/p&gt;\n    ","\n&lt;p&gt;Please try&lt;/p&gt;\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; pvt (Present &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt;, [Absent] &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt;);\nGO\n&lt;span class=&quot;hljs-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; pvt &lt;span class=&quot;hljs-keyword&quot;&gt;VALUES&lt;/span&gt; (&lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;40&lt;/span&gt;);\nGO\n&lt;span class=&quot;hljs-comment&quot;&gt;--Unpivot the table.&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; Code, &lt;span class=&quot;hljs-keyword&quot;&gt;Value&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; \n   (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; Present, Absent\n   &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; pvt) p\nUNPIVOT\n   (&lt;span class=&quot;hljs-keyword&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt; Code &lt;span class=&quot;hljs-keyword&quot;&gt;IN&lt;/span&gt; \n      (Present, [Absent])\n)&lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; unpvt;\nGO\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;DROP&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; pvt\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;One more option which can be very useful is suing CROSS APPLY&lt;/p&gt;\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;-- Original data&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;VALUES&lt;/span&gt; (&lt;span class=&quot;hljs-string&quot;&gt;&apos;1&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;),(&lt;span class=&quot;hljs-string&quot;&gt;&apos;2&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;33&lt;/span&gt;)) &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; Stage(id,col1,col2,col3)\n\n&lt;span class=&quot;hljs-comment&quot;&gt;-- row to columns using CROSS APPLY&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; Stage.id,v.idd, v.colc\n&lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;VALUES&lt;/span&gt; (&lt;span class=&quot;hljs-string&quot;&gt;&apos;1&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;),(&lt;span class=&quot;hljs-string&quot;&gt;&apos;2&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;11&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;22&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;33&lt;/span&gt;)) &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; Stage(id,col1,col2,col3)\n&lt;span class=&quot;hljs-keyword&quot;&gt;CROSS&lt;/span&gt; APPLY (&lt;span class=&quot;hljs-keyword&quot;&gt;VALUES&lt;/span&gt; (&lt;span class=&quot;hljs-string&quot;&gt;&apos;col1&apos;&lt;/span&gt;, col1),(&lt;span class=&quot;hljs-string&quot;&gt;&apos;col2&apos;&lt;/span&gt;, col2),(&lt;span class=&quot;hljs-string&quot;&gt;&apos;col3&apos;&lt;/span&gt;, col3)) &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; v(idd,colc)\nGO\n&lt;/code&gt;&lt;/pre&gt;\n    "],"id":418,"title":"Efficiently convert rows to columns in sql server","content":"\n                \n&lt;p&gt;I&apos;m looking for an efficient way to convert rows to columns in SQL server, I heard that PIVOT is not very fast, and I need to deal with lot of records.&lt;/p&gt;\n\n&lt;p&gt;This is my example:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;   &lt;span class=&quot;hljs-comment&quot;&gt;-------------------------------&lt;/span&gt;\n   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; Id &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;Value&lt;/span&gt;  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; ColumnName    &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n   &lt;span class=&quot;hljs-comment&quot;&gt;-------------------------------&lt;/span&gt;\n   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; John   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; FirstName     &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;2.4&lt;/span&gt;    &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; Amount        &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; ZH1E4A &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; PostalCode    &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; Fork   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; LastName      &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;857685&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; AccountNumber &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n   &lt;span class=&quot;hljs-comment&quot;&gt;-------------------------------&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;This is my result:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-comment&quot;&gt;---------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; FirstName  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;Amount&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;   PostalCode   &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;   LastName  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;  AccountNumber &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;---------------------------------------------------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; John       &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;2.4&lt;/span&gt;  &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;   ZH1E4A       &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;   Fork      &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;hljs-number&quot;&gt;857685&lt;/span&gt;        &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;---------------------------------------------------------------------&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;How can I build the result?&lt;/p&gt;\n    ","slug":"efficiently-convert-rows-to-columns-in-sql-server-1657387919213","postType":"QUESTION","createdAt":"2022-07-09T17:31:59.000Z","updatedAt":"2022-07-09T17:31:59.000Z","tags":[],"relatedQuestions":[]},"randomQuestions":[{"title":"What is the \"N+1 selects problem\" in ORM (Object-Relational Mapping)?","slug":"what-is-the-\"n+1-selects-problem\"-in-orm-(object-relational-mapping)-1657388055597"},{"title":"When should I use a return statement in ES6 arrow functions","slug":"when-should-i-use-a-return-statement-in-es6-arrow-functions-1657388472113"},{"title":"Merge/flatten an array of arrays","slug":"mergeflatten-an-array-of-arrays-1657387827427"},{"title":"How do I modify the URL without reloading the page?","slug":"how-do-i-modify-the-url-without-reloading-the-page-1657387509731"},{"title":"Relative imports for the billionth time","slug":"relative-imports-for-the-billionth-time-1657387756383"},{"title":"Prefer composition over inheritance?","slug":"prefer-composition-over-inheritance-1657387399409"},{"title":"How to append text to an existing file in Java?","slug":"how-to-append-text-to-an-existing-file-in-java-1657388492377"},{"title":"How to close/hide the Android soft keyboard programmatically?","slug":"how-to-closehide-the-android-soft-keyboard-programmatically-1657388217420"},{"title":"How do I make a list of data frames?","slug":"how-do-i-make-a-list-of-data-frames-1657385480437"},{"title":"How do I return the response from an asynchronous call?","slug":"how-do-i-return-the-response-from-an-asynchronous-call-1657384208012"},{"title":"What is the strict aliasing rule?","slug":"what-is-the-strict-aliasing-rule-1657384742852"},{"title":"Query based on multiple where clauses in Firebase","slug":"query-based-on-multiple-where-clauses-in-firebase-1657387494547"},{"title":"How can I validate an email address in JavaScript?","slug":"how-can-i-validate-an-email-address-in-javascript-1657385475959"},{"title":"What is PECS (Producer Extends Consumer Super)?","slug":"what-is-pecs-(producer-extends-consumer-super)-1657384828870"},{"title":"Why does the order in which libraries are linked sometimes cause errors in GCC?","slug":"why-does-the-order-in-which-libraries-are-linked-sometimes-cause-errors-in-gcc-1657387609554"},{"title":"Why does printf not flush after the call unless a newline is in the format string?","slug":"why-does-printf-not-flush-after-the-call-unless-a-newline-is-in-the-format-string-1657387853407"},{"title":"Why does Spring MVC respond with a 404 and report \"No mapping found for HTTP request with URI [...] in DispatcherServlet\"?","slug":"why-does-spring-mvc-respond-with-a-404-and-report-\"no-mapping-found-for-http-request-with-uri-...-in-dispatcherservlet\"-1657387995250"},{"title":"How do I copy to the clipboard in JavaScript?","slug":"how-do-i-copy-to-the-clipboard-in-javascript-1657385501223"},{"title":"What are copy elision and return value optimization?","slug":"what-are-copy-elision-and-return-value-optimization-1657385455976"},{"title":"Error in finding last used cell in Excel with VBA","slug":"error-in-finding-last-used-cell-in-excel-with-vba-1657384584748"}]},"__N_SSG":true}