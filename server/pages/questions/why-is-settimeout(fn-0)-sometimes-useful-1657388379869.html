<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find solution for coding, HTML, CSS, JAVASCRIPT, MYSQL, PHP, PYTHON,... quickly. - solutionschecker.com"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><title>Why is setTimeout(fn, 0) sometimes useful? | Solutions Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="I&#x27;ve recently run into a rather nasty bug, wherein the code was loading a &lt;select&gt; dynamically via JavaScript.  This dynamically loaded &lt;select&gt; had a pre-selected value.  In IE6, we already had code to fix the selected &lt;option&gt;, because sometimes the &lt;select&gt;&#x27;s selectedIndex value would be out of sync with the selected &lt;option&gt;&#x27;s index attribute, as below:

field.selectedIndex = element.index;


However, this code wasn&#x27;t working.  Even though the field&#x27;s selectedIndex was being set correctly, the wrong index would end up being selected.  However, if I stuck an alert() statement in at the right time, the correct option would be selected.  Thinking this might be some sort of timing issue, I tried something random that I&#x27;d seen in code before:

var wrapFn = (function() {
    var myField = field;
    var myElement = element;

    return function() {
        myField.selectedIndex = myElement.index;
    }
})();
setTimeout(wrapFn, 0);


And this worked!

I&#x27;ve got a solution for my problem, but I&#x27;m uneasy that I don&#x27;t know exactly why this fixes my problem.  Does anyone have an official explanation?  What browser issue am I avoiding by calling my function &quot;later&quot; using setTimeout()?
    "/><meta property="og:title" content="Why is setTimeout(fn, 0) sometimes useful? | Solutions Checker"/><meta property="og:description" content="I&#x27;ve recently run into a rather nasty bug, wherein the code was loading a &lt;select&gt; dynamically via JavaScript.  This dynamically loaded &lt;select&gt; had a pre-selected value.  In IE6, we already had code to fix the selected &lt;option&gt;, because sometimes the &lt;select&gt;&#x27;s selectedIndex value would be out of sync with the selected &lt;option&gt;&#x27;s index attribute, as below:

field.selectedIndex = element.index;


However, this code wasn&#x27;t working.  Even though the field&#x27;s selectedIndex was being set correctly, the wrong index would end up being selected.  However, if I stuck an alert() statement in at the right time, the correct option would be selected.  Thinking this might be some sort of timing issue, I tried something random that I&#x27;d seen in code before:

var wrapFn = (function() {
    var myField = field;
    var myElement = element;

    return function() {
        myField.selectedIndex = myElement.index;
    }
})();
setTimeout(wrapFn, 0);


And this worked!

I&#x27;ve got a solution for my problem, but I&#x27;m uneasy that I don&#x27;t know exactly why this fixes my problem.  Does anyone have an official explanation?  What browser issue am I avoiding by calling my function &quot;later&quot; using setTimeout()?
    "/><script type="application/ld+json">{"@context":"https://schema.org","@type":"QAPage","mainEntity":{"name":"Why is setTimeout(fn, 0) sometimes useful?","text":"I&apos;ve recently run into a rather nasty bug, wherein the code was loading a &lt;select&gt; dynamically via JavaScript.  This dynamically loaded &lt;select&gt; had a pre-selected value.  In IE6, we already had code to fix the selected &lt;option&gt;, because sometimes the &lt;select&gt;&apos;s selectedIndex value would be out of sync with the selected &lt;option&gt;&apos;s index attribute, as below:\n\nfield.selectedIndex = element.index;\n\n\nHowever, this code wasn&apos;t working.  Even though the field&apos;s selectedIndex was being set correctly, the wrong index would end up being selected.  However, if I stuck an alert() statement in at the right time, the correct option would be selected.  Thinking this might be some sort of timing issue, I tried something random that I&apos;d seen in code before:\n\nvar wrapFn = (function() {\n    var myField = field;\n    var myElement = element;\n\n    return function() {\n        myField.selectedIndex = myElement.index;\n    }\n})();\nsetTimeout(wrapFn, 0);\n\n\nAnd this worked!\n\nI&apos;ve got a solution for my problem, but I&apos;m uneasy that I don&apos;t know exactly why this fixes my problem.  Does anyone have an official explanation?  What browser issue am I avoiding by calling my function &quot;later&quot; using setTimeout()?\n    ","answerCount":19,"upVoteCount":500,"suggestedAnswer":[{"text":"In the question, there existed a race condition between:\n\n\nThe browser&apos;s attempt to initialize the drop-down list, ready to have its selected index updated, and\nYour code to set the selected index\n\n\nYour code was consistently winning this race and attempting to set drop-down selection before the browser was ready, meaning that the bug would appear.\n\nThis race existed because JavaScript has a single thread of execution that is shared with page rendering. In effect, running JavaScript blocks the updating of the DOM.\n\nYour workaround was:\n\nsetTimeout(callback, 0)\n\n\nInvoking setTimeout with a callback, and zero as the second argument will schedule the callback to be run asynchronously, after the shortest possible delay - which will be around 10ms when the tab has focus and the JavaScript thread of execution is not busy.\n\nThe OP&apos;s solution, therefore was to delay by about 10ms, the setting of the selected index. This gave the browser an opportunity to initialize the DOM, fixing the bug.\n\nEvery version of Internet Explorer exhibited quirky behaviors and this kind of workaround was necessary at times. Alternatively it might have been a genuine bug in the OP&apos;s codebase. \n\n\n\nSee Philip Roberts talk &quot;What the heck is the event loop?&quot; for more thorough explanation.\n    ","url":"/questions/[slug]#solution1","@type":"Answer","upvoteCount":0},{"text":"Preface:\n\nSome of the other answers are correct but don&apos;t actually illustrate what the problem being solved is, so I created this answer to present that detailed illustration.\n\nAs such, I am posting a detailed walk-through of what the browser does and how using setTimeout() helps. It looks longish but is actually very simple and straightforward - I just made it very detailed. \n\nUPDATE: I have made a JSFiddle to live-demonstrate the explanation below: http://jsfiddle.net/C2YBE/31/ . Many thanks to @ThangChung for helping to kickstart it.\n\nUPDATE2: Just in case JSFiddle web site dies, or deletes the code, I added the code to this answer at the very end.\n\n\n\nDETAILS:\n\nImagine a web app with a &quot;do something&quot; button and a result div.\n\nThe onClick handler for &quot;do something&quot; button calls a function &quot;LongCalc()&quot;, which does 2 things:\n\n\nMakes a very long calculation (say takes 3 min)\nPrints the results of calculation into the result div.\n\n\nNow, your users start testing this, click &quot;do something&quot; button, and the page sits there doing seemingly nothing for 3 minutes, they get restless, click the button again, wait 1 min, nothing happens, click button again... \n\nThe problem is obvious - you want a &quot;Status&quot; DIV, which shows what&apos;s going on. Let&apos;s see how that works.\n\n\n\nSo you add a &quot;Status&quot; DIV (initially empty), and modify the onclick handler (function LongCalc()) to do 4 things:\n\n\nPopulate the status &quot;Calculating... may take ~3 minutes&quot; into status DIV\nMakes a very long calculation (say takes 3 min)\nPrints the results of calculation into the result div.\nPopulate the status &quot;Calculation done&quot; into status DIV\n\n\nAnd, you happily give the app to users to re-test.\n\nThey come back to you looking very angry. And explain that when they clicked the button, the Status DIV never got updated with &quot;Calculating...&quot; status!!!\n\n\n\nYou scratch your head, ask around on StackOverflow (or read docs or google), and realize the problem:\n\nThe browser places all its &quot;TODO&quot; tasks (both UI tasks and JavaScript commands) resulting from events into a single queue. And unfortunately, re-drawing the &quot;Status&quot; DIV with the new &quot;Calculating...&quot; value is a separate TODO which goes to the end of the queue!\n\nHere&apos;s a breakdown of the events during your user&apos;s test, contents of the queue after each event:\n\n\nQueue: [Empty]\nEvent: Click the button. Queue after event: [Execute OnClick handler(lines 1-4)]\nEvent: Execute first line in OnClick handler (e.g. change Status DIV value). Queue after event: [Execute OnClick handler(lines 2-4), re-draw Status DIV with new &quot;Calculating&quot; value]. Please note that while the DOM changes happen instantaneously, to re-draw the corresponding DOM element you need a new event, triggered by the DOM change, that went at the end of the queue.\nPROBLEM!!! PROBLEM!!! Details explained below.\nEvent: Execute second line in handler (calculation). Queue after: [Execute OnClick handler(lines 3-4), re-draw Status DIV with &quot;Calculating&quot; value].\nEvent: Execute 3rd line in handler (populate result DIV). Queue after: [Execute OnClick handler(line 4), re-draw Status DIV with &quot;Calculating&quot; value, re-draw result DIV with result].\nEvent: Execute 4th line in handler (populate status DIV with &quot;DONE&quot;). Queue: [Execute OnClick handler, re-draw Status DIV with &quot;Calculating&quot; value, re-draw result DIV with result; re-draw Status DIV with &quot;DONE&quot; value].\nEvent: execute implied return from onclick handler sub. We take the &quot;Execute OnClick handler&quot; off the queue and start executing next item on the queue.\nNOTE: Since we already finished the calculation, 3 minutes already passed for the user. The re-draw event didn&apos;t happen yet!!!\nEvent: re-draw Status DIV with &quot;Calculating&quot; value. We do the re-draw and take that off the queue.\nEvent: re-draw Result DIV with result value. We do the re-draw and take that off the queue.\nEvent: re-draw Status DIV with &quot;Done&quot; value. We do the re-draw and take that off the queue.\nSharp-eyed viewers might even notice &quot;Status DIV with &quot;Calculating&quot; value flashing for fraction of a microsecond - AFTER THE CALCULATION FINISHED\n\n\nSo, the underlying problem is that the re-draw event for &quot;Status&quot; DIV is placed on the queue at the end, AFTER the &quot;execute line 2&quot; event which takes 3 minutes, so the actual re-draw doesn&apos;t happen until AFTER the calculation is done.\n\n\n\nTo the rescue comes the setTimeout(). How does it help? Because by calling long-executing code via setTimeout, you actually create 2 events: setTimeout execution itself, and (due to 0 timeout), separate queue entry for the code being executed.\n\nSo, to fix your problem, you modify your onClick handler to be TWO statements (in a new function or just a block within onClick):\n\n\nPopulate the status &quot;Calculating... may take ~3 minutes&quot; into status DIV\nExecute setTimeout() with 0 timeout and a call to LongCalc() function. \n\nLongCalc() function is almost the same as last time but obviously doesn&apos;t have &quot;Calculating...&quot; status DIV update as first step; and instead starts the calculation right away.\n\n\nSo, what does the event sequence and the queue look like now?\n\n\nQueue: [Empty]\nEvent: Click the button. Queue after event: [Execute OnClick handler(status update, setTimeout() call)]\nEvent: Execute first line in OnClick handler (e.g. change Status DIV value). Queue after event: [Execute OnClick handler(which is a setTimeout call), re-draw Status DIV with new &quot;Calculating&quot; value]. \nEvent: Execute second line in handler (setTimeout call). Queue after: [re-draw Status DIV with &quot;Calculating&quot; value]. The queue has nothing new in it for 0 more seconds.\nEvent: Alarm from the timeout goes off, 0 seconds later. Queue after: [re-draw Status DIV with &quot;Calculating&quot; value, execute LongCalc (lines 1-3)]. \nEvent: re-draw Status DIV with &quot;Calculating&quot; value. Queue after: [execute LongCalc (lines 1-3)]. Please note that this re-draw event might actually happen BEFORE the alarm goes off, which works just as well.\n...\n\n\nHooray! The Status DIV just got updated to &quot;Calculating...&quot; before the calculation started!!!\n\n\n\n\n\nBelow is the sample code from the JSFiddle illustrating these examples: http://jsfiddle.net/C2YBE/31/ :\n\nHTML code:\n\n&lt;table border=1&gt;\n    &lt;tr&gt;&lt;td&gt;&lt;button id=&apos;do&apos;&gt;Do long calc - bad status!&lt;/button&gt;&lt;/td&gt;\n        &lt;td&gt;&lt;div id=&apos;status&apos;&gt;Not Calculating yet.&lt;/div&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;&lt;td&gt;&lt;button id=&apos;do_ok&apos;&gt;Do long calc - good status!&lt;/button&gt;&lt;/td&gt;\n        &lt;td&gt;&lt;div id=&apos;status_ok&apos;&gt;Not Calculating yet.&lt;/div&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n&lt;/table&gt;\n\n\nJavaScript code: (Executed on onDomReady and may require jQuery 1.9)\n\nfunction long_running(status_div) {\n\n    var result = 0;\n    // Use 1000/700/300 limits in Chrome, \n    //    300/100/100 in IE8, \n    //    1000/500/200 in FireFox\n    // I have no idea why identical runtimes fail on diff browsers.\n    for (var i = 0; i &lt; 1000; i++) {\n        for (var j = 0; j &lt; 700; j++) {\n            for (var k = 0; k &lt; 300; k++) {\n                result = result + i + j + k;\n            }\n        }\n    }\n    $(status_div).text(&apos;calculation done&apos;);\n}\n\n// Assign events to buttons\n$(&apos;#do&apos;).on(&apos;click&apos;, function () {\n    $(&apos;#status&apos;).text(&apos;calculating....&apos;);\n    long_running(&apos;#status&apos;);\n});\n\n$(&apos;#do_ok&apos;).on(&apos;click&apos;, function () {\n    $(&apos;#status_ok&apos;).text(&apos;calculating....&apos;);\n    // This works on IE8. Works in Chrome\n    // Does NOT work in FireFox 25 with timeout =0 or =1\n    // DOES work in FF if you change timeout from 0 to 500\n    window.setTimeout(function (){ long_running(&apos;#status_ok&apos;) }, 0);\n});\n\n    ","url":"/questions/[slug]#solution2","@type":"Answer","upvoteCount":0},{"text":"Take a look at John Resig&apos;s article about How JavaScript Timers Work. When you set a timeout, it actually queues the asynchronous code until the engine executes the current call stack.\n    ","url":"/questions/[slug]#solution3","@type":"Answer","upvoteCount":0},{"text":"setTimeout() buys you some time until the DOM elements are loaded, even if is set to 0.\n\nCheck this out: setTimeout\n    ","url":"/questions/[slug]#solution4","@type":"Answer","upvoteCount":0},{"text":"Browsers have a process called &quot;main thread&quot;, that is responsible for executing some JavaScript tasks, UI updates e.g.: painting, redraw, reflow, etc.\nJavaScript tasks are queued to a message queue and then are dispatched to the browser&apos;s main thread to be executed.\nWhen UI updates are generated while the main thread is busy, tasks are added into the message queue.\n    ","url":"/questions/[slug]#solution5","@type":"Answer","upvoteCount":0},{"text":"There are conflicting upvoted answers here, and without proof there is no way to know whom to believe. Here is proof that @DVK is right and @SalvadorDali is incorrect. The latter claims:\n\n\n  &quot;And here is why: it is not possible to have setTimeout with a time\n  delay of 0 milliseconds. The Minimum value is determined by the\n  browser and it is not 0 milliseconds. Historically browsers sets this\n  minimum to 10 milliseconds, but the HTML5 specs and modern browsers\n  have it set at 4 milliseconds.&quot;\n\n\nThe 4ms minimum timeout is irrelevant to what is happening. What really happens is that setTimeout pushes the callback function to the end of the execution queue. If after setTimeout(callback, 0) you have blocking code which takes several seconds to run, the callback will not be executed for several seconds, until the blocking code has finished. Try this code:\n\nfunction testSettimeout0 () {\n    var startTime = new Date().getTime()\n    console.log(&apos;setting timeout 0 callback at &apos; +sinceStart())\n    setTimeout(function(){\n        console.log(&apos;in timeout callback at &apos; +sinceStart())\n    }, 0)\n    console.log(&apos;starting blocking loop at &apos; +sinceStart())\n    while (sinceStart() &lt; 3000) {\n        continue\n    }\n    console.log(&apos;blocking loop ended at &apos; +sinceStart())\n    return // functions below\n    function sinceStart () {\n        return new Date().getTime() - startTime\n    } // sinceStart\n} // testSettimeout0\n\n\nOutput is:\n\nsetting timeout 0 callback at 0\nstarting blocking loop at 5\nblocking loop ended at 3000\nin timeout callback at 3033\n\n    ","url":"/questions/[slug]#solution6","@type":"Answer","upvoteCount":0},{"text":"One reason to do that is to defer the execution of code to a separate, subsequent event loop. When responding to a browser event of some kind (mouse click, for example), sometimes it&apos;s necessary to perform operations only after the current event is processed. The setTimeout() facility is the simplest way to do it.\n\nedit now that it&apos;s 2015 I should note that there&apos;s also requestAnimationFrame(), which isn&apos;t exactly the same but it&apos;s sufficiently close to setTimeout(fn, 0) that it&apos;s worth mentioning.\n    ","url":"/questions/[slug]#solution7","@type":"Answer","upvoteCount":0},{"text":"Both of these two top-rated answers are wrong. Check out the MDN description on the concurrency model and the event loop, and it should become clear what&apos;s going on (that MDN resource is a real gem). And simply using setTimeout can be adding unexpected problems in your code in addition to &quot;solving&quot; this little problem.\n\nWhat&apos;s actually going on here is not that &quot;the browser might not be quite ready yet because concurrency,&quot; or something based on &quot;each line is an event that gets added to the back of the queue&quot;.\n\nThe jsfiddle provided by DVK indeed illustrates a problem, but his explanation for it isn&apos;t correct.\n\nWhat&apos;s happening in his code is that he&apos;s first attaching an event handler to the click event on the #do button.\n\nThen, when you actually click the button, a message is created referencing the event handler function, which gets added to the message queue. When the event loop reaches this message, it creates a frame on the stack, with the function call to the click event handler in the jsfiddle.\n\nAnd this is where it gets interesting. We&apos;re so used to thinking of Javascript as being asynchronous that we&apos;re prone to overlook this tiny fact: Any frame has to be executed, in full, before the next frame can be executed. No concurrency, people. \n\nWhat does this mean? It means that whenever a function is invoked from the message queue, it blocks the queue until the stack it generates has been emptied. Or, in more general terms, it blocks until the function has returned. And it blocks everything, including DOM rendering operations, scrolling, and whatnot. If you want confirmation, just try to increase the duration of the long running operation in the fiddle (e.g. run the outer loop 10 more times), and you&apos;ll notice that while it runs, you cannot scroll the page. If it runs long enough, your browser will ask you if you want to kill the process, because it&apos;s making the page unresponsive. The frame is being executed, and the event loop and message queue are stuck until it finishes.\n\nSo why this side-effect of the text not updating? Because while you have changed the value of the element in the DOM  you can console.log() its value immediately after changing it and see that it has been changed (which shows why DVK&apos;s explanation isn&apos;t correct)  the browser is waiting for the stack to deplete (the on handler function to return) and thus the message to finish, so that it can eventually get around to executing the message that has been added by the runtime as a reaction to our mutation operation, and in order to reflect that mutation in the UI.\n\nThis is because we are actually waiting for code to finish running. We haven&apos;t said &quot;someone fetch this and then call this function with the results, thanks, and now I&apos;m done so imma return, do whatever now,&quot; like we usually do with our event-based asynchronous Javascript. We enter a click event handler function, we update a DOM element, we call another function, the other function works for a long time and then returns, we then update the same DOM element, and then we return from the initial function, effectively emptying the stack. And then the browser can get to the next message in the queue, which might very well be a message generated by us by triggering some internal &quot;on-DOM-mutation&quot; type event.\n\nThe browser UI cannot (or chooses not to) update the UI until the currently executing frame has completed (the function has returned). Personally, I think this is rather by design than restriction.\n\nWhy does the setTimeout thing work then? It does so, because it effectively removes the call to the long-running function from its own frame, scheduling it to be executed later in the window context, so that it itself can return immediately and allow the message queue to process other messages. And the idea is that the UI &quot;on update&quot; message that has been triggered by us in Javascript when changing the text in the DOM is now ahead of the message queued for the long-running function, so that the UI update happens before we block for a long time.\n\nNote that a) The long-running function still blocks everything when it runs, and b) you&apos;re not guaranteed that the UI update is actually ahead of it in the message queue. On my June 2018 Chrome browser, a value of 0 does not &quot;fix&quot; the problem the fiddle demonstrates  10 does. I&apos;m actually a bit stifled by this, because it seems logical to me that the UI update message should be queued up before it, since its trigger is executed before scheduling the long-running function to be run &quot;later&quot;. But perhaps there&apos;re some optimisations in the V8 engine that may interfere, or maybe my understanding is just lacking.\n\nOkay, so what&apos;s the problem with using setTimeout, and what&apos;s a better solution for this particular case?\n\nFirst off, the problem with using setTimeout on any event handler like this, to try to alleviate another problem, is prone to mess with other code. Here&apos;s a real-life example from my work:\n\nA colleague, in a mis-informed understanding on the event loop, tried to &quot;thread&quot; Javascript by having some template rendering code use setTimeout 0 for its rendering. He&apos;s no longer here to ask, but I can presume that perhaps he inserted timers to gauge the rendering speed (which would be the return immediacy of functions) and found that using this approach would make for blisteringly fast responses from that function.\n\nFirst problem is obvious; you cannot thread javascript, so you win nothing here while you add obfuscation. Secondly, you have now effectively detached the rendering of a template from the stack of possible event listeners that might expect that very template to have been rendered, while it may very well not have been. The actual behaviour of that function was now non-deterministic, as was  unknowingly so  any function that would run it, or depend on it. You can make educated guesses, but you cannot properly code for its behaviour.\n\nThe &quot;fix&quot; when writing a new event handler that depended on its logic was to also use setTimeout 0. But, that&apos;s not a fix, it is hard to understand, and it is no fun to debug errors that are caused by code like this. Sometimes there&apos;s no problem ever, other times it concistently fails, and then again, sometimes it works and breaks sporadically, depending on the current performance of the platform and whatever else happens to going on at the time. This is why I personally would advise against using this hack (it is a hack, and we should all know that it is), unless you really know what you&apos;re doing and what the consequences are.\n\nBut what can we do instead? Well, as the referenced MDN article suggests, either split the work into multiple messages (if you can) so that other messages that are queued up may be interleaved with your work and executed while it runs, or use a web worker, which can run in tandem with your page and return results when done with its calculations.\n\nOh, and if you&apos;re thinking, &quot;Well, couldn&apos;t I just put a callback in the long-running function to make it asynchronous?,&quot; then no. The callback doesn&apos;t make it asynchronous, it&apos;ll still have to run the long-running code before explicitly calling your callback.\n    ","url":"/questions/[slug]#solution8","@type":"Answer","upvoteCount":0},{"text":"This is an old questions with old answers. I wanted to add a new look at this problem and to answer why is this happens and not why is this useful.\n\nSo you have two functions:\n\nvar f1 = function () {    \n   setTimeout(function(){\n      console.log(&quot;f1&quot;, &quot;First function call...&quot;);\n   }, 0);\n};\n\nvar f2 = function () {\n    console.log(&quot;f2&quot;, &quot;Second call...&quot;);\n};\n\n\nand then call them in the following order f1(); f2(); just to see that the second one executed first. \n\nAnd here is why: it is not possible to have setTimeout with a time delay of 0 milliseconds. The Minimum value is determined by the browser and it is not 0 milliseconds. Historically browsers sets this minimum to 10 milliseconds, but the HTML5 specs and modern browsers have it set at 4 milliseconds. \n\n\n  If nesting level is greater than 5, and timeout is less than 4, then\n  increase timeout to 4.\n\n\nAlso from mozilla:\n\n\n  To implement a 0 ms timeout in a modern browser, you can use\n  window.postMessage() as described here.\n\n\nP.S. information is taken after reading the following article.\n    ","url":"/questions/[slug]#solution9","@type":"Answer","upvoteCount":0},{"text":"If you don&apos;t want to watch a whole video, here&apos;s a simple explanation of the things one needs to understand, in order to be able to understand the answer to this question:\n\nJavaScript is single-threaded meaning it does only one thing at a time when running.\nBut the environments in which the JavaScript is running, can be multi-threaded. E.g., browsers are often multi-threaded creatures, i.e., are able to do multiple things at a time. So they can run JavaScript and at the same time keep track of dealing with other stuff too.\n\nFrom this point on, we&apos;re talking about JavaScript &quot;in browsers&quot;. Things like setTimeout are indeed browser things, and are not part of the JavaScript itself.\n\nThe thing that allows JavaScript to run asynchronously is the multi-threaded browser! Other than the main space Javascript uses (called the the call stack) to put each line of code on and run them one by one, browsers also provide JavaScript with another space to put things on.\n\nNow let&apos;s call that other space the second space.\n\nLet&apos;s assume fn is a function. The important thing to understand here is that fn(); call is not equal to the setTimeout(fn, 0); call as will be explained further below.\n\nInstead of a 0 delay, let&apos;s assume another delay first, e.g., 5000 milliseconds: setTimeout(fn, 5000);. It&apos;s important to note that this is still a &quot;function call&quot;, so it has to be put on the main space, and removed from it when it&apos;s done, but wait!, we don&apos;t like a whole lengthy and boring 5 seconds delay. That would block the main space and will not allow JavaScript to run ANYTHING else in the meantime.\nThankfully this is not how the browser designers designed them to work. Instead, this call(setTimeout(fn, 5000);) is done instantly. This is very important: Even with the 5000 milliseconds delay, this function call is complete in an instant! What will happen next? It gets removed from the main space. Where will it be put on? (because we don&apos;t want to lose it). You might have guessed right: The browser hears this call and puts it on the second space.\n\nThe browser keeps track of the 5 seconds delay and once it&apos;s passed, it looks at the main space, and &quot;WHEN IT&apos;S EMPTY&quot;, puts the fn(); call back on it. That is how the setTimeout works.\nSo, back to the setTimeout(fn, 0), even though the delay is zero, this is still a call to the browser, and the browser hears it instantly and picks it up, and puts it on the second space and puts it back on the main space only when the main space is empty again, and not really 0 milliseconds later.\nI really recommend watching that video as well since he&apos;s explained it really well, and opens technical things up more.\n    ","url":"/questions/[slug]#solution10","@type":"Answer","upvoteCount":0},{"text":"Since it is being passed a duration of 0, I suppose it is in order to remove the code passed to the setTimeout from the flow of execution. So if it&apos;s a function that could take a while, it won&apos;t prevent the subsequent code from executing.\n    ","url":"/questions/[slug]#solution11","@type":"Answer","upvoteCount":0},{"text":"The other thing this does is push the function invocation to the bottom of the stack, preventing a stack overflow if you are recursively calling a function. This has the effect of a while loop but lets the JavaScript engine fire other asynchronous timers.\n    ","url":"/questions/[slug]#solution12","@type":"Answer","upvoteCount":0},{"text":"By calling setTimeout you give the page time to react to the whatever the user is doing. This is particularly helpful for functions run during page load. \n    ","url":"/questions/[slug]#solution13","@type":"Answer","upvoteCount":0},{"text":"Some other cases where setTimeout is useful:\n\nYou want to break a long-running loop or calculation into smaller components so that the browser doesn&apos;t appear to &apos;freeze&apos; or say &quot;Script on page is busy&quot;.\n\nYou want to disable a form submit button when clicked, but if you disable the button in the onClick handler the form will not be submitted. setTimeout with a time of zero does the trick, allowing the event to end, the form to begin submitting, then your button can be disabled.\n    ","url":"/questions/[slug]#solution14","@type":"Answer","upvoteCount":0},{"text":"The problem was you were trying to perform a Javascript operation on a non existing element. The element was yet to be loaded and setTimeout() gives more time for an element to load in the following ways:\n\n\nsetTimeout() causes the event to be ansynchronous therefore being executed after all the synchronous code, giving your element more time to load. Asynchronous callbacks like the callback in setTimeout() are placed in the event queue and put on the stack by the event loop after the stack of synchronous code is empty. \nThe value 0 for ms as a second argument in function setTimeout() is often slightly higher (4-10ms depending on browser). This slightly higher time needed for executing the setTimeout() callbacks is caused by the amount of &apos;ticks&apos; (where a tick is pushing a callback on the stack if stack is empty) of the event loop. Because of performance and battery life reasons the amount of ticks in the event loop are restricted to a certain amount less than 1000 times per second.\n\n    ","url":"/questions/[slug]#solution15","@type":"Answer","upvoteCount":0},{"text":"The answers about execution loops and rendering the DOM before some other code completes are correct. Zero second timeouts in JavaScript help make the code pseudo-multithreaded, even though it is not.\n\nI want to add that the BEST value for a cross browser / cross platform zero-second timeout in JavaScript is actually about 20 milliseconds instead of 0 (zero), because many mobile browsers can&apos;t register timeouts smaller than 20 milliseconds due to clock limitations on AMD chips.\n\nAlso, long-running processes that do not involve DOM manipulation should be sent to Web Workers now, as they provide true multithreaded execution of JavaScript.\n    ","url":"/questions/[slug]#solution16","@type":"Answer","upvoteCount":0},{"text":"setTimout on 0 is also very useful in the pattern of setting up a deferred promise, which you want to return right away:\n\nmyObject.prototype.myMethodDeferred = function() {\n    var deferredObject = $.Deferred();\n    var that = this;  // Because setTimeout won&apos;t work right with this\n    setTimeout(function() { \n        return myMethodActualWork.call(that, deferredObject);\n    }, 0);\n    return deferredObject.promise();\n}\n\n    ","url":"/questions/[slug]#solution17","@type":"Answer","upvoteCount":0},{"text":"\n\n//When need &quot;new a&quot;, setTimeout(fn, 0) is useful, when need to wait some action. Example:\n\nvar a = function (){console.log(&apos;a&apos;);};\nvar b = function(){setTimeout(b, 100);}; //wait some action before override this function\n\n//without setTimeout:\nconsole.log(&apos;no setTimeout: b.toString():&apos;, b.toString());\nb();    //&quot;b&quot; is an old function\nconsole.log(&apos;no setTieout: a.toString(): &apos;, a.toString());\na();    //and &quot;a&quot; is not overrided\n\nsetTimeout(//but with setTimeout(fn, 0):\n    function(){\n        console.log(&apos;After timeout 0, b.toString(): &apos;, b.toString());\n        b();    //&quot;b&quot; is a new function\n        console.log(&apos;After timeout 0, a.toString(): &apos;, a.toString());\n        a();    //and &quot;a&quot; is overrided\n    },\n    0\n);\n\n//override var &quot;b&quot;, which was been undefined\nb = function (){\n    a = function(){console.log(&apos;new a&apos;);};\n}\n Run code snippetHide resultsExpand snippet\n\n\n    ","url":"/questions/[slug]#solution18","@type":"Answer","upvoteCount":0},{"text":"Javascript is single threaded application so that don&apos;t allow to run function concurrently so to achieve this event loops are use. So exactly what setTimeout(fn, 0) do that its pussed into task quest which is executed when your call stack is empty. I know this explanation is pretty boring, so i recommend you to go through this video this will help you how things work under the hood in browser.\nCheck out this video:- https://www.youtube.com/watch?time_continue=392&amp;v=8aGhZQkoFbQ\n    ","url":"/questions/[slug]#solution19","@type":"Answer","upvoteCount":0}],"@type":"Question"}}</script><meta name="next-head-count" content="16"/><link rel="preload" href="/_next/static/css/08bcc42a26fe5c92.css" as="style"/><link rel="stylesheet" href="/_next/static/css/08bcc42a26fe5c92.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-08d1a634dea6705e.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/150-12e9794e898cd5f3.js" defer=""></script><script src="/_next/static/chunks/490-7f0418bb4354ac73.js" defer=""></script><script src="/_next/static/chunks/108-87de33c23337ff53.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-928c5d1eb8fb0bba.js" defer=""></script><script src="/_next/static/BnkbnjkWYxefPXjTJLVVv/_buildManifest.js" defer=""></script><script src="/_next/static/BnkbnjkWYxefPXjTJLVVv/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h4 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h4></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/why-is-settimeout(fn-0)-sometimes-useful-1657388379869#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="question my-5"><div class="flex question-header items-center m-auto justify-center"><div class="rounded-xl w-full border p-5 shadow-md bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/why-is-settimeout(fn-0)-sometimes-useful-1657388379869"><h1>Why is setTimeout(fn, 0) sometimes useful?</h1></a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/event-loop">event-loop</a></div></div><div class="question-content mt-5">
                
<p>I've recently run into a rather nasty bug, wherein the code was loading a <code>&lt;select&gt;</code> dynamically via JavaScript.  This dynamically loaded <code>&lt;select&gt;</code> had a pre-selected value.  In IE6, we already had code to fix the selected <code>&lt;option&gt;</code>, because sometimes the <code>&lt;select&gt;</code>'s <code>selectedIndex</code> value would be out of sync with the selected <code>&lt;option&gt;</code>'s <code>index</code> attribute, as below:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">field.<span class="hljs-property">selectedIndex</span> = element.<span class="hljs-property">index</span>;
</code></pre>

<p>However, this code wasn't working.  Even though the field's <code>selectedIndex</code> was being set correctly, the wrong index would end up being selected.  However, if I stuck an <code>alert()</code> statement in at the right time, the correct option would be selected.  Thinking this might be some sort of timing issue, I tried something random that I'd seen in code before:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> wrapFn = (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">var</span> myField = field;
    <span class="hljs-keyword">var</span> myElement = element;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
        myField.<span class="hljs-property">selectedIndex</span> = myElement.<span class="hljs-property">index</span>;
    }
})();
<span class="hljs-built_in">setTimeout</span>(wrapFn, <span class="hljs-number">0</span>);
</code></pre>

<p>And this worked!</p>

<p>I've got a solution for my problem, but I'm uneasy that I don't know exactly why this fixes my problem.  Does anyone have an official explanation?  What browser issue am I avoiding by calling my function "later" using <code>setTimeout()</code>?</p>
    </div></div></div><div class="solution-section"><nav class="flex pagination-solution flex-col justify-end"><ul class="inline-flex -space-x-px overflow-auto"><li class="pagination-solution-item"><span data-id="#solution1" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">1</span></li><li class="pagination-solution-item"><span data-id="#solution2" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">2</span></li><li class="pagination-solution-item"><span data-id="#solution3" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">3</span></li><li class="pagination-solution-item"><span data-id="#solution4" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">4</span></li><li class="pagination-solution-item"><span data-id="#solution5" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">5</span></li><li class="pagination-solution-item"><span data-id="#solution6" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">6</span></li><li class="pagination-solution-item"><span data-id="#solution7" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">7</span></li><li class="pagination-solution-item"><span data-id="#solution8" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">8</span></li><li class="pagination-solution-item"><span data-id="#solution9" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">9</span></li><li class="pagination-solution-item"><span data-id="#solution10" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">10</span></li><li class="pagination-solution-item"><span data-id="#solution11" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">11</span></li><li class="pagination-solution-item"><span data-id="#solution12" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">12</span></li><li class="pagination-solution-item"><span data-id="#solution13" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">13</span></li><li class="pagination-solution-item"><span data-id="#solution14" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">14</span></li><li class="pagination-solution-item"><span data-id="#solution15" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">15</span></li><li class="pagination-solution-item"><span data-id="#solution16" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">16</span></li><li class="pagination-solution-item"><span data-id="#solution17" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">17</span></li><li class="pagination-solution-item"><span data-id="#solution18" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">18</span></li><li class="pagination-solution-item"><span data-id="#solution19" class="cursor-pointer py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">19</span></li></ul></nav><div id="solution1" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In the question, there existed a <a href="https://en.wikipedia.org/wiki/Race_condition" rel="noreferrer">race condition</a> between:</p>

<ol>
<li>The browser's attempt to initialize the drop-down list, ready to have its selected index updated, and</li>
<li>Your code to set the selected index</li>
</ol>

<p>Your code was consistently winning this race and attempting to set drop-down selection before the browser was ready, meaning that the bug would appear.</p>

<p>This race existed because JavaScript has a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop" rel="noreferrer">single thread of execution</a> that is shared with page rendering. In effect, running JavaScript blocks the updating of the DOM.</p>

<p>Your workaround was:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-built_in">setTimeout</span>(callback, <span class="hljs-number">0</span>)
</code></pre>

<p>Invoking <code>setTimeout</code> with a callback, and zero as the second argument will schedule the callback to be run <strong>asynchronously</strong>, after the shortest possible delay - which will be around 10ms when the tab has focus and the JavaScript thread of execution is not busy.</p>

<p>The OP's solution, therefore was to delay by about 10ms, the setting of the selected index. This gave the browser an opportunity to initialize the DOM, fixing the bug.</p>

<p>Every version of Internet Explorer exhibited quirky behaviors and this kind of workaround was necessary at times. Alternatively it might have been a genuine bug in the OP's codebase. </p>

<hr>

<p>See Philip Roberts talk <a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ" rel="noreferrer">"What the heck is the event loop?"</a> for more thorough explanation.</p>
    </div></div></div></div><div id="solution2" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><strong><em>Preface:</em></strong></p>

<p>Some of the other answers are correct but don't actually illustrate what the problem being solved is, so I created this answer to present that detailed illustration.</p>

<p>As such, I am posting a <strong>detailed walk-through of what the browser does and how using <code>setTimeout()</code> helps</strong>. It looks longish but is actually very simple and straightforward - I just made it very detailed. </p>

<p><strong>UPDATE:</strong> I have made a JSFiddle to live-demonstrate the explanation below: <a href="http://jsfiddle.net/C2YBE/31/" rel="noreferrer">http://jsfiddle.net/C2YBE/31/</a> . Many <strong>thanks</strong> to @ThangChung for helping to kickstart it.</p>

<p><strong>UPDATE2:</strong> Just in case JSFiddle web site dies, or deletes the code, I added the code to this answer at the very end.</p>

<hr>

<p><strong>DETAILS</strong>:</p>

<p>Imagine a web app with a "do something" button and a result div.</p>

<p>The <code>onClick</code> handler for "do something" button calls a function "LongCalc()", which does 2 things:</p>

<ol>
<li><p>Makes a very long calculation (say takes 3 min)</p></li>
<li><p>Prints the results of calculation into the result div.</p></li>
</ol>

<p>Now, your users start testing this, click "do something" button, and the page sits there doing seemingly nothing for 3 minutes, they get restless, click the button again, wait 1 min, nothing happens, click button again... </p>

<p>The problem is obvious - you want a "Status" DIV, which shows what's going on. Let's see how that works.</p>

<hr>

<p>So you add a "Status" DIV (initially empty), and modify the <code>onclick</code> handler (function <code>LongCalc()</code>) to do 4 things:</p>

<ol>
<li><p>Populate the status "Calculating... may take ~3 minutes" into status DIV</p></li>
<li><p>Makes a very long calculation (say takes 3 min)</p></li>
<li><p>Prints the results of calculation into the result div.</p></li>
<li><p>Populate the status "Calculation done" into status DIV</p></li>
</ol>

<p>And, you happily give the app to users to re-test.</p>

<p>They come back to you looking very angry. And explain that when they clicked the button, <strong>the Status DIV never got updated with "Calculating..." status!!!</strong></p>

<hr>

<p>You scratch your head, ask around on StackOverflow (or read docs or google), and realize the problem:</p>

<p>The browser places all its "TODO" tasks (both UI tasks and JavaScript commands) resulting from events into a <strong>single queue</strong>. And unfortunately, re-drawing the "Status" DIV with the new "Calculating..." value is a separate TODO which goes to the end of the queue!</p>

<p>Here's a breakdown of the events during your user's test, contents of the queue after each event:</p>

<ul>
<li>Queue: <code>[Empty]</code></li>
<li>Event: Click the button. Queue after event: <code>[Execute OnClick handler(lines 1-4)]</code></li>
<li>Event: Execute first line in OnClick handler (e.g. change Status DIV value). Queue after event: <code>[Execute OnClick handler(lines 2-4), re-draw Status DIV with new "Calculating" value]</code>. <strong>Please note that while the DOM changes happen instantaneously, to re-draw the corresponding DOM element you need a new event, triggered by the DOM change, that went at the end of the queue</strong>.</li>
<li><strong>PROBLEM!!!</strong> <strong>PROBLEM!!!</strong> Details explained below.</li>
<li>Event: Execute second line in handler (calculation). Queue after: <code>[Execute OnClick handler(lines 3-4), re-draw Status DIV with "Calculating" value]</code>.</li>
<li>Event: Execute 3rd line in handler (populate result DIV). Queue after: <code>[Execute OnClick handler(line 4), re-draw Status DIV with "Calculating" value, re-draw result DIV with result]</code>.</li>
<li>Event: Execute 4th line in handler (populate status DIV with "DONE"). Queue: <code>[Execute OnClick handler, re-draw Status DIV with "Calculating" value, re-draw result DIV with result; re-draw Status DIV with "DONE" value]</code>.</li>
<li>Event: execute implied <code>return</code> from <code>onclick</code> handler sub. We take the "Execute OnClick handler" off the queue and start executing next item on the queue.</li>
<li>NOTE: Since we already finished the calculation, 3 minutes already passed for the user. <strong>The re-draw event didn't happen yet!!!</strong></li>
<li>Event: re-draw Status DIV with "Calculating" value. We do the re-draw and take that off the queue.</li>
<li>Event: re-draw Result DIV with result value. We do the re-draw and take that off the queue.</li>
<li>Event: re-draw Status DIV with "Done" value. We do the re-draw and take that off the queue.
Sharp-eyed viewers might even notice "Status DIV with "Calculating" value flashing for fraction of a microsecond - <strong>AFTER THE CALCULATION FINISHED</strong></li>
</ul>

<p>So, the underlying problem is that the re-draw event for "Status" DIV is placed on the queue at the end, AFTER the "execute line 2" event which takes 3 minutes, so the actual re-draw doesn't happen until AFTER the calculation is done.</p>

<hr>

<p>To the rescue comes the <code>setTimeout()</code>. How does it help? Because by calling long-executing code via <code>setTimeout</code>, you actually create 2 events: <code>setTimeout</code> execution itself, and (due to 0 timeout), separate queue entry for the code being executed.</p>

<p>So, to fix your problem, you modify your <code>onClick</code> handler to be TWO statements (in a new function or just a block within <code>onClick</code>):</p>

<ol>
<li><p>Populate the status "Calculating... may take ~3 minutes" into status DIV</p></li>
<li><p><strong>Execute <code>setTimeout()</code> with 0 timeout and a call to <code>LongCalc()</code> function</strong>. </p>

<p><code>LongCalc()</code> function is almost the same as last time but obviously doesn't have "Calculating..." status DIV update as first step; and instead starts the calculation right away.</p></li>
</ol>

<p>So, what does the event sequence and the queue look like now?</p>

<ul>
<li>Queue: <code>[Empty]</code></li>
<li>Event: Click the button. Queue after event: <code>[Execute OnClick handler(status update, setTimeout() call)]</code></li>
<li>Event: Execute first line in OnClick handler (e.g. change Status DIV value). Queue after event: <code>[Execute OnClick handler(which is a setTimeout call), re-draw Status DIV with new "Calculating" value]</code>. </li>
<li>Event: Execute second line in handler (setTimeout call). Queue after: <code>[re-draw Status DIV with "Calculating" value]</code>. The queue has nothing new in it for 0 more seconds.</li>
<li>Event: Alarm from the timeout goes off, 0 seconds later. Queue after: <code>[re-draw Status DIV with "Calculating" value, execute LongCalc (lines 1-3)]</code>. </li>
<li>Event: <strong>re-draw Status DIV with "Calculating" value</strong>. Queue after: <code>[execute LongCalc (lines 1-3)]</code>. Please note that this re-draw event might actually happen BEFORE the alarm goes off, which works just as well.</li>
<li>...</li>
</ul>

<p>Hooray! The Status DIV just got updated to "Calculating..." before the calculation started!!!</p>

<hr>

<hr>

<p>Below is the sample code from the JSFiddle illustrating these examples: <a href="http://jsfiddle.net/C2YBE/31/" rel="noreferrer">http://jsfiddle.net/C2YBE/31/</a> :</p>

<p><strong>HTML code:</strong></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">&lt;table border=<span class="hljs-number">1</span>&gt;
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'do'</span>&gt;</span>Do long calc - bad status!<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'status'</span>&gt;</span>Not Calculating yet.<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span>
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'do_ok'</span>&gt;</span>Do long calc - good status!<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">'status_ok'</span>&gt;</span>Not Calculating yet.<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span></span>
&lt;/table&gt;
</code></pre>

<p><strong>JavaScript code: (Executed on <code>onDomReady</code> and may require jQuery 1.9)</strong></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">long_running</span>(<span class="hljs-params">status_div</span>) {

    <span class="hljs-keyword">var</span> result = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// Use 1000/700/300 limits in Chrome, </span>
    <span class="hljs-comment">//    300/100/100 in IE8, </span>
    <span class="hljs-comment">//    1000/500/200 in FireFox</span>
    <span class="hljs-comment">// I have no idea why identical runtimes fail on diff browsers.</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">700</span>; j++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; <span class="hljs-number">300</span>; k++) {
                result = result + i + j + k;
            }
        }
    }
    $(status_div).<span class="hljs-title function_">text</span>(<span class="hljs-string">'calculation done'</span>);
}

<span class="hljs-comment">// Assign events to buttons</span>
$(<span class="hljs-string">'#do'</span>).<span class="hljs-title function_">on</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    $(<span class="hljs-string">'#status'</span>).<span class="hljs-title function_">text</span>(<span class="hljs-string">'calculating....'</span>);
    <span class="hljs-title function_">long_running</span>(<span class="hljs-string">'#status'</span>);
});

$(<span class="hljs-string">'#do_ok'</span>).<span class="hljs-title function_">on</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    $(<span class="hljs-string">'#status_ok'</span>).<span class="hljs-title function_">text</span>(<span class="hljs-string">'calculating....'</span>);
    <span class="hljs-comment">// This works on IE8. Works in Chrome</span>
    <span class="hljs-comment">// Does NOT work in FireFox 25 with timeout =0 or =1</span>
    <span class="hljs-comment">// DOES work in FF if you change timeout from 0 to 500</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>){ <span class="hljs-title function_">long_running</span>(<span class="hljs-string">'#status_ok'</span>) }, <span class="hljs-number">0</span>);
});
</code></pre>
    </div></div></div></div><div id="solution3" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Take a look at John Resig's article about <a href="http://ejohn.org/blog/how-javascript-timers-work/">How JavaScript Timers Work</a>. When you set a timeout, it actually queues the asynchronous code until the engine executes the current call stack.</p>
    </div></div></div></div><div id="solution4" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><code>setTimeout()</code> buys you some time until the DOM elements are loaded, even if is set to 0.</p>

<p>Check this out: <a href="http://snook.ca/archives/javascript/settimeout_solve_domcontentloaded" rel="noreferrer">setTimeout</a></p>
    </div></div></div></div><div id="solution5" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Browsers have a process called "main thread", that is responsible for executing some JavaScript tasks, UI updates e.g.: painting, redraw, reflow, etc.
JavaScript tasks are queued to a message queue and then are dispatched to the browser's main thread to be executed.
When UI updates are generated while the main thread is busy, tasks are added into the message queue.</p>
    </div></div></div></div><div id="solution6" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>There are conflicting upvoted answers here, and without proof there is no way to know whom to believe. Here is proof that @DVK is right and @SalvadorDali is incorrect. The latter claims:</p>

<blockquote>
  <p>"And here is why: it is not possible to have setTimeout with a time
  delay of 0 milliseconds. The Minimum value is determined by the
  browser and it is not 0 milliseconds. Historically browsers sets this
  minimum to 10 milliseconds, but the HTML5 specs and modern browsers
  have it set at 4 milliseconds."</p>
</blockquote>

<p>The 4ms minimum timeout is irrelevant to what is happening. What really happens is that setTimeout pushes the callback function to the end of the execution queue. If after setTimeout(callback, 0) you have blocking code which takes several seconds to run, the callback will not be executed for several seconds, until the blocking code has finished. Try this code:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">testSettimeout0</span> () {
    <span class="hljs-keyword">var</span> startTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'setting timeout 0 callback at '</span> +<span class="hljs-title function_">sinceStart</span>())
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'in timeout callback at '</span> +<span class="hljs-title function_">sinceStart</span>())
    }, <span class="hljs-number">0</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'starting blocking loop at '</span> +<span class="hljs-title function_">sinceStart</span>())
    <span class="hljs-keyword">while</span> (<span class="hljs-title function_">sinceStart</span>() &lt; <span class="hljs-number">3000</span>) {
        <span class="hljs-keyword">continue</span>
    }
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'blocking loop ended at '</span> +<span class="hljs-title function_">sinceStart</span>())
    <span class="hljs-keyword">return</span> <span class="hljs-comment">// functions below</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">sinceStart</span> () {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>() - startTime
    } <span class="hljs-comment">// sinceStart</span>
} <span class="hljs-comment">// testSettimeout0</span>
</code></pre>

<p>Output is:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">setting timeout <span class="hljs-number">0</span> callback at <span class="hljs-number">0</span>
starting blocking loop at <span class="hljs-number">5</span>
blocking loop ended at <span class="hljs-number">3000</span>
<span class="hljs-keyword">in</span> timeout callback at <span class="hljs-number">3033</span>
</code></pre>
    </div></div></div></div><div id="solution7" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 7</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>One reason to do that is to defer the execution of code to a separate, subsequent event loop. When responding to a browser event of some kind (mouse click, for example), sometimes it's necessary to perform operations only <em>after</em> the current event is processed. The <code>setTimeout()</code> facility is the simplest way to do it.</p>

<p><em>edit</em> now that it's 2015 I should note that there's also <code>requestAnimationFrame()</code>, which isn't exactly the same but it's sufficiently close to <code>setTimeout(fn, 0)</code> that it's worth mentioning.</p>
    </div></div></div></div><div id="solution8" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 8</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Both of these two top-rated answers are wrong. <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop" rel="noreferrer">Check out the MDN description on the concurrency model and the event loop</a>, and it should become clear what's going on (that MDN resource is a real gem). And <strong>simply using</strong> <code>setTimeout</code> can be adding unexpected problems in your code in addition to "solving" this little problem.</p>

<p>What's <strong>actually</strong> going on here is not that "the browser might not be quite ready yet because concurrency," or something based on "each line is an event that gets added to the back of the queue".</p>

<p>The <a href="http://jsfiddle.net/C2YBE/31/" rel="noreferrer">jsfiddle</a> provided by DVK indeed illustrates a problem, but his explanation for it isn't correct.</p>

<p>What's happening in his code is that he's first attaching an event handler to the <code>click</code> event on the <code>#do</code> button.</p>

<p>Then, when you actually click the button, a <code>message</code> is created referencing the event handler function, which gets added to the <code>message queue</code>. When the <code>event loop</code> reaches this message, it creates a <code>frame</code> on the stack, with the function call to the click event handler in the jsfiddle.</p>

<p>And this is where it gets interesting. We're so used to thinking of Javascript as being asynchronous that we're prone to overlook this tiny fact: <strong>Any frame has to be executed, in full, before the next frame can be executed</strong>. No concurrency, people. </p>

<p>What does this mean? It means that whenever a function is invoked from the message queue, it blocks the queue until the stack it generates has been emptied. Or, in more general terms, it blocks until the function has returned. And it blocks <strong>everything</strong>, including DOM rendering operations, scrolling, and whatnot. If you want confirmation, just try to increase the duration of the long running operation in the fiddle (e.g. run the outer loop 10 more times), and you'll notice that while it runs, you cannot scroll the page. If it runs long enough, your browser will ask you if you want to kill the process, because it's making the page unresponsive. The frame is being executed, and the event loop and message queue are stuck until it finishes.</p>

<p>So why this side-effect of the text not updating? Because while you <strong>have</strong> changed the value of the element in the DOM  you can <code>console.log()</code> its value immediately after changing it and see that it <strong>has</strong> been changed (which shows why DVK's explanation isn't correct)  the browser is waiting for the stack to deplete (the <code>on</code> handler function to return) and thus the message to finish, so that it can eventually get around to executing the message that has been added by the runtime as a reaction to our mutation operation, and in order to reflect that mutation in the UI.</p>

<p>This is because we are actually waiting for code to finish running. We haven't said "someone fetch this and then call this function with the results, thanks, and now I'm done so imma return, do whatever now," like we usually do with our event-based asynchronous Javascript. We enter a click event handler function, we update a DOM element, we call another function, the other function works for a long time and then returns, we then update the same DOM element, and <strong>then</strong> we return from the initial function, effectively emptying the stack. And <strong>then</strong> the browser can get to the next message in the queue, which might very well be a message generated by us by triggering some internal "on-DOM-mutation" type event.</p>

<p>The browser UI cannot (or chooses not to) update the UI until the currently executing frame has completed (the function has returned). Personally, I think this is rather by design than restriction.</p>

<p>Why does the <code>setTimeout</code> thing work then? It does so, because it effectively removes the call to the long-running function from its own frame, scheduling it to be executed later in the <code>window</code> context, so that it itself can <strong>return immediately</strong> and allow the message queue to process other messages. And the idea is that the UI "on update" message that has been triggered by us in Javascript when changing the text in the DOM is now ahead of the message queued for the long-running function, so that the UI update happens before we block for a long time.</p>

<p>Note that a) The long-running function <strong>still blocks</strong> everything when it runs, and b) you're not guaranteed that the UI update is actually ahead of it in the message queue. On my June 2018 Chrome browser, a value of <code>0</code> does not "fix" the problem the fiddle demonstrates  10 does. I'm actually a bit stifled by this, because it seems logical to me that the UI update message should be queued up before it, since its trigger is executed before scheduling the long-running function to be run "later". But perhaps there're some optimisations in the V8 engine that may interfere, or maybe my understanding is just lacking.</p>

<p>Okay, so what's the problem with using <code>setTimeout</code>, and what's a better solution for this particular case?</p>

<p>First off, the problem with using <code>setTimeout</code> on any event handler like this, to try to alleviate another problem, is prone to mess with other code. Here's a real-life example from my work:</p>

<p>A colleague, in a mis-informed understanding on the event loop, tried to "thread" Javascript by having some template rendering code use <code>setTimeout 0</code> for its rendering. He's no longer here to ask, but I can presume that perhaps he inserted timers to gauge the rendering speed (which would be the return immediacy of functions) and found that using this approach would make for blisteringly fast responses from that function.</p>

<p>First problem is obvious; you cannot thread javascript, so you win nothing here while you add obfuscation. Secondly, you have now effectively detached the rendering of a template from the stack of possible event listeners that might expect that very template to have been rendered, while it may very well not have been. The actual behaviour of that function was now non-deterministic, as was  unknowingly so  any function that would run it, or depend on it. You can make educated guesses, but you cannot properly code for its behaviour.</p>

<p>The "fix" when writing a new event handler that depended on its logic was to <strong>also</strong> use <code>setTimeout 0</code>. But, that's not a fix, it is hard to understand, and it is no fun to debug errors that are caused by code like this. Sometimes there's no problem ever, other times it concistently fails, and then again, sometimes it works and breaks sporadically, depending on the current performance of the platform and whatever else happens to going on at the time. This is why I personally would advise against using this hack (it <strong>is</strong> a hack, and we should all know that it is), unless you really know what you're doing and what the consequences are.</p>

<p>But what <strong>can</strong> we do instead? Well, as the referenced MDN article suggests, either split the work into multiple messages (if you can) so that other messages that are queued up may be interleaved with your work and executed while it runs, or use a web worker, which can run in tandem with your page and return results when done with its calculations.</p>

<p>Oh, and if you're thinking, "Well, couldn't I just put a callback in the long-running function to make it asynchronous?," then no. The callback doesn't make it asynchronous, it'll still have to run the long-running code before explicitly calling your callback.</p>
    </div></div></div></div><div id="solution9" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 9</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>This is an old questions with old answers. I wanted to add a new look at this problem and to answer why is this happens and not why is this useful.</p>

<p>So you have two functions:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">var</span> f1 = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {    
   <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"f1"</span>, <span class="hljs-string">"First function call..."</span>);
   }, <span class="hljs-number">0</span>);
};

<span class="hljs-keyword">var</span> f2 = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"f2"</span>, <span class="hljs-string">"Second call..."</span>);
};
</code></pre>

<p>and then call them in the following order <code>f1(); f2();</code> just to see that the second one executed first. </p>

<p>And here is why: it is not possible to have <code>setTimeout</code> with a time delay of 0 milliseconds. The <strong>Minimum value is determined by the browser</strong> and it is not 0 milliseconds. <a href="https://developer.mozilla.org/en-US/docs/Web/API/window.setTimeout?redirectlocale=en-US&amp;redirectslug=DOM/window.setTimeout#Minimum.2F_maximum_delay_and_timeout_nesting">Historically</a> browsers sets this minimum to 10 milliseconds, but the <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#timers">HTML5 specs</a> and modern browsers have it set at 4 milliseconds. </p>

<blockquote>
  <p>If nesting level is greater than 5, and timeout is less than 4, then
  increase timeout to 4.</p>
</blockquote>

<p>Also from mozilla:</p>

<blockquote>
  <p>To implement a 0 ms timeout in a modern browser, you can use
  window.postMessage() as described <a href="http://dbaron.org/log/20100309-faster-timeouts">here</a>.</p>
</blockquote>

<p>P.S. information is taken after reading the following <a href="http://geekabyte.blogspot.com/2014/01/javascript-effect-of-setting-settimeout.html">article</a>.</p>
    </div></div></div></div><div id="solution10" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 10</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If you don't want to watch <a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ" rel="noreferrer">a whole video</a>, here's a simple explanation of the things one needs to understand, in order to be able to understand the answer to this question:</p>
<ol>
<li><strong>JavaScript is single-threaded</strong> meaning it does only one thing at a time when running.</li>
<li><strong>But the environments in which the JavaScript is running, can be multi-threaded.</strong> E.g., browsers are often multi-threaded creatures, i.e., are able to do multiple things at a time. So they can run JavaScript and at the same time keep track of dealing with other stuff too.</li>
</ol>
<p>From this point on, we're talking about JavaScript "in browsers". Things like <code>setTimeout</code> are indeed browser things, and are not part of the JavaScript itself.</p>
<ol start="3">
<li><strong>The thing that allows JavaScript to run asynchronously is the multi-threaded browser!</strong> Other than the main space Javascript uses (called the <em>the call stack</em>) to put each line of code on and run them one by one, browsers also provide JavaScript with another space to put things on.</li>
</ol>
<p>Now let's call that other space <strong>the second space</strong>.</p>
<ol start="4">
<li>Let's assume <code>fn</code> is a function. <strong>The important thing to understand here is that <code>fn();</code> call is not equal to the <code>setTimeout(fn, 0);</code> call</strong> as will be explained further below.</li>
</ol>
<p>Instead of a <code>0</code> delay, let's assume another delay first, e.g., 5000 milliseconds: <code>setTimeout(fn, 5000);</code>. It's important to note that this is still a "function call", so it has to be put on the main space, and removed from it when it's done, but wait!, we don't like a whole lengthy and boring 5 seconds delay. That would block the main space and will not allow JavaScript to run ANYTHING else in the meantime.</p>
<p>Thankfully this is not how the browser designers designed them to work. <strong>Instead, this call(<code>setTimeout(fn, 5000);</code>) is done <em>instantly</em>. This is very important: Even with the 5000 milliseconds delay, this function call is complete in an instant!</strong> What will happen next? It gets removed from the main space. Where will it be put on? (because we don't want to lose it). You might have guessed right: <strong>The browser <em>hears</em> this call and puts it on the second space.</strong>
<a href="https://i.stack.imgur.com/ZBd8y.png" rel="noreferrer"><img src="https://i.stack.imgur.com/ZBd8y.png" alt="enter image description here"></a></p>
<p>The browser keeps track of the 5 seconds delay <strong>and once it's passed, it looks at the main space, and "WHEN IT'S EMPTY", puts the <code>fn();</code> call back on it</strong>. That is how the <code>setTimeout</code> works.</p>
<p>So, back to the <code>setTimeout(fn, 0)</code>, even though the delay is zero, this is still a call to the browser, and the browser hears it instantly and picks it up, and puts it on the second space and puts it back on the main space <strong>only when the main space is empty again, and not really 0 milliseconds later</strong>.</p>
<p>I really recommend watching that video as well since he's explained it really well, and opens technical things up more.</p>
    </div></div></div></div><div id="solution11" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 11</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Since it is being passed a duration of <code>0</code>, I suppose it is in order to remove the code passed to the <code>setTimeout</code> from the flow of execution. So if it's a function that could take a while, it won't prevent the subsequent code from executing.</p>
    </div></div></div></div><div id="solution12" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 12</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The other thing this does is push the function invocation to the bottom of the stack, preventing a stack overflow if you are recursively calling a function. This has the effect of a <code>while</code> loop but lets the JavaScript engine fire other asynchronous timers.</p>
    </div></div></div></div><div id="solution13" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 13</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>By calling setTimeout you give the page time to react to the whatever the user is doing. This is particularly helpful for functions run during page load. </p>
    </div></div></div></div><div id="solution14" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 14</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Some other cases where setTimeout is useful:</p>

<p>You want to break a long-running loop or calculation into smaller components so that the browser doesn't appear to 'freeze' or say "Script on page is busy".</p>

<p>You want to disable a form submit button when clicked, but if you disable the button in the onClick handler the form will not be submitted. setTimeout with a time of zero does the trick, allowing the event to end, the form to begin submitting, then your button can be disabled.</p>
    </div></div></div></div><div id="solution15" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 15</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The problem was you were trying to perform a Javascript operation on a non existing element. The element was yet to be loaded and <code>setTimeout()</code> gives more time for an element to load in the following ways:</p>

<ol>
<li><code>setTimeout()</code> causes the event to be <strong>ansynchronous</strong> therefore being executed after all the synchronous code, giving your element more time to load. Asynchronous callbacks like the callback in <code>setTimeout()</code> are placed in the <strong>event queue</strong> and put on the stack by the <strong>event loop</strong> after the stack of synchronous code is empty. </li>
<li>The value 0 for ms as a second argument in function <code>setTimeout()</code> is often slightly higher (4-10ms depending on browser). This slightly higher time needed for executing the <code>setTimeout()</code> callbacks is caused by the amount of 'ticks' (where a tick is pushing a callback on the stack if stack is empty) of the event loop. Because of performance and battery life reasons the amount of ticks in the event loop are restricted to a certain amount <strong>less</strong> than 1000 times per second.</li>
</ol>
    </div></div></div></div><div id="solution16" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 16</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The answers about execution loops and rendering the DOM before some other code completes are correct. Zero second timeouts in JavaScript help make the code pseudo-multithreaded, even though it is not.</p>

<p>I want to add that the BEST value for a cross browser / cross platform zero-second timeout in JavaScript is actually about 20 milliseconds instead of 0 (zero), because many mobile browsers can't register timeouts smaller than 20 milliseconds due to clock limitations on AMD chips.</p>

<p>Also, long-running processes that do not involve DOM manipulation should be sent to Web Workers now, as they provide true multithreaded execution of JavaScript.</p>
    </div></div></div></div><div id="solution17" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 17</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>setTimout on 0 is also very useful in the pattern of setting up a deferred promise, which you want to return right away:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">myObject.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">myMethodDeferred</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">var</span> deferredObject = $.<span class="hljs-title class_">Deferred</span>();
    <span class="hljs-keyword">var</span> that = <span class="hljs-variable language_">this</span>;  <span class="hljs-comment">// Because setTimeout won't work right with this</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) { 
        <span class="hljs-keyword">return</span> myMethodActualWork.<span class="hljs-title function_">call</span>(that, deferredObject);
    }, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span> deferredObject.<span class="hljs-title function_">promise</span>();
}
</code></pre>
    </div></div></div></div><div id="solution18" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 18</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p></p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
<div class="snippet-code">
<pre class="snippet-code-js lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">//When need "new a", setTimeout(fn, 0) is useful, when need to wait some action. Example:</span>

<span class="hljs-keyword">var</span> a = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>){<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'a'</span>);};
<span class="hljs-keyword">var</span> b = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-built_in">setTimeout</span>(b, <span class="hljs-number">100</span>);}; <span class="hljs-comment">//wait some action before override this function</span>

<span class="hljs-comment">//without setTimeout:</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'no setTimeout: b.toString():'</span>, b.<span class="hljs-title function_">toString</span>());
<span class="hljs-title function_">b</span>();    <span class="hljs-comment">//"b" is an old function</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'no setTieout: a.toString(): '</span>, a.<span class="hljs-title function_">toString</span>());
<span class="hljs-title function_">a</span>();    <span class="hljs-comment">//and "a" is not overrided</span>

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-comment">//but with setTimeout(fn, 0):</span>
    <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'After timeout 0, b.toString(): '</span>, b.<span class="hljs-title function_">toString</span>());
        <span class="hljs-title function_">b</span>();    <span class="hljs-comment">//"b" is a new function</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'After timeout 0, a.toString(): '</span>, a.<span class="hljs-title function_">toString</span>());
        <span class="hljs-title function_">a</span>();    <span class="hljs-comment">//and "a" is overrided</span>
    },
    <span class="hljs-number">0</span>
);

<span class="hljs-comment">//override var "b", which was been undefined</span>
b = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>){
    a = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>){<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'new a'</span>);};
}</code></pre>
<div class="snippet-result"><div class="snippet-ctas"><button type="button" class="s-btn s-btn__primary"><span class="icon-play-white _hover"></span><span> Run code snippet</span></button><input class="copySnippet s-btn s-btn__filled" type="button" value="Copy snippet to answer" style="display: none;"><button type="button" class="s-btn hideResults" style="display: none;">Hide results</button><div class="popout-code"><a class="snippet-expand-link">Expand snippet</a></div></div><div class="snippet-result-code" style="display: none;"><iframe name="sif1" sandbox="allow-forms allow-modals allow-scripts" class="snippet-box-edit snippet-box-result" frameborder="0"></iframe></div></div></div>
</div>
<p></p>
    </div></div></div></div><div id="solution19" class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl solution-inner border md:px-10 md:py-10 px-2 py-10 shadow-md bg-white"><div style="display:flex;justify-content:space-between"><h4 class="text-4xl font-semibold mb-5">Solution 19</h4><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/event-loop">event-loop</a></div></div></div><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Javascript is single threaded application so that don't allow to run function concurrently so to achieve this event loops are use. So exactly what setTimeout(fn, 0) do that its pussed into task quest which is executed when your call stack is empty. I know this explanation is pretty boring, so i recommend you to go through this video this will help you how things work under the hood in browser.
Check out this video:- <a href="https://www.youtube.com/watch?time_continue=392&amp;v=8aGhZQkoFbQ" rel="nofollow noreferrer">https://www.youtube.com/watch?time_continue=392&amp;v=8aGhZQkoFbQ</a></p>
    </div></div></div></div></div></div><div class="widget"><a href="/questions/how-do-i-create-variable-variables-1657384387679">How do I create variable variables?</a><a href="/questions/why-shouldn&#x27;t-i-use-mysql_*-functions-in-php-1657384260352">Why shouldn&#x27;t I use mysql_* functions in PHP?</a><a href="/questions/can-php-pdo-statements-accept-the-table-or-column-name-as-parameter-1657387478588">Can PHP PDO Statements accept the table or column name as parameter?</a><a href="/questions/learning-regular-expressions-closed-1657384719460">Learning Regular Expressions [closed]</a><a href="/questions/what-is-the-explicit-promise-construction-antipattern-and-how-do-i-avoid-it-1657384436212">What is the explicit promise construction antipattern and how do I avoid it?</a><a href="/questions/c++-singleton-design-pattern-1657387830040">C++ Singleton design pattern</a><a href="/questions/what-is-the-difference-between-public-protected-package-private-and-private-in-java-1657387376262">What is the difference between public, protected, package-private and private in Java?</a><a href="/questions/deserialize-json-into-c-dynamic-object-1657388568720">Deserialize JSON into C# dynamic object?</a><a href="/questions/how-does-the-java-&#x27;for-each&#x27;-loop-work-1657388423749">How does the Java &#x27;for each&#x27; loop work?</a><a href="/questions/how-do-i-make-git-forget-about-a-file-that-was-tracked-but-is-now-in-.gitignore-1657387328843">How do I make Git forget about a file that was tracked, but is now in .gitignore?</a><a href="/questions/how-to-determine-equality-for-two-javascript-objects-1657387638650">How to determine equality for two JavaScript objects?</a><a href="/questions/what-are-the-nuances-of-scope-prototypal-prototypical-inheritance-in-angularjs-1657387340067">What are the nuances of scope prototypal / prototypical inheritance in AngularJS?</a><a href="/questions/what-is-a-raw-type-and-why-shouldn&#x27;t-we-use-it-1657384481079">What is a raw type and why shouldn&#x27;t we use it?</a><a href="/questions/is-an-array-name-a-pointer-1657387874827">Is an array name a pointer?</a><a href="/questions/how-do-i-format-a-date-in-javascript-1657384649498">How do I format a date in JavaScript?</a><a href="/questions/percentage-height-html-5css-1657387471048">Percentage Height HTML 5/CSS</a><a href="/questions/how-can-i-vertically-center-a-div-element-for-all-browsers-using-css-1657385488425">How can I vertically center a div element for all browsers using CSS?</a><a href="/questions/how-can-i-access-an-arrayobject-1657387395541">How can I access an array/object?</a><a href="/questions/how-can-i-validate-an-email-address-in-javascript-1657385475959">How can I validate an email address in JavaScript?</a><a href="/questions/prototypical-inheritance-writing-up-duplicate-1657385478064">Prototypical inheritance - writing up [duplicate]</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;In the question, there existed a \u0026lt;a href=\u0026quot;https://en.wikipedia.org/wiki/Race_condition\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;race condition\u0026lt;/a\u0026gt; between:\u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;The browser\u0026apos;s attempt to initialize the drop-down list, ready to have its selected index updated, and\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Your code to set the selected index\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;p\u0026gt;Your code was consistently winning this race and attempting to set drop-down selection before the browser was ready, meaning that the bug would appear.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This race existed because JavaScript has a \u0026lt;a href=\u0026quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;single thread of execution\u0026lt;/a\u0026gt; that is shared with page rendering. In effect, running JavaScript blocks the updating of the DOM.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Your workaround was:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(callback, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Invoking \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt; with a callback, and zero as the second argument will schedule the callback to be run \u0026lt;strong\u0026gt;asynchronously\u0026lt;/strong\u0026gt;, after the shortest possible delay - which will be around 10ms when the tab has focus and the JavaScript thread of execution is not busy.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The OP\u0026apos;s solution, therefore was to delay by about 10ms, the setting of the selected index. This gave the browser an opportunity to initialize the DOM, fixing the bug.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Every version of Internet Explorer exhibited quirky behaviors and this kind of workaround was necessary at times. Alternatively it might have been a genuine bug in the OP\u0026apos;s codebase. \u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;See Philip Roberts talk \u0026lt;a href=\u0026quot;https://www.youtube.com/watch?v=8aGhZQkoFbQ\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026quot;What the heck is the event loop?\u0026quot;\u0026lt;/a\u0026gt; for more thorough explanation.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;em\u0026gt;Preface:\u0026lt;/em\u0026gt;\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Some of the other answers are correct but don\u0026apos;t actually illustrate what the problem being solved is, so I created this answer to present that detailed illustration.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;As such, I am posting a \u0026lt;strong\u0026gt;detailed walk-through of what the browser does and how using \u0026lt;code\u0026gt;setTimeout()\u0026lt;/code\u0026gt; helps\u0026lt;/strong\u0026gt;. It looks longish but is actually very simple and straightforward - I just made it very detailed. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;UPDATE:\u0026lt;/strong\u0026gt; I have made a JSFiddle to live-demonstrate the explanation below: \u0026lt;a href=\u0026quot;http://jsfiddle.net/C2YBE/31/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;http://jsfiddle.net/C2YBE/31/\u0026lt;/a\u0026gt; . Many \u0026lt;strong\u0026gt;thanks\u0026lt;/strong\u0026gt; to @ThangChung for helping to kickstart it.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;UPDATE2:\u0026lt;/strong\u0026gt; Just in case JSFiddle web site dies, or deletes the code, I added the code to this answer at the very end.\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;DETAILS\u0026lt;/strong\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Imagine a web app with a \u0026quot;do something\u0026quot; button and a result div.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The \u0026lt;code\u0026gt;onClick\u0026lt;/code\u0026gt; handler for \u0026quot;do something\u0026quot; button calls a function \u0026quot;LongCalc()\u0026quot;, which does 2 things:\u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Makes a very long calculation (say takes 3 min)\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Prints the results of calculation into the result div.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;p\u0026gt;Now, your users start testing this, click \u0026quot;do something\u0026quot; button, and the page sits there doing seemingly nothing for 3 minutes, they get restless, click the button again, wait 1 min, nothing happens, click button again... \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The problem is obvious - you want a \u0026quot;Status\u0026quot; DIV, which shows what\u0026apos;s going on. Let\u0026apos;s see how that works.\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;So you add a \u0026quot;Status\u0026quot; DIV (initially empty), and modify the \u0026lt;code\u0026gt;onclick\u0026lt;/code\u0026gt; handler (function \u0026lt;code\u0026gt;LongCalc()\u0026lt;/code\u0026gt;) to do 4 things:\u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Populate the status \u0026quot;Calculating... may take ~3 minutes\u0026quot; into status DIV\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Makes a very long calculation (say takes 3 min)\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Prints the results of calculation into the result div.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Populate the status \u0026quot;Calculation done\u0026quot; into status DIV\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;p\u0026gt;And, you happily give the app to users to re-test.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;They come back to you looking very angry. And explain that when they clicked the button, \u0026lt;strong\u0026gt;the Status DIV never got updated with \u0026quot;Calculating...\u0026quot; status!!!\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;You scratch your head, ask around on StackOverflow (or read docs or google), and realize the problem:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The browser places all its \u0026quot;TODO\u0026quot; tasks (both UI tasks and JavaScript commands) resulting from events into a \u0026lt;strong\u0026gt;single queue\u0026lt;/strong\u0026gt;. And unfortunately, re-drawing the \u0026quot;Status\u0026quot; DIV with the new \u0026quot;Calculating...\u0026quot; value is a separate TODO which goes to the end of the queue!\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Here\u0026apos;s a breakdown of the events during your user\u0026apos;s test, contents of the queue after each event:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Queue: \u0026lt;code\u0026gt;[Empty]\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: Click the button. Queue after event: \u0026lt;code\u0026gt;[Execute OnClick handler(lines 1-4)]\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: Execute first line in OnClick handler (e.g. change Status DIV value). Queue after event: \u0026lt;code\u0026gt;[Execute OnClick handler(lines 2-4), re-draw Status DIV with new \u0026quot;Calculating\u0026quot; value]\u0026lt;/code\u0026gt;. \u0026lt;strong\u0026gt;Please note that while the DOM changes happen instantaneously, to re-draw the corresponding DOM element you need a new event, triggered by the DOM change, that went at the end of the queue\u0026lt;/strong\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;strong\u0026gt;PROBLEM!!!\u0026lt;/strong\u0026gt; \u0026lt;strong\u0026gt;PROBLEM!!!\u0026lt;/strong\u0026gt; Details explained below.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: Execute second line in handler (calculation). Queue after: \u0026lt;code\u0026gt;[Execute OnClick handler(lines 3-4), re-draw Status DIV with \u0026quot;Calculating\u0026quot; value]\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: Execute 3rd line in handler (populate result DIV). Queue after: \u0026lt;code\u0026gt;[Execute OnClick handler(line 4), re-draw Status DIV with \u0026quot;Calculating\u0026quot; value, re-draw result DIV with result]\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: Execute 4th line in handler (populate status DIV with \u0026quot;DONE\u0026quot;). Queue: \u0026lt;code\u0026gt;[Execute OnClick handler, re-draw Status DIV with \u0026quot;Calculating\u0026quot; value, re-draw result DIV with result; re-draw Status DIV with \u0026quot;DONE\u0026quot; value]\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: execute implied \u0026lt;code\u0026gt;return\u0026lt;/code\u0026gt; from \u0026lt;code\u0026gt;onclick\u0026lt;/code\u0026gt; handler sub. We take the \u0026quot;Execute OnClick handler\u0026quot; off the queue and start executing next item on the queue.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;NOTE: Since we already finished the calculation, 3 minutes already passed for the user. \u0026lt;strong\u0026gt;The re-draw event didn\u0026apos;t happen yet!!!\u0026lt;/strong\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: re-draw Status DIV with \u0026quot;Calculating\u0026quot; value. We do the re-draw and take that off the queue.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: re-draw Result DIV with result value. We do the re-draw and take that off the queue.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: re-draw Status DIV with \u0026quot;Done\u0026quot; value. We do the re-draw and take that off the queue.\nSharp-eyed viewers might even notice \u0026quot;Status DIV with \u0026quot;Calculating\u0026quot; value flashing for fraction of a microsecond - \u0026lt;strong\u0026gt;AFTER THE CALCULATION FINISHED\u0026lt;/strong\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;So, the underlying problem is that the re-draw event for \u0026quot;Status\u0026quot; DIV is placed on the queue at the end, AFTER the \u0026quot;execute line 2\u0026quot; event which takes 3 minutes, so the actual re-draw doesn\u0026apos;t happen until AFTER the calculation is done.\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;To the rescue comes the \u0026lt;code\u0026gt;setTimeout()\u0026lt;/code\u0026gt;. How does it help? Because by calling long-executing code via \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt;, you actually create 2 events: \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt; execution itself, and (due to 0 timeout), separate queue entry for the code being executed.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;So, to fix your problem, you modify your \u0026lt;code\u0026gt;onClick\u0026lt;/code\u0026gt; handler to be TWO statements (in a new function or just a block within \u0026lt;code\u0026gt;onClick\u0026lt;/code\u0026gt;):\u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Populate the status \u0026quot;Calculating... may take ~3 minutes\u0026quot; into status DIV\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Execute \u0026lt;code\u0026gt;setTimeout()\u0026lt;/code\u0026gt; with 0 timeout and a call to \u0026lt;code\u0026gt;LongCalc()\u0026lt;/code\u0026gt; function\u0026lt;/strong\u0026gt;. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;LongCalc()\u0026lt;/code\u0026gt; function is almost the same as last time but obviously doesn\u0026apos;t have \u0026quot;Calculating...\u0026quot; status DIV update as first step; and instead starts the calculation right away.\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;p\u0026gt;So, what does the event sequence and the queue look like now?\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Queue: \u0026lt;code\u0026gt;[Empty]\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: Click the button. Queue after event: \u0026lt;code\u0026gt;[Execute OnClick handler(status update, setTimeout() call)]\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: Execute first line in OnClick handler (e.g. change Status DIV value). Queue after event: \u0026lt;code\u0026gt;[Execute OnClick handler(which is a setTimeout call), re-draw Status DIV with new \u0026quot;Calculating\u0026quot; value]\u0026lt;/code\u0026gt;. \u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: Execute second line in handler (setTimeout call). Queue after: \u0026lt;code\u0026gt;[re-draw Status DIV with \u0026quot;Calculating\u0026quot; value]\u0026lt;/code\u0026gt;. The queue has nothing new in it for 0 more seconds.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: Alarm from the timeout goes off, 0 seconds later. Queue after: \u0026lt;code\u0026gt;[re-draw Status DIV with \u0026quot;Calculating\u0026quot; value, execute LongCalc (lines 1-3)]\u0026lt;/code\u0026gt;. \u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Event: \u0026lt;strong\u0026gt;re-draw Status DIV with \u0026quot;Calculating\u0026quot; value\u0026lt;/strong\u0026gt;. Queue after: \u0026lt;code\u0026gt;[execute LongCalc (lines 1-3)]\u0026lt;/code\u0026gt;. Please note that this re-draw event might actually happen BEFORE the alarm goes off, which works just as well.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;...\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;Hooray! The Status DIV just got updated to \u0026quot;Calculating...\u0026quot; before the calculation started!!!\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;Below is the sample code from the JSFiddle illustrating these examples: \u0026lt;a href=\u0026quot;http://jsfiddle.net/C2YBE/31/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;http://jsfiddle.net/C2YBE/31/\u0026lt;/a\u0026gt; :\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;HTML code:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026amp;lt;table border=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\u0026amp;gt;\n    \u0026lt;span class=\u0026quot;language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;tr\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;td\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;button\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;do\u0026apos;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;Do long calc - bad status!\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;button\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;td\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;td\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;status\u0026apos;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;Not Calculating yet.\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;td\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;tr\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;language-xml\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;tr\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;td\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;button\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;do_ok\u0026apos;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;Do long calc - good status!\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;button\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;td\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;td\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;status_ok\u0026apos;\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;Not Calculating yet.\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;div\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;td\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-tag\u0026quot;\u0026gt;\u0026amp;lt;/\u0026lt;span class=\u0026quot;hljs-name\u0026quot;\u0026gt;tr\u0026lt;/span\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;\n\u0026amp;lt;/table\u0026amp;gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;JavaScript code: (Executed on \u0026lt;code\u0026gt;onDomReady\u0026lt;/code\u0026gt; and may require jQuery 1.9)\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;long_running\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;status_div\u0026lt;/span\u0026gt;) {\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; result = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Use 1000/700/300 limits in Chrome, \u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//    300/100/100 in IE8, \u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//    1000/500/200 in FireFox\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// I have no idea why identical runtimes fail on diff browsers.\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; i = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1000\u0026lt;/span\u0026gt;; i++) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; j = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; j \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;700\u0026lt;/span\u0026gt;; j++) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; k = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; k \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;300\u0026lt;/span\u0026gt;; k++) {\n                result = result + i + j + k;\n            }\n        }\n    }\n    $(status_div).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;text\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;calculation done\u0026apos;\u0026lt;/span\u0026gt;);\n}\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Assign events to buttons\u0026lt;/span\u0026gt;\n$(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;#do\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;on\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;click\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    $(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;#status\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;text\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;calculating....\u0026apos;\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;long_running\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;#status\u0026apos;\u0026lt;/span\u0026gt;);\n});\n\n$(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;#do_ok\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;on\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;click\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    $(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;#status_ok\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;text\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;calculating....\u0026apos;\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// This works on IE8. Works in Chrome\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Does NOT work in FireFox 25 with timeout =0 or =1\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// DOES work in FF if you change timeout from 0 to 500\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;window\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){ \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;long_running\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;#status_ok\u0026apos;\u0026lt;/span\u0026gt;) }, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;);\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Take a look at John Resig\u0026apos;s article about \u0026lt;a href=\u0026quot;http://ejohn.org/blog/how-javascript-timers-work/\u0026quot;\u0026gt;How JavaScript Timers Work\u0026lt;/a\u0026gt;. When you set a timeout, it actually queues the asynchronous code until the engine executes the current call stack.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;setTimeout()\u0026lt;/code\u0026gt; buys you some time until the DOM elements are loaded, even if is set to 0.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Check this out: \u0026lt;a href=\u0026quot;http://snook.ca/archives/javascript/settimeout_solve_domcontentloaded\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;setTimeout\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Browsers have a process called \u0026quot;main thread\u0026quot;, that is responsible for executing some JavaScript tasks, UI updates e.g.: painting, redraw, reflow, etc.\nJavaScript tasks are queued to a message queue and then are dispatched to the browser\u0026apos;s main thread to be executed.\nWhen UI updates are generated while the main thread is busy, tasks are added into the message queue.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;There are conflicting upvoted answers here, and without proof there is no way to know whom to believe. Here is proof that @DVK is right and @SalvadorDali is incorrect. The latter claims:\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;\u0026quot;And here is why: it is not possible to have setTimeout with a time\n  delay of 0 milliseconds. The Minimum value is determined by the\n  browser and it is not 0 milliseconds. Historically browsers sets this\n  minimum to 10 milliseconds, but the HTML5 specs and modern browsers\n  have it set at 4 milliseconds.\u0026quot;\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;The 4ms minimum timeout is irrelevant to what is happening. What really happens is that setTimeout pushes the callback function to the end of the execution queue. If after setTimeout(callback, 0) you have blocking code which takes several seconds to run, the callback will not be executed for several seconds, until the blocking code has finished. Try this code:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;testSettimeout0\u0026lt;/span\u0026gt; () {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; startTime = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Date\u0026lt;/span\u0026gt;().\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getTime\u0026lt;/span\u0026gt;()\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;setting timeout 0 callback at \u0026apos;\u0026lt;/span\u0026gt; +\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sinceStart\u0026lt;/span\u0026gt;())\n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;in timeout callback at \u0026apos;\u0026lt;/span\u0026gt; +\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sinceStart\u0026lt;/span\u0026gt;())\n    }, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;starting blocking loop at \u0026apos;\u0026lt;/span\u0026gt; +\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sinceStart\u0026lt;/span\u0026gt;())\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sinceStart\u0026lt;/span\u0026gt;() \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3000\u0026lt;/span\u0026gt;) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;continue\u0026lt;/span\u0026gt;\n    }\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;blocking loop ended at \u0026apos;\u0026lt;/span\u0026gt; +\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sinceStart\u0026lt;/span\u0026gt;())\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// functions below\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;sinceStart\u0026lt;/span\u0026gt; () {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Date\u0026lt;/span\u0026gt;().\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getTime\u0026lt;/span\u0026gt;() - startTime\n    } \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// sinceStart\u0026lt;/span\u0026gt;\n} \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// testSettimeout0\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Output is:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;setting timeout \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt; callback at \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\nstarting blocking loop at \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;\nblocking loop ended at \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3000\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; timeout callback at \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3033\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;One reason to do that is to defer the execution of code to a separate, subsequent event loop. When responding to a browser event of some kind (mouse click, for example), sometimes it\u0026apos;s necessary to perform operations only \u0026lt;em\u0026gt;after\u0026lt;/em\u0026gt; the current event is processed. The \u0026lt;code\u0026gt;setTimeout()\u0026lt;/code\u0026gt; facility is the simplest way to do it.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;edit\u0026lt;/em\u0026gt; now that it\u0026apos;s 2015 I should note that there\u0026apos;s also \u0026lt;code\u0026gt;requestAnimationFrame()\u0026lt;/code\u0026gt;, which isn\u0026apos;t exactly the same but it\u0026apos;s sufficiently close to \u0026lt;code\u0026gt;setTimeout(fn, 0)\u0026lt;/code\u0026gt; that it\u0026apos;s worth mentioning.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Both of these two top-rated answers are wrong. \u0026lt;a href=\u0026quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Check out the MDN description on the concurrency model and the event loop\u0026lt;/a\u0026gt;, and it should become clear what\u0026apos;s going on (that MDN resource is a real gem). And \u0026lt;strong\u0026gt;simply using\u0026lt;/strong\u0026gt; \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt; can be adding unexpected problems in your code in addition to \u0026quot;solving\u0026quot; this little problem.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;What\u0026apos;s \u0026lt;strong\u0026gt;actually\u0026lt;/strong\u0026gt; going on here is not that \u0026quot;the browser might not be quite ready yet because concurrency,\u0026quot; or something based on \u0026quot;each line is an event that gets added to the back of the queue\u0026quot;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The \u0026lt;a href=\u0026quot;http://jsfiddle.net/C2YBE/31/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;jsfiddle\u0026lt;/a\u0026gt; provided by DVK indeed illustrates a problem, but his explanation for it isn\u0026apos;t correct.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;What\u0026apos;s happening in his code is that he\u0026apos;s first attaching an event handler to the \u0026lt;code\u0026gt;click\u0026lt;/code\u0026gt; event on the \u0026lt;code\u0026gt;#do\u0026lt;/code\u0026gt; button.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Then, when you actually click the button, a \u0026lt;code\u0026gt;message\u0026lt;/code\u0026gt; is created referencing the event handler function, which gets added to the \u0026lt;code\u0026gt;message queue\u0026lt;/code\u0026gt;. When the \u0026lt;code\u0026gt;event loop\u0026lt;/code\u0026gt; reaches this message, it creates a \u0026lt;code\u0026gt;frame\u0026lt;/code\u0026gt; on the stack, with the function call to the click event handler in the jsfiddle.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;And this is where it gets interesting. We\u0026apos;re so used to thinking of Javascript as being asynchronous that we\u0026apos;re prone to overlook this tiny fact: \u0026lt;strong\u0026gt;Any frame has to be executed, in full, before the next frame can be executed\u0026lt;/strong\u0026gt;. No concurrency, people. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;What does this mean? It means that whenever a function is invoked from the message queue, it blocks the queue until the stack it generates has been emptied. Or, in more general terms, it blocks until the function has returned. And it blocks \u0026lt;strong\u0026gt;everything\u0026lt;/strong\u0026gt;, including DOM rendering operations, scrolling, and whatnot. If you want confirmation, just try to increase the duration of the long running operation in the fiddle (e.g. run the outer loop 10 more times), and you\u0026apos;ll notice that while it runs, you cannot scroll the page. If it runs long enough, your browser will ask you if you want to kill the process, because it\u0026apos;s making the page unresponsive. The frame is being executed, and the event loop and message queue are stuck until it finishes.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;So why this side-effect of the text not updating? Because while you \u0026lt;strong\u0026gt;have\u0026lt;/strong\u0026gt; changed the value of the element in the DOM  you can \u0026lt;code\u0026gt;console.log()\u0026lt;/code\u0026gt; its value immediately after changing it and see that it \u0026lt;strong\u0026gt;has\u0026lt;/strong\u0026gt; been changed (which shows why DVK\u0026apos;s explanation isn\u0026apos;t correct)  the browser is waiting for the stack to deplete (the \u0026lt;code\u0026gt;on\u0026lt;/code\u0026gt; handler function to return) and thus the message to finish, so that it can eventually get around to executing the message that has been added by the runtime as a reaction to our mutation operation, and in order to reflect that mutation in the UI.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This is because we are actually waiting for code to finish running. We haven\u0026apos;t said \u0026quot;someone fetch this and then call this function with the results, thanks, and now I\u0026apos;m done so imma return, do whatever now,\u0026quot; like we usually do with our event-based asynchronous Javascript. We enter a click event handler function, we update a DOM element, we call another function, the other function works for a long time and then returns, we then update the same DOM element, and \u0026lt;strong\u0026gt;then\u0026lt;/strong\u0026gt; we return from the initial function, effectively emptying the stack. And \u0026lt;strong\u0026gt;then\u0026lt;/strong\u0026gt; the browser can get to the next message in the queue, which might very well be a message generated by us by triggering some internal \u0026quot;on-DOM-mutation\u0026quot; type event.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The browser UI cannot (or chooses not to) update the UI until the currently executing frame has completed (the function has returned). Personally, I think this is rather by design than restriction.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Why does the \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt; thing work then? It does so, because it effectively removes the call to the long-running function from its own frame, scheduling it to be executed later in the \u0026lt;code\u0026gt;window\u0026lt;/code\u0026gt; context, so that it itself can \u0026lt;strong\u0026gt;return immediately\u0026lt;/strong\u0026gt; and allow the message queue to process other messages. And the idea is that the UI \u0026quot;on update\u0026quot; message that has been triggered by us in Javascript when changing the text in the DOM is now ahead of the message queued for the long-running function, so that the UI update happens before we block for a long time.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Note that a) The long-running function \u0026lt;strong\u0026gt;still blocks\u0026lt;/strong\u0026gt; everything when it runs, and b) you\u0026apos;re not guaranteed that the UI update is actually ahead of it in the message queue. On my June 2018 Chrome browser, a value of \u0026lt;code\u0026gt;0\u0026lt;/code\u0026gt; does not \u0026quot;fix\u0026quot; the problem the fiddle demonstrates  10 does. I\u0026apos;m actually a bit stifled by this, because it seems logical to me that the UI update message should be queued up before it, since its trigger is executed before scheduling the long-running function to be run \u0026quot;later\u0026quot;. But perhaps there\u0026apos;re some optimisations in the V8 engine that may interfere, or maybe my understanding is just lacking.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Okay, so what\u0026apos;s the problem with using \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt;, and what\u0026apos;s a better solution for this particular case?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;First off, the problem with using \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt; on any event handler like this, to try to alleviate another problem, is prone to mess with other code. Here\u0026apos;s a real-life example from my work:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;A colleague, in a mis-informed understanding on the event loop, tried to \u0026quot;thread\u0026quot; Javascript by having some template rendering code use \u0026lt;code\u0026gt;setTimeout 0\u0026lt;/code\u0026gt; for its rendering. He\u0026apos;s no longer here to ask, but I can presume that perhaps he inserted timers to gauge the rendering speed (which would be the return immediacy of functions) and found that using this approach would make for blisteringly fast responses from that function.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;First problem is obvious; you cannot thread javascript, so you win nothing here while you add obfuscation. Secondly, you have now effectively detached the rendering of a template from the stack of possible event listeners that might expect that very template to have been rendered, while it may very well not have been. The actual behaviour of that function was now non-deterministic, as was  unknowingly so  any function that would run it, or depend on it. You can make educated guesses, but you cannot properly code for its behaviour.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The \u0026quot;fix\u0026quot; when writing a new event handler that depended on its logic was to \u0026lt;strong\u0026gt;also\u0026lt;/strong\u0026gt; use \u0026lt;code\u0026gt;setTimeout 0\u0026lt;/code\u0026gt;. But, that\u0026apos;s not a fix, it is hard to understand, and it is no fun to debug errors that are caused by code like this. Sometimes there\u0026apos;s no problem ever, other times it concistently fails, and then again, sometimes it works and breaks sporadically, depending on the current performance of the platform and whatever else happens to going on at the time. This is why I personally would advise against using this hack (it \u0026lt;strong\u0026gt;is\u0026lt;/strong\u0026gt; a hack, and we should all know that it is), unless you really know what you\u0026apos;re doing and what the consequences are.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;But what \u0026lt;strong\u0026gt;can\u0026lt;/strong\u0026gt; we do instead? Well, as the referenced MDN article suggests, either split the work into multiple messages (if you can) so that other messages that are queued up may be interleaved with your work and executed while it runs, or use a web worker, which can run in tandem with your page and return results when done with its calculations.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Oh, and if you\u0026apos;re thinking, \u0026quot;Well, couldn\u0026apos;t I just put a callback in the long-running function to make it asynchronous?,\u0026quot; then no. The callback doesn\u0026apos;t make it asynchronous, it\u0026apos;ll still have to run the long-running code before explicitly calling your callback.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;This is an old questions with old answers. I wanted to add a new look at this problem and to answer why is this happens and not why is this useful.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;So you have two functions:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; f1 = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {    \n   \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n      \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;f1\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;First function call...\u0026quot;\u0026lt;/span\u0026gt;);\n   }, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;);\n};\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; f2 = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;f2\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Second call...\u0026quot;\u0026lt;/span\u0026gt;);\n};\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;and then call them in the following order \u0026lt;code\u0026gt;f1(); f2();\u0026lt;/code\u0026gt; just to see that the second one executed first. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;And here is why: it is not possible to have \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt; with a time delay of 0 milliseconds. The \u0026lt;strong\u0026gt;Minimum value is determined by the browser\u0026lt;/strong\u0026gt; and it is not 0 milliseconds. \u0026lt;a href=\u0026quot;https://developer.mozilla.org/en-US/docs/Web/API/window.setTimeout?redirectlocale=en-US\u0026amp;amp;redirectslug=DOM/window.setTimeout#Minimum.2F_maximum_delay_and_timeout_nesting\u0026quot;\u0026gt;Historically\u0026lt;/a\u0026gt; browsers sets this minimum to 10 milliseconds, but the \u0026lt;a href=\u0026quot;http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#timers\u0026quot;\u0026gt;HTML5 specs\u0026lt;/a\u0026gt; and modern browsers have it set at 4 milliseconds. \u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;If nesting level is greater than 5, and timeout is less than 4, then\n  increase timeout to 4.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;Also from mozilla:\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;To implement a 0 ms timeout in a modern browser, you can use\n  window.postMessage() as described \u0026lt;a href=\u0026quot;http://dbaron.org/log/20100309-faster-timeouts\u0026quot;\u0026gt;here\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;P.S. information is taken after reading the following \u0026lt;a href=\u0026quot;http://geekabyte.blogspot.com/2014/01/javascript-effect-of-setting-settimeout.html\u0026quot;\u0026gt;article\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;If you don\u0026apos;t want to watch \u0026lt;a href=\u0026quot;https://www.youtube.com/watch?v=8aGhZQkoFbQ\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;a whole video\u0026lt;/a\u0026gt;, here\u0026apos;s a simple explanation of the things one needs to understand, in order to be able to understand the answer to this question:\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;strong\u0026gt;JavaScript is single-threaded\u0026lt;/strong\u0026gt; meaning it does only one thing at a time when running.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;strong\u0026gt;But the environments in which the JavaScript is running, can be multi-threaded.\u0026lt;/strong\u0026gt; E.g., browsers are often multi-threaded creatures, i.e., are able to do multiple things at a time. So they can run JavaScript and at the same time keep track of dealing with other stuff too.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;From this point on, we\u0026apos;re talking about JavaScript \u0026quot;in browsers\u0026quot;. Things like \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt; are indeed browser things, and are not part of the JavaScript itself.\u0026lt;/p\u0026gt;\n\u0026lt;ol start=\u0026quot;3\u0026quot;\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;strong\u0026gt;The thing that allows JavaScript to run asynchronously is the multi-threaded browser!\u0026lt;/strong\u0026gt; Other than the main space Javascript uses (called the \u0026lt;em\u0026gt;the call stack\u0026lt;/em\u0026gt;) to put each line of code on and run them one by one, browsers also provide JavaScript with another space to put things on.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;Now let\u0026apos;s call that other space \u0026lt;strong\u0026gt;the second space\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;ol start=\u0026quot;4\u0026quot;\u0026gt;\n\u0026lt;li\u0026gt;Let\u0026apos;s assume \u0026lt;code\u0026gt;fn\u0026lt;/code\u0026gt; is a function. \u0026lt;strong\u0026gt;The important thing to understand here is that \u0026lt;code\u0026gt;fn();\u0026lt;/code\u0026gt; call is not equal to the \u0026lt;code\u0026gt;setTimeout(fn, 0);\u0026lt;/code\u0026gt; call\u0026lt;/strong\u0026gt; as will be explained further below.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;Instead of a \u0026lt;code\u0026gt;0\u0026lt;/code\u0026gt; delay, let\u0026apos;s assume another delay first, e.g., 5000 milliseconds: \u0026lt;code\u0026gt;setTimeout(fn, 5000);\u0026lt;/code\u0026gt;. It\u0026apos;s important to note that this is still a \u0026quot;function call\u0026quot;, so it has to be put on the main space, and removed from it when it\u0026apos;s done, but wait!, we don\u0026apos;t like a whole lengthy and boring 5 seconds delay. That would block the main space and will not allow JavaScript to run ANYTHING else in the meantime.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Thankfully this is not how the browser designers designed them to work. \u0026lt;strong\u0026gt;Instead, this call(\u0026lt;code\u0026gt;setTimeout(fn, 5000);\u0026lt;/code\u0026gt;) is done \u0026lt;em\u0026gt;instantly\u0026lt;/em\u0026gt;. This is very important: Even with the 5000 milliseconds delay, this function call is complete in an instant!\u0026lt;/strong\u0026gt; What will happen next? It gets removed from the main space. Where will it be put on? (because we don\u0026apos;t want to lose it). You might have guessed right: \u0026lt;strong\u0026gt;The browser \u0026lt;em\u0026gt;hears\u0026lt;/em\u0026gt; this call and puts it on the second space.\u0026lt;/strong\u0026gt;\n\u0026lt;a href=\u0026quot;https://i.stack.imgur.com/ZBd8y.png\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;https://i.stack.imgur.com/ZBd8y.png\u0026quot; alt=\u0026quot;enter image description here\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The browser keeps track of the 5 seconds delay \u0026lt;strong\u0026gt;and once it\u0026apos;s passed, it looks at the main space, and \u0026quot;WHEN IT\u0026apos;S EMPTY\u0026quot;, puts the \u0026lt;code\u0026gt;fn();\u0026lt;/code\u0026gt; call back on it\u0026lt;/strong\u0026gt;. That is how the \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt; works.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;So, back to the \u0026lt;code\u0026gt;setTimeout(fn, 0)\u0026lt;/code\u0026gt;, even though the delay is zero, this is still a call to the browser, and the browser hears it instantly and picks it up, and puts it on the second space and puts it back on the main space \u0026lt;strong\u0026gt;only when the main space is empty again, and not really 0 milliseconds later\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I really recommend watching that video as well since he\u0026apos;s explained it really well, and opens technical things up more.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Since it is being passed a duration of \u0026lt;code\u0026gt;0\u0026lt;/code\u0026gt;, I suppose it is in order to remove the code passed to the \u0026lt;code\u0026gt;setTimeout\u0026lt;/code\u0026gt; from the flow of execution. So if it\u0026apos;s a function that could take a while, it won\u0026apos;t prevent the subsequent code from executing.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The other thing this does is push the function invocation to the bottom of the stack, preventing a stack overflow if you are recursively calling a function. This has the effect of a \u0026lt;code\u0026gt;while\u0026lt;/code\u0026gt; loop but lets the JavaScript engine fire other asynchronous timers.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;By calling setTimeout you give the page time to react to the whatever the user is doing. This is particularly helpful for functions run during page load. \u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Some other cases where setTimeout is useful:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You want to break a long-running loop or calculation into smaller components so that the browser doesn\u0026apos;t appear to \u0026apos;freeze\u0026apos; or say \u0026quot;Script on page is busy\u0026quot;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You want to disable a form submit button when clicked, but if you disable the button in the onClick handler the form will not be submitted. setTimeout with a time of zero does the trick, allowing the event to end, the form to begin submitting, then your button can be disabled.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The problem was you were trying to perform a Javascript operation on a non existing element. The element was yet to be loaded and \u0026lt;code\u0026gt;setTimeout()\u0026lt;/code\u0026gt; gives more time for an element to load in the following ways:\u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;setTimeout()\u0026lt;/code\u0026gt; causes the event to be \u0026lt;strong\u0026gt;ansynchronous\u0026lt;/strong\u0026gt; therefore being executed after all the synchronous code, giving your element more time to load. Asynchronous callbacks like the callback in \u0026lt;code\u0026gt;setTimeout()\u0026lt;/code\u0026gt; are placed in the \u0026lt;strong\u0026gt;event queue\u0026lt;/strong\u0026gt; and put on the stack by the \u0026lt;strong\u0026gt;event loop\u0026lt;/strong\u0026gt; after the stack of synchronous code is empty. \u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;The value 0 for ms as a second argument in function \u0026lt;code\u0026gt;setTimeout()\u0026lt;/code\u0026gt; is often slightly higher (4-10ms depending on browser). This slightly higher time needed for executing the \u0026lt;code\u0026gt;setTimeout()\u0026lt;/code\u0026gt; callbacks is caused by the amount of \u0026apos;ticks\u0026apos; (where a tick is pushing a callback on the stack if stack is empty) of the event loop. Because of performance and battery life reasons the amount of ticks in the event loop are restricted to a certain amount \u0026lt;strong\u0026gt;less\u0026lt;/strong\u0026gt; than 1000 times per second.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The answers about execution loops and rendering the DOM before some other code completes are correct. Zero second timeouts in JavaScript help make the code pseudo-multithreaded, even though it is not.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I want to add that the BEST value for a cross browser / cross platform zero-second timeout in JavaScript is actually about 20 milliseconds instead of 0 (zero), because many mobile browsers can\u0026apos;t register timeouts smaller than 20 milliseconds due to clock limitations on AMD chips.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Also, long-running processes that do not involve DOM manipulation should be sent to Web Workers now, as they provide true multithreaded execution of JavaScript.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;setTimout on 0 is also very useful in the pattern of setting up a deferred promise, which you want to return right away:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;myObject.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prototype\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;myMethodDeferred\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; deferredObject = $.\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Deferred\u0026lt;/span\u0026gt;();\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; that = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;;  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Because setTimeout won\u0026apos;t work right with this\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) { \n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; myMethodActualWork.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;call\u0026lt;/span\u0026gt;(that, deferredObject);\n    }, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; deferredObject.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;promise\u0026lt;/span\u0026gt;();\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\u0026lt;div class=\u0026quot;snippet\u0026quot; data-lang=\u0026quot;js\u0026quot; data-hide=\u0026quot;false\u0026quot; data-console=\u0026quot;true\u0026quot; data-babel=\u0026quot;false\u0026quot;\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-code\u0026quot;\u0026gt;\n\u0026lt;pre class=\u0026quot;snippet-code-js lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//When need \u0026quot;new a\u0026quot;, setTimeout(fn, 0) is useful, when need to wait some action. Example:\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; a = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;a\u0026apos;\u0026lt;/span\u0026gt;);};\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; b = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(b, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;);}; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//wait some action before override this function\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//without setTimeout:\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;no setTimeout: b.toString():\u0026apos;\u0026lt;/span\u0026gt;, b.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;toString\u0026lt;/span\u0026gt;());\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;b\u0026lt;/span\u0026gt;();    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//\u0026quot;b\u0026quot; is an old function\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;no setTieout: a.toString(): \u0026apos;\u0026lt;/span\u0026gt;, a.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;toString\u0026lt;/span\u0026gt;());\n\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;a\u0026lt;/span\u0026gt;();    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//and \u0026quot;a\u0026quot; is not overrided\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//but with setTimeout(fn, 0):\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;After timeout 0, b.toString(): \u0026apos;\u0026lt;/span\u0026gt;, b.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;toString\u0026lt;/span\u0026gt;());\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;b\u0026lt;/span\u0026gt;();    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//\u0026quot;b\u0026quot; is a new function\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;After timeout 0, a.toString(): \u0026apos;\u0026lt;/span\u0026gt;, a.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;toString\u0026lt;/span\u0026gt;());\n        \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;a\u0026lt;/span\u0026gt;();    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//and \u0026quot;a\u0026quot; is overrided\u0026lt;/span\u0026gt;\n    },\n    \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n);\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//override var \u0026quot;b\u0026quot;, which was been undefined\u0026lt;/span\u0026gt;\nb = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\n    a = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;){\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;new a\u0026apos;\u0026lt;/span\u0026gt;);};\n}\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;div class=\u0026quot;snippet-result\u0026quot;\u0026gt;\u0026lt;div class=\u0026quot;snippet-ctas\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn s-btn__primary\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;icon-play-white _hover\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;span\u0026gt; Run code snippet\u0026lt;/span\u0026gt;\u0026lt;/button\u0026gt;\u0026lt;input class=\u0026quot;copySnippet s-btn s-btn__filled\u0026quot; type=\u0026quot;button\u0026quot; value=\u0026quot;Copy snippet to answer\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;button type=\u0026quot;button\u0026quot; class=\u0026quot;s-btn hideResults\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;Hide results\u0026lt;/button\u0026gt;\u0026lt;div class=\u0026quot;popout-code\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;snippet-expand-link\u0026quot;\u0026gt;Expand snippet\u0026lt;/a\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;div class=\u0026quot;snippet-result-code\u0026quot; style=\u0026quot;display: none;\u0026quot;\u0026gt;\u0026lt;iframe name=\u0026quot;sif1\u0026quot; sandbox=\u0026quot;allow-forms allow-modals allow-scripts\u0026quot; class=\u0026quot;snippet-box-edit snippet-box-result\u0026quot; frameborder=\u0026quot;0\u0026quot;\u0026gt;\u0026lt;/iframe\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\u0026lt;/div\u0026gt;\n\u0026lt;/div\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Javascript is single threaded application so that don\u0026apos;t allow to run function concurrently so to achieve this event loops are use. So exactly what setTimeout(fn, 0) do that its pussed into task quest which is executed when your call stack is empty. I know this explanation is pretty boring, so i recommend you to go through this video this will help you how things work under the hood in browser.\nCheck out this video:- \u0026lt;a href=\u0026quot;https://www.youtube.com/watch?time_continue=392\u0026amp;amp;v=8aGhZQkoFbQ\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;https://www.youtube.com/watch?time_continue=392\u0026amp;amp;v=8aGhZQkoFbQ\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    "],"id":546,"title":"Why is setTimeout(fn, 0) sometimes useful?","content":"\n                \n\u0026lt;p\u0026gt;I\u0026apos;ve recently run into a rather nasty bug, wherein the code was loading a \u0026lt;code\u0026gt;\u0026amp;lt;select\u0026amp;gt;\u0026lt;/code\u0026gt; dynamically via JavaScript.  This dynamically loaded \u0026lt;code\u0026gt;\u0026amp;lt;select\u0026amp;gt;\u0026lt;/code\u0026gt; had a pre-selected value.  In IE6, we already had code to fix the selected \u0026lt;code\u0026gt;\u0026amp;lt;option\u0026amp;gt;\u0026lt;/code\u0026gt;, because sometimes the \u0026lt;code\u0026gt;\u0026amp;lt;select\u0026amp;gt;\u0026lt;/code\u0026gt;\u0026apos;s \u0026lt;code\u0026gt;selectedIndex\u0026lt;/code\u0026gt; value would be out of sync with the selected \u0026lt;code\u0026gt;\u0026amp;lt;option\u0026amp;gt;\u0026lt;/code\u0026gt;\u0026apos;s \u0026lt;code\u0026gt;index\u0026lt;/code\u0026gt; attribute, as below:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;field.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;selectedIndex\u0026lt;/span\u0026gt; = element.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;index\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;However, this code wasn\u0026apos;t working.  Even though the field\u0026apos;s \u0026lt;code\u0026gt;selectedIndex\u0026lt;/code\u0026gt; was being set correctly, the wrong index would end up being selected.  However, if I stuck an \u0026lt;code\u0026gt;alert()\u0026lt;/code\u0026gt; statement in at the right time, the correct option would be selected.  Thinking this might be some sort of timing issue, I tried something random that I\u0026apos;d seen in code before:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; wrapFn = (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; myField = field;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; myElement = element;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n        myField.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;selectedIndex\u0026lt;/span\u0026gt; = myElement.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;index\u0026lt;/span\u0026gt;;\n    }\n})();\n\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;setTimeout\u0026lt;/span\u0026gt;(wrapFn, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;And this worked!\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I\u0026apos;ve got a solution for my problem, but I\u0026apos;m uneasy that I don\u0026apos;t know exactly why this fixes my problem.  Does anyone have an official explanation?  What browser issue am I avoiding by calling my function \u0026quot;later\u0026quot; using \u0026lt;code\u0026gt;setTimeout()\u0026lt;/code\u0026gt;?\u0026lt;/p\u0026gt;\n    ","slug":"why-is-settimeout(fn-0)-sometimes-useful-1657388379869","postType":"QUESTION","createdAt":"2022-07-09T17:39:39.000Z","updatedAt":"2022-07-09T17:39:39.000Z","tags":[{"id":2660,"name":"event-loop","slug":"event-loop","createdAt":"2022-07-09T17:39:39.000Z","updatedAt":"2022-07-09T17:39:39.000Z","Questions_Tags":{"questionId":546,"tagId":2660}}],"relatedQuestions":[{"title":"Why is setTimeout(fn, 0) sometimes useful?","slug":"why-is-settimeout(fn-0)-sometimes-useful-1657388379869","tags":[{"name":"event-loop","Questions_Tags":{"questionId":546,"tagId":2660}}]}]},"randomQuestions":[{"title":"How do I create variable variables?","slug":"how-do-i-create-variable-variables-1657384387679"},{"title":"Why shouldn't I use mysql_* functions in PHP?","slug":"why-shouldn't-i-use-mysql_*-functions-in-php-1657384260352"},{"title":"Can PHP PDO Statements accept the table or column name as parameter?","slug":"can-php-pdo-statements-accept-the-table-or-column-name-as-parameter-1657387478588"},{"title":"Learning Regular Expressions [closed]","slug":"learning-regular-expressions-closed-1657384719460"},{"title":"What is the explicit promise construction antipattern and how do I avoid it?","slug":"what-is-the-explicit-promise-construction-antipattern-and-how-do-i-avoid-it-1657384436212"},{"title":"C++ Singleton design pattern","slug":"c++-singleton-design-pattern-1657387830040"},{"title":"What is the difference between public, protected, package-private and private in Java?","slug":"what-is-the-difference-between-public-protected-package-private-and-private-in-java-1657387376262"},{"title":"Deserialize JSON into C# dynamic object?","slug":"deserialize-json-into-c-dynamic-object-1657388568720"},{"title":"How does the Java 'for each' loop work?","slug":"how-does-the-java-'for-each'-loop-work-1657388423749"},{"title":"How do I make Git forget about a file that was tracked, but is now in .gitignore?","slug":"how-do-i-make-git-forget-about-a-file-that-was-tracked-but-is-now-in-.gitignore-1657387328843"},{"title":"How to determine equality for two JavaScript objects?","slug":"how-to-determine-equality-for-two-javascript-objects-1657387638650"},{"title":"What are the nuances of scope prototypal / prototypical inheritance in AngularJS?","slug":"what-are-the-nuances-of-scope-prototypal-prototypical-inheritance-in-angularjs-1657387340067"},{"title":"What is a raw type and why shouldn't we use it?","slug":"what-is-a-raw-type-and-why-shouldn't-we-use-it-1657384481079"},{"title":"Is an array name a pointer?","slug":"is-an-array-name-a-pointer-1657387874827"},{"title":"How do I format a date in JavaScript?","slug":"how-do-i-format-a-date-in-javascript-1657384649498"},{"title":"Percentage Height HTML 5/CSS","slug":"percentage-height-html-5css-1657387471048"},{"title":"How can I vertically center a div element for all browsers using CSS?","slug":"how-can-i-vertically-center-a-div-element-for-all-browsers-using-css-1657385488425"},{"title":"How can I access an array/object?","slug":"how-can-i-access-an-arrayobject-1657387395541"},{"title":"How can I validate an email address in JavaScript?","slug":"how-can-i-validate-an-email-address-in-javascript-1657385475959"},{"title":"Prototypical inheritance - writing up [duplicate]","slug":"prototypical-inheritance-writing-up-duplicate-1657385478064"}]},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"why-is-settimeout(fn-0)-sometimes-useful-1657388379869"},"buildId":"BnkbnjkWYxefPXjTJLVVv","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>