{"pageProps":{"data":{"count":1,"rows":[{"id":543,"title":"Convert Rows to columns using 'Pivot' in SQL Server","slug":"convert-rows-to-columns-using-'pivot'-in-sql-server-1657388372528","postType":"QUESTION","createdAt":"2022-07-09T17:39:32.000Z","updatedAt":"2022-07-09T17:39:32.000Z","tags":[{"id":2653,"name":"pivot-table","slug":"pivot-table","createdAt":"2022-07-09T17:39:32.000Z","updatedAt":"2022-07-09T17:39:32.000Z","Questions_Tags":{"questionId":543,"tagId":2653}}]}]},"slug":"pivot-table","page":1,"answers":{"543":["\n&lt;p&gt;If you are using SQL Server 2005+, then you can use the &lt;code&gt;PIVOT&lt;/code&gt; function to transform the data from rows into columns.&lt;/p&gt;\n&lt;p&gt;It sounds like you will need to use dynamic sql if the weeks are unknown but it is easier to see the correct code using a hard-coded version initially.&lt;/p&gt;\n&lt;p&gt;First up, here are some quick table definitions and data for use:&lt;/p&gt;\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;TABLE&lt;/span&gt; yt \n(\n  [Store] &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt;, \n  [Week] &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt;, \n  [xCount] &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt;\n);\n    \n&lt;span class=&quot;hljs-keyword&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;INTO&lt;/span&gt; yt\n(\n  [Store], \n  [Week], [xCount]\n)\n&lt;span class=&quot;hljs-keyword&quot;&gt;VALUES&lt;/span&gt;\n    (&lt;span class=&quot;hljs-number&quot;&gt;102&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;96&lt;/span&gt;),\n    (&lt;span class=&quot;hljs-number&quot;&gt;101&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;138&lt;/span&gt;),\n    (&lt;span class=&quot;hljs-number&quot;&gt;105&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;37&lt;/span&gt;),\n    (&lt;span class=&quot;hljs-number&quot;&gt;109&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;59&lt;/span&gt;),\n    (&lt;span class=&quot;hljs-number&quot;&gt;101&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;282&lt;/span&gt;),\n    (&lt;span class=&quot;hljs-number&quot;&gt;102&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;212&lt;/span&gt;),\n    (&lt;span class=&quot;hljs-number&quot;&gt;105&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;78&lt;/span&gt;),\n    (&lt;span class=&quot;hljs-number&quot;&gt;109&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;97&lt;/span&gt;),\n    (&lt;span class=&quot;hljs-number&quot;&gt;105&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;60&lt;/span&gt;),\n    (&lt;span class=&quot;hljs-number&quot;&gt;102&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;123&lt;/span&gt;),\n    (&lt;span class=&quot;hljs-number&quot;&gt;101&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;220&lt;/span&gt;),\n    (&lt;span class=&quot;hljs-number&quot;&gt;109&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;hljs-number&quot;&gt;87&lt;/span&gt;);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;If your values are known, then you will hard-code the query:&lt;/p&gt;\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; \n(\n  &lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; store, week, xCount\n  &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; yt \n) src\npivot\n(\n  &lt;span class=&quot;hljs-built_in&quot;&gt;sum&lt;/span&gt;(xcount)\n  &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; week &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; ([&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;], [&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;], [&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;])\n) piv;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;See &lt;a href=&quot;https://data.stackexchange.com/stackoverflow/query/580181&quot; rel=&quot;noreferrer&quot;&gt;SQL Demo&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;Then if you need to generate the week number dynamically, your code will be:&lt;/p&gt;\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@cols&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; NVARCHAR(MAX),\n    &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;  &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; NVARCHAR(MAX)\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@cols&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; STUFF((&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; QUOTENAME(Week) \n                    &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; yt\n                    &lt;span class=&quot;hljs-keyword&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;by&lt;/span&gt; Week\n                    &lt;span class=&quot;hljs-keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;by&lt;/span&gt; Week\n            &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt; XML PATH(&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;), TYPE\n            ).&lt;span class=&quot;hljs-keyword&quot;&gt;value&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;.&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;NVARCHAR(MAX)&apos;&lt;/span&gt;) \n        ,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;)\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT store,&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@cols&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; from \n             (\n                select store, week, xCount\n                from yt\n            ) x\n            pivot \n            (\n                sum(xCount)\n                for week in (&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@cols&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;)\n            ) p &apos;&lt;/span&gt;\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;execute&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;);\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;See &lt;a href=&quot;https://data.stackexchange.com/stackoverflow/query/580183&quot; rel=&quot;noreferrer&quot;&gt;SQL Demo&lt;/a&gt;.&lt;/p&gt;\n&lt;p&gt;The dynamic version, generates the list of &lt;code&gt;week&lt;/code&gt; numbers that should be converted to columns. Both give the same result:&lt;/p&gt;\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; STORE &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;---------------------------&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;hljs-number&quot;&gt;101&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;138&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;282&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;220&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;hljs-number&quot;&gt;102&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;hljs-number&quot;&gt;96&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;212&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;123&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;hljs-number&quot;&gt;105&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;hljs-number&quot;&gt;37&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;hljs-number&quot;&gt;78&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;hljs-number&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;hljs-number&quot;&gt;109&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;hljs-number&quot;&gt;59&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;hljs-number&quot;&gt;97&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;  &lt;span class=&quot;hljs-number&quot;&gt;87&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;|&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;This is for dynamic # of weeks.&lt;/p&gt;\n\n&lt;p&gt;Full example here:&lt;a href=&quot;http://sqlhints.com/2014/03/18/dynamic-pivot-in-sql-server/&quot; rel=&quot;noreferrer&quot;&gt;SQL Dynamic Pivot&lt;/a&gt;&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DynamicPivotQuery&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; NVARCHAR(MAX)\n&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; NVARCHAR(MAX)\n\n&lt;span class=&quot;hljs-comment&quot;&gt;--Get distinct values of the PIVOT Column &lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; ISNULL(&lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; QUOTENAME(Week)\n&lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;DISTINCT&lt;/span&gt; Week &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; #StoreSales) &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; Weeks\n\n&lt;span class=&quot;hljs-comment&quot;&gt;--Prepare the PIVOT query using the dynamic &lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@DynamicPivotQuery&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; \n  N&lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT Store, &apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; \n    FROM #StoreSales\n    PIVOT(SUM(xCount) \n          FOR Week IN (&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ColumnName&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;)) AS PVTTable&apos;&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--Execute the Dynamic Pivot Query&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;EXEC&lt;/span&gt; sp_executesql &lt;span class=&quot;hljs-variable&quot;&gt;@DynamicPivotQuery&lt;/span&gt;\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;I&apos;ve achieved the same thing before by using subqueries.  So if your original table was called StoreCountsByWeek, and you had a separate table that listed the Store IDs, then it would look like this:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; StoreID, \n    Week1&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; ISNULL(&lt;span class=&quot;hljs-built_in&quot;&gt;SUM&lt;/span&gt;(xCount),&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; StoreCountsByWeek &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; StoreCountsByWeek.StoreID&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;Store.StoreID &lt;span class=&quot;hljs-keyword&quot;&gt;AND&lt;/span&gt; Week&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;),\n    Week2&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; ISNULL(&lt;span class=&quot;hljs-built_in&quot;&gt;SUM&lt;/span&gt;(xCount),&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; StoreCountsByWeek &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; StoreCountsByWeek.StoreID&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;Store.StoreID &lt;span class=&quot;hljs-keyword&quot;&gt;AND&lt;/span&gt; Week&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;),\n    Week3&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; ISNULL(&lt;span class=&quot;hljs-built_in&quot;&gt;SUM&lt;/span&gt;(xCount),&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; StoreCountsByWeek &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; StoreCountsByWeek.StoreID&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;Store.StoreID &lt;span class=&quot;hljs-keyword&quot;&gt;AND&lt;/span&gt; Week&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;)\n&lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; Store\n&lt;span class=&quot;hljs-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;BY&lt;/span&gt; StoreID\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;One advantage to this method is that the syntax is more clear and it makes it easier to join to other tables to pull other fields into the results too.&lt;/p&gt;\n\n&lt;p&gt;My anecdotal results are that running this query over a couple of thousand rows completed in less than one second, and I actually had 7 subqueries.  But as noted in the comments, it is more computationally expensive to do it this way, so be careful about using this method if you expect it to run on large amounts of data .&lt;/p&gt;\n    ","\n&lt;p&gt;This is what you can do:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; \n&lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; yourTable\nPIVOT (&lt;span class=&quot;hljs-built_in&quot;&gt;MAX&lt;/span&gt;(xCount) \n       &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt; Week &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; ([&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;],[&lt;span class=&quot;hljs-number&quot;&gt;2&lt;/span&gt;],[&lt;span class=&quot;hljs-number&quot;&gt;3&lt;/span&gt;],[&lt;span class=&quot;hljs-number&quot;&gt;4&lt;/span&gt;],[&lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;],[&lt;span class=&quot;hljs-number&quot;&gt;6&lt;/span&gt;],[&lt;span class=&quot;hljs-number&quot;&gt;7&lt;/span&gt;])) &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; pvt\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;&lt;a href=&quot;http://www.sqlfiddle.com/#!3/16fd1/1&quot; rel=&quot;noreferrer&quot;&gt;DEMO&lt;/a&gt;&lt;/p&gt;\n    ","\n&lt;p&gt;I&apos;m writing an sp that could be useful for this purpose, basically this sp pivot any table and return a new table pivoted or return just the set of data, this is the way to execute it:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;Exec&lt;/span&gt; dbo.rs_pivot_table &lt;span class=&quot;hljs-variable&quot;&gt;@schema&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;dbo,&lt;span class=&quot;hljs-variable&quot;&gt;@table&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;table_name,&lt;span class=&quot;hljs-variable&quot;&gt;@column&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;column_to_pivot,&lt;span class=&quot;hljs-variable&quot;&gt;@agg&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;sum([column_to_agg]),avg([another_column_to_agg]),&apos;&lt;/span&gt;,\n        &lt;span class=&quot;hljs-variable&quot;&gt;@sel&lt;/span&gt;_cols&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;column_to_select1,column_to_select2,column_to_select1&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-variable&quot;&gt;@new&lt;/span&gt;_table&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;returned_table_pivoted;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;&lt;strong&gt;please note&lt;/strong&gt; that in the parameter @agg the column names must be with &lt;code&gt;&apos;[&apos;&lt;/code&gt; and the parameter must end with a comma &lt;code&gt;&apos;,&apos;&lt;/code&gt;&lt;/p&gt;\n\n&lt;p&gt;SP&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;Create&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;Procedure&lt;/span&gt; [dbo].[rs_pivot_table]\n    &lt;span class=&quot;hljs-variable&quot;&gt;@schema&lt;/span&gt; sysname&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;dbo,\n    &lt;span class=&quot;hljs-variable&quot;&gt;@table&lt;/span&gt; sysname,\n    &lt;span class=&quot;hljs-variable&quot;&gt;@column&lt;/span&gt; sysname,\n    &lt;span class=&quot;hljs-variable&quot;&gt;@agg&lt;/span&gt; nvarchar(max),\n    &lt;span class=&quot;hljs-variable&quot;&gt;@sel&lt;/span&gt;_cols &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(max),\n    &lt;span class=&quot;hljs-variable&quot;&gt;@new&lt;/span&gt;_table sysname,\n    &lt;span class=&quot;hljs-variable&quot;&gt;@add&lt;/span&gt;_to_col_name sysname&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;As&lt;/span&gt;\n&lt;span class=&quot;hljs-comment&quot;&gt;--Exec dbo.rs_pivot_table dbo,##TEMPORAL1,tip_liq,&apos;sum([val_liq]),sum([can_liq]),&apos;,&apos;cod_emp,cod_con,tip_liq&apos;,##TEMPORAL1PVT,&apos;hola&apos;;&lt;/span&gt;\n&lt;span class=&quot;hljs-keyword&quot;&gt;Begin&lt;/span&gt;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Declare&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(max)&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Declare&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@aggDet&lt;/span&gt; &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;100&lt;/span&gt;);\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Declare&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@opp&lt;/span&gt;_agg &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;);\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Declare&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@col&lt;/span&gt;_agg &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;100&lt;/span&gt;);\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Declare&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@pivot&lt;/span&gt;_col sysname;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Declare&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;_col_pvt &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(max)&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Declare&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@full&lt;/span&gt;_query_pivot &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(max)&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Declare&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ind&lt;/span&gt;_tmpTbl &lt;span class=&quot;hljs-type&quot;&gt;int&lt;/span&gt;; &lt;span class=&quot;hljs-comment&quot;&gt;--Indicador de tabla temporal 1=tabla temporal global 0=Tabla fisica&lt;/span&gt;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Create&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;Table&lt;/span&gt; #pvt_column(\n        pivot_col &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;100&lt;/span&gt;)\n    );\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Declare&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@column&lt;/span&gt;_agg &lt;span class=&quot;hljs-keyword&quot;&gt;table&lt;/span&gt;(\n        opp_agg &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;5&lt;/span&gt;),\n        col_agg &lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;100&lt;/span&gt;)\n    );\n\n    IF  &lt;span class=&quot;hljs-keyword&quot;&gt;EXISTS&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; sys.objects &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; object_id &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; OBJECT_ID(&lt;span class=&quot;hljs-variable&quot;&gt;@table&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;AND&lt;/span&gt; type &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; (N&lt;span class=&quot;hljs-string&quot;&gt;&apos;U&apos;&lt;/span&gt;))\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Set&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ind&lt;/span&gt;_tmpTbl&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;ELSE&lt;/span&gt; IF OBJECT_ID(&lt;span class=&quot;hljs-string&quot;&gt;&apos;tempdb..&apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;ltrim(rtrim(&lt;span class=&quot;hljs-variable&quot;&gt;@table&lt;/span&gt;))) &lt;span class=&quot;hljs-keyword&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Set&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ind&lt;/span&gt;_tmpTbl&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;;\n\n    IF  &lt;span class=&quot;hljs-keyword&quot;&gt;EXISTS&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;FROM&lt;/span&gt; sys.objects &lt;span class=&quot;hljs-keyword&quot;&gt;WHERE&lt;/span&gt; object_id &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; OBJECT_ID(&lt;span class=&quot;hljs-variable&quot;&gt;@new&lt;/span&gt;_table) &lt;span class=&quot;hljs-keyword&quot;&gt;AND&lt;/span&gt; type &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; (N&lt;span class=&quot;hljs-string&quot;&gt;&apos;U&apos;&lt;/span&gt;)) &lt;span class=&quot;hljs-keyword&quot;&gt;OR&lt;/span&gt; \n        OBJECT_ID(&lt;span class=&quot;hljs-string&quot;&gt;&apos;tempdb..&apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;ltrim(rtrim(&lt;span class=&quot;hljs-variable&quot;&gt;@new&lt;/span&gt;_table))) &lt;span class=&quot;hljs-keyword&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;NULL&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Begin&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Set&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;DROP TABLE &apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@new&lt;/span&gt;_table&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Exec&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;);\n    &lt;span class=&quot;hljs-keyword&quot;&gt;End&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;Select distinct &apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@column&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos; From &apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ind&lt;/span&gt;_tmpTbl&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;tempdb.&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;)&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@schema&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;.&apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@table&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos; where &apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@column&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos; is not null;&apos;&lt;/span&gt;;\n    Print &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Insert&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;into&lt;/span&gt; #pvt_column(pivot_col)\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Exec&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;)\n\n    While charindex(&lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-variable&quot;&gt;@agg&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;)&lt;span class=&quot;hljs-operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Begin&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@aggDet&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;Substring&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;@agg&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,charindex(&lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-variable&quot;&gt;@agg&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;)&lt;span class=&quot;hljs-number&quot;&gt;-1&lt;/span&gt;);\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Insert&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;Into&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@column&lt;/span&gt;_agg(opp_agg,col_agg)\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Values&lt;/span&gt;(&lt;span class=&quot;hljs-built_in&quot;&gt;substring&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;@aggDet&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,charindex(&lt;span class=&quot;hljs-string&quot;&gt;&apos;(&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-variable&quot;&gt;@aggDet&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;)&lt;span class=&quot;hljs-number&quot;&gt;-1&lt;/span&gt;),ltrim(rtrim(replace(&lt;span class=&quot;hljs-built_in&quot;&gt;substring&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;@aggDet&lt;/span&gt;,charindex(&lt;span class=&quot;hljs-string&quot;&gt;&apos;[&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-variable&quot;&gt;@aggDet&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;),charindex(&lt;span class=&quot;hljs-string&quot;&gt;&apos;]&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-variable&quot;&gt;@aggDet&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;)&lt;span class=&quot;hljs-number&quot;&gt;-4&lt;/span&gt;),&lt;span class=&quot;hljs-string&quot;&gt;&apos;)&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;))));\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Set&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@agg&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;Substring&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;@agg&lt;/span&gt;,charindex(&lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-variable&quot;&gt;@agg&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;)&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,len(&lt;span class=&quot;hljs-variable&quot;&gt;@agg&lt;/span&gt;))\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;End&lt;/span&gt;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Declare&lt;/span&gt; cur_agg &lt;span class=&quot;hljs-keyword&quot;&gt;cursor&lt;/span&gt; read_only forward_only &lt;span class=&quot;hljs-keyword&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Select&lt;/span&gt; \n        opp_agg,col_agg\n    &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@column&lt;/span&gt;_agg;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Open&lt;/span&gt; cur_agg;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Fetch&lt;/span&gt; Next &lt;span class=&quot;hljs-keyword&quot;&gt;From&lt;/span&gt; cur_agg\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Into&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@opp&lt;/span&gt;_agg,&lt;span class=&quot;hljs-variable&quot;&gt;@col&lt;/span&gt;_agg;\n\n    While @&lt;span class=&quot;hljs-variable&quot;&gt;@fetch&lt;/span&gt;_status&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Begin&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Declare&lt;/span&gt; cur_col &lt;span class=&quot;hljs-keyword&quot;&gt;cursor&lt;/span&gt; read_only forward_only &lt;span class=&quot;hljs-keyword&quot;&gt;local&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Select&lt;/span&gt; \n            pivot_col \n        &lt;span class=&quot;hljs-keyword&quot;&gt;From&lt;/span&gt; #pvt_column;\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Open&lt;/span&gt; cur_col;\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Fetch&lt;/span&gt; Next &lt;span class=&quot;hljs-keyword&quot;&gt;From&lt;/span&gt; cur_col\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Into&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@pivot&lt;/span&gt;_col;\n\n        While @&lt;span class=&quot;hljs-variable&quot;&gt;@fetch&lt;/span&gt;_status&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Begin&lt;/span&gt;\n\n            &lt;span class=&quot;hljs-keyword&quot;&gt;Select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;_col_pvt&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;isnull(&apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@opp&lt;/span&gt;_agg&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;(case when &apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@column&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;=&apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;quotename(&lt;span class=&quot;hljs-variable&quot;&gt;@pivot&lt;/span&gt;_col,&lt;span class=&quot;hljs-type&quot;&gt;char&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;39&lt;/span&gt;))&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos; then &apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@col&lt;/span&gt;_agg&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;\n            &lt;span class=&quot;hljs-string&quot;&gt;&apos; else null end),0) as [&apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;lower&lt;/span&gt;(Replace(Replace(&lt;span class=&quot;hljs-variable&quot;&gt;@opp&lt;/span&gt;_agg&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;_&apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;convert&lt;/span&gt;(&lt;span class=&quot;hljs-type&quot;&gt;varchar&lt;/span&gt;(&lt;span class=&quot;hljs-number&quot;&gt;100&lt;/span&gt;),&lt;span class=&quot;hljs-variable&quot;&gt;@pivot&lt;/span&gt;_col)&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;_&apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;replace(replace(&lt;span class=&quot;hljs-variable&quot;&gt;@col&lt;/span&gt;_agg,&lt;span class=&quot;hljs-string&quot;&gt;&apos;[&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;),&lt;span class=&quot;hljs-string&quot;&gt;&apos;]&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;),&lt;span class=&quot;hljs-string&quot;&gt;&apos; &apos;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;),&lt;span class=&quot;hljs-string&quot;&gt;&apos;&amp;amp;&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;))&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;\n                (&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@add&lt;/span&gt;_to_col_name &lt;span class=&quot;hljs-keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;then&lt;/span&gt; space(&lt;span class=&quot;hljs-number&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;_&apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;isnull(ltrim(rtrim(&lt;span class=&quot;hljs-variable&quot;&gt;@add&lt;/span&gt;_to_col_name)),&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;) &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;)&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;]&apos;&lt;/span&gt;\n            print &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;_col_pvt\n            &lt;span class=&quot;hljs-keyword&quot;&gt;Select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@full&lt;/span&gt;_query_pivot&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@full&lt;/span&gt;_query_pivot&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;_col_pvt&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;, &apos;&lt;/span&gt;\n\n            &lt;span class=&quot;hljs-comment&quot;&gt;--print @full_query_pivot&lt;/span&gt;\n\n            &lt;span class=&quot;hljs-keyword&quot;&gt;Fetch&lt;/span&gt; Next &lt;span class=&quot;hljs-keyword&quot;&gt;From&lt;/span&gt; cur_col\n            &lt;span class=&quot;hljs-keyword&quot;&gt;Into&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@pivot&lt;/span&gt;_col;        \n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;End&lt;/span&gt;     \n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Close&lt;/span&gt; cur_col;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Deallocate&lt;/span&gt; cur_col;\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Fetch&lt;/span&gt; Next &lt;span class=&quot;hljs-keyword&quot;&gt;From&lt;/span&gt; cur_agg\n        &lt;span class=&quot;hljs-keyword&quot;&gt;Into&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@opp&lt;/span&gt;_agg,&lt;span class=&quot;hljs-variable&quot;&gt;@col&lt;/span&gt;_agg; \n    &lt;span class=&quot;hljs-keyword&quot;&gt;End&lt;/span&gt;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Close&lt;/span&gt; cur_agg;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Deallocate&lt;/span&gt; cur_agg;\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@full&lt;/span&gt;_query_pivot&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;substring&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;@full&lt;/span&gt;_query_pivot,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,len(&lt;span class=&quot;hljs-variable&quot;&gt;@full&lt;/span&gt;_query_pivot)&lt;span class=&quot;hljs-number&quot;&gt;-1&lt;/span&gt;);\n\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;Select &apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@sel&lt;/span&gt;_cols&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@full&lt;/span&gt;_query_pivot&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos; into &apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@new&lt;/span&gt;_table&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos; From &apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@ind&lt;/span&gt;_tmpTbl&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;tempdb.&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;end&lt;/span&gt;)&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;\n    &lt;span class=&quot;hljs-variable&quot;&gt;@schema&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;.&apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@table&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos; Group by &apos;&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-variable&quot;&gt;@sel&lt;/span&gt;_cols&lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;;&apos;&lt;/span&gt;;\n\n    print &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;;\n    &lt;span class=&quot;hljs-keyword&quot;&gt;Exec&lt;/span&gt; (&lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;);\n\n&lt;span class=&quot;hljs-keyword&quot;&gt;End&lt;/span&gt;;\nGO\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;This is an example of execution:&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;Exec&lt;/span&gt; dbo.rs_pivot_table &lt;span class=&quot;hljs-variable&quot;&gt;@schema&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;dbo,&lt;span class=&quot;hljs-variable&quot;&gt;@table&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;##TEMPORAL1,&lt;span class=&quot;hljs-variable&quot;&gt;@column&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;tip_liq,&lt;span class=&quot;hljs-variable&quot;&gt;@agg&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;sum([val_liq]),avg([can_liq]),&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-variable&quot;&gt;@sel&lt;/span&gt;_cols&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-string&quot;&gt;&apos;cod_emp,cod_con,tip_liq&apos;&lt;/span&gt;,&lt;span class=&quot;hljs-variable&quot;&gt;@new&lt;/span&gt;_table&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;##TEMPORAL1PVT;\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;then &lt;code&gt;Select * From ##TEMPORAL1PVT&lt;/code&gt; would return:&lt;/p&gt;\n\n&lt;p&gt;&lt;a href=&quot;https://i.stack.imgur.com/pGHCK.png&quot; rel=&quot;noreferrer&quot;&gt;&lt;img src=&quot;https://i.stack.imgur.com/pGHCK.png&quot; alt=&quot;enter image description here&quot;&gt;&lt;/a&gt;&lt;/p&gt;\n    ","\n&lt;p&gt;Here is a revision of @Tayrn answer above that might help you understand pivoting a little easier: &lt;/p&gt;\n\n&lt;p&gt;This may not be the best way to do this, but this is what helped me wrap my head around how to pivot tables.&lt;/p&gt;\n\n&lt;p&gt;ID = rows you want to pivot&lt;/p&gt;\n\n&lt;p&gt;MY_KEY = the column you are selecting from your original table that contains the column names you want to pivot.&lt;/p&gt;\n\n&lt;p&gt;VAL = the value you want returning under each column.&lt;/p&gt;\n\n&lt;p&gt;MAX(VAL) =&amp;gt; Can be replaced with other aggregiate functions. SUM(VAL), MIN(VAL), ETC...&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@cols&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; NVARCHAR(MAX),\n&lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;  &lt;span class=&quot;hljs-keyword&quot;&gt;AS&lt;/span&gt; NVARCHAR(MAX)\n&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@cols&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; STUFF((&lt;span class=&quot;hljs-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;,&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; QUOTENAME(MY_KEY) \n                &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; yt\n                &lt;span class=&quot;hljs-keyword&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;by&lt;/span&gt; MY_KEY\n                &lt;span class=&quot;hljs-keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;by&lt;/span&gt; MY_KEY &lt;span class=&quot;hljs-keyword&quot;&gt;ASC&lt;/span&gt;\n        &lt;span class=&quot;hljs-keyword&quot;&gt;FOR&lt;/span&gt; XML PATH(&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;), TYPE\n        ).&lt;span class=&quot;hljs-keyword&quot;&gt;value&lt;/span&gt;(&lt;span class=&quot;hljs-string&quot;&gt;&apos;.&apos;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&apos;NVARCHAR(MAX)&apos;&lt;/span&gt;) \n    ,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt;,&lt;span class=&quot;hljs-string&quot;&gt;&apos;&apos;&lt;/span&gt;)\n&lt;span class=&quot;hljs-keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;SELECT ID,&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@cols&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos; from \n         (\n            select ID, MY_KEY, VAL \n            from yt\n        ) x\n        pivot \n        (\n            sum(VAL)\n            for MY_KEY in (&apos;&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-variable&quot;&gt;@cols&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-string&quot;&gt;&apos;)\n        ) p &apos;&lt;/span&gt;\n\n        &lt;span class=&quot;hljs-keyword&quot;&gt;execute&lt;/span&gt;(&lt;span class=&quot;hljs-variable&quot;&gt;@query&lt;/span&gt;);\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; (&lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; name, ID &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; Empoyee) Visits\n    pivot(&lt;span class=&quot;hljs-built_in&quot;&gt;sum&lt;/span&gt;(ID) &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; name\n    &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; ([Emp1],\n    [Emp2],\n    [Emp3]\n    ) ) &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; pivottable;\n&lt;/code&gt;&lt;/pre&gt;\n    ","\n&lt;p&gt;Just give you some idea how other databases solve this problem. &lt;code&gt;DolphinDB&lt;/code&gt; also has built-in support for pivoting and the sql looks much more intuitive and neat. It is as simple as specifying the key column (&lt;code&gt;Store&lt;/code&gt;), pivoting column (&lt;code&gt;Week&lt;/code&gt;), and the calculated metric (&lt;code&gt;sum(xCount)&lt;/code&gt;).&lt;/p&gt;\n\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;prepare&lt;/span&gt; a &lt;span class=&quot;hljs-number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;-&lt;/span&gt;million&lt;span class=&quot;hljs-operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;hljs-type&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;table&lt;/span&gt;\nn&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-number&quot;&gt;10000000&lt;/span&gt;\nt&lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;table&lt;/span&gt;(rand(&lt;span class=&quot;hljs-number&quot;&gt;100&lt;/span&gt;, n) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; Store, rand(&lt;span class=&quot;hljs-number&quot;&gt;54&lt;/span&gt;, n) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; Week, rand(&lt;span class=&quot;hljs-number&quot;&gt;100&lt;/span&gt;, n) &lt;span class=&quot;hljs-operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;hljs-number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; xCount)\n\n&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;hljs-operator&quot;&gt;/&lt;/span&gt;use pivot clause &lt;span class=&quot;hljs-keyword&quot;&gt;to&lt;/span&gt; generate a pivoted &lt;span class=&quot;hljs-keyword&quot;&gt;table&lt;/span&gt; pivot_t\npivot_t &lt;span class=&quot;hljs-operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;hljs-built_in&quot;&gt;sum&lt;/span&gt;(xCount) &lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; t pivot &lt;span class=&quot;hljs-keyword&quot;&gt;by&lt;/span&gt; Store, Week\n&lt;/code&gt;&lt;/pre&gt;\n\n&lt;p&gt;DolphinDB is a columnar high performance database. The calculation in the demo costs as low as 546 ms on a dell xps laptop (i7 cpu).  To get more details, please refer to online DolphinDB manual &lt;a href=&quot;https://www.dolphindb.com/help/index.html?pivotby.html&quot; rel=&quot;nofollow noreferrer&quot;&gt;https://www.dolphindb.com/help/index.html?pivotby.html&lt;/a&gt;&lt;/p&gt;\n    ","\n&lt;p&gt;Pivot is one of the SQL operator which is used to turn the unique data from one column into multiple column in the output. This is also mean by transforming the rows into columns (rotating table). Let us consider this table,&lt;/p&gt;\n&lt;p&gt;&lt;a href=&quot;https://i.stack.imgur.com/iEOQ0.png&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;img src=&quot;https://i.stack.imgur.com/iEOQ0.png&quot; alt=&quot;enter image description here&quot;&gt;&lt;/a&gt;&lt;/p&gt;\n&lt;p&gt;If I want to filter this data based on the types of product (Speaker, Glass, Headset) by each customer, then use Pivot operator.&lt;/p&gt;\n&lt;pre class=&quot;lang-sql s-code-block&quot;&gt;&lt;code class=&quot;hljs language-sql&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;Select&lt;/span&gt; CustmerName, Speaker, Glass, Headset  \n&lt;span class=&quot;hljs-keyword&quot;&gt;from&lt;/span&gt; TblCustomer  \n   Pivot  \n    (  \n     &lt;span class=&quot;hljs-built_in&quot;&gt;Sum&lt;/span&gt;(Price) &lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; Product &lt;span class=&quot;hljs-keyword&quot;&gt;in&lt;/span&gt; ([Speaker],[Glass],[Headset])  \n    ) &lt;span class=&quot;hljs-keyword&quot;&gt;as&lt;/span&gt; PivotTable \n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;&lt;a href=&quot;https://i.stack.imgur.com/Y1kSv.png&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;img src=&quot;https://i.stack.imgur.com/Y1kSv.png&quot; alt=&quot;enter image description here&quot;&gt;&lt;/a&gt;&lt;/p&gt;\n    "]},"randomTags":[{"name":"language-features","slug":"language-features"},{"name":"chained-assignment","slug":"chained-assignment"},{"name":"getter","slug":"getter"},{"name":"return","slug":"return"},{"name":"responsive-design","slug":"responsive-design"},{"name":"utc","slug":"utc"},{"name":"local-storage","slug":"local-storage"},{"name":"viewmodel","slug":"viewmodel"},{"name":"immutability","slug":"immutability"},{"name":"layout-manager","slug":"layout-manager"},{"name":"ajax","slug":"ajax"},{"name":"model","slug":"model"},{"name":"profiler","slug":"profiler"},{"name":"circular-dependency","slug":"circular-dependency"},{"name":"spl","slug":"spl"},{"name":"return-type","slug":"return-type"},{"name":"bounded-wildcard","slug":"bounded-wildcard"},{"name":"nosuchelementexception","slug":"nosuchelementexception"},{"name":"google-cloud-firestore","slug":"google-cloud-firestore"},{"name":"closures","slug":"closures"}]},"__N_SSG":true}