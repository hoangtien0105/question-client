<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2eccd4d47c856f2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2eccd4d47c856f2b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-20edbe0b078add93.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/613-1e0aa2b2023820bb.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/81-096e453de8a27667.js" defer=""></script><script src="/_next/static/chunks/pages/questions/tag/%5Bslug%5D-6802ea06aeddcbec.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_buildManifest.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5"></style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="https://flowbite.com/docs/images/logo.svg" class="mr-3 h-6 sm:h-9" alt="Flowbite Logo"/><span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Hunter</span></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/tag/unicode#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="flex items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/trouble-with-utf-8-characters-what-i-see-is-not-what-i-stored-1657384817490">Trouble with UTF-8 characters; what I see is not what I stored</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/unicode">unicode</a></div></div><div class="mt-4 mb-6" style="height:100px;overflow:auto"><h4 class="font-semibold">Solution 1:</h4><div class="text-sm bg-green-100 text-neutral-600">
<p>This problem plagues the participants of this site, and many others.</p>

<p>You have listed the five main cases of <code>CHARACTER SET</code> troubles.</p>

<p><strong>Best Practice</strong></p>

<p>Going forward, it is best to use <code>CHARACTER SET utf8mb4</code> and <code>COLLATION utf8mb4_unicode_520_ci</code>. (There is a newer version of the Unicode collation in the pipeline.)</p>

<p><code>utf8mb4</code> is a superset of <code>utf8</code> in that it handles 4-byte utf8 codes, which are needed by Emoji and some of Chinese.</p>

<p>Outside of MySQL, "UTF-8" refers to all size encodings, hence effectively the same as MySQL's <code>utf8mb4</code>, not <code>utf8</code>.</p>

<p>I will try to use those spellings and capitalizations to distinguish inside versus outside MySQL in the following.</p>

<p><strong>Overview of what you <em>should</em> do</strong></p>

<ul>
<li>Have your editor, etc. set to UTF-8.</li>
<li>HTML forms should start like <code>&lt;form accept-charset="UTF-8"&gt;</code>.</li>
<li>Have your bytes encoded as UTF-8.</li>
<li>Establish UTF-8 as the encoding being used in the client.</li>
<li>Have the column/table declared <code>CHARACTER SET utf8mb4</code> (Check with <code>SHOW CREATE TABLE</code>.)</li>
<li><code>&lt;meta charset=UTF-8&gt;</code> at the beginning of HTML</li>
<li>Stored Routines acquire the current charset/collation.  They may need rebuilding.</li>
</ul>

<p><em><a href="https://stackoverflow.com/questions/279170/how-to-support-utf-8-completely-in-a-web-application">UTF-8 all the way through</a></em></p>

<p><a href="http://mysql.rjweb.org/doc.php/charcoll#python" rel="noreferrer">More details for computer languages</a> (and its following sections)</p>

<p><strong>Test the data</strong></p>

<p>Viewing the data with a tool or with <code>SELECT</code> cannot be trusted.
Too many such clients, especially browsers, try to compensate for incorrect encodings, and show you correct text even if the database is mangled.
So, pick a table and column that has some non-English text and do</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> col, HEX(col) <span class="hljs-keyword">FROM</span> tbl <span class="hljs-keyword">WHERE</span> ...
</code></pre>

<p>The HEX for correctly stored UTF-8 will be</p>

<ul>
<li>For a blank space (in any language):  <code>20</code></li>
<li>For English:  <code>4x</code>, <code>5x</code>, <code>6x</code>, or <code>7x</code></li>
<li>For most of Western Europe, accented letters should be <code>Cxyy</code></li>
<li>Cyrillic, Hebrew, and Farsi/Arabic:  <code>Dxyy</code></li>
<li>Most of Asia:  <code>Exyyzz</code></li>
<li>Emoji and some of Chinese:  <code>F0yyzzww</code></li>
<li><a href="http://mysql.rjweb.org/doc.php/charcoll#diagnosing_charset_issues" rel="noreferrer">More details</a></li>
</ul>

<p><strong>Specific causes and fixes of the problems seen</strong></p>

<p><strong>Truncated</strong> text (<code>Se</code> for <code>Señor</code>):</p>

<ul>
<li>The bytes to be stored are not encoded as utf8mb4. Fix this.</li>
<li>Also, check that the connection during reading is UTF-8.</li>
</ul>

<p><strong>Black Diamonds</strong> with question marks (<code>Seor</code> for <code>Señor</code>);
one of these cases exists:</p>

<p>Case 1 (original bytes were <em>not</em> UTF-8):</p>

<ul>
<li>The bytes to be stored are not encoded as utf8. Fix this.</li>
<li>The connection (or <code>SET NAMES</code>) for the <code>INSERT</code> <em>and</em> the <code>SELECT</code> was not utf8/utf8mb4.  Fix this.</li>
<li>Also, check that the column in the database is <code>CHARACTER SET utf8</code> (or utf8mb4).</li>
</ul>

<p>Case 2 (original bytes <em>were</em> UTF-8):</p>

<ul>
<li>The connection (or <code>SET NAMES</code>) for the <code>SELECT</code> was not utf8/utf8mb4.  Fix this.</li>
<li>Also, check that the column in the database is <code>CHARACTER SET utf8</code> (or utf8mb4).</li>
</ul>

<p>Black diamonds occur only when the browser is set to <code>&lt;meta charset=UTF-8&gt;</code>.</p>

<p><strong>Question Marks</strong> (regular ones, not black diamonds) (<code>Se?or</code> for <code>Señor</code>):</p>

<ul>
<li>The bytes to be stored are not encoded as utf8/utf8mb4.  Fix this.</li>
<li>The column in the database is not <code>CHARACTER SET utf8</code> (or utf8mb4).  Fix this.  (Use <code>SHOW CREATE TABLE</code>.)</li>
<li>Also, check that the connection during reading is UTF-8.</li>
</ul>

<p><strong>Mojibake</strong> (<code>SeÃ±or</code> for <code>Señor</code>):
(This discussion also applies to <strong>Double Encoding</strong>, which is not necessarily visible.)</p>

<ul>
<li>The bytes to be stored need to be UTF-8-encoded.  Fix this.</li>
<li>The connection when <code>INSERTing</code> and <code>SELECTing</code> text needs to specify utf8 or utf8mb4.  Fix this.</li>
<li>The column needs to be declared <code>CHARACTER SET utf8</code> (or utf8mb4).  Fix this.</li>
<li>HTML should start with <code>&lt;meta charset=UTF-8&gt;</code>.</li>
</ul>

<p>If the data looks correct, but won't sort correctly, then
either you have picked the wrong collation,
or there is no collation that suits your need,
or you have <strong>Double Encoding</strong>.</p>

<p><strong>Double Encoding</strong> can be confirmed by doing the <code>SELECT .. HEX ..</code> described above.</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">é should come back C3A9, but instead shows C383C2A9
The Emoji  should come back F09F91BD, but comes back C3B0C5B8E28098C2BD
</code></pre>

<p>That is, the hex is about twice as long as it should be.
This is caused by converting from latin1 (or whatever) to utf8, then treating those
bytes as if they were latin1 and repeating the conversion.
The sorting (and comparing) does not work correctly because it is, for example,
sorting as if the string were <code>SeÃ±or</code>.</p>

<p><strong>Fixing the Data, where possible</strong></p>

<p>For <strong>Truncation</strong> and <strong>Question Marks</strong>, the data is lost.</p>

<p>For <strong>Mojibake</strong> / <strong>Double Encoding</strong>, ...</p>

<p>For <strong>Black Diamonds</strong>, ...</p>

<p>The <strong>Fixes</strong> are listed here.  (5 different fixes for 5 different situations; pick carefully):  <a href="http://mysql.rjweb.org/doc.php/charcoll#fixes_for_various_cases" rel="noreferrer">http://mysql.rjweb.org/doc.php/charcoll#fixes_for_various_cases</a></p>
    </div></div><div><div class="flex items-center justify-between text-slate-500"><div class="flex space-x-4 md:space-x-8"><div class="flex cursor-pointer items-center transition hover:text-slate-600"><svg xmlns="http://www.w3.org/2000/svg" class="mr-1.5 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path></svg><span>4</span></div></div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"count":1,"rows":[{"answer":["\n\u0026lt;p\u0026gt;This problem plagues the participants of this site, and many others.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You have listed the five main cases of \u0026lt;code\u0026gt;CHARACTER SET\u0026lt;/code\u0026gt; troubles.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Best Practice\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Going forward, it is best to use \u0026lt;code\u0026gt;CHARACTER SET utf8mb4\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;COLLATION utf8mb4_unicode_520_ci\u0026lt;/code\u0026gt;. (There is a newer version of the Unicode collation in the pipeline.)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;utf8mb4\u0026lt;/code\u0026gt; is a superset of \u0026lt;code\u0026gt;utf8\u0026lt;/code\u0026gt; in that it handles 4-byte utf8 codes, which are needed by Emoji and some of Chinese.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Outside of MySQL, \u0026quot;UTF-8\u0026quot; refers to all size encodings, hence effectively the same as MySQL\u0026apos;s \u0026lt;code\u0026gt;utf8mb4\u0026lt;/code\u0026gt;, not \u0026lt;code\u0026gt;utf8\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I will try to use those spellings and capitalizations to distinguish inside versus outside MySQL in the following.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Overview of what you \u0026lt;em\u0026gt;should\u0026lt;/em\u0026gt; do\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Have your editor, etc. set to UTF-8.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;HTML forms should start like \u0026lt;code\u0026gt;\u0026amp;lt;form accept-charset=\u0026quot;UTF-8\u0026quot;\u0026amp;gt;\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Have your bytes encoded as UTF-8.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Establish UTF-8 as the encoding being used in the client.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Have the column/table declared \u0026lt;code\u0026gt;CHARACTER SET utf8mb4\u0026lt;/code\u0026gt; (Check with \u0026lt;code\u0026gt;SHOW CREATE TABLE\u0026lt;/code\u0026gt;.)\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;\u0026amp;lt;meta charset=UTF-8\u0026amp;gt;\u0026lt;/code\u0026gt; at the beginning of HTML\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Stored Routines acquire the current charset/collation.  They may need rebuilding.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/279170/how-to-support-utf-8-completely-in-a-web-application\u0026quot;\u0026gt;UTF-8 all the way through\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://mysql.rjweb.org/doc.php/charcoll#python\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;More details for computer languages\u0026lt;/a\u0026gt; (and its following sections)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Test the data\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Viewing the data with a tool or with \u0026lt;code\u0026gt;SELECT\u0026lt;/code\u0026gt; cannot be trusted.\nToo many such clients, especially browsers, try to compensate for incorrect encodings, and show you correct text even if the database is mangled.\nSo, pick a table and column that has some non-English text and do\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; col, HEX(col) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; tbl \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; ...\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;The HEX for correctly stored UTF-8 will be\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;For a blank space (in any language):  \u0026lt;code\u0026gt;20\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;For English:  \u0026lt;code\u0026gt;4x\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;5x\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;6x\u0026lt;/code\u0026gt;, or \u0026lt;code\u0026gt;7x\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;For most of Western Europe, accented letters should be \u0026lt;code\u0026gt;Cxyy\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Cyrillic, Hebrew, and Farsi/Arabic:  \u0026lt;code\u0026gt;Dxyy\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Most of Asia:  \u0026lt;code\u0026gt;Exyyzz\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Emoji and some of Chinese:  \u0026lt;code\u0026gt;F0yyzzww\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://mysql.rjweb.org/doc.php/charcoll#diagnosing_charset_issues\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;More details\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Specific causes and fixes of the problems seen\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Truncated\u0026lt;/strong\u0026gt; text (\u0026lt;code\u0026gt;Se\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;Señor\u0026lt;/code\u0026gt;):\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The bytes to be stored are not encoded as utf8mb4. Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Also, check that the connection during reading is UTF-8.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Black Diamonds\u0026lt;/strong\u0026gt; with question marks (\u0026lt;code\u0026gt;Seor\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;Señor\u0026lt;/code\u0026gt;);\none of these cases exists:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Case 1 (original bytes were \u0026lt;em\u0026gt;not\u0026lt;/em\u0026gt; UTF-8):\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The bytes to be stored are not encoded as utf8. Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;The connection (or \u0026lt;code\u0026gt;SET NAMES\u0026lt;/code\u0026gt;) for the \u0026lt;code\u0026gt;INSERT\u0026lt;/code\u0026gt; \u0026lt;em\u0026gt;and\u0026lt;/em\u0026gt; the \u0026lt;code\u0026gt;SELECT\u0026lt;/code\u0026gt; was not utf8/utf8mb4.  Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Also, check that the column in the database is \u0026lt;code\u0026gt;CHARACTER SET utf8\u0026lt;/code\u0026gt; (or utf8mb4).\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;Case 2 (original bytes \u0026lt;em\u0026gt;were\u0026lt;/em\u0026gt; UTF-8):\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The connection (or \u0026lt;code\u0026gt;SET NAMES\u0026lt;/code\u0026gt;) for the \u0026lt;code\u0026gt;SELECT\u0026lt;/code\u0026gt; was not utf8/utf8mb4.  Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Also, check that the column in the database is \u0026lt;code\u0026gt;CHARACTER SET utf8\u0026lt;/code\u0026gt; (or utf8mb4).\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;Black diamonds occur only when the browser is set to \u0026lt;code\u0026gt;\u0026amp;lt;meta charset=UTF-8\u0026amp;gt;\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Question Marks\u0026lt;/strong\u0026gt; (regular ones, not black diamonds) (\u0026lt;code\u0026gt;Se?or\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;Señor\u0026lt;/code\u0026gt;):\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The bytes to be stored are not encoded as utf8/utf8mb4.  Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;The column in the database is not \u0026lt;code\u0026gt;CHARACTER SET utf8\u0026lt;/code\u0026gt; (or utf8mb4).  Fix this.  (Use \u0026lt;code\u0026gt;SHOW CREATE TABLE\u0026lt;/code\u0026gt;.)\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Also, check that the connection during reading is UTF-8.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Mojibake\u0026lt;/strong\u0026gt; (\u0026lt;code\u0026gt;SeÃ±or\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;Señor\u0026lt;/code\u0026gt;):\n(This discussion also applies to \u0026lt;strong\u0026gt;Double Encoding\u0026lt;/strong\u0026gt;, which is not necessarily visible.)\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The bytes to be stored need to be UTF-8-encoded.  Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;The connection when \u0026lt;code\u0026gt;INSERTing\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;SELECTing\u0026lt;/code\u0026gt; text needs to specify utf8 or utf8mb4.  Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;The column needs to be declared \u0026lt;code\u0026gt;CHARACTER SET utf8\u0026lt;/code\u0026gt; (or utf8mb4).  Fix this.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;HTML should start with \u0026lt;code\u0026gt;\u0026amp;lt;meta charset=UTF-8\u0026amp;gt;\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;If the data looks correct, but won\u0026apos;t sort correctly, then\neither you have picked the wrong collation,\nor there is no collation that suits your need,\nor you have \u0026lt;strong\u0026gt;Double Encoding\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Double Encoding\u0026lt;/strong\u0026gt; can be confirmed by doing the \u0026lt;code\u0026gt;SELECT .. HEX ..\u0026lt;/code\u0026gt; described above.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;é should come back C3A9, but instead shows C383C2A9\nThe Emoji  should come back F09F91BD, but comes back C3B0C5B8E28098C2BD\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;That is, the hex is about twice as long as it should be.\nThis is caused by converting from latin1 (or whatever) to utf8, then treating those\nbytes as if they were latin1 and repeating the conversion.\nThe sorting (and comparing) does not work correctly because it is, for example,\nsorting as if the string were \u0026lt;code\u0026gt;SeÃ±or\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Fixing the Data, where possible\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For \u0026lt;strong\u0026gt;Truncation\u0026lt;/strong\u0026gt; and \u0026lt;strong\u0026gt;Question Marks\u0026lt;/strong\u0026gt;, the data is lost.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For \u0026lt;strong\u0026gt;Mojibake\u0026lt;/strong\u0026gt; / \u0026lt;strong\u0026gt;Double Encoding\u0026lt;/strong\u0026gt;, ...\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For \u0026lt;strong\u0026gt;Black Diamonds\u0026lt;/strong\u0026gt;, ...\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The \u0026lt;strong\u0026gt;Fixes\u0026lt;/strong\u0026gt; are listed here.  (5 different fixes for 5 different situations; pick carefully):  \u0026lt;a href=\u0026quot;http://mysql.rjweb.org/doc.php/charcoll#fixes_for_various_cases\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;http://mysql.rjweb.org/doc.php/charcoll#fixes_for_various_cases\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I had similar issues with two of my projects, after a server migration. After searching and trying a lot of solutions, I came across with this one:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;mysqli_set_charset($con,\u0026quot;utf8\u0026quot;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;After adding this line to my configuration file, everything works fine!\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I found this solution for \u0026lt;a href=\u0026quot;https://en.wikipedia.org/wiki/MySQLi\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;MySQLi\u0026lt;/a\u0026gt;\u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;https://www.w3schools.com/PHP/func_mysqli_set_charset.asp\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;PHP mysqli set_charset() Function\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;when I was looking to solve an insert from an HTML query.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I was also searching for the same issue. It took me nearly one month to find the appropriate solution.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;First of all, you will have to update you database will all the recent CHARACTER and COLLATION to utf8mb4 or at least which support UTF-8 data.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For Java:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;while making a JDBC connection, add this to the connection URL \u0026lt;em\u0026gt;useUnicode=yes\u0026amp;amp;characterEncoding=UTF-8\u0026lt;/em\u0026gt; as parameters and it will work.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For Python:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Before querying into the database, try enforcing this over the cursor\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;*\n\u0026lt;code\u0026gt;cursor.execute(\u0026apos;SET NAMES utf8mb4\u0026apos;)\u0026lt;/code\u0026gt;\n\u0026lt;code\u0026gt;cursor.execute(\u0026quot;SET CHARACTER SET utf8mb4\u0026quot;)\u0026lt;/code\u0026gt;\n\u0026lt;code\u0026gt;cursor.execute(\u0026quot;SET character_set_connection=utf8mb4\u0026quot;)\u0026lt;/code\u0026gt;\n*\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;If it does not work, happy hunting for the right solution.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Set your code IDE language to UTF-8\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Add \u0026amp;lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026amp;gt; to your webpage header where you collect data form.\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Check your MySQL table definition looks like this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TABLE\u0026lt;/span\u0026gt; your_table (\n   ...\n ) ENGINE\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;InnoDB \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DEFAULT\u0026lt;/span\u0026gt; CHARSET\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;utf8\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;If you are using \u0026lt;a href=\u0026quot;https://en.wikipedia.org/wiki/PHP#Development_and_community\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;PDO\u0026lt;/a\u0026gt;, make sure\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;(PDO::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;MYSQL_ATTR_INIT_COMMAND\u0026lt;/span\u0026gt;=\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SET NAMES utf8\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbL\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;PDO\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$pdo\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$user\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$pass\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;If you already got a large database with above problem, you can try SIDU to export with correct charset, and import back with UTF-8.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Depending on how the server is setup, you have to change the encode accordingly. utf8 from what you said should work the best. However, if you\u0026apos;re getting weird characters, it might help if you change the webpage encoding to ANSI.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;This helped me when I was setting up a PHP \u0026lt;a href=\u0026quot;https://en.wikipedia.org/wiki/MySQLi\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;MySQLi\u0026lt;/a\u0026gt;. This might help you understand more: \u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;https://superuser.com/questions/762473/ansi-to-utf-8-in-notepad\u0026quot;\u0026gt;ANSI to UTF-8 in Notepad++\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n    "],"comment":["\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;If the client, database and tables are in \u0026lt;code\u0026gt;utf8mb4\u0026lt;/code\u0026gt; I seem to be able to store emojis fine. Some blogs suggest also setting \u0026lt;code\u0026gt;collation-server\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;character-set-server\u0026lt;/code\u0026gt; in mysqld. Do I really need to change \u0026lt;code\u0026gt;mysqld\u0026lt;/code\u0026gt; what difference does server setting make?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1376627/david-adler\u0026quot; title=\u0026quot;7,538 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;david_adler\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment83517861_38363567\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2018-01-15 16:50:51Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 15, 2018 at 16:50\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@david_adler - There are multiple ways to get the effect of those settings.  The best is to use the clients connection parameters.  Second best by executing \u0026lt;code\u0026gt;SET NAMES utf8mb4\u0026lt;/code\u0026gt; right after connecting.  After all, this is declaring the encoding in the \u0026lt;i\u0026gt;client\u0026lt;/i\u0026gt;.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1766831/rick-james\u0026quot; title=\u0026quot;124,178 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;Rick James\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment83521194_38363567\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2018-01-15 18:47:28Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 15, 2018 at 18:47\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;With MySQL 8.0 (now released), the default is \u0026lt;code\u0026gt;utf8mb4\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;utf8mb4_0900_ai_ci\u0026lt;/code\u0026gt;.  Most users should use them without considering the other charsets and collations.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1766831/rick-james\u0026quot; title=\u0026quot;124,178 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;Rick James\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment87548468_38363567\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2018-05-10 03:56:55Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;May 10, 2018 at 3:56\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Tips on configuring \u0026lt;a href=\u0026quot;http://mysql.rjweb.org/doc.php/charcoll#python\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;i\u0026gt;Python\u0026lt;/i\u0026gt;\u0026lt;/a\u0026gt;, \u0026lt;a href=\u0026quot;http://mysql.rjweb.org/doc.php/charcoll#php\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;i\u0026gt;PHP\u0026lt;/i\u0026gt;\u0026lt;/a\u0026gt;, and about \u0026lt;a href=\u0026quot;http://mysql.rjweb.org/doc.php/charcoll#other_computer_languages\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;i\u0026gt;40 other languages\u0026lt;/i\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1766831/rick-james\u0026quot; title=\u0026quot;124,178 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;Rick James\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment89199980_38363567\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2018-06-29 17:06:06Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jun 29, 2018 at 17:06\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Another note:  If a \u0026lt;code\u0026gt;FUNCTION\u0026lt;/code\u0026gt; or \u0026lt;code\u0026gt;STORED PROCEDURE\u0026lt;/code\u0026gt; is involved, you may have not been using the desired charset when you created it.  \u0026lt;code\u0026gt;DROP\u0026lt;/code\u0026gt; it, \u0026lt;code\u0026gt;SET NAMES\u0026lt;/code\u0026gt;; re-\u0026lt;code\u0026gt;CREATE\u0026lt;/code\u0026gt; it.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1766831/rick-james\u0026quot; title=\u0026quot;124,178 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;Rick James\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment94897836_38363567\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2019-01-03 22:35:32Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 3, 2019 at 22:35\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Yes, that is one of several things that can cause character set problems.  Note: that syntax is valid for PHP, not other app languages, and only if using \u0026lt;code\u0026gt;mysqli\u0026lt;/code\u0026gt;, not \u0026lt;code\u0026gt;PDO\u0026lt;/code\u0026gt;.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1766831/rick-james\u0026quot; title=\u0026quot;124,178 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;Rick James\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment97422344_55327611\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2019-03-26 02:05:17Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Mar 26, 2019 at 2:05\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;1 month?  That was fast.  It took me more than a year to formulate this Q\u0026amp;amp;A.  Java looks right.  \u0026lt;code\u0026gt;SETs\u0026lt;/code\u0026gt; are not the \u0026apos;right\u0026apos; way for Python; see \u0026lt;a href=\u0026quot;http://mysql.rjweb.org/doc.php/charcoll#python\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;mysql.rjweb.org/doc.php/charcoll#python\u0026lt;/a\u0026gt;  Many other languages are discussed elsewhere in that blog.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1766831/rick-james\u0026quot; title=\u0026quot;124,178 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;Rick James\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment105016105_59413841\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2019-12-19 17:24:39Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Dec 19, 2019 at 17:24\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@RickJames But this issue exist with Mysql-Python below 1.2.4, so the \u0026lt;code\u0026gt;SET\u0026lt;/code\u0026gt; statements are basically a work around.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/12566393/ashish-bhatt\u0026quot; title=\u0026quot;29 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Ashish Bhatt\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment111631692_59413841\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2020-07-28 06:33:08Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 28, 2020 at 6:33\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;How is the content near \u0026quot;cursor.execute\u0026quot; supposed to be formatted? Separate lines for each one? Or something else? Is \u0026quot;*\u0026quot; literate or intended as italics formatting?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/63550/peter-mortensen\u0026quot; title=\u0026quot;30,018 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Peter Mortensen\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment126968021_59413841\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2022-04-12 23:40:51Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Apr 12 at 23:40\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 2 times\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;The \u0026lt;code\u0026gt;DEFAULT CHARSET\u0026lt;/code\u0026gt; for a table is just that, a default.  It can, and sometimes should, be overridden on the column definition.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1766831/rick-james\u0026quot; title=\u0026quot;124,178 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;Rick James\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment64141669_38363823\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-07-14 03:04:36Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 14, 2016 at 3:04\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;PDO is better done with the charset option:  \u0026lt;code\u0026gt;$db = new PDO(\u0026apos;dblib:host=host;dbname=db;charset=UTF8\u0026apos;, $user, $pwd);\u0026lt;/code\u0026gt;  (This is listed in the link to my \u0026apos;charcoll\u0026apos; document.)\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1766831/rick-james\u0026quot; title=\u0026quot;124,178 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;Rick James\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment64141697_38363823\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-07-14 03:06:45Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 14, 2016 at 3:06\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;You are 20K more expert than me :) Yes you can set charset for a column. Try not to over-use it. End up with more management time. Similarly you can grant access to a certain column of a MySQL table. However you do not have to use it unless you do not have better alternative.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/4715024/sidu\u0026quot; title=\u0026quot;2,228 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;SIDU\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment64141729_38363823\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-07-14 03:09:25Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 14, 2016 at 3:09\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@ppmakeitcount: no, the \u0026lt;code\u0026gt;ALTER DATABASE\u0026lt;/code\u0026gt; statement does not require a restart of MySQL to take affect. However, changing the default characterset for a database does \u0026lt;i\u0026gt;not\u0026lt;/i\u0026gt; affect any tables currently in the database; it only has an effect on new tables e.g. \u0026lt;code\u0026gt;CREATE TABLE\u0026lt;/code\u0026gt; which do not specify a default characterset for the table; that\u0026apos;s when the database default characterset comes into play. (Similarly, changing the default characterset of the table does not affect columns already in the table; it only has an effect on columns added to the table, when no column characterset is specified.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/107744/spencer7593\u0026quot; title=\u0026quot;103,786 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;spencer7593\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment81361504_38363823\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2017-11-09 16:01:31Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Nov 9, 2017 at 16:01\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@bballdave025 - Thanks.  It took me a long time -- first to discover all the different cases, then to figure out what caused each one, then more time to figure out how to explain them succinctly.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1766831/rick-james\u0026quot; title=\u0026quot;124,178 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;Rick James\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment123545987_38363823\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2021-11-08 23:32:45Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Nov 8, 2021 at 23:32\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Notepad\u0026apos;s \u0026lt;code\u0026gt;ANSI\u0026lt;/code\u0026gt; is probably closest to MySQL\u0026apos;s \u0026lt;code\u0026gt;latin1\u0026lt;/code\u0026gt;.  The 0x93 in that link is \u0026lt;code\u0026gt;\u0026lt;/code\u0026gt; and probably came from some place like Word.  You could either convert to utf8 (hex \u0026lt;code\u0026gt;E2809C\u0026lt;/code\u0026gt;) or tell MySQL that the data is \u0026lt;code\u0026gt;latin1\u0026lt;/code\u0026gt; and hope that you don\u0026apos;t trip up somewhere else.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1766831/rick-james\u0026quot; title=\u0026quot;124,178 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;Rick James\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment64871845_38748800\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-08-03 16:27:07Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 3, 2016 at 16:27\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        "],"id":159,"title":"Trouble with UTF-8 characters; what I see is not what I stored","content":"\n                \n\u0026lt;p\u0026gt;I tried to use UTF-8 and ran into trouble.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I have tried so many things; here are the results I have gotten:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;????\u0026lt;/code\u0026gt; instead of Asian characters. Even for European text, I got \u0026lt;code\u0026gt;Se?or\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;Señor\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Strange gibberish (Mojibake?) such as \u0026lt;code\u0026gt;SeÃ±or\u0026lt;/code\u0026gt; or \u0026lt;code\u0026gt;æ–°æµªæ–°é—»\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;新浪新闻\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Black diamonds, such as Se�or.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Finally, I got into a situation where the data was lost, or at least truncated: \u0026lt;code\u0026gt;Se\u0026lt;/code\u0026gt; for \u0026lt;code\u0026gt;Señor\u0026lt;/code\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Even when I got text to \u0026lt;em\u0026gt;look\u0026lt;/em\u0026gt; right, it did not \u0026lt;em\u0026gt;sort\u0026lt;/em\u0026gt; correctly.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;What am I doing wrong? How can I fix the \u0026lt;em\u0026gt;code\u0026lt;/em\u0026gt;? Can I recover the \u0026lt;em\u0026gt;data\u0026lt;/em\u0026gt;, if so, how?\u0026lt;/p\u0026gt;\n    ","slug":"trouble-with-utf-8-characters-what-i-see-is-not-what-i-stored-1657384817490","postType":"QUESTION","createdAt":"2022-07-09T16:40:17.000Z","updatedAt":"2022-07-09T16:40:17.000Z","tags":[{"id":580,"name":"unicode","slug":"unicode","createdAt":"2022-07-09T16:40:17.000Z","updatedAt":"2022-07-09T16:40:17.000Z","Questions_Tags":{"questionId":159,"tagId":580}}]}]}},"__N_SSG":true},"page":"/questions/tag/[slug]","query":{"slug":"unicode"},"buildId":"4Y8KGE-c2lolBeBmcum_I","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>