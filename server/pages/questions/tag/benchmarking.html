<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2eccd4d47c856f2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2eccd4d47c856f2b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-20edbe0b078add93.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/613-1e0aa2b2023820bb.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/81-096e453de8a27667.js" defer=""></script><script src="/_next/static/chunks/pages/questions/tag/%5Bslug%5D-6802ea06aeddcbec.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_buildManifest.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5"></style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="https://flowbite.com/docs/images/logo.svg" class="mr-3 h-6 sm:h-9" alt="Flowbite Logo"/><span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Hunter</span></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/tag/benchmarking#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="flex items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725">How do I write a correct micro-benchmark in Java?</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/benchmarking">benchmarking</a></div></div><div class="mt-4 mb-6" style="height:100px;overflow:auto"><h4 class="font-semibold">Solution 1:</h4><div class="text-sm bg-green-100 text-neutral-600">
<p>Tips about writing micro benchmarks <a href="https://wiki.openjdk.java.net/display/HotSpot/Main" rel="noreferrer">from the creators of Java HotSpot</a>:</p>

<p><strong>Rule 0:</strong> Read a reputable paper on JVMs and micro-benchmarking. A good one is <a href="http://www.ibm.com/developerworks/java/library/j-jtp02225" rel="noreferrer">Brian Goetz, 2005</a>. Do not expect too much from micro-benchmarks; they measure only a limited range of JVM performance characteristics.</p>

<p><strong>Rule 1:</strong> Always include a warmup phase which runs your test kernel all the way through, enough to trigger all initializations and compilations before timing phase(s). (Fewer iterations is OK on the warmup phase. The rule of thumb is several tens of thousands of inner loop iterations.)</p>

<p><strong>Rule 2:</strong> Always run with <code>-XX:+PrintCompilation</code>, <code>-verbose:gc</code>, etc., so you can verify that the compiler and other parts of the JVM are not doing unexpected work during your timing phase.</p>

<p><strong>Rule 2.1:</strong> Print messages at the beginning and end of timing and warmup phases, so you can verify that there is no output from Rule 2 during the timing phase.</p>

<p><strong>Rule 3:</strong> Be aware of the difference between <code>-client</code> and <code>-server</code>, and OSR and regular compilations. The <code>-XX:+PrintCompilation</code> flag reports OSR compilations with an at-sign to denote the non-initial entry point, for example: <code>Trouble$1::run @ 2 (41 bytes)</code>. Prefer server to client, and regular to OSR, if you are after best performance.</p>

<p><strong>Rule 4:</strong> Be aware of initialization effects. Do not print for the first time during your timing phase, since printing loads and initializes classes. Do not load new classes outside of the warmup phase (or final reporting phase), unless you are testing class loading specifically (and in that case load only the test classes). Rule 2 is your first line of defense against such effects.</p>

<p><strong>Rule 5:</strong> Be aware of deoptimization and recompilation effects. Do not take any code path for the first time in the timing phase, because the compiler may junk and recompile the code, based on an earlier optimistic assumption that the path was not going to be used at all. Rule 2 is your first line of defense against such effects.</p>

<p><strong>Rule 6:</strong> Use appropriate tools to read the compiler's mind, and expect to be surprised by the code it produces. Inspect the code yourself before forming theories about what makes something faster or slower.</p>

<p><strong>Rule 7:</strong> Reduce noise in your measurements. Run your benchmark on a quiet machine, and run it several times, discarding outliers. Use <code>-Xbatch</code> to serialize the compiler with the application, and consider setting <code>-XX:CICompilerCount=1</code> to prevent the compiler from running in parallel with itself. Try your best to reduce GC overhead, set <code>Xmx</code>(large enough) equals <code>Xms</code> and use <a href="http://openjdk.java.net/jeps/318" rel="noreferrer"><code>UseEpsilonGC</code></a> if it is available.</p>

<p><strong>Rule 8:</strong> Use a library for your benchmark as it is probably more efficient and was already debugged for this sole purpose. Such as <a href="http://openjdk.java.net/projects/code-tools/jmh/" rel="noreferrer">JMH</a>, <a href="https://github.com/google/caliper" rel="noreferrer">Caliper</a> or <a href="http://cseweb.ucsd.edu/users/wgg/JavaProf/javaprof.html" rel="noreferrer">Bill and Paul's Excellent UCSD Benchmarks for Java</a>.  </p>
    </div></div><div><div class="flex items-center justify-between text-slate-500"><div class="flex space-x-4 md:space-x-8"><div class="flex cursor-pointer items-center transition hover:text-slate-600"><svg xmlns="http://www.w3.org/2000/svg" class="mr-1.5 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path></svg><span>4</span></div></div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"count":1,"rows":[{"answer":["\n\u0026lt;p\u0026gt;Tips about writing micro benchmarks \u0026lt;a href=\u0026quot;https://wiki.openjdk.java.net/display/HotSpot/Main\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;from the creators of Java HotSpot\u0026lt;/a\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 0:\u0026lt;/strong\u0026gt; Read a reputable paper on JVMs and micro-benchmarking. A good one is \u0026lt;a href=\u0026quot;http://www.ibm.com/developerworks/java/library/j-jtp02225\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Brian Goetz, 2005\u0026lt;/a\u0026gt;. Do not expect too much from micro-benchmarks; they measure only a limited range of JVM performance characteristics.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 1:\u0026lt;/strong\u0026gt; Always include a warmup phase which runs your test kernel all the way through, enough to trigger all initializations and compilations before timing phase(s). (Fewer iterations is OK on the warmup phase. The rule of thumb is several tens of thousands of inner loop iterations.)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 2:\u0026lt;/strong\u0026gt; Always run with \u0026lt;code\u0026gt;-XX:+PrintCompilation\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;-verbose:gc\u0026lt;/code\u0026gt;, etc., so you can verify that the compiler and other parts of the JVM are not doing unexpected work during your timing phase.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 2.1:\u0026lt;/strong\u0026gt; Print messages at the beginning and end of timing and warmup phases, so you can verify that there is no output from Rule 2 during the timing phase.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 3:\u0026lt;/strong\u0026gt; Be aware of the difference between \u0026lt;code\u0026gt;-client\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;-server\u0026lt;/code\u0026gt;, and OSR and regular compilations. The \u0026lt;code\u0026gt;-XX:+PrintCompilation\u0026lt;/code\u0026gt; flag reports OSR compilations with an at-sign to denote the non-initial entry point, for example: \u0026lt;code\u0026gt;Trouble$1::run @ 2 (41 bytes)\u0026lt;/code\u0026gt;. Prefer server to client, and regular to OSR, if you are after best performance.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 4:\u0026lt;/strong\u0026gt; Be aware of initialization effects. Do not print for the first time during your timing phase, since printing loads and initializes classes. Do not load new classes outside of the warmup phase (or final reporting phase), unless you are testing class loading specifically (and in that case load only the test classes). Rule 2 is your first line of defense against such effects.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 5:\u0026lt;/strong\u0026gt; Be aware of deoptimization and recompilation effects. Do not take any code path for the first time in the timing phase, because the compiler may junk and recompile the code, based on an earlier optimistic assumption that the path was not going to be used at all. Rule 2 is your first line of defense against such effects.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 6:\u0026lt;/strong\u0026gt; Use appropriate tools to read the compiler\u0026apos;s mind, and expect to be surprised by the code it produces. Inspect the code yourself before forming theories about what makes something faster or slower.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 7:\u0026lt;/strong\u0026gt; Reduce noise in your measurements. Run your benchmark on a quiet machine, and run it several times, discarding outliers. Use \u0026lt;code\u0026gt;-Xbatch\u0026lt;/code\u0026gt; to serialize the compiler with the application, and consider setting \u0026lt;code\u0026gt;-XX:CICompilerCount=1\u0026lt;/code\u0026gt; to prevent the compiler from running in parallel with itself. Try your best to reduce GC overhead, set \u0026lt;code\u0026gt;Xmx\u0026lt;/code\u0026gt;(large enough) equals \u0026lt;code\u0026gt;Xms\u0026lt;/code\u0026gt; and use \u0026lt;a href=\u0026quot;http://openjdk.java.net/jeps/318\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;UseEpsilonGC\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; if it is available.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Rule 8:\u0026lt;/strong\u0026gt; Use a library for your benchmark as it is probably more efficient and was already debugged for this sole purpose. Such as \u0026lt;a href=\u0026quot;http://openjdk.java.net/projects/code-tools/jmh/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;JMH\u0026lt;/a\u0026gt;, \u0026lt;a href=\u0026quot;https://github.com/google/caliper\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Caliper\u0026lt;/a\u0026gt; or \u0026lt;a href=\u0026quot;http://cseweb.ucsd.edu/users/wgg/JavaProf/javaprof.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Bill and Paul\u0026apos;s Excellent UCSD Benchmarks for Java\u0026lt;/a\u0026gt;.  \u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I know this question has been marked as answered but I wanted to mention two libraries that help us to write micro benchmarks\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;a href=\u0026quot;https://github.com/google/caliper\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Caliper from Google\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Getting started tutorials\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://codingjunkie.net/micro-benchmarking-with-caliper/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;http://codingjunkie.net/micro-benchmarking-with-caliper/\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://vertexlabs.co.uk/blog/caliper\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;http://vertexlabs.co.uk/blog/caliper\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;a href=\u0026quot;http://openjdk.java.net/projects/code-tools/jmh/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;JMH from OpenJDK\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Getting started tutorials\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://www.oracle.com/technetwork/articles/java/architect-benchmarking-2266277.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Avoiding Benchmarking Pitfalls on the JVM\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://nitschinger.at/Using-JMH-for-Java-Microbenchmarking\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Using JMH for Java Microbenchmarking\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;https://web.archive.org/web/20181018130828/http://java-performance.info:80/jmh\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Introduction to JMH\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Important things for Java benchmarks are:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Warm up the JIT first by running the code several times \u0026lt;strong\u0026gt;before timing\u0026lt;/strong\u0026gt; it\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Make sure you run it for long enough to be able to measure the results in seconds or (better) tens of seconds\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;While you can\u0026apos;t call \u0026lt;code\u0026gt;System.gc()\u0026lt;/code\u0026gt; between iterations, it\u0026apos;s a good idea to run it between tests, so that each test will hopefully get a \u0026quot;clean\u0026quot; memory space to work with. (Yes, \u0026lt;code\u0026gt;gc()\u0026lt;/code\u0026gt; is more of a hint than a guarantee, but it\u0026apos;s very \u0026lt;em\u0026gt;likely\u0026lt;/em\u0026gt; that it really will garbage collect in my experience.)\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;I like to display iterations and time, and a score of time/iteration which can be scaled such that the \u0026quot;best\u0026quot; algorithm gets a score of 1.0 and others are scored in a relative fashion. This means you can run \u0026lt;em\u0026gt;all\u0026lt;/em\u0026gt; algorithms for a longish time, varying both number of iterations and time, but still getting comparable results.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;I\u0026apos;m just in the process of blogging about the design of a benchmarking framework in .NET. I\u0026apos;ve got a \u0026lt;a href=\u0026quot;http://msmvps.com/blogs/jon_skeet/archive/2009/01/26/benchmarking-made-easy.aspx\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;couple\u0026lt;/a\u0026gt; of \u0026lt;a href=\u0026quot;http://msmvps.com/blogs/jon_skeet/archive/2009/01/29/for-vs-foreach-on-arrays-and-lists.aspx\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;earlier posts\u0026lt;/a\u0026gt; which may be able to give you some ideas - not everything will be appropriate, of course, but some of it may be.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://openjdk.java.net/projects/code-tools/jmh/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;jmh\u0026lt;/a\u0026gt; is a recent addition to OpenJDK and has been written by some performance engineers from Oracle. Certainly worth a look.\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;The jmh is a Java harness for building, running, and analysing nano/micro/macro benchmarks written in Java and other languages targetting the JVM.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;Very interesting pieces of information buried in \u0026lt;a href=\u0026quot;http://hg.openjdk.java.net/code-tools/jmh/file/tip/jmh-samples/src/main/java/org/openjdk/jmh/samples/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;the sample tests comments\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;See also:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;http://www.oracle.com/technetwork/articles/java/architect-benchmarking-2266277.html\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Avoiding Benchmarking Pitfalls on the JVM\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;a href=\u0026quot;https://groups.google.com/forum/#!msg/mechanical-sympathy/m4opvy4xq3U/7lY8x8SvHgwJ\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Discussion on the main strengths of jmh\u0026lt;/a\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;Should the benchmark measure time/iteration or iterations/time, and why?\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;It depends on \u0026lt;strong\u0026gt;what\u0026lt;/strong\u0026gt; you are trying to test.  \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;If you are interested in \u0026lt;strong\u0026gt;latency\u0026lt;/strong\u0026gt;, use time/iteration and if you are interested in \u0026lt;strong\u0026gt;throughput\u0026lt;/strong\u0026gt;, use iterations/time.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Make sure you somehow use results which are computed in benchmarked code. Otherwise your code can be optimized away.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;If you are trying to compare two algorithms, do at least two benchmarks for each, alternating the order.  i.e.:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(i=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1.\u0026lt;/span\u0026gt;.n)\n  alg1();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(i=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1.\u0026lt;/span\u0026gt;.n)\n  alg2();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(i=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1.\u0026lt;/span\u0026gt;.n)\n  alg2();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(i=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1.\u0026lt;/span\u0026gt;.n)\n  alg1();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;I have found some noticeable differences (5-10% sometimes) in the runtime of the same algorithm in different passes..\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Also, make sure that \u0026lt;em\u0026gt;n\u0026lt;/em\u0026gt; is very large, so that the runtime of each loop is at the very least 10 seconds or so.  The more iterations, the more significant figures in your benchmark time and the more reliable that data is.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;There are many possible pitfalls for writing micro-benchmarks in Java.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;First: You have to calculate with all sorts of events that take time more or less random: Garbage collection, caching effects (of OS for files and of CPU for memory), IO etc.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Second: You cannot trust the accuracy of the measured times for very short intervals.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Third: The JVM optimizes your code while executing. So different runs in the same JVM-instance will become faster and faster.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;My recommendations: Make your benchmark run some seconds, that is more reliable than a runtime over milliseconds. Warm up the JVM (means running the benchmark at least once without measuring, that the JVM can run optimizations). And run your benchmark multiple times (maybe 5 times) and take the median-value. Run every micro-benchmark in a new JVM-instance (call for every benchmark new Java) otherwise optimization effects of the JVM can influence later running tests. Don\u0026apos;t execute things, that aren\u0026apos;t executed in the warmup-phase (as this could trigger class-load and recompilation).\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;It should also be noted that it might also be important to analyze the results of the micro benchmark when comparing different implementations. Therefore a \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Significance_testing\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;significance test\u0026lt;/a\u0026gt; should be made.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This is because implementation \u0026lt;code\u0026gt;A\u0026lt;/code\u0026gt; might be faster during most of the runs of the benchmark than implementation \u0026lt;code\u0026gt;B\u0026lt;/code\u0026gt;. But \u0026lt;code\u0026gt;A\u0026lt;/code\u0026gt; might also have a higher spread, so the measured performance benefit of \u0026lt;code\u0026gt;A\u0026lt;/code\u0026gt; won\u0026apos;t be of any significance when compared with \u0026lt;code\u0026gt;B\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;So it is also important to write and run a micro benchmark correctly, but also to analyze it correctly.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;To add to the other excellent advice, I\u0026apos;d also be mindful of the following:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For some CPUs (e.g. Intel Core i5 range with TurboBoost), the temperature (and number of cores currently being used, as well as thier utilisation percent) affects the clock speed. Since CPUs are dynamically clocked, this can affect your results. For example, if you have a single-threaded application, the maximum clock speed (with TurboBoost) is higher than for an application using all cores. This can therefore interfere with comparisons of single and multi-threaded performance on some systems. Bear in mind that the temperature and volatages also affect how long Turbo frequency is maintained.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Perhaps a more fundamentally important aspect that you have direct control over: make sure you\u0026apos;re measuring the right thing! For example, if you\u0026apos;re using \u0026lt;code\u0026gt;System.nanoTime()\u0026lt;/code\u0026gt; to benchmark a particular bit of code, put the calls to the assignment in places that make sense to avoid measuring things which you aren\u0026apos;t interested in. For example, don\u0026apos;t do:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;long\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;startTime\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; System.nanoTime();\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//code here...\u0026lt;/span\u0026gt;\nSystem.out.println(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Code took \u0026quot;\u0026lt;/span\u0026gt;+(System.nanoTime()-startTime)+\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;nano seconds\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Problem is you\u0026apos;re not immediately getting the end time when the code has finished. Instead, try the following:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;final\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;long\u0026lt;/span\u0026gt; endTime, startTime = System.nanoTime();\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//code here...\u0026lt;/span\u0026gt;\nendTime = System.nanoTime();\nSystem.out.println(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Code took \u0026quot;\u0026lt;/span\u0026gt;+(endTime-startTime)+\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;nano seconds\u0026quot;\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://opt.sourceforge.net/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;http://opt.sourceforge.net/\u0026lt;/a\u0026gt; Java Micro Benchmark - control tasks required to determine the comparative performance characteristics of the computer system on different platforms. Can be used to guide optimization decisions and to compare different Java implementations.\u0026lt;/p\u0026gt;\n    "],"comment":["\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;See [this question][1] from a few minutes ago for some related info.    edit: sorry, this is not supposed to be a answer. I should\u0026apos;ve posted as a comment.      [1]: \u0026lt;a href=\u0026quot;http://stackoverflow.com/questions/503877/how-can-i-measure-time-with-microsecond-precision-in-java\u0026quot; title=\u0026quot;how can i measure time with microsecond precision in java\u0026quot;\u0026gt;stackoverflow.com/questions/503877/\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/55283/tiago\u0026quot; title=\u0026quot;8,999 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Tiago\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment5404785_504103\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2011-02-01 14:07:10Z, License: CC BY-SA 2.5\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Feb 1, 2011 at 14:07\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Java 9 might provide some features for micro-benchmarking: \u0026lt;a href=\u0026quot;http://openjdk.java.net/jeps/230\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;openjdk.java.net/jeps/230\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/545127/raedwald\u0026quot; title=\u0026quot;43,888 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Raedwald\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment48526263_504103\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-05-13 09:33:45Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;May 13, 2015 at 9:33\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@Raedwald I think that that JEP aims to add some micro benchmark to the JDK code, but I don\u0026apos;t think that jmh will be included in the JDK...\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/829571/assylias\u0026quot; title=\u0026quot;311,273 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;assylias\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment55805039_504103\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-12-01 16:11:36Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Dec 1, 2015 at 16:11\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@Raedwald Hello from the future. \u0026lt;a href=\u0026quot;http://openjdk.java.net/projects/jdk9/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;It didn\u0026apos;t make the cut\u0026lt;/a\u0026gt;.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1898563/michael\u0026quot; title=\u0026quot;38,248 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Michael\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment79367155_504103\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2017-09-13 16:03:40Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 13, 2017 at 16:03\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;See: \u0026lt;a href=\u0026quot;http://openjdk.java.net/projects/code-tools/jmh/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;i\u0026gt;JMH, a Java harness for building, running, and analysing nano/micro/milli/macro benchmarks\u0026lt;/i\u0026gt;\u0026lt;/a\u0026gt; and \u0026lt;a href=\u0026quot;http://openjdk.java.net/jeps/230\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;i\u0026gt;JEP 230: Microbenchmark Suite\u0026lt;/i\u0026gt;\u0026lt;/a\u0026gt; and duplicate Question \u0026lt;a href=\u0026quot;https://stackoverflow.com/q/37067929/642706\u0026quot;\u0026gt;\u0026lt;i\u0026gt;Best approach for dealing with time measures?\u0026lt;/i\u0026gt;\u0026lt;/a\u0026gt;.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/642706/basil-bourque\u0026quot; title=\u0026quot;266,257 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Basil Bourque\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment83303481_504103\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2018-01-09 05:43:39Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 9, 2018 at 5:43\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 3 times\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;This was also an interesting article: \u0026lt;a href=\u0026quot;http://www.ibm.com/developerworks/java/library/j-jtp12214/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;ibm.com/developerworks/java/library/j-jtp12214\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/24243/john-nilsson\u0026quot; title=\u0026quot;16,671 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;John Nilsson\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment3323001_513259\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2010-07-10 22:29:41Z, License: CC BY-SA 2.5\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 10, 2010 at 22:29\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Also, never use System.currentTimeMillis() unless you are OK with + or - 15 ms accuracy, which is typical on most OS + JVM combinations.  Use System.nanoTime() instead.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/589907/scott-carey\u0026quot; title=\u0026quot;1,533 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Scott Carey\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment6593773_513259\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2011-04-22 18:43:06Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Apr 22, 2011 at 18:43\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Some paper from javaOne: \u0026lt;a href=\u0026quot;http://www.azulsystems.com/events/javaone_2009/session/2009_J1_Benchmark.pdf\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;azulsystems.com/events/javaone_2009/session/\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/554431/bestsss\u0026quot; title=\u0026quot;11,384 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;bestsss\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment7277852_513259\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2011-06-05 12:29:39Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jun 5, 2011 at 12:29\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;It should be noted that \u0026lt;code\u0026gt;System.nanoTime()\u0026lt;/code\u0026gt; is not \u0026lt;i\u0026gt;guaranteed\u0026lt;/i\u0026gt; to be more accurate than \u0026lt;code\u0026gt;System.currentTimeMillis()\u0026lt;/code\u0026gt;.  It is only guaranteed to be at least as accurate.  It usually is substantially more accurate, however.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/847333/gravity\u0026quot; title=\u0026quot;2,638 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Gravity\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment8131770_513259\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2011-07-27 08:00:00Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 27, 2011 at 8:00\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;The main reason why one must use \u0026lt;code\u0026gt;System.nanoTime()\u0026lt;/code\u0026gt; instead of \u0026lt;code\u0026gt;System.currentTimeMillis()\u0026lt;/code\u0026gt; is that the former is guaranteed to be monotonically increasing. Subtracting the values returned two \u0026lt;code\u0026gt;currentTimeMillis\u0026lt;/code\u0026gt; invocations can actually give negative results, possibly because the system time was adjusted by some NTP daemon.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/450811/waldheinz\u0026quot; title=\u0026quot;10,328 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Waldheinz\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment46383615_513259\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-03-16 10:51:48Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Mar 16, 2015 at 10:51\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;+1 it could have been added as Rule 8 of the accepted answer: Rule 8: because so many things can go wrong, you should probably use an existing library rather than trying to do it yourself!\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/829571/assylias\u0026quot; title=\u0026quot;311,273 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;assylias\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment18904622_4480774\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2012-12-06 23:58:25Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Dec 6, 2012 at 23:58\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@Pangea jmh is probably superior to Caliper nowadays, See also: \u0026lt;a href=\u0026quot;https://groups.google.com/forum/#!msg/mechanical-sympathy/m4opvy4xq3U/7lY8x8SvHgwJ\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;groups.google.com/forum/#!msg/mechanical-sympathy/m4opvy4xq3U/\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/829571/assylias\u0026quot; title=\u0026quot;311,273 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;assylias\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment55878483_4480774\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-12-03 09:49:14Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Dec 3, 2015 at 9:49\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Minor nitpick: IMO \u0026quot;so that each test gets\u0026quot; should be \u0026quot;so that each test might get\u0026quot; since the former gives the impression that calling \u0026lt;code\u0026gt;gc\u0026lt;/code\u0026gt; \u0026lt;i\u0026gt;always\u0026lt;/i\u0026gt; frees up unused memory.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/193906/sanjay-t-sharma\u0026quot; title=\u0026quot;22,331 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Sanjay T. Sharma\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment23019378_504119\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-04-20 06:52:06Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Apr 20, 2013 at 6:52\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@SanjayT.Sharma: Well, the \u0026lt;i\u0026gt;intention\u0026lt;/i\u0026gt; is that it actually does. While it\u0026apos;s not strictly guaranteed, it\u0026apos;s actually a pretty strong hint. Will edit to be clearer.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/22656/jon-skeet\u0026quot; title=\u0026quot;1,342,492 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Jon Skeet\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment23020256_504119\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-04-20 08:02:18Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Apr 20, 2013 at 8:02\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;I don\u0026apos;t agree with calling System.gc(). It is a hint, that\u0026apos;s all. Not even \u0026quot;it will hopefully do something\u0026quot;. You should never ever call it. This is programming, not art.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/972932/gyorgyabraham\u0026quot; title=\u0026quot;2,462 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;gyorgyabraham\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment24748322_504119\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-06-14 10:38:16Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jun 14, 2013 at 10:38\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@gyabraham: Yes, it\u0026apos;s a hint - but it\u0026apos;s one which I\u0026apos;ve observed to usually be taken. So if you don\u0026apos;t like using \u0026lt;code\u0026gt;System.gc()\u0026lt;/code\u0026gt;, how do you propose to minimize garbage collection in one test due to objects created in previous tests? I\u0026apos;m pragmatic, not dogmatic.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/22656/jon-skeet\u0026quot; title=\u0026quot;1,342,492 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Jon Skeet\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment24748899_504119\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-06-14 10:58:52Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jun 14, 2013 at 10:58\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@gyabraham: I don\u0026apos;t know what you mean by \u0026quot;great fallback\u0026quot;. Can you elaborate, and again - do you have a proposal to give better results? I did explicitly say that it\u0026apos;s not a guarantee...\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/22656/jon-skeet\u0026quot; title=\u0026quot;1,342,492 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Jon Skeet\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment24762323_504119\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-06-14 17:44:34Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jun 14, 2013 at 17:44\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;See also this blog post: \u0026lt;a href=\u0026quot;http://psy-lob-saw.blogspot.com/2013/04/writing-java-micro-benchmarks-with-jmh.html\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;psy-lob-saw.blogspot.com/2013/04/\u0026lt;/a\u0026gt; for details on getting started with JMH.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1047667/nitsan-wakart\u0026quot; title=\u0026quot;2,713 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Nitsan Wakart\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment23408537_15787478\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-05-02 15:41:49Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;May 2, 2013 at 15:41\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 3 times\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;FYI, \u0026lt;a href=\u0026quot;http://openjdk.java.net/jeps/230\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;JEP 230: Microbenchmark Suite\u0026lt;/a\u0026gt; is an \u0026lt;a href=\u0026quot;http://openjdk.java.net/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;OpenJDK\u0026lt;/a\u0026gt; proposal based on this \u0026lt;a href=\u0026quot;http://openjdk.java.net/projects/code-tools/jmh/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Java Microbenchmark Harness (JMH)\u0026lt;/a\u0026gt; project. \u0026lt;a href=\u0026quot;http://mail.openjdk.java.net/pipermail/jdk9-dev/2016-March/003894.html\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Did not make the cut for Java 9\u0026lt;/a\u0026gt; but may be added later.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/642706/basil-bourque\u0026quot; title=\u0026quot;266,257 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Basil Bourque\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment63738984_15787478\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-07-01 23:03:11Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 1, 2016 at 23:03\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 2 times\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Naturally changing the order influences the runtime. JVM-optimizations and caching-effects are going to work here. Better is to \u0026apos;warm up\u0026apos; the JVM-optimization, mak multiple runs and benchmark every test in a different JVM.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/21005/mnementh\u0026quot; title=\u0026quot;48,915 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Mnementh\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment318932_504162\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2009-02-02 18:04:23Z, License: CC BY-SA 2.5\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Feb 2, 2009 at 18:04\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Actually I\u0026apos;d say that for most benchmarking you want the warmed-up version, I\u0026apos;d suggest that if you are running for 10 seconds (as per above recommendation), you only count the last 5 seconds--throw out the first 5.  Remember that java compiles code at some point.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/12943/bill-k\u0026quot; title=\u0026quot;61,238 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Bill K\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment126737080_504162\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2022-04-01 21:56:26Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Apr 1 at 21:56\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Yes it\u0026apos;s important to not do unrelated work inside the timed region, but your first example is still fine.  There\u0026apos;s only one call to \u0026lt;code\u0026gt;println\u0026lt;/code\u0026gt;, not a separate header line or something, and \u0026lt;code\u0026gt;System.nanoTime()\u0026lt;/code\u0026gt; has to be evaluated as the \u0026lt;i\u0026gt;first\u0026lt;/i\u0026gt; step in constructing the string arg for that call.  There\u0026apos;s nothing a compiler can do with the first that they can\u0026apos;t do with the second, and neither one is even encouraging them to do extra work before recording a stop time.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/224132/peter-cordes\u0026quot; title=\u0026quot;289,881 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Peter Cordes\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment97351238_42891083\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2019-03-23 08:44:10Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Mar 23, 2019 at 8:44\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Seems to just benchmark the JVM + hardware, not an arbitrary piece of Java code.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/218139/stefan-l\u0026quot; title=\u0026quot;1,499 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Stefan L\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment12040121_4480713\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2012-02-29 22:05:31Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Feb 29, 2012 at 22:05\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        "],"id":73,"title":"How do I write a correct micro-benchmark in Java?","content":"\n                \n\u0026lt;p\u0026gt;How do you write (and run) a correct micro-benchmark in Java?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I\u0026apos;m looking for some code samples and comments illustrating various things to think about.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Example: Should the benchmark measure time/iteration or iterations/time, and why?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Related: \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/410437/is-stopwatch-benchmarking-acceptable\u0026quot;\u0026gt;Is stopwatch benchmarking acceptable?\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","slug":"how-do-i-write-a-correct-micro-benchmark-in-java-1657384488725","postType":"QUESTION","createdAt":"2022-07-09T16:34:48.000Z","updatedAt":"2022-07-09T16:34:48.000Z","tags":[{"id":266,"name":"benchmarking","slug":"benchmarking","createdAt":"2022-07-09T16:34:48.000Z","updatedAt":"2022-07-09T16:34:48.000Z","Questions_Tags":{"questionId":73,"tagId":266}}]}]}},"__N_SSG":true},"page":"/questions/tag/[slug]","query":{"slug":"benchmarking"},"buildId":"4Y8KGE-c2lolBeBmcum_I","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>