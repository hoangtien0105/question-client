<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@solutionschecker.com"/><meta name="twitter:creator" content="@solutionschecker.com"/><meta property="og:url" content="https://solutionschecker.com"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solutionschecker.com/solutions-checker-banner.png"/><meta property="og:image:alt" content="Find solution for coding, HTML, CSS, JAVASCRIPT, MYSQL, PHP, PYTHON,... quickly. - solutionschecker.com"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","logo":"/logo.svg","url":"https://solutionschecker.com"}</script><title>compiler-optimization tags | Solutions Checker</title><meta name="robots" content="index,follow"/><meta name="description" content="All questions and solutions for compiler-optimization tags - page 1"/><meta property="og:title" content="compiler-optimization tags | Solutions Checker"/><meta property="og:description" content="All questions and solutions for compiler-optimization tags - page 1"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/08bcc42a26fe5c92.css" as="style"/><link rel="stylesheet" href="/_next/static/css/08bcc42a26fe5c92.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-42cdea76c8170223.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-08d1a634dea6705e.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/150-12e9794e898cd5f3.js" defer=""></script><script src="/_next/static/chunks/816-14d8d742fae4ce97.js" defer=""></script><script src="/_next/static/chunks/108-87de33c23337ff53.js" defer=""></script><script src="/_next/static/chunks/pages/questions/tag/%5Bslug%5D/page/%5Bpage%5D-5805d34c9503b8cf.js" defer=""></script><script src="/_next/static/BnkbnjkWYxefPXjTJLVVv/_buildManifest.js" defer=""></script><script src="/_next/static/BnkbnjkWYxefPXjTJLVVv/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="wrapper"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="/logo-second.png" class="mr-3 h-6 sm:h-9" alt="Solution Checker Logo"/><h4 class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Checker</h4></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/tag/compiler-optimization/page/1#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="pagination-page-wrapper"><span class="pagination-buttons previous bg-stone-500 cursor-not-allowed  hover:bg-stone-500 text-white font-bold py-2 px-4 rounded">Previous</span></div><div class="question my-5"><div class="flex items-center justify-center"><div class="rounded-xl border p-5 shadow-md post-layout-inner bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/how-to-remove-%22noise%22-from-gccclang-assembly-output-1657387612391">How to remove &quot;noise&quot; from GCC/clang assembly output?</a></div></div></div><div class="tags-wrap h-max space-x-8"><div class="tags-wrap h-max space-x-8"><div class="tags"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold whitespace-nowrap" href="/questions/tag/compiler-optimization">compiler-optimization</a></div></div></div><div><div class="flex items-center justify-between text-slate-500"><div class="flex space-x-4 md:space-x-8"><span class="btn bg-stone-500 cursor-pointer  hover:bg-stone-500 text-white font-bold py-2 px-4 rounded">Show Solution</span></div></div></div></div></div></div><div class="pagination-page-wrapper"><span class="pagination-buttons next bg-stone-500 cursor-not-allowed  hover:bg-stone-500 text-white font-bold py-2 px-4 rounded">Next</span></div><div class="widget"><a href="/questions/tag/c++">c++</a><a href="/questions/tag/reshape2">reshape2</a><a href="/questions/tag/dependent-name">dependent-name</a><a href="/questions/tag/hex">hex</a><a href="/questions/tag/access-modifiers">access-modifiers</a><a href="/questions/tag/deserialization">deserialization</a><a href="/questions/tag/utc">utc</a><a href="/questions/tag/asynchronous">asynchronous</a><a href="/questions/tag/google-cloud-firestore">google-cloud-firestore</a><a href="/questions/tag/compiler-errors">compiler-errors</a><a href="/questions/tag/authentication">authentication</a><a href="/questions/tag/kill">kill</a><a href="/questions/tag/expected-condition">expected-condition</a><a href="/questions/tag/variables">variables</a><a href="/questions/tag/scriptlet">scriptlet</a><a href="/questions/tag/user-interface">user-interface</a><a href="/questions/tag/lambda">lambda</a><a href="/questions/tag/asp.net-mvc">asp.net-mvc</a><a href="/questions/tag/argument-unpacking">argument-unpacking</a><a href="/questions/tag/datetime-format">datetime-format</a></div></div><span class="cursor-pointer text-lg p-2" style="position:fixed;bottom:20px;left:20px;background:#000;z-index:2000;color:white">Go go top</span></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"count":1,"rows":[{"id":317,"title":"How to remove \"noise\" from GCC/clang assembly output?","slug":"how-to-remove-\"noise\"-from-gccclang-assembly-output-1657387612391","postType":"QUESTION","createdAt":"2022-07-09T17:26:52.000Z","updatedAt":"2022-07-09T17:26:52.000Z","tags":[{"id":1859,"name":"compiler-optimization","slug":"compiler-optimization","createdAt":"2022-07-09T17:26:52.000Z","updatedAt":"2022-07-09T17:26:52.000Z","Questions_Tags":{"questionId":317,"tagId":1859}}]}]},"slug":"compiler-optimization","page":"1","answers":{"317":["\n\u0026lt;p\u0026gt;Stripping out the \u0026lt;code\u0026gt;.cfi\u0026lt;/code\u0026gt; directives, unused labels, and comment lines is a solved problem: the scripts behind \u0026lt;a href=\u0026quot;http://gcc.godbolt.org/#compilers:!((compiler:g530,options:%27-std%3Dgnu%2B%2B14+-Wall+-Wextra++-O3+-fno-verbose-asm+-ffast-math+-march%3Dhaswell%27,source:%27%23include+%3Cboost/variant.hpp%3E%0A%0Astruct+Foo%0A%7B%0A++++int+get()+%7B+return+100%3B+%7D%0A%7D%3B%0A%0Astruct+Bar%0A%7B%0A++++int+get()+%7B+return+999%3B+%7D%0A%7D%3B%0A%0Ausing+Variant+%3D+boost::variant%3CFoo,+Bar%3E%3B%0A%0A%0Aint+run(Variant+v)%0A%7B%0A++++return+boost::apply_visitor(%5B%5D(auto%26+x)%7Breturn+x.get()%3B%7D,+v)%3B%0A%7D%0Aint+main()%0A%7B%0A++++Foo+f%3B%0A++++return+run(f)%3B%0A%7D%0A%27)),filterAsm:(commentOnly:!t,directives:!t,intel:!t,labels:!t),version:3\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Matt Godbolt\u0026apos;s compiler explorer\u0026lt;/a\u0026gt; are open source on \u0026lt;a href=\u0026quot;https://github.com/mattgodbolt/gcc-explorer\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;its github project\u0026lt;/a\u0026gt;.  It can even do colour highlighting to match source lines to asm lines (using the debug info).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;You can set it up locally so you can feed it files that are part of your project with all the \u0026lt;code\u0026gt;#include\u0026lt;/code\u0026gt; paths and so on (using \u0026lt;code\u0026gt;-I/...\u0026lt;/code\u0026gt;).  And so you can use it on private source code that you don\u0026apos;t want to send out over the Internet.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Matt Godbolt\u0026apos;s CppCon2017 talk \u0026lt;a href=\u0026quot;https://youtu.be/bSkpMdDe4g4\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;What Has My Compiler Done for Me Lately? Unbolting the Compiler\u0026apos;s Lid\u0026lt;/a\u0026gt; shows how to use it\u0026lt;/strong\u0026gt; (it\u0026apos;s pretty self-explanatory but has some neat features if you read the docs on github), and also \u0026lt;strong\u0026gt;how to read x86 asm\u0026lt;/strong\u0026gt;, with a gentle introduction to x86 asm itself for total beginners, and to looking at compiler output.  He goes on to show some neat compiler optimizations (e.g. for dividing by a constant), and what kind of functions give useful asm output for looking at optimized compiler output (function args, not \u0026lt;code\u0026gt;int a = 123;\u0026lt;/code\u0026gt;).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;On the Godbolt compiler explorer, it can be useful to use \u0026lt;code\u0026gt;-g0 -fno-asynchronous-unwind-tables\u0026lt;/code\u0026gt; if you want to uncheck the filter option for directives, e.g. because you want to see the \u0026lt;code\u0026gt;.section\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;.p2align\u0026lt;/code\u0026gt; stuff in the compiler output.  The default is to add \u0026lt;code\u0026gt;-g\u0026lt;/code\u0026gt; to your options to get the debug info it uses to colour-highlight matching source and asm lines, but this means \u0026lt;code\u0026gt;.cfi\u0026lt;/code\u0026gt; directives for every stack operation, and \u0026lt;code\u0026gt;.loc\u0026lt;/code\u0026gt; for every source line, among other things.\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;With plain gcc/clang (not g++), \u0026lt;code\u0026gt;-fno-asynchronous-unwind-tables\u0026lt;/code\u0026gt; avoids \u0026lt;code\u0026gt;.cfi\u0026lt;/code\u0026gt; directives.  Possibly also useful: \u0026lt;code\u0026gt;-fno-exceptions -fno-rtti\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;-masm=intel\u0026lt;/code\u0026gt;.  Make sure to omit \u0026lt;code\u0026gt;-g\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Copy/paste this for local use\u0026lt;/strong\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;g++ -fno-asynchronous-unwind-tables -fno-exceptions -fno-rtti -fverbose-\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;asm\u0026lt;/span\u0026gt; \\\n    -Wall -Wextra  foo.cpp   -O3 -masm=intel -S -o- | less\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Or \u0026lt;code\u0026gt;-Os\u0026lt;/code\u0026gt; can be more readable, e.g. using \u0026lt;code\u0026gt;div\u0026lt;/code\u0026gt; for division by non-power-of-2 constants instead of a multiplicative inverse even though that\u0026apos;s a lot worse for performance and only a bit smaller, if at all.\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;But really, I\u0026apos;d recommend just using Godbolt directly (online or set it up locally)!  You can quickly flip between versions of gcc and clang to see if old or new compilers do something dumb.  (Or what ICC does, or even what MSVC does.)  There\u0026apos;s even ARM / ARM64 gcc 6.3, and various gcc for PowerPC, MIPS, AVR, MSP430.  (It can be interesting to see what happens on a machine where \u0026lt;code\u0026gt;int\u0026lt;/code\u0026gt; is wider than a register, or isn\u0026apos;t 32-bit.  Or on a RISC vs. x86).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For C instead of C++, you can use \u0026lt;code\u0026gt;-xc -std=gnu11\u0026lt;/code\u0026gt; to avoid flipping the language drop-down to C, which resets your source pane and compiler choices, and has a different set of compilers available.\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Useful compiler options for making asm for human consumption\u0026lt;/strong\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Remember, your code only has to compile, not link: passing a pointer to an external function like \u0026lt;code\u0026gt;void ext(void*p)\u0026lt;/code\u0026gt; is a good way to stop something from optimizing away\u0026lt;/strong\u0026gt;.  You only need a prototype for it, with no definition so the compiler can\u0026apos;t inline it or make any assumptions about what it does.  (Or \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/40122141/preventing-compiler-optimizations-while-benchmarking\u0026quot;\u0026gt;inline asm like \u0026lt;code\u0026gt;Benchmark::DoNotOptimize\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; can force a compiler to materialize a value in a register, or forget about it being a known constant, if you know GNU C inline asm syntax well enough to use constraints to understand the effect you\u0026apos;re having on what you\u0026apos;re requiring of the compiler.)\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;I\u0026apos;d recommend using \u0026lt;code\u0026gt;-O3 -Wall -Wextra -fverbose-asm -march=haswell\u0026lt;/code\u0026gt; for looking at code.  (\u0026lt;code\u0026gt;-fverbose-asm\u0026lt;/code\u0026gt; can just make the source look noisy, though, when all you get are numbered temporaries as names for the operands.)  When you\u0026apos;re fiddling with the source to see how it changes the asm, you \u0026lt;em\u0026gt;definitely\u0026lt;/em\u0026gt; want compiler warnings enabled.  You don\u0026apos;t want to waste time scratching your head over the asm when the explanation is that you did something that deserves a warning in the source.\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;To see how the calling convention works, \u0026lt;strong\u0026gt;you often want to look at caller and callee without inlining\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;You can use \u0026lt;code\u0026gt;__attribute__((noipa)) foo_t foo(bar_t x) { ... }\u0026lt;/code\u0026gt; on a definition, or compile with \u0026lt;code\u0026gt;gcc -O3 -fno-inline-functions -fno-inline-functions-called-once -fno-inline-small-functions\u0026lt;/code\u0026gt; to disable inlining.  (But those command line options don\u0026apos;t disable cloning a function for constant-propagation.  \u0026lt;code\u0026gt;noipa\u0026lt;/code\u0026gt; = no Inter-Procedural Analysis.  It\u0026apos;s even stronger than \u0026lt;code\u0026gt;__attribute__((noinline,noclone))\u0026lt;/code\u0026gt;.)  See \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/50775127/from-compiler-perspective-how-is-reference-for-array-dealt-with-and-why-passi\u0026quot;\u0026gt;From compiler perspective, how is reference for array dealt with, and, why passing by value(not decay) is not allowed?\u0026lt;/a\u0026gt; for an example.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Or if you just want to see how functions pass / receive args of different types, you could use different names but the same prototype so the compiler doesn\u0026apos;t have a definition to inline.  This works with any compiler.  Without a definition, a function is just a black box to the optimizer, governed only by the calling convention / ABI.\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;-ffast-math\u0026lt;/code\u0026gt; will get many libm functions to inline, some to a single instruction (esp. with SSE4 available for \u0026lt;code\u0026gt;roundsd\u0026lt;/code\u0026gt;).  Some will inline with just \u0026lt;code\u0026gt;-fno-math-errno\u0026lt;/code\u0026gt;, or other \u0026quot;safer\u0026quot; parts of \u0026lt;code\u0026gt;-ffast-math\u0026lt;/code\u0026gt;, without the parts that allow the compiler to round differently.  If you have FP code, definitely look at it with/without \u0026lt;code\u0026gt;-ffast-math\u0026lt;/code\u0026gt;.  If you can\u0026apos;t safely enable any of \u0026lt;code\u0026gt;-ffast-math\u0026lt;/code\u0026gt; in your regular build, maybe you\u0026apos;ll get an idea for a safe change you can make in the source to allow the same optimization without \u0026lt;code\u0026gt;-ffast-math\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;code\u0026gt;-O3 -fno-tree-vectorize\u0026lt;/code\u0026gt; will optimize without auto-vectorizing\u0026lt;/strong\u0026gt;, so you can get full optimization without if you want to compare with \u0026lt;code\u0026gt;-O2\u0026lt;/code\u0026gt; (which doesn\u0026apos;t enable autovectorization on gcc11 and earlier, but does on all clang).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;code\u0026gt;-Os\u0026lt;/code\u0026gt; (optimize for size and speed) can be helpful\u0026lt;/strong\u0026gt; to keep the code more compact, which means less code to understand.    clang\u0026apos;s \u0026lt;code\u0026gt;-Oz\u0026lt;/code\u0026gt; optimizes for size even when it hurts speed, even using \u0026lt;code\u0026gt;push 1\u0026lt;/code\u0026gt; / \u0026lt;code\u0026gt;pop rax\u0026lt;/code\u0026gt; instead of \u0026lt;code\u0026gt;mov eax, 1\u0026lt;/code\u0026gt;, so that\u0026apos;s only interesting for \u0026lt;a href=\u0026quot;https://codegolf.stackexchange.com/questions/132981/tips-for-golfing-in-x86-x64-machine-code\u0026quot;\u0026gt;code golf\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Even \u0026lt;code\u0026gt;-Og\u0026lt;/code\u0026gt; (minimal optimization) might be what you want to look at, depending on your goals.  \u0026lt;code\u0026gt;-O0\u0026lt;/code\u0026gt; is full of store/reload noise, which makes it harder to follow, \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/53366394/why-does-clang-produce-inefficient-asm-with-o0-for-this-simple-floating-point\u0026quot;\u0026gt;unless you use \u0026lt;code\u0026gt;register\u0026lt;/code\u0026gt; vars\u0026lt;/a\u0026gt;.  The only upside is that each C statement compiles to a separate block of instructions, and it makes \u0026lt;code\u0026gt;-fverbose-asm\u0026lt;/code\u0026gt; able to use the actual C var names.\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;clang unrolls loops by default, so \u0026lt;strong\u0026gt;\u0026lt;code\u0026gt;-fno-unroll-loops\u0026lt;/code\u0026gt; can be useful in complex functions\u0026lt;/strong\u0026gt;.  You can get a sense of \u0026quot;what the compiler did\u0026quot; without having to wade through the unrolled loops.  (gcc enables \u0026lt;code\u0026gt;-funroll-loops\u0026lt;/code\u0026gt; with \u0026lt;code\u0026gt;-fprofile-use\u0026lt;/code\u0026gt;, but not with \u0026lt;code\u0026gt;-O3\u0026lt;/code\u0026gt;).  (This is a suggestion for human-readable code, not for code that would run faster.)\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Definitely enable some level of optimization, unless you specifically want to know what \u0026lt;code\u0026gt;-O0\u0026lt;/code\u0026gt; did\u0026lt;/strong\u0026gt;.  Its \u0026quot;predictable debug behaviour\u0026quot; requirement makes the compiler store/reload everything between every C statement, so you can modify C variables with a debugger and even \u0026quot;jump\u0026quot; to a different source line within the same function, and have execution continue as if you did that in the C source.  \u0026lt;code\u0026gt;-O0\u0026lt;/code\u0026gt; output is so noisy with stores/reloads (and so slow) not just from lack of optimization, but \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/53366394/why-does-clang-produce-inefficient-asm-with-o0-for-this-simple-floating-point\u0026quot;\u0026gt;forced de-optimization to support debugging\u0026lt;/a\u0026gt;.  (also \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/46638527/when-will-the-trivial-code-that-has-no-effect-code-gets-removed-in-compilation/46640101#46640101\u0026quot;\u0026gt;related\u0026lt;/a\u0026gt;).\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;To get a mix of source and asm\u0026lt;/strong\u0026gt;, use \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/137479/224132\u0026quot;\u0026gt;\u0026lt;code\u0026gt;gcc -Wa,-adhln -c -g foo.c | less\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; to pass extra options to \u0026lt;code\u0026gt;as\u0026lt;/code\u0026gt;.  (More discussion of this in \u0026lt;a href=\u0026quot;http://www.systutorials.com/240/generate-a-mixed-source-and-assembly-listing-using-gcc/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;a blog post\u0026lt;/a\u0026gt;, and \u0026lt;a href=\u0026quot;https://panthema.net/2013/0124-GCC-Output-Assembler-Code/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;another blog\u0026lt;/a\u0026gt;.).  Note that the output of this isn\u0026apos;t valid assembler input, because the C source is there directly, not as an assembler comment.  So don\u0026apos;t call it a \u0026lt;code\u0026gt;.s\u0026lt;/code\u0026gt;.  A \u0026lt;code\u0026gt;.lst\u0026lt;/code\u0026gt; might make sense if you want to save it to a file.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Godbolt\u0026apos;s color highlighting serves a similar purpose, and is great at helping you see when multiple \u0026lt;em\u0026gt;non-contiguous\u0026lt;/em\u0026gt; asm instructions come from the same source line.  I haven\u0026apos;t used that gcc listing command at all, so IDK how well it does, and how easy it is for the eye to see, in that case.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I like the high code density of godbolt\u0026apos;s asm pane, so I don\u0026apos;t think I\u0026apos;d like having source lines mixed in.  At least not for simple functions.  Maybe with a function that was too complex to get a handle on the overall structure of what the asm does...\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;And remember, when you want to just look at the asm, \u0026lt;strong\u0026gt;leave out the \u0026lt;code\u0026gt;main()\u0026lt;/code\u0026gt; and the compile-time constants\u0026lt;/strong\u0026gt;.  You want to see the code for dealing with a function arg in a register, not for the code after constant-propagation turns it into \u0026lt;code\u0026gt;return 42\u0026lt;/code\u0026gt;, or at least optimizes away some stuff.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Removing \u0026lt;code\u0026gt;static\u0026lt;/code\u0026gt; and/or \u0026lt;code\u0026gt;inline\u0026lt;/code\u0026gt; from functions will produce a stand-alone definition for them, as well as a definition for any callers, so you can just look at that.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Don\u0026apos;t put your code in a function called \u0026lt;code\u0026gt;main()\u0026lt;/code\u0026gt;\u0026lt;/strong\u0026gt;.  gcc knows that \u0026lt;code\u0026gt;main\u0026lt;/code\u0026gt; is special and assumes it will only be called once, so it marks it as \u0026quot;cold\u0026quot; and optimizes it less.\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;The other thing you can do: If you did make a \u0026lt;code\u0026gt;main()\u0026lt;/code\u0026gt;, you can run it and use a debugger.  \u0026lt;code\u0026gt;stepi\u0026lt;/code\u0026gt; (\u0026lt;code\u0026gt;si\u0026lt;/code\u0026gt;) steps by instruction.  See the bottom of the \u0026lt;a href=\u0026quot;/questions/tagged/x86\u0026quot; class=\u0026quot;post-tag\u0026quot; title=\u0026quot;show questions tagged \u0026apos;x86\u0026apos;\u0026quot; rel=\u0026quot;tag\u0026quot;\u0026gt;x86\u0026lt;/a\u0026gt; \u0026lt;a href=\u0026quot;https://stackoverflow.com/tags/x86/info\u0026quot;\u0026gt;tag wiki\u0026lt;/a\u0026gt; for instructions.  But remember that code might optimize away after inlining into main with compile-time-constant args.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;__attribute__((noinline))\u0026lt;/code\u0026gt; may help, on a function that you want to not be inlined.  gcc will also make constant-propagation clones of functions, i.e. a special version with one of the args as a constant, for call-sites that know they\u0026apos;re passing a constant.  The symbol name will be \u0026lt;code\u0026gt;.clone.foo.constprop_1234\u0026lt;/code\u0026gt; or something in the asm output. You can use \u0026lt;code\u0026gt;__attribute__((noclone))\u0026lt;/code\u0026gt; to disable that, too.).\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;h2\u0026gt;For example\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;If you want to see how the compiler multiplies two integers:  I put the following code \u0026lt;a href=\u0026quot;http://gcc.godbolt.org/#compilers:!((compiler:g530,options:%27-xc+-std%3Dgnu11+-Wall+-Wextra++-O3+-fverbose-asm+-ffast-math+-march%3Dhaswell%27,source:%27int+constants()+%7B+int+a+%3D+10,+b+%3D+20%3B+return+a+*+b%3B+%7D%0Aint+variables(int+a,+int+b)+%7B+return+a+*+b%3B+%7D%0A%27)),filterAsm:(commentOnly:!t,directives:!t,intel:!t,labels:!t),version:3\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;on the Godbolt compiler explorer\u0026lt;/a\u0026gt; to get the asm (from \u0026lt;code\u0026gt;gcc -O3 -march=haswell -fverbose-asm\u0026lt;/code\u0026gt;) for the wrong way and the right way to test this.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-csharp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// the wrong way, which people often write when they\u0026apos;re used to creating a runnable test-case with a main() and a printf\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// or worse, people will actually look at the asm for such a main()\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;constants\u0026lt;/span\u0026gt;()\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; a = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;, b = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; a * b; }\n    mov     eax, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;200\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;#,\u0026lt;/span\u0026gt;\n    ret                     \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# compiles the same as  return 200;  not interesting\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// the right way: compiler doesn\u0026apos;t know anything about the inputs\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// so we get asm like what would happen when this inlines into a bigger function.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;variables\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; a, \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; b\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt; { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; a * b; }\n    mov     eax, edi  \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# D.2345, a\u0026lt;/span\u0026gt;\n    imul    eax, esi        \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# D.2345, b\u0026lt;/span\u0026gt;\n    ret\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;(This mix of asm and C was hand-crafted by copy-pasting the asm output from godbolt into the right place.  I find it\u0026apos;s a good way to show how a short function compiles in SO answers / compiler bug reports / emails.)\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;You can always look at the generated assembly from the object file, instead of using the compilers assembly output. \u0026lt;code\u0026gt;objdump\u0026lt;/code\u0026gt; comes to mind.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You can even tell \u0026lt;code\u0026gt;objdump\u0026lt;/code\u0026gt; to intermix source with assembly, making it easier to figure out what source line corresponds to what instructions. Example session:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-csharp\u0026quot;\u0026gt;$ cat test.\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;cc\n\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; arg\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt;\n{\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; arg * \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;42\u0026lt;/span\u0026gt;;\n}\n\n$ g++ -g -O3 -std=c++\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;14\u0026lt;/span\u0026gt; -c test.cc -o test.o \u0026amp;amp;\u0026amp;amp; objdump -dS -M intel test.o\n\ntest.o:     file format elf64-x86\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-64\u0026lt;/span\u0026gt;\n\n\nDisassembly of section .text:\n\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0000000000000000\u0026lt;/span\u0026gt; \u0026amp;lt;_Z3fooi\u0026amp;gt;:\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; arg\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt;\n{\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; arg + \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;;\n   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;:   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8\u0026lt;/span\u0026gt;d \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;47\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;01\u0026lt;/span\u0026gt;                lea    eax,[rdi+\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0x1\u0026lt;/span\u0026gt;]\n}\n   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;:   c3                      ret    \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Explanation of \u0026lt;code\u0026gt;objdump\u0026lt;/code\u0026gt; flags:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;-d\u0026lt;/code\u0026gt; disassembles all executable sections\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;-S\u0026lt;/code\u0026gt; intermixes assembly with source (\u0026lt;code\u0026gt;-g\u0026lt;/code\u0026gt; required while compiling with \u0026lt;code\u0026gt;g++\u0026lt;/code\u0026gt;)\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;-M intel\u0026lt;/code\u0026gt; choses intel syntax over ugly AT\u0026amp;amp;T syntax (\u0026lt;em\u0026gt;optional\u0026lt;/em\u0026gt;)\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I like to insert labels that I can easily grep out of the objdump output.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;default s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;asm\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;volatile\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;interesting_part_begin%=:\u0026quot;\u0026lt;/span\u0026gt;:)\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;do_something\u0026lt;/span\u0026gt;();\n    \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;asm\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;volatile\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;interesting_part_end%=:\u0026quot;\u0026lt;/span\u0026gt;:)\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;I haven\u0026apos;t had a problem with this yet, but \u0026lt;code\u0026gt;asm volatile\u0026lt;/code\u0026gt; can be very hard on a compiler\u0026apos;s optimizer because it tends to leave such code untouched.\u0026lt;/p\u0026gt;\n    "]},"randomTags":[{"name":"c++","slug":"c++"},{"name":"reshape2","slug":"reshape2"},{"name":"dependent-name","slug":"dependent-name"},{"name":"hex","slug":"hex"},{"name":"access-modifiers","slug":"access-modifiers"},{"name":"deserialization","slug":"deserialization"},{"name":"utc","slug":"utc"},{"name":"asynchronous","slug":"asynchronous"},{"name":"google-cloud-firestore","slug":"google-cloud-firestore"},{"name":"compiler-errors","slug":"compiler-errors"},{"name":"authentication","slug":"authentication"},{"name":"kill","slug":"kill"},{"name":"expected-condition","slug":"expected-condition"},{"name":"variables","slug":"variables"},{"name":"scriptlet","slug":"scriptlet"},{"name":"user-interface","slug":"user-interface"},{"name":"lambda","slug":"lambda"},{"name":"asp.net-mvc","slug":"asp.net-mvc"},{"name":"argument-unpacking","slug":"argument-unpacking"},{"name":"datetime-format","slug":"datetime-format"}]},"__N_SSG":true},"page":"/questions/tag/[slug]/page/[page]","query":{"slug":"compiler-optimization","page":"1"},"buildId":"BnkbnjkWYxefPXjTJLVVv","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>