<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2eccd4d47c856f2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2eccd4d47c856f2b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-20edbe0b078add93.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/613-1e0aa2b2023820bb.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/81-096e453de8a27667.js" defer=""></script><script src="/_next/static/chunks/pages/questions/tag/%5Bslug%5D-6802ea06aeddcbec.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_buildManifest.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5"></style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="https://flowbite.com/docs/images/logo.svg" class="mr-3 h-6 sm:h-9" alt="Flowbite Logo"/><span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Hunter</span></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/tag/orm#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="flex items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/what-is-the-%22n+1-selects-problem%22-in-orm-(object-relational-mapping)-1657388055597">What is the &quot;N+1 selects problem&quot; in ORM (Object-Relational Mapping)?</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/orm">orm</a></div></div><div class="mt-4 mb-6" style="height:100px;overflow:auto"><h4 class="font-semibold">Solution 1:</h4><div class="text-sm bg-green-100 text-neutral-600">
<p>Let's say you have a collection of <code>Car</code> objects (database rows), and each <code>Car</code> has a collection of <code>Wheel</code> objects (also rows).  In other words, <code>Car</code>  <code>Wheel</code> is a 1-to-many relationship.</p>
<p>Now, let's say you need to iterate through all the cars, and for each one, print out a list of the wheels. The naive O/R implementation would do the following:</p>
<pre><code>SELECT * FROM Cars;
</code></pre>
<p>And then <strong>for each <code>Car</code>:</strong></p>
<pre><code>SELECT * FROM Wheel WHERE CarId = ?
</code></pre>
<p>In other words, you have one select for the Cars, and then N additional selects, where N is the total number of cars.</p>
<p>Alternatively, one could get all wheels and perform the lookups in memory:</p>
<pre><code>SELECT * FROM Wheel
</code></pre>
<p>This reduces the number of round-trips to the database from N+1 to 2.
Most ORM tools give you several ways to prevent N+1 selects.</p>
<p>Reference: <em><a href="http://www.manning.com/bauer2/" rel="noreferrer">Java Persistence with Hibernate</a></em>, chapter 13.</p>
    </div></div><div><div class="flex items-center justify-between text-slate-500"><div class="flex space-x-4 md:space-x-8"><div class="flex cursor-pointer items-center transition hover:text-slate-600"><svg xmlns="http://www.w3.org/2000/svg" class="mr-1.5 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path></svg><span>4</span></div></div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"count":1,"rows":[{"answer":["\n\u0026lt;p\u0026gt;Let\u0026apos;s say you have a collection of \u0026lt;code\u0026gt;Car\u0026lt;/code\u0026gt; objects (database rows), and each \u0026lt;code\u0026gt;Car\u0026lt;/code\u0026gt; has a collection of \u0026lt;code\u0026gt;Wheel\u0026lt;/code\u0026gt; objects (also rows).  In other words, \u0026lt;code\u0026gt;Car\u0026lt;/code\u0026gt;  \u0026lt;code\u0026gt;Wheel\u0026lt;/code\u0026gt; is a 1-to-many relationship.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Now, let\u0026apos;s say you need to iterate through all the cars, and for each one, print out a list of the wheels. The naive O/R implementation would do the following:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;SELECT * FROM Cars;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;And then \u0026lt;strong\u0026gt;for each \u0026lt;code\u0026gt;Car\u0026lt;/code\u0026gt;:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;SELECT * FROM Wheel WHERE CarId = ?\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;In other words, you have one select for the Cars, and then N additional selects, where N is the total number of cars.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Alternatively, one could get all wheels and perform the lookups in memory:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;SELECT * FROM Wheel\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;This reduces the number of round-trips to the database from N+1 to 2.\nMost ORM tools give you several ways to prevent N+1 selects.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Reference: \u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;http://www.manning.com/bauer2/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Java Persistence with Hibernate\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;, chapter 13.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;h2\u0026gt;What is the N+1 query problem\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;The N+1 query problem happens when the data access framework executed N additional SQL statements to fetch the same data that could have been retrieved when executing the primary SQL query.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The larger the value of N, the more queries will be executed, the larger the performance impact. And, unlike the slow query log that can help you find slow running queries, the N+1 issue wont be spot because each individual additional query runs sufficiently fast to not trigger the slow query log.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The problem is executing a large number of additional queries that, overall, take sufficient time to slow down response time.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Lets consider we have the following post and post_comments database tables which form a one-to-many table relationship:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://i.stack.imgur.com/T1uWG.png\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;https://i.stack.imgur.com/T1uWG.png\u0026quot; alt=\u0026quot;The post and post_comments tables\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;We are going to create the following 4 \u0026lt;code\u0026gt;post\u0026lt;/code\u0026gt; rows:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;INSERT INTO post (title, id)\nVALUES (\u0026apos;High-Performance Java Persistence - Part 1\u0026apos;, 1)\n \nINSERT INTO post (title, id)\nVALUES (\u0026apos;High-Performance Java Persistence - Part 2\u0026apos;, 2)\n \nINSERT INTO post (title, id)\nVALUES (\u0026apos;High-Performance Java Persistence - Part 3\u0026apos;, 3)\n \nINSERT INTO post (title, id)\nVALUES (\u0026apos;High-Performance Java Persistence - Part 4\u0026apos;, 4)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;And, we will also create 4 \u0026lt;code\u0026gt;post_comment\u0026lt;/code\u0026gt; child records:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;INSERT INTO post_comment (post_id, review, id)\nVALUES (1, \u0026apos;Excellent book to understand Java Persistence\u0026apos;, 1)\n \nINSERT INTO post_comment (post_id, review, id)\nVALUES (2, \u0026apos;Must-read for Java developers\u0026apos;, 2)\n \nINSERT INTO post_comment (post_id, review, id)\nVALUES (3, \u0026apos;Five Stars\u0026apos;, 3)\n \nINSERT INTO post_comment (post_id, review, id)\nVALUES (4, \u0026apos;A great reference book\u0026apos;, 4)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;h2\u0026gt;N+1 query problem with plain SQL\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;If you select the \u0026lt;code\u0026gt;post_comments\u0026lt;/code\u0026gt; using this SQL query:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;List\u0026amp;lt;Tuple\u0026amp;gt; comments = entityManager.createNativeQuery(\u0026quot;\u0026quot;\u0026quot;\n    SELECT\n        pc.id AS id,\n        pc.review AS review,\n        pc.post_id AS postId\n    FROM post_comment pc\n    \u0026quot;\u0026quot;\u0026quot;, Tuple.class)\n.getResultList();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;And, later, you decide to fetch the associated \u0026lt;code\u0026gt;post\u0026lt;/code\u0026gt; \u0026lt;code\u0026gt;title\u0026lt;/code\u0026gt; for each \u0026lt;code\u0026gt;post_comment\u0026lt;/code\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;for (Tuple comment : comments) {\n    String review = (String) comment.get(\u0026quot;review\u0026quot;);\n    Long postId = ((Number) comment.get(\u0026quot;postId\u0026quot;)).longValue();\n \n    String postTitle = (String) entityManager.createNativeQuery(\u0026quot;\u0026quot;\u0026quot;\n        SELECT\n            p.title\n        FROM post p\n        WHERE p.id = :postId\n        \u0026quot;\u0026quot;\u0026quot;)\n    .setParameter(\u0026quot;postId\u0026quot;, postId)\n    .getSingleResult();\n \n    LOGGER.info(\n        \u0026quot;The Post \u0026apos;{}\u0026apos; got this review \u0026apos;{}\u0026apos;\u0026quot;,\n        postTitle,\n        review\n    );\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;You are going to trigger the N+1 query issue because, instead of one SQL query, you executed 5 (1 + 4):\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;SELECT\n    pc.id AS id,\n    pc.review AS review,\n    pc.post_id AS postId\nFROM post_comment pc\n \nSELECT p.title FROM post p WHERE p.id = 1\n-- The Post \u0026apos;High-Performance Java Persistence - Part 1\u0026apos; got this review\n-- \u0026apos;Excellent book to understand Java Persistence\u0026apos;\n    \nSELECT p.title FROM post p WHERE p.id = 2\n-- The Post \u0026apos;High-Performance Java Persistence - Part 2\u0026apos; got this review\n-- \u0026apos;Must-read for Java developers\u0026apos;\n     \nSELECT p.title FROM post p WHERE p.id = 3\n-- The Post \u0026apos;High-Performance Java Persistence - Part 3\u0026apos; got this review\n-- \u0026apos;Five Stars\u0026apos;\n     \nSELECT p.title FROM post p WHERE p.id = 4\n-- The Post \u0026apos;High-Performance Java Persistence - Part 4\u0026apos; got this review\n-- \u0026apos;A great reference book\u0026apos;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Fixing the N+1 query issue is very easy. All you need to do is extract all the data you need in the original SQL query, like this:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;List\u0026amp;lt;Tuple\u0026amp;gt; comments = entityManager.createNativeQuery(\u0026quot;\u0026quot;\u0026quot;\n    SELECT\n        pc.id AS id,\n        pc.review AS review,\n        p.title AS postTitle\n    FROM post_comment pc\n    JOIN post p ON pc.post_id = p.id\n    \u0026quot;\u0026quot;\u0026quot;, Tuple.class)\n.getResultList();\n \nfor (Tuple comment : comments) {\n    String review = (String) comment.get(\u0026quot;review\u0026quot;);\n    String postTitle = (String) comment.get(\u0026quot;postTitle\u0026quot;);\n \n    LOGGER.info(\n        \u0026quot;The Post \u0026apos;{}\u0026apos; got this review \u0026apos;{}\u0026apos;\u0026quot;,\n        postTitle,\n        review\n    );\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;This time, only one SQL query is executed to fetch all the data we are further interested in using.\u0026lt;/p\u0026gt;\n\u0026lt;h2\u0026gt;N+1 query problem with JPA and Hibernate\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;When using JPA and Hibernate, there are several ways you can trigger the N+1 query issue, so its very important to know how you can avoid these situations.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For the next examples, consider we are mapping the \u0026lt;code\u0026gt;post\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;post_comments\u0026lt;/code\u0026gt; tables to the following entities:\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://i.stack.imgur.com/rZJne.png\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;https://i.stack.imgur.com/rZJne.png\u0026quot; alt=\u0026quot;Post and PostComment entities\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The JPA mappings look like this:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;@Entity(name = \u0026quot;Post\u0026quot;)\n@Table(name = \u0026quot;post\u0026quot;)\npublic class Post {\n \n    @Id\n    private Long id;\n \n    private String title;\n \n    //Getters and setters omitted for brevity\n}\n \n@Entity(name = \u0026quot;PostComment\u0026quot;)\n@Table(name = \u0026quot;post_comment\u0026quot;)\npublic class PostComment {\n \n    @Id\n    private Long id;\n \n    @ManyToOne\n    private Post post;\n \n    private String review;\n \n    //Getters and setters omitted for brevity\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;h2\u0026gt;\u0026lt;code\u0026gt;FetchType.EAGER\u0026lt;/code\u0026gt;\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;Using \u0026lt;code\u0026gt;FetchType.EAGER\u0026lt;/code\u0026gt; either implicitly or explicitly for your JPA associations is a bad idea because you are going to fetch way more data that you need. More, the \u0026lt;code\u0026gt;FetchType.EAGER\u0026lt;/code\u0026gt; strategy is also prone to N+1 query issues.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Unfortunately, the \u0026lt;code\u0026gt;@ManyToOne\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;@OneToOne\u0026lt;/code\u0026gt; associations use \u0026lt;code\u0026gt;FetchType.EAGER\u0026lt;/code\u0026gt; by default, so if your mappings look like this:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;@ManyToOne\nprivate Post post;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;You are using the \u0026lt;code\u0026gt;FetchType.EAGER\u0026lt;/code\u0026gt; strategy, and, every time you forget to use \u0026lt;code\u0026gt;JOIN FETCH\u0026lt;/code\u0026gt; when loading some \u0026lt;code\u0026gt;PostComment\u0026lt;/code\u0026gt; entities with a JPQL or Criteria API query:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;List\u0026amp;lt;PostComment\u0026amp;gt; comments = entityManager\n.createQuery(\u0026quot;\u0026quot;\u0026quot;\n    select pc\n    from PostComment pc\n    \u0026quot;\u0026quot;\u0026quot;, PostComment.class)\n.getResultList();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;You are going to trigger the N+1 query issue:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;SELECT \n    pc.id AS id1_1_, \n    pc.post_id AS post_id3_1_, \n    pc.review AS review2_1_ \nFROM \n    post_comment pc\n\nSELECT p.id AS id1_0_0_, p.title AS title2_0_0_ FROM post p WHERE p.id = 1\nSELECT p.id AS id1_0_0_, p.title AS title2_0_0_ FROM post p WHERE p.id = 2\nSELECT p.id AS id1_0_0_, p.title AS title2_0_0_ FROM post p WHERE p.id = 3\nSELECT p.id AS id1_0_0_, p.title AS title2_0_0_ FROM post p WHERE p.id = 4\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Notice the additional SELECT statements that are executed because the \u0026lt;code\u0026gt;post\u0026lt;/code\u0026gt; association has to be fetched prior to returning the \u0026lt;code\u0026gt;List\u0026lt;/code\u0026gt; of \u0026lt;code\u0026gt;PostComment\u0026lt;/code\u0026gt; entities.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Unlike the default fetch plan, which you are using when calling the \u0026lt;code\u0026gt;find\u0026lt;/code\u0026gt; method of the \u0026lt;code\u0026gt;EntityManager\u0026lt;/code\u0026gt;, a JPQL or Criteria API query defines an explicit plan that Hibernate cannot change by injecting a JOIN FETCH automatically. So, you need to do it manually.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;If you didn\u0026apos;t need the \u0026lt;code\u0026gt;post\u0026lt;/code\u0026gt; association at all, you are out of luck when using \u0026lt;code\u0026gt;FetchType.EAGER\u0026lt;/code\u0026gt; because there is no way to avoid fetching it. That\u0026apos;s why it\u0026apos;s better to use \u0026lt;code\u0026gt;FetchType.LAZY\u0026lt;/code\u0026gt; by default.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;But, if you wanted to use \u0026lt;code\u0026gt;post\u0026lt;/code\u0026gt; association, then you can use \u0026lt;code\u0026gt;JOIN FETCH\u0026lt;/code\u0026gt; to avoid the N+1 query problem:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;List\u0026amp;lt;PostComment\u0026amp;gt; comments = entityManager.createQuery(\u0026quot;\u0026quot;\u0026quot;\n    select pc\n    from PostComment pc\n    join fetch pc.post p\n    \u0026quot;\u0026quot;\u0026quot;, PostComment.class)\n.getResultList();\n\nfor(PostComment comment : comments) {\n    LOGGER.info(\n        \u0026quot;The Post \u0026apos;{}\u0026apos; got this review \u0026apos;{}\u0026apos;\u0026quot;, \n        comment.getPost().getTitle(), \n        comment.getReview()\n    );\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;This time, Hibernate will execute a single SQL statement:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;SELECT \n    pc.id as id1_1_0_, \n    pc.post_id as post_id3_1_0_, \n    pc.review as review2_1_0_, \n    p.id as id1_0_1_, \n    p.title as title2_0_1_ \nFROM \n    post_comment pc \nINNER JOIN \n    post p ON pc.post_id = p.id\n    \n-- The Post \u0026apos;High-Performance Java Persistence - Part 1\u0026apos; got this review \n-- \u0026apos;Excellent book to understand Java Persistence\u0026apos;\n\n-- The Post \u0026apos;High-Performance Java Persistence - Part 2\u0026apos; got this review \n-- \u0026apos;Must-read for Java developers\u0026apos;\n\n-- The Post \u0026apos;High-Performance Java Persistence - Part 3\u0026apos; got this review \n-- \u0026apos;Five Stars\u0026apos;\n\n-- The Post \u0026apos;High-Performance Java Persistence - Part 4\u0026apos; got this review \n-- \u0026apos;A great reference book\u0026apos;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;h2\u0026gt;\u0026lt;code\u0026gt;FetchType.LAZY\u0026lt;/code\u0026gt;\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;Even if you switch to using \u0026lt;code\u0026gt;FetchType.LAZY\u0026lt;/code\u0026gt; explicitly for all associations, you can still bump into the N+1 issue.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;This time, the \u0026lt;code\u0026gt;post\u0026lt;/code\u0026gt; association is mapped like this:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;@ManyToOne(fetch = FetchType.LAZY)\nprivate Post post;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Now, when you fetch the \u0026lt;code\u0026gt;PostComment\u0026lt;/code\u0026gt; entities:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;List\u0026amp;lt;PostComment\u0026amp;gt; comments = entityManager\n.createQuery(\u0026quot;\u0026quot;\u0026quot;\n    select pc\n    from PostComment pc\n    \u0026quot;\u0026quot;\u0026quot;, PostComment.class)\n.getResultList();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Hibernate will execute a single SQL statement:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;SELECT \n    pc.id AS id1_1_, \n    pc.post_id AS post_id3_1_, \n    pc.review AS review2_1_ \nFROM \n    post_comment pc\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;But, if afterward, you are going to reference the lazy-loaded \u0026lt;code\u0026gt;post\u0026lt;/code\u0026gt; association:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;for(PostComment comment : comments) {\n    LOGGER.info(\n        \u0026quot;The Post \u0026apos;{}\u0026apos; got this review \u0026apos;{}\u0026apos;\u0026quot;, \n        comment.getPost().getTitle(), \n        comment.getReview()\n    );\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;You will get the N+1 query issue:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;SELECT p.id AS id1_0_0_, p.title AS title2_0_0_ FROM post p WHERE p.id = 1\n-- The Post \u0026apos;High-Performance Java Persistence - Part 1\u0026apos; got this review \n-- \u0026apos;Excellent book to understand Java Persistence\u0026apos;\n\nSELECT p.id AS id1_0_0_, p.title AS title2_0_0_ FROM post p WHERE p.id = 2\n-- The Post \u0026apos;High-Performance Java Persistence - Part 2\u0026apos; got this review \n-- \u0026apos;Must-read for Java developers\u0026apos;\n\nSELECT p.id AS id1_0_0_, p.title AS title2_0_0_ FROM post p WHERE p.id = 3\n-- The Post \u0026apos;High-Performance Java Persistence - Part 3\u0026apos; got this review \n-- \u0026apos;Five Stars\u0026apos;\n\nSELECT p.id AS id1_0_0_, p.title AS title2_0_0_ FROM post p WHERE p.id = 4\n-- The Post \u0026apos;High-Performance Java Persistence - Part 4\u0026apos; got this review \n-- \u0026apos;A great reference book\u0026apos;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Because the \u0026lt;code\u0026gt;post\u0026lt;/code\u0026gt; association is fetched lazily, a secondary SQL statement will be executed when accessing the lazy association in order to build the log message.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Again, the fix consists in adding a \u0026lt;code\u0026gt;JOIN FETCH\u0026lt;/code\u0026gt; clause to the JPQL query:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;List\u0026amp;lt;PostComment\u0026amp;gt; comments = entityManager.createQuery(\u0026quot;\u0026quot;\u0026quot;\n    select pc\n    from PostComment pc\n    join fetch pc.post p\n    \u0026quot;\u0026quot;\u0026quot;, PostComment.class)\n.getResultList();\n\nfor(PostComment comment : comments) {\n    LOGGER.info(\n        \u0026quot;The Post \u0026apos;{}\u0026apos; got this review \u0026apos;{}\u0026apos;\u0026quot;, \n        comment.getPost().getTitle(), \n        comment.getReview()\n    );\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;And, just like in the \u0026lt;code\u0026gt;FetchType.EAGER\u0026lt;/code\u0026gt; example, this JPQL query will generate a single SQL statement.\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;Even if you are using \u0026lt;code\u0026gt;FetchType.LAZY\u0026lt;/code\u0026gt; and don\u0026apos;t reference the child association of a bidirectional \u0026lt;code\u0026gt;@OneToOne\u0026lt;/code\u0026gt; JPA relationship, you can still trigger the N+1 query issue.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;h2\u0026gt;How to automatically detect the N+1 query issue\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;If you want to automatically detect N+1 query issue in your data access layer, you can use the \u0026lt;a href=\u0026quot;https://github.com/vladmihalcea/db-util\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;db-util\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; open-source project.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;First, you need to add the following Maven dependency:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;\u0026amp;lt;dependency\u0026amp;gt;\n    \u0026amp;lt;groupId\u0026amp;gt;com.vladmihalcea\u0026amp;lt;/groupId\u0026amp;gt;\n    \u0026amp;lt;artifactId\u0026amp;gt;db-util\u0026amp;lt;/artifactId\u0026amp;gt;\n    \u0026amp;lt;version\u0026amp;gt;${db-util.version}\u0026amp;lt;/version\u0026amp;gt;\n\u0026amp;lt;/dependency\u0026amp;gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Afterward, you just have to use \u0026lt;code\u0026gt;SQLStatementCountValidator\u0026lt;/code\u0026gt; utility to assert the underlying SQL statements that get generated:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;SQLStatementCountValidator.reset();\n\nList\u0026amp;lt;PostComment\u0026amp;gt; comments = entityManager.createQuery(\u0026quot;\u0026quot;\u0026quot;\n    select pc\n    from PostComment pc\n    \u0026quot;\u0026quot;\u0026quot;, PostComment.class)\n.getResultList();\n\nSQLStatementCountValidator.assertSelectCount(1);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;In case you are using \u0026lt;code\u0026gt;FetchType.EAGER\u0026lt;/code\u0026gt; and run the above test case, you will get the following test case failure:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;SELECT \n    pc.id as id1_1_, \n    pc.post_id as post_id3_1_, \n    pc.review as review2_1_ \nFROM \n    post_comment pc\n\nSELECT p.id as id1_0_0_, p.title as title2_0_0_ FROM post p WHERE p.id = 1\n\nSELECT p.id as id1_0_0_, p.title as title2_0_0_ FROM post p WHERE p.id = 2\n\n\n-- SQLStatementCountMismatchException: Expected 1 statement(s) but recorded 3 instead!\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;SELECT \ntable1.*\n, table2.*\nINNER JOIN table2 ON table2.SomeFkId = table1.SomeId\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;That gets you a result set where child rows in table2 cause duplication by returning the table1 results for each child row in table2.  O/R mappers should differentiate table1 instances based on a unique key field, then use all the table2 columns to populate child instances.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;SELECT table1.*\n\nSELECT table2.* WHERE SomeFkId = #\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;The N+1 is where the first query populates the primary object and the second query populates all the child objects for each of the unique primary objects returned.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Consider:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;class House\n{\n    int Id { get; set; }\n    string Address { get; set; }\n    Person[] Inhabitants { get; set; }\n}\n\nclass Person\n{\n    string Name { get; set; }\n    int HouseId { get; set; }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;and tables with a similar structure.  A single query for the address \u0026quot;22 Valley St\u0026quot; may return:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;Id Address      Name HouseId\n1  22 Valley St Dave 1\n1  22 Valley St John 1\n1  22 Valley St Mike 1\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;The O/RM should fill an instance of Home with ID=1, Address=\u0026quot;22 Valley St\u0026quot; and then populate the Inhabitants array with People instances for Dave, John, and Mike with just one query.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;A N+1 query for the same address used above would result in:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;Id Address\n1  22 Valley St\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;with a separate query like\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;SELECT * FROM Person WHERE HouseId = 1\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;and resulting in a separate data set like\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;Name    HouseId\nDave    1\nJohn    1\nMike    1\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;and the final result being the same as above with the single query.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The advantages to single select is that you get all the data up front which may be what you ultimately desire.  The advantages to N+1 is query complexity is reduced and you can use lazy loading where the child result sets are only loaded upon first request.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Supplier with a one-to-many relationship with Product. One Supplier has (supplies) many Products.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;***** Table: Supplier *****\n+-----+-------------------+\n| ID  |       NAME        |\n+-----+-------------------+\n|  1  |  Supplier Name 1  |\n|  2  |  Supplier Name 2  |\n|  3  |  Supplier Name 3  |\n|  4  |  Supplier Name 4  |\n+-----+-------------------+\n\n***** Table: Product *****\n+-----+-----------+--------------------+-------+------------+\n| ID  |   NAME    |     DESCRIPTION    | PRICE | SUPPLIERID |\n+-----+-----------+--------------------+-------+------------+\n|1    | Product 1 | Name for Product 1 |  2.0  |     1      |\n|2    | Product 2 | Name for Product 2 | 22.0  |     1      |\n|3    | Product 3 | Name for Product 3 | 30.0  |     2      |\n|4    | Product 4 | Name for Product 4 |  7.0  |     3      |\n+-----+-----------+--------------------+-------+------------+\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Factors:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Lazy mode for Supplier set to true (default)\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Fetch mode used for querying on Product is Select\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Fetch mode (default): Supplier information is accessed\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Caching does not play a role for the first time the\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;Supplier is accessed\u0026lt;/p\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;Fetch mode is Select Fetch (default)\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;// It takes Select fetch mode as a default\nQuery query = session.createQuery( \u0026quot;from Product p\u0026quot;);\nList list = query.list();\n// Supplier is being accessed\ndisplayProductsListWithSupplierName(results);\n\nselect ... various field names ... from PRODUCT\nselect ... various field names ... from SUPPLIER where SUPPLIER.id=?\nselect ... various field names ... from SUPPLIER where SUPPLIER.id=?\nselect ... various field names ... from SUPPLIER where SUPPLIER.id=?\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Result:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;1 select statement for Product\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;N select statements for Supplier\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;This is N+1 select problem!\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I can\u0026apos;t comment directly on other answers, because I don\u0026apos;t have enough reputation. But it\u0026apos;s worth noting that the problem essentially only arises because, historically, a lot of dbms have been quite poor when it comes to handling joins (MySQL being a particularly noteworthy example). So n+1 has, often, been notably faster than a join. And then there are ways to improve on n+1 but still without needing a join, which is what the original problem relates to.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;However, MySQL is now a lot better than it used to be when it comes to joins. When I first learned MySQL, I used joins a lot. Then I discovered how slow they are, and switched to n+1 in the code instead. But, recently, I\u0026apos;ve been moving back to joins, because MySQL is now a heck of a lot better at handling them than it was when I first started using it.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;These days, a simple join on a properly indexed set of tables is rarely a problem, in performance terms. And if it does give a performance hit, then the use of index hints often solves them.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This is discussed here by one of the MySQL development team:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://jorgenloland.blogspot.co.uk/2013/02/dbt-3-q3-6-x-performance-in-mysql-5610.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;http://jorgenloland.blogspot.co.uk/2013/02/dbt-3-q3-6-x-performance-in-mysql-5610.html\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;So the summary is: If you\u0026apos;ve been avoiding joins in the past because of MySQL\u0026apos;s abysmal performance with them, then try again on the latest versions. You\u0026apos;ll probably be pleasantly surprised.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;We moved away from the ORM in Django because of this problem. Basically, if you try and do\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;for p in person:\n    print p.car.colour\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;The ORM will happily return all people (typically as instances of a Person object), but then it will need to query the car table for each Person.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;A simple and very effective approach to this is something I call \u0026quot;\u0026lt;strong\u0026gt;fanfolding\u0026lt;/strong\u0026gt;\u0026quot;, which avoids the nonsensical idea that query results from a relational database should map back to the original tables from which the query is composed.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Step 1: Wide select\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;  select * from people_car_colour; # this is a view or sql function\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;This will return something like\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;  p.id | p.name | p.telno | car.id | car.type | car.colour\n  -----+--------+---------+--------+----------+-----------\n  2    | jones  | 2145    | 77     | ford     | red\n  2    | jones  | 2145    | 1012   | toyota   | blue\n  16   | ashby  | 124     | 99     | bmw      | yellow\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Step 2: Objectify\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Suck the results into a generic object creator with an argument to split after the third item. This means that \u0026quot;jones\u0026quot; object won\u0026apos;t be made more than once.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Step 3: Render\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;for p in people:\n    print p.car.colour # no more car queries\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;See \u0026lt;a href=\u0026quot;http://campbell-lange.net/company/articles/dbwrapper/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;this web page\u0026lt;/a\u0026gt; for an implementation of \u0026lt;strong\u0026gt;fanfolding\u0026lt;/strong\u0026gt; for python.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://web.archive.org/web/20160310145416/http://www.realsolve.co.uk/site/tech/hib-tip-pitfall.php?name=why-lazy\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Here\u0026apos;s a good description of the problem\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Now that you understand the problem it can typically be avoided by doing a join fetch in your query. This basically forces the fetch of the lazy loaded object so the data is retrieved in one query instead of n+1 queries.  Hope this helps.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Suppose you have COMPANY and EMPLOYEE. COMPANY has many EMPLOYEES (i.e. EMPLOYEE has a field COMPANY_ID).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;In some O/R configurations, when you have a mapped Company object and go to access its Employee objects, the O/R tool will do one select for every employee, wheras if you were just doing things in straight SQL, you could \u0026lt;code\u0026gt;select * from employees where company_id = XX\u0026lt;/code\u0026gt;.  Thus N (# of employees) plus 1 (company)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This is how the initial versions of EJB Entity Beans worked.  I believe things like Hibernate have done away with this, but I\u0026apos;m not too sure.  Most tools usually include info as to their strategy for mapping.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Check Ayende post on the topic: \u0026lt;a href=\u0026quot;http://ayende.com/blog/1328/combating-the-select-n-1-problem-in-nhibernate\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Combating the Select N + 1 Problem In NHibernate\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Basically, when using an ORM like NHibernate or EntityFramework, if you have a one-to-many (master-detail) relationship, and want to list all the details per each master record, you have to make N + 1 query calls to the database, \u0026quot;N\u0026quot; being the number of master records: 1 query to get all the master records, and N queries, one per master record, to get all the details per master record.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;More database query calls  more latency time  decreased application/database performance.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;However, ORMs have options to avoid this problem, mainly using JOINs.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;It is much faster to issue 1 query which returns 100 results than to issue 100 queries which each return 1 result.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In my opinion the article written in \u0026lt;a href=\u0026quot;http://www.realsolve.co.uk/site/tech/hib-tip-pitfall.php?name=why-lazy\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Hibernate Pitfall: Why Relationships Should Be Lazy\u0026lt;/a\u0026gt; is exactly opposite of real N+1 issue is.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;If you need correct explanation please refer \u0026lt;a href=\u0026quot;http://docs.jboss.org/hibernate/core/3.3/reference/en/html/performance.html#performance-fetching\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Hibernate - Chapter 19: Improving Performance - Fetching Strategies\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;Select fetching (the default) is\n  extremely vulnerable to N+1 selects\n  problems, so we might want to enable\n  join fetching\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The supplied link has a very simply example of the n + 1 problem. If you apply it to Hibernate it\u0026apos;s basically talking about the same thing. When you query for an object, the entity is loaded but any associations (unless configured otherwise) will be lazy loaded. Hence one query for the root objects and another query to load the associations for each of these. 100 objects returned means one initial query and then 100 additional queries to get the association for each, n + 1.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://pramatr.com/2009/02/05/sql-n-1-selects-explained/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;http://pramatr.com/2009/02/05/sql-n-1-selects-explained/\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;N+1 select issue is a pain, and it makes sense to detect such cases in unit tests.\nI have developed a small library for verifying the number of queries executed by a given test method or just an arbitrary block of code - \u0026lt;a href=\u0026quot;https://github.com/bedrin/jdbc-sniffer\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;JDBC Sniffer\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Just add a special JUnit rule to your test class and place annotation with expected number of queries on your test methods:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;@Rule\npublic final QueryCounter queryCounter = new QueryCounter();\n\n@Expectation(atMost = 3)\n@Test\npublic void testInvokingDatabase() {\n    // your JDBC or JPA code\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;N+1 problem in Hibernate \u0026amp;amp; Spring Data JPA\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;N+1 problem is a performance issue in Object Relational Mapping that fires multiple select queries (N+1 to be exact, where N = number of records in table) in database for a single select query at application layer. Hibernate \u0026amp;amp; Spring Data JPA provides multiple ways to catch and address this performance problem.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;What is N+1 Problem?\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;To understand N+1 problem, lets consider with a scenario. Lets say we have a collection of \u0026lt;em\u0026gt;User\u0026lt;/em\u0026gt; objects mapped to \u0026lt;em\u0026gt;DB_USER\u0026lt;/em\u0026gt; table in database, and each user has collection or \u0026lt;em\u0026gt;Role\u0026lt;/em\u0026gt; mapped to \u0026lt;em\u0026gt;DB_ROLE\u0026lt;/em\u0026gt; table using a joining table \u0026lt;em\u0026gt;DB_USER_ROLE\u0026lt;/em\u0026gt;. At the ORM level a \u0026lt;strong\u0026gt;User\u0026lt;/strong\u0026gt; has \u0026lt;strong\u0026gt;many to many\u0026lt;/strong\u0026gt; relationship with \u0026lt;strong\u0026gt;Role\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;Entity Model\n@Entity\n@Table(name = \u0026quot;DB_USER\u0026quot;)\npublic class User {\n\n    @Id\n    @GeneratedValue(strategy=GenerationType.AUTO)\n    private Long id;\n    private String name;\n\n    @ManyToMany(fetch = FetchType.LAZY)                   \n    private Set\u0026amp;lt;Role\u0026amp;gt; roles;\n    //Getter and Setters \n }\n\n@Entity\n@Table(name = \u0026quot;DB_ROLE\u0026quot;)\npublic class Role {\n\n    @Id\n    @GeneratedValue(strategy= GenerationType.AUTO)\n    private Long id;\n\n    private String name;\n    //Getter and Setters\n }\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;A user can have many roles. Roles are loaded Lazily.\u0026lt;/strong\u0026gt; Now lets say we want to \u0026lt;em\u0026gt;fetch all users from this table and print roles for each one\u0026lt;/em\u0026gt;. Very naive Object Relational implementation could be -\n\u0026lt;strong\u0026gt;UserRepository\u0026lt;/strong\u0026gt; with \u0026lt;strong\u0026gt;findAllBy\u0026lt;/strong\u0026gt; method\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;public interface UserRepository extends CrudRepository\u0026amp;lt;User, Long\u0026amp;gt; {\n\n    List\u0026amp;lt;User\u0026amp;gt; findAllBy();\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;The equivalent SQL queries executed by ORM will be:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;First Get \u0026lt;strong\u0026gt;All User\u0026lt;/strong\u0026gt; (1)\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;Select * from DB_USER;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Then get \u0026lt;strong\u0026gt;roles for each user\u0026lt;/strong\u0026gt; executed N times (where N is number of users)\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;Select * from DB_USER_ROLE where userid = \u0026amp;lt;userid\u0026amp;gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;So we need \u0026lt;strong\u0026gt;one select for User\u0026lt;/strong\u0026gt; and \u0026lt;strong\u0026gt;N additional selects for fetching roles for each user\u0026lt;/strong\u0026gt;, where \u0026lt;em\u0026gt;N is total number of users\u0026lt;/em\u0026gt;. \u0026lt;em\u0026gt;\u0026lt;strong\u0026gt;This is a classic N+1 problem in ORM\u0026lt;/strong\u0026gt;\u0026lt;/em\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;How to identify it?\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Hibernate provide tracing option that enables SQL logging in the console/logs. \u0026lt;em\u0026gt;\u0026lt;strong\u0026gt;using logs you can easily see if hibernate is issuing N+1 queries for a given call\u0026lt;/strong\u0026gt;\u0026lt;/em\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;If you see multiple entries for SQL for a given select query, then there are high chances that its due to N+1 problem.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;N+1 Resolution\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;At SQL level\u0026lt;/strong\u0026gt;, what ORM needs to achieve to avoid N+1 is to \u0026lt;em\u0026gt;fire a query that joins the two tables and get the combined results in single query\u0026lt;/em\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;\u0026lt;strong\u0026gt;Fetch Join SQL that retrieves everything (user and roles) in Single Query\u0026lt;/strong\u0026gt;\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;OR Plain SQL\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;select user0_.id, role2_.id, user0_.name, role2_.name, roles1_.user_id, roles1_.roles_id from db_user user0_ left outer join db_user_roles roles1_ on user0_.id=roles1_.user_id left outer join db_role role2_ on roles1_.roles_id=role2_.id\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Hibernate \u0026amp;amp; Spring Data JPA provide mechanism to solve the N+1 ORM issue.\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;1. Spring Data JPA Approach:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;If we are using Spring Data JPA, then we have two options to achieve this - using \u0026lt;em\u0026gt;\u0026lt;strong\u0026gt;EntityGraph\u0026lt;/strong\u0026gt;\u0026lt;/em\u0026gt; or using \u0026lt;em\u0026gt;\u0026lt;strong\u0026gt;select query with fetch join.\u0026lt;/strong\u0026gt;\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;public interface UserRepository extends CrudRepository\u0026amp;lt;User, Long\u0026amp;gt; {\n\n    List\u0026amp;lt;User\u0026amp;gt; findAllBy();             \n\n    @Query(\u0026quot;SELECT p FROM User p LEFT JOIN FETCH p.roles\u0026quot;)  \n    List\u0026amp;lt;User\u0026amp;gt; findWithoutNPlusOne();\n\n    @EntityGraph(attributePaths = {\u0026quot;roles\u0026quot;})                \n    List\u0026amp;lt;User\u0026amp;gt; findAll();\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;N+1 queries are issued at database level using left join fetch, we resolve the N+1 problem using attributePaths, Spring Data JPA avoids N+1 problem\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;2. Hibernate Approach:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;If its pure Hibernate, then the following solutions will work.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Using \u0026lt;strong\u0026gt;HQL\u0026lt;/strong\u0026gt; :\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;from User u *join fetch* u.roles roles roles\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Using \u0026lt;strong\u0026gt;Criteria\u0026lt;/strong\u0026gt; API:\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;Criteria criteria = session.createCriteria(User.class);\ncriteria.setFetchMode(\u0026quot;roles\u0026quot;, FetchMode.EAGER);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;All these approaches work similar and they issue a similar database query with left join fetch\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The issue as others have stated more elegantly is that you either have a Cartesian product of the OneToMany columns or you\u0026apos;re doing N+1 Selects. Either possible gigantic resultset or chatty with the database, respectively.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I\u0026apos;m surprised this isn\u0026apos;t mentioned but this how I have gotten around this issue... \u0026lt;strong\u0026gt;I make a semi-temporary ids table\u0026lt;/strong\u0026gt;. \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/11119642/318174\u0026quot;\u0026gt;I also do this when you have the \u0026lt;code\u0026gt;IN ()\u0026lt;/code\u0026gt; clause limitation\u0026lt;/a\u0026gt;. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This doesn\u0026apos;t work for all cases (probably not even a majority) but it works particularly well if you have a lot of child objects such that the Cartesian product will get out of hand (ie lots of \u0026lt;code\u0026gt;OneToMany\u0026lt;/code\u0026gt; columns the number of results will be a multiplication of the columns) and its more of a batch like job.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;First you insert your parent object ids as batch into an ids table.\nThis batch_id is something we generate in our app and hold onto.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;INSERT INTO temp_ids \n    (product_id, batch_id)\n    (SELECT p.product_id, ? \n    FROM product p ORDER BY p.product_id\n    LIMIT ? OFFSET ?);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Now for each \u0026lt;code\u0026gt;OneToMany\u0026lt;/code\u0026gt; column you just do a \u0026lt;code\u0026gt;SELECT\u0026lt;/code\u0026gt; on the ids table \u0026lt;code\u0026gt;INNER JOIN\u0026lt;/code\u0026gt;ing  the child table with a \u0026lt;code\u0026gt;WHERE batch_id=\u0026lt;/code\u0026gt; (or vice versa). You just want to make sure you order by the id column as it will make merging result columns easier (otherwise you will need a HashMap/Table for the entire result set which may not be that bad).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Then you just periodically clean the ids table.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This also works particularly well if the user selects say 100 or so distinct items for some sort of bulk processing. Put the 100 distinct ids in the temporary table.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Now the number of queries you are doing is by the number of OneToMany columns.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Without going into tech stack implementation details, architecturally speaking there are at least two solutions to N + 1 Problem:\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;Have Only 1 - big query - with Joins. This makes a lot of information be transported from the database to the application layer, especially if there are multiple child records. The typical result of a database is a set of rows, not graph of objects (there are solutions to that with different DB systems)\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Have Two(or more for more children needed to be joined) Queries - 1 for the parent and after you have them - query by IDs the children and map them. This will minimize data transfer between the DB and APP layers.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Take Matt Solnit example, imagine that you define an association between Car and Wheels as LAZY and you need some Wheels fields. This means that after the first select, hibernate is going to do  \u0026quot;Select * from Wheels where car_id = :id\u0026quot; FOR EACH Car.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This makes the first select and more 1 select by each N car, that\u0026apos;s why it\u0026apos;s called n+1 problem.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;To avoid this, make the association fetch as eager, so that hibernate loads data with a join.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;But attention, if many times you don\u0026apos;t access associated Wheels, it\u0026apos;s better to keep it LAZY or change fetch type with Criteria.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;h3\u0026gt;A generalisation of N+1\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;The N+1 problem is an ORM specific name of a problem where you move loops that could be reasonably executed on a server to the client. The generic problem isn\u0026apos;t specific to ORMs, you can have it with any remote API. \u0026lt;a href=\u0026quot;https://blog.jooq.org/the-cost-of-jdbc-server-roundtrips/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;In this article, I\u0026apos;ve shown how JDBC roundtrips are very costly\u0026lt;/a\u0026gt;, if you\u0026apos;re calling an API N times instead of only 1 time. The difference in the example is whether you\u0026apos;re calling the Oracle PL/SQL procedure:\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;dbms_output.get_lines\u0026lt;/code\u0026gt; (call it once, receive N items)\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;dbms_output.get_line\u0026lt;/code\u0026gt; (call it N times, receive 1 item each time)\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;p\u0026gt;They\u0026apos;re logically equivalent, but due to the latency between server and client, you\u0026apos;re adding N latency waits to your loop, instead of waiting only once.\u0026lt;/p\u0026gt;\n\u0026lt;h3\u0026gt;The ORM case\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;In fact, the ORM-y N+1 problem isn\u0026apos;t even ORM specific either, you can achieve it by running your own queries manually as well, e.g. when you do something like this in PL/SQL:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- This loop is executed once\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; parent \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; parent) loop\n\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- This loop is executed N times\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; child \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; child \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; parent_id \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; parent.id) loop\n    ...\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;end\u0026lt;/span\u0026gt; loop;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;end\u0026lt;/span\u0026gt; loop;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;It would be much better to implement this using a join (in this case):\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; rec \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; (\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; parent p\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;join\u0026lt;/span\u0026gt; child c \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;on\u0026lt;/span\u0026gt; c.parent_id \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; p.id\n)\nloop\n  ...\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;end\u0026lt;/span\u0026gt; loop;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Now, the loop is executed only once, and the logic of the loop has been moved from the client (PL/SQL) to the server (SQL), which can even optimise it differently, e.g. by running a hash join (\u0026lt;code\u0026gt;O(N)\u0026lt;/code\u0026gt;) rather than a nested loop join (\u0026lt;code\u0026gt;O(N log N)\u0026lt;/code\u0026gt; with index)\u0026lt;/p\u0026gt;\n\u0026lt;h3\u0026gt;Auto-detecting N+1 problems\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;If you\u0026apos;re using JDBC, \u0026lt;a href=\u0026quot;https://blog.jooq.org/using-jooqs-diagnosticsconnection-to-detect-n1-queries/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;you could use jOOQ as a JDBC proxy behind the scenes to auto-detect your N+1 problems\u0026lt;/a\u0026gt;. jOOQ\u0026apos;s parser normalises your SQL queries and caches data about consecutive executions of parent and child queries. This even works if your queries aren\u0026apos;t exactly the same, but semantically equivalent.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;N+1 SELECT problem is really hard to spot, especially in projects with large domain, to the moment when it starts degrading the performance. Even if the problem is fixed i.e. by adding eager loading, a further development may break the solution and/or introduce N+1 SELECT problem again in other places.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I\u0026apos;ve created open source library \u0026lt;a href=\u0026quot;https://github.com/adgadev/jplusone\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;jplusone\u0026lt;/a\u0026gt; to address those problems in JPA based Spring Boot Java applications. The library provides two major features:\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;Generates reports correlating SQL statements with executions of JPA operations which triggered them and places in source code of your application which were involved in it\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;pre\u0026gt;2020-10-22 18:41:43.236 DEBUG 14913 --- [           main] c.a.j.core.report.ReportGenerator        :\n    ROOT\n        com.adgadev.jplusone.test.domain.bookshop.BookshopControllerTest.shouldGetBookDetailsLazily(BookshopControllerTest.java:65)\n        com.adgadev.jplusone.test.domain.bookshop.BookshopController.getSampleBookUsingLazyLoading(BookshopController.java:31)\n        com.adgadev.jplusone.test.domain.bookshop.BookshopService.getSampleBookDetailsUsingLazyLoading [PROXY]\n            SESSION BOUNDARY\n                OPERATION [IMPLICIT]\n                    com.adgadev.jplusone.test.domain.bookshop.BookshopService.getSampleBookDetailsUsingLazyLoading(BookshopService.java:35)\n                    com.adgadev.jplusone.test.domain.bookshop.Author.getName [PROXY]\n                    com.adgadev.jplusone.test.domain.bookshop.Author [FETCHING ENTITY]\n                        STATEMENT [READ]\n                            select [...] from\n                                author author0_\n                                left outer join genre genre1_ on author0_.genre_id=genre1_.id\n                            where\n                                author0_.id=1\n                OPERATION [IMPLICIT]\n                    com.adgadev.jplusone.test.domain.bookshop.BookshopService.getSampleBookDetailsUsingLazyLoading(BookshopService.java:36)\n                    com.adgadev.jplusone.test.domain.bookshop.Author.countWrittenBooks(Author.java:53)\n                    com.adgadev.jplusone.test.domain.bookshop.Author.books [FETCHING COLLECTION]\n                        STATEMENT [READ]\n                            select [...] from\n                                book books0_\n                            where\n                                books0_.author_id=1\n\u0026lt;/pre\u0026gt;\n\u0026lt;ol start=\u0026quot;2\u0026quot;\u0026gt;\n\u0026lt;li\u0026gt;Provides API which allows to write tests checking how effectively your application is using JPA (i.e. assert amount of lazy loading operations )\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;@SpringBootTest\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;LazyLoadingTest\u0026lt;/span\u0026gt; {\n\n    \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;@Autowired\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;private\u0026lt;/span\u0026gt; JPlusOneAssertionContext assertionContext;\n\n    \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;@Autowired\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;private\u0026lt;/span\u0026gt; SampleService sampleService;\n\n    \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;@Test\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;void\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;shouldBusinessCheckOperationAgainstJPlusOneAssertionRule\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;JPlusOneAssertionRule\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;rule\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; JPlusOneAssertionRule\n                .within().lastSession()\n                .shouldBe().noImplicitOperations().exceptAnyOf(exclusions -\u0026amp;gt; exclusions\n                        .loadingEntity(Author.class).times(atMost(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;))\n                        .loadingCollection(Author.class, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;books\u0026quot;\u0026lt;/span\u0026gt;)\n                );\n\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// trigger business operation which you wish to be asserted against the rule,\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// i.e. calling a service or sending request to your API controller\u0026lt;/span\u0026gt;\n        sampleService.executeBusinessOperation();\n\n        rule.check(assertionContext);\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    "],"comment":["\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;There are some helpful posts talking about this issue and the possible fix. \u0026lt;a href=\u0026quot;https://blog.appdynamics.com/apm/common-application-problems-and-how-to-fix-them-the-select-n-1-problem/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Common Application Problems and How to Fix Them: The Select N + 1 Problem\u0026lt;/a\u0026gt;, \u0026lt;a href=\u0026quot;http://www.sitepoint.com/silver-bullet-n1-problem/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;The (Silver) Bullet for the N+1 Problem\u0026lt;/a\u0026gt;, \u0026lt;a href=\u0026quot;http://nhibernate.info/doc/howto/various/lazy-loading-eager-loading.html\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Lazy loading - eager loading\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1243867/cateyes\u0026quot; title=\u0026quot;4,242 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;cateyes\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment54143526_97197\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-10-16 10:08:36Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 16, 2015 at 10:08\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;For everyone looking for solution to this problem, I found a post describing it. \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/32453989/what-is-the-solution-for-the-n1-issue-in-jpa-and-hibernate\u0026quot; title=\u0026quot;what is the solution for the n1 issue in jpa and hibernate\u0026quot;\u0026gt;stackoverflow.com/questions/32453989/\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/6738898/damndemon\u0026quot; title=\u0026quot;170 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;damndemon\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment94251968_97197\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2018-12-10 00:30:00Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Dec 10, 2018 at 0:30\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Considering answers, shouldn\u0026apos;t this be termed as 1+N problem? As this seems to be a terminology, I\u0026apos;m not, specifically, asking OP.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1418717/user1418717\u0026quot; title=\u0026quot;395 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;user1418717\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment95840833_97197\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2019-02-04 15:09:00Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Feb 4, 2019 at 15:09\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;To clarify on the \u0026quot;This is bad\u0026quot; - you could get all the wheels with 1 select (\u0026lt;code\u0026gt;SELECT * from Wheel;\u0026lt;/code\u0026gt;), instead of N+1. With a large N, the performance hit can be very significant.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/15472/tucuxi\u0026quot; title=\u0026quot;17,007 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;tucuxi\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment3778817_97253\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2010-08-30 10:43:07Z, License: CC BY-SA 2.5\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 30, 2010 at 10:43\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@tucuxi I\u0026apos;m surprised you got so many upvotes for being wrong. A database is very good about indexes, doing the query for a specific CarID would return very fast. But if you got all the Wheels are once, you would have to search for CarID in your application, which is not indexed, this is slower. Unless you have major latency issues reaching your database going n + 1 is actually faster - and yes, I benchmarked it with a large variety of real world code.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/664364/ariel\u0026quot; title=\u0026quot;24,918 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Ariel\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment9713570_97253\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2011-10-30 20:32:29Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 30, 2011 at 20:32\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@ariel The \u0026apos;correct\u0026apos; way is to get \u0026lt;i\u0026gt;all\u0026lt;/i\u0026gt; the wheels, ordered by CarId (1 select), and if more details than the CarId are required, make a second query for \u0026lt;i\u0026gt;all\u0026lt;/i\u0026gt; cars (2 queries total). Printing things out is now optimal, and no indexes or secondary storage were required (you can iterate over results, no need to download them all). You benchmarked the wrong thing. If you are still confident of your benchmarks, would you mind posting a longer comment (or a full answer) explaining your experiment and results?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/15472/tucuxi\u0026quot; title=\u0026quot;17,007 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;tucuxi\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment9740019_97253\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2011-11-01 12:36:39Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Nov 1, 2011 at 12:36\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;\u0026quot;Hibernate (I\u0026apos;m not familiar with the other ORM frameworks) gives you several ways to handle it.\u0026quot; and these way are?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/408780/tima\u0026quot; title=\u0026quot;12,485 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Tima\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment11033546_97253\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2012-01-12 14:17:26Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 12, 2012 at 14:17\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@Ariel Try running your benchmarks with database and application servers on separate machines. In my experience, round trips to the database cost more in overhead than the query itself. So yes, the queries are really fast, but it\u0026apos;s the round trips that wreak havok. I\u0026apos;ve converted \u0026quot;WHERE Id = \u0026lt;i\u0026gt;const\u0026lt;/i\u0026gt;\u0026quot; to \u0026quot;WHERE Id IN (\u0026lt;i\u0026gt;const\u0026lt;/i\u0026gt;, \u0026lt;i\u0026gt;const\u0026lt;/i\u0026gt;, ...)\u0026quot; and gotten orders of magnitude increases out of it.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/472522/hans\u0026quot; title=\u0026quot;2,170 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Hans\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment17145196_97253\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2012-10-02 23:07:26Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 2, 2012 at 23:07\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;But now you have a problem with pagination. If you have 10 cars, each car with 4 wheels and you want to paginate cars with 5 cars per page.  So you basically you have \u0026lt;code\u0026gt;SELECT cars, wheels FROM cars  JOIN wheels LIMIT 0, 5\u0026lt;/code\u0026gt;. But what you get is 2 cars with 5 wheels (first car with all 4 wheels and second car with only 1 wheel), because LIMIT will limit the entire resultset, not only root clause.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/615053/cappy\u0026quot; title=\u0026quot;1,420 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;CappY\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment82282725_39696775\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2017-12-05 20:08:19Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Dec 5, 2017 at 20:08\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 3 times\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Thank you for article. I will read it. By fast scroll - I saw that solution is Window Function, but they are fairly new in MariaDB - so the problem persist in older versions. :)\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/615053/cappy\u0026quot; title=\u0026quot;1,420 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;CappY\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment82287550_39696775\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2017-12-05 23:09:08Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Dec 5, 2017 at 23:09\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@VladMihalcea, I pointed out either from your article or from the post every time you refer to ManyToOne case while explaining N+1 problem. But actually people mostly interested in OneToMany case relating to N+1 issue. Could you please refer and explain OneToMany case?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/10894456/j-j-beam\u0026quot; title=\u0026quot;2,094 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;J.J. Beam\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment108889010_39696775\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2020-05-02 10:17:03Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;May 2, 2020 at 10:17\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@VladMicalcea could Entity Graph be used instead of \u0026lt;code\u0026gt;join fetch\u0026lt;/code\u0026gt;?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1498427/catch23\u0026quot; title=\u0026quot;16,167 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;catch23\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment116012354_39696775\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2021-01-07 16:51:34Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 7, 2021 at 16:51\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Thanks for the answer, it cleared things. This could have been accepted answer :)\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/7475099/krupesh-anadkat\u0026quot; title=\u0026quot;1,423 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;krupesh Anadkat\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment128628655_39696775\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2022-07-01 04:01:40Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 1 at 4:01\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;The other advantage of n + 1 is that it\u0026apos;s faster because the database can return the results directly from an index. Doing the join and then sorting requires a temp table, which is slower. The only reason to avoid n + 1 is if you have a lot of latency talking to your database.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/664364/ariel\u0026quot; title=\u0026quot;24,918 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Ariel\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment9713582_97308\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2011-10-30 20:34:07Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 30, 2011 at 20:34\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Joining and sorting can be quite fast (because you will be joining on indexed-and-possibly-sorted fields). How big is your \u0026apos;n+1\u0026apos;? Do you seriously believe that the n+1 problem only applies to high-latency database connections?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/15472/tucuxi\u0026quot; title=\u0026quot;17,007 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;tucuxi\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment9740177_97308\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2011-11-01 12:46:39Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Nov 1, 2011 at 12:46\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@ariel - Your advice that N+1 is the \u0026quot;fastest\u0026quot; is wrong, even though your benchmarks may be correct.  How is that possible?  See \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Anecdotal_evidence\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;en.wikipedia.org/wiki/Anecdotal_evidence\u0026lt;/a\u0026gt;, and also my comment in the other answer to this question.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/700206/whitneyland\u0026quot; title=\u0026quot;10,387 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;whitneyland\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment14922329_97308\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2012-07-04 18:27:31Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 4, 2012 at 18:27\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@Ariel - I think I understood it fine :).  I\u0026apos;m just trying to point out that your result only applies to one set of conditions.  I could easily construct a counter example that showed the opposite.  Does that make sense?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/700206/whitneyland\u0026quot; title=\u0026quot;10,387 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;whitneyland\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment14926894_97308\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2012-07-05 00:31:57Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 5, 2012 at 0:31\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;To reiterate, the SELECT N + 1 problem is, at its core: I have 600 records to retrieve. Is it faster to get all 600 of them in one query, or 1 at a time in 600 queries. Unless you\u0026apos;re on MyISAM and/or you have a poorly normalized/poorly indexed schema (in which case the ORM isn\u0026apos;t the problem), a properly tuned db will return the 600 rows in 2 ms, while returning the individual rows in about 1 ms each. So we often see N + 1 taking hundreds of milliseconds where a join takes only a couple\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2526056/dogs\u0026quot; title=\u0026quot;2,413 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Dogs\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment65616867_97308\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-08-25 02:54:02Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 25, 2016 at 2:54\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Is it supposed to be 1 select for the Supplier then N selects for the Product?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/5239351/bencampbell-14\u0026quot; title=\u0026quot;558 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;bencampbell_14\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment88260454_1826225\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2018-05-31 13:16:56Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;May 31, 2018 at 13:16\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@bencampbell_ Yeah, initially I felt the same. But then with his example, it is One product to many suppliers.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2229597/mohd-faizan-khan\u0026quot; title=\u0026quot;437 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Mohd Faizan Khan\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment94435461_1826225\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2018-12-15 12:23:26Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Dec 15, 2018 at 12:23\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Calling early versions of MySQL a relational DBMS is quite a stretch... If people encountering those problems had been using a real database, they would not have encountered those kinds of problems.  ;-)\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/618649/craig-tullis\u0026quot; title=\u0026quot;9,179 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Craig Tullis\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment60376825_20996154\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-04-02 23:06:58Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Apr 2, 2016 at 23:06\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Interestingly, many of these types of problems were solved in MySQL with the introduction and subsequent optimization of the INNODB engine, but you\u0026apos;ll still run into people trying to promote MYISAM because they think it\u0026apos;s faster.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/618649/craig-tullis\u0026quot; title=\u0026quot;9,179 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Craig Tullis\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment60376845_20996154\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-04-02 23:08:10Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Apr 2, 2016 at 23:08\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;FYI, one of the 3 common \u0026lt;code\u0026gt;JOIN\u0026lt;/code\u0026gt; algorithms used in RDBMS\u0026apos; is called nested loops.  It fundamentally is an N+1 select under the hood.  The only difference is the DB made an intelligent choice to use it based off statistics and indexes, rather than client code forcing it down that path categorically.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1649198/brandon\u0026quot; title=\u0026quot;9,562 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Brandon\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment65034488_20996154\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-08-08 16:50:00Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 8, 2016 at 16:50\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@Brandon Yes! Much like JOIN hints and INDEX hints, forcing a certain execution path in all cases will rarely beat the database. The database is almost always very, very good at choosing the optimal approach to get the data. Maybe in the early days of dbs you needed to \u0026apos;phrase\u0026apos; your question in a peculiar way to coax the db along, but after decades of world class engineering, you can now get the best performance by asking your database a relational question and letting it sort out how to fetch and assemble that data for you.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2526056/dogs\u0026quot; title=\u0026quot;2,413 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Dogs\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment65573645_20996154\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-08-24 01:52:35Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 24, 2016 at 1:52\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Not only is the database utilizing indexes and statistics, all of the operations are also local I/O, much of which is often operating against highly efficient cache rather than disk. The database programmers devote an awful lot of attention to optimizing these sorts of things.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/618649/craig-tullis\u0026quot; title=\u0026quot;9,179 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Craig Tullis\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment79259068_20996154\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2017-09-11 05:37:03Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 11, 2017 at 5:37\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;i\u0026apos;m so glad i stumbled on your post, because i thought i was going crazy.  when i found out about the N+1 problem, my immediate thought was- well, why don\u0026apos;t you just create a view that contains all the information you need, and pull from that view?  you have validated my position.  thank you sir.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/292010/a-developer\u0026quot; title=\u0026quot;403 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;a developer\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment9005700_6299416\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2011-09-16 15:07:04Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 16, 2011 at 15:07\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;\u0026lt;i\u0026gt;We moved away from the ORM in Django because of this problem.\u0026lt;/i\u0026gt; Huh? Django has \u0026lt;code\u0026gt;select_related\u0026lt;/code\u0026gt;, which is meant to solve this - in fact, its docs start with an example similar to your \u0026lt;code\u0026gt;p.car.colour\u0026lt;/code\u0026gt; example.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2468469/adrian17\u0026quot; title=\u0026quot;423 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Adrian17\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment51149470_6299416\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-07-23 22:08:48Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 23, 2015 at 22:08\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;This is an old anwswer, we have \u0026lt;code\u0026gt;select_related()\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;prefetch_related()\u0026lt;/code\u0026gt; in Django now.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/342473/mariusz-jamro\u0026quot; title=\u0026quot;29,265 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Mariusz Jamro\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment65180422_6299416\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-08-12 06:39:21Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 12, 2016 at 6:39\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Cool. But \u0026lt;code\u0026gt;select_related()\u0026lt;/code\u0026gt; and friend don\u0026apos;t seem to do any of the obviously useful extrapolations of a join such as \u0026lt;code\u0026gt;LEFT OUTER JOIN\u0026lt;/code\u0026gt;. The problem isn\u0026apos;t an interface problem, but an issue to do with the strange idea that objects and relational data are mappable....in my view.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/299031/rorycl\u0026quot; title=\u0026quot;1,314 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;rorycl\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment91642788_6299416\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2018-09-15 20:45:08Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 15, 2018 at 20:45\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;joins are not a good solution (often), because they may result in a cartesian product, meaning the number of result rows is the number of root table results multiplied with the number of results in each child table. particularly bad over multiple herarchy levels. Selecting 20 \u0026quot;blogs\u0026quot; with 100 \u0026quot;posts\u0026quot; on each and 10 \u0026quot;comments\u0026quot; on each post will result in 20000 result rows. NHibernate has workarounds, like the \u0026quot;batch-size\u0026quot; (select children with in clause on parent ids) or \u0026quot;subselect\u0026quot;.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/832306/erik-hart\u0026quot; title=\u0026quot;1,004 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Erik Hart\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment28357102_10905819\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-10-03 20:12:28Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 3, 2013 at 20:12\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 2 times\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;i read the hibernate page. It doesn\u0026apos;t say what the \u0026lt;i\u0026gt;N+1 selects problem\u0026lt;/i\u0026gt; actually \u0026lt;i\u0026gt;is\u0026lt;/i\u0026gt;. But it says you can use joins to fix it.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/12597/ian-boyd\u0026quot; title=\u0026quot;235,048 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Ian Boyd\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment3748487_3298897\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2010-08-26 11:25:54Z, License: CC BY-SA 2.5\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 26, 2010 at 11:25\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;batch-size is required for select fetching, to select child objects for multiple parents in one select statement. Subselect could be another alternative. Joins can get really bad if you have multiple hierarchy levels and a cartesian product is created.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/832306/erik-hart\u0026quot; title=\u0026quot;1,004 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Erik Hart\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment28357322_3298897\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-10-03 20:19:38Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 3, 2013 at 20:19\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Again, joins are not a good solution, especially when more than 2 hierarchy levels may be loaded. Check \u0026quot;subselect\u0026quot; or \u0026quot;batch-size\u0026quot; instead; the last will load children by parent IDs in \u0026quot;in\u0026quot; clause, such as \u0026quot;select ... from wheels where car_id in (1,3,4,6,7,8,11,13)\u0026quot;.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/832306/erik-hart\u0026quot; title=\u0026quot;1,004 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Erik Hart\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment28357636_17621164\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-10-03 20:29:31Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 3, 2013 at 20:29\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        "],"id":460,"title":"What is the \"N+1 selects problem\" in ORM (Object-Relational Mapping)?","content":"\n                \n\u0026lt;p\u0026gt;The \u0026quot;N+1 selects problem\u0026quot; is generally stated as a problem in Object-Relational mapping (ORM) discussions, and I understand that it has something to do with having to make a lot of database queries for something that seems simple in the object world.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Does anybody have a more detailed explanation of the problem?\u0026lt;/p\u0026gt;\n    ","slug":"what-is-the-\"n+1-selects-problem\"-in-orm-(object-relational-mapping)-1657388055597","postType":"QUESTION","createdAt":"2022-07-09T17:34:15.000Z","updatedAt":"2022-07-09T17:34:15.000Z","tags":[{"id":2356,"name":"orm","slug":"orm","createdAt":"2022-07-09T17:34:15.000Z","updatedAt":"2022-07-09T17:34:15.000Z","Questions_Tags":{"questionId":460,"tagId":2356}}]}]}},"__N_SSG":true},"page":"/questions/tag/[slug]","query":{"slug":"orm"},"buildId":"4Y8KGE-c2lolBeBmcum_I","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>