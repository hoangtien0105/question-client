<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2eccd4d47c856f2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2eccd4d47c856f2b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-20edbe0b078add93.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/613-1e0aa2b2023820bb.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/81-301f760ac8107464.js" defer=""></script><script src="/_next/static/chunks/pages/questions/tag/%5Bslug%5D-6802ea06aeddcbec.js" defer=""></script><script src="/_next/static/B9ZMQqRLGvIP-RcWN9dT2/_buildManifest.js" defer=""></script><script src="/_next/static/B9ZMQqRLGvIP-RcWN9dT2/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5"></style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="https://flowbite.com/docs/images/logo.svg" class="mr-3 h-6 sm:h-9" alt="Flowbite Logo"/><span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Hunter</span></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/tag/firebase-realtime-database#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="flex items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/query-based-on-multiple-where-clauses-in-firebase-1657387494547">Query based on multiple where clauses in Firebase</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/firebase-realtime-database">firebase-realtime-database</a></div></div><div class="mt-4 mb-6" style="height:100px;overflow:auto"><h4 class="font-semibold">Solution 1:</h4><div class="text-sm bg-green-100 text-neutral-600">
<p>Using <a href="https://www.firebase.com/docs/beta/queries/web.html" rel="noreferrer">Firebase's Query API</a>, you might be tempted to try this:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// !!! THIS WILL NOT WORK !!!</span>
ref
  .<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">'genre'</span>)
  .<span class="hljs-title function_">startAt</span>(<span class="hljs-string">'comedy'</span>).<span class="hljs-title function_">endAt</span>(<span class="hljs-string">'comedy'</span>)
  .<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">'lead'</span>)                  <span class="hljs-comment">// !!! THIS LINE WILL RAISE AN ERROR !!!</span>
  .<span class="hljs-title function_">startAt</span>(<span class="hljs-string">'Jack Nicholson'</span>).<span class="hljs-title function_">endAt</span>(<span class="hljs-string">'Jack Nicholson'</span>)
  .<span class="hljs-title function_">on</span>(<span class="hljs-string">'value'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">snapshot</span>) { 
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(snapshot.<span class="hljs-title function_">val</span>()); 
  });
</code></pre>
<p>But as @RobDiMarco from Firebase says in the comments:</p>
<blockquote>
<p>multiple <code>orderBy()</code> calls will throw an error</p>
</blockquote>
<p>So <strong>my code above will not work</strong>.</p>
<p>I know of three approaches that will work.</p>
<h3>1. filter most on the server, do the rest on the client</h3>
<p>What you <em>can</em> do is execute one <code>orderBy().startAt()./endAt()</code> on the server, pull down the remaining data and filter that in JavaScript code on your client.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">ref
  .<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">'genre'</span>)
  .<span class="hljs-title function_">equalTo</span>(<span class="hljs-string">'comedy'</span>)
  .<span class="hljs-title function_">on</span>(<span class="hljs-string">'child_added'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">snapshot</span>) { 
      <span class="hljs-keyword">var</span> movie = snapshot.<span class="hljs-title function_">val</span>();
      <span class="hljs-keyword">if</span> (movie.<span class="hljs-property">lead</span> == <span class="hljs-string">'Jack Nicholson'</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(movie);
      }
  });
</code></pre>
<h3>2. add a property that combines the values that you want to filter on</h3>
<p>If that isn't good enough, you should consider modifying/expanding your data to allow your use-case. For example: you could stuff genre+lead into a single property that you just use for this filter.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-string">"movie1"</span>: {
    <span class="hljs-string">"genre"</span>: <span class="hljs-string">"comedy"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"As good as it gets"</span>,
    <span class="hljs-string">"lead"</span>: <span class="hljs-string">"Jack Nicholson"</span>,
    <span class="hljs-string">"genre_lead"</span>: <span class="hljs-string">"comedy_Jack Nicholson"</span>
}, <span class="hljs-comment">//...</span>
</code></pre>
<p>You're essentially building your own multi-column index that way and can query it with:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">ref
  .<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">'genre_lead'</span>)
  .<span class="hljs-title function_">equalTo</span>(<span class="hljs-string">'comedy_Jack Nicholson'</span>)
  .<span class="hljs-title function_">on</span>(<span class="hljs-string">'child_added'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">snapshot</span>) { 
      <span class="hljs-keyword">var</span> movie = snapshot.<span class="hljs-title function_">val</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(movie);
  });
</code></pre>
<p>David East has written a <a href="https://github.com/davideast/Querybase" rel="noreferrer">library called QueryBase that helps with generating such properties</a>.</p>
<p>You could even do relative/range queries, let's say that you want to allow querying movies by category and year. You'd use this data structure:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-string">"movie1"</span>: {
    <span class="hljs-string">"genre"</span>: <span class="hljs-string">"comedy"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"As good as it gets"</span>,
    <span class="hljs-string">"lead"</span>: <span class="hljs-string">"Jack Nicholson"</span>,
    <span class="hljs-string">"genre_year"</span>: <span class="hljs-string">"comedy_1997"</span>
}, <span class="hljs-comment">//...</span>
</code></pre>
<p>And then query for comedies of the 90s with:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">ref
  .<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">'genre_year'</span>)
  .<span class="hljs-title function_">startAt</span>(<span class="hljs-string">'comedy_1990'</span>)
  .<span class="hljs-title function_">endAt</span>(<span class="hljs-string">'comedy_2000'</span>)
  .<span class="hljs-title function_">on</span>(<span class="hljs-string">'child_added'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">snapshot</span>) { 
      <span class="hljs-keyword">var</span> movie = snapshot.<span class="hljs-title function_">val</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(movie);
  });
</code></pre>
<p>If you need to filter on more than just the year, make sure to add the other date parts in descending order, e.g. <code>"comedy_1997-12-25"</code>. This way the lexicographical ordering that Firebase does on string values will be the same as the chronological ordering.</p>
<p>This combining of values in a property can work with more than two values, but you can only do a range filter on the last value in the composite property.</p>
<p>A very special variant of this is implemented by the <a href="https://github.com/firebase/geofire-js" rel="noreferrer">GeoFire library for Firebase</a>. This library combines the latitude and longitude of a location into a so-called <a href="https://en.wikipedia.org/wiki/Geohash" rel="noreferrer">Geohash</a>, which can then be used to do realtime range queries on Firebase.</p>
<h3>3. create a custom index programmatically</h3>
<p>Yet another alternative is to do what we've all done before this new Query API was added: create an index in a different node:</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">  <span class="hljs-string">"movies"</span>
      <span class="hljs-comment">// the same structure you have today</span>
  <span class="hljs-string">"by_genre"</span>
      <span class="hljs-string">"comedy"</span>
          <span class="hljs-string">"by_lead"</span>
              <span class="hljs-string">"Jack Nicholson"</span>
                  <span class="hljs-string">"movie1"</span>
              <span class="hljs-string">"Jim Carrey"</span>
                  <span class="hljs-string">"movie3"</span>
      <span class="hljs-string">"Horror"</span>
          <span class="hljs-string">"by_lead"</span>
              <span class="hljs-string">"Jack Nicholson"</span>
                  <span class="hljs-string">"movie2"</span>
      
</code></pre>
<p>There are probably more approaches. For example, this answer highlights an alternative tree-shaped custom index: <a href="https://stackoverflow.com/a/34105063">https://stackoverflow.com/a/34105063</a></p>
<hr>
<p>If none of these options work for you, but you still want to store your data in Firebase, you can also consider using its <a href="https://firebase.google.com/docs/firestore" rel="noreferrer">Cloud Firestore database</a>.</p>
<p>Cloud Firestore can handle multiple equality filters in a single query, but only one range filter. Under the hood it essentially uses the same query model, but it's like it auto-generates the composite properties for you. See Firestore's documentation on <a href="https://firebase.google.com/docs/firestore/query-data/queries#compound_queries" rel="noreferrer">compound queries</a>.</p>
    </div></div><div><div class="flex items-center justify-between text-slate-500"><div class="flex space-x-4 md:space-x-8"><div class="flex cursor-pointer items-center transition hover:text-slate-600"><svg xmlns="http://www.w3.org/2000/svg" class="mr-1.5 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path></svg><span>4</span></div></div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"count":1,"rows":[{"answer":["\n\u0026lt;p\u0026gt;Using \u0026lt;a href=\u0026quot;https://www.firebase.com/docs/beta/queries/web.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Firebase\u0026apos;s Query API\u0026lt;/a\u0026gt;, you might be tempted to try this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// !!! THIS WILL NOT WORK !!!\u0026lt;/span\u0026gt;\nref\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;orderBy\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;genre\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;startAt\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;comedy\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endAt\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;comedy\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;orderBy\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;lead\u0026apos;\u0026lt;/span\u0026gt;)                  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// !!! THIS LINE WILL RAISE AN ERROR !!!\u0026lt;/span\u0026gt;\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;startAt\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Jack Nicholson\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endAt\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Jack Nicholson\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;on\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;value\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;snapshot\u0026lt;/span\u0026gt;) { \n      \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(snapshot.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;val\u0026lt;/span\u0026gt;()); \n  });\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;But as @RobDiMarco from Firebase says in the comments:\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;multiple \u0026lt;code\u0026gt;orderBy()\u0026lt;/code\u0026gt; calls will throw an error\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;So \u0026lt;strong\u0026gt;my code above will not work\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I know of three approaches that will work.\u0026lt;/p\u0026gt;\n\u0026lt;h3\u0026gt;1. filter most on the server, do the rest on the client\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;What you \u0026lt;em\u0026gt;can\u0026lt;/em\u0026gt; do is execute one \u0026lt;code\u0026gt;orderBy().startAt()./endAt()\u0026lt;/code\u0026gt; on the server, pull down the remaining data and filter that in JavaScript code on your client.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;ref\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;orderBy\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;genre\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;equalTo\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;comedy\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;on\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;child_added\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;snapshot\u0026lt;/span\u0026gt;) { \n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; movie = snapshot.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;val\u0026lt;/span\u0026gt;();\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (movie.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;lead\u0026lt;/span\u0026gt; == \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Jack Nicholson\u0026apos;\u0026lt;/span\u0026gt;) {\n          \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(movie);\n      }\n  });\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;h3\u0026gt;2. add a property that combines the values that you want to filter on\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;If that isn\u0026apos;t good enough, you should consider modifying/expanding your data to allow your use-case. For example: you could stuff genre+lead into a single property that you just use for this filter.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;movie1\u0026quot;\u0026lt;/span\u0026gt;: {\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;genre\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;comedy\u0026quot;\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;name\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;As good as it gets\u0026quot;\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;lead\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Jack Nicholson\u0026quot;\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;genre_lead\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;comedy_Jack Nicholson\u0026quot;\u0026lt;/span\u0026gt;\n}, \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//...\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;You\u0026apos;re essentially building your own multi-column index that way and can query it with:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;ref\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;orderBy\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;genre_lead\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;equalTo\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;comedy_Jack Nicholson\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;on\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;child_added\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;snapshot\u0026lt;/span\u0026gt;) { \n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; movie = snapshot.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;val\u0026lt;/span\u0026gt;();\n      \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(movie);\n  });\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;David East has written a \u0026lt;a href=\u0026quot;https://github.com/davideast/Querybase\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;library called QueryBase that helps with generating such properties\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;You could even do relative/range queries, let\u0026apos;s say that you want to allow querying movies by category and year. You\u0026apos;d use this data structure:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;movie1\u0026quot;\u0026lt;/span\u0026gt;: {\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;genre\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;comedy\u0026quot;\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;name\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;As good as it gets\u0026quot;\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;lead\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Jack Nicholson\u0026quot;\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;genre_year\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;comedy_1997\u0026quot;\u0026lt;/span\u0026gt;\n}, \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//...\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;And then query for comedies of the 90s with:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;ref\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;orderBy\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;genre_year\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;startAt\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;comedy_1990\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;endAt\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;comedy_2000\u0026apos;\u0026lt;/span\u0026gt;)\n  .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;on\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;child_added\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;snapshot\u0026lt;/span\u0026gt;) { \n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; movie = snapshot.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;val\u0026lt;/span\u0026gt;();\n      \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(movie);\n  });\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;If you need to filter on more than just the year, make sure to add the other date parts in descending order, e.g. \u0026lt;code\u0026gt;\u0026quot;comedy_1997-12-25\u0026quot;\u0026lt;/code\u0026gt;. This way the lexicographical ordering that Firebase does on string values will be the same as the chronological ordering.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;This combining of values in a property can work with more than two values, but you can only do a range filter on the last value in the composite property.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;A very special variant of this is implemented by the \u0026lt;a href=\u0026quot;https://github.com/firebase/geofire-js\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;GeoFire library for Firebase\u0026lt;/a\u0026gt;. This library combines the latitude and longitude of a location into a so-called \u0026lt;a href=\u0026quot;https://en.wikipedia.org/wiki/Geohash\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Geohash\u0026lt;/a\u0026gt;, which can then be used to do realtime range queries on Firebase.\u0026lt;/p\u0026gt;\n\u0026lt;h3\u0026gt;3. create a custom index programmatically\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;Yet another alternative is to do what we\u0026apos;ve all done before this new Query API was added: create an index in a different node:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;movies\u0026quot;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// the same structure you have today\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;by_genre\u0026quot;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;comedy\u0026quot;\u0026lt;/span\u0026gt;\n          \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;by_lead\u0026quot;\u0026lt;/span\u0026gt;\n              \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Jack Nicholson\u0026quot;\u0026lt;/span\u0026gt;\n                  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;movie1\u0026quot;\u0026lt;/span\u0026gt;\n              \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Jim Carrey\u0026quot;\u0026lt;/span\u0026gt;\n                  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;movie3\u0026quot;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Horror\u0026quot;\u0026lt;/span\u0026gt;\n          \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;by_lead\u0026quot;\u0026lt;/span\u0026gt;\n              \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Jack Nicholson\u0026quot;\u0026lt;/span\u0026gt;\n                  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;movie2\u0026quot;\u0026lt;/span\u0026gt;\n      \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;There are probably more approaches. For example, this answer highlights an alternative tree-shaped custom index: \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/34105063\u0026quot;\u0026gt;https://stackoverflow.com/a/34105063\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;If none of these options work for you, but you still want to store your data in Firebase, you can also consider using its \u0026lt;a href=\u0026quot;https://firebase.google.com/docs/firestore\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Cloud Firestore database\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Cloud Firestore can handle multiple equality filters in a single query, but only one range filter. Under the hood it essentially uses the same query model, but it\u0026apos;s like it auto-generates the composite properties for you. See Firestore\u0026apos;s documentation on \u0026lt;a href=\u0026quot;https://firebase.google.com/docs/firestore/query-data/queries#compound_queries\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;compound queries\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I\u0026apos;ve written a personal library that allows you to order by multiple values, with all the ordering done on the server.\u0026lt;/p\u0026gt;\n\u0026lt;h3\u0026gt;\u0026lt;a href=\u0026quot;https://github.com/davideast/Querybase\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;strong\u0026gt;Meet Querybase!\u0026lt;/strong\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/h3\u0026gt;\n\u0026lt;p\u0026gt;Querybase takes in a Firebase Database Reference and an array of fields you wish to index on. When you create new records it will automatically handle the generation of keys that allow for multiple querying. The caveat is that it only supports straight equivalence (no less than or greater than).\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; databaseRef = firebase.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;database\u0026lt;/span\u0026gt;().\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;ref\u0026lt;/span\u0026gt;().\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;child\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;people\u0026apos;\u0026lt;/span\u0026gt;);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; querybaseRef = querybase.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;ref\u0026lt;/span\u0026gt;(databaseRef, [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;name\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;age\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;location\u0026apos;\u0026lt;/span\u0026gt;]);\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Automatically handles composite keys\u0026lt;/span\u0026gt;\nquerybaseRef.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;({ \n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;name\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;David\u0026apos;\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;age\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;27\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;location\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SF\u0026apos;\u0026lt;/span\u0026gt;\n});\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Find records by multiple fields\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// returns a Firebase Database ref\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; queriedDbRef = querybaseRef\n .\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt;({\n   \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;name\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;David\u0026apos;\u0026lt;/span\u0026gt;,\n   \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;age\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;27\u0026lt;/span\u0026gt;\n });\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Listen for realtime updates\u0026lt;/span\u0026gt;\nqueriedDbRef.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;on\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;value\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;snap\u0026lt;/span\u0026gt; =\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;console\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;log\u0026lt;/span\u0026gt;(snap));\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;var ref = new Firebase(\u0026apos;https://your.firebaseio.com/\u0026apos;);\n\nQuery query = ref.orderByChild(\u0026apos;genre\u0026apos;).equalTo(\u0026apos;comedy\u0026apos;);\nquery.addValueEventListener(new ValueEventListener() {\n    @Override\n    public void onDataChange(DataSnapshot dataSnapshot) {\n        for (DataSnapshot movieSnapshot : dataSnapshot.getChildren()) {\n            Movie movie = dataSnapshot.getValue(Movie.class);\n            if (movie.getLead().equals(\u0026apos;Jack Nicholson\u0026apos;)) {\n                console.log(movieSnapshot.getKey());\n            }\n        }\n    }\n\n    @Override\n    public void onCancelled(FirebaseError firebaseError) {\n\n    }\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Frank\u0026apos;s answer is good but Firestore introduced \u0026lt;a href=\u0026quot;https://firebase.google.com/docs/firestore/query-data/queries#array_membership\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;array-contains\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; recently that makes it easier to do AND queries.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;You can create a \u0026lt;code\u0026gt;filters\u0026lt;/code\u0026gt; field to add you filters. You can add as many values as you need. For example to filter by \u0026lt;em\u0026gt;comedy\u0026lt;/em\u0026gt; and \u0026lt;em\u0026gt;Jack Nicholson\u0026lt;/em\u0026gt; you can add the value \u0026lt;code\u0026gt;comedy_Jack Nicholson\u0026lt;/code\u0026gt; but if you also you want to by \u0026lt;em\u0026gt;comedy\u0026lt;/em\u0026gt; and \u0026lt;em\u0026gt;2014\u0026lt;/em\u0026gt; you can add the value \u0026lt;code\u0026gt;comedy_2014\u0026lt;/code\u0026gt; without creating more fields.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-json s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-json\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;{\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;\u0026quot;movies\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;{\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;\u0026quot;movie1\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;{\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;\u0026quot;genre\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;comedy\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;,\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;\u0026quot;name\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;As good as it gets\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;,\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;\u0026quot;lead\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Jack Nicholson\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;,\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;\u0026quot;year\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2014\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;,\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;\u0026quot;filters\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;:\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;[\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;comedy_Jack Nicholson\u0026quot;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;,\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;comedy_2014\u0026quot;\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;]\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;}\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;}\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-punctuation\u0026quot;\u0026gt;}\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Firebase doesn\u0026apos;t allow querying with multiple conditions. \nHowever, I did find a way around for this:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;We need to download the initial filtered data from the database and store it in an array list.\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;                Query query = databaseReference.orderByChild(\u0026quot;genre\u0026quot;).equalTo(\u0026quot;comedy\u0026quot;);\n                databaseReference.addValueEventListener(new ValueEventListener() {\n                    @Override\n                    public void onDataChange(@NonNull DataSnapshot dataSnapshot) {\n\n                        ArrayList\u0026amp;lt;Movie\u0026amp;gt; movies = new ArrayList\u0026amp;lt;\u0026amp;gt;();\n                        for (DataSnapshot dataSnapshot1 : dataSnapshot.getChildren()) {\n                            String lead = dataSnapshot1.child(\u0026quot;lead\u0026quot;).getValue(String.class);\n                            String genre = dataSnapshot1.child(\u0026quot;genre\u0026quot;).getValue(String.class);\n\n                            movie = new Movie(lead, genre);\n\n                            movies.add(movie);\n\n                        }\n\n                        filterResults(movies, \u0026quot;Jack Nicholson\u0026quot;);\n\n                        }\n\n                    }\n\n                    @Override\n                    public void onCancelled(@NonNull DatabaseError databaseError) {\n\n                    }\n                });\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Once we obtain the initial filtered data from the database, we need to do further filter in our backend.\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;public void filterResults(final List\u0026amp;lt;Movie\u0026amp;gt; list,  final String genre) {\n        List\u0026amp;lt;Movie\u0026amp;gt; movies = new ArrayList\u0026amp;lt;\u0026amp;gt;();\n        movies = list.stream().filter(o -\u0026amp;gt; o.getLead().equals(genre)).collect(Collectors.toList());\n        System.out.println(movies);\n\n        employees.forEach(movie -\u0026amp;gt; System.out.println(movie.getFirstName()));\n    }\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;For Cloud Firestore\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://firebase.google.com/docs/firestore/query-data/queries#compound_queries\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;https://firebase.google.com/docs/firestore/query-data/queries#compound_queries\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Compound queries\nYou can chain multiple equality operators (== or array-contains) methods to create more specific queries (logical AND). However, you must create a composite index to combine equality operators with the inequality operators, \u0026amp;lt;, \u0026amp;lt;=, \u0026amp;gt;, and !=.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;citiesRef.where(\u0026apos;state\u0026apos;, \u0026apos;==\u0026apos;, \u0026apos;CO\u0026apos;).where(\u0026apos;name\u0026apos;, \u0026apos;==\u0026apos;, \u0026apos;Denver\u0026apos;);\ncitiesRef.where(\u0026apos;state\u0026apos;, \u0026apos;==\u0026apos;, \u0026apos;CA\u0026apos;).where(\u0026apos;population\u0026apos;, \u0026apos;\u0026amp;lt;\u0026apos;, 1000000);\nYou can perform range (\u0026amp;lt;, \u0026amp;lt;=, \u0026amp;gt;, \u0026amp;gt;=) or not equals (!=) comparisons only on a single field, and you can include at most one array-contains or array-contains-any clause in a compound query:\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The data from firebase realtime database is as _InternalLinkedHashMap\u0026amp;lt;dynamic, dynamic\u0026amp;gt;.\nYou can also just convert this it to your map and query very easily.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For example, I have a chat app and I use realtime database to store the uid of the user and the bool value whether the user is online or not. As the picture below.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://i.stack.imgur.com/3WK64.png\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;https://i.stack.imgur.com/3WK64.png\u0026quot; alt=\u0026quot;\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Now, I have a class RealtimeDatabase and a static method getAllUsersOnineStatus().\u0026lt;/p\u0026gt;\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;static getOnilineUsersUID() {\nvar dbRef = FirebaseDatabase.instance;\nDatabaseReference reference = dbRef.reference().child(\u0026quot;Online\u0026quot;);\nreference.once().then((value) {\n  Map\u0026amp;lt;String, bool\u0026amp;gt; map = Map\u0026amp;lt;String, bool\u0026amp;gt;.from(value.value);\n  List users = [];\n  map.forEach((key, value) {\n    if (value) {\n      users.add(key);\n    }\n  });\n  print(users);\n});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;}\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;It will print [NOraDTGaQSZbIEszidCujw1AEym2]\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I am new to flutter If you know more please update the answer.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;pre\u0026gt;\u0026lt;code\u0026gt;ref.orderByChild(\u0026quot;lead\u0026quot;).startAt(\u0026quot;Jack Nicholson\u0026quot;).endAt(\u0026quot;Jack Nicholson\u0026quot;).listner....\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;This will work.\u0026lt;/p\u0026gt;\n    "],"id":280,"title":"Query based on multiple where clauses in Firebase","slug":"query-based-on-multiple-where-clauses-in-firebase-1657387494547","postType":"QUESTION","createdAt":"2022-07-09T17:24:54.000Z","updatedAt":"2022-07-09T17:24:54.000Z","tags":[{"id":1723,"name":"firebase-realtime-database","slug":"firebase-realtime-database","createdAt":"2022-07-09T17:24:54.000Z","updatedAt":"2022-07-09T17:24:54.000Z","Questions_Tags":{"questionId":280,"tagId":1723}}]}]}},"__N_SSG":true},"page":"/questions/tag/[slug]","query":{"slug":"firebase-realtime-database"},"buildId":"B9ZMQqRLGvIP-RcWN9dT2","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>