<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2eccd4d47c856f2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2eccd4d47c856f2b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-20edbe0b078add93.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/613-1e0aa2b2023820bb.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/471-84c36aa98dd4107c.js" defer=""></script><script src="/_next/static/chunks/81-096e453de8a27667.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-e3d1b60e109d3ba1.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_buildManifest.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">.hFcsiD code{padding:5px;color:hsl(210deg 8% 15%);background-color:hsl(210deg 8% 90%);border-radius:3px;}/*!sc*/
data-styled.g5[id="sc-6e32c308-0"]{content:"hFcsiD,"}/*!sc*/
.ljvTUN .comment-item .comment-body .d-inline-flex.ai-center{text-align:right;}/*!sc*/
.ljvTUN .comment-item .comment-body .comment-date{float:right;}/*!sc*/
data-styled.g6[id="sc-6e32c308-1"]{content:"ljvTUN,"}/*!sc*/
</style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="https://flowbite.com/docs/images/logo.svg" class="mr-3 h-6 sm:h-9" alt="Flowbite Logo"/><span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Hunter</span></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/convert-rows-to-columns-using-&#x27;pivot&#x27;-in-sql-server-1657388372528#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="sc-6e32c308-0 hFcsiD flex question-header items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/convert-rows-to-columns-using-&#x27;pivot&#x27;-in-sql-server-1657388372528">Convert Rows to columns using &#x27;Pivot&#x27; in SQL Server</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/pivot-table">pivot-table</a></div></div><div class="question-content mt-5">
                
<p>I have read the stuff on MS pivot tables and I am still having problems getting this correct.</p>

<p>I have a temp table that is being created, we will say that column 1 is a Store number, and column 2 is a week number and lastly column 3 is a total of some type. Also the Week numbers are dynamic, the store numbers are static.</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">Store      Week     xCount
<span class="hljs-comment">-------    ----     ------</span>
<span class="hljs-number">102</span>        <span class="hljs-number">1</span>        <span class="hljs-number">96</span>
<span class="hljs-number">101</span>        <span class="hljs-number">1</span>        <span class="hljs-number">138</span>
<span class="hljs-number">105</span>        <span class="hljs-number">1</span>        <span class="hljs-number">37</span>
<span class="hljs-number">109</span>        <span class="hljs-number">1</span>        <span class="hljs-number">59</span>
<span class="hljs-number">101</span>        <span class="hljs-number">2</span>        <span class="hljs-number">282</span>
<span class="hljs-number">102</span>        <span class="hljs-number">2</span>        <span class="hljs-number">212</span>
<span class="hljs-number">105</span>        <span class="hljs-number">2</span>        <span class="hljs-number">78</span>
<span class="hljs-number">109</span>        <span class="hljs-number">2</span>        <span class="hljs-number">97</span>
<span class="hljs-number">105</span>        <span class="hljs-number">3</span>        <span class="hljs-number">60</span>
<span class="hljs-number">102</span>        <span class="hljs-number">3</span>        <span class="hljs-number">123</span>
<span class="hljs-number">101</span>        <span class="hljs-number">3</span>        <span class="hljs-number">220</span>
<span class="hljs-number">109</span>        <span class="hljs-number">3</span>        <span class="hljs-number">87</span>
</code></pre>

<p>I would like it to come out as a pivot table, like this:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">Store        <span class="hljs-number">1</span>          <span class="hljs-number">2</span>          <span class="hljs-number">3</span>        <span class="hljs-number">4</span>        <span class="hljs-number">5</span>        <span class="hljs-number">6.</span>...
<span class="hljs-comment">----- </span>
<span class="hljs-number">101</span>        <span class="hljs-number">138</span>        <span class="hljs-number">282</span>        <span class="hljs-number">220</span>
<span class="hljs-number">102</span>         <span class="hljs-number">96</span>        <span class="hljs-number">212</span>        <span class="hljs-number">123</span>
<span class="hljs-number">105</span>         <span class="hljs-number">37</span>        
<span class="hljs-number">109</span>
</code></pre>

<p>Store numbers down the side and weeks across the top.</p>
    </div></div></div><div class="sc-6e32c308-1 ljvTUN flex text-xs pl-10 flex-col comment items-center justify-center"><h4 class="text-left mt-10 text-lg font-semibold">Comments</h4><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">possible duplicate of <a href="http://stackoverflow.com/questions/10404348/sql-server-dynamic-pivot-query">SQL Server dynamic PIVOT query?</a></span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/573261/richardthekiwi" title="103,144 reputation" class="comment-user">RichardTheKiwi</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment23432215_15931607"><span title="2013-05-03 09:46:29Z, License: CC BY-SA 3.0" class="relativetime-clean">May 3, 2013 at 9:46</span></a></span>
            </div>
        </div><span class="divide-x-8 "></span><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">Possible duplicate? That one is a possible duplicate. Look at the dates!</span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/2267015/lynn" title="3,372 reputation" class="comment-user owner">Lynn</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment128281550_15931607"><span title="2022-06-14 18:03:47Z, License: CC BY-SA 4.0" class="relativetime-clean">Jun 14 at 18:03</span></a></span>
            </div>
        </div><span class="divide-x-8 "></span><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">Very nice! But how to eliminate column when all values of that column are NULL?</span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/772930/zooz" title="835 reputation" class="comment-user">ZooZ</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment44428744_15931734"><span title="2015-01-19 09:22:10Z, License: CC BY-SA 3.0" class="relativetime-clean">Jan 19, 2015 at 9:22</span></a></span>
            </div>
        </div><span class="divide-x-8 "></span><button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">See more</button></div><div class="sc-6e32c308-2 bFXWFO"><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If you are using SQL Server 2005+, then you can use the <code>PIVOT</code> function to transform the data from rows into columns.</p>
<p>It sounds like you will need to use dynamic sql if the weeks are unknown but it is easier to see the correct code using a hard-coded version initially.</p>
<p>First up, here are some quick table definitions and data for use:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> yt 
(
  [Store] <span class="hljs-type">int</span>, 
  [Week] <span class="hljs-type">int</span>, 
  [xCount] <span class="hljs-type">int</span>
);
    
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> yt
(
  [Store], 
  [Week], [xCount]
)
<span class="hljs-keyword">VALUES</span>
    (<span class="hljs-number">102</span>, <span class="hljs-number">1</span>, <span class="hljs-number">96</span>),
    (<span class="hljs-number">101</span>, <span class="hljs-number">1</span>, <span class="hljs-number">138</span>),
    (<span class="hljs-number">105</span>, <span class="hljs-number">1</span>, <span class="hljs-number">37</span>),
    (<span class="hljs-number">109</span>, <span class="hljs-number">1</span>, <span class="hljs-number">59</span>),
    (<span class="hljs-number">101</span>, <span class="hljs-number">2</span>, <span class="hljs-number">282</span>),
    (<span class="hljs-number">102</span>, <span class="hljs-number">2</span>, <span class="hljs-number">212</span>),
    (<span class="hljs-number">105</span>, <span class="hljs-number">2</span>, <span class="hljs-number">78</span>),
    (<span class="hljs-number">109</span>, <span class="hljs-number">2</span>, <span class="hljs-number">97</span>),
    (<span class="hljs-number">105</span>, <span class="hljs-number">3</span>, <span class="hljs-number">60</span>),
    (<span class="hljs-number">102</span>, <span class="hljs-number">3</span>, <span class="hljs-number">123</span>),
    (<span class="hljs-number">101</span>, <span class="hljs-number">3</span>, <span class="hljs-number">220</span>),
    (<span class="hljs-number">109</span>, <span class="hljs-number">3</span>, <span class="hljs-number">87</span>);
</code></pre>
<p>If your values are known, then you will hard-code the query:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">from</span> 
(
  <span class="hljs-keyword">select</span> store, week, xCount
  <span class="hljs-keyword">from</span> yt 
) src
pivot
(
  <span class="hljs-built_in">sum</span>(xcount)
  <span class="hljs-keyword">for</span> week <span class="hljs-keyword">in</span> ([<span class="hljs-number">1</span>], [<span class="hljs-number">2</span>], [<span class="hljs-number">3</span>])
) piv;
</code></pre>
<p>See <a href="https://data.stackexchange.com/stackoverflow/query/580181" rel="noreferrer">SQL Demo</a></p>
<p>Then if you need to generate the week number dynamically, your code will be:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@cols</span> <span class="hljs-keyword">AS</span> NVARCHAR(MAX),
    <span class="hljs-variable">@query</span>  <span class="hljs-keyword">AS</span> NVARCHAR(MAX)

<span class="hljs-keyword">select</span> <span class="hljs-variable">@cols</span> <span class="hljs-operator">=</span> STUFF((<span class="hljs-keyword">SELECT</span> <span class="hljs-string">','</span> <span class="hljs-operator">+</span> QUOTENAME(Week) 
                    <span class="hljs-keyword">from</span> yt
                    <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> Week
                    <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> Week
            <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>), TYPE
            ).<span class="hljs-keyword">value</span>(<span class="hljs-string">'.'</span>, <span class="hljs-string">'NVARCHAR(MAX)'</span>) 
        ,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-string">''</span>)

<span class="hljs-keyword">set</span> <span class="hljs-variable">@query</span> <span class="hljs-operator">=</span> <span class="hljs-string">'SELECT store,'</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@cols</span> <span class="hljs-operator">+</span> <span class="hljs-string">' from 
             (
                select store, week, xCount
                from yt
            ) x
            pivot 
            (
                sum(xCount)
                for week in ('</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@cols</span> <span class="hljs-operator">+</span> <span class="hljs-string">')
            ) p '</span>

<span class="hljs-keyword">execute</span>(<span class="hljs-variable">@query</span>);
</code></pre>
<p>See <a href="https://data.stackexchange.com/stackoverflow/query/580183" rel="noreferrer">SQL Demo</a>.</p>
<p>The dynamic version, generates the list of <code>week</code> numbers that should be converted to columns. Both give the same result:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-operator">|</span> STORE <span class="hljs-operator">|</span>   <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">2</span> <span class="hljs-operator">|</span>   <span class="hljs-number">3</span> <span class="hljs-operator">|</span>
<span class="hljs-comment">---------------------------</span>
<span class="hljs-operator">|</span>   <span class="hljs-number">101</span> <span class="hljs-operator">|</span> <span class="hljs-number">138</span> <span class="hljs-operator">|</span> <span class="hljs-number">282</span> <span class="hljs-operator">|</span> <span class="hljs-number">220</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>   <span class="hljs-number">102</span> <span class="hljs-operator">|</span>  <span class="hljs-number">96</span> <span class="hljs-operator">|</span> <span class="hljs-number">212</span> <span class="hljs-operator">|</span> <span class="hljs-number">123</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>   <span class="hljs-number">105</span> <span class="hljs-operator">|</span>  <span class="hljs-number">37</span> <span class="hljs-operator">|</span>  <span class="hljs-number">78</span> <span class="hljs-operator">|</span>  <span class="hljs-number">60</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>   <span class="hljs-number">109</span> <span class="hljs-operator">|</span>  <span class="hljs-number">59</span> <span class="hljs-operator">|</span>  <span class="hljs-number">97</span> <span class="hljs-operator">|</span>  <span class="hljs-number">87</span> <span class="hljs-operator">|</span>
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>This is for dynamic # of weeks.</p>

<p>Full example here:<a href="http://sqlhints.com/2014/03/18/dynamic-pivot-in-sql-server/" rel="noreferrer">SQL Dynamic Pivot</a></p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@DynamicPivotQuery</span> <span class="hljs-keyword">AS</span> NVARCHAR(MAX)
<span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@ColumnName</span> <span class="hljs-keyword">AS</span> NVARCHAR(MAX)

<span class="hljs-comment">--Get distinct values of the PIVOT Column </span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@ColumnName</span><span class="hljs-operator">=</span> ISNULL(<span class="hljs-variable">@ColumnName</span> <span class="hljs-operator">+</span> <span class="hljs-string">','</span>,<span class="hljs-string">''</span>) <span class="hljs-operator">+</span> QUOTENAME(Week)
<span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> Week <span class="hljs-keyword">FROM</span> #StoreSales) <span class="hljs-keyword">AS</span> Weeks

<span class="hljs-comment">--Prepare the PIVOT query using the dynamic </span>
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@DynamicPivotQuery</span> <span class="hljs-operator">=</span> 
  N<span class="hljs-string">'SELECT Store, '</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@ColumnName</span> <span class="hljs-operator">+</span> <span class="hljs-string">' 
    FROM #StoreSales
    PIVOT(SUM(xCount) 
          FOR Week IN ('</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@ColumnName</span> <span class="hljs-operator">+</span> <span class="hljs-string">')) AS PVTTable'</span>
<span class="hljs-comment">--Execute the Dynamic Pivot Query</span>
<span class="hljs-keyword">EXEC</span> sp_executesql <span class="hljs-variable">@DynamicPivotQuery</span>
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I've achieved the same thing before by using subqueries.  So if your original table was called StoreCountsByWeek, and you had a separate table that listed the Store IDs, then it would look like this:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> StoreID, 
    Week1<span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> ISNULL(<span class="hljs-built_in">SUM</span>(xCount),<span class="hljs-number">0</span>) <span class="hljs-keyword">FROM</span> StoreCountsByWeek <span class="hljs-keyword">WHERE</span> StoreCountsByWeek.StoreID<span class="hljs-operator">=</span>Store.StoreID <span class="hljs-keyword">AND</span> Week<span class="hljs-operator">=</span><span class="hljs-number">1</span>),
    Week2<span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> ISNULL(<span class="hljs-built_in">SUM</span>(xCount),<span class="hljs-number">0</span>) <span class="hljs-keyword">FROM</span> StoreCountsByWeek <span class="hljs-keyword">WHERE</span> StoreCountsByWeek.StoreID<span class="hljs-operator">=</span>Store.StoreID <span class="hljs-keyword">AND</span> Week<span class="hljs-operator">=</span><span class="hljs-number">2</span>),
    Week3<span class="hljs-operator">=</span>(<span class="hljs-keyword">SELECT</span> ISNULL(<span class="hljs-built_in">SUM</span>(xCount),<span class="hljs-number">0</span>) <span class="hljs-keyword">FROM</span> StoreCountsByWeek <span class="hljs-keyword">WHERE</span> StoreCountsByWeek.StoreID<span class="hljs-operator">=</span>Store.StoreID <span class="hljs-keyword">AND</span> Week<span class="hljs-operator">=</span><span class="hljs-number">3</span>)
<span class="hljs-keyword">FROM</span> Store
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> StoreID
</code></pre>

<p>One advantage to this method is that the syntax is more clear and it makes it easier to join to other tables to pull other fields into the results too.</p>

<p>My anecdotal results are that running this query over a couple of thousand rows completed in less than one second, and I actually had 7 subqueries.  But as noted in the comments, it is more computationally expensive to do it this way, so be careful about using this method if you expect it to run on large amounts of data .</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>This is what you can do:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> 
<span class="hljs-keyword">FROM</span> yourTable
PIVOT (<span class="hljs-built_in">MAX</span>(xCount) 
       <span class="hljs-keyword">FOR</span> Week <span class="hljs-keyword">in</span> ([<span class="hljs-number">1</span>],[<span class="hljs-number">2</span>],[<span class="hljs-number">3</span>],[<span class="hljs-number">4</span>],[<span class="hljs-number">5</span>],[<span class="hljs-number">6</span>],[<span class="hljs-number">7</span>])) <span class="hljs-keyword">AS</span> pvt
</code></pre>

<p><a href="http://www.sqlfiddle.com/#!3/16fd1/1" rel="noreferrer">DEMO</a></p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I'm writing an sp that could be useful for this purpose, basically this sp pivot any table and return a new table pivoted or return just the set of data, this is the way to execute it:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">Exec</span> dbo.rs_pivot_table <span class="hljs-variable">@schema</span><span class="hljs-operator">=</span>dbo,<span class="hljs-variable">@table</span><span class="hljs-operator">=</span>table_name,<span class="hljs-variable">@column</span><span class="hljs-operator">=</span>column_to_pivot,<span class="hljs-variable">@agg</span><span class="hljs-operator">=</span><span class="hljs-string">'sum([column_to_agg]),avg([another_column_to_agg]),'</span>,
        <span class="hljs-variable">@sel</span>_cols<span class="hljs-operator">=</span><span class="hljs-string">'column_to_select1,column_to_select2,column_to_select1'</span>,<span class="hljs-variable">@new</span>_table<span class="hljs-operator">=</span>returned_table_pivoted;
</code></pre>

<p><strong>please note</strong> that in the parameter @agg the column names must be with <code>'['</code> and the parameter must end with a comma <code>','</code></p>

<p>SP</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">Create</span> <span class="hljs-keyword">Procedure</span> [dbo].[rs_pivot_table]
    <span class="hljs-variable">@schema</span> sysname<span class="hljs-operator">=</span>dbo,
    <span class="hljs-variable">@table</span> sysname,
    <span class="hljs-variable">@column</span> sysname,
    <span class="hljs-variable">@agg</span> nvarchar(max),
    <span class="hljs-variable">@sel</span>_cols <span class="hljs-type">varchar</span>(max),
    <span class="hljs-variable">@new</span>_table sysname,
    <span class="hljs-variable">@add</span>_to_col_name sysname<span class="hljs-operator">=</span><span class="hljs-keyword">null</span>
<span class="hljs-keyword">As</span>
<span class="hljs-comment">--Exec dbo.rs_pivot_table dbo,##TEMPORAL1,tip_liq,'sum([val_liq]),sum([can_liq]),','cod_emp,cod_con,tip_liq',##TEMPORAL1PVT,'hola';</span>
<span class="hljs-keyword">Begin</span>

    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@query</span> <span class="hljs-type">varchar</span>(max)<span class="hljs-operator">=</span><span class="hljs-string">''</span>;
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@aggDet</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>);
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@opp</span>_agg <span class="hljs-type">varchar</span>(<span class="hljs-number">5</span>);
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@col</span>_agg <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>);
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@pivot</span>_col sysname;
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@query</span>_col_pvt <span class="hljs-type">varchar</span>(max)<span class="hljs-operator">=</span><span class="hljs-string">''</span>;
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@full</span>_query_pivot <span class="hljs-type">varchar</span>(max)<span class="hljs-operator">=</span><span class="hljs-string">''</span>;
    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@ind</span>_tmpTbl <span class="hljs-type">int</span>; <span class="hljs-comment">--Indicador de tabla temporal 1=tabla temporal global 0=Tabla fisica</span>

    <span class="hljs-keyword">Create</span> <span class="hljs-keyword">Table</span> #pvt_column(
        pivot_col <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>)
    );

    <span class="hljs-keyword">Declare</span> <span class="hljs-variable">@column</span>_agg <span class="hljs-keyword">table</span>(
        opp_agg <span class="hljs-type">varchar</span>(<span class="hljs-number">5</span>),
        col_agg <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>)
    );

    IF  <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sys.objects <span class="hljs-keyword">WHERE</span> object_id <span class="hljs-operator">=</span> OBJECT_ID(<span class="hljs-variable">@table</span>) <span class="hljs-keyword">AND</span> type <span class="hljs-keyword">in</span> (N<span class="hljs-string">'U'</span>))
        <span class="hljs-keyword">Set</span> <span class="hljs-variable">@ind</span>_tmpTbl<span class="hljs-operator">=</span><span class="hljs-number">0</span>;
    <span class="hljs-keyword">ELSE</span> IF OBJECT_ID(<span class="hljs-string">'tempdb..'</span><span class="hljs-operator">+</span>ltrim(rtrim(<span class="hljs-variable">@table</span>))) <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
        <span class="hljs-keyword">Set</span> <span class="hljs-variable">@ind</span>_tmpTbl<span class="hljs-operator">=</span><span class="hljs-number">1</span>;

    IF  <span class="hljs-keyword">EXISTS</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sys.objects <span class="hljs-keyword">WHERE</span> object_id <span class="hljs-operator">=</span> OBJECT_ID(<span class="hljs-variable">@new</span>_table) <span class="hljs-keyword">AND</span> type <span class="hljs-keyword">in</span> (N<span class="hljs-string">'U'</span>)) <span class="hljs-keyword">OR</span> 
        OBJECT_ID(<span class="hljs-string">'tempdb..'</span><span class="hljs-operator">+</span>ltrim(rtrim(<span class="hljs-variable">@new</span>_table))) <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
    <span class="hljs-keyword">Begin</span>
        <span class="hljs-keyword">Set</span> <span class="hljs-variable">@query</span><span class="hljs-operator">=</span><span class="hljs-string">'DROP TABLE '</span><span class="hljs-operator">+</span><span class="hljs-variable">@new</span>_table<span class="hljs-operator">+</span><span class="hljs-string">''</span>;
        <span class="hljs-keyword">Exec</span> (<span class="hljs-variable">@query</span>);
    <span class="hljs-keyword">End</span>;

    <span class="hljs-keyword">Select</span> <span class="hljs-variable">@query</span><span class="hljs-operator">=</span><span class="hljs-string">'Select distinct '</span><span class="hljs-operator">+</span><span class="hljs-variable">@column</span><span class="hljs-operator">+</span><span class="hljs-string">' From '</span><span class="hljs-operator">+</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> <span class="hljs-variable">@ind</span>_tmpTbl<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">then</span> <span class="hljs-string">'tempdb.'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">''</span> <span class="hljs-keyword">end</span>)<span class="hljs-operator">+</span><span class="hljs-variable">@schema</span><span class="hljs-operator">+</span><span class="hljs-string">'.'</span><span class="hljs-operator">+</span><span class="hljs-variable">@table</span><span class="hljs-operator">+</span><span class="hljs-string">' where '</span><span class="hljs-operator">+</span><span class="hljs-variable">@column</span><span class="hljs-operator">+</span><span class="hljs-string">' is not null;'</span>;
    Print <span class="hljs-variable">@query</span>;

    <span class="hljs-keyword">Insert</span> <span class="hljs-keyword">into</span> #pvt_column(pivot_col)
    <span class="hljs-keyword">Exec</span> (<span class="hljs-variable">@query</span>)

    While charindex(<span class="hljs-string">','</span>,<span class="hljs-variable">@agg</span>,<span class="hljs-number">1</span>)<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span>
    <span class="hljs-keyword">Begin</span>
        <span class="hljs-keyword">Select</span> <span class="hljs-variable">@aggDet</span><span class="hljs-operator">=</span><span class="hljs-built_in">Substring</span>(<span class="hljs-variable">@agg</span>,<span class="hljs-number">1</span>,charindex(<span class="hljs-string">','</span>,<span class="hljs-variable">@agg</span>,<span class="hljs-number">1</span>)<span class="hljs-number">-1</span>);

        <span class="hljs-keyword">Insert</span> <span class="hljs-keyword">Into</span> <span class="hljs-variable">@column</span>_agg(opp_agg,col_agg)
        <span class="hljs-keyword">Values</span>(<span class="hljs-built_in">substring</span>(<span class="hljs-variable">@aggDet</span>,<span class="hljs-number">1</span>,charindex(<span class="hljs-string">'('</span>,<span class="hljs-variable">@aggDet</span>,<span class="hljs-number">1</span>)<span class="hljs-number">-1</span>),ltrim(rtrim(replace(<span class="hljs-built_in">substring</span>(<span class="hljs-variable">@aggDet</span>,charindex(<span class="hljs-string">'['</span>,<span class="hljs-variable">@aggDet</span>,<span class="hljs-number">1</span>),charindex(<span class="hljs-string">']'</span>,<span class="hljs-variable">@aggDet</span>,<span class="hljs-number">1</span>)<span class="hljs-number">-4</span>),<span class="hljs-string">')'</span>,<span class="hljs-string">''</span>))));

        <span class="hljs-keyword">Set</span> <span class="hljs-variable">@agg</span><span class="hljs-operator">=</span><span class="hljs-built_in">Substring</span>(<span class="hljs-variable">@agg</span>,charindex(<span class="hljs-string">','</span>,<span class="hljs-variable">@agg</span>,<span class="hljs-number">1</span>)<span class="hljs-operator">+</span><span class="hljs-number">1</span>,len(<span class="hljs-variable">@agg</span>))

    <span class="hljs-keyword">End</span>

    <span class="hljs-keyword">Declare</span> cur_agg <span class="hljs-keyword">cursor</span> read_only forward_only <span class="hljs-keyword">local</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">for</span>
    <span class="hljs-keyword">Select</span> 
        opp_agg,col_agg
    <span class="hljs-keyword">from</span> <span class="hljs-variable">@column</span>_agg;

    <span class="hljs-keyword">Open</span> cur_agg;

    <span class="hljs-keyword">Fetch</span> Next <span class="hljs-keyword">From</span> cur_agg
    <span class="hljs-keyword">Into</span> <span class="hljs-variable">@opp</span>_agg,<span class="hljs-variable">@col</span>_agg;

    While @<span class="hljs-variable">@fetch</span>_status<span class="hljs-operator">=</span><span class="hljs-number">0</span>
    <span class="hljs-keyword">Begin</span>

        <span class="hljs-keyword">Declare</span> cur_col <span class="hljs-keyword">cursor</span> read_only forward_only <span class="hljs-keyword">local</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">for</span>
        <span class="hljs-keyword">Select</span> 
            pivot_col 
        <span class="hljs-keyword">From</span> #pvt_column;

        <span class="hljs-keyword">Open</span> cur_col;

        <span class="hljs-keyword">Fetch</span> Next <span class="hljs-keyword">From</span> cur_col
        <span class="hljs-keyword">Into</span> <span class="hljs-variable">@pivot</span>_col;

        While @<span class="hljs-variable">@fetch</span>_status<span class="hljs-operator">=</span><span class="hljs-number">0</span>
        <span class="hljs-keyword">Begin</span>

            <span class="hljs-keyword">Select</span> <span class="hljs-variable">@query</span>_col_pvt<span class="hljs-operator">=</span><span class="hljs-string">'isnull('</span><span class="hljs-operator">+</span><span class="hljs-variable">@opp</span>_agg<span class="hljs-operator">+</span><span class="hljs-string">'(case when '</span><span class="hljs-operator">+</span><span class="hljs-variable">@column</span><span class="hljs-operator">+</span><span class="hljs-string">'='</span><span class="hljs-operator">+</span>quotename(<span class="hljs-variable">@pivot</span>_col,<span class="hljs-type">char</span>(<span class="hljs-number">39</span>))<span class="hljs-operator">+</span><span class="hljs-string">' then '</span><span class="hljs-operator">+</span><span class="hljs-variable">@col</span>_agg<span class="hljs-operator">+</span>
            <span class="hljs-string">' else null end),0) as ['</span><span class="hljs-operator">+</span><span class="hljs-built_in">lower</span>(Replace(Replace(<span class="hljs-variable">@opp</span>_agg<span class="hljs-operator">+</span><span class="hljs-string">'_'</span><span class="hljs-operator">+</span><span class="hljs-keyword">convert</span>(<span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>),<span class="hljs-variable">@pivot</span>_col)<span class="hljs-operator">+</span><span class="hljs-string">'_'</span><span class="hljs-operator">+</span>replace(replace(<span class="hljs-variable">@col</span>_agg,<span class="hljs-string">'['</span>,<span class="hljs-string">''</span>),<span class="hljs-string">']'</span>,<span class="hljs-string">''</span>),<span class="hljs-string">' '</span>,<span class="hljs-string">''</span>),<span class="hljs-string">'&amp;'</span>,<span class="hljs-string">''</span>))<span class="hljs-operator">+</span>
                (<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> <span class="hljs-variable">@add</span>_to_col_name <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">then</span> space(<span class="hljs-number">0</span>) <span class="hljs-keyword">else</span> <span class="hljs-string">'_'</span><span class="hljs-operator">+</span>isnull(ltrim(rtrim(<span class="hljs-variable">@add</span>_to_col_name)),<span class="hljs-string">''</span>) <span class="hljs-keyword">end</span>)<span class="hljs-operator">+</span><span class="hljs-string">']'</span>
            print <span class="hljs-variable">@query</span>_col_pvt
            <span class="hljs-keyword">Select</span> <span class="hljs-variable">@full</span>_query_pivot<span class="hljs-operator">=</span><span class="hljs-variable">@full</span>_query_pivot<span class="hljs-operator">+</span><span class="hljs-variable">@query</span>_col_pvt<span class="hljs-operator">+</span><span class="hljs-string">', '</span>

            <span class="hljs-comment">--print @full_query_pivot</span>

            <span class="hljs-keyword">Fetch</span> Next <span class="hljs-keyword">From</span> cur_col
            <span class="hljs-keyword">Into</span> <span class="hljs-variable">@pivot</span>_col;        

        <span class="hljs-keyword">End</span>     

        <span class="hljs-keyword">Close</span> cur_col;
        <span class="hljs-keyword">Deallocate</span> cur_col;

        <span class="hljs-keyword">Fetch</span> Next <span class="hljs-keyword">From</span> cur_agg
        <span class="hljs-keyword">Into</span> <span class="hljs-variable">@opp</span>_agg,<span class="hljs-variable">@col</span>_agg; 
    <span class="hljs-keyword">End</span>

    <span class="hljs-keyword">Close</span> cur_agg;
    <span class="hljs-keyword">Deallocate</span> cur_agg;

    <span class="hljs-keyword">Select</span> <span class="hljs-variable">@full</span>_query_pivot<span class="hljs-operator">=</span><span class="hljs-built_in">substring</span>(<span class="hljs-variable">@full</span>_query_pivot,<span class="hljs-number">1</span>,len(<span class="hljs-variable">@full</span>_query_pivot)<span class="hljs-number">-1</span>);

    <span class="hljs-keyword">Select</span> <span class="hljs-variable">@query</span><span class="hljs-operator">=</span><span class="hljs-string">'Select '</span><span class="hljs-operator">+</span><span class="hljs-variable">@sel</span>_cols<span class="hljs-operator">+</span><span class="hljs-string">','</span><span class="hljs-operator">+</span><span class="hljs-variable">@full</span>_query_pivot<span class="hljs-operator">+</span><span class="hljs-string">' into '</span><span class="hljs-operator">+</span><span class="hljs-variable">@new</span>_table<span class="hljs-operator">+</span><span class="hljs-string">' From '</span><span class="hljs-operator">+</span>(<span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> <span class="hljs-variable">@ind</span>_tmpTbl<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">then</span> <span class="hljs-string">'tempdb.'</span> <span class="hljs-keyword">else</span> <span class="hljs-string">''</span> <span class="hljs-keyword">end</span>)<span class="hljs-operator">+</span>
    <span class="hljs-variable">@schema</span><span class="hljs-operator">+</span><span class="hljs-string">'.'</span><span class="hljs-operator">+</span><span class="hljs-variable">@table</span><span class="hljs-operator">+</span><span class="hljs-string">' Group by '</span><span class="hljs-operator">+</span><span class="hljs-variable">@sel</span>_cols<span class="hljs-operator">+</span><span class="hljs-string">';'</span>;

    print <span class="hljs-variable">@query</span>;
    <span class="hljs-keyword">Exec</span> (<span class="hljs-variable">@query</span>);

<span class="hljs-keyword">End</span>;
GO
</code></pre>

<p>This is an example of execution:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">Exec</span> dbo.rs_pivot_table <span class="hljs-variable">@schema</span><span class="hljs-operator">=</span>dbo,<span class="hljs-variable">@table</span><span class="hljs-operator">=</span>##TEMPORAL1,<span class="hljs-variable">@column</span><span class="hljs-operator">=</span>tip_liq,<span class="hljs-variable">@agg</span><span class="hljs-operator">=</span><span class="hljs-string">'sum([val_liq]),avg([can_liq]),'</span>,<span class="hljs-variable">@sel</span>_cols<span class="hljs-operator">=</span><span class="hljs-string">'cod_emp,cod_con,tip_liq'</span>,<span class="hljs-variable">@new</span>_table<span class="hljs-operator">=</span>##TEMPORAL1PVT;
</code></pre>

<p>then <code>Select * From ##TEMPORAL1PVT</code> would return:</p>

<p><a href="https://i.stack.imgur.com/pGHCK.png" rel="noreferrer"><img src="https://i.stack.imgur.com/pGHCK.png" alt="enter image description here"></a></p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Here is a revision of @Tayrn answer above that might help you understand pivoting a little easier: </p>

<p>This may not be the best way to do this, but this is what helped me wrap my head around how to pivot tables.</p>

<p>ID = rows you want to pivot</p>

<p>MY_KEY = the column you are selecting from your original table that contains the column names you want to pivot.</p>

<p>VAL = the value you want returning under each column.</p>

<p>MAX(VAL) =&gt; Can be replaced with other aggregiate functions. SUM(VAL), MIN(VAL), ETC...</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@cols</span> <span class="hljs-keyword">AS</span> NVARCHAR(MAX),
<span class="hljs-variable">@query</span>  <span class="hljs-keyword">AS</span> NVARCHAR(MAX)
<span class="hljs-keyword">select</span> <span class="hljs-variable">@cols</span> <span class="hljs-operator">=</span> STUFF((<span class="hljs-keyword">SELECT</span> <span class="hljs-string">','</span> <span class="hljs-operator">+</span> QUOTENAME(MY_KEY) 
                <span class="hljs-keyword">from</span> yt
                <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> MY_KEY
                <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> MY_KEY <span class="hljs-keyword">ASC</span>
        <span class="hljs-keyword">FOR</span> XML PATH(<span class="hljs-string">''</span>), TYPE
        ).<span class="hljs-keyword">value</span>(<span class="hljs-string">'.'</span>, <span class="hljs-string">'NVARCHAR(MAX)'</span>) 
    ,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-string">''</span>)
<span class="hljs-keyword">set</span> <span class="hljs-variable">@query</span> <span class="hljs-operator">=</span> <span class="hljs-string">'SELECT ID,'</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@cols</span> <span class="hljs-operator">+</span> <span class="hljs-string">' from 
         (
            select ID, MY_KEY, VAL 
            from yt
        ) x
        pivot 
        (
            sum(VAL)
            for MY_KEY in ('</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@cols</span> <span class="hljs-operator">+</span> <span class="hljs-string">')
        ) p '</span>

        <span class="hljs-keyword">execute</span>(<span class="hljs-variable">@query</span>);
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 7</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> name, ID <span class="hljs-keyword">from</span> Empoyee) Visits
    pivot(<span class="hljs-built_in">sum</span>(ID) <span class="hljs-keyword">for</span> name
    <span class="hljs-keyword">in</span> ([Emp1],
    [Emp2],
    [Emp3]
    ) ) <span class="hljs-keyword">as</span> pivottable;
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 8</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Just give you some idea how other databases solve this problem. <code>DolphinDB</code> also has built-in support for pivoting and the sql looks much more intuitive and neat. It is as simple as specifying the key column (<code>Store</code>), pivoting column (<code>Week</code>), and the calculated metric (<code>sum(xCount)</code>).</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-keyword">prepare</span> a <span class="hljs-number">10</span><span class="hljs-operator">-</span>million<span class="hljs-operator">-</span><span class="hljs-type">row</span> <span class="hljs-keyword">table</span>
n<span class="hljs-operator">=</span><span class="hljs-number">10000000</span>
t<span class="hljs-operator">=</span><span class="hljs-keyword">table</span>(rand(<span class="hljs-number">100</span>, n) <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> Store, rand(<span class="hljs-number">54</span>, n) <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> Week, rand(<span class="hljs-number">100</span>, n) <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> xCount)

<span class="hljs-operator">/</span><span class="hljs-operator">/</span>use pivot clause <span class="hljs-keyword">to</span> generate a pivoted <span class="hljs-keyword">table</span> pivot_t
pivot_t <span class="hljs-operator">=</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">sum</span>(xCount) <span class="hljs-keyword">from</span> t pivot <span class="hljs-keyword">by</span> Store, Week
</code></pre>

<p>DolphinDB is a columnar high performance database. The calculation in the demo costs as low as 546 ms on a dell xps laptop (i7 cpu).  To get more details, please refer to online DolphinDB manual <a href="https://www.dolphindb.com/help/index.html?pivotby.html" rel="nofollow noreferrer">https://www.dolphindb.com/help/index.html?pivotby.html</a></p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 9</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Pivot is one of the SQL operator which is used to turn the unique data from one column into multiple column in the output. This is also mean by transforming the rows into columns (rotating table). Let us consider this table,</p>
<p><a href="https://i.stack.imgur.com/iEOQ0.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/iEOQ0.png" alt="enter image description here"></a></p>
<p>If I want to filter this data based on the types of product (Speaker, Glass, Headset) by each customer, then use Pivot operator.</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">Select</span> CustmerName, Speaker, Glass, Headset  
<span class="hljs-keyword">from</span> TblCustomer  
   Pivot  
    (  
     <span class="hljs-built_in">Sum</span>(Price) <span class="hljs-keyword">for</span> Product <span class="hljs-keyword">in</span> ([Speaker],[Glass],[Headset])  
    ) <span class="hljs-keyword">as</span> PivotTable 
</code></pre>
<p><a href="https://i.stack.imgur.com/Y1kSv.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/Y1kSv.png" alt="enter image description here"></a></p>
    </div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;If you are using SQL Server 2005+, then you can use the \u0026lt;code\u0026gt;PIVOT\u0026lt;/code\u0026gt; function to transform the data from rows into columns.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;It sounds like you will need to use dynamic sql if the weeks are unknown but it is easier to see the correct code using a hard-coded version initially.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;First up, here are some quick table definitions and data for use:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TABLE\u0026lt;/span\u0026gt; yt \n(\n  [Store] \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;, \n  [Week] \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;, \n  [xCount] \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;\n);\n    \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INTO\u0026lt;/span\u0026gt; yt\n(\n  [Store], \n  [Week], [xCount]\n)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;VALUES\u0026lt;/span\u0026gt;\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;96\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;138\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;37\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;59\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;282\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;212\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;78\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;97\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;60\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;123\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;220\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;87\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;If your values are known, then you will hard-code the query:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \n(\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; store, week, xCount\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; yt \n) src\npivot\n(\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;sum\u0026lt;/span\u0026gt;(xcount)\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; week \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; ([\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;], [\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;], [\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;])\n) piv;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;See \u0026lt;a href=\u0026quot;https://data.stackexchange.com/stackoverflow/query/580181\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;SQL Demo\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Then if you need to generate the week number dynamically, your code will be:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; NVARCHAR(MAX),\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; NVARCHAR(MAX)\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; STUFF((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; QUOTENAME(Week) \n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; yt\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;group\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; Week\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;order\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; Week\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;), TYPE\n            ).\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;.\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;NVARCHAR(MAX)\u0026apos;\u0026lt;/span\u0026gt;) \n        ,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT store,\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; from \n             (\n                select store, week, xCount\n                from yt\n            ) x\n            pivot \n            (\n                sum(xCount)\n                for week in (\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)\n            ) p \u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;execute\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;See \u0026lt;a href=\u0026quot;https://data.stackexchange.com/stackoverflow/query/580183\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;SQL Demo\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The dynamic version, generates the list of \u0026lt;code\u0026gt;week\u0026lt;/code\u0026gt; numbers that should be converted to columns. Both give the same result:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt; STORE \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;---------------------------\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;138\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;282\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;220\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;96\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;212\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;123\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;37\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;78\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;60\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;   \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;59\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;97\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;87\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;This is for dynamic # of weeks.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Full example here:\u0026lt;a href=\u0026quot;http://sqlhints.com/2014/03/18/dynamic-pivot-in-sql-server/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;SQL Dynamic Pivot\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@DynamicPivotQuery\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; NVARCHAR(MAX)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ColumnName\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; NVARCHAR(MAX)\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--Get distinct values of the PIVOT Column \u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ColumnName\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; ISNULL(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ColumnName\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; QUOTENAME(Week)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DISTINCT\u0026lt;/span\u0026gt; Week \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; #StoreSales) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; Weeks\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--Prepare the PIVOT query using the dynamic \u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SET\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@DynamicPivotQuery\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \n  N\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT Store, \u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ColumnName\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \n    FROM #StoreSales\n    PIVOT(SUM(xCount) \n          FOR Week IN (\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ColumnName\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)) AS PVTTable\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--Execute the Dynamic Pivot Query\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;EXEC\u0026lt;/span\u0026gt; sp_executesql \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@DynamicPivotQuery\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I\u0026apos;ve achieved the same thing before by using subqueries.  So if your original table was called StoreCountsByWeek, and you had a separate table that listed the Store IDs, then it would look like this:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; StoreID, \n    Week1\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; ISNULL(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUM\u0026lt;/span\u0026gt;(xCount),\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; StoreCountsByWeek \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; StoreCountsByWeek.StoreID\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;Store.StoreID \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AND\u0026lt;/span\u0026gt; Week\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;),\n    Week2\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; ISNULL(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUM\u0026lt;/span\u0026gt;(xCount),\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; StoreCountsByWeek \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; StoreCountsByWeek.StoreID\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;Store.StoreID \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AND\u0026lt;/span\u0026gt; Week\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;),\n    Week3\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; ISNULL(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUM\u0026lt;/span\u0026gt;(xCount),\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; StoreCountsByWeek \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; StoreCountsByWeek.StoreID\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;Store.StoreID \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AND\u0026lt;/span\u0026gt; Week\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Store\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ORDER\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; StoreID\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;One advantage to this method is that the syntax is more clear and it makes it easier to join to other tables to pull other fields into the results too.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;My anecdotal results are that running this query over a couple of thousand rows completed in less than one second, and I actually had 7 subqueries.  But as noted in the comments, it is more computationally expensive to do it this way, so be careful about using this method if you expect it to run on large amounts of data .\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;This is what you can do:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; yourTable\nPIVOT (\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;MAX\u0026lt;/span\u0026gt;(xCount) \n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; Week \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; ([\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;],[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;],[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;],[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;],[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;],[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;6\u0026lt;/span\u0026gt;],[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;7\u0026lt;/span\u0026gt;])) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; pvt\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://www.sqlfiddle.com/#!3/16fd1/1\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;DEMO\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I\u0026apos;m writing an sp that could be useful for this purpose, basically this sp pivot any table and return a new table pivoted or return just the set of data, this is the way to execute it:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Exec\u0026lt;/span\u0026gt; dbo.rs_pivot_table \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@schema\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;dbo,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;table_name,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;column_to_pivot,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;sum([column_to_agg]),avg([another_column_to_agg]),\u0026apos;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sel\u0026lt;/span\u0026gt;_cols\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;column_to_select1,column_to_select2,column_to_select1\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;returned_table_pivoted;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;please note\u0026lt;/strong\u0026gt; that in the parameter @agg the column names must be with \u0026lt;code\u0026gt;\u0026apos;[\u0026apos;\u0026lt;/code\u0026gt; and the parameter must end with a comma \u0026lt;code\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;SP\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Create\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Procedure\u0026lt;/span\u0026gt; [dbo].[rs_pivot_table]\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@schema\u0026lt;/span\u0026gt; sysname\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;dbo,\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt; sysname,\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt; sysname,\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt; nvarchar(max),\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sel\u0026lt;/span\u0026gt;_cols \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(max),\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table sysname,\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@add\u0026lt;/span\u0026gt;_to_col_name sysname\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;As\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--Exec dbo.rs_pivot_table dbo,##TEMPORAL1,tip_liq,\u0026apos;sum([val_liq]),sum([can_liq]),\u0026apos;,\u0026apos;cod_emp,cod_con,tip_liq\u0026apos;,##TEMPORAL1PVT,\u0026apos;hola\u0026apos;;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Begin\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(max)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@opp\u0026lt;/span\u0026gt;_agg \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@col\u0026lt;/span\u0026gt;_agg \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@pivot\u0026lt;/span\u0026gt;_col sysname;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;_col_pvt \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(max)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(max)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ind\u0026lt;/span\u0026gt;_tmpTbl \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--Indicador de tabla temporal 1=tabla temporal global 0=Tabla fisica\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Create\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Table\u0026lt;/span\u0026gt; #pvt_column(\n        pivot_col \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;)\n    );\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;_agg \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt;(\n        opp_agg \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;),\n        col_agg \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;)\n    );\n\n    IF  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;EXISTS\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; sys.objects \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; object_id \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; OBJECT_ID(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AND\u0026lt;/span\u0026gt; type \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; (N\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;U\u0026apos;\u0026lt;/span\u0026gt;))\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ind\u0026lt;/span\u0026gt;_tmpTbl\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ELSE\u0026lt;/span\u0026gt; IF OBJECT_ID(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;tempdb..\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;ltrim(rtrim(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt;))) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;IS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NOT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NULL\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ind\u0026lt;/span\u0026gt;_tmpTbl\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;;\n\n    IF  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;EXISTS\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; sys.objects \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; object_id \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; OBJECT_ID(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AND\u0026lt;/span\u0026gt; type \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; (N\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;U\u0026apos;\u0026lt;/span\u0026gt;)) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;OR\u0026lt;/span\u0026gt; \n        OBJECT_ID(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;tempdb..\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;ltrim(rtrim(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table))) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;IS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NOT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NULL\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Begin\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;DROP TABLE \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Exec\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;End\u0026lt;/span\u0026gt;;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Select distinct \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; From \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;when\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ind\u0026lt;/span\u0026gt;_tmpTbl\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;tempdb.\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;end\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@schema\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;.\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; where \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; is not null;\u0026apos;\u0026lt;/span\u0026gt;;\n    Print \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Insert\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;into\u0026lt;/span\u0026gt; #pvt_column(pivot_col)\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Exec\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;)\n\n    While charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Begin\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Substring\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt;);\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Insert\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Into\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;_agg(opp_agg,col_agg)\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Values\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;substring\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;(\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt;),ltrim(rtrim(replace(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;substring\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt;,charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;[\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;),charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;]\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@aggDet\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-4\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;))));\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Substring\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;,charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,len(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;))\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;End\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; cur_agg \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;cursor\u0026lt;/span\u0026gt; read_only forward_only \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;local\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \n        opp_agg,col_agg\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;_agg;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Open\u0026lt;/span\u0026gt; cur_agg;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Fetch\u0026lt;/span\u0026gt; Next \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;From\u0026lt;/span\u0026gt; cur_agg\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Into\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@opp\u0026lt;/span\u0026gt;_agg,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@col\u0026lt;/span\u0026gt;_agg;\n\n    While @\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@fetch\u0026lt;/span\u0026gt;_status\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Begin\u0026lt;/span\u0026gt;\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Declare\u0026lt;/span\u0026gt; cur_col \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;cursor\u0026lt;/span\u0026gt; read_only forward_only \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;local\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \n            pivot_col \n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;From\u0026lt;/span\u0026gt; #pvt_column;\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Open\u0026lt;/span\u0026gt; cur_col;\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Fetch\u0026lt;/span\u0026gt; Next \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;From\u0026lt;/span\u0026gt; cur_col\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Into\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@pivot\u0026lt;/span\u0026gt;_col;\n\n        While @\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@fetch\u0026lt;/span\u0026gt;_status\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Begin\u0026lt;/span\u0026gt;\n\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;_col_pvt\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;isnull(\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@opp\u0026lt;/span\u0026gt;_agg\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;(case when \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;=\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;quotename(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@pivot\u0026lt;/span\u0026gt;_col,\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;char\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;39\u0026lt;/span\u0026gt;))\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; then \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@col\u0026lt;/span\u0026gt;_agg\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; else null end),0) as [\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;lower\u0026lt;/span\u0026gt;(Replace(Replace(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@opp\u0026lt;/span\u0026gt;_agg\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;_\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;convert\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@pivot\u0026lt;/span\u0026gt;_col)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;_\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;replace(replace(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@col\u0026lt;/span\u0026gt;_agg,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;[\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;]\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; \u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026amp;amp;\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;))\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\n                (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;when\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@add\u0026lt;/span\u0026gt;_to_col_name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;is\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; space(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;_\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;isnull(ltrim(rtrim(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@add\u0026lt;/span\u0026gt;_to_col_name)),\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;end\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;]\u0026apos;\u0026lt;/span\u0026gt;\n            print \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;_col_pvt\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;_col_pvt\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;, \u0026apos;\u0026lt;/span\u0026gt;\n\n            \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--print @full_query_pivot\u0026lt;/span\u0026gt;\n\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Fetch\u0026lt;/span\u0026gt; Next \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;From\u0026lt;/span\u0026gt; cur_col\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Into\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@pivot\u0026lt;/span\u0026gt;_col;        \n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;End\u0026lt;/span\u0026gt;     \n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Close\u0026lt;/span\u0026gt; cur_col;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Deallocate\u0026lt;/span\u0026gt; cur_col;\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Fetch\u0026lt;/span\u0026gt; Next \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;From\u0026lt;/span\u0026gt; cur_agg\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Into\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@opp\u0026lt;/span\u0026gt;_agg,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@col\u0026lt;/span\u0026gt;_agg; \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;End\u0026lt;/span\u0026gt;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Close\u0026lt;/span\u0026gt; cur_agg;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Deallocate\u0026lt;/span\u0026gt; cur_agg;\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;substring\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,len(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot)\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt;);\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;Select \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sel\u0026lt;/span\u0026gt;_cols\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@full\u0026lt;/span\u0026gt;_query_pivot\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; into \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; From \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;when\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@ind\u0026lt;/span\u0026gt;_tmpTbl\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;tempdb.\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;end\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@schema\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;.\u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; Group by \u0026apos;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sel\u0026lt;/span\u0026gt;_cols\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;;\u0026apos;\u0026lt;/span\u0026gt;;\n\n    print \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Exec\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;End\u0026lt;/span\u0026gt;;\nGO\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;This is an example of execution:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Exec\u0026lt;/span\u0026gt; dbo.rs_pivot_table \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@schema\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;dbo,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@table\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;##TEMPORAL1,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@column\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;tip_liq,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@agg\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;sum([val_liq]),avg([can_liq]),\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sel\u0026lt;/span\u0026gt;_cols\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;cod_emp,cod_con,tip_liq\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@new\u0026lt;/span\u0026gt;_table\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;##TEMPORAL1PVT;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;then \u0026lt;code\u0026gt;Select * From ##TEMPORAL1PVT\u0026lt;/code\u0026gt; would return:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://i.stack.imgur.com/pGHCK.png\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;https://i.stack.imgur.com/pGHCK.png\u0026quot; alt=\u0026quot;enter image description here\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Here is a revision of @Tayrn answer above that might help you understand pivoting a little easier: \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This may not be the best way to do this, but this is what helped me wrap my head around how to pivot tables.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;ID = rows you want to pivot\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;MY_KEY = the column you are selecting from your original table that contains the column names you want to pivot.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;VAL = the value you want returning under each column.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;MAX(VAL) =\u0026amp;gt; Can be replaced with other aggregiate functions. SUM(VAL), MIN(VAL), ETC...\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; NVARCHAR(MAX),\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; NVARCHAR(MAX)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; STUFF((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; QUOTENAME(MY_KEY) \n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; yt\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;group\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; MY_KEY\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;order\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; MY_KEY \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ASC\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FOR\u0026lt;/span\u0026gt; XML PATH(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;), TYPE\n        ).\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;.\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;NVARCHAR(MAX)\u0026apos;\u0026lt;/span\u0026gt;) \n    ,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;SELECT ID,\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos; from \n         (\n            select ID, MY_KEY, VAL \n            from yt\n        ) x\n        pivot \n        (\n            sum(VAL)\n            for MY_KEY in (\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@cols\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;)\n        ) p \u0026apos;\u0026lt;/span\u0026gt;\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;execute\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@query\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; name, ID \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; Empoyee) Visits\n    pivot(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;sum\u0026lt;/span\u0026gt;(ID) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; name\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; ([Emp1],\n    [Emp2],\n    [Emp3]\n    ) ) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; pivottable;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Just give you some idea how other databases solve this problem. \u0026lt;code\u0026gt;DolphinDB\u0026lt;/code\u0026gt; also has built-in support for pivoting and the sql looks much more intuitive and neat. It is as simple as specifying the key column (\u0026lt;code\u0026gt;Store\u0026lt;/code\u0026gt;), pivoting column (\u0026lt;code\u0026gt;Week\u0026lt;/code\u0026gt;), and the calculated metric (\u0026lt;code\u0026gt;sum(xCount)\u0026lt;/code\u0026gt;).\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;prepare\u0026lt;/span\u0026gt; a \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt;million\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;row\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt;\nn\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10000000\u0026lt;/span\u0026gt;\nt\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt;(rand(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;, n) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; Store, rand(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;54\u0026lt;/span\u0026gt;, n) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; Week, rand(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100\u0026lt;/span\u0026gt;, n) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; xCount)\n\n\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;use pivot clause \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;to\u0026lt;/span\u0026gt; generate a pivoted \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt; pivot_t\npivot_t \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;sum\u0026lt;/span\u0026gt;(xCount) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; t pivot \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; Store, Week\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;DolphinDB is a columnar high performance database. The calculation in the demo costs as low as 546 ms on a dell xps laptop (i7 cpu).  To get more details, please refer to online DolphinDB manual \u0026lt;a href=\u0026quot;https://www.dolphindb.com/help/index.html?pivotby.html\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;https://www.dolphindb.com/help/index.html?pivotby.html\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Pivot is one of the SQL operator which is used to turn the unique data from one column into multiple column in the output. This is also mean by transforming the rows into columns (rotating table). Let us consider this table,\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://i.stack.imgur.com/iEOQ0.png\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;https://i.stack.imgur.com/iEOQ0.png\u0026quot; alt=\u0026quot;enter image description here\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;If I want to filter this data based on the types of product (Speaker, Glass, Headset) by each customer, then use Pivot operator.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Select\u0026lt;/span\u0026gt; CustmerName, Speaker, Glass, Headset  \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; TblCustomer  \n   Pivot  \n    (  \n     \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Sum\u0026lt;/span\u0026gt;(Price) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; Product \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; ([Speaker],[Glass],[Headset])  \n    ) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; PivotTable \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://i.stack.imgur.com/Y1kSv.png\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;\u0026lt;img src=\u0026quot;https://i.stack.imgur.com/Y1kSv.png\u0026quot; alt=\u0026quot;enter image description here\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    "],"comment":["\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;possible duplicate of \u0026lt;a href=\u0026quot;http://stackoverflow.com/questions/10404348/sql-server-dynamic-pivot-query\u0026quot;\u0026gt;SQL Server dynamic PIVOT query?\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/573261/richardthekiwi\u0026quot; title=\u0026quot;103,144 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;RichardTheKiwi\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment23432215_15931607\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-05-03 09:46:29Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;May 3, 2013 at 9:46\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Possible duplicate? That one is a possible duplicate. Look at the dates!\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2267015/lynn\u0026quot; title=\u0026quot;3,372 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;Lynn\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment128281550_15931607\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2022-06-14 18:03:47Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jun 14 at 18:03\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Very nice! But how to eliminate column when all values of that column are NULL?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/772930/zooz\u0026quot; title=\u0026quot;835 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;ZooZ\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment44428744_15931734\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-01-19 09:22:10Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 19, 2015 at 9:22\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@ZooZ See \u0026lt;a href=\u0026quot;http://stackoverflow.com/a/27532568/1028230\u0026quot;\u0026gt;answer below\u0026lt;/a\u0026gt;. Haven\u0026apos;t tried it out verbatim, but the concept is sound.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1028230/ruffin\u0026quot; title=\u0026quot;15,125 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;ruffin\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment49832270_15931734\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-06-17 15:58:00Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jun 17, 2015 at 15:58\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;+1 \u0026quot;It sounds like you will need to use dynamic sql if the weeks are unknown but it is easier to see the correct code using a hard-cded version initially.\u0026quot; Unlike the Qlikview Generic function (\u0026lt;a href=\u0026quot;https://community.qlik.com/blogs/qlikviewdesignblog/2014/03/31/generic\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;community.qlik.com/blogs/qlikviewdesignblog/2014/03/31/generic\u0026lt;/a\u0026gt;) which allows doesn\u0026apos;t require that you explicitly name the different \u0026quot;FOR ____ IN (...)\u0026quot;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1175496/the-red-pea\u0026quot; title=\u0026quot;15,133 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;The Red Pea\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment51901781_15931734\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-08-13 22:03:16Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 13, 2015 at 22:03\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;If you are building a pivot table with a cte earlier.\u0026lt;code\u0026gt;cte3 AS (select ... )\u0026lt;/code\u0026gt; then you have the defined above logic with the \u0026lt;code\u0026gt;@cols\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;@query\u0026lt;/code\u0026gt; ... there is an error.` Invalid object name \u0026apos;cte3\u0026apos;.` how do you fix that. \u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/4385932/elizabeth\u0026quot; title=\u0026quot;697 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Elizabeth\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment59136977_15931734\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-03-01 18:59:12Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Mar 1, 2016 at 18:59\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;This is fantastic - nice one @bluefeet. I\u0026apos;d never used \u0026lt;code\u0026gt;STUFF(...)\u0026lt;/code\u0026gt; before (or the \u0026lt;code\u0026gt;XML PATH\u0026lt;/code\u0026gt; either). For the benefit of other readers, all that is doing is joining the column names and chopping off the leading comma.  Note I think the following is slightly simpler:      select @cols =(SELECT DISTINCT QUOTENAME(Week) + \u0026apos;,\u0026apos;                          from yt                         order by 1                 FOR XML PATH(\u0026apos;\u0026apos;))     \t\t     set @cols = SUBSTRING(@cols, 1, LEN(@cols) - 1)  ... replacing the \u0026lt;code\u0026gt;group by\u0026lt;/code\u0026gt; by \u0026lt;code\u0026gt;distinct\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;order by 1\u0026lt;/code\u0026gt; and manually chopping a \u0026lt;i\u0026gt;suffixed\u0026lt;/i\u0026gt; comma!\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1703636/darthpablo\u0026quot; title=\u0026quot;156 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;DarthPablo\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment63176299_15931734\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-06-16 12:42:28Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jun 16, 2016 at 12:42\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 2 times\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Hey I have a fiddle where I need to pivot tables dynamically do you think you can help me with that ? \u0026lt;a href=\u0026quot;https://dbfiddle.uk/?rdbms=postgres_9.6\u0026amp;amp;fiddle=de78ff10420c713d4ac4a444f9d5e69a\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;dbfiddle.uk/\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/4405364/silly-volley\u0026quot; title=\u0026quot;423 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Silly Volley\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment103027976_27532568\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2019-10-11 06:49:11Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 11, 2019 at 6:49\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@SillyVolley here is one, you didn\u0026apos;t specify what you wanted to pivot on. Also I don\u0026apos;t know if you can do this in Postgres so I did it in SQL Server: \u0026lt;a href=\u0026quot;https://dbfiddle.uk/?rdbms=sqlserver_2012\u0026amp;amp;fiddle=911ca0e83d8311b70c049b5036b866a6\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;dbfiddle.uk/\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1452739/enkode\u0026quot; title=\u0026quot;4,174 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Enkode\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment103030449_27532568\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2019-10-11 08:24:56Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 11, 2019 at 8:24\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;it is easier, but it is a very expensive operation, those subqueries have to be executed once for each row returned from the table.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/4475952/greg\u0026quot; title=\u0026quot;3,567 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Greg\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment63852305_35185750\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-07-05 23:30:41Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 5, 2016 at 23:30\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        "],"id":543,"title":"Convert Rows to columns using 'Pivot' in SQL Server","content":"\n                \n\u0026lt;p\u0026gt;I have read the stuff on MS pivot tables and I am still having problems getting this correct.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I have a temp table that is being created, we will say that column 1 is a Store number, and column 2 is a week number and lastly column 3 is a total of some type. Also the Week numbers are dynamic, the store numbers are static.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;Store      Week     xCount\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-------    ----     ------\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;96\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;138\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;37\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;59\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;282\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;212\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;78\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;97\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;60\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;123\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;220\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;87\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;I would like it to come out as a pivot table, like this:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;Store        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;          \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;          \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;6.\u0026lt;/span\u0026gt;...\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;----- \u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;101\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;138\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;282\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;220\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;102\u0026lt;/span\u0026gt;         \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;96\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;212\u0026lt;/span\u0026gt;        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;123\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;105\u0026lt;/span\u0026gt;         \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;37\u0026lt;/span\u0026gt;        \n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;109\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Store numbers down the side and weeks across the top.\u0026lt;/p\u0026gt;\n    ","slug":"convert-rows-to-columns-using-'pivot'-in-sql-server-1657388372528","postType":"QUESTION","createdAt":"2022-07-09T17:39:32.000Z","updatedAt":"2022-07-09T17:39:32.000Z","tags":[{"id":2653,"name":"pivot-table","slug":"pivot-table","createdAt":"2022-07-09T17:39:32.000Z","updatedAt":"2022-07-09T17:39:32.000Z","Questions_Tags":{"questionId":543,"tagId":2653}}]}},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"convert-rows-to-columns-using-'pivot'-in-sql-server-1657388372528"},"buildId":"4Y8KGE-c2lolBeBmcum_I","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>