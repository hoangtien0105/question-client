<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2eccd4d47c856f2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2eccd4d47c856f2b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-20edbe0b078add93.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/613-1e0aa2b2023820bb.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/471-84c36aa98dd4107c.js" defer=""></script><script src="/_next/static/chunks/81-096e453de8a27667.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-e3d1b60e109d3ba1.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_buildManifest.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">.hFcsiD code{padding:5px;color:hsl(210deg 8% 15%);background-color:hsl(210deg 8% 90%);border-radius:3px;}/*!sc*/
data-styled.g5[id="sc-6e32c308-0"]{content:"hFcsiD,"}/*!sc*/
.ljvTUN .comment-item .comment-body .d-inline-flex.ai-center{text-align:right;}/*!sc*/
.ljvTUN .comment-item .comment-body .comment-date{float:right;}/*!sc*/
data-styled.g6[id="sc-6e32c308-1"]{content:"ljvTUN,"}/*!sc*/
</style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="https://flowbite.com/docs/images/logo.svg" class="mr-3 h-6 sm:h-9" alt="Flowbite Logo"/><span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Hunter</span></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/why-does-the-order-in-which-libraries-are-linked-sometimes-cause-errors-in-gcc-1657387609554#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="sc-6e32c308-0 hFcsiD flex question-header items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/why-does-the-order-in-which-libraries-are-linked-sometimes-cause-errors-in-gcc-1657387609554">Why does the order in which libraries are linked sometimes cause errors in GCC?</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/linker">linker</a></div></div><div class="question-content mt-5">
                
<p>Why does the order in which libraries are linked sometimes cause errors in GCC?</p>
    </div></div></div><div class="sc-6e32c308-1 ljvTUN flex text-xs pl-10 flex-col comment items-center justify-center"><h4 class="text-left mt-10 text-lg font-semibold">Comments</h4><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">See also now <a href="http://stackoverflow.com/questions/7826448/linking-libraries-with-gcc-order-of-arguments" title="linking libraries with gcc order of arguments">stackoverflow.com/questions/7826448/</a> -- TLDR <code>gcc</code> changed to more-strict behavior (relatively) recently.</span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/874188/tripleee" title="159,777 reputation" class="comment-user">tripleee</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment43959406_45135"><span title="2015-01-05 06:17:19Z, License: CC BY-SA 3.0" class="relativetime-clean">Jan 5, 2015 at 6:17</span></a></span>
            </div>
        </div><span class="divide-x-8 "></span><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">Repeat until all symbols resolved, eh - you'd think they could manage a topological sort. LLVM has 78 static libraries on it's own, with who-knows-what dependencies. True it also has a script to figure out compile/link options - but you can't use that in all circumstances.</span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<span class="comment-user">user180247</span>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment3325557_409470"><span title="2010-07-11 13:27:46Z, License: CC BY-SA 2.5" class="relativetime-clean">Jul 11, 2010 at 13:27</span></a></span>
            </div>
        </div><span class="divide-x-8 "></span><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">@Steve that's what the programs <code>lorder</code> + <code>tsort</code> do. But sometimes there is no order, if you have cyclic references. Then you just have to cycle through the libraries list until everything is resolved.</span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/34509/johannes-schaub-litb" title="482,727 reputation" class="comment-user">Johannes Schaub - litb</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment8520879_409470"><span title="2011-08-18 19:01:27Z, License: CC BY-SA 3.0" class="relativetime-clean">Aug 18, 2011 at 19:01</span></a></span>
                        <span title="this comment was edited 1 time">
                            <svg aria-hidden="true" class="va-text-bottom o50 svg-icon iconPencilSm" width="14" height="14" viewBox="0 0 14 14"><path d="m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z"></path></svg>
                        </span>
            </div>
        </div><span class="divide-x-8 "></span><button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">See more</button></div><div class="sc-6e32c308-2 bFXWFO"><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><sub>(See the history on this answer to get the more elaborate text, but I now think it's easier for the reader to see real command lines).</sub></p>
<hr>
<p>Common files shared by all below commands</p>
<pre class="lang-c s-code-block"><code class="hljs language-c">$ cat a.cpp
<span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> a;
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {
  <span class="hljs-keyword">return</span> a;
}

$ cat b.cpp
<span class="hljs-keyword">extern</span> <span class="hljs-type">int</span> b;
<span class="hljs-type">int</span> a = b;

$ cat d.cpp
<span class="hljs-type">int</span> b;
</code></pre>
<h1>Linking to static libraries</h1>
<pre class="lang-c s-code-block"><code class="hljs language-c">$ g++ -c b.cpp -o b.o
$ ar cr libb.a b.o
$ g++ -c d.cpp -o d.o
$ ar cr libd.a d.o

$ g++ -L. -ld -lb a.cpp <span class="hljs-meta"># wrong order</span>
$ g++ -L. -lb -ld a.cpp <span class="hljs-meta"># wrong order</span>
$ g++ a.cpp -L. -ld -lb <span class="hljs-meta"># wrong order</span>
$ g++ a.cpp -L. -lb -ld <span class="hljs-meta"># right order</span>
</code></pre>
<p>The linker searches from left to right, and notes unresolved symbols as it goes. If a library resolves the symbol, it takes the object files of that library to resolve the symbol (b.o out of libb.a in this case).</p>
<p>Dependencies of static libraries against each other work the same - the library that needs symbols must be first, then the library that resolves the symbol.</p>
<p>If a static library depends on another library, but the other library again depends on the former library, there is a cycle. You can resolve this by enclosing the cyclically dependent libraries by <code>-(</code> and <code>-)</code>, such as <code>-( -la -lb -)</code> (you may need to escape the parens, such as <code>-\(</code> and <code>-\)</code>). The linker then searches those enclosed lib multiple times to ensure cycling dependencies are resolved. Alternatively, you can specify the libraries multiple times, so each is before one another: <code>-la -lb -la</code>.</p>
<h1>Linking to dynamic libraries</h1>
<pre class="lang-c s-code-block"><code class="hljs language-c">$ export LD_LIBRARY_PATH=. <span class="hljs-meta"># not needed <span class="hljs-keyword">if</span> libs go to /usr/lib etc</span>
$ g++ -fpic -shared d.cpp -o libd.so
$ g++ -fpic -shared b.cpp -L. -ld -o libb.so <span class="hljs-meta"># specifies its dependency!</span>

$ g++ -L. -lb a.cpp <span class="hljs-meta"># wrong order (works on some distributions)</span>
$ g++ -Wl,--as-needed -L. -lb a.cpp <span class="hljs-meta"># wrong order</span>
$ g++ -Wl,--as-needed a.cpp -L. -lb <span class="hljs-meta"># right order</span>
</code></pre>
<p>It's the same here - the libraries must follow the object files of the program. The difference here compared with static libraries is that you need not care about the dependencies of the libraries against each other, because <em>dynamic libraries sort out their dependencies themselves</em>.</p>
<p>Some recent distributions apparently default to using the <code>--as-needed</code> linker flag, which enforces that the program's object files come before the dynamic libraries. If that flag is passed, the linker will not link to libraries that are not actually needed by the executable (and it detects this from left to right). My recent archlinux distribution doesn't use this flag by default, so it didn't give an error for not following the correct order.</p>
<p>It is not correct to omit the dependency of <code>b.so</code> against <code>d.so</code> when creating the former. You will be required to specify the library when linking <code>a</code> then, but <code>a</code> doesn't really need the integer <code>b</code> itself, so it should not be made to care about <code>b</code>'s own dependencies.</p>
<p>Here is an example of the implications if you miss specifying the dependencies for <code>libb.so</code></p>
<pre class="lang-c s-code-block"><code class="hljs language-c">$ export LD_LIBRARY_PATH=. <span class="hljs-meta"># not needed <span class="hljs-keyword">if</span> libs go to /usr/lib etc</span>
$ g++ -fpic -shared d.cpp -o libd.so
$ g++ -fpic -shared b.cpp -o libb.so <span class="hljs-meta"># wrong (but links)</span>

$ g++ -L. -lb a.cpp <span class="hljs-meta"># wrong, as above</span>
$ g++ -Wl,--as-needed -L. -lb a.cpp <span class="hljs-meta"># wrong, as above</span>
$ g++ a.cpp -L. -lb <span class="hljs-meta"># wrong, missing libd.so</span>
$ g++ a.cpp -L. -ld -lb <span class="hljs-meta"># wrong order (works on some distributions)</span>
$ g++ -Wl,--as-needed a.cpp -L. -ld -lb <span class="hljs-meta"># wrong order (like static libs)</span>
$ g++ -Wl,--as-needed a.cpp -L. -lb -ld # <span class="hljs-string">"right"</span>
</code></pre>
<p>If you now look into what dependencies the binary has, you note the binary itself depends also on <code>libd</code>, not just <code>libb</code> as it should. The binary will need to be relinked if <code>libb</code> later depends on another library, if you do it this way. And if someone else loads <code>libb</code> using <code>dlopen</code> at runtime (think of loading plugins dynamically), the call will fail as well. So the <code>"right"</code> really should be a <code>wrong</code> as well.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The GNU ld linker is a so-called smart linker.  It will keep track of the functions used by preceding static libraries, permanently tossing out those functions that are not used from its lookup tables.  The result is that if you link a static library too early, then the functions in that library are no longer available to static libraries later on the link line.  </p>

<p>The typical UNIX linker works from left to right, so put all your dependent libraries on the left, and the ones that satisfy those dependencies on the right of the link line.  You may find that some libraries depend on others while at the same time other libraries depend on them.  This is where it gets complicated.  When it comes to circular references, fix your code!</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Here's an example to make it clear how things work with GCC when <strong>static</strong> libraries are involved. So let's assume we have the following scenario:</p>

<ul>
<li><code>myprog.o</code> - containing <code>main()</code> function, dependent on <code>libmysqlclient</code></li>
<li><code>libmysqlclient</code> - static, for the sake of the example (you'd prefer the shared library, of course, as the <code>libmysqlclient</code> is huge); in <code>/usr/local/lib</code>; and dependent on stuff from <code>libz</code></li>
<li><code>libz</code> (dynamic)</li>
</ul>

<p>How do we link this? (Note: examples from compiling on Cygwin using gcc 4.3.4)</p>

<pre class="lang-c s-code-block"><code class="hljs language-c">gcc -L/usr/local/lib -lmysqlclient myprog.o
<span class="hljs-meta"># undefined reference to `_mysql_init'</span>
<span class="hljs-meta"># myprog depends on libmysqlclient</span>
<span class="hljs-meta"># so myprog has to come earlier on the command <span class="hljs-keyword">line</span></span>

gcc myprog.o -L/usr/local/lib -lmysqlclient
<span class="hljs-meta"># undefined reference to `_uncompress'</span>
<span class="hljs-meta"># we have to link with libz, too</span>

gcc myprog.o -lz -L/usr/local/lib -lmysqlclient
<span class="hljs-meta"># undefined reference to `_uncompress'</span>
<span class="hljs-meta"># libz is needed by libmysqlclient</span>
<span class="hljs-meta"># so it has to appear *after* it on the command <span class="hljs-keyword">line</span></span>

gcc myprog.o -L/usr/local/lib -lmysqlclient -lz
<span class="hljs-meta"># this works</span>
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If you add <code>-Wl,--start-group</code> to the linker flags it does not care which order they're in or if there are circular dependencies.</p>

<p>On Qt this means adding: </p>

<pre class="lang-c s-code-block"><code class="hljs language-c">QMAKE_LFLAGS += -Wl,--start-group
</code></pre>

<p>Saves loads of time messing about and it doesn't seem to slow down linking much (which takes far less time than compilation anyway).</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Another alternative would be to specify the list of libraries twice:</p>

<pre class="lang-c s-code-block"><code class="hljs language-c">gcc prog.o libA.a libB.a libA.a libB.a -o prog.x
</code></pre>

<p>Doing this, you don't have to bother with the right sequence since the reference will be resolved in the second block.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>A quick tip that tripped me up: if you're invoking the linker as "gcc" or "g++", then using "--start-group" and "--end-group" won't pass those options through to the linker -- nor will it flag an error. It will just fail the link with undefined symbols if you had the library order wrong.</p>

<p>You need to write them as "-Wl,--start-group" etc. to tell GCC to pass the argument through to the linker.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 7</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You may can use -Xlinker option.</p>

<pre class="lang-c s-code-block"><code class="hljs language-c">g++ -o foobar  -Xlinker -start-group  -Xlinker libA.a -Xlinker libB.a -Xlinker libC.a  -Xlinker -end-group 
</code></pre>

<p>is ALMOST equal to</p>

<pre class="lang-c s-code-block"><code class="hljs language-c">g++ -o foobar  -Xlinker -start-group  -Xlinker libC.a -Xlinker libB.a -Xlinker libA.a  -Xlinker -end-group 
</code></pre>

<p><em><strong>Careful !</strong></em></p>

<ol>
<li>The order within a group is important !
Here's an example: a debug library has a debug routine, but the non-debug
library has a weak version of the same. You must put the debug library
FIRST in the group or you will resolve to the non-debug version.</li>
<li>You need to precede each library in the group list with -Xlinker</li>
</ol>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 8</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Link order certainly does matter, at least on some platforms. I have seen crashes for applications linked with libraries in wrong order (where wrong means A linked before B but B depends on A).</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 9</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I have seen this a lot, some of our modules link in excess of a 100 libraries of our code plus system &amp; 3rd party libs. </p>

<p>Depending on different linkers HP/Intel/GCC/SUN/SGI/IBM/etc you can get unresolved functions/variables etc, on some platforms you have to list libraries twice. </p>

<p>For the most part we use structured hierarchy of libraries, core, platform, different layers of abstraction, but for some systems you still have to play with the order in the link command.</p>

<p>Once you hit upon a solution document it so the next developer does not have to work it out again.</p>

<p>My old lecturer used to say, "<em>high cohesion &amp; low coupling</em>", its still true today.</p>
    </div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;\u0026lt;sub\u0026gt;(See the history on this answer to get the more elaborate text, but I now think it\u0026apos;s easier for the reader to see real command lines).\u0026lt;/sub\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;Common files shared by all below commands\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-c s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-c\u0026quot;\u0026gt;$ cat a.cpp\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;extern\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; a;\n\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; a;\n}\n\n$ cat b.cpp\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;extern\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; b;\n\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; a = b;\n\n$ cat d.cpp\n\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; b;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;h1\u0026gt;Linking to static libraries\u0026lt;/h1\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-c s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-c\u0026quot;\u0026gt;$ g++ -c b.cpp -o b.o\n$ ar cr libb.a b.o\n$ g++ -c d.cpp -o d.o\n$ ar cr libd.a d.o\n\n$ g++ -L. -ld -lb a.cpp \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# wrong order\u0026lt;/span\u0026gt;\n$ g++ -L. -lb -ld a.cpp \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# wrong order\u0026lt;/span\u0026gt;\n$ g++ a.cpp -L. -ld -lb \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# wrong order\u0026lt;/span\u0026gt;\n$ g++ a.cpp -L. -lb -ld \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# right order\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;The linker searches from left to right, and notes unresolved symbols as it goes. If a library resolves the symbol, it takes the object files of that library to resolve the symbol (b.o out of libb.a in this case).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Dependencies of static libraries against each other work the same - the library that needs symbols must be first, then the library that resolves the symbol.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;If a static library depends on another library, but the other library again depends on the former library, there is a cycle. You can resolve this by enclosing the cyclically dependent libraries by \u0026lt;code\u0026gt;-(\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;-)\u0026lt;/code\u0026gt;, such as \u0026lt;code\u0026gt;-( -la -lb -)\u0026lt;/code\u0026gt; (you may need to escape the parens, such as \u0026lt;code\u0026gt;-\\(\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;-\\)\u0026lt;/code\u0026gt;). The linker then searches those enclosed lib multiple times to ensure cycling dependencies are resolved. Alternatively, you can specify the libraries multiple times, so each is before one another: \u0026lt;code\u0026gt;-la -lb -la\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;h1\u0026gt;Linking to dynamic libraries\u0026lt;/h1\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-c s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-c\u0026quot;\u0026gt;$ export LD_LIBRARY_PATH=. \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# not needed \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; libs go to /usr/lib etc\u0026lt;/span\u0026gt;\n$ g++ -fpic -shared d.cpp -o libd.so\n$ g++ -fpic -shared b.cpp -L. -ld -o libb.so \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# specifies its dependency!\u0026lt;/span\u0026gt;\n\n$ g++ -L. -lb a.cpp \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# wrong order (works on some distributions)\u0026lt;/span\u0026gt;\n$ g++ -Wl,--as-needed -L. -lb a.cpp \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# wrong order\u0026lt;/span\u0026gt;\n$ g++ -Wl,--as-needed a.cpp -L. -lb \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# right order\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;It\u0026apos;s the same here - the libraries must follow the object files of the program. The difference here compared with static libraries is that you need not care about the dependencies of the libraries against each other, because \u0026lt;em\u0026gt;dynamic libraries sort out their dependencies themselves\u0026lt;/em\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Some recent distributions apparently default to using the \u0026lt;code\u0026gt;--as-needed\u0026lt;/code\u0026gt; linker flag, which enforces that the program\u0026apos;s object files come before the dynamic libraries. If that flag is passed, the linker will not link to libraries that are not actually needed by the executable (and it detects this from left to right). My recent archlinux distribution doesn\u0026apos;t use this flag by default, so it didn\u0026apos;t give an error for not following the correct order.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;It is not correct to omit the dependency of \u0026lt;code\u0026gt;b.so\u0026lt;/code\u0026gt; against \u0026lt;code\u0026gt;d.so\u0026lt;/code\u0026gt; when creating the former. You will be required to specify the library when linking \u0026lt;code\u0026gt;a\u0026lt;/code\u0026gt; then, but \u0026lt;code\u0026gt;a\u0026lt;/code\u0026gt; doesn\u0026apos;t really need the integer \u0026lt;code\u0026gt;b\u0026lt;/code\u0026gt; itself, so it should not be made to care about \u0026lt;code\u0026gt;b\u0026lt;/code\u0026gt;\u0026apos;s own dependencies.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Here is an example of the implications if you miss specifying the dependencies for \u0026lt;code\u0026gt;libb.so\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-c s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-c\u0026quot;\u0026gt;$ export LD_LIBRARY_PATH=. \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# not needed \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; libs go to /usr/lib etc\u0026lt;/span\u0026gt;\n$ g++ -fpic -shared d.cpp -o libd.so\n$ g++ -fpic -shared b.cpp -o libb.so \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# wrong (but links)\u0026lt;/span\u0026gt;\n\n$ g++ -L. -lb a.cpp \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# wrong, as above\u0026lt;/span\u0026gt;\n$ g++ -Wl,--as-needed -L. -lb a.cpp \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# wrong, as above\u0026lt;/span\u0026gt;\n$ g++ a.cpp -L. -lb \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# wrong, missing libd.so\u0026lt;/span\u0026gt;\n$ g++ a.cpp -L. -ld -lb \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# wrong order (works on some distributions)\u0026lt;/span\u0026gt;\n$ g++ -Wl,--as-needed a.cpp -L. -ld -lb \u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# wrong order (like static libs)\u0026lt;/span\u0026gt;\n$ g++ -Wl,--as-needed a.cpp -L. -lb -ld # \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;right\u0026quot;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;If you now look into what dependencies the binary has, you note the binary itself depends also on \u0026lt;code\u0026gt;libd\u0026lt;/code\u0026gt;, not just \u0026lt;code\u0026gt;libb\u0026lt;/code\u0026gt; as it should. The binary will need to be relinked if \u0026lt;code\u0026gt;libb\u0026lt;/code\u0026gt; later depends on another library, if you do it this way. And if someone else loads \u0026lt;code\u0026gt;libb\u0026lt;/code\u0026gt; using \u0026lt;code\u0026gt;dlopen\u0026lt;/code\u0026gt; at runtime (think of loading plugins dynamically), the call will fail as well. So the \u0026lt;code\u0026gt;\u0026quot;right\u0026quot;\u0026lt;/code\u0026gt; really should be a \u0026lt;code\u0026gt;wrong\u0026lt;/code\u0026gt; as well.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The GNU ld linker is a so-called smart linker.  It will keep track of the functions used by preceding static libraries, permanently tossing out those functions that are not used from its lookup tables.  The result is that if you link a static library too early, then the functions in that library are no longer available to static libraries later on the link line.  \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The typical UNIX linker works from left to right, so put all your dependent libraries on the left, and the ones that satisfy those dependencies on the right of the link line.  You may find that some libraries depend on others while at the same time other libraries depend on them.  This is where it gets complicated.  When it comes to circular references, fix your code!\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Here\u0026apos;s an example to make it clear how things work with GCC when \u0026lt;strong\u0026gt;static\u0026lt;/strong\u0026gt; libraries are involved. So let\u0026apos;s assume we have the following scenario:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;myprog.o\u0026lt;/code\u0026gt; - containing \u0026lt;code\u0026gt;main()\u0026lt;/code\u0026gt; function, dependent on \u0026lt;code\u0026gt;libmysqlclient\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;libmysqlclient\u0026lt;/code\u0026gt; - static, for the sake of the example (you\u0026apos;d prefer the shared library, of course, as the \u0026lt;code\u0026gt;libmysqlclient\u0026lt;/code\u0026gt; is huge); in \u0026lt;code\u0026gt;/usr/local/lib\u0026lt;/code\u0026gt;; and dependent on stuff from \u0026lt;code\u0026gt;libz\u0026lt;/code\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;libz\u0026lt;/code\u0026gt; (dynamic)\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;How do we link this? (Note: examples from compiling on Cygwin using gcc 4.3.4)\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-c s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-c\u0026quot;\u0026gt;gcc -L/usr/local/lib -lmysqlclient myprog.o\n\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# undefined reference to `_mysql_init\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# myprog depends on libmysqlclient\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# so myprog has to come earlier on the command \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;line\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;\n\ngcc myprog.o -L/usr/local/lib -lmysqlclient\n\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# undefined reference to `_uncompress\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# we have to link with libz, too\u0026lt;/span\u0026gt;\n\ngcc myprog.o -lz -L/usr/local/lib -lmysqlclient\n\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# undefined reference to `_uncompress\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# libz is needed by libmysqlclient\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# so it has to appear *after* it on the command \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;line\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;\n\ngcc myprog.o -L/usr/local/lib -lmysqlclient -lz\n\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# this works\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;If you add \u0026lt;code\u0026gt;-Wl,--start-group\u0026lt;/code\u0026gt; to the linker flags it does not care which order they\u0026apos;re in or if there are circular dependencies.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;On Qt this means adding: \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-c s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-c\u0026quot;\u0026gt;QMAKE_LFLAGS += -Wl,--start-group\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Saves loads of time messing about and it doesn\u0026apos;t seem to slow down linking much (which takes far less time than compilation anyway).\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Another alternative would be to specify the list of libraries twice:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-c s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-c\u0026quot;\u0026gt;gcc prog.o libA.a libB.a libA.a libB.a -o prog.x\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Doing this, you don\u0026apos;t have to bother with the right sequence since the reference will be resolved in the second block.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;A quick tip that tripped me up: if you\u0026apos;re invoking the linker as \u0026quot;gcc\u0026quot; or \u0026quot;g++\u0026quot;, then using \u0026quot;--start-group\u0026quot; and \u0026quot;--end-group\u0026quot; won\u0026apos;t pass those options through to the linker -- nor will it flag an error. It will just fail the link with undefined symbols if you had the library order wrong.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You need to write them as \u0026quot;-Wl,--start-group\u0026quot; etc. to tell GCC to pass the argument through to the linker.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;You may can use -Xlinker option.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-c s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-c\u0026quot;\u0026gt;g++ -o foobar  -Xlinker -start-group  -Xlinker libA.a -Xlinker libB.a -Xlinker libC.a  -Xlinker -end-group \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;is ALMOST equal to\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-c s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-c\u0026quot;\u0026gt;g++ -o foobar  -Xlinker -start-group  -Xlinker libC.a -Xlinker libB.a -Xlinker libA.a  -Xlinker -end-group \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;\u0026lt;strong\u0026gt;Careful !\u0026lt;/strong\u0026gt;\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;The order within a group is important !\nHere\u0026apos;s an example: a debug library has a debug routine, but the non-debug\nlibrary has a weak version of the same. You must put the debug library\nFIRST in the group or you will resolve to the non-debug version.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;You need to precede each library in the group list with -Xlinker\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Link order certainly does matter, at least on some platforms. I have seen crashes for applications linked with libraries in wrong order (where wrong means A linked before B but B depends on A).\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I have seen this a lot, some of our modules link in excess of a 100 libraries of our code plus system \u0026amp;amp; 3rd party libs. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Depending on different linkers HP/Intel/GCC/SUN/SGI/IBM/etc you can get unresolved functions/variables etc, on some platforms you have to list libraries twice. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For the most part we use structured hierarchy of libraries, core, platform, different layers of abstraction, but for some systems you still have to play with the order in the link command.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Once you hit upon a solution document it so the next developer does not have to work it out again.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;My old lecturer used to say, \u0026quot;\u0026lt;em\u0026gt;high cohesion \u0026amp;amp; low coupling\u0026lt;/em\u0026gt;\u0026quot;, its still true today.\u0026lt;/p\u0026gt;\n    "],"comment":["\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;See also now \u0026lt;a href=\u0026quot;http://stackoverflow.com/questions/7826448/linking-libraries-with-gcc-order-of-arguments\u0026quot; title=\u0026quot;linking libraries with gcc order of arguments\u0026quot;\u0026gt;stackoverflow.com/questions/7826448/\u0026lt;/a\u0026gt; -- TLDR \u0026lt;code\u0026gt;gcc\u0026lt;/code\u0026gt; changed to more-strict behavior (relatively) recently.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/874188/tripleee\u0026quot; title=\u0026quot;159,777 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;tripleee\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment43959406_45135\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-01-05 06:17:19Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 5, 2015 at 6:17\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Repeat until all symbols resolved, eh - you\u0026apos;d think they could manage a topological sort. LLVM has 78 static libraries on it\u0026apos;s own, with who-knows-what dependencies. True it also has a script to figure out compile/link options - but you can\u0026apos;t use that in all circumstances.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;span class=\u0026quot;comment-user\u0026quot;\u0026gt;user180247\u0026lt;/span\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment3325557_409470\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2010-07-11 13:27:46Z, License: CC BY-SA 2.5\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 11, 2010 at 13:27\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@Steve that\u0026apos;s what the programs \u0026lt;code\u0026gt;lorder\u0026lt;/code\u0026gt; + \u0026lt;code\u0026gt;tsort\u0026lt;/code\u0026gt; do. But sometimes there is no order, if you have cyclic references. Then you just have to cycle through the libraries list until everything is resolved.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/34509/johannes-schaub-litb\u0026quot; title=\u0026quot;482,727 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Johannes Schaub - litb\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment8520879_409470\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2011-08-18 19:01:27Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 18, 2011 at 19:01\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@Johannes - Determine the maximal strongly connected components (e.g. Tarjans algorithm) then topologically sort the (inherently non-cyclic) digraph of components. Each component can be treated as one library - if any one library from the component is needed, the dependency cycle(s) will cause all libraries in that component to be needed. So no, there really is no need to cycle through all the libraries in order to resolve everything, and no need for awkward command-line options - one method using two well-known algorithms can handle all cases correctly.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;span class=\u0026quot;comment-user\u0026quot;\u0026gt;user180247\u0026lt;/span\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment8524547_409470\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2011-08-18 22:44:50Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 18, 2011 at 22:44\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;I would like to add one important detail to this excellent answer: Using \u0026quot;-( archives -)\u0026quot; or \u0026quot;--start-group archives --end-group\u0026quot; \u0026lt;b\u0026gt;is the only sure-fire way of resolving circular dependencies\u0026lt;/b\u0026gt;, since each time the linker visits an archive, it pulls in (and registers the unresolved symbols of) \u0026lt;i\u0026gt;only the object files that resolve currently unresolved symbols\u0026lt;/i\u0026gt;. Because of this, CMake\u0026apos;s algorithm of repeating connected components in the dependency graph may occasionally fail. (See also \u0026lt;a href=\u0026quot;http://www.airs.com/blog/archives/48\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Ian Lance Taylor\u0026apos;s excellent blog post\u0026lt;/a\u0026gt; on linkers for more detail.)\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/395370/jorgen\u0026quot; title=\u0026quot;515 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;jorgen\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment29065251_409470\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-10-25 07:34:39Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 25, 2013 at 7:34\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Fantastic write up: it gets an up-vote from me.  I would add to the section on \u0026lt;i\u0026gt;resolving cyclic dependencies\u0026lt;/i\u0026gt;, I\u0026apos;ll leave it to the original poster if they wish to modify, that when passing the \u0026lt;code\u0026gt;--start-group\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;--end-group\u0026lt;/code\u0026gt; options using gcc, you must precede with \u0026lt;code\u0026gt;-Wl,\u0026amp;lt;option\u0026amp;gt;\u0026lt;/code\u0026gt; as in \u0026lt;code\u0026gt;-Wl,--start-group \u0026amp;lt;archives\u0026amp;gt; -Wl,--end-group\u0026lt;/code\u0026gt;.  It is mentioned in the manual page which is referenced, but a quick mention here is helpful too.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/988207/andrew-falanga\u0026quot; title=\u0026quot;2,141 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Andrew Falanga\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment40116679_409470\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2014-09-04 16:27:13Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 4, 2014 at 16:27\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Is this something with only gnu ld/gcc? Or is this something common with linkers?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/841/mike\u0026quot; title=\u0026quot;3,286 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Mike\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment15864864_409402\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2008-09-05 03:17:32Z, License: CC BY-SA 2.5\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 5, 2008 at 3:17\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Apparently more Unix compilers have similar issues. MSVC isn\u0026apos;t entirely free of these issues, eiher, but they don\u0026apos;t appear to be that bad.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/15416/msalters\u0026quot; title=\u0026quot;168,160 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;MSalters\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment15864865_409402\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2009-04-28 14:42:36Z, License: CC BY-SA 2.5\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Apr 28, 2009 at 14:42\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;The MS dev tools don\u0026apos;t tend to show these issues as much because if you use an all-MS tool chain it ends up setting up the linker order properly, and you never notice the issue.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/5801/michael-kohne\u0026quot; title=\u0026quot;11,679 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Michael Kohne\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment15864866_409402\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2009-08-28 20:59:10Z, License: CC BY-SA 2.5\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 28, 2009 at 20:59\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;The MSVC linker is less sensitive to this issue because it will search all libraries for an unreferenced symbol. Library order still can affect \u0026lt;i\u0026gt;which\u0026lt;/i\u0026gt; symbol gets resolved if more than one library have the symbol. From MSDN: \u0026quot;Libraries are searched in command line order as well, with the following caveat: Symbols that are unresolved when bringing in an object file from a library are searched for in that library first, and then the following libraries from the command line and /DEFAULTLIB (Specify Default Library) directives, and then to any libraries at the beginning of the command line\u0026quot;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/12711/michael-burr\u0026quot; title=\u0026quot;322,355 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Michael Burr\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment15864867_409402\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2012-04-24 06:19:30Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Apr 24, 2012 at 6:19\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;\u0026lt;i\u0026gt;\u0026quot;... smart linker ...\u0026quot;\u0026lt;/i\u0026gt; - I believe it is classified as a \u0026quot;single pass\u0026quot; linker, not a \u0026quot;smart linker\u0026quot;.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/608639/jww\u0026quot; title=\u0026quot;91,521 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;jww\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment91049913_409402\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2018-08-28 03:34:10Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 28, 2018 at 3:34\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 2 times\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;it works because of \u0026lt;code\u0026gt;/usr/bin/ld: missing --end-group; added as last command line option\u0026lt;/code\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/955508/leanid-chaika\u0026quot; title=\u0026quot;1,823 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;leanid.chaika\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment122336028_29457226\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2021-09-16 22:10:50Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 16, 2021 at 22:10\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        "],"id":316,"title":"Why does the order in which libraries are linked sometimes cause errors in GCC?","content":"\n                \n\u0026lt;p\u0026gt;Why does the order in which libraries are linked sometimes cause errors in GCC?\u0026lt;/p\u0026gt;\n    ","slug":"why-does-the-order-in-which-libraries-are-linked-sometimes-cause-errors-in-gcc-1657387609554","postType":"QUESTION","createdAt":"2022-07-09T17:26:49.000Z","updatedAt":"2022-07-09T17:26:49.000Z","tags":[{"id":1854,"name":"linker","slug":"linker","createdAt":"2022-07-09T17:26:49.000Z","updatedAt":"2022-07-09T17:26:49.000Z","Questions_Tags":{"questionId":316,"tagId":1854}}]}},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"why-does-the-order-in-which-libraries-are-linked-sometimes-cause-errors-in-gcc-1657387609554"},"buildId":"4Y8KGE-c2lolBeBmcum_I","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>