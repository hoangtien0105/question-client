<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2eccd4d47c856f2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2eccd4d47c856f2b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-20edbe0b078add93.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/613-1e0aa2b2023820bb.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/471-84c36aa98dd4107c.js" defer=""></script><script src="/_next/static/chunks/81-301f760ac8107464.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-76d2c3e2d98bb08b.js" defer=""></script><script src="/_next/static/B9ZMQqRLGvIP-RcWN9dT2/_buildManifest.js" defer=""></script><script src="/_next/static/B9ZMQqRLGvIP-RcWN9dT2/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">.eZIPKL code{padding:5px;color:hsl(210deg 8% 15%);background-color:hsl(210deg 8% 90%);border-radius:3px;}/*!sc*/
data-styled.g5[id="sc-c4b0431a-0"]{content:"eZIPKL,"}/*!sc*/
</style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="https://flowbite.com/docs/images/logo.svg" class="mr-3 h-6 sm:h-9" alt="Flowbite Logo"/><span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Hunter</span></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/iterating-through-a-collection-avoiding-concurrentmodificationexception-when-removing-objects-in-a-loop-1657387311824#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="sc-c4b0431a-0 eZIPKL flex question-header items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/iterating-through-a-collection-avoiding-concurrentmodificationexception-when-removing-objects-in-a-loop-1657387311824">Iterating through a Collection, avoiding ConcurrentModificationException when removing objects in a loop</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/collections">collections</a></div></div><div class="question-content mt-5">
                
<p>We all know you can't do the following because of <code>ConcurrentModificationException</code>:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">for</span> (Object i : l) {
    <span class="hljs-keyword">if</span> (condition(i)) {
        l.remove(i);
    }
}
</code></pre>

<p>But this apparently works sometimes, but not always. Here's some specific code:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    Collection&lt;Integer&gt; l = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) {
        l.add(<span class="hljs-number">4</span>);
        l.add(<span class="hljs-number">5</span>);
        l.add(<span class="hljs-number">6</span>);
    }

    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i : l) {
        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">5</span>) {
            l.remove(i);
        }
    }

    System.out.println(l);
}
</code></pre>

<p>This, of course, results in:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java">Exception in thread <span class="hljs-string">"main"</span> java.util.ConcurrentModificationException
</code></pre>

<p>Even though multiple threads aren't doing it. Anyway.</p>

<p>What's the best solution to this problem? How can I remove an item from the collection in a loop without throwing this exception?</p>

<p>I'm also using an arbitrary <code>Collection</code> here, not necessarily an <code>ArrayList</code>, so you can't rely on <code>get</code>.</p>
    </div></div></div><div class="sc-c4b0431a-2 cRqwQe"><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><a href="https://docs.oracle.com/javase/9/docs/api/java/util/Iterator.html#remove--" rel="noreferrer"><code>Iterator.remove()</code></a> is safe, you can use it like this:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java">List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

<span class="hljs-comment">// This is a clever way to create the iterator and call iterator.hasNext() like</span>
<span class="hljs-comment">// you would do in a while-loop. It would be the same as doing:</span>
<span class="hljs-comment">//     Iterator&lt;String&gt; iterator = list.iterator();</span>
<span class="hljs-comment">//     while (iterator.hasNext()) {</span>
<span class="hljs-keyword">for</span> (Iterator&lt;String&gt; iterator = list.iterator(); iterator.hasNext();) {
    <span class="hljs-type">String</span> <span class="hljs-variable">string</span> <span class="hljs-operator">=</span> iterator.next();
    <span class="hljs-keyword">if</span> (string.isEmpty()) {
        <span class="hljs-comment">// Remove the current element from the iterator and the list.</span>
        iterator.remove();
    }
}
</code></pre>

<p>Note that <a href="https://docs.oracle.com/javase/9/docs/api/java/util/Iterator.html#remove--" rel="noreferrer"><code>Iterator.remove()</code></a> is the only safe way to modify a collection during iteration; the behavior is unspecified if the underlying collection is modified <strong>in any other way</strong> while the iteration is in progress.</p>

<p>Source:<a href="http://docs.oracle.com/javase/tutorial/collections/interfaces/collection.html" rel="noreferrer"> docs.oracle &gt; The Collection Interface</a></p>

<hr>

<p>And similarly, if you have a <code>ListIterator</code> and want to <em>add</em> items, you can use <a href="http://docs.oracle.com/javase/8/docs/api/java/util/ListIterator.html#add-E-" rel="noreferrer"><code>ListIterator#add</code></a>, for the same reason you can use <code>Iterator#remove</code>&nbsp; it's designed to allow it.</p>

<hr>

<p>In your case you tried to remove from a list, but the same restriction applies if trying to <code>put</code> into a <code>Map</code> while iterating its content. </p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>This works:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java">Iterator&lt;Integer&gt; iter = l.iterator();
<span class="hljs-keyword">while</span> (iter.hasNext()) {
    <span class="hljs-keyword">if</span> (iter.next() == <span class="hljs-number">5</span>) {
        iter.remove();
    }
}
</code></pre>

<p>I assumed that since a foreach loop is syntactic sugar for iterating, using an iterator wouldn't help... but it gives you this <code>.remove()</code> functionality.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>With Java 8 you can use <a href="http://docs.oracle.com/javase/8/docs/api/java/util/Collection.html#removeIf-java.util.function.Predicate-" rel="noreferrer">the new <code>removeIf</code> method</a>. Applied to your example:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java">Collection&lt;Integer&gt; coll = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-comment">//populate</span>

coll.removeIf(i -&gt; i == <span class="hljs-number">5</span>);
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Since the question has been already answered i.e. the best way is to use the remove method of the iterator object, I would go into the specifics of the place where the error <code>"java.util.ConcurrentModificationException"</code> is thrown.</p>

<p>Every collection class has a private class which implements the Iterator interface and provides methods like <code>next()</code>, <code>remove()</code> and <code>hasNext()</code>.</p>

<p>The code for next looks something like this...</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">public</span> E <span class="hljs-title function_">next</span><span class="hljs-params">()</span> {
    checkForComodification();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">E</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> get(cursor);
        lastRet = cursor++;
        <span class="hljs-keyword">return</span> next;
    } <span class="hljs-keyword">catch</span>(IndexOutOfBoundsException e) {
        checkForComodification();
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoSuchElementException</span>();
    }
}
</code></pre>

<p>Here the method <code>checkForComodification</code> is implemented as </p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkForComodification</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (modCount != expectedModCount)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentModificationException</span>();
}
</code></pre>

<p>So, as you can see, if you explicitly try to remove an element from the collection. It results in <code>modCount</code> getting different from <code>expectedModCount</code>, resulting in the exception <code>ConcurrentModificationException</code>.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You can either use the iterator directly like you mentioned, or else keep a second collection and add each item you want to remove to the new collection, then removeAll at the end. This allows you to keep using the type-safety of the for-each loop at the cost of increased memory use and cpu time (shouldn't be a huge problem unless you have really, really big lists or a really old computer)</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>
{
    Collection&lt;Integer&gt; l = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;();
    Collection&lt;Integer&gt; itemsToRemove = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
        l.add(Integer.of(<span class="hljs-number">4</span>));
        l.add(Integer.of(<span class="hljs-number">5</span>));
        l.add(Integer.of(<span class="hljs-number">6</span>));
    }
    <span class="hljs-keyword">for</span> (Integer i : l)
    {
        <span class="hljs-keyword">if</span> (i.intValue() == <span class="hljs-number">5</span>) {
            itemsToRemove.add(i);
        }
    }

    l.removeAll(itemsToRemove);
    System.out.println(l);
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In such cases a common trick is (was?) to go backwards:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> l.size() - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i --) {
  <span class="hljs-keyword">if</span> (l.get(i) == <span class="hljs-number">5</span>) {
    l.remove(i);
  }
}
</code></pre>

<p>That said, I'm more than happy that you have better ways in Java 8, e.g. <code>removeIf</code> or <code>filter</code> on streams.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 7</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Same answer as <a href="https://stackoverflow.com/a/223927/1433392">Claudius</a> with a for loop:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">for</span> (Iterator&lt;Object&gt; it = objects.iterator(); it.hasNext();) {
    <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> it.next();
    <span class="hljs-keyword">if</span> (test) {
        it.remove();
    }
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 8</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>With <a href="https://www.eclipse.org/collections/" rel="nofollow noreferrer">Eclipse Collections</a>, the method <code>removeIf</code> defined on <a href="https://github.com/eclipse/eclipse-collections/blob/master/eclipse-collections-api/src/main/java/org/eclipse/collections/api/collection/MutableCollection.java#L236" rel="nofollow noreferrer">MutableCollection</a> will work:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java">MutableList&lt;Integer&gt; list = Lists.mutable.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>);
list.removeIf(Predicates.lessThan(<span class="hljs-number">3</span>));
Assert.assertEquals(Lists.mutable.of(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>), list);
</code></pre>

<p>With Java 8 Lambda syntax this can be written as follows:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java">MutableList&lt;Integer&gt; list = Lists.mutable.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>);
list.removeIf(Predicates.cast(integer -&gt; integer &lt; <span class="hljs-number">3</span>));
Assert.assertEquals(Lists.mutable.of(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>), list);
</code></pre>

<p>The call to <code>Predicates.cast()</code> is necessary here because a default <code>removeIf</code> method was added on the <code>java.util.Collection</code> interface in Java 8. </p>

<p><strong>Note:</strong> I am a committer for <a href="https://www.eclipse.org/collections/" rel="nofollow noreferrer">Eclipse Collections</a>.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 9</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Make a copy of existing list and iterate over new copy.</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">for</span> (String str : <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;(listOfStr))     
{
    listOfStr.remove(<span class="hljs-comment">/* object reference or index */</span>);
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 10</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>People are asserting one <strong>can't</strong> remove from a Collection being iterated by a foreach loop. I just wanted to point out that is <em>technically</em> incorrect and describe exactly (I know the OP's question is so advanced as to obviate knowing this) the code behind that assumption:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">for</span> (TouchableObj obj : untouchedSet) {  <span class="hljs-comment">// &lt;--- This is where ConcurrentModificationException strikes</span>
    <span class="hljs-keyword">if</span> (obj.isTouched()) {
        untouchedSet.remove(obj);
        touchedSt.add(obj);
        <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// this is key to avoiding returning to the foreach</span>
    }
}
</code></pre>

<p>It isn't that you can't remove from the iterated <code>Colletion</code> rather that you can't then continue iteration once you do. Hence the <code>break</code> in the code above.</p>

<p>Apologies if this answer is a somewhat specialist use-case and more suited to the original <a href="https://stackoverflow.com/questions/1110404/remove-elements-from-a-hashset-while-iterating">thread</a> I arrived here from, that one is marked as a duplicate (despite this thread appearing more nuanced) of this and locked.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 11</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>With a traditional for loop</p>

<pre class="lang-java s-code-block"><code class="hljs language-java">ArrayList&lt;String&gt; myArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; myArray.size(); ) {
    <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> myArray.get(i);
    <span class="hljs-keyword">if</span> (someCondition(text))
        myArray.remove(i);
    <span class="hljs-keyword">else</span>
        i++;   
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 12</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentHashMap.html" rel="nofollow">ConcurrentHashMap</a> or <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentLinkedQueue.html" rel="nofollow">ConcurrentLinkedQueue</a> or <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentSkipListMap.html" rel="nofollow">ConcurrentSkipListMap</a> may be another option, because they will never throw any ConcurrentModificationException, even if you remove or add item.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 13</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Another way is to use a copy of your arrayList just for iteration:</p>
<pre class="lang-java s-code-block"><code class="hljs language-java">List&lt;Object&gt; l = ...
    
List&lt;Object&gt; iterationList = ImmutableList.copyOf(l);
    
<span class="hljs-keyword">for</span> (Object curr : iterationList) {
    <span class="hljs-keyword">if</span> (condition(curr)) {
        l.remove(curr);
    }
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 14</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>A <code>ListIterator</code> allows you to add or remove items in the list.  Suppose you have a list of <code>Car</code> objects:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java">List&lt;Car&gt; cars = ArrayList&lt;&gt;();
<span class="hljs-comment">// add cars here...</span>

<span class="hljs-keyword">for</span> (ListIterator&lt;Car&gt; carIterator = cars.listIterator();  carIterator.hasNext(); )
{
   <span class="hljs-keyword">if</span> (&lt;some-condition&gt;)
   { 
      carIterator().remove()
   }
   <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (&lt;some-other-condition&gt;)
   { 
      carIterator().add(aNewCar);
   }
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 15</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I know this question is too old to be about Java 8, but for those using Java 8 you can easily use removeIf():</p>

<pre class="lang-java s-code-block"><code class="hljs language-java">Collection&lt;Integer&gt; l = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;();

<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) {
    l.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">4</span>));
    l.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">5</span>));
    l.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">6</span>));
}

l.removeIf(i -&gt; i.intValue() == <span class="hljs-number">5</span>);
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 16</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Now, You can remove with the following code</p>
<pre class="lang-java s-code-block"><code class="hljs language-java">l.removeIf(current -&gt; current == <span class="hljs-number">5</span>);
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 17</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p><strong>Java Concurrent Modification Exception</strong></p>
<ol>
<li>Single thread</li>
</ol>
<pre class="lang-java s-code-block"><code class="hljs language-java">Iterator&lt;String&gt; iterator = list.iterator();
<span class="hljs-keyword">while</span> (iterator.hasNext()) {
    <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> iter.next()
    <span class="hljs-keyword">if</span> (value == <span class="hljs-string">"A"</span>) {
        list.remove(it.next()); <span class="hljs-comment">//throws ConcurrentModificationException</span>
    }
}
</code></pre>
<p>Solution: iterator <code>remove()</code> method</p>
<pre class="lang-java s-code-block"><code class="hljs language-java">Iterator&lt;String&gt; iterator = list.iterator();
<span class="hljs-keyword">while</span> (iterator.hasNext()) {
    <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> iter.next()
    <span class="hljs-keyword">if</span> (value == <span class="hljs-string">"A"</span>) {
        it.remove()
    }
}
</code></pre>
<ol start="2">
<li>Multi thread</li>
</ol>
<ul>
<li>copy/convert and iterate over another one collection. For small collections</li>
<li><code>synchronize</code><a href="https://stackoverflow.com/a/59500618/4770877"><sup>[About]</sup></a></li>
<li>thread safe collection<a href="https://stackoverflow.com/a/65410514/4770877"><sup>[About]</sup></a></li>
</ul>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 18</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I have a suggestion for the problem above. No need of secondary list or any extra time. Please find an example which would do the same stuff but in a different way.</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-comment">//"list" is ArrayList&lt;Object&gt;</span>
<span class="hljs-comment">//"state" is some boolean variable, which when set to true, Object will be removed from the list</span>
<span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">while</span>(index &lt; list.size()) {
    <span class="hljs-type">Object</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> list.get(index);
    <span class="hljs-keyword">if</span>( state ) {
        list.remove(index);
        index = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">continue</span>;
    }
    index += <span class="hljs-number">1</span>;
}
</code></pre>

<p>
This would avoid the Concurrency Exception.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 19</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">for</span> (Integer i : l)
{
    <span class="hljs-keyword">if</span> (i.intValue() == <span class="hljs-number">5</span>){
            itemsToRemove.add(i);
            <span class="hljs-keyword">break</span>;
    }
}
</code></pre>

<p>The catch is the after removing the element from the list if you skip the internal iterator.next() call. it still works! Though I dont propose to write code like this it helps to understand the concept behind it :-)</p>

<p>Cheers!</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 20</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Example of thread safe collection modification:</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;String&gt; queue = Collections.synchronizedList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;());

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeFromQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">synchronized</span> (queue) {
            Iterator&lt;String&gt; iterator = queue.iterator();
            <span class="hljs-type">String</span> <span class="hljs-variable">string</span> <span class="hljs-operator">=</span> iterator.next();
            <span class="hljs-keyword">if</span> (string.isEmpty()) {
                iterator.remove();
            }
        }
    }
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 21</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>One solution could be to rotate the list and remove the first element to avoid the ConcurrentModificationException or IndexOutOfBoundsException</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> list.size();
<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>;j&lt;n;j++){
    <span class="hljs-comment">//you can also put a condition before remove</span>
    list.remove(<span class="hljs-number">0</span>);
    Collections.rotate(list, <span class="hljs-number">1</span>);
}
Collections.rotate(list, -<span class="hljs-number">1</span>);
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 22</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Try this one (removes all elements in the list that equal <code>i</code>):</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">for</span> (Object i : l) {
    <span class="hljs-keyword">if</span> (condition(i)) {
        l = (l.stream().filter((a) -&gt; a != i)).collect(Collectors.toList());
    }
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 23</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You can use a while loop.</p>
<pre class="lang-java s-code-block"><code class="hljs language-java">Iterator&lt;Map.Entry&lt;String, String&gt;&gt; iterator = map.entrySet().iterator();
<span class="hljs-keyword">while</span>(iterator.hasNext()){
    Map.Entry&lt;String, String&gt; entry = iterator.next();
    <span class="hljs-keyword">if</span>(entry.getKey().equals(<span class="hljs-string">"test"</span>)) {
        iterator.remove();
    } 
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 24</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I ended up with this <code>ConcurrentModificationException</code>, while iterating the list using <code>stream().map()</code> method. However the <code>for(:)</code> did not throw the exception while iterating and modifying the the list.</p>
<p>Here is code snippet , if its of help to anyone:
here I'm iterating on a <code>ArrayList&lt;BuildEntity&gt;</code> , and modifying it using the list.remove(obj)</p>
<pre class="lang-java s-code-block"><code class="hljs language-java"> <span class="hljs-keyword">for</span>(BuildEntity build : uniqueBuildEntities){
            <span class="hljs-keyword">if</span>(build!=<span class="hljs-literal">null</span>){
                <span class="hljs-keyword">if</span>(isBuildCrashedWithErrors(build)){
                    log.info(<span class="hljs-string">"The following build crashed with errors ,  will not be persisted -&gt; \n{}"</span>
                            ,build.getBuildUrl());
                    uniqueBuildEntities.remove(build);
                    <span class="hljs-keyword">if</span> (uniqueBuildEntities.isEmpty()) <span class="hljs-keyword">return</span>  EMPTY_LIST;
                }
            }
        }
        <span class="hljs-keyword">if</span>(uniqueBuildEntities.size()&gt;<span class="hljs-number">0</span>) {
            dbEntries.addAll(uniqueBuildEntities);
        }
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 25</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If using HashMap, in newer versions of Java (8+) you can select each of 3 options:</p>
<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserProfileEntity</span> {
    <span class="hljs-keyword">private</span> String Code;
    <span class="hljs-keyword">private</span> String mobileNumber;
    <span class="hljs-keyword">private</span> LocalDateTime inputDT;
    <span class="hljs-comment">// getters and setters here</span>
}
HashMap&lt;String, UserProfileEntity&gt; upMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();


<span class="hljs-comment">// remove by value</span>
upMap.values().removeIf(value -&gt; !value.getCode().contains(<span class="hljs-string">"0005"</span>));

<span class="hljs-comment">// remove by key</span>
upMap.keySet().removeIf(key -&gt; key.contentEquals(<span class="hljs-string">"testUser"</span>));

<span class="hljs-comment">// remove by entry / key + value</span>
upMap.entrySet().removeIf(entry -&gt; (entry.getKey().endsWith(<span class="hljs-string">"admin"</span>) || entry.getValue().getInputDT().isBefore(LocalDateTime.now().minusMinutes(<span class="hljs-number">3</span>)));
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 26</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The best way (recommended) is use of <code>java.util.concurrent</code> package. By
using this package you can easily avoid this exception. Refer
Modified Code:</p>
<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    Collection&lt;Integer&gt; l = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;Integer&gt;();
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) {
        l.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">4</span>));
        l.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">5</span>));
        l.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(<span class="hljs-number">6</span>));
    }
    
    <span class="hljs-keyword">for</span> (Integer i : l) {
        <span class="hljs-keyword">if</span> (i.intValue() == <span class="hljs-number">5</span>) {
            l.remove(i);
        }
    }
    
    System.out.println(l);
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 27</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In case <strong>ArrayList:remove(int index)</strong>- if(index is last element's position) it avoids without <code>System.arraycopy()</code> and takes not time for this.</p>

<p>arraycopy time increases if(index decreases), by the way elements of list also decreases!</p>

<p>the best effective remove way is- removing its elements in descending order:
<code>while(list.size()&gt;0)list.remove(list.size()-1);</code>//takes O(1)
<code>while(list.size()&gt;0)list.remove(0);</code>//takes O(factorial(n))</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-comment">//region prepare data</span>
ArrayList&lt;Integer&gt; ints = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;();
ArrayList&lt;Integer&gt; toRemove = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;();
<span class="hljs-type">Random</span> <span class="hljs-variable">rdm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();
<span class="hljs-type">long</span> millis;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++) {
    <span class="hljs-type">Integer</span> <span class="hljs-variable">integer</span> <span class="hljs-operator">=</span> rdm.nextInt();
    ints.add(integer);
}
ArrayList&lt;Integer&gt; intsForIndex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;(ints);
ArrayList&lt;Integer&gt; intsDescIndex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;(ints);
ArrayList&lt;Integer&gt; intsIterator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt;(ints);
<span class="hljs-comment">//endregion</span>

<span class="hljs-comment">// region for index</span>
millis = System.currentTimeMillis();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; intsForIndex.size(); i++) 
   <span class="hljs-keyword">if</span> (intsForIndex.get(i) % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) intsForIndex.remove(i--);
System.out.println(System.currentTimeMillis() - millis);
<span class="hljs-comment">// endregion</span>

<span class="hljs-comment">// region for index desc</span>
millis = System.currentTimeMillis();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> intsDescIndex.size() - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) 
   <span class="hljs-keyword">if</span> (intsDescIndex.get(i) % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) intsDescIndex.remove(i);
System.out.println(System.currentTimeMillis() - millis);
<span class="hljs-comment">//endregion</span>

<span class="hljs-comment">// region iterator</span>
millis = System.currentTimeMillis();
<span class="hljs-keyword">for</span> (Iterator&lt;Integer&gt; iterator = intsIterator.iterator(); iterator.hasNext(); )
    <span class="hljs-keyword">if</span> (iterator.next() % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) iterator.remove();
System.out.println(System.currentTimeMillis() - millis);
<span class="hljs-comment">//endregion</span>
</code></pre>

<ul>
<li>for index loop: 1090 msec</li>
<li>for desc index: <strong>519</strong> msec---the best</li>
<li>for iterator: 1043 msec</li>
</ul>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 28</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I know this question assumes just a <code>Collection</code>, and not more specifically any <code>List</code>.  But <strong>for those reading this question who are indeed working with a <code>List</code> reference, you can avoid <code>ConcurrentModificationException</code> with a <code>while</code>-loop (while modifying within it) instead if you want to avoid <code>Iterator</code></strong> (either if you want to avoid it in general, or avoid it specifically to achieve a looping order different from start-to-end stopping at each element [which I believe is the only order <code>Iterator</code> itself can do]):</p>

<p><strong>*Update: See comments below that clarify the analogous is also achievable with the <em>traditional</em>-for-loop.</strong></p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">final</span> List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i){
    list.add(i);
}

<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">while</span>(i &lt; list.size()){
    <span class="hljs-keyword">if</span>(list.get(i) % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>){
        list.remove(i++);

    } <span class="hljs-keyword">else</span> {
        i += <span class="hljs-number">2</span>;
    }
}
</code></pre>

<p><em>No ConcurrentModificationException from that code.</em></p>

<p>There we see looping not start at the beginning, and not stop at <em>every</em> element (which I believe <code>Iterator</code> itself can't do).</p>

<p>FWIW we also see <code>get</code> being called on <code>list</code>, which could not be done if its reference was just <code>Collection</code> (instead of the more specific <code>List</code>-type of <code>Collection</code>) - <code>List</code> interface includes <code>get</code>, but <code>Collection</code> interface does not.  If not for that difference, then the <code>list</code> reference could instead be a <code>Collection</code> [and therefore technically this Answer would then be a direct Answer, instead of a tangential Answer].</p>

<p>FWIWW same code still works after modified to start at beginning at stop at every element (just like <code>Iterator</code> order):</p>

<pre class="lang-java s-code-block"><code class="hljs language-java"><span class="hljs-keyword">final</span> List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i){
    list.add(i);
}

<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-keyword">while</span>(i &lt; list.size()){
    <span class="hljs-keyword">if</span>(list.get(i) % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>){
        list.remove(i);

    } <span class="hljs-keyword">else</span> {
        ++i;
    }
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 29</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>you can also use <strong>Recursion</strong></p>

<p>Recursion in java is a process in which a method calls itself continuously. A method in java that calls itself is called recursive method.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 30</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>this might not be the best way, but for most of the small cases this should acceptable:</p>

<blockquote>
  <p><em>"create a second empty-array and add only the ones you want to keep"</em></p>
</blockquote>

<p><sub>I don't remeber where I read this from... for justiness I will make this wiki in hope someone finds it or just to don't earn rep I don't deserve.</sub></p>
    </div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://docs.oracle.com/javase/9/docs/api/java/util/Iterator.html#remove--\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;Iterator.remove()\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; is safe, you can use it like this:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;List\u0026amp;lt;String\u0026amp;gt; list = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;gt;();\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// This is a clever way to create the iterator and call iterator.hasNext() like\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// you would do in a while-loop. It would be the same as doing:\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//     Iterator\u0026amp;lt;String\u0026amp;gt; iterator = list.iterator();\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//     while (iterator.hasNext()) {\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (Iterator\u0026amp;lt;String\u0026amp;gt; iterator = list.iterator(); iterator.hasNext();) {\n    \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;String\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; iterator.next();\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (string.isEmpty()) {\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Remove the current element from the iterator and the list.\u0026lt;/span\u0026gt;\n        iterator.remove();\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Note that \u0026lt;a href=\u0026quot;https://docs.oracle.com/javase/9/docs/api/java/util/Iterator.html#remove--\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;Iterator.remove()\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; is the only safe way to modify a collection during iteration; the behavior is unspecified if the underlying collection is modified \u0026lt;strong\u0026gt;in any other way\u0026lt;/strong\u0026gt; while the iteration is in progress.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Source:\u0026lt;a href=\u0026quot;http://docs.oracle.com/javase/tutorial/collections/interfaces/collection.html\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt; docs.oracle \u0026amp;gt; The Collection Interface\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;And similarly, if you have a \u0026lt;code\u0026gt;ListIterator\u0026lt;/code\u0026gt; and want to \u0026lt;em\u0026gt;add\u0026lt;/em\u0026gt; items, you can use \u0026lt;a href=\u0026quot;http://docs.oracle.com/javase/8/docs/api/java/util/ListIterator.html#add-E-\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;ListIterator#add\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;, for the same reason you can use \u0026lt;code\u0026gt;Iterator#remove\u0026lt;/code\u0026gt;\u0026amp;nbsp; it\u0026apos;s designed to allow it.\u0026lt;/p\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;In your case you tried to remove from a list, but the same restriction applies if trying to \u0026lt;code\u0026gt;put\u0026lt;/code\u0026gt; into a \u0026lt;code\u0026gt;Map\u0026lt;/code\u0026gt; while iterating its content. \u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;This works:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;Iterator\u0026amp;lt;Integer\u0026amp;gt; iter = l.iterator();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt; (iter.hasNext()) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (iter.next() == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;) {\n        iter.remove();\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;I assumed that since a foreach loop is syntactic sugar for iterating, using an iterator wouldn\u0026apos;t help... but it gives you this \u0026lt;code\u0026gt;.remove()\u0026lt;/code\u0026gt; functionality.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;With Java 8 you can use \u0026lt;a href=\u0026quot;http://docs.oracle.com/javase/8/docs/api/java/util/Collection.html#removeIf-java.util.function.Predicate-\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;the new \u0026lt;code\u0026gt;removeIf\u0026lt;/code\u0026gt; method\u0026lt;/a\u0026gt;. Applied to your example:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;Collection\u0026amp;lt;Integer\u0026amp;gt; coll = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;gt;();\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//populate\u0026lt;/span\u0026gt;\n\ncoll.removeIf(i -\u0026amp;gt; i == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Since the question has been already answered i.e. the best way is to use the remove method of the iterator object, I would go into the specifics of the place where the error \u0026lt;code\u0026gt;\u0026quot;java.util.ConcurrentModificationException\u0026quot;\u0026lt;/code\u0026gt; is thrown.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Every collection class has a private class which implements the Iterator interface and provides methods like \u0026lt;code\u0026gt;next()\u0026lt;/code\u0026gt;, \u0026lt;code\u0026gt;remove()\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;hasNext()\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The code for next looks something like this...\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; E \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;next\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; {\n    checkForComodification();\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;try\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;E\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;next\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; get(cursor);\n        lastRet = cursor++;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; next;\n    } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(IndexOutOfBoundsException e) {\n        checkForComodification();\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;throw\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;NoSuchElementException\u0026lt;/span\u0026gt;();\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Here the method \u0026lt;code\u0026gt;checkForComodification\u0026lt;/code\u0026gt; is implemented as \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;final\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;void\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;checkForComodification\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (modCount != expectedModCount)\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;throw\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ConcurrentModificationException\u0026lt;/span\u0026gt;();\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;So, as you can see, if you explicitly try to remove an element from the collection. It results in \u0026lt;code\u0026gt;modCount\u0026lt;/code\u0026gt; getting different from \u0026lt;code\u0026gt;expectedModCount\u0026lt;/code\u0026gt;, resulting in the exception \u0026lt;code\u0026gt;ConcurrentModificationException\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;You can either use the iterator directly like you mentioned, or else keep a second collection and add each item you want to remove to the new collection, then removeAll at the end. This allows you to keep using the type-safety of the for-each loop at the cost of increased memory use and cpu time (shouldn\u0026apos;t be a huge problem unless you have really, really big lists or a really old computer)\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;void\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;(String[] args)\u0026lt;/span\u0026gt;\n{\n    Collection\u0026amp;lt;Integer\u0026amp;gt; l = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;Integer\u0026amp;gt;();\n    Collection\u0026amp;lt;Integer\u0026amp;gt; itemsToRemove = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;gt;();\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; i=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;; i++) {\n        l.add(Integer.of(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;));\n        l.add(Integer.of(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;));\n        l.add(Integer.of(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;6\u0026lt;/span\u0026gt;));\n    }\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (Integer i : l)\n    {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (i.intValue() == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;) {\n            itemsToRemove.add(i);\n        }\n    }\n\n    l.removeAll(itemsToRemove);\n    System.out.println(l);\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In such cases a common trick is (was?) to go backwards:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;i\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; l.size() - \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;; i \u0026amp;gt;= \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i --) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (l.get(i) == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;) {\n    l.remove(i);\n  }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;That said, I\u0026apos;m more than happy that you have better ways in Java 8, e.g. \u0026lt;code\u0026gt;removeIf\u0026lt;/code\u0026gt; or \u0026lt;code\u0026gt;filter\u0026lt;/code\u0026gt; on streams.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Same answer as \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/223927/1433392\u0026quot;\u0026gt;Claudius\u0026lt;/a\u0026gt; with a for loop:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (Iterator\u0026amp;lt;Object\u0026amp;gt; it = objects.iterator(); it.hasNext();) {\n    \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;Object\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;object\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; it.next();\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (test) {\n        it.remove();\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;With \u0026lt;a href=\u0026quot;https://www.eclipse.org/collections/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Eclipse Collections\u0026lt;/a\u0026gt;, the method \u0026lt;code\u0026gt;removeIf\u0026lt;/code\u0026gt; defined on \u0026lt;a href=\u0026quot;https://github.com/eclipse/eclipse-collections/blob/master/eclipse-collections-api/src/main/java/org/eclipse/collections/api/collection/MutableCollection.java#L236\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;MutableCollection\u0026lt;/a\u0026gt; will work:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;MutableList\u0026amp;lt;Integer\u0026amp;gt; list = Lists.mutable.of(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;);\nlist.removeIf(Predicates.lessThan(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;));\nAssert.assertEquals(Lists.mutable.of(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;), list);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;With Java 8 Lambda syntax this can be written as follows:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;MutableList\u0026amp;lt;Integer\u0026amp;gt; list = Lists.mutable.of(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;);\nlist.removeIf(Predicates.cast(integer -\u0026amp;gt; integer \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;));\nAssert.assertEquals(Lists.mutable.of(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;), list);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;The call to \u0026lt;code\u0026gt;Predicates.cast()\u0026lt;/code\u0026gt; is necessary here because a default \u0026lt;code\u0026gt;removeIf\u0026lt;/code\u0026gt; method was added on the \u0026lt;code\u0026gt;java.util.Collection\u0026lt;/code\u0026gt; interface in Java 8. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Note:\u0026lt;/strong\u0026gt; I am a committer for \u0026lt;a href=\u0026quot;https://www.eclipse.org/collections/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Eclipse Collections\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Make a copy of existing list and iterate over new copy.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (String str : \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;String\u0026amp;gt;(listOfStr))     \n{\n    listOfStr.remove(\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/* object reference or index */\u0026lt;/span\u0026gt;);\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;People are asserting one \u0026lt;strong\u0026gt;can\u0026apos;t\u0026lt;/strong\u0026gt; remove from a Collection being iterated by a foreach loop. I just wanted to point out that is \u0026lt;em\u0026gt;technically\u0026lt;/em\u0026gt; incorrect and describe exactly (I know the OP\u0026apos;s question is so advanced as to obviate knowing this) the code behind that assumption:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (TouchableObj obj : untouchedSet) {  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// \u0026amp;lt;--- This is where ConcurrentModificationException strikes\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (obj.isTouched()) {\n        untouchedSet.remove(obj);\n        touchedSt.add(obj);\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;break\u0026lt;/span\u0026gt;;  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// this is key to avoiding returning to the foreach\u0026lt;/span\u0026gt;\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;It isn\u0026apos;t that you can\u0026apos;t remove from the iterated \u0026lt;code\u0026gt;Colletion\u0026lt;/code\u0026gt; rather that you can\u0026apos;t then continue iteration once you do. Hence the \u0026lt;code\u0026gt;break\u0026lt;/code\u0026gt; in the code above.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Apologies if this answer is a somewhat specialist use-case and more suited to the original \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/1110404/remove-elements-from-a-hashset-while-iterating\u0026quot;\u0026gt;thread\u0026lt;/a\u0026gt; I arrived here from, that one is marked as a duplicate (despite this thread appearing more nuanced) of this and locked.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;With a traditional for loop\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;ArrayList\u0026amp;lt;String\u0026amp;gt; myArray = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;gt;();\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;i\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; myArray.size(); ) {\n    \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;String\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;text\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; myArray.get(i);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (someCondition(text))\n        myArray.remove(i);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt;\n        i++;   \n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentHashMap.html\u0026quot; rel=\u0026quot;nofollow\u0026quot;\u0026gt;ConcurrentHashMap\u0026lt;/a\u0026gt; or \u0026lt;a href=\u0026quot;https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentLinkedQueue.html\u0026quot; rel=\u0026quot;nofollow\u0026quot;\u0026gt;ConcurrentLinkedQueue\u0026lt;/a\u0026gt; or \u0026lt;a href=\u0026quot;https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentSkipListMap.html\u0026quot; rel=\u0026quot;nofollow\u0026quot;\u0026gt;ConcurrentSkipListMap\u0026lt;/a\u0026gt; may be another option, because they will never throw any ConcurrentModificationException, even if you remove or add item.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Another way is to use a copy of your arrayList just for iteration:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;List\u0026amp;lt;Object\u0026amp;gt; l = ...\n    \nList\u0026amp;lt;Object\u0026amp;gt; iterationList = ImmutableList.copyOf(l);\n    \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (Object curr : iterationList) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (condition(curr)) {\n        l.remove(curr);\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;A \u0026lt;code\u0026gt;ListIterator\u0026lt;/code\u0026gt; allows you to add or remove items in the list.  Suppose you have a list of \u0026lt;code\u0026gt;Car\u0026lt;/code\u0026gt; objects:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;List\u0026amp;lt;Car\u0026amp;gt; cars = ArrayList\u0026amp;lt;\u0026amp;gt;();\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// add cars here...\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (ListIterator\u0026amp;lt;Car\u0026amp;gt; carIterator = cars.listIterator();  carIterator.hasNext(); )\n{\n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026amp;lt;some-condition\u0026amp;gt;)\n   { \n      carIterator().remove()\n   }\n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026amp;lt;some-other-condition\u0026amp;gt;)\n   { \n      carIterator().add(aNewCar);\n   }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I know this question is too old to be about Java 8, but for those using Java 8 you can easily use removeIf():\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;Collection\u0026amp;lt;Integer\u0026amp;gt; l = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;Integer\u0026amp;gt;();\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; i=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;; ++i) {\n    l.add(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Integer\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;));\n    l.add(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Integer\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;));\n    l.add(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Integer\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;6\u0026lt;/span\u0026gt;));\n}\n\nl.removeIf(i -\u0026amp;gt; i.intValue() == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Now, You can remove with the following code\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;l.removeIf(current -\u0026amp;gt; current == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Java Concurrent Modification Exception\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;Single thread\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;Iterator\u0026amp;lt;String\u0026amp;gt; iterator = list.iterator();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt; (iterator.hasNext()) {\n    \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;String\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; iter.next()\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (value == \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;A\u0026quot;\u0026lt;/span\u0026gt;) {\n        list.remove(it.next()); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//throws ConcurrentModificationException\u0026lt;/span\u0026gt;\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Solution: iterator \u0026lt;code\u0026gt;remove()\u0026lt;/code\u0026gt; method\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;Iterator\u0026amp;lt;String\u0026amp;gt; iterator = list.iterator();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt; (iterator.hasNext()) {\n    \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;String\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; iter.next()\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (value == \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;A\u0026quot;\u0026lt;/span\u0026gt;) {\n        it.remove()\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;ol start=\u0026quot;2\u0026quot;\u0026gt;\n\u0026lt;li\u0026gt;Multi thread\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;copy/convert and iterate over another one collection. For small collections\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;synchronize\u0026lt;/code\u0026gt;\u0026lt;a href=\u0026quot;https://stackoverflow.com/a/59500618/4770877\u0026quot;\u0026gt;\u0026lt;sup\u0026gt;[About]\u0026lt;/sup\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;thread safe collection\u0026lt;a href=\u0026quot;https://stackoverflow.com/a/65410514/4770877\u0026quot;\u0026gt;\u0026lt;sup\u0026gt;[About]\u0026lt;/sup\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I have a suggestion for the problem above. No need of secondary list or any extra time. Please find an example which would do the same stuff but in a different way.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//\u0026quot;list\u0026quot; is ArrayList\u0026amp;lt;Object\u0026amp;gt;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//\u0026quot;state\u0026quot; is some boolean variable, which when set to true, Object will be removed from the list\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;index\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt;(index \u0026amp;lt; list.size()) {\n    \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;Object\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;r\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; list.get(index);\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;( state ) {\n        list.remove(index);\n        index = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;continue\u0026lt;/span\u0026gt;;\n    }\n    index += \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\nThis would avoid the Concurrency Exception.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (Integer i : l)\n{\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (i.intValue() == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;){\n            itemsToRemove.add(i);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;break\u0026lt;/span\u0026gt;;\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;The catch is the after removing the element from the list if you skip the internal iterator.next() call. it still works! Though I dont propose to write code like this it helps to understand the concept behind it :-)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Cheers!\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Example of thread safe collection modification:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Example\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;private\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;final\u0026lt;/span\u0026gt; List\u0026amp;lt;String\u0026amp;gt; queue = Collections.synchronizedList(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;String\u0026amp;gt;());\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;void\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;removeFromQueue\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;synchronized\u0026lt;/span\u0026gt; (queue) {\n            Iterator\u0026amp;lt;String\u0026amp;gt; iterator = queue.iterator();\n            \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;String\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; iterator.next();\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (string.isEmpty()) {\n                iterator.remove();\n            }\n        }\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;One solution could be to rotate the list and remove the first element to avoid the ConcurrentModificationException or IndexOutOfBoundsException\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;n\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; list.size();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; j=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;j\u0026amp;lt;n;j++){\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//you can also put a condition before remove\u0026lt;/span\u0026gt;\n    list.remove(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;);\n    Collections.rotate(list, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;);\n}\nCollections.rotate(list, -\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Try this one (removes all elements in the list that equal \u0026lt;code\u0026gt;i\u0026lt;/code\u0026gt;):\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (Object i : l) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (condition(i)) {\n        l = (l.stream().filter((a) -\u0026amp;gt; a != i)).collect(Collectors.toList());\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;You can use a while loop.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;Iterator\u0026amp;lt;Map.Entry\u0026amp;lt;String, String\u0026amp;gt;\u0026amp;gt; iterator = map.entrySet().iterator();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt;(iterator.hasNext()){\n    Map.Entry\u0026amp;lt;String, String\u0026amp;gt; entry = iterator.next();\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;(entry.getKey().equals(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;test\u0026quot;\u0026lt;/span\u0026gt;)) {\n        iterator.remove();\n    } \n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I ended up with this \u0026lt;code\u0026gt;ConcurrentModificationException\u0026lt;/code\u0026gt;, while iterating the list using \u0026lt;code\u0026gt;stream().map()\u0026lt;/code\u0026gt; method. However the \u0026lt;code\u0026gt;for(:)\u0026lt;/code\u0026gt; did not throw the exception while iterating and modifying the the list.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Here is code snippet , if its of help to anyone:\nhere I\u0026apos;m iterating on a \u0026lt;code\u0026gt;ArrayList\u0026amp;lt;BuildEntity\u0026amp;gt;\u0026lt;/code\u0026gt; , and modifying it using the list.remove(obj)\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(BuildEntity build : uniqueBuildEntities){\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;(build!=\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;){\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;(isBuildCrashedWithErrors(build)){\n                    log.info(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;The following build crashed with errors ,  will not be persisted -\u0026amp;gt; \\n{}\u0026quot;\u0026lt;/span\u0026gt;\n                            ,build.getBuildUrl());\n                    uniqueBuildEntities.remove(build);\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (uniqueBuildEntities.isEmpty()) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt;  EMPTY_LIST;\n                }\n            }\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;(uniqueBuildEntities.size()\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) {\n            dbEntries.addAll(uniqueBuildEntities);\n        }\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;If using HashMap, in newer versions of Java (8+) you can select each of 3 options:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;UserProfileEntity\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;private\u0026lt;/span\u0026gt; String Code;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;private\u0026lt;/span\u0026gt; String mobileNumber;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;private\u0026lt;/span\u0026gt; LocalDateTime inputDT;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// getters and setters here\u0026lt;/span\u0026gt;\n}\nHashMap\u0026amp;lt;String, UserProfileEntity\u0026amp;gt; upMap = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;HashMap\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;gt;();\n\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// remove by value\u0026lt;/span\u0026gt;\nupMap.values().removeIf(value -\u0026amp;gt; !value.getCode().contains(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;0005\u0026quot;\u0026lt;/span\u0026gt;));\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// remove by key\u0026lt;/span\u0026gt;\nupMap.keySet().removeIf(key -\u0026amp;gt; key.contentEquals(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;testUser\u0026quot;\u0026lt;/span\u0026gt;));\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// remove by entry / key + value\u0026lt;/span\u0026gt;\nupMap.entrySet().removeIf(entry -\u0026amp;gt; (entry.getKey().endsWith(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;admin\u0026quot;\u0026lt;/span\u0026gt;) || entry.getValue().getInputDT().isBefore(LocalDateTime.now().minusMinutes(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;)));\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The best way (recommended) is use of \u0026lt;code\u0026gt;java.util.concurrent\u0026lt;/code\u0026gt; package. By\nusing this package you can easily avoid this exception. Refer\nModified Code:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;void\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;(String[] args)\u0026lt;/span\u0026gt; {\n    Collection\u0026amp;lt;Integer\u0026amp;gt; l = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;CopyOnWriteArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;Integer\u0026amp;gt;();\n    \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; i=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;; ++i) {\n        l.add(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Integer\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;));\n        l.add(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Integer\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;));\n        l.add(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Integer\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;6\u0026lt;/span\u0026gt;));\n    }\n    \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (Integer i : l) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (i.intValue() == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;) {\n            l.remove(i);\n        }\n    }\n    \n    System.out.println(l);\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In case \u0026lt;strong\u0026gt;ArrayList:remove(int index)\u0026lt;/strong\u0026gt;- if(index is last element\u0026apos;s position) it avoids without \u0026lt;code\u0026gt;System.arraycopy()\u0026lt;/code\u0026gt; and takes not time for this.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;arraycopy time increases if(index decreases), by the way elements of list also decreases!\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;the best effective remove way is- removing its elements in descending order:\n\u0026lt;code\u0026gt;while(list.size()\u0026amp;gt;0)list.remove(list.size()-1);\u0026lt;/code\u0026gt;//takes O(1)\n\u0026lt;code\u0026gt;while(list.size()\u0026amp;gt;0)list.remove(0);\u0026lt;/code\u0026gt;//takes O(factorial(n))\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//region prepare data\u0026lt;/span\u0026gt;\nArrayList\u0026amp;lt;Integer\u0026amp;gt; ints = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;Integer\u0026amp;gt;();\nArrayList\u0026amp;lt;Integer\u0026amp;gt; toRemove = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;Integer\u0026amp;gt;();\n\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;Random\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;rdm\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Random\u0026lt;/span\u0026gt;();\n\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;long\u0026lt;/span\u0026gt; millis;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;i\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100000\u0026lt;/span\u0026gt;; i++) {\n    \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;Integer\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;integer\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; rdm.nextInt();\n    ints.add(integer);\n}\nArrayList\u0026amp;lt;Integer\u0026amp;gt; intsForIndex = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;Integer\u0026amp;gt;(ints);\nArrayList\u0026amp;lt;Integer\u0026amp;gt; intsDescIndex = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;Integer\u0026amp;gt;(ints);\nArrayList\u0026amp;lt;Integer\u0026amp;gt; intsIterator = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;Integer\u0026amp;gt;(ints);\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//endregion\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// region for index\u0026lt;/span\u0026gt;\nmillis = System.currentTimeMillis();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;i\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; intsForIndex.size(); i++) \n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (intsForIndex.get(i) % \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt; == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) intsForIndex.remove(i--);\nSystem.out.println(System.currentTimeMillis() - millis);\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// endregion\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// region for index desc\u0026lt;/span\u0026gt;\nmillis = System.currentTimeMillis();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;i\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; intsDescIndex.size() - \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;; i \u0026amp;gt;= \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i--) \n   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (intsDescIndex.get(i) % \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt; == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) intsDescIndex.remove(i);\nSystem.out.println(System.currentTimeMillis() - millis);\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//endregion\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// region iterator\u0026lt;/span\u0026gt;\nmillis = System.currentTimeMillis();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (Iterator\u0026amp;lt;Integer\u0026amp;gt; iterator = intsIterator.iterator(); iterator.hasNext(); )\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (iterator.next() % \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt; == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) iterator.remove();\nSystem.out.println(System.currentTimeMillis() - millis);\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//endregion\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;for index loop: 1090 msec\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;for desc index: \u0026lt;strong\u0026gt;519\u0026lt;/strong\u0026gt; msec---the best\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;for iterator: 1043 msec\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I know this question assumes just a \u0026lt;code\u0026gt;Collection\u0026lt;/code\u0026gt;, and not more specifically any \u0026lt;code\u0026gt;List\u0026lt;/code\u0026gt;.  But \u0026lt;strong\u0026gt;for those reading this question who are indeed working with a \u0026lt;code\u0026gt;List\u0026lt;/code\u0026gt; reference, you can avoid \u0026lt;code\u0026gt;ConcurrentModificationException\u0026lt;/code\u0026gt; with a \u0026lt;code\u0026gt;while\u0026lt;/code\u0026gt;-loop (while modifying within it) instead if you want to avoid \u0026lt;code\u0026gt;Iterator\u0026lt;/code\u0026gt;\u0026lt;/strong\u0026gt; (either if you want to avoid it in general, or avoid it specifically to achieve a looping order different from start-to-end stopping at each element [which I believe is the only order \u0026lt;code\u0026gt;Iterator\u0026lt;/code\u0026gt; itself can do]):\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;*Update: See comments below that clarify the analogous is also achievable with the \u0026lt;em\u0026gt;traditional\u0026lt;/em\u0026gt;-for-loop.\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;final\u0026lt;/span\u0026gt; List\u0026amp;lt;Integer\u0026amp;gt; list = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;gt;();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;i\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;; ++i){\n    list.add(i);\n}\n\n\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;i\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt;(i \u0026amp;lt; list.size()){\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;(list.get(i) % \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt; == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;){\n        list.remove(i++);\n\n    } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; {\n        i += \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;;\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;No ConcurrentModificationException from that code.\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;There we see looping not start at the beginning, and not stop at \u0026lt;em\u0026gt;every\u0026lt;/em\u0026gt; element (which I believe \u0026lt;code\u0026gt;Iterator\u0026lt;/code\u0026gt; itself can\u0026apos;t do).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;FWIW we also see \u0026lt;code\u0026gt;get\u0026lt;/code\u0026gt; being called on \u0026lt;code\u0026gt;list\u0026lt;/code\u0026gt;, which could not be done if its reference was just \u0026lt;code\u0026gt;Collection\u0026lt;/code\u0026gt; (instead of the more specific \u0026lt;code\u0026gt;List\u0026lt;/code\u0026gt;-type of \u0026lt;code\u0026gt;Collection\u0026lt;/code\u0026gt;) - \u0026lt;code\u0026gt;List\u0026lt;/code\u0026gt; interface includes \u0026lt;code\u0026gt;get\u0026lt;/code\u0026gt;, but \u0026lt;code\u0026gt;Collection\u0026lt;/code\u0026gt; interface does not.  If not for that difference, then the \u0026lt;code\u0026gt;list\u0026lt;/code\u0026gt; reference could instead be a \u0026lt;code\u0026gt;Collection\u0026lt;/code\u0026gt; [and therefore technically this Answer would then be a direct Answer, instead of a tangential Answer].\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;FWIWW same code still works after modified to start at beginning at stop at every element (just like \u0026lt;code\u0026gt;Iterator\u0026lt;/code\u0026gt; order):\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;final\u0026lt;/span\u0026gt; List\u0026amp;lt;Integer\u0026amp;gt; list = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;gt;();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;i\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;; ++i){\n    list.add(i);\n}\n\n\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;i\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt;(i \u0026amp;lt; list.size()){\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;(list.get(i) % \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt; == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;){\n        list.remove(i);\n\n    } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; {\n        ++i;\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;you can also use \u0026lt;strong\u0026gt;Recursion\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Recursion in java is a process in which a method calls itself continuously. A method in java that calls itself is called recursive method.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;this might not be the best way, but for most of the small cases this should acceptable:\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;\u0026lt;em\u0026gt;\u0026quot;create a second empty-array and add only the ones you want to keep\u0026quot;\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;sub\u0026gt;I don\u0026apos;t remeber where I read this from... for justiness I will make this wiki in hope someone finds it or just to don\u0026apos;t earn rep I don\u0026apos;t deserve.\u0026lt;/sub\u0026gt;\u0026lt;/p\u0026gt;\n    "],"id":219,"title":"Iterating through a Collection, avoiding ConcurrentModificationException when removing objects in a loop","content":"\n                \n\u0026lt;p\u0026gt;We all know you can\u0026apos;t do the following because of \u0026lt;code\u0026gt;ConcurrentModificationException\u0026lt;/code\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (Object i : l) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (condition(i)) {\n        l.remove(i);\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;But this apparently works sometimes, but not always. Here\u0026apos;s some specific code:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;void\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;(String[] args)\u0026lt;/span\u0026gt; {\n    Collection\u0026amp;lt;Integer\u0026amp;gt; l = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ArrayList\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;gt;();\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;i\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;; ++i) {\n        l.add(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;);\n        l.add(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;);\n        l.add(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;6\u0026lt;/span\u0026gt;);\n    }\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; i : l) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (i == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;) {\n            l.remove(i);\n        }\n    }\n\n    System.out.println(l);\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;This, of course, results in:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-java s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-java\u0026quot;\u0026gt;Exception in thread \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;main\u0026quot;\u0026lt;/span\u0026gt; java.util.ConcurrentModificationException\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Even though multiple threads aren\u0026apos;t doing it. Anyway.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;What\u0026apos;s the best solution to this problem? How can I remove an item from the collection in a loop without throwing this exception?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I\u0026apos;m also using an arbitrary \u0026lt;code\u0026gt;Collection\u0026lt;/code\u0026gt; here, not necessarily an \u0026lt;code\u0026gt;ArrayList\u0026lt;/code\u0026gt;, so you can\u0026apos;t rely on \u0026lt;code\u0026gt;get\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n    ","slug":"iterating-through-a-collection-avoiding-concurrentmodificationexception-when-removing-objects-in-a-loop-1657387311824","postType":"QUESTION","createdAt":"2022-07-09T17:21:51.000Z","updatedAt":"2022-07-09T17:21:51.000Z","tags":[{"id":1505,"name":"collections","slug":"collections","createdAt":"2022-07-09T17:21:51.000Z","updatedAt":"2022-07-09T17:21:51.000Z","Questions_Tags":{"questionId":219,"tagId":1505}}]}},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"iterating-through-a-collection-avoiding-concurrentmodificationexception-when-removing-objects-in-a-loop-1657387311824"},"buildId":"B9ZMQqRLGvIP-RcWN9dT2","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>