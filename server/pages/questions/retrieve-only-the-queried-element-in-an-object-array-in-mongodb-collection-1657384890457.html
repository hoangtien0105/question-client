<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2eccd4d47c856f2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2eccd4d47c856f2b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-20edbe0b078add93.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/613-1e0aa2b2023820bb.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/471-84c36aa98dd4107c.js" defer=""></script><script src="/_next/static/chunks/81-096e453de8a27667.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-e3d1b60e109d3ba1.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_buildManifest.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">.hFcsiD code{padding:5px;color:hsl(210deg 8% 15%);background-color:hsl(210deg 8% 90%);border-radius:3px;}/*!sc*/
data-styled.g5[id="sc-6e32c308-0"]{content:"hFcsiD,"}/*!sc*/
.ljvTUN .comment-item .comment-body .d-inline-flex.ai-center{text-align:right;}/*!sc*/
.ljvTUN .comment-item .comment-body .comment-date{float:right;}/*!sc*/
data-styled.g6[id="sc-6e32c308-1"]{content:"ljvTUN,"}/*!sc*/
</style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="https://flowbite.com/docs/images/logo.svg" class="mr-3 h-6 sm:h-9" alt="Flowbite Logo"/><span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Hunter</span></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/retrieve-only-the-queried-element-in-an-object-array-in-mongodb-collection-1657384890457#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="sc-6e32c308-0 hFcsiD flex question-header items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/retrieve-only-the-queried-element-in-an-object-array-in-mongodb-collection-1657384890457">Retrieve only the queried element in an object array in MongoDB collection</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/mongodb">mongodb</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/mongodb-query">mongodb-query</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/aggregation-framework">aggregation-framework</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/projection">projection</a></div></div><div class="question-content mt-5">
                


<p>Suppose you have the following documents in my collection:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">{  
   <span class="hljs-string">"_id"</span>:<span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"562e7c594c12942f08fe4192"</span>),
   <span class="hljs-string">"shapes"</span>:[  
      {  
         <span class="hljs-string">"shape"</span>:<span class="hljs-string">"square"</span>,
         <span class="hljs-string">"color"</span>:<span class="hljs-string">"blue"</span>
      },
      {  
         <span class="hljs-string">"shape"</span>:<span class="hljs-string">"circle"</span>,
         <span class="hljs-string">"color"</span>:<span class="hljs-string">"red"</span>
      }
   ]
},
{  
   <span class="hljs-string">"_id"</span>:<span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"562e7c594c12942f08fe4193"</span>),
   <span class="hljs-string">"shapes"</span>:[  
      {  
         <span class="hljs-string">"shape"</span>:<span class="hljs-string">"square"</span>,
         <span class="hljs-string">"color"</span>:<span class="hljs-string">"black"</span>
      },
      {  
         <span class="hljs-string">"shape"</span>:<span class="hljs-string">"circle"</span>,
         <span class="hljs-string">"color"</span>:<span class="hljs-string">"green"</span>
      }
   ]
}
</code></pre>

<hr>

<p>Do query:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>({<span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>}, {<span class="hljs-string">"shapes.color"</span>: <span class="hljs-number">1</span>})
</code></pre>

<p>Or</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>({<span class="hljs-attr">shapes</span>: {<span class="hljs-string">"$elemMatch"</span>: {<span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>}}}, {<span class="hljs-string">"shapes.color"</span>: <span class="hljs-number">1</span>})
</code></pre>

<hr>

<p>Returns matched document <em>(Document 1)</em>, but always with ALL array items in <code>shapes</code>:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">{ <span class="hljs-string">"shapes"</span>: 
  [
    {<span class="hljs-string">"shape"</span>: <span class="hljs-string">"square"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"blue"</span>},
    {<span class="hljs-string">"shape"</span>: <span class="hljs-string">"circle"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"red"</span>}
  ] 
}
</code></pre>

<p>However, I'd like to get the document <em>(Document 1)</em> only with the array that contains <code>color=red</code>:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">{ <span class="hljs-string">"shapes"</span>: 
  [
    {<span class="hljs-string">"shape"</span>: <span class="hljs-string">"circle"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"red"</span>}
  ] 
}
</code></pre>

<p>How can I do this?</p>
    </div></div></div><div class="sc-6e32c308-1 ljvTUN flex text-xs pl-10 flex-col comment items-center justify-center"><h4 class="text-left mt-10 text-lg font-semibold">Comments</h4><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">any solution if I want it to return every elements that matches it instead of just the first?</span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/2023657/steve-ng" title="1,169 reputation" class="comment-user">Steve Ng</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment31131207_12241930"><span title="2013-12-25 08:12:53Z, License: CC BY-SA 3.0" class="relativetime-clean">Dec 25, 2013 at 8:12</span></a></span>
            </div>
        </div><span class="divide-x-8 "></span><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">I'm afraid I am using <b>Mongo 3.0.X</b> :-(</span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/3023947/charliebrownie" title="5,289 reputation" class="comment-user">charliebrownie</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment57167028_12241930"><span title="2016-01-10 20:33:49Z, License: CC BY-SA 3.0" class="relativetime-clean">Jan 10, 2016 at 20:33</span></a></span>
                        <span title="this comment was edited 1 time">
                            <svg aria-hidden="true" class="va-text-bottom o50 svg-icon iconPencilSm" width="14" height="14" viewBox="0 0 14 14"><path d="m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z"></path></svg>
                        </span>
            </div>
        </div><span class="divide-x-8 "></span><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">@charliebrownie Then use one of the other answers that use <code>aggregate</code>.</span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/1259510/johnnyhk" title="292,048 reputation" class="comment-user">JohnnyHK</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment57167874_12241930"><span title="2016-01-10 21:14:50Z, License: CC BY-SA 3.0" class="relativetime-clean">Jan 10, 2016 at 21:14</span></a></span>
            </div>
        </div><span class="divide-x-8 "></span><button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">See more</button></div><div class="sc-6e32c308-2 bFXWFO"><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>MongoDB 2.2's new <a href="http://docs.mongodb.org/manual/reference/projection/elemMatch/" rel="noreferrer"><code>$elemMatch</code></a> projection operator provides another way to alter the returned document to contain only the <strong><em>first</em></strong> matched <code>shapes</code> element:</p>



<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>(
    {<span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>}, 
    {<span class="hljs-attr">_id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">shapes</span>: {<span class="hljs-attr">$elemMatch</span>: {<span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>}}});
</code></pre>

<p>Returns:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">{<span class="hljs-string">"shapes"</span> : [{<span class="hljs-string">"shape"</span>: <span class="hljs-string">"circle"</span>, <span class="hljs-string">"color"</span>: <span class="hljs-string">"red"</span>}]}
</code></pre>

<p>In 2.2 you can also do this using the <a href="http://docs.mongodb.org/manual/reference/operator/projection/positional/#proj._S_" rel="noreferrer"><code>$ projection operator</code></a>, where the <code>$</code> in a projection object field name represents the index of the field's first matching array element from the query.  The following returns the same results as above:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>({<span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>}, {<span class="hljs-attr">_id</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'shapes.$'</span>: <span class="hljs-number">1</span>});
</code></pre>

<p><strong>MongoDB 3.2 Update</strong></p>

<p>Starting with the 3.2 release, you can use the new <a href="https://docs.mongodb.org/master/reference/operator/aggregation/filter/#exp._S_filter" rel="noreferrer"><code>$filter</code></a> aggregation operator to filter an array during projection, which has the benefit of including <em>all</em> matches, instead of just the first one.</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">aggregate</span>([
    <span class="hljs-comment">// Get just the docs that contain a shapes element where color is 'red'</span>
    {<span class="hljs-attr">$match</span>: {<span class="hljs-string">'shapes.color'</span>: <span class="hljs-string">'red'</span>}},
    {<span class="hljs-attr">$project</span>: {
        <span class="hljs-attr">shapes</span>: {<span class="hljs-attr">$filter</span>: {
            <span class="hljs-attr">input</span>: <span class="hljs-string">'$shapes'</span>,
            <span class="hljs-attr">as</span>: <span class="hljs-string">'shape'</span>,
            <span class="hljs-attr">cond</span>: {<span class="hljs-attr">$eq</span>: [<span class="hljs-string">'$$shape.color'</span>, <span class="hljs-string">'red'</span>]}
        }},
        <span class="hljs-attr">_id</span>: <span class="hljs-number">0</span>
    }}
])
</code></pre>

<p>Results:</p>

<pre class="lang-javascript s-code-block"><code class="hljs language-javascript">[ 
    {
        <span class="hljs-string">"shapes"</span> : [ 
            {
                <span class="hljs-string">"shape"</span> : <span class="hljs-string">"circle"</span>,
                <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>
            }
        ]
    }
]
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The new <a href="http://docs.mongodb.org/manual/applications/aggregation/">Aggregation Framework</a> in MongoDB 2.2+ provides an alternative to Map/Reduce.  The <a href="http://docs.mongodb.org/manual/reference/aggregation/unwind/#_S_unwind"><code>$unwind</code></a> operator can be used to separate your <code>shapes</code> array into a stream of documents that can be matched:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">aggregate</span>(
  <span class="hljs-comment">// Start with a $match pipeline which can take advantage of an index and limit documents processed</span>
  { $match : {
     <span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>
  }},
  { $unwind : <span class="hljs-string">"$shapes"</span> },
  { $match : {
     <span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>
  }}
)
</code></pre>

<p>Results in:</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">{
    <span class="hljs-string">"result"</span> : [
        {
            <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"504425059b7c9fa7ec92beec"</span>),
            <span class="hljs-string">"shapes"</span> : {
                <span class="hljs-string">"shape"</span> : <span class="hljs-string">"circle"</span>,
                <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>
            }
        }
    ],
    <span class="hljs-string">"ok"</span> : <span class="hljs-number">1</span>
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<blockquote>
  <p><strong>Caution:</strong> This answer provides a solution that was relevant <em>at that time</em>, before the new features of MongoDB 2.2 and up were introduced. See the other answers if you are using a more recent version of MongoDB.</p>
</blockquote>

<p>The field selector parameter is limited to complete properties. It cannot be used to select part of an array, only the entire array. I tried using the <a href="http://www.mongodb.org/display/DOCS/Updating#Updating-The%24positionaloperator" rel="noreferrer">$ positional operator</a>, but that didn't work.</p>

<p>The easiest way is to just filter the shapes <strong>in the client</strong>.</p>

<p>If you really <em>need</em> the correct output directly from MongoDB, you can <strong>use a map-reduce</strong> to filter the shapes.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">map</span>(<span class="hljs-params"></span>) {
  filteredShapes = [];

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">shapes</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">s</span>) {
    <span class="hljs-keyword">if</span> (s.<span class="hljs-property">color</span> === <span class="hljs-string">"red"</span>) {
      filteredShapes.<span class="hljs-title function_">push</span>(s);
    }
  });

  <span class="hljs-title function_">emit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_id</span>, { <span class="hljs-attr">shapes</span>: filteredShapes });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">reduce</span>(<span class="hljs-params">key, values</span>) {
  <span class="hljs-keyword">return</span> values[<span class="hljs-number">0</span>];
}

res = db.<span class="hljs-property">test</span>.<span class="hljs-title function_">mapReduce</span>(map, reduce, { <span class="hljs-attr">query</span>: { <span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span> } })

db[res.<span class="hljs-property">result</span>].<span class="hljs-title function_">find</span>()
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Another interesing way is to use <a href="http://docs.mongodb.org/manual/reference/operator/aggregation/redact/"><strong>$redact</strong></a>, which is one of the new aggregation features of <strong>MongoDB 2.6</strong>. If you are using 2.6, you don't need an $unwind which might cause you performance problems if you have large arrays. </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">aggregate</span>([
    { <span class="hljs-attr">$match</span>: { 
         <span class="hljs-attr">shapes</span>: { <span class="hljs-attr">$elemMatch</span>: {<span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>} } 
    }},
    { $redact : {
         <span class="hljs-attr">$cond</span>: {
             <span class="hljs-attr">if</span>: { $or : [{ <span class="hljs-attr">$eq</span>: [<span class="hljs-string">"$color"</span>,<span class="hljs-string">"red"</span>] }, { $not : <span class="hljs-string">"$color"</span> }]},
             <span class="hljs-attr">then</span>: <span class="hljs-string">"$$DESCEND"</span>,
             <span class="hljs-attr">else</span>: <span class="hljs-string">"$$PRUNE"</span>
         }
    }}]);
</code></pre>

<p><code>$redact</code> <em>"restricts the contents of the documents based on information stored in the documents themselves"</em>. So it will run only <em>inside of the document</em>. It basically scans your document top to the bottom, and checks if it matches with your <code>if</code> condition which is in <code>$cond</code>, if there is match it will either keep the content(<code>$$DESCEND</code>) or remove(<code>$$PRUNE</code>).</p>

<p>In the example  above, first <code>$match</code> returns the whole <code>shapes</code> array, and $redact strips it down to the expected result. </p>

<p>Note that <code>{$not:"$color"}</code> is necessary, because it will scan the top document as well, and if <code>$redact</code> does not find a <code>color</code> field on the top level this will return <code>false</code> that might strip the whole document which we don't want. </p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Better you can query in matching array element using <code>$slice</code> is it helpful to returning the significant object in an array.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>({<span class="hljs-string">"shapes.color"</span> : <span class="hljs-string">"blue"</span>}, {<span class="hljs-string">"shapes.$"</span> : <span class="hljs-number">1</span>})
</code></pre>

<p><code>$slice</code> is helpful when you know the index of the element, but sometimes you want
whichever array element matched your criteria. You can return the matching element
with the <code>$</code> operator.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<pre class="lang-js s-code-block"><code class="hljs language-javascript"> db.<span class="hljs-title function_">getCollection</span>(<span class="hljs-string">'aj'</span>).<span class="hljs-title function_">find</span>({<span class="hljs-string">"shapes.color"</span>:<span class="hljs-string">"red"</span>},{<span class="hljs-string">"shapes.$"</span>:<span class="hljs-number">1</span>})
</code></pre>

<p><em>OUTPUTS</em></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">{

   <span class="hljs-string">"shapes"</span> : [ 
       {
           <span class="hljs-string">"shape"</span> : <span class="hljs-string">"circle"</span>,
           <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>
       }
   ]
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 7</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The syntax for find in mongodb is </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">    db.&lt;collection name&gt;.<span class="hljs-title function_">find</span>(query, projection);
</code></pre>

<p>and the second query that you have written, that is</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">    db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>(
    {<span class="hljs-attr">shapes</span>: {<span class="hljs-string">"$elemMatch"</span>: {<span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>}}}, 
    {<span class="hljs-string">"shapes.color"</span>:<span class="hljs-number">1</span>})
</code></pre>

<p>in this you have used the <code>$elemMatch</code> operator in query part, whereas if you use this operator in the projection part then you will get the desired result. You can write down your query as </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">     db.<span class="hljs-property">users</span>.<span class="hljs-title function_">find</span>(
     {<span class="hljs-string">"shapes.color"</span>:<span class="hljs-string">"red"</span>},
     {<span class="hljs-attr">_id</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">shapes</span>: {$elemMatch : {<span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>}}})
</code></pre>

<p>This will give you the desired result.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 8</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<h2>Thanks to <em><a href="https://stackoverflow.com/users/1259510/johnnyhk">JohnnyHK</a></em>.</h2>

<p>Here I just want to add some more complex usage.</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-comment">// Document </span>
{ 
<span class="hljs-string">"_id"</span> : <span class="hljs-number">1</span>
<span class="hljs-string">"shapes"</span> : [
  {<span class="hljs-string">"shape"</span> : <span class="hljs-string">"square"</span>,  <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>},
  {<span class="hljs-string">"shape"</span> : <span class="hljs-string">"circle"</span>,  <span class="hljs-string">"color"</span> : <span class="hljs-string">"green"</span>}
  ] 
} 

{ 
<span class="hljs-string">"_id"</span> : <span class="hljs-number">2</span>
<span class="hljs-string">"shapes"</span> : [
  {<span class="hljs-string">"shape"</span> : <span class="hljs-string">"square"</span>,  <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>},
  {<span class="hljs-string">"shape"</span> : <span class="hljs-string">"circle"</span>,  <span class="hljs-string">"color"</span> : <span class="hljs-string">"green"</span>}
  ] 
} 


<span class="hljs-comment">// The Query   </span>
db.<span class="hljs-property">contents</span>.<span class="hljs-title function_">find</span>({
    <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-number">1</span>),
    <span class="hljs-string">"shapes.color"</span>:<span class="hljs-string">"red"</span>
},{
    <span class="hljs-string">"_id"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-string">"shapes"</span> :{
       <span class="hljs-string">"$elemMatch"</span>:{
           <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>
       } 
    }
}) 


<span class="hljs-comment">//And the Result</span>

{<span class="hljs-string">"shapes"</span>:[
    {
       <span class="hljs-string">"shape"</span> : <span class="hljs-string">"square"</span>,
       <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>
    }
]}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 9</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You just need to run query</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>(
{<span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>}, 
{<span class="hljs-attr">shapes</span>: {<span class="hljs-attr">$elemMatch</span>: {<span class="hljs-attr">color</span>: <span class="hljs-string">"red"</span>}}});
</code></pre>

<p>output of this query is</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">{
    <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"562e7c594c12942f08fe4192"</span>),
    <span class="hljs-string">"shapes"</span> : [ 
        {<span class="hljs-string">"shape"</span> : <span class="hljs-string">"circle"</span>, <span class="hljs-string">"color"</span> : <span class="hljs-string">"red"</span>}
    ]
}
</code></pre>

<p>as you expected it'll gives the exact field from array that matches color:'red'.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 10</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Along with  <code>$project</code> it will be more appropriate  other wise matching elements will be clubbed together with other elements in document.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">aggregate</span>(
  { <span class="hljs-string">"$unwind"</span> : <span class="hljs-string">"$shapes"</span> },
  { <span class="hljs-string">"$match"</span> : { <span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span> } },
  { 
    <span class="hljs-string">"$project"</span>: {
      <span class="hljs-string">"_id"</span>:<span class="hljs-number">1</span>,
      <span class="hljs-string">"item"</span>:<span class="hljs-number">1</span>
    }
  }
)
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 11</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Likewise you can find for the multiple</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-title function_">getCollection</span>(<span class="hljs-string">'localData'</span>).<span class="hljs-title function_">aggregate</span>([
    <span class="hljs-comment">// Get just the docs that contain a shapes element where color is 'red'</span>
  {<span class="hljs-attr">$match</span>: {<span class="hljs-string">'shapes.color'</span>: {$in : [<span class="hljs-string">'red'</span>,<span class="hljs-string">'yellow'</span>] } }},
  {<span class="hljs-attr">$project</span>: {
     <span class="hljs-attr">shapes</span>: {<span class="hljs-attr">$filter</span>: {
        <span class="hljs-attr">input</span>: <span class="hljs-string">'$shapes'</span>,
        <span class="hljs-attr">as</span>: <span class="hljs-string">'shape'</span>,
        <span class="hljs-attr">cond</span>: {<span class="hljs-attr">$in</span>: [<span class="hljs-string">'$$shape.color'</span>, [<span class="hljs-string">'red'</span>, <span class="hljs-string">'yellow'</span>]]}
     }}
  }}
])
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 12</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">test</span>.<span class="hljs-title function_">find</span>( {<span class="hljs-string">"shapes.color"</span>: <span class="hljs-string">"red"</span>}, {<span class="hljs-attr">_id</span>: <span class="hljs-number">0</span>})
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 13</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Use aggregation function and <code>$project</code> to get specific object field in document</p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-title function_">getCollection</span>(<span class="hljs-string">'geolocations'</span>).<span class="hljs-title function_">aggregate</span>([ { $project : { geolocation : <span class="hljs-number">1</span>} } ])
</code></pre>

<p><strong>result:</strong></p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">{
    <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"5e3ee15968879c0d5942464b"</span>),
    <span class="hljs-string">"geolocation"</span> : [ 
        {
            <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"5e3ee3ee68879c0d5942465e"</span>),
            <span class="hljs-string">"latitude"</span> : <span class="hljs-number">12.9718313</span>,
            <span class="hljs-string">"longitude"</span> : <span class="hljs-number">77.593551</span>,
            <span class="hljs-string">"country"</span> : <span class="hljs-string">"India"</span>,
            <span class="hljs-string">"city"</span> : <span class="hljs-string">"Chennai"</span>,
            <span class="hljs-string">"zipcode"</span> : <span class="hljs-string">"560001"</span>,
            <span class="hljs-string">"streetName"</span> : <span class="hljs-string">"Sidney Road"</span>,
            <span class="hljs-string">"countryCode"</span> : <span class="hljs-string">"in"</span>,
            <span class="hljs-string">"ip"</span> : <span class="hljs-string">"116.75.115.248"</span>,
            <span class="hljs-string">"date"</span> : <span class="hljs-title class_">ISODate</span>(<span class="hljs-string">"2020-02-08T16:38:06.584Z"</span>)
        }
    ]
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 14</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Although the question was asked 9.6 years ago, this has been of immense help to numerous people, me being one of them. Thank you everyone for all your queries, hints and answers. Picking up from one of the answers here.. I found that the following method can also be used to project other fields in the parent document.This may be helpful to someone. </p>

<p>For the following document, the need was to find out if an employee (emp #7839) has his leave history set for the year 2020. Leave history is implemented as an embedded document within the parent Employee document. </p>

<pre class="lang-js s-code-block"><code class="hljs language-javascript">db.<span class="hljs-property">employees</span>.<span class="hljs-title function_">find</span>( {<span class="hljs-string">"leave_history.calendar_year"</span>: <span class="hljs-number">2020</span>}, 
    {<span class="hljs-attr">leave_history</span>: {<span class="hljs-attr">$elemMatch</span>: {<span class="hljs-attr">calendar_year</span>: <span class="hljs-number">2020</span>}},<span class="hljs-attr">empno</span>:<span class="hljs-literal">true</span>,<span class="hljs-attr">ename</span>:<span class="hljs-literal">true</span>}).<span class="hljs-title function_">pretty</span>(<span class="hljs-params"></span>)


{
        <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"5e907ad23997181dde06e8fc"</span>),
        <span class="hljs-string">"empno"</span> : <span class="hljs-number">7839</span>,
        <span class="hljs-string">"ename"</span> : <span class="hljs-string">"KING"</span>,
        <span class="hljs-string">"mgrno"</span> : <span class="hljs-number">0</span>,
        <span class="hljs-string">"hiredate"</span> : <span class="hljs-string">"1990-05-09"</span>,
        <span class="hljs-string">"sal"</span> : <span class="hljs-number">100000</span>,
        <span class="hljs-string">"deptno"</span> : {
                <span class="hljs-string">"_id"</span> : <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">"5e9065f53997181dde06e8f8"</span>)
        },
        <span class="hljs-string">"username"</span> : <span class="hljs-string">"none"</span>,
        <span class="hljs-string">"password"</span> : <span class="hljs-string">"none"</span>,
        <span class="hljs-string">"is_admin"</span> : <span class="hljs-string">"N"</span>,
        <span class="hljs-string">"is_approver"</span> : <span class="hljs-string">"Y"</span>,
        <span class="hljs-string">"is_manager"</span> : <span class="hljs-string">"Y"</span>,
        <span class="hljs-string">"user_role"</span> : <span class="hljs-string">"AP"</span>,
        <span class="hljs-string">"admin_approval_received"</span> : <span class="hljs-string">"Y"</span>,
        <span class="hljs-string">"active"</span> : <span class="hljs-string">"Y"</span>,
        <span class="hljs-string">"created_date"</span> : <span class="hljs-string">"2020-04-10"</span>,
        <span class="hljs-string">"updated_date"</span> : <span class="hljs-string">"2020-04-10"</span>,
        <span class="hljs-string">"application_usage_log"</span> : [
                {
                        <span class="hljs-string">"logged_in_as"</span> : <span class="hljs-string">"AP"</span>,
                        <span class="hljs-string">"log_in_date"</span> : <span class="hljs-string">"2020-04-10"</span>
                },
                {
                        <span class="hljs-string">"logged_in_as"</span> : <span class="hljs-string">"EM"</span>,
                        <span class="hljs-string">"log_in_date"</span> : <span class="hljs-title class_">ISODate</span>(<span class="hljs-string">"2020-04-16T07:28:11.959Z"</span>)
                }
        ],
        <span class="hljs-string">"leave_history"</span> : [
                {
                        <span class="hljs-string">"calendar_year"</span> : <span class="hljs-number">2020</span>,
                        <span class="hljs-string">"pl_used"</span> : <span class="hljs-number">0</span>,
                        <span class="hljs-string">"cl_used"</span> : <span class="hljs-number">0</span>,
                        <span class="hljs-string">"sl_used"</span> : <span class="hljs-number">0</span>
                },
                {
                        <span class="hljs-string">"calendar_year"</span> : <span class="hljs-number">2021</span>,
                        <span class="hljs-string">"pl_used"</span> : <span class="hljs-number">0</span>,
                        <span class="hljs-string">"cl_used"</span> : <span class="hljs-number">0</span>,
                        <span class="hljs-string">"sl_used"</span> : <span class="hljs-number">0</span>
                }
        ]
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 15</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>if you want to do <strong>filter, set and find</strong> at the same time.</p>
<pre class="lang-js s-code-block"><code class="hljs language-javascript"><span class="hljs-keyword">let</span> post = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Post</span>.<span class="hljs-title function_">findOneAndUpdate</span>(
          {
            <span class="hljs-attr">_id</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>,
            <span class="hljs-attr">tasks</span>: {
              <span class="hljs-attr">$elemMatch</span>: {
                <span class="hljs-attr">id</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">jobId</span>,
                date,
              },
            },
          },
          {
            <span class="hljs-attr">$set</span>: {
              <span class="hljs-string">'jobs.$[i].performer'</span>: performer,
              <span class="hljs-string">'jobs.$[i].status'</span>: status,
              <span class="hljs-string">'jobs.$[i].type'</span>: type,
            },
          },
          {
            <span class="hljs-attr">arrayFilters</span>: [
              {
                <span class="hljs-string">'i.id'</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">jobId</span>,
              },
            ],
            <span class="hljs-attr">new</span>: <span class="hljs-literal">true</span>,
          }
        );
</code></pre>
    </div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;MongoDB 2.2\u0026apos;s new \u0026lt;a href=\u0026quot;http://docs.mongodb.org/manual/reference/projection/elemMatch/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;$elemMatch\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; projection operator provides another way to alter the returned document to contain only the \u0026lt;strong\u0026gt;\u0026lt;em\u0026gt;first\u0026lt;/em\u0026gt;\u0026lt;/strong\u0026gt; matched \u0026lt;code\u0026gt;shapes\u0026lt;/code\u0026gt; element:\u0026lt;/p\u0026gt;\n\n\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;(\n    {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}, \n    {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$elemMatch\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}}});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Returns:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : [{\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}]}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;In 2.2 you can also do this using the \u0026lt;a href=\u0026quot;http://docs.mongodb.org/manual/reference/operator/projection/positional/#proj._S_\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;$ projection operator\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;, where the \u0026lt;code\u0026gt;$\u0026lt;/code\u0026gt; in a projection object field name represents the index of the field\u0026apos;s first matching array element from the query.  The following returns the same results as above:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;({\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}, {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;shapes.$\u0026apos;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;MongoDB 3.2 Update\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Starting with the 3.2 release, you can use the new \u0026lt;a href=\u0026quot;https://docs.mongodb.org/master/reference/operator/aggregation/filter/#exp._S_filter\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;$filter\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; aggregation operator to filter an array during projection, which has the benefit of including \u0026lt;em\u0026gt;all\u0026lt;/em\u0026gt; matches, instead of just the first one.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;aggregate\u0026lt;/span\u0026gt;([\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Get just the docs that contain a shapes element where color is \u0026apos;red\u0026apos;\u0026lt;/span\u0026gt;\n    {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$match\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;shapes.color\u0026apos;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;red\u0026apos;\u0026lt;/span\u0026gt;}},\n    {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$project\u0026lt;/span\u0026gt;: {\n        \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$filter\u0026lt;/span\u0026gt;: {\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;input\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$shapes\u0026apos;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;shape\u0026apos;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;cond\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$eq\u0026lt;/span\u0026gt;: [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$$shape.color\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;red\u0026apos;\u0026lt;/span\u0026gt;]}\n        }},\n        \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n    }}\n])\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Results:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;[ \n    {\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : [ \n            {\n                \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,\n                \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n            }\n        ]\n    }\n]\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The new \u0026lt;a href=\u0026quot;http://docs.mongodb.org/manual/applications/aggregation/\u0026quot;\u0026gt;Aggregation Framework\u0026lt;/a\u0026gt; in MongoDB 2.2+ provides an alternative to Map/Reduce.  The \u0026lt;a href=\u0026quot;http://docs.mongodb.org/manual/reference/aggregation/unwind/#_S_unwind\u0026quot;\u0026gt;\u0026lt;code\u0026gt;$unwind\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; operator can be used to separate your \u0026lt;code\u0026gt;shapes\u0026lt;/code\u0026gt; array into a stream of documents that can be matched:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;aggregate\u0026lt;/span\u0026gt;(\n  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Start with a $match pipeline which can take advantage of an index and limit documents processed\u0026lt;/span\u0026gt;\n  { $match : {\n     \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n  }},\n  { $unwind : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$shapes\u0026quot;\u0026lt;/span\u0026gt; },\n  { $match : {\n     \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n  }}\n)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Results in:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;result\u0026quot;\u0026lt;/span\u0026gt; : [\n        {\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;504425059b7c9fa7ec92beec\u0026quot;\u0026lt;/span\u0026gt;),\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : {\n                \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,\n                \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n            }\n        }\n    ],\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ok\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Caution:\u0026lt;/strong\u0026gt; This answer provides a solution that was relevant \u0026lt;em\u0026gt;at that time\u0026lt;/em\u0026gt;, before the new features of MongoDB 2.2 and up were introduced. See the other answers if you are using a more recent version of MongoDB.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;The field selector parameter is limited to complete properties. It cannot be used to select part of an array, only the entire array. I tried using the \u0026lt;a href=\u0026quot;http://www.mongodb.org/display/DOCS/Updating#Updating-The%24positionaloperator\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;$ positional operator\u0026lt;/a\u0026gt;, but that didn\u0026apos;t work.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The easiest way is to just filter the shapes \u0026lt;strong\u0026gt;in the client\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;If you really \u0026lt;em\u0026gt;need\u0026lt;/em\u0026gt; the correct output directly from MongoDB, you can \u0026lt;strong\u0026gt;use a map-reduce\u0026lt;/strong\u0026gt; to filter the shapes.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;map\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) {\n  filteredShapes = [];\n\n  \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;forEach\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;s\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (s.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt; === \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;) {\n      filteredShapes.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;push\u0026lt;/span\u0026gt;(s);\n    }\n  });\n\n  \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;emit\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;, { \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: filteredShapes });\n}\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;reduce\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;key, values\u0026lt;/span\u0026gt;) {\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; values[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;];\n}\n\nres = db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;mapReduce\u0026lt;/span\u0026gt;(map, reduce, { \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;query\u0026lt;/span\u0026gt;: { \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt; } })\n\ndb[res.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;result\u0026lt;/span\u0026gt;].\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;()\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Another interesing way is to use \u0026lt;a href=\u0026quot;http://docs.mongodb.org/manual/reference/operator/aggregation/redact/\u0026quot;\u0026gt;\u0026lt;strong\u0026gt;$redact\u0026lt;/strong\u0026gt;\u0026lt;/a\u0026gt;, which is one of the new aggregation features of \u0026lt;strong\u0026gt;MongoDB 2.6\u0026lt;/strong\u0026gt;. If you are using 2.6, you don\u0026apos;t need an $unwind which might cause you performance problems if you have large arrays. \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;aggregate\u0026lt;/span\u0026gt;([\n    { \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$match\u0026lt;/span\u0026gt;: { \n         \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: { \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$elemMatch\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;} } \n    }},\n    { $redact : {\n         \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$cond\u0026lt;/span\u0026gt;: {\n             \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;: { $or : [{ \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$eq\u0026lt;/span\u0026gt;: [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$color\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;] }, { $not : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$color\u0026quot;\u0026lt;/span\u0026gt; }]},\n             \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;then\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$$DESCEND\u0026quot;\u0026lt;/span\u0026gt;,\n             \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$$PRUNE\u0026quot;\u0026lt;/span\u0026gt;\n         }\n    }}]);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;$redact\u0026lt;/code\u0026gt; \u0026lt;em\u0026gt;\u0026quot;restricts the contents of the documents based on information stored in the documents themselves\u0026quot;\u0026lt;/em\u0026gt;. So it will run only \u0026lt;em\u0026gt;inside of the document\u0026lt;/em\u0026gt;. It basically scans your document top to the bottom, and checks if it matches with your \u0026lt;code\u0026gt;if\u0026lt;/code\u0026gt; condition which is in \u0026lt;code\u0026gt;$cond\u0026lt;/code\u0026gt;, if there is match it will either keep the content(\u0026lt;code\u0026gt;$$DESCEND\u0026lt;/code\u0026gt;) or remove(\u0026lt;code\u0026gt;$$PRUNE\u0026lt;/code\u0026gt;).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;In the example  above, first \u0026lt;code\u0026gt;$match\u0026lt;/code\u0026gt; returns the whole \u0026lt;code\u0026gt;shapes\u0026lt;/code\u0026gt; array, and $redact strips it down to the expected result. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Note that \u0026lt;code\u0026gt;{$not:\u0026quot;$color\u0026quot;}\u0026lt;/code\u0026gt; is necessary, because it will scan the top document as well, and if \u0026lt;code\u0026gt;$redact\u0026lt;/code\u0026gt; does not find a \u0026lt;code\u0026gt;color\u0026lt;/code\u0026gt; field on the top level this will return \u0026lt;code\u0026gt;false\u0026lt;/code\u0026gt; that might strip the whole document which we don\u0026apos;t want. \u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Better you can query in matching array element using \u0026lt;code\u0026gt;$slice\u0026lt;/code\u0026gt; is it helpful to returning the significant object in an array.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;({\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;blue\u0026quot;\u0026lt;/span\u0026gt;}, {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.$\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;code\u0026gt;$slice\u0026lt;/code\u0026gt; is helpful when you know the index of the element, but sometimes you want\nwhichever array element matched your criteria. You can return the matching element\nwith the \u0026lt;code\u0026gt;$\u0026lt;/code\u0026gt; operator.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt; db.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getCollection\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;aj\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;({\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;},{\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.$\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;OUTPUTS\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{\n\n   \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : [ \n       {\n           \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,\n           \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n       }\n   ]\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The syntax for find in mongodb is \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    db.\u0026amp;lt;collection name\u0026amp;gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;(query, projection);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;and the second query that you have written, that is\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;    db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;(\n    {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$elemMatch\u0026quot;\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}}}, \n    {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;in this you have used the \u0026lt;code\u0026gt;$elemMatch\u0026lt;/code\u0026gt; operator in query part, whereas if you use this operator in the projection part then you will get the desired result. You can write down your query as \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;     db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;users\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;(\n     {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;},\n     {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {$elemMatch : {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}}})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;This will give you the desired result.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;h2\u0026gt;Thanks to \u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;https://stackoverflow.com/users/1259510/johnnyhk\u0026quot;\u0026gt;JohnnyHK\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;.\u0026lt;/h2\u0026gt;\n\n\u0026lt;p\u0026gt;Here I just want to add some more complex usage.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Document \u0026lt;/span\u0026gt;\n{ \n\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : [\n  {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;square\u0026quot;\u0026lt;/span\u0026gt;,  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;},\n  {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;green\u0026quot;\u0026lt;/span\u0026gt;}\n  ] \n} \n\n{ \n\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : [\n  {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;square\u0026quot;\u0026lt;/span\u0026gt;,  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;},\n  {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,  \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;green\u0026quot;\u0026lt;/span\u0026gt;}\n  ] \n} \n\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// The Query   \u0026lt;/span\u0026gt;\ndb.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;contents\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;({\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;),\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n},{\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; :{\n       \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$elemMatch\u0026quot;\u0026lt;/span\u0026gt;:{\n           \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n       } \n    }\n}) \n\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//And the Result\u0026lt;/span\u0026gt;\n\n{\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt;:[\n    {\n       \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;square\u0026quot;\u0026lt;/span\u0026gt;,\n       \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n    }\n]}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;You just need to run query\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;(\n{\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}, \n{\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$elemMatch\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}}});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;output of this query is\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;562e7c594c12942f08fe4192\u0026quot;\u0026lt;/span\u0026gt;),\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt; : [ \n        {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}\n    ]\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;as you expected it\u0026apos;ll gives the exact field from array that matches color:\u0026apos;red\u0026apos;.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Along with  \u0026lt;code\u0026gt;$project\u0026lt;/code\u0026gt; it will be more appropriate  other wise matching elements will be clubbed together with other elements in document.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;aggregate\u0026lt;/span\u0026gt;(\n  { \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$unwind\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$shapes\u0026quot;\u0026lt;/span\u0026gt; },\n  { \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$match\u0026quot;\u0026lt;/span\u0026gt; : { \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt; } },\n  { \n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$project\u0026quot;\u0026lt;/span\u0026gt;: {\n      \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,\n      \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;item\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n    }\n  }\n)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Likewise you can find for the multiple\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getCollection\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;localData\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;aggregate\u0026lt;/span\u0026gt;([\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Get just the docs that contain a shapes element where color is \u0026apos;red\u0026apos;\u0026lt;/span\u0026gt;\n  {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$match\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;shapes.color\u0026apos;\u0026lt;/span\u0026gt;: {$in : [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;red\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;yellow\u0026apos;\u0026lt;/span\u0026gt;] } }},\n  {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$project\u0026lt;/span\u0026gt;: {\n     \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$filter\u0026lt;/span\u0026gt;: {\n        \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;input\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$shapes\u0026apos;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;shape\u0026apos;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;cond\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$in\u0026lt;/span\u0026gt;: [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$$shape.color\u0026apos;\u0026lt;/span\u0026gt;, [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;red\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;yellow\u0026apos;\u0026lt;/span\u0026gt;]]}\n     }}\n  }}\n])\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;( {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}, {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Use aggregation function and \u0026lt;code\u0026gt;$project\u0026lt;/code\u0026gt; to get specific object field in document\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;getCollection\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;geolocations\u0026apos;\u0026lt;/span\u0026gt;).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;aggregate\u0026lt;/span\u0026gt;([ { $project : { geolocation : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;} } ])\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;result:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;5e3ee15968879c0d5942464b\u0026quot;\u0026lt;/span\u0026gt;),\n    \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;geolocation\u0026quot;\u0026lt;/span\u0026gt; : [ \n        {\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;5e3ee3ee68879c0d5942465e\u0026quot;\u0026lt;/span\u0026gt;),\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;latitude\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;12.9718313\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;longitude\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;77.593551\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;country\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;India\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;city\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Chennai\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;zipcode\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;560001\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;streetName\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Sidney Road\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;countryCode\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;in\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ip\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;116.75.115.248\u0026quot;\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;date\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ISODate\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;2020-02-08T16:38:06.584Z\u0026quot;\u0026lt;/span\u0026gt;)\n        }\n    ]\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Although the question was asked 9.6 years ago, this has been of immense help to numerous people, me being one of them. Thank you everyone for all your queries, hints and answers. Picking up from one of the answers here.. I found that the following method can also be used to project other fields in the parent document.This may be helpful to someone. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For the following document, the need was to find out if an employee (emp #7839) has his leave history set for the year 2020. Leave history is implemented as an embedded document within the parent Employee document. \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;employees\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;( {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;leave_history.calendar_year\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2020\u0026lt;/span\u0026gt;}, \n    {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;leave_history\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$elemMatch\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;calendar_year\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2020\u0026lt;/span\u0026gt;}},\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;empno\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;ename\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;}).\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;pretty\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;)\n\n\n{\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;5e907ad23997181dde06e8fc\u0026quot;\u0026lt;/span\u0026gt;),\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;empno\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;7839\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ename\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;KING\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;mgrno\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;hiredate\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;1990-05-09\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sal\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;100000\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;deptno\u0026quot;\u0026lt;/span\u0026gt; : {\n                \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;5e9065f53997181dde06e8f8\u0026quot;\u0026lt;/span\u0026gt;)\n        },\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;username\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;none\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;password\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;none\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;is_admin\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;N\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;is_approver\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Y\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;is_manager\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Y\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;user_role\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;AP\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;admin_approval_received\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Y\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;active\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Y\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;created_date\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;2020-04-10\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;updated_date\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;2020-04-10\u0026quot;\u0026lt;/span\u0026gt;,\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;application_usage_log\u0026quot;\u0026lt;/span\u0026gt; : [\n                {\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;logged_in_as\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;AP\u0026quot;\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;log_in_date\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;2020-04-10\u0026quot;\u0026lt;/span\u0026gt;\n                },\n                {\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;logged_in_as\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;EM\u0026quot;\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;log_in_date\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ISODate\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;2020-04-16T07:28:11.959Z\u0026quot;\u0026lt;/span\u0026gt;)\n                }\n        ],\n        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;leave_history\u0026quot;\u0026lt;/span\u0026gt; : [\n                {\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;calendar_year\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2020\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;pl_used\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;cl_used\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sl_used\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n                },\n                {\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;calendar_year\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2021\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;pl_used\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;cl_used\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,\n                        \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;sl_used\u0026quot;\u0026lt;/span\u0026gt; : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n                }\n        ]\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;if you want to do \u0026lt;strong\u0026gt;filter, set and find\u0026lt;/strong\u0026gt; at the same time.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-js s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;let\u0026lt;/span\u0026gt; post = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;await\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Post\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;findOneAndUpdate\u0026lt;/span\u0026gt;(\n          {\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;_id\u0026lt;/span\u0026gt;: req.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;params\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;,\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;tasks\u0026lt;/span\u0026gt;: {\n              \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$elemMatch\u0026lt;/span\u0026gt;: {\n                \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;id\u0026lt;/span\u0026gt;: req.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;params\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;jobId\u0026lt;/span\u0026gt;,\n                date,\n              },\n            },\n          },\n          {\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;$set\u0026lt;/span\u0026gt;: {\n              \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;jobs.$[i].performer\u0026apos;\u0026lt;/span\u0026gt;: performer,\n              \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;jobs.$[i].status\u0026apos;\u0026lt;/span\u0026gt;: status,\n              \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;jobs.$[i].type\u0026apos;\u0026lt;/span\u0026gt;: type,\n            },\n          },\n          {\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;arrayFilters\u0026lt;/span\u0026gt;: [\n              {\n                \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;i.id\u0026apos;\u0026lt;/span\u0026gt;: req.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;params\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;jobId\u0026lt;/span\u0026gt;,\n              },\n            ],\n            \u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;,\n          }\n        );\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    "],"comment":["\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;any solution if I want it to return every elements that matches it instead of just the first?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2023657/steve-ng\u0026quot; title=\u0026quot;1,169 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Steve Ng\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment31131207_12241930\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-12-25 08:12:53Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Dec 25, 2013 at 8:12\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;I\u0026apos;m afraid I am using \u0026lt;b\u0026gt;Mongo 3.0.X\u0026lt;/b\u0026gt; :-(\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/3023947/charliebrownie\u0026quot; title=\u0026quot;5,289 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;charliebrownie\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment57167028_12241930\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-01-10 20:33:49Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 10, 2016 at 20:33\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@charliebrownie Then use one of the other answers that use \u0026lt;code\u0026gt;aggregate\u0026lt;/code\u0026gt;.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1259510/johnnyhk\u0026quot; title=\u0026quot;292,048 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;JohnnyHK\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment57167874_12241930\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-01-10 21:14:50Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 10, 2016 at 21:14\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;This also works: \u0026lt;code\u0026gt;db.test.find({}, {shapes: {$elemMatch: {color: \u0026quot;red\u0026quot;}}});\u0026lt;/code\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/185034/paul\u0026quot; title=\u0026quot;19,211 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Paul\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment77191800_12241930\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2017-07-14 19:15:07Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jul 14, 2017 at 19:15\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Is this an error: $$shape.color? the double $$ in the condition of the $filter.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/4300457/augusto-jara\u0026quot; title=\u0026quot;71 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Augusto Jara\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment119445315_12241930\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2021-05-17 21:17:25Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;May 17, 2021 at 21:17\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@JohnnyHK: In this case, \u0026lt;code\u0026gt;$elemMatch\u0026lt;/code\u0026gt; is another option.  I actually got here by way of a \u0026lt;a href=\u0026quot;https://groups.google.com/forum/?fromgroups#!topic/mongodb-user/gASUwWbxN3w\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Google Group question\u0026lt;/a\u0026gt; where $elemMatch wouldn\u0026apos;t work because it only returns the first match per document.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1388319/stennie\u0026quot; title=\u0026quot;61,580 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Stennie\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment16408315_12241733\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2012-09-03 04:24:14Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 3, 2012 at 4:24\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Thanks, I wasn\u0026apos;t aware of that limitation so that\u0026apos;s good to know.  Sorry for deleting my comment you\u0026apos;re responding to, I decided to post another answer instead and didn\u0026apos;t want to confuse people.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1259510/johnnyhk\u0026quot; title=\u0026quot;292,048 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;JohnnyHK\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment16408421_12241733\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2012-09-03 04:35:59Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 3, 2012 at 4:35\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@JohnnyHK: No worries, there are now three useful answers for the question ;-)\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1388319/stennie\u0026quot; title=\u0026quot;61,580 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Stennie\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment16408491_12241733\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2012-09-03 04:41:44Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Sep 3, 2012 at 4:41\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;For other searchers, in addition to this I also tried adding \u0026lt;code\u0026gt;{ $project : { shapes : 1 } }\u0026lt;/code\u0026gt; - which seemed to work and would be helpful if the enclosing documents were large and you just wanted to view the \u0026lt;code\u0026gt;shapes\u0026lt;/code\u0026gt; key values.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1063287/user1063287\u0026quot; title=\u0026quot;9,573 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;user1063287\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment43044778_12241733\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2014-12-04 08:23:15Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Dec 4, 2014 at 8:23\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@calmbird I updated the example to include an initial $match stage. If you\u0026apos;re interested in a more efficient feature suggestion I would watch/upvote \u0026lt;a href=\u0026quot;https://jira.mongodb.org/browse/SERVER-6612\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;SERVER-6612: Support projecting multiple array values in a projection like the $elemMatch projection specifier\u0026lt;/a\u0026gt; in the MongoDB issue tracker.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1388319/stennie\u0026quot; title=\u0026quot;61,580 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Stennie\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment44744299_12241733\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-01-28 08:52:56Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 28, 2015 at 8:52\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;perfect answer. As you mentioned $unwind will consume lot of RAM. So this will be better when compared.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/3805045/manojpt\u0026quot; title=\u0026quot;1,139 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;manojpt\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment47671965_24032549\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-04-21 11:21:56Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Apr 21, 2015 at 11:21\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;I have a doubt. In the example, \u0026quot;shapes\u0026quot; is an array. \u0026lt;b\u0026gt;Will \u0026quot;$redact\u0026quot;  scan all the objects in the \u0026quot;shapes\u0026quot; array ??\u0026lt;/b\u0026gt; How this will be good with respect to performance??\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/3805045/manojpt\u0026quot; title=\u0026quot;1,139 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;manojpt\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment47761815_24032549\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-04-23 08:13:13Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Apr 23, 2015 at 8:13\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;not all of it, but the result of your first match. That is the reason why you put \u0026lt;code\u0026gt;$match\u0026lt;/code\u0026gt; as your first aggregate stage\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1089987/anvarik\u0026quot; title=\u0026quot;6,287 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;anvarik\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment47785325_24032549\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-04-23 16:36:17Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Apr 23, 2015 at 16:36\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;okkk.. if an index created on \u0026quot;color\u0026quot; field, even then it will scan all the objects in the \u0026quot;shapes\u0026quot; array??? \u0026lt;b\u0026gt;Which could be the efficient way of matching multiple objects in an array???\u0026lt;/b\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/3805045/manojpt\u0026quot; title=\u0026quot;1,139 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;manojpt\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment47804122_24032549\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-04-24 04:47:39Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Apr 24, 2015 at 4:47\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Brilliant! I do not understand how $eq works here. I left it off originally and this didn\u0026apos;t work for me. Somehow, it looks in the array of shapes to find the match, but the query never specifies which array to look in. Like, if the documents had shapes and, for example, sizes; would $eq look in both arrays for matches? Is $redact just looking for anything within the document that matches the \u0026apos;if\u0026apos; condition?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/642287/onosa\u0026quot; title=\u0026quot;1,235 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Onosa\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment56804697_24032549\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-12-30 14:46:36Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Dec 30, 2015 at 14:46\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Does it return all documents that contain \u0026lt;code\u0026gt;shapes.color : blue\u0026lt;/code\u0026gt; or just the first one?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/8505128/kojot\u0026quot; title=\u0026quot;1,357 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;kojot\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment122747752_25907866\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2021-10-05 07:43:03Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 5, 2021 at 7:43\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;thanks for the query, but it is just returning the first one even though the condition is matching for multiple elements in the array, any suggestion?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/10204932/deepam-gupta\u0026quot; title=\u0026quot;1,754 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Deepam Gupta\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment117695530_41010776\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2021-03-11 08:12:03Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Mar 11, 2021 at 8:12\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;This works for me. However, It appears that \u0026lt;code\u0026gt;\u0026quot;shapes.color\u0026quot;:\u0026quot;red\u0026quot;\u0026lt;/code\u0026gt; in the query parameter (the first parameter of the find method) is not necessary. You can replace it with \u0026lt;code\u0026gt;{}\u0026lt;/code\u0026gt; and get the same results.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1233136/erik-olson\u0026quot; title=\u0026quot;4,997 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Erik Olson\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment36176393_20727505\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2014-05-09 20:35:55Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;May 9, 2014 at 20:35\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@ErikOlson Your suggestion is right in the above case, where we need to find all the document that with red color and to apply the projection on them only. But let\u0026apos;s say if somebody requires to find out all the document that have color blue but it should return only those element of that shapes array that have color red. In this case the above query can be referenced by somebody else also..\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2451811/vicky\u0026quot; title=\u0026quot;766 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Vicky\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment36208621_20727505\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2014-05-11 09:22:11Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;May 11, 2014 at 9:22\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;This seems to be the easiest, but I can\u0026apos;t make it work it. It only returns the first matching subdocument.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/458969/newman\u0026quot; title=\u0026quot;6,562 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;newman\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment52460518_20727505\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-08-29 23:05:30Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 29, 2015 at 23:05\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@MahmoodHussain This answer is almost 7 years old, so may be version issue. Can you check latest documentation.   I will try to run similar on latest version and share my findings. Can you explain what exactly you are trying to achieve ?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2451811/vicky\u0026quot; title=\u0026quot;766 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Vicky\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment117118887_20727505\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2021-02-17 15:59:17Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Feb 17, 2021 at 15:59\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@Vicky  \u0026lt;code\u0026gt;Patient.find(     {       user: req.user._id,       _id: req.params.patientId,       \u0026quot;tests.test\u0026quot;: req.params.testId,     },     {       \u0026quot;tests.$\u0026quot;: 1,       name: 1,     }   )     .populate({       path: \u0026quot;tests\u0026quot;,       populate: {         path: \u0026quot;test\u0026quot;,         model: \u0026quot;Test\u0026quot;,       },     })     .exec((err, patient) =\u0026amp;gt; {       if (err || !patient) {         return res.status(404).send({ error: { message: err } });       }       return res.send({ patient });     });\u0026lt;/code\u0026gt;  But then populate is throwing an error\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/8894779/mahmood-hussain\u0026quot; title=\u0026quot;168 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Mahmood Hussain\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment117132145_20727505\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2021-02-18 02:32:19Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Feb 18, 2021 at 2:32\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 2 times\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;can you pls describe that this accomplishes with an input and output set?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1223975/alexander-mills\u0026quot; title=\u0026quot;79,567 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Alexander Mills\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment55562075_14789748\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-11-24 17:13:18Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Nov 24, 2015 at 17:13\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;This answer is indeed the prefered 4.x way:  \u0026lt;code\u0026gt;$match\u0026lt;/code\u0026gt; to cut down the space, then \u0026lt;code\u0026gt;$filter\u0026lt;/code\u0026gt; to keep what you want, overwriting the input field (use output of \u0026lt;code\u0026gt;$filter\u0026lt;/code\u0026gt; on field \u0026lt;code\u0026gt;shapes\u0026lt;/code\u0026gt; to \u0026lt;code\u0026gt;$project\u0026lt;/code\u0026gt; back on to \u0026lt;code\u0026gt;shapes\u0026lt;/code\u0026gt;.   Style note:  best not to use the field name as the \u0026lt;code\u0026gt;as\u0026lt;/code\u0026gt; argument because that can lead to confusion later with \u0026lt;code\u0026gt;$$shape\u0026lt;/code\u0026gt; and \u0026lt;code\u0026gt;$shape\u0026lt;/code\u0026gt;.  I prefer \u0026lt;code\u0026gt;zz\u0026lt;/code\u0026gt; as the \u0026lt;code\u0026gt;as\u0026lt;/code\u0026gt; field because it really stands out.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2502126/buzz-moschetti\u0026quot; title=\u0026quot;6,359 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Buzz Moschetti\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment107049121_60446943\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2020-03-03 15:52:54Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Mar 3, 2020 at 15:52\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Welcome to Stack Overflow! Thank you for the code snippet, which might provide some limited, immediate help. A proper explanation would greatly improve its \u0026lt;a href=\u0026quot;https://meta.stackexchange.com/q/114762/206345\u0026quot;\u0026gt;long-term value\u0026lt;/a\u0026gt; by describing why this is a good solution to the problem, and would make it more useful to future readers with other similar questions. Please edit your answer to add some explanation, including the assumptions you\u0026apos;ve made.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/65732/sepehr\u0026quot; title=\u0026quot;15,657 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;sepehr\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment92890215_52984232\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2018-10-25 15:06:43Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Oct 25, 2018 at 15:06\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        "],"id":184,"title":"Retrieve only the queried element in an object array in MongoDB collection","content":"\n                \n\n\n\u0026lt;p\u0026gt;Suppose you have the following documents in my collection:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{  \n   \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;562e7c594c12942f08fe4192\u0026quot;\u0026lt;/span\u0026gt;),\n   \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt;:[  \n      {  \n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;square\u0026quot;\u0026lt;/span\u0026gt;,\n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;blue\u0026quot;\u0026lt;/span\u0026gt;\n      },\n      {  \n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,\n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;\n      }\n   ]\n},\n{  \n   \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;_id\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ObjectId\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;562e7c594c12942f08fe4193\u0026quot;\u0026lt;/span\u0026gt;),\n   \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt;:[  \n      {  \n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;square\u0026quot;\u0026lt;/span\u0026gt;,\n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;black\u0026quot;\u0026lt;/span\u0026gt;\n      },\n      {  \n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;,\n         \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;:\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;green\u0026quot;\u0026lt;/span\u0026gt;\n      }\n   ]\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;Do query:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;({\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}, {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Or\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;db.\u0026lt;span class=\u0026quot;hljs-property\u0026quot;\u0026gt;test\u0026lt;/span\u0026gt;.\u0026lt;span class=\u0026quot;hljs-title function_\u0026quot;\u0026gt;find\u0026lt;/span\u0026gt;({\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;shapes\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;$elemMatch\u0026quot;\u0026lt;/span\u0026gt;: {\u0026lt;span class=\u0026quot;hljs-attr\u0026quot;\u0026gt;color\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}}}, {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes.color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;})\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;Returns matched document \u0026lt;em\u0026gt;(Document 1)\u0026lt;/em\u0026gt;, but always with ALL array items in \u0026lt;code\u0026gt;shapes\u0026lt;/code\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{ \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt;: \n  [\n    {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;square\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;blue\u0026quot;\u0026lt;/span\u0026gt;},\n    {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}\n  ] \n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;However, I\u0026apos;d like to get the document \u0026lt;em\u0026gt;(Document 1)\u0026lt;/em\u0026gt; only with the array that contains \u0026lt;code\u0026gt;color=red\u0026lt;/code\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-javascript s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-javascript\u0026quot;\u0026gt;{ \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shapes\u0026quot;\u0026lt;/span\u0026gt;: \n  [\n    {\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;shape\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;circle\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;color\u0026quot;\u0026lt;/span\u0026gt;: \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;red\u0026quot;\u0026lt;/span\u0026gt;}\n  ] \n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;How can I do this?\u0026lt;/p\u0026gt;\n    ","slug":"retrieve-only-the-queried-element-in-an-object-array-in-mongodb-collection-1657384890457","postType":"QUESTION","createdAt":"2022-07-09T16:41:30.000Z","updatedAt":"2022-07-09T16:41:30.000Z","tags":[{"id":675,"name":"mongodb","slug":"mongodb","createdAt":"2022-07-09T16:41:30.000Z","updatedAt":"2022-07-09T16:41:30.000Z","Questions_Tags":{"questionId":184,"tagId":675}},{"id":676,"name":"mongodb-query","slug":"mongodb-query","createdAt":"2022-07-09T16:41:30.000Z","updatedAt":"2022-07-09T16:41:30.000Z","Questions_Tags":{"questionId":184,"tagId":676}},{"id":677,"name":"aggregation-framework","slug":"aggregation-framework","createdAt":"2022-07-09T16:41:30.000Z","updatedAt":"2022-07-09T16:41:30.000Z","Questions_Tags":{"questionId":184,"tagId":677}},{"id":678,"name":"projection","slug":"projection","createdAt":"2022-07-09T16:41:30.000Z","updatedAt":"2022-07-09T16:41:30.000Z","Questions_Tags":{"questionId":184,"tagId":678}}]}},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"retrieve-only-the-queried-element-in-an-object-array-in-mongodb-collection-1657384890457"},"buildId":"4Y8KGE-c2lolBeBmcum_I","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>