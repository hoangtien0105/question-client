<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2eccd4d47c856f2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2eccd4d47c856f2b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-20edbe0b078add93.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/613-1e0aa2b2023820bb.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/471-84c36aa98dd4107c.js" defer=""></script><script src="/_next/static/chunks/81-301f760ac8107464.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-76d2c3e2d98bb08b.js" defer=""></script><script src="/_next/static/B9ZMQqRLGvIP-RcWN9dT2/_buildManifest.js" defer=""></script><script src="/_next/static/B9ZMQqRLGvIP-RcWN9dT2/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">.eZIPKL code{padding:5px;color:hsl(210deg 8% 15%);background-color:hsl(210deg 8% 90%);border-radius:3px;}/*!sc*/
data-styled.g5[id="sc-c4b0431a-0"]{content:"eZIPKL,"}/*!sc*/
</style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="https://flowbite.com/docs/images/logo.svg" class="mr-3 h-6 sm:h-9" alt="Flowbite Logo"/><span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Hunter</span></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/how-to-use-php&#x27;s-password_hash-to-hash-and-verify-passwords-1657387808784#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="sc-c4b0431a-0 eZIPKL flex question-header items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/how-to-use-php&#x27;s-password_hash-to-hash-and-verify-passwords-1657387808784">How to use PHP&#x27;s password_hash to hash and verify passwords</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/salt">salt</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/password-hash">password-hash</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/php-password-hash">php-password-hash</a></div></div><div class="question-content mt-5">
                
<p>Recently I have been trying to implement my own security on a log in script I stumbled upon on the internet. After struggling of trying to learn how to make my own script to generate a salt for each user, I stumbled upon <code>password_hash</code>. </p>

<p>From what I understand (based off of the reading on <a href="http://php.net/manual/en/faq.passwords.php" rel="noreferrer">this page</a>), salt is already generated in the row when you use <code>password_hash</code>. Is this true? </p>

<p>Another question I had was, wouldn't it be smart to have 2 salts? One directly in the file and one in the DB? That way, if someone compromises your salt in the DB, you still have the one directly in the file? I read on here that storing salts is never a smart idea, but it always confused me what people meant by that. </p>
    </div></div></div><div class="sc-c4b0431a-2 cRqwQe"><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Using <code>password_hash</code> is the recommended way to store passwords. Don't separate them to DB and files.</p>
<p>Let's say we have the following input:</p>
<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>];
</code></pre>
<p>You first hash the password by doing this:</p>
<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-variable">$hashed_password</span> = <span class="hljs-title function_ invoke__">password_hash</span>(<span class="hljs-variable">$password</span>, PASSWORD_DEFAULT);
</code></pre>
<p>Then see the output:</p>
<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$hashed_password</span>);
</code></pre>
<p>As you can see it's hashed. (I assume you did those steps).</p>
<p>Now you store this hashed password in your database, <strong>ensuring your password column is large enough to hold the hashed value (at least 60 characters or longer)</strong>. When a user asks to log them in, you check the password input with this hash value in the database, by doing this:</p>
<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-comment">// Query the database for username and password</span>
<span class="hljs-comment">// ...</span>

<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">password_verify</span>(<span class="hljs-variable">$password</span>, <span class="hljs-variable">$hashed_password</span>)) {
    <span class="hljs-comment">// If the password inputs matched the hashed password in the database</span>
    <span class="hljs-comment">// Do something, you know... log them in.</span>
} 

<span class="hljs-comment">// Else, Redirect them back to the login page.</span>
</code></pre>
<p><a href="http://php.net/manual/en/function.password-hash.php" rel="noreferrer">Official Reference</a></p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Yes you understood it correctly, the function password_hash() will generate a salt on its own, and includes it in the resulting hash-value. Storing the salt in the database is absolutely correct, it does its job even if known.</p>

<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-comment">// Hash a new password for storing in the database.</span>
<span class="hljs-comment">// The function automatically generates a cryptographically safe salt.</span>
<span class="hljs-variable">$hashToStoreInDb</span> = <span class="hljs-title function_ invoke__">password_hash</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>], PASSWORD_DEFAULT);

<span class="hljs-comment">// Check if the hash of the entered login password, matches the stored hash.</span>
<span class="hljs-comment">// The salt and the cost factor will be extracted from $existingHashFromDb.</span>
<span class="hljs-variable">$isPasswordCorrect</span> = <span class="hljs-title function_ invoke__">password_verify</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'password'</span>], <span class="hljs-variable">$existingHashFromDb</span>);
</code></pre>

<p>The second salt you mentioned (the one stored in a file), is actually a pepper or a server side key. If you add it before hashing (like the salt), then you add a pepper. There is a better way though, you could first calculate the hash, and afterwards encrypt (two-way) the hash with a server-side key. This gives you the possibility to change the key when necessary.</p>

<p>In contrast to the salt, this key should be kept secret. People often mix it up and try to hide the salt, but it is better to let the salt do its job and add the secret with a key.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Yes, it's true. Why do you doubt the php faq on the function? :)</p>

<p>The result of running <code>password_hash()</code> has has four parts:</p>

<ol>
<li>the algorithm used</li>
<li>parameters</li>
<li>salt</li>
<li>actual password hash</li>
</ol>

<p>So as you can see, the hash is a part of it.</p>

<p>Sure, you could have an additional salt for an added layer of security, but I honestly think that's overkill in a regular php application. The default bcrypt algorithm is good, and the optional blowfish one is arguably even better.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>There is a distinct lack of discussion on backwards and forwards compatibility that is built in to PHP's password functions. Notably:</p>

<ol>
<li><strong>Backwards Compatibility:</strong> The password functions are essentially a well-written wrapper around <a href="http://php.net/manual/en/function.crypt.php" rel="noreferrer"><code>crypt()</code></a>, and are inherently backwards-compatible with <code>crypt()</code>-format hashes, even if they use obsolete and/or insecure hash algorithms.</li>
<li><strong>Forwards Compatibilty:</strong> Inserting <a href="http://php.net/manual/en/function.password-needs-rehash.php" rel="noreferrer"><code>password_needs_rehash()</code></a> and a bit of logic into your authentication workflow can keep you your hashes up to date with current and future algorithms with potentially zero future changes to the workflow. Note: Any string that does not match the specified algorithm will be flagged for needing a rehash, including non-crypt-compatible hashes.</li>
</ol>

<p>Eg:</p>

<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FakeDB</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$args</span></span>) </span>{
        <span class="hljs-title function_ invoke__">printf</span>(<span class="hljs-string">"%s::%s(%s)\n"</span>, <span class="hljs-keyword">__CLASS__</span>, <span class="hljs-variable">$name</span>, <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$args</span>));
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAuth</span> </span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$dbh</span>;
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$fakeUsers</span> = [
        <span class="hljs-comment">// old crypt-md5 format</span>
        <span class="hljs-number">1</span> =&gt; [<span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'$1$AVbfJOzY$oIHHCHlD76Aw1xmjfTpm5.'</span>],
        <span class="hljs-comment">// old salted md5 format</span>
        <span class="hljs-number">2</span> =&gt; [<span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'3858f62230ac3c915f300c664312c63f'</span>, <span class="hljs-string">'salt'</span> =&gt; <span class="hljs-string">'bar'</span>],
        <span class="hljs-comment">// current bcrypt format</span>
        <span class="hljs-number">3</span> =&gt; [<span class="hljs-string">'password'</span> =&gt; <span class="hljs-string">'$2y$10$3eUn9Rnf04DR.aj8R3WbHuBO9EdoceH9uKf6vMiD7tz766rMNOyTO'</span>]
    ];

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$dbh</span></span>) </span>{
        <span class="hljs-variable language_">$this</span>-&gt;dbh = <span class="hljs-variable">$dbh</span>;
    }

    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getuser</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>) </span>{
        <span class="hljs-comment">// just pretend these are coming from the DB</span>
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;fakeUsers[<span class="hljs-variable">$id</span>];
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authUser</span>(<span class="hljs-params"><span class="hljs-variable">$id</span>, <span class="hljs-variable">$password</span></span>) </span>{
        <span class="hljs-variable">$userInfo</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getUser</span>(<span class="hljs-variable">$id</span>);

        <span class="hljs-comment">// Do you have old, turbo-legacy, non-crypt hashes?</span>
        <span class="hljs-keyword">if</span>( <span class="hljs-title function_ invoke__">strpos</span>( <span class="hljs-variable">$userInfo</span>[<span class="hljs-string">'password'</span>], <span class="hljs-string">'$'</span> ) !== <span class="hljs-number">0</span> ) {
            <span class="hljs-title function_ invoke__">printf</span>(<span class="hljs-string">"%s::legacy_hash\n"</span>, <span class="hljs-keyword">__METHOD__</span>);
            <span class="hljs-variable">$res</span> = <span class="hljs-variable">$userInfo</span>[<span class="hljs-string">'password'</span>] === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$password</span> . <span class="hljs-variable">$userInfo</span>[<span class="hljs-string">'salt'</span>]);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_ invoke__">printf</span>(<span class="hljs-string">"%s::password_verify\n"</span>, <span class="hljs-keyword">__METHOD__</span>);
            <span class="hljs-variable">$res</span> = <span class="hljs-title function_ invoke__">password_verify</span>(<span class="hljs-variable">$password</span>, <span class="hljs-variable">$userInfo</span>[<span class="hljs-string">'password'</span>]);
        }

        <span class="hljs-comment">// once we've passed validation we can check if the hash needs updating.</span>
        <span class="hljs-keyword">if</span>( <span class="hljs-variable">$res</span> &amp;&amp; <span class="hljs-title function_ invoke__">password_needs_rehash</span>(<span class="hljs-variable">$userInfo</span>[<span class="hljs-string">'password'</span>], PASSWORD_DEFAULT) ) {
            <span class="hljs-title function_ invoke__">printf</span>(<span class="hljs-string">"%s::rehash\n"</span>, <span class="hljs-keyword">__METHOD__</span>);
            <span class="hljs-variable">$stmt</span> = <span class="hljs-variable language_">$this</span>-&gt;dbh-&gt;<span class="hljs-title function_ invoke__">prepare</span>(<span class="hljs-string">'UPDATE users SET pass = ? WHERE user_id = ?'</span>);
            <span class="hljs-variable">$stmt</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>([<span class="hljs-title function_ invoke__">password_hash</span>(<span class="hljs-variable">$password</span>, PASSWORD_DEFAULT), <span class="hljs-variable">$id</span>]);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;
    }
}

<span class="hljs-variable">$auth</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyAuth</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">FakeDB</span>());

<span class="hljs-keyword">for</span>( <span class="hljs-variable">$i</span>=<span class="hljs-number">1</span>; <span class="hljs-variable">$i</span>&lt;=<span class="hljs-number">3</span>; <span class="hljs-variable">$i</span>++) {
    <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$auth</span>-&gt;<span class="hljs-title function_ invoke__">authuser</span>(<span class="hljs-variable">$i</span>, <span class="hljs-string">'foo'</span>));
    <span class="hljs-keyword">echo</span> PHP_EOL;
}
</code></pre>

<p>Output:</p>

<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-title class_">MyAuth</span>::<span class="hljs-variable constant_">authUser</span>::<span class="hljs-variable constant_">password_verify</span>
<span class="hljs-title class_">MyAuth</span>::<span class="hljs-variable constant_">authUser</span>::<span class="hljs-variable constant_">rehash</span>
FakeDB::<span class="hljs-title function_ invoke__">prepare</span>([<span class="hljs-string">"UPDATE users SET pass = ? WHERE user_id = ?"</span>])
FakeDB::<span class="hljs-title function_ invoke__">execute</span>([[<span class="hljs-string">"<span class="hljs-subst">$2y</span><span class="hljs-subst">$10</span><span class="hljs-subst">$zNjPwqQX</span>\/RxjHiwkeUEzwOpkucNw49yN4jjiRY70viZpAx5x69kv."</span>,<span class="hljs-number">1</span>]])
<span class="hljs-keyword">bool</span>(<span class="hljs-literal">true</span>)

<span class="hljs-title class_">MyAuth</span>::<span class="hljs-variable constant_">authUser</span>::<span class="hljs-variable constant_">legacy_hash</span>
<span class="hljs-title class_">MyAuth</span>::<span class="hljs-variable constant_">authUser</span>::<span class="hljs-variable constant_">rehash</span>
FakeDB::<span class="hljs-title function_ invoke__">prepare</span>([<span class="hljs-string">"UPDATE users SET pass = ? WHERE user_id = ?"</span>])
FakeDB::<span class="hljs-title function_ invoke__">execute</span>([[<span class="hljs-string">"<span class="hljs-subst">$2y</span><span class="hljs-subst">$10</span><span class="hljs-subst">$VRTu4pgIkGUvilTDRTXYeOQSEYqe2GjsPoWvDUeYdV2x</span>\/\/StjZYHu"</span>,<span class="hljs-number">2</span>]])
<span class="hljs-keyword">bool</span>(<span class="hljs-literal">true</span>)

<span class="hljs-title class_">MyAuth</span>::<span class="hljs-variable constant_">authUser</span>::<span class="hljs-variable constant_">password_verify</span>
<span class="hljs-keyword">bool</span>(<span class="hljs-literal">true</span>)
</code></pre>

<p>As a final note, given that you can only re-hash a user's password on login you should consider "sunsetting" insecure legacy hashes to protect your users. By this I mean that after a certain grace period you remove all insecure [eg: bare MD5/SHA/otherwise weak] hashes and have your users rely on your application's password reset mechanisms.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Class Password full code:</p>

<pre class="lang-php s-code-block"><code class="hljs language-php">Class Password {

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>{}


    <span class="hljs-comment">/**
     * Hash the password using the specified algorithm
     *
     * <span class="hljs-doctag">@param</span> string $password The password to hash
     * <span class="hljs-doctag">@param</span> int    $algo     The algorithm to use (Defined by PASSWORD_* constants)
     * <span class="hljs-doctag">@param</span> array  $options  The options for the algorithm to use
     *
     * <span class="hljs-doctag">@return</span> string|false The hashed password, or false on error.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">password_hash</span>(<span class="hljs-params"><span class="hljs-variable">$password</span>, <span class="hljs-variable">$algo</span>, <span class="hljs-keyword">array</span> <span class="hljs-variable">$options</span> = <span class="hljs-keyword">array</span>(<span class="hljs-params"></span>)</span>) </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-string">'crypt'</span>)) {
            <span class="hljs-title function_ invoke__">trigger_error</span>(<span class="hljs-string">"Crypt must be loaded for password_hash to function"</span>, E_USER_WARNING);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$password</span>)) {
            <span class="hljs-title function_ invoke__">trigger_error</span>(<span class="hljs-string">"password_hash(): Password must be a string"</span>, E_USER_WARNING);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_int</span>(<span class="hljs-variable">$algo</span>)) {
            <span class="hljs-title function_ invoke__">trigger_error</span>(<span class="hljs-string">"password_hash() expects parameter 2 to be long, "</span> . <span class="hljs-title function_ invoke__">gettype</span>(<span class="hljs-variable">$algo</span>) . <span class="hljs-string">" given"</span>, E_USER_WARNING);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$algo</span>) {
            <span class="hljs-keyword">case</span> PASSWORD_BCRYPT :
                <span class="hljs-comment">// Note that this is a C constant, but not exposed to PHP, so we don't define it here.</span>
                <span class="hljs-variable">$cost</span> = <span class="hljs-number">10</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$options</span>[<span class="hljs-string">'cost'</span>])) {
                    <span class="hljs-variable">$cost</span> = <span class="hljs-variable">$options</span>[<span class="hljs-string">'cost'</span>];
                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$cost</span> &lt; <span class="hljs-number">4</span> || <span class="hljs-variable">$cost</span> &gt; <span class="hljs-number">31</span>) {
                        <span class="hljs-title function_ invoke__">trigger_error</span>(<span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">"password_hash(): Invalid bcrypt cost parameter specified: %d"</span>, <span class="hljs-variable">$cost</span>), E_USER_WARNING);
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
                    }
                }
                <span class="hljs-comment">// The length of salt to generate</span>
                <span class="hljs-variable">$raw_salt_len</span> = <span class="hljs-number">16</span>;
                <span class="hljs-comment">// The length required in the final serialization</span>
                <span class="hljs-variable">$required_salt_len</span> = <span class="hljs-number">22</span>;
                <span class="hljs-variable">$hash_format</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">"<span class="hljs-subst">$2y</span>$%02d$"</span>, <span class="hljs-variable">$cost</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span> :
                <span class="hljs-title function_ invoke__">trigger_error</span>(<span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">"password_hash(): Unknown password hashing algorithm: %s"</span>, <span class="hljs-variable">$algo</span>), E_USER_WARNING);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$options</span>[<span class="hljs-string">'salt'</span>])) {
            <span class="hljs-keyword">switch</span> (<span class="hljs-title function_ invoke__">gettype</span>(<span class="hljs-variable">$options</span>[<span class="hljs-string">'salt'</span>])) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">'NULL'</span> :
                <span class="hljs-keyword">case</span> <span class="hljs-string">'boolean'</span> :
                <span class="hljs-keyword">case</span> <span class="hljs-string">'integer'</span> :
                <span class="hljs-keyword">case</span> <span class="hljs-string">'double'</span> :
                <span class="hljs-keyword">case</span> <span class="hljs-string">'string'</span> :
                    <span class="hljs-variable">$salt</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$options</span>[<span class="hljs-string">'salt'</span>];
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">'object'</span> :
                    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">method_exists</span>(<span class="hljs-variable">$options</span>[<span class="hljs-string">'salt'</span>], <span class="hljs-string">'__tostring'</span>)) {
                        <span class="hljs-variable">$salt</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$options</span>[<span class="hljs-string">'salt'</span>];
                        <span class="hljs-keyword">break</span>;
                    }
                <span class="hljs-keyword">case</span> <span class="hljs-string">'array'</span> :
                <span class="hljs-keyword">case</span> <span class="hljs-string">'resource'</span> :
                <span class="hljs-keyword">default</span> :
                    <span class="hljs-title function_ invoke__">trigger_error</span>(<span class="hljs-string">'password_hash(): Non-string salt parameter supplied'</span>, E_USER_WARNING);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$salt</span>) &lt; <span class="hljs-variable">$required_salt_len</span>) {
                <span class="hljs-title function_ invoke__">trigger_error</span>(<span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">"password_hash(): Provided salt is too short: %d expecting %d"</span>, <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$salt</span>), <span class="hljs-variable">$required_salt_len</span>), E_USER_WARNING);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            } <span class="hljs-keyword">elseif</span> (<span class="hljs-number">0</span> == <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'#^[a-zA-Z0-9./]+$#D'</span>, <span class="hljs-variable">$salt</span>)) {
                <span class="hljs-variable">$salt</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">'+'</span>, <span class="hljs-string">'.'</span>, <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$salt</span>));
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-variable">$salt</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">'+'</span>, <span class="hljs-string">'.'</span>, <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-title function_ invoke__">generate_entropy</span>(<span class="hljs-variable">$required_salt_len</span>)));
        }
        <span class="hljs-variable">$salt</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$salt</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$required_salt_len</span>);

        <span class="hljs-variable">$hash</span> = <span class="hljs-variable">$hash_format</span> . <span class="hljs-variable">$salt</span>;

        <span class="hljs-variable">$ret</span> = <span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-variable">$password</span>, <span class="hljs-variable">$hash</span>);

        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$ret</span>) || <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$ret</span>) &lt;= <span class="hljs-number">13</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$ret</span>;
    }


    <span class="hljs-comment">/**
     * Generates Entropy using the safest available method, falling back to less preferred methods depending on support
     *
     * <span class="hljs-doctag">@param</span> int $bytes
     *
     * <span class="hljs-doctag">@return</span> string Returns raw bytes
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generate_entropy</span>(<span class="hljs-params"><span class="hljs-variable">$bytes</span></span>)</span>{
        <span class="hljs-variable">$buffer</span> = <span class="hljs-string">''</span>;
        <span class="hljs-variable">$buffer_valid</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-string">'mcrypt_create_iv'</span>) &amp;&amp; !<span class="hljs-title function_ invoke__">defined</span>(<span class="hljs-string">'PHALANGER'</span>)) {
            <span class="hljs-variable">$buffer</span> = <span class="hljs-title function_ invoke__">mcrypt_create_iv</span>(<span class="hljs-variable">$bytes</span>, MCRYPT_DEV_URANDOM);
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$buffer</span>) {
                <span class="hljs-variable">$buffer_valid</span> = <span class="hljs-literal">true</span>;
            }
        }
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$buffer_valid</span> &amp;&amp; <span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-string">'openssl_random_pseudo_bytes'</span>)) {
            <span class="hljs-variable">$buffer</span> = <span class="hljs-title function_ invoke__">openssl_random_pseudo_bytes</span>(<span class="hljs-variable">$bytes</span>);
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$buffer</span>) {
                <span class="hljs-variable">$buffer_valid</span> = <span class="hljs-literal">true</span>;
            }
        }
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$buffer_valid</span> &amp;&amp; <span class="hljs-title function_ invoke__">is_readable</span>(<span class="hljs-string">'/dev/urandom'</span>)) {
            <span class="hljs-variable">$f</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">'/dev/urandom'</span>, <span class="hljs-string">'r'</span>);
            <span class="hljs-variable">$read</span> = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$buffer</span>);
            <span class="hljs-keyword">while</span> (<span class="hljs-variable">$read</span> &lt; <span class="hljs-variable">$bytes</span>) {
                <span class="hljs-variable">$buffer</span> .= <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$f</span>, <span class="hljs-variable">$bytes</span> - <span class="hljs-variable">$read</span>);
                <span class="hljs-variable">$read</span> = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$buffer</span>);
            }
            <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$f</span>);
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$read</span> &gt;= <span class="hljs-variable">$bytes</span>) {
                <span class="hljs-variable">$buffer_valid</span> = <span class="hljs-literal">true</span>;
            }
        }
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$buffer_valid</span> || <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$buffer</span>) &lt; <span class="hljs-variable">$bytes</span>) {
            <span class="hljs-variable">$bl</span> = <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$buffer</span>);
            <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$bytes</span>; <span class="hljs-variable">$i</span>++) {
                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$bl</span>) {
                    <span class="hljs-variable">$buffer</span>[<span class="hljs-variable">$i</span>] = <span class="hljs-variable">$buffer</span>[<span class="hljs-variable">$i</span>] ^ <span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>));
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-variable">$buffer</span> .= <span class="hljs-title function_ invoke__">chr</span>(<span class="hljs-title function_ invoke__">mt_rand</span>(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>));
                }
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$buffer</span>;
    }

    <span class="hljs-comment">/**
     * Get information about the password hash. Returns an array of the information
     * that was used to generate the password hash.
     *
     * array(
     *    'algo' =&gt; 1,
     *    'algoName' =&gt; 'bcrypt',
     *    'options' =&gt; array(
     *        'cost' =&gt; 10,
     *    ),
     * )
     *
     * <span class="hljs-doctag">@param</span> string $hash The password hash to extract info from
     *
     * <span class="hljs-doctag">@return</span> array The array of information about the hash.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">password_get_info</span>(<span class="hljs-params"><span class="hljs-variable">$hash</span></span>) </span>{
        <span class="hljs-variable">$return</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">'algo'</span> =&gt; <span class="hljs-number">0</span>, <span class="hljs-string">'algoName'</span> =&gt; <span class="hljs-string">'unknown'</span>, <span class="hljs-string">'options'</span> =&gt; <span class="hljs-keyword">array</span>(), );
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$hash</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>) == <span class="hljs-string">'$2y$'</span> &amp;&amp; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$hash</span>) == <span class="hljs-number">60</span>) {
            <span class="hljs-variable">$return</span>[<span class="hljs-string">'algo'</span>] = PASSWORD_BCRYPT;
            <span class="hljs-variable">$return</span>[<span class="hljs-string">'algoName'</span>] = <span class="hljs-string">'bcrypt'</span>;
            <span class="hljs-keyword">list</span>(<span class="hljs-variable">$cost</span>) = <span class="hljs-title function_ invoke__">sscanf</span>(<span class="hljs-variable">$hash</span>, <span class="hljs-string">"<span class="hljs-subst">$2y</span>$%d$"</span>);
            <span class="hljs-variable">$return</span>[<span class="hljs-string">'options'</span>][<span class="hljs-string">'cost'</span>] = <span class="hljs-variable">$cost</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-variable">$return</span>;
    }

    <span class="hljs-comment">/**
     * Determine if the password hash needs to be rehashed according to the options provided
     *
     * If the answer is true, after validating the password using password_verify, rehash it.
     *
     * <span class="hljs-doctag">@param</span> string $hash    The hash to test
     * <span class="hljs-doctag">@param</span> int    $algo    The algorithm used for new password hashes
     * <span class="hljs-doctag">@param</span> array  $options The options array passed to password_hash
     *
     * <span class="hljs-doctag">@return</span> boolean True if the password needs to be rehashed.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">password_needs_rehash</span>(<span class="hljs-params"><span class="hljs-variable">$hash</span>, <span class="hljs-variable">$algo</span>, <span class="hljs-keyword">array</span> <span class="hljs-variable">$options</span> = <span class="hljs-keyword">array</span>(<span class="hljs-params"></span>)</span>) </span>{
        <span class="hljs-variable">$info</span> = <span class="hljs-title function_ invoke__">password_get_info</span>(<span class="hljs-variable">$hash</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$info</span>[<span class="hljs-string">'algo'</span>] != <span class="hljs-variable">$algo</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$algo</span>) {
            <span class="hljs-keyword">case</span> PASSWORD_BCRYPT :
                <span class="hljs-variable">$cost</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$options</span>[<span class="hljs-string">'cost'</span>]) ? <span class="hljs-variable">$options</span>[<span class="hljs-string">'cost'</span>] : <span class="hljs-number">10</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$cost</span> != <span class="hljs-variable">$info</span>[<span class="hljs-string">'options'</span>][<span class="hljs-string">'cost'</span>]) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
                <span class="hljs-keyword">break</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">/**
     * Verify a password against a hash using a timing attack resistant approach
     *
     * <span class="hljs-doctag">@param</span> string $password The password to verify
     * <span class="hljs-doctag">@param</span> string $hash     The hash to verify against
     *
     * <span class="hljs-doctag">@return</span> boolean If the password matches the hash
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">password_verify</span>(<span class="hljs-params"><span class="hljs-variable">$password</span>, <span class="hljs-variable">$hash</span></span>) </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-string">'crypt'</span>)) {
            <span class="hljs-title function_ invoke__">trigger_error</span>(<span class="hljs-string">"Crypt must be loaded for password_verify to function"</span>, E_USER_WARNING);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-variable">$ret</span> = <span class="hljs-title function_ invoke__">crypt</span>(<span class="hljs-variable">$password</span>, <span class="hljs-variable">$hash</span>);
        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$ret</span>) || <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$ret</span>) != <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$hash</span>) || <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$ret</span>) &lt;= <span class="hljs-number">13</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-variable">$status</span> = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$ret</span>); <span class="hljs-variable">$i</span>++) {
            <span class="hljs-variable">$status</span> |= (<span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$ret</span>[<span class="hljs-variable">$i</span>]) ^ <span class="hljs-title function_ invoke__">ord</span>(<span class="hljs-variable">$hash</span>[<span class="hljs-variable">$i</span>]));
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$status</span> === <span class="hljs-number">0</span>;
    }

}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Ive built a function I use all the time for password validation and to create passwords, e.g. to store them in a MySQL database. It uses a randomly generated salt which is way more secure than using a static salt.</p>

<pre class="lang-php s-code-block"><code class="hljs language-php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">secure_password</span>(<span class="hljs-params"><span class="hljs-variable">$user_pwd</span>, <span class="hljs-variable">$multi</span></span>) </span>{

<span class="hljs-comment">/*
    secure_password ( string $user_pwd, boolean/string $multi ) 

    *** Description: 
        This function verifies a password against a (database-) stored password's hash or
        returns $hash for a given password if $multi is set to either true or false

    *** Examples:
        // To check a password against its hash
        if(secure_password($user_password, $row['user_password'])) {
            login_function();
        } 
        // To create a password-hash
        $my_password = 'uber_sEcUrE_pass';
        $hash = secure_password($my_password, true);
        echo $hash;
*/</span>

<span class="hljs-comment">// Set options for encryption and build unique random hash</span>
<span class="hljs-variable">$crypt_options</span> = [<span class="hljs-string">'cost'</span> =&gt; <span class="hljs-number">11</span>, <span class="hljs-string">'salt'</span> =&gt; <span class="hljs-title function_ invoke__">mcrypt_create_iv</span>(<span class="hljs-number">22</span>, MCRYPT_DEV_URANDOM)];
<span class="hljs-variable">$hash</span> = <span class="hljs-title function_ invoke__">password_hash</span>(<span class="hljs-variable">$user_pwd</span>, PASSWORD_BCRYPT, <span class="hljs-variable">$crypt_options</span>);

<span class="hljs-comment">// If $multi is not boolean check password and return validation state true/false</span>
<span class="hljs-keyword">if</span>(<span class="hljs-variable">$multi</span>!==<span class="hljs-literal">true</span> &amp;&amp; <span class="hljs-variable">$multi</span>!==<span class="hljs-literal">false</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">password_verify</span>(<span class="hljs-variable">$user_pwd</span>, <span class="hljs-variable">$table_pwd</span> = <span class="hljs-variable">$multi</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// valid password</span>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// invalid password</span>
    }
<span class="hljs-comment">// If $multi is boolean return $hash</span>
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-variable">$hash</span>;

}
</code></pre>
    </div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;Using \u0026lt;code\u0026gt;password_hash\u0026lt;/code\u0026gt; is the recommended way to store passwords. Don\u0026apos;t separate them to DB and files.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Let\u0026apos;s say we have the following input:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;];\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;You first hash the password by doing this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hashed_password\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;password_hash\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;, PASSWORD_DEFAULT);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Then see the output:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;var_dump\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hashed_password\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;As you can see it\u0026apos;s hashed. (I assume you did those steps).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Now you store this hashed password in your database, \u0026lt;strong\u0026gt;ensuring your password column is large enough to hold the hashed value (at least 60 characters or longer)\u0026lt;/strong\u0026gt;. When a user asks to log them in, you check the password input with this hash value in the database, by doing this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Query the database for username and password\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// ...\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;password_verify\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hashed_password\u0026lt;/span\u0026gt;)) {\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// If the password inputs matched the hashed password in the database\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Do something, you know... log them in.\u0026lt;/span\u0026gt;\n} \n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Else, Redirect them back to the login page.\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://php.net/manual/en/function.password-hash.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Official Reference\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Yes you understood it correctly, the function password_hash() will generate a salt on its own, and includes it in the resulting hash-value. Storing the salt in the database is absolutely correct, it does its job even if known.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Hash a new password for storing in the database.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// The function automatically generates a cryptographically safe salt.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hashToStoreInDb\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;password_hash\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;], PASSWORD_DEFAULT);\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Check if the hash of the entered login password, matches the stored hash.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// The salt and the cost factor will be extracted from $existingHashFromDb.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$isPasswordCorrect\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;password_verify\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$_POST\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;], \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$existingHashFromDb\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;The second salt you mentioned (the one stored in a file), is actually a pepper or a server side key. If you add it before hashing (like the salt), then you add a pepper. There is a better way though, you could first calculate the hash, and afterwards encrypt (two-way) the hash with a server-side key. This gives you the possibility to change the key when necessary.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;In contrast to the salt, this key should be kept secret. People often mix it up and try to hide the salt, but it is better to let the salt do its job and add the secret with a key.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Yes, it\u0026apos;s true. Why do you doubt the php faq on the function? :)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The result of running \u0026lt;code\u0026gt;password_hash()\u0026lt;/code\u0026gt; has has four parts:\u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;the algorithm used\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;parameters\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;salt\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;actual password hash\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;p\u0026gt;So as you can see, the hash is a part of it.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Sure, you could have an additional salt for an added layer of security, but I honestly think that\u0026apos;s overkill in a regular php application. The default bcrypt algorithm is good, and the optional blowfish one is arguably even better.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;There is a distinct lack of discussion on backwards and forwards compatibility that is built in to PHP\u0026apos;s password functions. Notably:\u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;strong\u0026gt;Backwards Compatibility:\u0026lt;/strong\u0026gt; The password functions are essentially a well-written wrapper around \u0026lt;a href=\u0026quot;http://php.net/manual/en/function.crypt.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;crypt()\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt;, and are inherently backwards-compatible with \u0026lt;code\u0026gt;crypt()\u0026lt;/code\u0026gt;-format hashes, even if they use obsolete and/or insecure hash algorithms.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;strong\u0026gt;Forwards Compatibilty:\u0026lt;/strong\u0026gt; Inserting \u0026lt;a href=\u0026quot;http://php.net/manual/en/function.password-needs-rehash.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;password_needs_rehash()\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; and a bit of logic into your authentication workflow can keep you your hashes up to date with current and future algorithms with potentially zero future changes to the workflow. Note: Any string that does not match the specified algorithm will be flagged for needing a rehash, including non-crypt-compatible hashes.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;p\u0026gt;Eg:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-class\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;FakeDB\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;__call\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$args\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;printf\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;%s::%s(%s)\\n\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;__CLASS__\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$name\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;json_encode\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$args\u0026lt;/span\u0026gt;));\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;;\n    }\n}\n\n\u0026lt;span class=\u0026quot;hljs-class\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;MyAuth\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;protected\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbh\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;protected\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$fakeUsers\u0026lt;/span\u0026gt; = [\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// old crypt-md5 format\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; =\u0026amp;gt; [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$1$AVbfJOzY$oIHHCHlD76Aw1xmjfTpm5.\u0026apos;\u0026lt;/span\u0026gt;],\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// old salted md5 format\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt; =\u0026amp;gt; [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;3858f62230ac3c915f300c664312c63f\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;salt\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;bar\u0026apos;\u0026lt;/span\u0026gt;],\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// current bcrypt format\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt; =\u0026amp;gt; [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$2y$10$3eUn9Rnf04DR.aj8R3WbHuBO9EdoceH9uKf6vMiD7tz766rMNOyTO\u0026apos;\u0026lt;/span\u0026gt;]\n    ];\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;__construct\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbh\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;dbh = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$dbh\u0026lt;/span\u0026gt;;\n    }\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;protected\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;getuser\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$id\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// just pretend these are coming from the DB\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;fakeUsers[\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$id\u0026lt;/span\u0026gt;];\n    }\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;authUser\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$id\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$userInfo\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;getUser\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$id\u0026lt;/span\u0026gt;);\n\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Do you have old, turbo-legacy, non-crypt hashes?\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;strpos\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$userInfo\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;], \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$\u0026apos;\u0026lt;/span\u0026gt; ) !== \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt; ) {\n            \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;printf\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;%s::legacy_hash\\n\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;__METHOD__\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$res\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$userInfo\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;] === \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;md5\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt; . \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$userInfo\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;salt\u0026apos;\u0026lt;/span\u0026gt;]);\n        } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; {\n            \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;printf\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;%s::password_verify\\n\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;__METHOD__\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$res\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;password_verify\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$userInfo\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;]);\n        }\n\n        \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// once we\u0026apos;ve passed validation we can check if the hash needs updating.\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$res\u0026lt;/span\u0026gt; \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;password_needs_rehash\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$userInfo\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password\u0026apos;\u0026lt;/span\u0026gt;], PASSWORD_DEFAULT) ) {\n            \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;printf\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;%s::rehash\\n\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;__METHOD__\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable language_\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;dbh-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;prepare\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;UPDATE users SET pass = ? WHERE user_id = ?\u0026apos;\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$stmt\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;execute\u0026lt;/span\u0026gt;([\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;password_hash\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;, PASSWORD_DEFAULT), \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$id\u0026lt;/span\u0026gt;]);\n        }\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$res\u0026lt;/span\u0026gt;;\n    }\n}\n\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$auth\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;MyAuth\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;FakeDB\u0026lt;/span\u0026gt;());\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt;=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt;\u0026amp;lt;=\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt;++) {\n    \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;var_dump\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$auth\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;authuser\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;foo\u0026apos;\u0026lt;/span\u0026gt;));\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;echo\u0026lt;/span\u0026gt; PHP_EOL;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Output:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;MyAuth\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;authUser\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;password_verify\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;MyAuth\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;authUser\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;rehash\u0026lt;/span\u0026gt;\nFakeDB::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;prepare\u0026lt;/span\u0026gt;([\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;UPDATE users SET pass = ? WHERE user_id = ?\u0026quot;\u0026lt;/span\u0026gt;])\nFakeDB::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;execute\u0026lt;/span\u0026gt;([[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$2y\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$10\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$zNjPwqQX\u0026lt;/span\u0026gt;\\/RxjHiwkeUEzwOpkucNw49yN4jjiRY70viZpAx5x69kv.\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;]])\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;bool\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;)\n\n\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;MyAuth\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;authUser\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;legacy_hash\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;MyAuth\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;authUser\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;rehash\u0026lt;/span\u0026gt;\nFakeDB::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;prepare\u0026lt;/span\u0026gt;([\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;UPDATE users SET pass = ? WHERE user_id = ?\u0026quot;\u0026lt;/span\u0026gt;])\nFakeDB::\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;execute\u0026lt;/span\u0026gt;([[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$2y\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$10\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$VRTu4pgIkGUvilTDRTXYeOQSEYqe2GjsPoWvDUeYdV2x\u0026lt;/span\u0026gt;\\/\\/StjZYHu\u0026quot;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;]])\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;bool\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;)\n\n\u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;MyAuth\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;authUser\u0026lt;/span\u0026gt;::\u0026lt;span class=\u0026quot;hljs-variable constant_\u0026quot;\u0026gt;password_verify\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;bool\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;As a final note, given that you can only re-hash a user\u0026apos;s password on login you should consider \u0026quot;sunsetting\u0026quot; insecure legacy hashes to protect your users. By this I mean that after a certain grace period you remove all insecure [eg: bare MD5/SHA/otherwise weak] hashes and have your users rely on your application\u0026apos;s password reset mechanisms.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Class Password full code:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;Class Password {\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;__construct\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{}\n\n\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/**\n     * Hash the password using the specified algorithm\n     *\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@param\u0026lt;/span\u0026gt; string $password The password to hash\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@param\u0026lt;/span\u0026gt; int    $algo     The algorithm to use (Defined by PASSWORD_* constants)\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@param\u0026lt;/span\u0026gt; array  $options  The options for the algorithm to use\n     *\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@return\u0026lt;/span\u0026gt; string|false The hashed password, or false on error.\n     */\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;password_hash\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$algo\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;function_exists\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;crypt\u0026apos;\u0026lt;/span\u0026gt;)) {\n            \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;trigger_error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Crypt must be loaded for password_hash to function\u0026quot;\u0026lt;/span\u0026gt;, E_USER_WARNING);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;;\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;is_string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;)) {\n            \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;trigger_error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;password_hash(): Password must be a string\u0026quot;\u0026lt;/span\u0026gt;, E_USER_WARNING);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;;\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;is_int\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$algo\u0026lt;/span\u0026gt;)) {\n            \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;trigger_error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;password_hash() expects parameter 2 to be long, \u0026quot;\u0026lt;/span\u0026gt; . \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;gettype\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$algo\u0026lt;/span\u0026gt;) . \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot; given\u0026quot;\u0026lt;/span\u0026gt;, E_USER_WARNING);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;;\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;switch\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$algo\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; PASSWORD_BCRYPT :\n                \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Note that this is a C constant, but not exposed to PHP, so we don\u0026apos;t define it here.\u0026lt;/span\u0026gt;\n                \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$cost\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;;\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;isset\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;cost\u0026apos;\u0026lt;/span\u0026gt;])) {\n                    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$cost\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;cost\u0026apos;\u0026lt;/span\u0026gt;];\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$cost\u0026lt;/span\u0026gt; \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt; || \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$cost\u0026lt;/span\u0026gt; \u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;31\u0026lt;/span\u0026gt;) {\n                        \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;trigger_error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;sprintf\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;password_hash(): Invalid bcrypt cost parameter specified: %d\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$cost\u0026lt;/span\u0026gt;), E_USER_WARNING);\n                        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;;\n                    }\n                }\n                \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// The length of salt to generate\u0026lt;/span\u0026gt;\n                \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$raw_salt_len\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;16\u0026lt;/span\u0026gt;;\n                \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// The length required in the final serialization\u0026lt;/span\u0026gt;\n                \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$required_salt_len\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;22\u0026lt;/span\u0026gt;;\n                \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash_format\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;sprintf\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$2y\u0026lt;/span\u0026gt;$%02d$\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$cost\u0026lt;/span\u0026gt;);\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;break\u0026lt;/span\u0026gt;;\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;default\u0026lt;/span\u0026gt; :\n                \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;trigger_error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;sprintf\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;password_hash(): Unknown password hashing algorithm: %s\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$algo\u0026lt;/span\u0026gt;), E_USER_WARNING);\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;;\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;isset\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;salt\u0026apos;\u0026lt;/span\u0026gt;])) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;switch\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;gettype\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;salt\u0026apos;\u0026lt;/span\u0026gt;])) {\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;NULL\u0026apos;\u0026lt;/span\u0026gt; :\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;boolean\u0026apos;\u0026lt;/span\u0026gt; :\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;integer\u0026apos;\u0026lt;/span\u0026gt; :\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;double\u0026apos;\u0026lt;/span\u0026gt; :\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;string\u0026apos;\u0026lt;/span\u0026gt; :\n                    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$salt\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;salt\u0026apos;\u0026lt;/span\u0026gt;];\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;break\u0026lt;/span\u0026gt;;\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;object\u0026apos;\u0026lt;/span\u0026gt; :\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;method_exists\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;salt\u0026apos;\u0026lt;/span\u0026gt;], \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;__tostring\u0026apos;\u0026lt;/span\u0026gt;)) {\n                        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$salt\u0026lt;/span\u0026gt; = (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;salt\u0026apos;\u0026lt;/span\u0026gt;];\n                        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;break\u0026lt;/span\u0026gt;;\n                    }\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;array\u0026apos;\u0026lt;/span\u0026gt; :\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;resource\u0026apos;\u0026lt;/span\u0026gt; :\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;default\u0026lt;/span\u0026gt; :\n                    \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;trigger_error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;password_hash(): Non-string salt parameter supplied\u0026apos;\u0026lt;/span\u0026gt;, E_USER_WARNING);\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;;\n            }\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;strlen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$salt\u0026lt;/span\u0026gt;) \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$required_salt_len\u0026lt;/span\u0026gt;) {\n                \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;trigger_error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;sprintf\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;password_hash(): Provided salt is too short: %d expecting %d\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;strlen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$salt\u0026lt;/span\u0026gt;), \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$required_salt_len\u0026lt;/span\u0026gt;), E_USER_WARNING);\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;;\n            } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;elseif\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt; == \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;preg_match\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;#^[a-zA-Z0-9./]+$#D\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$salt\u0026lt;/span\u0026gt;)) {\n                \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$salt\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;str_replace\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;+\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;.\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;base64_encode\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$salt\u0026lt;/span\u0026gt;));\n            }\n        } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; {\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$salt\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;str_replace\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;+\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;.\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;base64_encode\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$this\u0026lt;/span\u0026gt;-\u0026amp;gt;\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;generate_entropy\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$required_salt_len\u0026lt;/span\u0026gt;)));\n        }\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$salt\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;substr\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$salt\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$required_salt_len\u0026lt;/span\u0026gt;);\n\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash_format\u0026lt;/span\u0026gt; . \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$salt\u0026lt;/span\u0026gt;;\n\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$ret\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;crypt\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt;);\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;is_string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$ret\u0026lt;/span\u0026gt;) || \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;strlen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$ret\u0026lt;/span\u0026gt;) \u0026amp;lt;= \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;13\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;;\n        }\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$ret\u0026lt;/span\u0026gt;;\n    }\n\n\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/**\n     * Generates Entropy using the safest available method, falling back to less preferred methods depending on support\n     *\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@param\u0026lt;/span\u0026gt; int $bytes\n     *\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@return\u0026lt;/span\u0026gt; string Returns raw bytes\n     */\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;generate_entropy\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$bytes\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer_valid\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;function_exists\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;mcrypt_create_iv\u0026apos;\u0026lt;/span\u0026gt;) \u0026amp;amp;\u0026amp;amp; !\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;defined\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;PHALANGER\u0026apos;\u0026lt;/span\u0026gt;)) {\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mcrypt_create_iv\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$bytes\u0026lt;/span\u0026gt;, MCRYPT_DEV_URANDOM);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt;) {\n                \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer_valid\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;;\n            }\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer_valid\u0026lt;/span\u0026gt; \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;function_exists\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;openssl_random_pseudo_bytes\u0026apos;\u0026lt;/span\u0026gt;)) {\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;openssl_random_pseudo_bytes\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$bytes\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt;) {\n                \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer_valid\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;;\n            }\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer_valid\u0026lt;/span\u0026gt; \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;is_readable\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/dev/urandom\u0026apos;\u0026lt;/span\u0026gt;)) {\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$f\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;fopen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;/dev/urandom\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;r\u0026apos;\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$read\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;strlen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;while\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$read\u0026lt;/span\u0026gt; \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$bytes\u0026lt;/span\u0026gt;) {\n                \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt; .= \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;fread\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$f\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$bytes\u0026lt;/span\u0026gt; - \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$read\u0026lt;/span\u0026gt;);\n                \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$read\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;strlen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt;);\n            }\n            \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;fclose\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$f\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$read\u0026lt;/span\u0026gt; \u0026amp;gt;= \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$bytes\u0026lt;/span\u0026gt;) {\n                \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer_valid\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;;\n            }\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer_valid\u0026lt;/span\u0026gt; || \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;strlen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt;) \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$bytes\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$bl\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;strlen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt; \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$bytes\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt;++) {\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt; \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$bl\u0026lt;/span\u0026gt;) {\n                    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt;] = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt;] ^ \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;chr\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mt_rand\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;255\u0026lt;/span\u0026gt;));\n                } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; {\n                    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt; .= \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;chr\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mt_rand\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;255\u0026lt;/span\u0026gt;));\n                }\n            }\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$buffer\u0026lt;/span\u0026gt;;\n    }\n\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/**\n     * Get information about the password hash. Returns an array of the information\n     * that was used to generate the password hash.\n     *\n     * array(\n     *    \u0026apos;algo\u0026apos; =\u0026amp;gt; 1,\n     *    \u0026apos;algoName\u0026apos; =\u0026amp;gt; \u0026apos;bcrypt\u0026apos;,\n     *    \u0026apos;options\u0026apos; =\u0026amp;gt; array(\n     *        \u0026apos;cost\u0026apos; =\u0026amp;gt; 10,\n     *    ),\n     * )\n     *\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@param\u0026lt;/span\u0026gt; string $hash The password hash to extract info from\n     *\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@return\u0026lt;/span\u0026gt; array The array of information about the hash.\n     */\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;password_get_info\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$return\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;algo\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;algoName\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;unknown\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;options\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;(), );\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;substr\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;) == \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$2y$\u0026apos;\u0026lt;/span\u0026gt; \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;strlen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt;) == \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;60\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$return\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;algo\u0026apos;\u0026lt;/span\u0026gt;] = PASSWORD_BCRYPT;\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$return\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;algoName\u0026apos;\u0026lt;/span\u0026gt;] = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;bcrypt\u0026apos;\u0026lt;/span\u0026gt;;\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;list\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$cost\u0026lt;/span\u0026gt;) = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;sscanf\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\u0026lt;span class=\u0026quot;hljs-subst\u0026quot;\u0026gt;$2y\u0026lt;/span\u0026gt;$%d$\u0026quot;\u0026lt;/span\u0026gt;);\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$return\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;options\u0026apos;\u0026lt;/span\u0026gt;][\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;cost\u0026apos;\u0026lt;/span\u0026gt;] = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$cost\u0026lt;/span\u0026gt;;\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$return\u0026lt;/span\u0026gt;;\n    }\n\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/**\n     * Determine if the password hash needs to be rehashed according to the options provided\n     *\n     * If the answer is true, after validating the password using password_verify, rehash it.\n     *\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@param\u0026lt;/span\u0026gt; string $hash    The hash to test\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@param\u0026lt;/span\u0026gt; int    $algo    The algorithm used for new password hashes\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@param\u0026lt;/span\u0026gt; array  $options The options array passed to password_hash\n     *\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@return\u0026lt;/span\u0026gt; boolean True if the password needs to be rehashed.\n     */\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;password_needs_rehash\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$algo\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;array\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$info\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;password_get_info\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt;);\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$info\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;algo\u0026apos;\u0026lt;/span\u0026gt;] != \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$algo\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;;\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;switch\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$algo\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; PASSWORD_BCRYPT :\n                \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$cost\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;isset\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;cost\u0026apos;\u0026lt;/span\u0026gt;]) ? \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$options\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;cost\u0026apos;\u0026lt;/span\u0026gt;] : \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;;\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$cost\u0026lt;/span\u0026gt; != \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$info\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;options\u0026apos;\u0026lt;/span\u0026gt;][\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;cost\u0026apos;\u0026lt;/span\u0026gt;]) {\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;;\n                }\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;break\u0026lt;/span\u0026gt;;\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;;\n    }\n\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/**\n     * Verify a password against a hash using a timing attack resistant approach\n     *\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@param\u0026lt;/span\u0026gt; string $password The password to verify\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@param\u0026lt;/span\u0026gt; string $hash     The hash to verify against\n     *\n     * \u0026lt;span class=\u0026quot;hljs-doctag\u0026quot;\u0026gt;@return\u0026lt;/span\u0026gt; boolean If the password matches the hash\n     */\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;password_verify\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;function_exists\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;crypt\u0026apos;\u0026lt;/span\u0026gt;)) {\n            \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;trigger_error\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Crypt must be loaded for password_verify to function\u0026quot;\u0026lt;/span\u0026gt;, E_USER_WARNING);\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;;\n        }\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$ret\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;crypt\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$password\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt;);\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (!\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;is_string\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$ret\u0026lt;/span\u0026gt;) || \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;strlen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$ret\u0026lt;/span\u0026gt;) != \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;strlen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt;) || \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;strlen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$ret\u0026lt;/span\u0026gt;) \u0026amp;lt;= \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;13\u0026lt;/span\u0026gt;) {\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;;\n        }\n\n        \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$status\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt; \u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;strlen\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$ret\u0026lt;/span\u0026gt;); \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt;++) {\n            \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$status\u0026lt;/span\u0026gt; |= (\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;ord\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$ret\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt;]) ^ \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;ord\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt;[\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$i\u0026lt;/span\u0026gt;]));\n        }\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$status\u0026lt;/span\u0026gt; === \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;\n    }\n\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Ive built a function I use all the time for password validation and to create passwords, e.g. to store them in a MySQL database. It uses a randomly generated salt which is way more secure than using a static salt.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-php s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-php\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;function\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;secure_password\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$user_pwd\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$multi\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;) \u0026lt;/span\u0026gt;{\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/*\n    secure_password ( string $user_pwd, boolean/string $multi ) \n\n    *** Description: \n        This function verifies a password against a (database-) stored password\u0026apos;s hash or\n        returns $hash for a given password if $multi is set to either true or false\n\n    *** Examples:\n        // To check a password against its hash\n        if(secure_password($user_password, $row[\u0026apos;user_password\u0026apos;])) {\n            login_function();\n        } \n        // To create a password-hash\n        $my_password = \u0026apos;uber_sEcUrE_pass\u0026apos;;\n        $hash = secure_password($my_password, true);\n        echo $hash;\n*/\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Set options for encryption and build unique random hash\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$crypt_options\u0026lt;/span\u0026gt; = [\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;cost\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;11\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;salt\u0026apos;\u0026lt;/span\u0026gt; =\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;mcrypt_create_iv\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;22\u0026lt;/span\u0026gt;, MCRYPT_DEV_URANDOM)];\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;password_hash\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$user_pwd\u0026lt;/span\u0026gt;, PASSWORD_BCRYPT, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$crypt_options\u0026lt;/span\u0026gt;);\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// If $multi is not boolean check password and return validation state true/false\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$multi\u0026lt;/span\u0026gt;!==\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt; \u0026amp;amp;\u0026amp;amp; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$multi\u0026lt;/span\u0026gt;!==\u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-title function_ invoke__\u0026quot;\u0026gt;password_verify\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$user_pwd\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$table_pwd\u0026lt;/span\u0026gt; = \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$multi\u0026lt;/span\u0026gt;)) {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// valid password\u0026lt;/span\u0026gt;\n    } \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; {\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;false\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// invalid password\u0026lt;/span\u0026gt;\n    }\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// If $multi is boolean return $hash\u0026lt;/span\u0026gt;\n} \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;$hash\u0026lt;/span\u0026gt;;\n\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    "],"id":381,"title":"How to use PHP's password_hash to hash and verify passwords","content":"\n                \n\u0026lt;p\u0026gt;Recently I have been trying to implement my own security on a log in script I stumbled upon on the internet. After struggling of trying to learn how to make my own script to generate a salt for each user, I stumbled upon \u0026lt;code\u0026gt;password_hash\u0026lt;/code\u0026gt;. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;From what I understand (based off of the reading on \u0026lt;a href=\u0026quot;http://php.net/manual/en/faq.passwords.php\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;this page\u0026lt;/a\u0026gt;), salt is already generated in the row when you use \u0026lt;code\u0026gt;password_hash\u0026lt;/code\u0026gt;. Is this true? \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Another question I had was, wouldn\u0026apos;t it be smart to have 2 salts? One directly in the file and one in the DB? That way, if someone compromises your salt in the DB, you still have the one directly in the file? I read on here that storing salts is never a smart idea, but it always confused me what people meant by that. \u0026lt;/p\u0026gt;\n    ","slug":"how-to-use-php's-password_hash-to-hash-and-verify-passwords-1657387808784","postType":"QUESTION","createdAt":"2022-07-09T17:30:08.000Z","updatedAt":"2022-07-09T17:30:08.000Z","tags":[{"id":2079,"name":"salt","slug":"salt","createdAt":"2022-07-09T17:30:08.000Z","updatedAt":"2022-07-09T17:30:08.000Z","Questions_Tags":{"questionId":381,"tagId":2079}},{"id":2080,"name":"password-hash","slug":"password-hash","createdAt":"2022-07-09T17:30:08.000Z","updatedAt":"2022-07-09T17:30:08.000Z","Questions_Tags":{"questionId":381,"tagId":2080}},{"id":2081,"name":"php-password-hash","slug":"php-password-hash","createdAt":"2022-07-09T17:30:08.000Z","updatedAt":"2022-07-09T17:30:08.000Z","Questions_Tags":{"questionId":381,"tagId":2081}}]}},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"how-to-use-php's-password_hash-to-hash-and-verify-passwords-1657387808784"},"buildId":"B9ZMQqRLGvIP-RcWN9dT2","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>