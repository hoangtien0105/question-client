<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2eccd4d47c856f2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2eccd4d47c856f2b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-20edbe0b078add93.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/613-1e0aa2b2023820bb.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/471-84c36aa98dd4107c.js" defer=""></script><script src="/_next/static/chunks/81-096e453de8a27667.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-e3d1b60e109d3ba1.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_buildManifest.js" defer=""></script><script src="/_next/static/4Y8KGE-c2lolBeBmcum_I/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">.hFcsiD code{padding:5px;color:hsl(210deg 8% 15%);background-color:hsl(210deg 8% 90%);border-radius:3px;}/*!sc*/
data-styled.g5[id="sc-6e32c308-0"]{content:"hFcsiD,"}/*!sc*/
.ljvTUN .comment-item .comment-body .d-inline-flex.ai-center{text-align:right;}/*!sc*/
.ljvTUN .comment-item .comment-body .comment-date{float:right;}/*!sc*/
data-styled.g6[id="sc-6e32c308-1"]{content:"ljvTUN,"}/*!sc*/
</style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="https://flowbite.com/docs/images/logo.svg" class="mr-3 h-6 sm:h-9" alt="Flowbite Logo"/><span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Hunter</span></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/what-are-copy-elision-and-return-value-optimization-1657385455976#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="sc-6e32c308-0 hFcsiD flex question-header items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/what-are-copy-elision-and-return-value-optimization-1657385455976">What are copy elision and return value optimization?</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/optimization">optimization</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/return-value-optimization">return-value-optimization</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/copy-elision">copy-elision</a></div></div><div class="question-content mt-5">
                
<p>What is copy elision? What is (named) return value optimization? What do they imply?</p>

<p>In what situations can they occur? What are limitations?</p>

<ul>
<li>If you were referenced to this question, you're probably looking for <a href="https://stackoverflow.com/a/12953129/673730"><strong>the introduction</strong></a>.</li>
<li>For a technical overview, see <a href="https://stackoverflow.com/a/12953145/673730"><strong>the standard reference</strong></a>.</li>
<li>See <a href="https://stackoverflow.com/a/12953150/673730"><strong>common cases</strong> here</a>.</li>
</ul>
    </div></div></div><div class="sc-6e32c308-1 ljvTUN flex text-xs pl-10 flex-col comment items-center justify-center"><h4 class="text-left mt-10 text-lg font-semibold">Comments</h4><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">Copy elision is one way to look at it; object elision or object fusion (or confusion) is another view.</span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/963864/curiousguy" title="7,758 reputation" class="comment-user">curiousguy</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment52315626_12953127"><span title="2015-08-25 23:58:16Z, License: CC BY-SA 3.0" class="relativetime-clean">Aug 25, 2015 at 23:58</span></a></span>
            </div>
        </div><span class="divide-x-8 "></span><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">I found this <a href="https://shaharmike.com/cpp/rvo/" rel="nofollow noreferrer">link</a> helpful.</span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/6740589/subtleseeker" title="3,130 reputation" class="comment-user">subtleseeker</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment107001424_12953127"><span title="2020-03-02 08:30:15Z, License: CC BY-SA 4.0" class="relativetime-clean">Mar 2, 2020 at 8:30</span></a></span>
            </div>
        </div><span class="divide-x-8 "></span><div class="comment-item w-9/12 border-t divide-y-8">
            <div class="comment-body js-comment-edit-hide">
                
                <span class="comment-copy">could you plz explain when is the 2nd output happen and when the 3rd?</span>
                
              <div class="d-inline-flex ai-center">
&nbsp;<a href="/users/1150712/zhangxaochen" title="21,281 reputation" class="comment-user">zhangxaochen</a>
                </div>
                <span class="comment-date" dir="ltr"><a class="comment-link" href="#comment37568521_12953129"><span title="2014-06-19 14:00:49Z, License: CC BY-SA 3.0" class="relativetime-clean">Jun 19, 2014 at 14:00</span></a></span>
                        <span title="this comment was edited 1 time">
                            <svg aria-hidden="true" class="va-text-bottom o50 svg-icon iconPencilSm" width="14" height="14" viewBox="0 0 14 14"><path d="m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z"></path></svg>
                        </span>
            </div>
        </div><span class="divide-x-8 "></span><button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">See more</button></div><div class="sc-6e32c308-2 bFXWFO"><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<h2>Introduction</h2>
<p>For a technical overview - <a href="https://stackoverflow.com/a/12953145/673730">skip to this answer</a>.</p>
<p>For common cases where copy elision occurs - <a href="https://stackoverflow.com/a/12953150/673730">skip to this answer</a>.</p>
<p>Copy elision is an optimization implemented by most compilers to prevent extra (potentially expensive) copies in certain situations. It makes returning by value or pass-by-value feasible in practice (restrictions apply).</p>
<p>It's the only form of optimization that elides (ha!) the as-if rule - <strong>copy elision can be applied even if copying/moving the object has side-effects</strong>.</p>
<p>The following example taken from <a href="http://en.wikipedia.org/wiki/Return_value_optimization" rel="noreferrer">Wikipedia</a>:</p>
<pre class="lang-cpp s-code-block"><code class="hljs language-cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">C</span> {
  <span class="hljs-built_in">C</span>() {}
  <span class="hljs-built_in">C</span>(<span class="hljs-type">const</span> C&amp;) { std::cout &lt;&lt; <span class="hljs-string">"A copy was made.\n"</span>; }
};
 
<span class="hljs-function">C <span class="hljs-title">f</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">C</span>();
}
 
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  std::cout &lt;&lt; <span class="hljs-string">"Hello World!\n"</span>;
  C obj = <span class="hljs-built_in">f</span>();
}
</code></pre>
<p>Depending on the compiler &amp; settings, the following outputs <strong>are all valid</strong>:</p>
<blockquote>
<p>Hello World!  <br>
A copy was made. <br>
A copy was made. <br></p>
</blockquote>
<hr>
<blockquote>
<p>Hello World! <br>
A copy was made.</p>
</blockquote>
<hr>
<blockquote>
<p>Hello World!</p>
</blockquote>
<p>This also means fewer objects can be created, so you also can't rely on a specific number of destructors being called. You shouldn't have critical logic inside copy/move-constructors or destructors, as you can't rely on them being called.</p>
<p>If a call to a copy or move constructor is elided, that constructor must still exist and must be accessible. This ensures that copy elision does not allow copying objects which are not normally copyable, e.g. because they have a private or deleted copy/move constructor.</p>
<p><strong>C++17</strong>: As of C++17, Copy Elision is guaranteed when an object is returned directly:</p>
<pre class="lang-cpp s-code-block"><code class="hljs language-cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">C</span> {
  <span class="hljs-built_in">C</span>() {}
  <span class="hljs-built_in">C</span>(<span class="hljs-type">const</span> C&amp;) { std::cout &lt;&lt; <span class="hljs-string">"A copy was made.\n"</span>; }
};
 
<span class="hljs-function">C <span class="hljs-title">f</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">C</span>(); <span class="hljs-comment">//Definitely performs copy elision</span>
}
<span class="hljs-function">C <span class="hljs-title">g</span><span class="hljs-params">()</span> </span>{
    C c;
    <span class="hljs-keyword">return</span> c; <span class="hljs-comment">//Maybe performs copy elision</span>
}
 
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  std::cout &lt;&lt; <span class="hljs-string">"Hello World!\n"</span>;
  C obj = <span class="hljs-built_in">f</span>(); <span class="hljs-comment">//Copy constructor isn't called</span>
}
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<h2>Standard reference</h2>

<p>For a less technical view &amp; introduction - <a href="https://stackoverflow.com/a/12953129/673730">skip to this answer</a>.</p>

<p>For common cases where copy elision occurs - <a href="https://stackoverflow.com/a/12953150/673730">skip to this answer</a>.</p>

<p><strong>Copy elision</strong> is defined in the standard in:</p>

<h3>12.8 Copying and moving class objects [class.copy]</h3>

<p>as</p>

<blockquote>
  <p>31) When certain criteria are met, an implementation is allowed to omit the copy/move construction of a class
  object, even if the copy/move constructor and/or destructor for the object have side effects. In such cases,
  the implementation treats the source and target of the omitted copy/move operation as simply two different
  ways of referring to the same object, and the destruction of that object occurs at the later of the times
  when the two objects would have been destroyed without the optimization.<sup>123</sup> This elision of copy/move
  operations, called <em>copy elision</em>, is permitted in the following circumstances (which may be combined to
  eliminate multiple copies):</p>
  
  <p> in a return statement in a function with a class return type, when the expression is the name of a
  non-volatile automatic object (other than a function or catch-clause parameter) with the same cvunqualified
  type as the function return type, the copy/move operation can be omitted by constructing
  the automatic object directly into the functions return value</p>
  
  <p> in a throw-expression, when the operand is the name of a non-volatile automatic object (other than a
  function or catch-clause parameter) whose scope does not extend beyond the end of the innermost
  enclosing try-block (if there is one), the copy/move operation from the operand to the exception
  object (15.1) can be omitted by constructing the automatic object directly into the exception object</p>
  
  <p> when a temporary class object that has not been bound to a reference (12.2) would be copied/moved
  to a class object with the same cv-unqualified type, the copy/move operation can be omitted by
  constructing the temporary object directly into the target of the omitted copy/move</p>
  
  <p> when the exception-declaration of an exception handler (Clause 15) declares an object of the same type
  (except for cv-qualification) as the exception object (15.1), the copy/move operation can be omitted
  by treating the exception-declaration as an alias for the exception object if the meaning of the program
  will be unchanged except for the execution of constructors and destructors for the object declared by
  the exception-declaration.</p>
  
  <p><sub>123) Because only one object is destroyed instead of two, and one copy/move constructor is not executed, there is still one
  object destroyed for each one constructed.</sub></p>
</blockquote>

<p>The example given is:</p>

<pre class="lang-cpp s-code-block"><code class="hljs language-cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Thing</span> {
<span class="hljs-keyword">public</span>:
  <span class="hljs-built_in">Thing</span>();
  ~<span class="hljs-built_in">Thing</span>();
  <span class="hljs-built_in">Thing</span>(<span class="hljs-type">const</span> Thing&amp;);
};
<span class="hljs-function">Thing <span class="hljs-title">f</span><span class="hljs-params">()</span> </span>{
  Thing t;
  <span class="hljs-keyword">return</span> t;
}
Thing t2 = <span class="hljs-built_in">f</span>();
</code></pre>

<p>and explained:</p>

<blockquote>
  <p>Here the criteria for elision can be combined to eliminate two calls to the copy constructor of class <code>Thing</code>:
  the copying of the local automatic object <code>t</code> into the temporary object for the return value of function <code>f()</code>
  and the copying of that temporary object into object <code>t2</code>. Effectively, the construction of the local object <code>t</code>
  can be viewed as directly initializing the global object <code>t2</code>, and that objects destruction will occur at program
  exit. Adding a move constructor to Thing has the same effect, but it is the move construction from the
  temporary object to <code>t2</code> that is elided.</p>
</blockquote>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<h2>Common forms of copy elision</h2>
<p>For a technical overview - <a href="https://stackoverflow.com/a/12953145/673730">skip to this answer</a>.</p>
<p>For a less technical view &amp; introduction - <a href="https://stackoverflow.com/a/12953129/673730">skip to this answer</a>.</p>
<p>(Named) Return value optimization is a common form of copy elision. It refers to the situation where an object returned by value from a method has its copy elided. The example set forth in the standard illustrates <strong>named return value optimization</strong>, since the object is named.</p>
<pre class="lang-cpp s-code-block"><code class="hljs language-cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Thing</span> {
<span class="hljs-keyword">public</span>:
  <span class="hljs-built_in">Thing</span>();
  ~<span class="hljs-built_in">Thing</span>();
  <span class="hljs-built_in">Thing</span>(<span class="hljs-type">const</span> Thing&amp;);
};
<span class="hljs-function">Thing <span class="hljs-title">f</span><span class="hljs-params">()</span> </span>{
  Thing t;
  <span class="hljs-keyword">return</span> t;
}
Thing t2 = <span class="hljs-built_in">f</span>();
</code></pre>
<p>Regular <strong>return value optimization</strong> occurs when a temporary is returned:</p>
<pre class="lang-cpp s-code-block"><code class="hljs language-cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Thing</span> {
<span class="hljs-keyword">public</span>:
  <span class="hljs-built_in">Thing</span>();
  ~<span class="hljs-built_in">Thing</span>();
  <span class="hljs-built_in">Thing</span>(<span class="hljs-type">const</span> Thing&amp;);
};
<span class="hljs-function">Thing <span class="hljs-title">f</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Thing</span>();
}
Thing t2 = <span class="hljs-built_in">f</span>();
</code></pre>
<p>Other common places where copy elision takes place is when an object is <strong>constructed from a temporary</strong>:</p>
<pre class="lang-cpp s-code-block"><code class="hljs language-cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Thing</span> {
<span class="hljs-keyword">public</span>:
  <span class="hljs-built_in">Thing</span>();
  ~<span class="hljs-built_in">Thing</span>();
  <span class="hljs-built_in">Thing</span>(<span class="hljs-type">const</span> Thing&amp;);
};
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">(Thing t)</span></span>;

Thing t2 = <span class="hljs-built_in">Thing</span>();
Thing t3 = <span class="hljs-built_in">Thing</span>(<span class="hljs-built_in">Thing</span>()); <span class="hljs-comment">// two rounds of elision</span>
<span class="hljs-built_in">foo</span>(<span class="hljs-built_in">Thing</span>()); <span class="hljs-comment">// parameter constructed from temporary</span>
</code></pre>
<p>or when an <strong>exception is thrown and caught by value</strong>:</p>
<pre class="lang-cpp s-code-block"><code class="hljs language-cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Thing</span>{
  <span class="hljs-built_in">Thing</span>();
  <span class="hljs-built_in">Thing</span>(<span class="hljs-type">const</span> Thing&amp;);
};
 
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span> </span>{
  Thing c;
  <span class="hljs-keyword">throw</span> c;
}
 
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">try</span> {
    <span class="hljs-built_in">foo</span>();
  }
  <span class="hljs-built_in">catch</span>(Thing c) {  
  }             
}
</code></pre>
<p><a href="http://msdn.microsoft.com/en-us/library/ms364057%28v=vs.80%29.aspx#nrvo_cpp05_topic3" rel="nofollow noreferrer">Common limitations of copy elision are:</a></p>
<ul>
<li>multiple return points</li>
<li>conditional initialization</li>
</ul>
<p>Most commercial-grade compilers support copy elision &amp; (N)RVO (depending on optimization settings). C++17 makes many of the above classes of copy elision mandatory.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Copy elision is a compiler optimization technique that eliminates unnecessary copying/moving of objects.</p>
<p>In the following circumstances, a compiler is allowed to omit copy/move operations and hence not to call the associated constructor:</p>
<ol>
<li><strong>NRVO (Named Return Value Optimization)</strong>: If a function returns a class type by value and the return statement's expression is the name of a non-volatile object with automatic storage duration (which isn't a function parameter), then the copy/move that would be performed by a non-optimising compiler can be omitted. If so, the returned value is constructed directly in the storage to which the function's return value would otherwise be moved or copied.</li>
<li><strong>RVO (Return Value Optimization)</strong>: If the function returns a nameless temporary object that would be moved or copied into the destination by a naive compiler, the copy or move can be omitted as per 1.</li>
</ol>

<pre class="lang-cpp s-code-block"><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span>  </span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ABC</span>  
{  
<span class="hljs-keyword">public</span>:   
    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *a;  
    <span class="hljs-built_in">ABC</span>()  
     { cout&lt;&lt;<span class="hljs-string">"Constructor"</span>&lt;&lt;endl; }  
    <span class="hljs-built_in">ABC</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *ptr)  
     { cout&lt;&lt;<span class="hljs-string">"Constructor"</span>&lt;&lt;endl; }  
    <span class="hljs-built_in">ABC</span>(ABC  &amp;obj)  
     { cout&lt;&lt;<span class="hljs-string">"copy constructor"</span>&lt;&lt;endl;}  
    <span class="hljs-built_in">ABC</span>(ABC&amp;&amp; obj)  
    { cout&lt;&lt;<span class="hljs-string">"Move constructor"</span>&lt;&lt;endl; }  
    ~<span class="hljs-built_in">ABC</span>()  
    { cout&lt;&lt;<span class="hljs-string">"Destructor"</span>&lt;&lt;endl; }  
};

<span class="hljs-function">ABC <span class="hljs-title">fun123</span><span class="hljs-params">()</span>  
</span>{ ABC obj; <span class="hljs-keyword">return</span> obj; }  

<span class="hljs-function">ABC <span class="hljs-title">xyz123</span><span class="hljs-params">()</span>  
</span>{  <span class="hljs-keyword">return</span> <span class="hljs-built_in">ABC</span>(); }  

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>  
</span>{  
    ABC abc;  
    <span class="hljs-function">ABC <span class="hljs-title">obj1</span><span class="hljs-params">(fun123())</span></span>;    <span class="hljs-comment">//NRVO  </span>
    <span class="hljs-function">ABC <span class="hljs-title">obj2</span><span class="hljs-params">(xyz123())</span></span>;    <span class="hljs-comment">//RVO, not NRVO </span>
    ABC xyz = <span class="hljs-string">"Stack Overflow"</span>;<span class="hljs-comment">//RVO  </span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  
}

**Output without -fno-elide-constructors**  
root@ajay-PC:/home/ajay/c++# ./a.out   
Constructor    
Constructor  
Constructor  
Constructor  
Destructor  
Destructor  
Destructor  
Destructor  

**Output with -fno-elide-constructors**  
root@ajay-PC:/home/ajay/c++<span class="hljs-meta"># g++ -std=c++11 copy_elision.cpp -fno-elide-constructors    </span>
root@ajay-PC:/home/ajay/c++# ./a.out   
Constructor  
Constructor  
Move constructor  
Destructor  
Move constructor  
Destructor  
Constructor  
Move constructor  
Destructor  
Move constructor  
Destructor  
Constructor  
Move constructor  
Destructor  
Destructor  
Destructor  
Destructor  
Destructor  
</code></pre>
<p>Even when copy elision takes place and the copy-/move-constructor is not called, it must be present and accessible (as if no optimization happened at all), otherwise the program is ill-formed.</p>
<p>You should permit such copy elision only in places where it wont affect the observable behavior of your software. Copy elision is the only form of optimization permitted to have (i.e. elide) observable side-effects. Example:</p>
<pre class="lang-cpp s-code-block"><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span>     </span>
<span class="hljs-type">int</span> n = <span class="hljs-number">0</span>;    
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ABC</span>     
{  <span class="hljs-keyword">public</span>:  
 <span class="hljs-built_in">ABC</span>(<span class="hljs-type">int</span>) {}    
 <span class="hljs-built_in">ABC</span>(<span class="hljs-type">const</span> ABC&amp; a) { ++n; } <span class="hljs-comment">// the copy constructor has a visible side effect    </span>
};                     <span class="hljs-comment">// it modifies an object with static storage duration    </span>

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>   
</span>{  
  <span class="hljs-function">ABC <span class="hljs-title">c1</span><span class="hljs-params">(<span class="hljs-number">21</span>)</span></span>; <span class="hljs-comment">// direct-initialization, calls C::C(42)  </span>
  ABC c2 = <span class="hljs-built_in">ABC</span>(<span class="hljs-number">21</span>); <span class="hljs-comment">// copy-initialization, calls C::C( C(42) )  </span>

  std::cout &lt;&lt; n &lt;&lt; std::endl; <span class="hljs-comment">// prints 0 if the copy was elided, 1 otherwise</span>
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  
}

Output without -fno-elide-constructors  
root@ajay-PC:/home/ayadav<span class="hljs-meta"># g++ -std=c++11 copy_elision.cpp  </span>
root@ajay-PC:/home/ayadav# ./a.out   
<span class="hljs-number">0</span>

Output with -fno-elide-constructors  
root@ajay-PC:/home/ayadav<span class="hljs-meta"># g++ -std=c++11 copy_elision.cpp -fno-elide-constructors  </span>
root@ajay-PC:/home/ayadav# ./a.out   
<span class="hljs-number">1</span>
</code></pre>
<p>GCC provides the <code>-fno-elide-constructors</code> option to disable copy elision.
If you want to avoid possible copy elision, use <code>-fno-elide-constructors</code>.</p>
<p>Now almost all compilers provide copy elision when optimisation is enabled (and if no other option is set to disable it).</p>
<h1 id="conclusion">Conclusion</h1>
<p>With each copy elision, one construction and one matching destruction of the copy are omitted, thus saving CPU time, and one object is not created, thus saving space on the stack frame.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Here I give another example of copy elision that I apparently encountered today.</p>
<pre class="lang-cpp s-code-block"><code class="hljs language-cpp"><span class="hljs-meta"># <span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {
<span class="hljs-keyword">public</span>:
  <span class="hljs-type">int</span> var1;
  <span class="hljs-built_in">Obj</span>(){
    std::cout&lt;&lt;<span class="hljs-string">"In   Obj()"</span>&lt;&lt;<span class="hljs-string">"\n"</span>;
    var1 =<span class="hljs-number">2</span>;
  };
  <span class="hljs-built_in">Obj</span>(<span class="hljs-type">const</span> Obj &amp; org){
    std::cout&lt;&lt;<span class="hljs-string">"In   Obj(const Obj &amp; org)"</span>&lt;&lt;<span class="hljs-string">"\n"</span>;
    var1=org.var1+<span class="hljs-number">1</span>;
  };
};

<span class="hljs-function"><span class="hljs-type">int</span>  <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{

  {
    <span class="hljs-comment">/*const*/</span> Obj Obj_instance1;  <span class="hljs-comment">//const doesn't change anything</span>
    Obj Obj_instance2;
    std::cout&lt;&lt;<span class="hljs-string">"assignment:"</span>&lt;&lt;<span class="hljs-string">"\n"</span>;
    Obj_instance2=<span class="hljs-built_in">Obj</span>(<span class="hljs-built_in">Obj</span>(<span class="hljs-built_in">Obj</span>(<span class="hljs-built_in">Obj</span>(Obj_instance1))))   ;
    <span class="hljs-comment">// in fact expected: 6, but got 3, because of 'copy elision'</span>
    std::cout&lt;&lt;<span class="hljs-string">"Obj_instance2.var1:"</span>&lt;&lt;Obj_instance2.var1&lt;&lt;<span class="hljs-string">"\n"</span>;
  }

}

</code></pre>
<p>With the result:</p>
<pre class="lang-cpp s-code-block"><code class="hljs language-cpp"><span class="hljs-function">In   <span class="hljs-title">Obj</span><span class="hljs-params">()</span>
In   <span class="hljs-title">Obj</span><span class="hljs-params">()</span>
assignment:
In   Obj(const Obj &amp; org)
Obj_instance2.var1:<span class="hljs-number">3</span>
</span></code></pre>
    </div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;h2\u0026gt;Introduction\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;For a technical overview - \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/12953145/673730\u0026quot;\u0026gt;skip to this answer\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For common cases where copy elision occurs - \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/12953150/673730\u0026quot;\u0026gt;skip to this answer\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Copy elision is an optimization implemented by most compilers to prevent extra (potentially expensive) copies in certain situations. It makes returning by value or pass-by-value feasible in practice (restrictions apply).\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;It\u0026apos;s the only form of optimization that elides (ha!) the as-if rule - \u0026lt;strong\u0026gt;copy elision can be applied even if copying/moving the object has side-effects\u0026lt;/strong\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The following example taken from \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Return_value_optimization\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Wikipedia\u0026lt;/a\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-cpp s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;struct\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;C\u0026lt;/span\u0026gt; {\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;C\u0026lt;/span\u0026gt;() {}\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;C\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; C\u0026amp;amp;) { std::cout \u0026amp;lt;\u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;A copy was made.\\n\u0026quot;\u0026lt;/span\u0026gt;; }\n};\n \n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;C \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;f\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;C\u0026lt;/span\u0026gt;();\n}\n \n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n  std::cout \u0026amp;lt;\u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Hello World!\\n\u0026quot;\u0026lt;/span\u0026gt;;\n  C obj = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;f\u0026lt;/span\u0026gt;();\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Depending on the compiler \u0026amp;amp; settings, the following outputs \u0026lt;strong\u0026gt;are all valid\u0026lt;/strong\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;Hello World!  \u0026lt;br\u0026gt;\nA copy was made. \u0026lt;br\u0026gt;\nA copy was made. \u0026lt;br\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;Hello World! \u0026lt;br\u0026gt;\nA copy was made.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;blockquote\u0026gt;\n\u0026lt;p\u0026gt;Hello World!\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\u0026lt;p\u0026gt;This also means fewer objects can be created, so you also can\u0026apos;t rely on a specific number of destructors being called. You shouldn\u0026apos;t have critical logic inside copy/move-constructors or destructors, as you can\u0026apos;t rely on them being called.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;If a call to a copy or move constructor is elided, that constructor must still exist and must be accessible. This ensures that copy elision does not allow copying objects which are not normally copyable, e.g. because they have a private or deleted copy/move constructor.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;C++17\u0026lt;/strong\u0026gt;: As of C++17, Copy Elision is guaranteed when an object is returned directly:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-cpp s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;struct\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;C\u0026lt;/span\u0026gt; {\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;C\u0026lt;/span\u0026gt;() {}\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;C\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; C\u0026amp;amp;) { std::cout \u0026amp;lt;\u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;A copy was made.\\n\u0026quot;\u0026lt;/span\u0026gt;; }\n};\n \n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;C \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;f\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;C\u0026lt;/span\u0026gt;(); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//Definitely performs copy elision\u0026lt;/span\u0026gt;\n}\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;C \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;g\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n    C c;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; c; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//Maybe performs copy elision\u0026lt;/span\u0026gt;\n}\n \n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n  std::cout \u0026amp;lt;\u0026amp;lt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Hello World!\\n\u0026quot;\u0026lt;/span\u0026gt;;\n  C obj = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;f\u0026lt;/span\u0026gt;(); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//Copy constructor isn\u0026apos;t called\u0026lt;/span\u0026gt;\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;h2\u0026gt;Standard reference\u0026lt;/h2\u0026gt;\n\n\u0026lt;p\u0026gt;For a less technical view \u0026amp;amp; introduction - \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/12953129/673730\u0026quot;\u0026gt;skip to this answer\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For common cases where copy elision occurs - \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/12953150/673730\u0026quot;\u0026gt;skip to this answer\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Copy elision\u0026lt;/strong\u0026gt; is defined in the standard in:\u0026lt;/p\u0026gt;\n\n\u0026lt;h3\u0026gt;12.8 Copying and moving class objects [class.copy]\u0026lt;/h3\u0026gt;\n\n\u0026lt;p\u0026gt;as\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;31) When certain criteria are met, an implementation is allowed to omit the copy/move construction of a class\n  object, even if the copy/move constructor and/or destructor for the object have side effects. In such cases,\n  the implementation treats the source and target of the omitted copy/move operation as simply two different\n  ways of referring to the same object, and the destruction of that object occurs at the later of the times\n  when the two objects would have been destroyed without the optimization.\u0026lt;sup\u0026gt;123\u0026lt;/sup\u0026gt; This elision of copy/move\n  operations, called \u0026lt;em\u0026gt;copy elision\u0026lt;/em\u0026gt;, is permitted in the following circumstances (which may be combined to\n  eliminate multiple copies):\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt; in a return statement in a function with a class return type, when the expression is the name of a\n  non-volatile automatic object (other than a function or catch-clause parameter) with the same cvunqualified\n  type as the function return type, the copy/move operation can be omitted by constructing\n  the automatic object directly into the functions return value\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt; in a throw-expression, when the operand is the name of a non-volatile automatic object (other than a\n  function or catch-clause parameter) whose scope does not extend beyond the end of the innermost\n  enclosing try-block (if there is one), the copy/move operation from the operand to the exception\n  object (15.1) can be omitted by constructing the automatic object directly into the exception object\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt; when a temporary class object that has not been bound to a reference (12.2) would be copied/moved\n  to a class object with the same cv-unqualified type, the copy/move operation can be omitted by\n  constructing the temporary object directly into the target of the omitted copy/move\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt; when the exception-declaration of an exception handler (Clause 15) declares an object of the same type\n  (except for cv-qualification) as the exception object (15.1), the copy/move operation can be omitted\n  by treating the exception-declaration as an alias for the exception object if the meaning of the program\n  will be unchanged except for the execution of constructors and destructors for the object declared by\n  the exception-declaration.\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt;\u0026lt;sub\u0026gt;123) Because only one object is destroyed instead of two, and one copy/move constructor is not executed, there is still one\n  object destroyed for each one constructed.\u0026lt;/sub\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;The example given is:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-cpp s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt; {\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt;:\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;();\n  ~\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; Thing\u0026amp;amp;);\n};\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;Thing \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;f\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n  Thing t;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; t;\n}\nThing t2 = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;f\u0026lt;/span\u0026gt;();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;and explained:\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;Here the criteria for elision can be combined to eliminate two calls to the copy constructor of class \u0026lt;code\u0026gt;Thing\u0026lt;/code\u0026gt;:\n  the copying of the local automatic object \u0026lt;code\u0026gt;t\u0026lt;/code\u0026gt; into the temporary object for the return value of function \u0026lt;code\u0026gt;f()\u0026lt;/code\u0026gt;\n  and the copying of that temporary object into object \u0026lt;code\u0026gt;t2\u0026lt;/code\u0026gt;. Effectively, the construction of the local object \u0026lt;code\u0026gt;t\u0026lt;/code\u0026gt;\n  can be viewed as directly initializing the global object \u0026lt;code\u0026gt;t2\u0026lt;/code\u0026gt;, and that objects destruction will occur at program\n  exit. Adding a move constructor to Thing has the same effect, but it is the move construction from the\n  temporary object to \u0026lt;code\u0026gt;t2\u0026lt;/code\u0026gt; that is elided.\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n    ","\n\u0026lt;h2\u0026gt;Common forms of copy elision\u0026lt;/h2\u0026gt;\n\u0026lt;p\u0026gt;For a technical overview - \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/12953145/673730\u0026quot;\u0026gt;skip to this answer\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;For a less technical view \u0026amp;amp; introduction - \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/12953129/673730\u0026quot;\u0026gt;skip to this answer\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;(Named) Return value optimization is a common form of copy elision. It refers to the situation where an object returned by value from a method has its copy elided. The example set forth in the standard illustrates \u0026lt;strong\u0026gt;named return value optimization\u0026lt;/strong\u0026gt;, since the object is named.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-cpp s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt; {\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt;:\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;();\n  ~\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; Thing\u0026amp;amp;);\n};\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;Thing \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;f\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n  Thing t;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; t;\n}\nThing t2 = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;f\u0026lt;/span\u0026gt;();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Regular \u0026lt;strong\u0026gt;return value optimization\u0026lt;/strong\u0026gt; occurs when a temporary is returned:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-cpp s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt; {\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt;:\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;();\n  ~\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; Thing\u0026amp;amp;);\n};\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;Thing \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;f\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;();\n}\nThing t2 = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;f\u0026lt;/span\u0026gt;();\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Other common places where copy elision takes place is when an object is \u0026lt;strong\u0026gt;constructed from a temporary\u0026lt;/strong\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-cpp s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt; {\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt;:\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;();\n  ~\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; Thing\u0026amp;amp;);\n};\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;void\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;(Thing t)\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;;\n\nThing t2 = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;();\nThing t3 = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;()); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// two rounds of elision\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;()); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// parameter constructed from temporary\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;or when an \u0026lt;strong\u0026gt;exception is thrown and caught by value\u0026lt;/strong\u0026gt;:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-cpp s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;struct\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;{\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;();\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Thing\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; Thing\u0026amp;amp;);\n};\n \n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;void\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n  Thing c;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;throw\u0026lt;/span\u0026gt; c;\n}\n \n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt; \u0026lt;/span\u0026gt;{\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;try\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;foo\u0026lt;/span\u0026gt;();\n  }\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;catch\u0026lt;/span\u0026gt;(Thing c) {  \n  }             \n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://msdn.microsoft.com/en-us/library/ms364057%28v=vs.80%29.aspx#nrvo_cpp05_topic3\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;Common limitations of copy elision are:\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;multiple return points\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;conditional initialization\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;p\u0026gt;Most commercial-grade compilers support copy elision \u0026amp;amp; (N)RVO (depending on optimization settings). C++17 makes many of the above classes of copy elision mandatory.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Copy elision is a compiler optimization technique that eliminates unnecessary copying/moving of objects.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;In the following circumstances, a compiler is allowed to omit copy/move operations and hence not to call the associated constructor:\u0026lt;/p\u0026gt;\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;strong\u0026gt;NRVO (Named Return Value Optimization)\u0026lt;/strong\u0026gt;: If a function returns a class type by value and the return statement\u0026apos;s expression is the name of a non-volatile object with automatic storage duration (which isn\u0026apos;t a function parameter), then the copy/move that would be performed by a non-optimising compiler can be omitted. If so, the returned value is constructed directly in the storage to which the function\u0026apos;s return value would otherwise be moved or copied.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;strong\u0026gt;RVO (Return Value Optimization)\u0026lt;/strong\u0026gt;: If the function returns a nameless temporary object that would be moved or copied into the destination by a naive compiler, the copy or move can be omitted as per 1.\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-cpp s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;#\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;include\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026amp;lt;iostream\u0026amp;gt;\u0026lt;/span\u0026gt;  \u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;namespace\u0026lt;/span\u0026gt; std;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ABC\u0026lt;/span\u0026gt;  \n{  \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt;:   \n    \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;char\u0026lt;/span\u0026gt; *a;  \n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;ABC\u0026lt;/span\u0026gt;()  \n     { cout\u0026amp;lt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Constructor\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;lt;endl; }  \n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;ABC\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;char\u0026lt;/span\u0026gt; *ptr)  \n     { cout\u0026amp;lt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Constructor\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;lt;endl; }  \n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;ABC\u0026lt;/span\u0026gt;(ABC  \u0026amp;amp;obj)  \n     { cout\u0026amp;lt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;copy constructor\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;lt;endl;}  \n    \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;ABC\u0026lt;/span\u0026gt;(ABC\u0026amp;amp;\u0026amp;amp; obj)  \n    { cout\u0026amp;lt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Move constructor\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;lt;endl; }  \n    ~\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;ABC\u0026lt;/span\u0026gt;()  \n    { cout\u0026amp;lt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Destructor\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;lt;endl; }  \n};\n\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;ABC \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;fun123\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt;  \n\u0026lt;/span\u0026gt;{ ABC obj; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; obj; }  \n\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;ABC \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;xyz123\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt;  \n\u0026lt;/span\u0026gt;{  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;ABC\u0026lt;/span\u0026gt;(); }  \n\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt;  \n\u0026lt;/span\u0026gt;{  \n    ABC abc;  \n    \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;ABC \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;obj1\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;(fun123())\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;;    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//NRVO  \u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;ABC \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;obj2\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;(xyz123())\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;;    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//RVO, not NRVO \u0026lt;/span\u0026gt;\n    ABC xyz = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Stack Overflow\u0026quot;\u0026lt;/span\u0026gt;;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//RVO  \u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;  \n}\n\n**Output without -fno-elide-constructors**  \nroot@ajay-PC:/home/ajay/c++# ./a.out   \nConstructor    \nConstructor  \nConstructor  \nConstructor  \nDestructor  \nDestructor  \nDestructor  \nDestructor  \n\n**Output with -fno-elide-constructors**  \nroot@ajay-PC:/home/ajay/c++\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# g++ -std=c++11 copy_elision.cpp -fno-elide-constructors    \u0026lt;/span\u0026gt;\nroot@ajay-PC:/home/ajay/c++# ./a.out   \nConstructor  \nConstructor  \nMove constructor  \nDestructor  \nMove constructor  \nDestructor  \nConstructor  \nMove constructor  \nDestructor  \nMove constructor  \nDestructor  \nConstructor  \nMove constructor  \nDestructor  \nDestructor  \nDestructor  \nDestructor  \nDestructor  \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Even when copy elision takes place and the copy-/move-constructor is not called, it must be present and accessible (as if no optimization happened at all), otherwise the program is ill-formed.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;You should permit such copy elision only in places where it wont affect the observable behavior of your software. Copy elision is the only form of optimization permitted to have (i.e. elide) observable side-effects. Example:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-cpp s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;#\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;include\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026amp;lt;iostream\u0026amp;gt;\u0026lt;/span\u0026gt;     \u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; n = \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;    \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;ABC\u0026lt;/span\u0026gt;     \n{  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt;:  \n \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;ABC\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;) {}    \n \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;ABC\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; ABC\u0026amp;amp; a) { ++n; } \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// the copy constructor has a visible side effect    \u0026lt;/span\u0026gt;\n};                     \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// it modifies an object with static storage duration    \u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt;   \n\u0026lt;/span\u0026gt;{  \n  \u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;ABC \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;c1\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;21\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// direct-initialization, calls C::C(42)  \u0026lt;/span\u0026gt;\n  ABC c2 = \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;ABC\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;21\u0026lt;/span\u0026gt;); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// copy-initialization, calls C::C( C(42) )  \u0026lt;/span\u0026gt;\n\n  std::cout \u0026amp;lt;\u0026amp;lt; n \u0026amp;lt;\u0026amp;lt; std::endl; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// prints 0 if the copy was elided, 1 otherwise\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;;  \n}\n\nOutput without -fno-elide-constructors  \nroot@ajay-PC:/home/ayadav\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# g++ -std=c++11 copy_elision.cpp  \u0026lt;/span\u0026gt;\nroot@ajay-PC:/home/ayadav# ./a.out   \n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n\nOutput with -fno-elide-constructors  \nroot@ajay-PC:/home/ayadav\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# g++ -std=c++11 copy_elision.cpp -fno-elide-constructors  \u0026lt;/span\u0026gt;\nroot@ajay-PC:/home/ayadav# ./a.out   \n\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;GCC provides the \u0026lt;code\u0026gt;-fno-elide-constructors\u0026lt;/code\u0026gt; option to disable copy elision.\nIf you want to avoid possible copy elision, use \u0026lt;code\u0026gt;-fno-elide-constructors\u0026lt;/code\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Now almost all compilers provide copy elision when optimisation is enabled (and if no other option is set to disable it).\u0026lt;/p\u0026gt;\n\u0026lt;h1 id=\u0026quot;conclusion\u0026quot;\u0026gt;Conclusion\u0026lt;/h1\u0026gt;\n\u0026lt;p\u0026gt;With each copy elision, one construction and one matching destruction of the copy are omitted, thus saving CPU time, and one object is not created, thus saving space on the stack frame.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Here I give another example of copy elision that I apparently encountered today.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-cpp s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-meta\u0026quot;\u0026gt;# \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;include\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026amp;lt;iostream\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;\n\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;class\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-title class_\u0026quot;\u0026gt;Obj\u0026lt;/span\u0026gt; {\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt;:\n  \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; var1;\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Obj\u0026lt;/span\u0026gt;(){\n    std::cout\u0026amp;lt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;In   Obj()\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\\n\u0026quot;\u0026lt;/span\u0026gt;;\n    var1 =\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;;\n  };\n  \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Obj\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;const\u0026lt;/span\u0026gt; Obj \u0026amp;amp; org){\n    std::cout\u0026amp;lt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;In   Obj(const Obj \u0026amp;amp; org)\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\\n\u0026quot;\u0026lt;/span\u0026gt;;\n    var1=org.var1+\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;;\n  };\n};\n\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;main\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt;\u0026lt;/span\u0026gt;{\n\n  {\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;/*const*/\u0026lt;/span\u0026gt; Obj Obj_instance1;  \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//const doesn\u0026apos;t change anything\u0026lt;/span\u0026gt;\n    Obj Obj_instance2;\n    std::cout\u0026amp;lt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;assignment:\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\\n\u0026quot;\u0026lt;/span\u0026gt;;\n    Obj_instance2=\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Obj\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Obj\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Obj\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Obj\u0026lt;/span\u0026gt;(Obj_instance1))))   ;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// in fact expected: 6, but got 3, because of \u0026apos;copy elision\u0026apos;\u0026lt;/span\u0026gt;\n    std::cout\u0026amp;lt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Obj_instance2.var1:\u0026quot;\u0026lt;/span\u0026gt;\u0026amp;lt;\u0026amp;lt;Obj_instance2.var1\u0026amp;lt;\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;\\n\u0026quot;\u0026lt;/span\u0026gt;;\n  }\n\n}\n\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;With the result:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-cpp s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-cpp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;In   \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;Obj\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt;\nIn   \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;Obj\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;()\u0026lt;/span\u0026gt;\nassignment:\nIn   Obj(const Obj \u0026amp;amp; org)\nObj_instance2.var1:\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;\n\u0026lt;/span\u0026gt;\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    "],"comment":["\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Copy elision is one way to look at it; object elision or object fusion (or confusion) is another view.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/963864/curiousguy\u0026quot; title=\u0026quot;7,758 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;curiousguy\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment52315626_12953127\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-08-25 23:58:16Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 25, 2015 at 23:58\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;I found this \u0026lt;a href=\u0026quot;https://shaharmike.com/cpp/rvo/\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;link\u0026lt;/a\u0026gt; helpful.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/6740589/subtleseeker\u0026quot; title=\u0026quot;3,130 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;subtleseeker\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment107001424_12953127\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2020-03-02 08:30:15Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Mar 2, 2020 at 8:30\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;could you plz explain when is the 2nd output happen and when the 3rd?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1150712/zhangxaochen\u0026quot; title=\u0026quot;21,281 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;zhangxaochen\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment37568521_12953129\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2014-06-19 14:00:49Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jun 19, 2014 at 14:00\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@zhangxaochen when and how the compiler decides to optimize that way.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/673730/luchian-grigore\u0026quot; title=\u0026quot;246,211 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;Luchian Grigore\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment37571540_12953129\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2014-06-19 15:11:00Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jun 19, 2014 at 15:11\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@zhangxaochen, 1st output: copy 1 is from the return to a temp, and copy 2 from temp to obj; 2nd is when one of the above is optimezed, probably the reutnr copy is elided; the thris both are elided\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1836773/victor\u0026quot; title=\u0026quot;1,490 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;victor\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment42183605_12953129\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2014-11-07 16:06:46Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Nov 7, 2014 at 16:06\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Hmm, but in my opinion, this MUST be a feature we can rely on. Because if we can\u0026apos;t, it would severely affect the way we implement our functions in modern C++ (RVO vs std::move). During watching some of the CppCon 2014 videos, i really got the impression that all modern compilers always do RVO. Furthermore, I\u0026apos;ve read somewhere that also without any optimizations on, the compilers apply it. But, of course, I am not sure about it. That\u0026apos;s why I am asking.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/387023/j00hi\u0026quot; title=\u0026quot;4,966 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;j00hi\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment45023098_12953129\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-02-05 08:02:36Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Feb 5, 2015 at 8:02\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@j00hi: Never write move in a return statement - if rvo is not applied, the return value is moved out by default  anyway.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2881849/mikemb\u0026quot; title=\u0026quot;18,937 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;MikeMB\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment46163046_12953129\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-03-10 01:32:30Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Mar 10, 2015 at 1:32\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Is that from the C++17 standard or from an earlier version?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/44232/nils\u0026quot; title=\u0026quot;12,842 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Nils\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment98688997_12953145\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2019-05-07 12:29:13Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;May 7, 2019 at 12:29\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Why can\u0026apos;t function parameter be return value optimized if it\u0026apos;s the same type as function\u0026apos;s return type?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/981766/sahil-singh\u0026quot; title=\u0026quot;2,895 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Sahil Singh\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment110514354_12953145\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2020-06-20 19:26:01Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jun 20, 2020 at 19:26\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;This tries to answer - \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/9444485/why-is-rvo-disallowed-when-returning-a-parameter\u0026quot; title=\u0026quot;why is rvo disallowed when returning a parameter\u0026quot;\u0026gt;stackoverflow.com/questions/9444485/\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/981766/sahil-singh\u0026quot; title=\u0026quot;2,895 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Sahil Singh\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment110514790_12953145\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2020-06-20 19:48:14Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jun 20, 2020 at 19:48\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Is there any type of copy-elision for primitive types? If I have a function that propagates a return value (maybe an error code), will there be any optimisation similar to objects?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/6459731/warhead\u0026quot; title=\u0026quot;611 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;WARhead\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment111808939_12953145\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2020-08-03 12:50:29Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 3, 2020 at 12:50\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;I\u0026apos;d be interested in seeing the \u0026quot;Common limitations\u0026quot; bullet points explained just a little bit... what makes these limiting factors?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1245420/phonetagger\u0026quot; title=\u0026quot;7,481 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;phonetagger\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment19973919_12953150\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-01-16 17:54:02Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 16, 2013 at 17:54\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;@phonetagger I linked against the msdn article, hope that clears some stuff out.\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/673730/luchian-grigore\u0026quot; title=\u0026quot;246,211 reputation\u0026quot; class=\u0026quot;comment-user owner\u0026quot;\u0026gt;Luchian Grigore\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment19976231_12953150\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2013-01-16 19:11:46Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Jan 16, 2013 at 19:11\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;the statement     \u0026lt;code\u0026gt;ABC obj2(xyz123());\u0026lt;/code\u0026gt; is it NRVO or RVO? is it not getting temporary variable/object same as     \u0026lt;code\u0026gt;ABC xyz = \u0026quot;Stack Overflow\u0026quot;;//RVO  \u0026lt;/code\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/2769917/asif-mushtaq\u0026quot; title=\u0026quot;3,350 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Asif Mushtaq\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment52404637_27916892\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2015-08-28 02:45:20Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 28, 2015 at 2:45\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;To have a more concrete illustration of RVO, you can refer to the assembly that the compiler generates (change the compiler flag -fno-elide-constructors to see the diff). \u0026lt;a href=\u0026quot;https://godbolt.org/g/Y2KcdH\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;godbolt.org/g/Y2KcdH\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/4679727/gab%e6%98%af%e5%a5%bd%e4%ba%ba\u0026quot; title=\u0026quot;1,786 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Gab\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment69109376_27916892\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2016-12-03 16:18:33Z, License: CC BY-SA 3.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Dec 3, 2016 at 16:18\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;Isn\u0026apos;t ABC xyz = \u0026quot;Stack Overflow\u0026quot;; just an implicit call to ABC::ABC(const char *ptr) rather than RVO?\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/1079475/user1079475\u0026quot; title=\u0026quot;379 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;user1079475\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment112503118_27916892\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2020-08-27 17:42:40Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Aug 27, 2020 at 17:42\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n                        \u0026lt;span title=\u0026quot;this comment was edited 1 time\u0026quot;\u0026gt;\n                            \u0026lt;svg aria-hidden=\u0026quot;true\u0026quot; class=\u0026quot;va-text-bottom o50 svg-icon iconPencilSm\u0026quot; width=\u0026quot;14\u0026quot; height=\u0026quot;14\u0026quot; viewBox=\u0026quot;0 0 14 14\u0026quot;\u0026gt;\u0026lt;path d=\u0026quot;m11.1 1.71 1.13 1.12c.2.2.2.51 0 .71L11.1 4.7 9.21 2.86l1.17-1.15c.2-.2.51-.2.71 0ZM2 10.12l6.37-6.43 1.88 1.88L3.88 12H2v-1.88Z\u0026quot;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;/svg\u0026gt;\n                        \u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        ","\n            \u0026lt;div class=\u0026quot;comment-body js-comment-edit-hide\u0026quot;\u0026gt;\n                \n                \u0026lt;span class=\u0026quot;comment-copy\u0026quot;\u0026gt;That\u0026apos;s already included in Luchian\u0026apos;s answer (temporary object passed by value).\u0026lt;/span\u0026gt;\n                \n              \u0026lt;div class=\u0026quot;d-inline-flex ai-center\u0026quot;\u0026gt;\n\u0026amp;nbsp;\u0026lt;a href=\u0026quot;/users/4850040/toby-speight\u0026quot; title=\u0026quot;25,310 reputation\u0026quot; class=\u0026quot;comment-user\u0026quot;\u0026gt;Toby Speight\u0026lt;/a\u0026gt;\n                \u0026lt;/div\u0026gt;\n                \u0026lt;span class=\u0026quot;comment-date\u0026quot; dir=\u0026quot;ltr\u0026quot;\u0026gt;\u0026lt;a class=\u0026quot;comment-link\u0026quot; href=\u0026quot;#comment115668782_64373782\u0026quot;\u0026gt;\u0026lt;span title=\u0026quot;2020-12-23 13:45:00Z, License: CC BY-SA 4.0\u0026quot; class=\u0026quot;relativetime-clean\u0026quot;\u0026gt;Dec 23, 2020 at 13:45\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/span\u0026gt;\n            \u0026lt;/div\u0026gt;\n        "],"id":191,"title":"What are copy elision and return value optimization?","content":"\n                \n\u0026lt;p\u0026gt;What is copy elision? What is (named) return value optimization? What do they imply?\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;In what situations can they occur? What are limitations?\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;If you were referenced to this question, you\u0026apos;re probably looking for \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/12953129/673730\u0026quot;\u0026gt;\u0026lt;strong\u0026gt;the introduction\u0026lt;/strong\u0026gt;\u0026lt;/a\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;For a technical overview, see \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/12953145/673730\u0026quot;\u0026gt;\u0026lt;strong\u0026gt;the standard reference\u0026lt;/strong\u0026gt;\u0026lt;/a\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;See \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/12953150/673730\u0026quot;\u0026gt;\u0026lt;strong\u0026gt;common cases\u0026lt;/strong\u0026gt; here\u0026lt;/a\u0026gt;.\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n    ","slug":"what-are-copy-elision-and-return-value-optimization-1657385455976","postType":"QUESTION","createdAt":"2022-07-09T16:50:55.000Z","updatedAt":"2022-07-09T16:50:55.000Z","tags":[{"id":1400,"name":"optimization","slug":"optimization","createdAt":"2022-07-09T16:50:56.000Z","updatedAt":"2022-07-09T16:50:56.000Z","Questions_Tags":{"questionId":191,"tagId":1400}},{"id":1402,"name":"return-value-optimization","slug":"return-value-optimization","createdAt":"2022-07-09T16:50:56.000Z","updatedAt":"2022-07-09T16:50:56.000Z","Questions_Tags":{"questionId":191,"tagId":1402}},{"id":1403,"name":"copy-elision","slug":"copy-elision","createdAt":"2022-07-09T16:50:56.000Z","updatedAt":"2022-07-09T16:50:56.000Z","Questions_Tags":{"questionId":191,"tagId":1403}}]}},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"what-are-copy-elision-and-return-value-optimization-1657385455976"},"buildId":"4Y8KGE-c2lolBeBmcum_I","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>