<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/2eccd4d47c856f2b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2eccd4d47c856f2b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-cb7634a8b6194820.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-25e5079ab4bd6ecd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-20edbe0b078add93.js" defer=""></script><script src="/_next/static/chunks/29107295-fbcfe2172188e46f.js" defer=""></script><script src="/_next/static/chunks/613-1e0aa2b2023820bb.js" defer=""></script><script src="/_next/static/chunks/495-bb1d5b202c02d7f2.js" defer=""></script><script src="/_next/static/chunks/471-84c36aa98dd4107c.js" defer=""></script><script src="/_next/static/chunks/81-301f760ac8107464.js" defer=""></script><script src="/_next/static/chunks/pages/questions/%5Bslug%5D-76d2c3e2d98bb08b.js" defer=""></script><script src="/_next/static/6_hwtyf_oFlFS5l_S4CTe/_buildManifest.js" defer=""></script><script src="/_next/static/6_hwtyf_oFlFS5l_S4CTe/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">.eZIPKL code{padding:5px;color:hsl(210deg 8% 15%);background-color:hsl(210deg 8% 90%);border-radius:3px;}/*!sc*/
data-styled.g5[id="sc-c4b0431a-0"]{content:"eZIPKL,"}/*!sc*/
</style></head><body><div id="__next"><div class="sc-9099c029-0 cIPEih"><header><nav class="bg-white border-gray-200 px-4 lg:px-6 py-2.5 dark:bg-gray-800"><div class="flex flex-wrap justify-between items-center mx-auto max-w-screen-xl"><a class="flex items-center" href="/"><img src="https://flowbite.com/docs/images/logo.svg" class="mr-3 h-6 sm:h-9" alt="Flowbite Logo"/><span class="self-center text-xl font-semibold whitespace-nowrap dark:text-white">Solution Hunter</span></a><div class="flex items-center lg:order-2"><button data-collapse-toggle="mobile-menu-2" type="button" class="inline-flex items-center p-2 ml-1 text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="mobile-menu-2" aria-expanded="false"><span class="sr-only">Open main menu</span><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg><svg class="hidden w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="hidden justify-between items-center w-full lg:flex lg:w-auto lg:order-1" id="mobile-menu-2"><ul class="flex flex-col mt-4 font-medium lg:flex-row lg:space-x-8 lg:mt-0"><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" aria-current="page" href="/">Home</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions?tab=news">Questions</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/post?tab=news">Post</a></li><li><a class="block py-2 pr-4 pl-3 text-gray-700 border-b border-gray-100 hover:bg-gray-50 lg:hover:bg-transparent lg:border-0 lg:hover:text-blue-700 lg:p-0 dark:text-gray-400 lg:dark:hover:text-white dark:hover:bg-gray-700 dark:hover:text-white lg:dark:hover:bg-transparent dark:border-gray-700" href="/questions/parameterize-an-sql-in-clause-1657387536064#">Coding</a></li></ul></div></div></nav></header><div class="main-content"><div class="sc-c5440139-0 figLul question my-5"><div class="sc-c4b0431a-0 eZIPKL flex question-header items-center justify-center"><div class="rounded-xl border p-5 shadow-md w-9/12 bg-white"><div class="flex w-full items-center justify-between border-b pb-3"><div class="flex items-center space-x-3"><div class="text-lg font-bold text-slate-700"><a href="/questions/parameterize-an-sql-in-clause-1657387536064">Parameterize an SQL IN clause</a></div></div><div class="flex flex-wrap h-auto justify-end items-center space-x-8"><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/sql-server-2008">sql-server-2008</a><a class="rounded-2xl border bg-neutral-100 px-3 py-1 text-sm font-semibold" href="/questions/tag/parameters">parameters</a></div></div><div class="question-content mt-5">
                
<p>How do I parameterize a query containing an <code>IN</code> clause with a variable number of arguments, like this one?</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> Tags 
<span class="hljs-keyword">WHERE</span> Name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'ruby'</span>,<span class="hljs-string">'rails'</span>,<span class="hljs-string">'scruffy'</span>,<span class="hljs-string">'rubyonrails'</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> Count <span class="hljs-keyword">DESC</span>
</code></pre>

<p>In this query, the number of arguments could be anywhere from 1 to 5.</p>

<p>I would prefer not to use a dedicated stored procedure for this (or XML), but if there is some elegant way specific to <a href="http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2008" rel="noreferrer">SQL Server 2008</a>, I am open to that.</p>
    </div></div></div><div class="sc-c4b0431a-2 cRqwQe"><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 1</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You can parameterize <em>each</em> value, so something like:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">string[] tags <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> string[] { "ruby", "rails", "scruffy", "rubyonrails" };
string cmdText <span class="hljs-operator">=</span> "SELECT * FROM Tags WHERE Name IN ({0})";

string[] paramNames <span class="hljs-operator">=</span> tags.Select(
    (s, i) <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> "@tag" <span class="hljs-operator">+</span> i.ToString()
).ToArray();

string inClause <span class="hljs-operator">=</span> string.Join(", ", paramNames);
<span class="hljs-keyword">using</span> (SqlCommand cmd <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> SqlCommand(string.Format(cmdText, inClause))) {
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i <span class="hljs-operator">&lt;</span> paramNames.Length; i<span class="hljs-operator">+</span><span class="hljs-operator">+</span>) {
       cmd.Parameters.AddWithValue(paramNames[i], tags[i]);
    }
}
</code></pre>

<p>Which will give you:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">cmd.CommandText <span class="hljs-operator">=</span> "SELECT * FROM Tags WHERE Name IN (@tag0, @tag1, @tag2, @tag3)"
cmd.Parameters["@tag0"] <span class="hljs-operator">=</span> "ruby"
cmd.Parameters["@tag1"] <span class="hljs-operator">=</span> "rails"
cmd.Parameters["@tag2"] <span class="hljs-operator">=</span> "scruffy"
cmd.Parameters["@tag3"] <span class="hljs-operator">=</span> "rubyonrails"
</code></pre>

<p>No, this is not open to <a href="http://en.wikipedia.org/wiki/SQL_injection" rel="noreferrer">SQL injection</a>. The only injected text into CommandText is not based on user input. It's solely based on the hardcoded "@tag" prefix, and the index of an array. The index will <em>always</em> be an integer, is not user generated, and is safe.</p>

<p>The user inputted values are still stuffed into parameters, so there is no vulnerability there.</p>

<p>Edit:</p>

<blockquote>
  <p>Injection concerns aside, take care to note that constructing the command text to accomodate a variable number of parameters (as above) impede's SQL server's ability to take advantage of cached queries. The net result is that you almost certainly lose the value of using parameters in the first place (as opposed to merely inserting the predicate strings into the SQL itself).</p>
</blockquote>

<p>Not that cached query plans aren't valuable, but IMO this query isn't nearly complicated enough to see much benefit from it. While the compilation costs may approach (or even exceed) the execution costs, you're still talking milliseconds. </p>

<p>If you have enough RAM, I'd expect SQL&nbsp;Server would probably cache a plan for the common counts of parameters as well. I suppose you could always add five parameters, and let the unspecified tags be NULL - the query plan should be the same, but it seems pretty ugly to me and I'm not sure that it'd worth the micro-optimization (although, on Stack&nbsp;Overflow - it may very well be worth it).</p>

<p>Also, SQL&nbsp;Server 7 and later will <a href="http://msdn.microsoft.com/en-us/library/aa175264(SQL.80).aspx" rel="noreferrer">auto-parameterize queries</a>, so using parameters isn't really necessary from a performance standpoint - it is, however, <em>critical</em> from a security standpoint - especially with user inputted data like this.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 2</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Here's a quick-and-dirty technique I have used:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> Tags
<span class="hljs-keyword">WHERE</span> <span class="hljs-string">'|ruby|rails|scruffy|rubyonrails|'</span>
<span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%|'</span> <span class="hljs-operator">+</span> Name <span class="hljs-operator">+</span> <span class="hljs-string">'|%'</span>
</code></pre>

<p>So here's the C# code:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">string[] tags <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> string[] { "ruby", "rails", "scruffy", "rubyonrails" };
const string cmdText <span class="hljs-operator">=</span> "select * from tags where '|' + @tags + '|' like '%|' + Name + '|%'";

<span class="hljs-keyword">using</span> (SqlCommand cmd <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> SqlCommand(cmdText)) {
   cmd.Parameters.AddWithValue("@tags", string.Join("|", tags);
}
</code></pre>

<p>Two caveats:</p>

<ul>
<li>The performance is terrible. <code>LIKE "%...%"</code> queries are not indexed.</li>
<li>Make sure you don't have any <code>|</code>, blank, or null tags or this won't work</li>
</ul>

<p>There are other ways to accomplish this that some people may consider cleaner, so please keep reading.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 3</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>For SQL Server 2008, you can use a <a href="http://msdn.microsoft.com/en-us/library/bb675163.aspx" rel="noreferrer">table valued parameter</a>. It's a bit of work, but it is arguably cleaner than <a href="https://stackoverflow.com/questions/337704/parameterizing-a-sql-in-clause#337792">my other method</a>.</p>
<p>First, you have to create a type</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">CREATE</span> TYPE dbo.TagNamesTableType <span class="hljs-keyword">AS</span> <span class="hljs-keyword">TABLE</span> ( Name nvarchar(<span class="hljs-number">50</span>) )
</code></pre>
<p>Then, your ADO.NET code looks like this:</p>
<pre class="lang-cs s-code-block"><code class="hljs language-csharp"><span class="hljs-built_in">string</span>[] tags = <span class="hljs-keyword">new</span> <span class="hljs-built_in">string</span>[] { <span class="hljs-string">"ruby"</span>, <span class="hljs-string">"rails"</span>, <span class="hljs-string">"scruffy"</span>, <span class="hljs-string">"rubyonrails"</span> };
cmd.CommandText = <span class="hljs-string">"SELECT Tags.* FROM Tags JOIN @tagNames as P ON Tags.Name = P.Name"</span>;

<span class="hljs-comment">// value must be IEnumerable&lt;SqlDataRecord&gt;</span>
cmd.Parameters.AddWithValue(<span class="hljs-string">"@tagNames"</span>, tags.AsSqlDataRecord(<span class="hljs-string">"Name"</span>)).SqlDbType = SqlDbType.Structured;
cmd.Parameters[<span class="hljs-string">"@tagNames"</span>].TypeName = <span class="hljs-string">"dbo.TagNamesTableType"</span>;

<span class="hljs-comment">// Extension method for converting IEnumerable&lt;string&gt; to IEnumerable&lt;SqlDataRecord&gt;</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IEnumerable&lt;SqlDataRecord&gt; <span class="hljs-title">AsSqlDataRecord</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> IEnumerable&lt;<span class="hljs-built_in">string</span>&gt; values, <span class="hljs-built_in">string</span> columnName</span>)</span> {
    <span class="hljs-keyword">if</span> (values == <span class="hljs-literal">null</span> || !values.Any()) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// Annoying, but SqlClient wants null instead of 0 rows</span>
    <span class="hljs-keyword">var</span> firstRecord = values.First();
    <span class="hljs-keyword">var</span> metadata= <span class="hljs-keyword">new</span> SqlMetaData(columnName, SqlDbType.NVarChar, <span class="hljs-number">50</span>); <span class="hljs-comment">//50 as per SQL Type</span>
    <span class="hljs-keyword">return</span> values.Select(v =&gt; 
    {
       <span class="hljs-keyword">var</span> r = <span class="hljs-keyword">new</span> SqlDataRecord(metadata);
       r.SetValues(v);
       <span class="hljs-keyword">return</span> r;
    });
}
</code></pre>
<p><strong>Update</strong>
As Per @Doug</p>
<p>Please try to avoid <code>var metadata = SqlMetaData.InferFromValue(firstRecord, columnName);</code></p>
<p>It's set first value length, so if first value is 3 characters then its set max length 3 and other records will truncated if more then 3 characters.</p>
<p>So, please try to use: <code>var metadata= new SqlMetaData(columnName, SqlDbType.NVarChar, maxLen);</code></p>
<p>Note: <code>-1</code> for max length.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 4</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The original question was <strong>"How do I parameterize a query ..."</strong></p>
<p>This is <strong>not an answer</strong> to that original question. There are some very good demonstrations of how to do that, in other answers.</p>
<p>See the <a href="https://stackoverflow.com/a/337864">answer from Mark Brackett</a> for the preferred answer that I (and 231 others) upvoted. The approach given in his answer allows 1) for effective use of bind variables, and 2) for predicates that are sargable.</p>
<p><strong>Selected answer</strong></p>
<p>I am addressing here the approach given in Joel Spolsky's answer, the answer "selected" as the right answer.</p>
<p>Joel Spolsky's approach is clever.  And it works reasonably, it's going to exhibit predictable behavior and predictable performance, given "normal" values, and with the normative edge cases, such as NULL and the empty string.  And it may be sufficient for a particular application.</p>
<p>But in terms generalizing this approach, let's also consider the more obscure corner cases, like when the <code>Name</code> column contains a wildcard character (as recognized by the LIKE predicate.)  The wildcard character I see most commonly used is <code>%</code> (a percent sign.). So let's deal with that here now, and later go on to other cases.</p>
<p><strong>Some problems with % character</strong></p>
<p>Consider a Name value of <code>'pe%ter'</code>.  (For the examples here, I use a literal string value in place of the column name.)  A row with a Name value of `'pe%ter' would be returned by a query of the form:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> ...
 <span class="hljs-keyword">where</span> <span class="hljs-string">'|peanut|butter|'</span> <span class="hljs-keyword">like</span> <span class="hljs-string">'%|'</span> <span class="hljs-operator">+</span> <span class="hljs-string">'pe%ter'</span> <span class="hljs-operator">+</span> <span class="hljs-string">'|%'</span>
</code></pre>
<p>But that same row will <strong>not</strong> be returned if the order of the search terms is reversed:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> ...
 <span class="hljs-keyword">where</span> <span class="hljs-string">'|butter|peanut|'</span> <span class="hljs-keyword">like</span> <span class="hljs-string">'%|'</span> <span class="hljs-operator">+</span> <span class="hljs-string">'pe%ter'</span> <span class="hljs-operator">+</span> <span class="hljs-string">'|%'</span>
</code></pre>
<p>The behavior we observe is kind of odd.  Changing the order of the search terms in the list changes the result set.</p>
<p>It almost goes without saying that we might not want <code>pe%ter</code> to match peanut butter, no matter how much he likes it.</p>
<p><strong>Obscure corner case</strong></p>
<p>(Yes, I will agree that this is an obscure case.  Probably one that is not likely to be tested.  We wouldn't expect a wildcard in a column value.  We may assume that the application prevents such a value from being stored.  But in my experience, I've rarely seen a database constraint that specifically disallowed characters or patterns that would be considered wildcards on the right side of a <code>LIKE</code> comparison operator.</p>
<p><strong>Patching a hole</strong></p>
<p>One approach to patching this hole is to escape the <code>%</code> wildcard character.  (For anyone not familiar with the escape clause on the operator, here's a link to the <a href="http://msdn.microsoft.com/en-us/library/aa933232(SQL.80).aspx" rel="nofollow noreferrer">SQL Server documentation</a>.</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> ...
 <span class="hljs-keyword">where</span> <span class="hljs-string">'|peanut|butter|'</span>
  <span class="hljs-keyword">like</span> <span class="hljs-string">'%|'</span> <span class="hljs-operator">+</span> <span class="hljs-string">'pe\%ter'</span> <span class="hljs-operator">+</span> <span class="hljs-string">'|%'</span> <span class="hljs-keyword">escape</span> <span class="hljs-string">'\'</span>
</code></pre>
<p>Now we can match the literal %.  Of course, when we have a column name, we're going to need to dynamically escape the wildcard.  We can use the <code>REPLACE</code> function to find occurrences of the <code>% </code>character and insert a backslash character in front of each one, like this:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> ...
 <span class="hljs-keyword">where</span> <span class="hljs-string">'|pe%ter|'</span>
  <span class="hljs-keyword">like</span> <span class="hljs-string">'%|'</span> <span class="hljs-operator">+</span> REPLACE( <span class="hljs-string">'pe%ter'</span> ,<span class="hljs-string">'%'</span>,<span class="hljs-string">'\%'</span>) <span class="hljs-operator">+</span> <span class="hljs-string">'|%'</span> <span class="hljs-keyword">escape</span> <span class="hljs-string">'\'</span>
</code></pre>
<p>So that solves the problem with the % wildcard.  Almost.</p>
<p><strong>Escape the escape</strong></p>
<p>We recognize that our solution has introduced another problem.  The escape character.  We see that we're also going to need to escape any occurrences of escape character itself.  This time, we use the ! as the escape character:</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> ...
 <span class="hljs-keyword">where</span> <span class="hljs-string">'|pe%t!r|'</span>
  <span class="hljs-keyword">like</span> <span class="hljs-string">'%|'</span> <span class="hljs-operator">+</span> REPLACE(REPLACE( <span class="hljs-string">'pe%t!r'</span> ,<span class="hljs-string">'!'</span>,<span class="hljs-string">'!!'</span>),<span class="hljs-string">'%'</span>,<span class="hljs-string">'!%'</span>) <span class="hljs-operator">+</span> <span class="hljs-string">'|%'</span> <span class="hljs-keyword">escape</span> <span class="hljs-string">'!'</span>
</code></pre>
<p><strong>The underscore too</strong></p>
<p>Now that we're on a roll, we can add another <code>REPLACE</code> handle the underscore wildcard.   And just for fun, this time, we'll use $ as the escape character.</p>
<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> ...
 <span class="hljs-keyword">where</span> <span class="hljs-string">'|p_%t!r|'</span>
  <span class="hljs-keyword">like</span> <span class="hljs-string">'%|'</span> <span class="hljs-operator">+</span> REPLACE(REPLACE(REPLACE( <span class="hljs-string">'p_%t!r'</span> ,<span class="hljs-string">'$'</span>,<span class="hljs-string">'$$'</span>),<span class="hljs-string">'%'</span>,<span class="hljs-string">'$%'</span>),<span class="hljs-string">'_'</span>,<span class="hljs-string">'$_'</span>) <span class="hljs-operator">+</span> <span class="hljs-string">'|%'</span> <span class="hljs-keyword">escape</span> <span class="hljs-string">'$'</span>
</code></pre>
<p>I prefer this approach to escaping because it works in Oracle and MySQL as well as SQL Server.  (I usually use the \ backslash as the escape character, since that's the character we use in regular expressions. But why be constrained by convention!</p>
<p><strong>Those pesky brackets</strong></p>
<p>SQL Server also allows for wildcard characters to be treated as literals by enclosing them in brackets <code>[]</code>.  So we're not done fixing yet, at least for SQL Server.  Since pairs of brackets have special meaning, we'll need to escape those as well.  If we manage to properly escape the brackets, then at least we won't have to bother with the hyphen <code>-</code> and the carat <code>^</code> within the brackets.  And we can leave any <code>% </code>and <code>_</code> characters inside the brackets escaped, since we'll have basically disabled the special meaning of the brackets.</p>
<p>Finding matching pairs of brackets shouldn't be that hard.  It's a little more difficult than handling the occurrences of singleton % and _.  (Note that it's not sufficient to just escape all occurrences of brackets, because a singleton bracket is considered to be a literal, and doesn't need to be escaped. The logic is getting a little fuzzier than I can handle without running more test cases.)</p>
<p><strong>Inline expression gets messy</strong></p>
<p>That inline expression in the SQL is getting longer and uglier.  We can probably make it work, but heaven help the poor soul that comes behind and has to decipher it.  As much of a fan I am for inline expressions, I'm inclined not use one here, mainly because I don't want to have to leave a comment explaining the reason for the mess, and apologizing for it.</p>
<p><strong>A function where ?</strong></p>
<p>Okay, so, if we don't handle that as an inline expression in the SQL, the closest alternative we have is a user defined function.  And we know that won't speed things up any (unless we can define an index on it, like we could with Oracle.)  If we've got to create a function, we might better do that in the code that calls the SQL statement.</p>
<p>And that function may have some differences in behavior, dependent on the DBMS and version.  (A shout out to all you Java developers so keen on being able to use any database engine interchangeably.)</p>
<p><strong>Domain knowledge</strong></p>
<p>We may have specialized knowledge of the domain for the column, (that is, the set of allowable values enforced for the column.  We may know <em>a priori</em> that the values stored in the column will never contain a percent sign, an underscore, or bracket pairs.  In that case, we just include a quick comment that those cases are covered.</p>
<p>The values stored in the column may allow for % or _ characters, but a constraint may require those values to be escaped, perhaps using a defined character, such that the values are LIKE comparison "safe".  Again, a quick comment about the allowed set of values, and in particular which character is used as an escape character, and go with Joel Spolsky's approach.</p>
<p>But, absent the specialized knowledge and a guarantee, it's important for us to at least consider handling those obscure corner cases, and consider whether the behavior is reasonable and "per the specification".</p>
<hr>
<p><strong>Other issues recapitulated</strong></p>
<p>I believe others have already sufficiently pointed out some of the other commonly considered areas of concern:</p>
<ul>
<li><p><a href="http://en.wikipedia.org/wiki/SQL_injection" rel="nofollow noreferrer">SQL injection</a> (taking what would appear to be user supplied information, and including that in the SQL text rather than supplying them through bind variables.  Using bind variables isn't required, it's just one convenient approach to thwart with SQL injection.  There are other ways to deal with it:</p>
</li>
<li><p>optimizer plan using index scan rather than index seeks, possible need for an expression or function for escaping wildcards (possible index on expression or function)</p>
</li>
<li><p>using literal values in place of bind variables impacts scalability</p>
</li>
</ul>
<hr>
<p><strong>Conclusion</strong></p>
<p>I like Joel Spolsky's approach.  It's clever.  And it works.</p>
<p>But as soon as I saw it, I immediately saw a potential problem with it, and it's not my nature to let it slide.  I don't mean to be critical of the efforts of others.  I know many developers take their work very personally, because they invest so much into it and they care so much about it.  So please understand, this is not a personal attack.  What I'm identifying here is the type of problem that crops up in production rather than testing.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 5</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>You can pass the parameter as a string</p>

<p>So you have the string </p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@tags</span>

<span class="hljs-keyword">SET</span> <span class="hljs-variable">@tags</span> <span class="hljs-operator">=</span> ruby<span class="hljs-operator">|</span>rails<span class="hljs-operator">|</span>scruffy<span class="hljs-operator">|</span>rubyonrails

<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> Tags 
<span class="hljs-keyword">where</span> Name <span class="hljs-keyword">in</span> (<span class="hljs-keyword">SELECT</span> item <span class="hljs-keyword">from</span> fnSplit(<span class="hljs-variable">@tags</span>, <span class="hljs-operator">|</span>))
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> Count <span class="hljs-keyword">desc</span>
</code></pre>

<p>Then all you have to do is pass the string as 1 parameter.</p>

<p>Here is the split function I use.</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> [dbo].[fnSplit](
    <span class="hljs-variable">@sInputList</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">8000</span>) <span class="hljs-comment">-- List of delimited items</span>
  , <span class="hljs-variable">@sDelimiter</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">8000</span>) <span class="hljs-operator">=</span> <span class="hljs-string">','</span> <span class="hljs-comment">-- delimiter that separates items</span>
) <span class="hljs-keyword">RETURNS</span> <span class="hljs-variable">@List</span> <span class="hljs-keyword">TABLE</span> (item <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">8000</span>))

<span class="hljs-keyword">BEGIN</span>
<span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@sItem</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">8000</span>)
WHILE CHARINDEX(<span class="hljs-variable">@sDelimiter</span>,<span class="hljs-variable">@sInputList</span>,<span class="hljs-number">0</span>) <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-number">0</span>
 <span class="hljs-keyword">BEGIN</span>
 <span class="hljs-keyword">SELECT</span>
  <span class="hljs-variable">@sItem</span><span class="hljs-operator">=</span>RTRIM(LTRIM(<span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-variable">@sInputList</span>,<span class="hljs-number">1</span>,CHARINDEX(<span class="hljs-variable">@sDelimiter</span>,<span class="hljs-variable">@sInputList</span>,<span class="hljs-number">0</span>)<span class="hljs-number">-1</span>))),
  <span class="hljs-variable">@sInputList</span><span class="hljs-operator">=</span>RTRIM(LTRIM(<span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-variable">@sInputList</span>,CHARINDEX(<span class="hljs-variable">@sDelimiter</span>,<span class="hljs-variable">@sInputList</span>,<span class="hljs-number">0</span>)<span class="hljs-operator">+</span>LEN(<span class="hljs-variable">@sDelimiter</span>),LEN(<span class="hljs-variable">@sInputList</span>))))

 IF LEN(<span class="hljs-variable">@sItem</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>
  <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-variable">@List</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@sItem</span>
 <span class="hljs-keyword">END</span>

IF LEN(<span class="hljs-variable">@sInputList</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>
 <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-variable">@List</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@sInputList</span> <span class="hljs-comment">-- Put the last item in</span>
<span class="hljs-keyword">RETURN</span>
<span class="hljs-keyword">END</span>
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 6</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I heard Jeff/Joel talk about this on the podcast today (<em><a href="http://itc.conversationsnetwork.org/audio/download/ITC.SO-Episode34-2008.12.16.mp3" rel="noreferrer">episode 34</a></em>, 2008-12-16 (MP3, 31&nbsp;MB), 1 h 03 min 38 secs - 1 h 06 min 45 secs), and I thought I recalled Stack&nbsp;Overflow was using <a href="http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL" rel="noreferrer">LINQ&nbsp;to&nbsp;SQL</a>, but maybe it was ditched. Here's the same thing in LINQ&nbsp;to&nbsp;SQL.  </p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">var inValues <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> [] { "ruby","rails","scruffy","rubyonrails" };

var results <span class="hljs-operator">=</span> <span class="hljs-keyword">from</span> tag <span class="hljs-keyword">in</span> Tags
              <span class="hljs-keyword">where</span> inValues.Contains(tag.Name)
              <span class="hljs-keyword">select</span> tag;
</code></pre>

<p>That's it. And, yes, LINQ already looks backwards enough, but the <code>Contains</code> clause seems extra backwards to me. When I had to do a similar query for a project at work, I naturally tried to do this the wrong way by doing a join between the local array and the SQL Server table, figuring the LINQ&nbsp;to&nbsp;SQL translator would be smart enough to handle the translation somehow. It didn't, but it did provide an error message that was descriptive and pointed me towards using <em>Contains</em>.  </p>

<p>Anyway, if you run this in the highly recommended <a href="http://www.linqpad.net/" rel="noreferrer">LINQPad</a>, and run this query, you can view the actual SQL that the SQL LINQ provider generated. It'll show you each of the values getting parameterized into an <code>IN</code> clause.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 7</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If you are calling from .NET, you could use <a href="https://github.com/StackExchange/Dapper" rel="noreferrer">Dapper dot net</a>:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">string[] names <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> string[] {"ruby","rails","scruffy","rubyonrails"};
var tags <span class="hljs-operator">=</span> dataContext.Query<span class="hljs-operator">&lt;</span>Tags<span class="hljs-operator">&gt;</span>(@"
select * from Tags 
where Name in @names
order by Count desc", <span class="hljs-keyword">new</span> {names});
</code></pre>

<p>Here Dapper does the thinking, so you don't have to. Something similar is possible with <a href="http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL" rel="noreferrer">LINQ&nbsp;to&nbsp;SQL</a>, of course:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">string[] names <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> string[] {"ruby","rails","scruffy","rubyonrails"};
var tags <span class="hljs-operator">=</span> <span class="hljs-keyword">from</span> tag <span class="hljs-keyword">in</span> dataContext.Tags
           <span class="hljs-keyword">where</span> names.Contains(tag.Name)
           orderby tag.Count descending
           <span class="hljs-keyword">select</span> tag;
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 8</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In <code>SQL Server 2016+</code> you could use <a href="https://msdn.microsoft.com/en-us/library/mt684588.aspx" rel="noreferrer"><code>STRING_SPLIT</code></a> function:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@names</span> NVARCHAR(MAX) <span class="hljs-operator">=</span> <span class="hljs-string">'ruby,rails,scruffy,rubyonrails'</span>;

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> 
<span class="hljs-keyword">FROM</span> Tags
<span class="hljs-keyword">WHERE</span> Name <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> [<span class="hljs-keyword">value</span>] <span class="hljs-keyword">FROM</span> STRING_SPLIT(<span class="hljs-variable">@names</span>, <span class="hljs-string">','</span>))
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> [Count] <span class="hljs-keyword">DESC</span>;
</code></pre>

<p>or:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@names</span> NVARCHAR(MAX) <span class="hljs-operator">=</span> <span class="hljs-string">'ruby,rails,scruffy,rubyonrails'</span>;

<span class="hljs-keyword">SELECT</span> t.<span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> Tags t
<span class="hljs-keyword">JOIN</span> STRING_SPLIT(<span class="hljs-variable">@names</span>,<span class="hljs-string">','</span>)
  <span class="hljs-keyword">ON</span> t.Name <span class="hljs-operator">=</span> [<span class="hljs-keyword">value</span>]
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> [Count] <span class="hljs-keyword">DESC</span>;
</code></pre>

<p><strong><a href="https://data.stackexchange.com/stackoverflow/query/481811" rel="noreferrer">LiveDemo</a></strong></p>

<p>The <a href="https://stackoverflow.com/a/337817/5070879">accepted answer</a> will of course work and it is one of the way to go, but it is anti-pattern.</p>

<blockquote>
  <p><strong>E. Find rows by list of values</strong></p>
  
  <p>This is replacement for common anti-pattern such as creating a dynamic SQL string in application layer or Transact-SQL, or by using LIKE operator:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> ProductId, Name, Tags
<span class="hljs-keyword">FROM</span> Product
<span class="hljs-keyword">WHERE</span> <span class="hljs-string">',1,2,3,'</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%,'</span> <span class="hljs-operator">+</span> <span class="hljs-built_in">CAST</span>(ProductId <span class="hljs-keyword">AS</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>)) <span class="hljs-operator">+</span> <span class="hljs-string">',%'</span>;
</code></pre>
</blockquote>

<hr>

<p><em>Addendum</em>:</p>

<p>To improve the <code>STRING_SPLIT</code> table function row estimation, it is a good idea to materialize splitted values as temporary table/table variable:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@names</span> NVARCHAR(MAX) <span class="hljs-operator">=</span> <span class="hljs-string">'ruby,rails,scruffy,rubyonrails,sql'</span>;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> #t(val NVARCHAR(<span class="hljs-number">120</span>));
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> #t(val) <span class="hljs-keyword">SELECT</span> s.[<span class="hljs-keyword">value</span>] <span class="hljs-keyword">FROM</span> STRING_SPLIT(<span class="hljs-variable">@names</span>, <span class="hljs-string">','</span>) s;

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> Tags tg
<span class="hljs-keyword">JOIN</span> #t t
  <span class="hljs-keyword">ON</span> t.val <span class="hljs-operator">=</span> tg.TagName
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> [Count] <span class="hljs-keyword">DESC</span>;
</code></pre>

<p><strong><a href="https://data.stackexchange.com/stackoverflow/query/1196908?opt.withExecutionPlan=true#executionPlan" rel="noreferrer">SEDE - Live Demo</a></strong></p>

<p>Related: <a href="https://www.brentozar.com/archive/2020/02/how-to-pass-a-list-of-values-into-a-stored-procedure/" rel="noreferrer">How to Pass a List of Values Into a Stored Procedure</a></p>

<p></p><hr>
<sup>Original question has requirement <code>SQL Server 2008</code>. Because this question is often used as duplicate, I've added this answer as reference. </sup><p></p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 9</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>This is possibly a half nasty way of doing it, I used it once, was rather effective.</p>

<p>Depending on your goals it might be of use. </p>

<ol>
<li>Create a <em>temp table</em> with one column. </li>
<li><code>INSERT</code> each look-up value into that column. </li>
<li>Instead of using an <code>IN</code>, you can then just use your standard <code>JOIN</code> rules. ( Flexibility++ )</li>
</ol>

<p>This has a bit of added flexibility in what you can do, but it's more suited for situations where you have a large table to query, with good indexing, and you want to use the parametrized list more than once. Saves having to execute it twice and have all the sanitation done manually.</p>

<p>I never got around to profiling exactly how <em>fast</em> it was, but in my situation it was needed. </p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 10</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>We have function that creates a table variable that you can join to:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">FUNCTION</span> [dbo].[Fn_sqllist_to_table](<span class="hljs-variable">@list</span>  <span class="hljs-keyword">AS</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">8000</span>),
                                           <span class="hljs-variable">@delim</span> <span class="hljs-keyword">AS</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>))
<span class="hljs-keyword">RETURNS</span> <span class="hljs-variable">@listTable</span> <span class="hljs-keyword">TABLE</span>(
  Position <span class="hljs-type">INT</span>,
  <span class="hljs-keyword">Value</span>    <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">8000</span>))
<span class="hljs-keyword">AS</span>
  <span class="hljs-keyword">BEGIN</span>
      <span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@myPos</span> <span class="hljs-type">INT</span>

      <span class="hljs-keyword">SET</span> <span class="hljs-variable">@myPos</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>

      WHILE Charindex(<span class="hljs-variable">@delim</span>, <span class="hljs-variable">@list</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">BEGIN</span>
            <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-variable">@listTable</span>
                        (Position,<span class="hljs-keyword">Value</span>)
            <span class="hljs-keyword">VALUES</span>     (<span class="hljs-variable">@myPos</span>,<span class="hljs-keyword">LEFT</span>(<span class="hljs-variable">@list</span>, Charindex(<span class="hljs-variable">@delim</span>, <span class="hljs-variable">@list</span>) <span class="hljs-operator">-</span> <span class="hljs-number">1</span>))

            <span class="hljs-keyword">SET</span> <span class="hljs-variable">@myPos</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@myPos</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span>

            IF Charindex(<span class="hljs-variable">@delim</span>, <span class="hljs-variable">@list</span>) <span class="hljs-operator">=</span> Len(<span class="hljs-variable">@list</span>)
              <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-variable">@listTable</span>
                          (Position,<span class="hljs-keyword">Value</span>)
              <span class="hljs-keyword">VALUES</span>     (<span class="hljs-variable">@myPos</span>,<span class="hljs-string">''</span>)

            <span class="hljs-keyword">SET</span> <span class="hljs-variable">@list</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">RIGHT</span>(<span class="hljs-variable">@list</span>, Len(<span class="hljs-variable">@list</span>) <span class="hljs-operator">-</span> Charindex(<span class="hljs-variable">@delim</span>, <span class="hljs-variable">@list</span>))
        <span class="hljs-keyword">END</span>

      IF Len(<span class="hljs-variable">@list</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-variable">@listTable</span>
                    (Position,<span class="hljs-keyword">Value</span>)
        <span class="hljs-keyword">VALUES</span>     (<span class="hljs-variable">@myPos</span>,<span class="hljs-variable">@list</span>)

      <span class="hljs-keyword">RETURN</span>
  <span class="hljs-keyword">END</span> 
</code></pre>

<p>So:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-variable">@Name</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">8000</span>) <span class="hljs-operator">=</span> <span class="hljs-keyword">null</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">parameter</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">search</span> <span class="hljs-keyword">values</span>    

<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> Tags 
<span class="hljs-keyword">where</span> Name <span class="hljs-keyword">in</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">From</span> fn_sqllist_to_table(<span class="hljs-variable">@Name</span>,<span class="hljs-string">','</span>)))
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> Count <span class="hljs-keyword">desc</span>
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 11</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>This is gross, but if you are guaranteed to have at least one, you could do:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> ...
       ...
 <span class="hljs-keyword">WHERE</span> tag <span class="hljs-keyword">IN</span>( <span class="hljs-variable">@tag1</span>, ISNULL( <span class="hljs-variable">@tag2</span>, <span class="hljs-variable">@tag1</span> ), ISNULL( <span class="hljs-variable">@tag3</span>, <span class="hljs-variable">@tag1</span> ), etc. )
</code></pre>

<p>Having IN( 'tag1', 'tag2', 'tag1', 'tag1', 'tag1' ) will be easily optimized away by SQL Server. Plus, you get direct index seeks</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 12</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I would pass a table type parameter (since it's <a href="http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2008" rel="noreferrer">SQL Server 2008</a>), and do a <code>where exists</code>, or inner join. You may also use XML, using <code>sp_xml_preparedocument</code>, and then even index that temporary table.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 13</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In my opinion, the best source to solve this problem, is what has been posted on this site:</p>

<p><a href="http://weblogs.sqlteam.com/dinakar/archive/2007/03/28/60150.aspx" rel="noreferrer">Syscomments. Dinakar Nethi</a></p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> dbo.fnParseArray (<span class="hljs-variable">@Array</span> <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">1000</span>),<span class="hljs-variable">@separator</span> <span class="hljs-type">CHAR</span>(<span class="hljs-number">1</span>))
<span class="hljs-keyword">RETURNS</span> <span class="hljs-variable">@T</span> <span class="hljs-keyword">Table</span> (col1 <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>))
<span class="hljs-keyword">AS</span> 
<span class="hljs-keyword">BEGIN</span>
 <span class="hljs-comment">--DECLARE @T Table (col1 varchar(50))  </span>
 <span class="hljs-comment">-- @Array is the array we wish to parse</span>
 <span class="hljs-comment">-- @Separator is the separator charactor such as a comma</span>
 <span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@separator</span>_position <span class="hljs-type">INT</span> <span class="hljs-comment">-- This is used to locate each separator character</span>
 <span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@array</span>_value <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">1000</span>) <span class="hljs-comment">-- this holds each array value as it is returned</span>
 <span class="hljs-comment">-- For my loop to work I need an extra separator at the end. I always look to the</span>
 <span class="hljs-comment">-- left of the separator character for each array value</span>

 <span class="hljs-keyword">SET</span> <span class="hljs-variable">@array</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@array</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@separator</span>

 <span class="hljs-comment">-- Loop through the string searching for separtor characters</span>
 WHILE PATINDEX(<span class="hljs-string">'%'</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@separator</span> <span class="hljs-operator">+</span> <span class="hljs-string">'%'</span>, <span class="hljs-variable">@array</span>) <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-number">0</span> 
 <span class="hljs-keyword">BEGIN</span>
    <span class="hljs-comment">-- patindex matches the a pattern against a string</span>
    <span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@separator</span>_position <span class="hljs-operator">=</span> PATINDEX(<span class="hljs-string">'%'</span> <span class="hljs-operator">+</span> <span class="hljs-variable">@separator</span> <span class="hljs-operator">+</span> <span class="hljs-string">'%'</span>,<span class="hljs-variable">@array</span>)
    <span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@array</span>_value <span class="hljs-operator">=</span> <span class="hljs-keyword">LEFT</span>(<span class="hljs-variable">@array</span>, <span class="hljs-variable">@separator</span>_position <span class="hljs-operator">-</span> <span class="hljs-number">1</span>)
    <span class="hljs-comment">-- This is where you process the values passed.</span>
    <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">into</span> <span class="hljs-variable">@T</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-variable">@array</span>_value)    
    <span class="hljs-comment">-- Replace this select statement with your processing</span>
    <span class="hljs-comment">-- @array_value holds the value of this element of the array</span>
    <span class="hljs-comment">-- This replaces what we just processed with and empty string</span>
    <span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@array</span> <span class="hljs-operator">=</span> STUFF(<span class="hljs-variable">@array</span>, <span class="hljs-number">1</span>, <span class="hljs-variable">@separator</span>_position, <span class="hljs-string">''</span>)
 <span class="hljs-keyword">END</span>
 <span class="hljs-keyword">RETURN</span> 
<span class="hljs-keyword">END</span>
</code></pre>

<p>Use:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> dbo.fnParseArray(<span class="hljs-string">'a,b,c,d,e,f'</span>, <span class="hljs-string">','</span>)
</code></pre>

<p><strong>CREDITS FOR: Dinakar Nethi</strong></p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 14</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The proper way IMHO is to store the list in a character string (limited in length by what the DBMS support); the only trick is that (in order to simplify processing) I have a separator (a comma in my example) at the beginning and at the end of the string. The idea is to "normalize on the fly", turning the list into a one-column table that contains one row per value. This allows you to turn</p>

<blockquote>
  <p>in (ct1,ct2, ct3 ... ctn)</p>
</blockquote>

<p>into an</p>

<blockquote>
  <p>in (select ...)</p>
</blockquote>

<p>or (the solution I'd probably prefer) a regular join, if you just add a "distinct" to avoid problems with duplicate values in the list.</p>

<p>Unfortunately, the techniques to slice a string are fairly product-specific.
Here is the SQL Server version:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"> <span class="hljs-keyword">with</span> qry(n, names) <span class="hljs-keyword">as</span>
       (<span class="hljs-keyword">select</span> len(list.names) <span class="hljs-operator">-</span> len(replace(list.names, <span class="hljs-string">','</span>, <span class="hljs-string">''</span>)) <span class="hljs-operator">-</span> <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> n,
               <span class="hljs-built_in">substring</span>(list.names, <span class="hljs-number">2</span>, len(list.names)) <span class="hljs-keyword">as</span> names
        <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-string">',Doc,Grumpy,Happy,Sneezy,Bashful,Sleepy,Dopey,'</span> names) <span class="hljs-keyword">as</span> list
        <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>
        <span class="hljs-keyword">select</span> (n <span class="hljs-operator">-</span> <span class="hljs-number">1</span>) <span class="hljs-keyword">as</span> n,
               <span class="hljs-built_in">substring</span>(names, <span class="hljs-number">1</span> <span class="hljs-operator">+</span> charindex(<span class="hljs-string">','</span>, names), len(names)) <span class="hljs-keyword">as</span> names
        <span class="hljs-keyword">from</span> qry
        <span class="hljs-keyword">where</span> n <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>)
 <span class="hljs-keyword">select</span> n, <span class="hljs-built_in">substring</span>(names, <span class="hljs-number">1</span>, charindex(<span class="hljs-string">','</span>, names) <span class="hljs-operator">-</span> <span class="hljs-number">1</span>) dwarf
 <span class="hljs-keyword">from</span> qry;
</code></pre>

<p>The Oracle version:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"> <span class="hljs-keyword">select</span> n, substr(name, <span class="hljs-number">1</span>, instr(name, <span class="hljs-string">','</span>) <span class="hljs-operator">-</span> <span class="hljs-number">1</span>) dwarf
 <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> n,
             substr(val, <span class="hljs-number">1</span> <span class="hljs-operator">+</span> instr(val, <span class="hljs-string">','</span>, <span class="hljs-number">1</span>, n)) name
      <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> rownum <span class="hljs-keyword">as</span> n,
                   list.val
            <span class="hljs-keyword">from</span>  (<span class="hljs-keyword">select</span> <span class="hljs-string">',Doc,Grumpy,Happy,Sneezy,Bashful,Sleepy,Dopey,'</span> val
                   <span class="hljs-keyword">from</span> dual) list
            <span class="hljs-keyword">connect</span> <span class="hljs-keyword">by</span> level <span class="hljs-operator">&lt;</span> length(list.val) <span class="hljs-operator">-</span>
                               length(replace(list.val, <span class="hljs-string">','</span>, <span class="hljs-string">''</span>))));
</code></pre>

<p>and the MySQL version:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> pivot.n,
      substring_index(substring_index(list.val, <span class="hljs-string">','</span>, <span class="hljs-number">1</span> <span class="hljs-operator">+</span> pivot.n), <span class="hljs-string">','</span>, <span class="hljs-number">-1</span>) <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> n
     <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>
     <span class="hljs-keyword">select</span> <span class="hljs-number">2</span> <span class="hljs-keyword">as</span> n
     <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>
     <span class="hljs-keyword">select</span> <span class="hljs-number">3</span> <span class="hljs-keyword">as</span> n
     <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>
     <span class="hljs-keyword">select</span> <span class="hljs-number">4</span> <span class="hljs-keyword">as</span> n
     <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>
     <span class="hljs-keyword">select</span> <span class="hljs-number">5</span> <span class="hljs-keyword">as</span> n
     <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>
     <span class="hljs-keyword">select</span> <span class="hljs-number">6</span> <span class="hljs-keyword">as</span> n
     <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>
     <span class="hljs-keyword">select</span> <span class="hljs-number">7</span> <span class="hljs-keyword">as</span> n
     <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>
     <span class="hljs-keyword">select</span> <span class="hljs-number">8</span> <span class="hljs-keyword">as</span> n
     <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>
     <span class="hljs-keyword">select</span> <span class="hljs-number">9</span> <span class="hljs-keyword">as</span> n
     <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span>
     <span class="hljs-keyword">select</span> <span class="hljs-number">10</span> <span class="hljs-keyword">as</span> n) pivot,    (<span class="hljs-keyword">select</span> <span class="hljs-string">',Doc,Grumpy,Happy,Sneezy,Bashful,Sleepy,Dopey,'</span> val) <span class="hljs-keyword">as</span> list <span class="hljs-keyword">where</span> pivot.n <span class="hljs-operator">&lt;</span>  length(list.val) <span class="hljs-operator">-</span>
                   length(replace(list.val, <span class="hljs-string">','</span>, <span class="hljs-string">''</span>));
</code></pre>

<p>(Of course, "pivot" must return as many rows as the maximum number of
items we can find in the list)</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 15</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If you've got <a href="http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2008" rel="nofollow noreferrer">SQL Server 2008</a> or later I'd use a <a href="https://stackoverflow.com/questions/5595353/how-to-pass-table-value-parameters-to-stored-procedure-from-net-code">Table Valued Parameter</a>.</p>

<p>If you're unlucky enough to be stuck on <a href="http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2005" rel="nofollow noreferrer">SQL Server 2005</a> you could add a <a href="http://en.wikipedia.org/wiki/Common_Language_Runtime" rel="nofollow noreferrer">CLR</a> function like this,</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">[SqlFunction(
    DataAccessKind.None,
    IsDeterministic <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>,
    SystemDataAccess <span class="hljs-operator">=</span> SystemDataAccessKind.None,
    IsPrecise <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>,
    FillRowMethodName <span class="hljs-operator">=</span> "SplitFillRow",
    TableDefinintion <span class="hljs-operator">=</span> "s NVARCHAR(MAX)"]
public <span class="hljs-keyword">static</span> IEnumerable Split(SqlChars seperator, SqlString s)
{
    if (s.IsNull)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> string[<span class="hljs-number">0</span>];

    <span class="hljs-keyword">return</span> s.ToString().Split(seperator.Buffer);
}

public <span class="hljs-keyword">static</span> void SplitFillRow(object <span class="hljs-type">row</span>, <span class="hljs-keyword">out</span> SqlString s)
{
    s <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> SqlString(row.ToString());
}
</code></pre>

<p>Which you could use like this,</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">declare</span> <span class="hljs-variable">@desiredTags</span> nvarchar(MAX);
<span class="hljs-keyword">set</span> <span class="hljs-variable">@desiredTags</span> <span class="hljs-operator">=</span> <span class="hljs-string">'ruby,rails,scruffy,rubyonrails'</span>;

<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> Tags
<span class="hljs-keyword">where</span> Name <span class="hljs-keyword">in</span> [dbo].[Split] (<span class="hljs-string">','</span>, <span class="hljs-variable">@desiredTags</span>)
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> Count <span class="hljs-keyword">desc</span>
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 16</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I think this is a case when a static query is just not the way to go. Dynamically build the list for your in clause, escape your single quotes, and dynamically build SQL. In this case you probably won't see much of a difference with any method due to the small list, but the most efficient method really is to send the SQL exactly as it is written in your post. I think it is a good habit to write it the most efficient way, rather than to do what makes the prettiest code, or consider it bad practice to dynamically build SQL.</p>

<p>I have seen the split functions take longer to execute than the query themselves in many cases where the parameters get large. A stored procedure with table valued parameters in SQL 2008 is the only other option I would consider, although this will probably be slower in your case. TVP will probably only be faster for large lists if you are searching on the primary key of the TVP, because SQL will build a temporary table for the list anyway (if the list is large). You won't know for sure unless you test it.</p>

<p>I have also seen stored procedures that had 500 parameters with default values of null, and having WHERE Column1 IN (@Param1, @Param2, @Param3, ..., @Param500). This caused SQL to build a temp table, do a sort/distinct, and then do a table scan instead of an index seek. That is essentially what you would be doing by parameterizing that query, although on a small enough scale that it won't make a noticeable difference. I highly recommend against having NULL in your IN lists, as if that gets changed to a NOT IN it will not act as intended. You could dynamically build the parameter list, but the only obvious thing that you would gain is that the objects would escape the single quotes for you. That approach is also slightly slower on the application end since the objects have to parse the query to find the parameters. It may or may not be faster on SQL, as parameterized queries call sp_prepare, sp_execute for as many times you execute the query, followed by sp_unprepare. </p>

<p>The reuse of execution plans for stored procedures or parameterized queries may give you a performance gain, but it will lock you in to one execution plan determined by the first query that is executed. That may be less than ideal for subsequent queries in many cases. In your case, reuse of execution plans will probably be a plus, but it might not make any difference at all as the example is a really simple query.</p>

<p><strong>Cliffs notes:</strong></p>

<p>For your case anything you do, be it parameterization with a fixed number of items in the list (null if not used), dynamically building the query with or without parameters, or using stored procedures with table valued parameters will not make much of a difference. However, my general recommendations are as follows:</p>

<p><strong>Your case/simple queries with few parameters:</strong></p>

<p>Dynamic SQL, maybe with parameters if testing shows better performance.</p>

<p><strong>Queries with reusable execution plans, called multiple times by simply changing the parameters or if the query is complicated:</strong></p>

<p>SQL with dynamic parameters.</p>

<p><strong>Queries with large lists:</strong></p>

<p>Stored procedure with table valued parameters. If the list can vary by a large amount use WITH RECOMPILE on the stored procedure, or simply use dynamic SQL without parameters to generate a new execution plan for each query.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 17</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>May be we can use XML here:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">    <span class="hljs-keyword">declare</span> <span class="hljs-variable">@x</span> xml
    <span class="hljs-keyword">set</span> <span class="hljs-variable">@x</span><span class="hljs-operator">=</span><span class="hljs-string">'&lt;items&gt;
    &lt;item myvalue="29790" /&gt;
    &lt;item myvalue="31250" /&gt;
    &lt;/items&gt;
    '</span>;
    <span class="hljs-keyword">With</span> CTE <span class="hljs-keyword">AS</span> (
         <span class="hljs-keyword">SELECT</span> 
            x.item.value(<span class="hljs-string">'@myvalue[1]'</span>, <span class="hljs-string">'decimal'</span>) <span class="hljs-keyword">AS</span> myvalue
        <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@x</span>.nodes(<span class="hljs-string">'//items/item'</span>) <span class="hljs-keyword">AS</span> x(item) )

    <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> YourTable <span class="hljs-keyword">where</span> tableColumnName <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> myvalue <span class="hljs-keyword">from</span> cte)
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 18</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>If we have strings stored inside the IN clause with the comma(,) delimited, we can use the charindex function to get the values. If you use .NET, then you can map with SqlParameters.</p>

<p><strong>DDL Script:</strong></p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Tags
    ([ID] <span class="hljs-type">int</span>, [Name] <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>))
;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> Tags
    ([ID], [Name])
<span class="hljs-keyword">VALUES</span>
    (<span class="hljs-number">1</span>, <span class="hljs-string">'ruby'</span>),
    (<span class="hljs-number">2</span>, <span class="hljs-string">'rails'</span>),
    (<span class="hljs-number">3</span>, <span class="hljs-string">'scruffy'</span>),
    (<span class="hljs-number">4</span>, <span class="hljs-string">'rubyonrails'</span>)
;
</code></pre>

<p><strong>T-SQL:</strong></p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@Param</span> nvarchar(max)

<span class="hljs-keyword">SET</span> <span class="hljs-variable">@Param</span> <span class="hljs-operator">=</span> <span class="hljs-string">'ruby,rails,scruffy,rubyonrails'</span>

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> Tags
<span class="hljs-keyword">WHERE</span> CharIndex(Name,<span class="hljs-variable">@Param</span>)<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span>
</code></pre>

<p>You can use the above statement in your .NET code and map the parameter with SqlParameter.</p>

<p><a href="http://sqlfiddle.com/#!3/31994/3" rel="noreferrer">Fiddler demo</a></p>

<p><strong>EDIT:</strong>
Create the table called SelectedTags using the following script.</p>

<p>DDL Script:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">Create</span> <span class="hljs-keyword">table</span> SelectedTags
(Name nvarchar(<span class="hljs-number">20</span>));

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> SelectedTags <span class="hljs-keyword">values</span> (<span class="hljs-string">'ruby'</span>),(<span class="hljs-string">'rails'</span>)
</code></pre>

<p>T-SQL:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@list</span> nvarchar(max)
<span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@list</span><span class="hljs-operator">=</span><span class="hljs-built_in">coalesce</span>(<span class="hljs-variable">@list</span><span class="hljs-operator">+</span><span class="hljs-string">','</span>,<span class="hljs-string">''</span>)<span class="hljs-operator">+</span>st.Name <span class="hljs-keyword">FROM</span> SelectedTags st

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> Tags
<span class="hljs-keyword">WHERE</span> CharIndex(Name,<span class="hljs-variable">@Param</span>)<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span>
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 19</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I'd approach this by default with passing a table valued function (that returns a table from a string) to the IN condition.</p>

<p>Here is the code for the UDF <em>(I got it from Stack Overflow somewhere, i can't find the source right now)</em></p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> [dbo].[Split] (<span class="hljs-variable">@sep</span> <span class="hljs-type">char</span>(<span class="hljs-number">1</span>), <span class="hljs-variable">@s</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">8000</span>))
<span class="hljs-keyword">RETURNS</span> <span class="hljs-keyword">table</span>
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">RETURN</span> (
    <span class="hljs-keyword">WITH</span> Pieces(pn, <span class="hljs-keyword">start</span>, stop) <span class="hljs-keyword">AS</span> (
      <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, CHARINDEX(<span class="hljs-variable">@sep</span>, <span class="hljs-variable">@s</span>)
      <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
      <span class="hljs-keyword">SELECT</span> pn <span class="hljs-operator">+</span> <span class="hljs-number">1</span>, stop <span class="hljs-operator">+</span> <span class="hljs-number">1</span>, CHARINDEX(<span class="hljs-variable">@sep</span>, <span class="hljs-variable">@s</span>, stop <span class="hljs-operator">+</span> <span class="hljs-number">1</span>)
      <span class="hljs-keyword">FROM</span> Pieces
      <span class="hljs-keyword">WHERE</span> stop <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>
    )
    <span class="hljs-keyword">SELECT</span> 
      <span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-variable">@s</span>, <span class="hljs-keyword">start</span>, <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> stop <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> stop<span class="hljs-operator">-</span><span class="hljs-keyword">start</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">512</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">AS</span> s
    <span class="hljs-keyword">FROM</span> Pieces
  )
</code></pre>

<p>Once you got this your code would be as simple as this:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> Tags 
<span class="hljs-keyword">where</span> Name <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> s <span class="hljs-keyword">from</span> dbo.split(<span class="hljs-string">';'</span>,<span class="hljs-string">'ruby;rails;scruffy;rubyonrails'</span>))
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> Count <span class="hljs-keyword">desc</span>
</code></pre>

<p>Unless you have a ridiculously long string, this should work well with the table index.</p>

<p>If needed you can insert it into a temp table, index it, then run a join...</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 20</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>For a variable number of arguments like this the only way I'm aware of is to either generate the SQL explicitly or do something that involves populating a temporary table with the items you want and joining against the temp table.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 21</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Another possible solution is instead of passing a variable number of arguments to a stored procedure, pass a single string containing the names you're after, but make them unique by surrounding them with '&lt;&gt;'. Then use PATINDEX to find the names:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> 
<span class="hljs-keyword">FROM</span> Tags 
<span class="hljs-keyword">WHERE</span> PATINDEX(<span class="hljs-string">'%&lt;'</span> <span class="hljs-operator">+</span> Name <span class="hljs-operator">+</span> <span class="hljs-string">'&gt;%'</span>,<span class="hljs-string">'&lt;jo&gt;,&lt;john&gt;,&lt;scruffy&gt;,&lt;rubyonrails&gt;'</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 22</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Use the following stored procedure. It uses a custom split function, which can be found <a href="http://blogs.microsoft.co.il/blogs/itai/archive/2009/02/01/t-sql-split-function.aspx" rel="noreferrer">here</a>.</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"> <span class="hljs-keyword">create</span> stored <span class="hljs-keyword">procedure</span> GetSearchMachingTagNames 
    <span class="hljs-variable">@PipeDelimitedTagNames</span> <span class="hljs-type">varchar</span>(max), 
    <span class="hljs-variable">@delimiter</span> <span class="hljs-type">char</span>(<span class="hljs-number">1</span>) 
    <span class="hljs-keyword">as</span>  
    <span class="hljs-keyword">begin</span>
         <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> Tags 
         <span class="hljs-keyword">where</span> Name <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> data <span class="hljs-keyword">from</span> [dbo].[Split](<span class="hljs-variable">@PipeDelimitedTagNames</span>,<span class="hljs-variable">@delimiter</span>) 
    <span class="hljs-keyword">end</span>
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 23</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Here is another alternative. Just pass a comma-delimited list as a string parameter to the stored procedure and:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> [dbo].[sp_myproc]
    <span class="hljs-variable">@UnitList</span> <span class="hljs-type">varchar</span>(MAX) <span class="hljs-operator">=</span> <span class="hljs-string">'1,2,3'</span>
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">select</span> <span class="hljs-keyword">column</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span>
<span class="hljs-keyword">where</span> ph.UnitID <span class="hljs-keyword">in</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> CsvToInt(<span class="hljs-variable">@UnitList</span>))
</code></pre>

<p>And the function:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">Function</span> [dbo].[CsvToInt] ( <span class="hljs-variable">@Array</span> <span class="hljs-type">varchar</span>(MAX))
<span class="hljs-keyword">returns</span> <span class="hljs-variable">@IntTable</span> <span class="hljs-keyword">table</span>
(IntValue <span class="hljs-type">int</span>)
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">begin</span>
    <span class="hljs-keyword">declare</span> <span class="hljs-variable">@separator</span> <span class="hljs-type">char</span>(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">set</span> <span class="hljs-variable">@separator</span> <span class="hljs-operator">=</span> <span class="hljs-string">','</span>
    <span class="hljs-keyword">declare</span> <span class="hljs-variable">@separator</span>_position <span class="hljs-type">int</span>
    <span class="hljs-keyword">declare</span> <span class="hljs-variable">@array</span>_value <span class="hljs-type">varchar</span>(MAX)

    <span class="hljs-keyword">set</span> <span class="hljs-variable">@array</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@array</span> <span class="hljs-operator">+</span> <span class="hljs-string">','</span>

    while patindex(<span class="hljs-string">'%,%'</span> , <span class="hljs-variable">@array</span>) <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">begin</span>

        <span class="hljs-keyword">select</span> <span class="hljs-variable">@separator</span>_position <span class="hljs-operator">=</span> patindex(<span class="hljs-string">'%,%'</span> , <span class="hljs-variable">@array</span>)
        <span class="hljs-keyword">select</span> <span class="hljs-variable">@array</span>_value <span class="hljs-operator">=</span> <span class="hljs-keyword">left</span>(<span class="hljs-variable">@array</span>, <span class="hljs-variable">@separator</span>_position <span class="hljs-operator">-</span> <span class="hljs-number">1</span>)

        <span class="hljs-keyword">Insert</span> <span class="hljs-variable">@IntTable</span>
        <span class="hljs-keyword">Values</span> (<span class="hljs-built_in">Cast</span>(<span class="hljs-variable">@array</span>_value <span class="hljs-keyword">as</span> <span class="hljs-type">int</span>))
        <span class="hljs-keyword">select</span> <span class="hljs-variable">@array</span> <span class="hljs-operator">=</span> stuff(<span class="hljs-variable">@array</span>, <span class="hljs-number">1</span>, <span class="hljs-variable">@separator</span>_position, <span class="hljs-string">''</span>)
    <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">return</span>
<span class="hljs-keyword">end</span>
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 24</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In <a href="http://en.wikipedia.org/wiki/ColdFusion" rel="noreferrer">ColdFusion</a> we just do:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-operator">&lt;</span>cfset myvalues <span class="hljs-operator">=</span> "ruby|rails|scruffy|rubyonrails"<span class="hljs-operator">&gt;</span>
    <span class="hljs-operator">&lt;</span>cfquery name<span class="hljs-operator">=</span>"q"<span class="hljs-operator">&gt;</span>
        <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> sometable <span class="hljs-keyword">where</span> <span class="hljs-keyword">values</span> <span class="hljs-keyword">in</span> <span class="hljs-operator">&lt;</span>cfqueryparam <span class="hljs-keyword">value</span><span class="hljs-operator">=</span>"#myvalues#" list<span class="hljs-operator">=</span>"true"<span class="hljs-operator">&gt;</span>
    <span class="hljs-operator">&lt;</span><span class="hljs-operator">/</span>cfquery<span class="hljs-operator">&gt;</span>
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 25</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Here's a technique that recreates a local table to be used in a query string. Doing it this way eliminates all parsing problems. </p>

<p>The string can be built in any language. In this example I used SQL since that was the original problem I was trying to solve. I needed a clean way to pass in table data on the fly in a string to be executed later.</p>

<p>Using a user defined type is optional. Creating the type is only created once and can be done ahead of time. Otherwise just add a full table type to the declaration in the string. </p>

<p>The general pattern is easy to extend and can be used for passing more complex tables.</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-comment">-- Create a user defined type for the list.</span>
<span class="hljs-keyword">CREATE</span> TYPE [dbo].[StringList] <span class="hljs-keyword">AS</span> <span class="hljs-keyword">TABLE</span>(
    [StringValue] [nvarchar](max) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
)

<span class="hljs-comment">-- Create a sample list using the list table type.</span>
<span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@list</span> [dbo].[StringList]; 
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-variable">@list</span> <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'one'</span>), (<span class="hljs-string">'two'</span>), (<span class="hljs-string">'three'</span>), (<span class="hljs-string">'four'</span>)

<span class="hljs-comment">-- Build a string in which we recreate the list so we can pass it to exec</span>
<span class="hljs-comment">-- This can be done in any language since we're just building a string.</span>
<span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@str</span> nvarchar(max);
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@str</span> <span class="hljs-operator">=</span> <span class="hljs-string">'DECLARE @list [dbo].[StringList]; INSERT INTO @list VALUES '</span>

<span class="hljs-comment">-- Add all the values we want to the string. This would be a loop in C++.</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@str</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@str</span> <span class="hljs-operator">+</span> <span class="hljs-string">'('''</span> <span class="hljs-operator">+</span> StringValue <span class="hljs-operator">+</span> <span class="hljs-string">'''),'</span> <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@list</span>

<span class="hljs-comment">-- Remove the trailing comma so the query is valid sql.</span>
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@str</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">substring</span>(<span class="hljs-variable">@str</span>, <span class="hljs-number">1</span>, len(<span class="hljs-variable">@str</span>)<span class="hljs-number">-1</span>)

<span class="hljs-comment">-- Add a select to test the string.</span>
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@str</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@str</span> <span class="hljs-operator">+</span> <span class="hljs-string">'; SELECT * FROM @list;'</span>

<span class="hljs-comment">-- Execute the string and see we've pass the table correctly.</span>
<span class="hljs-keyword">EXEC</span>(<span class="hljs-variable">@str</span>)
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 26</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>In SQL Server 2016+ another possibility is to use the <a href="https://msdn.microsoft.com/en-us/library/dn921879.aspx" rel="noreferrer"><code>OPENJSON</code></a> function.</p>

<p>This approach is blogged about in <a href="http://blogs.msdn.com/b/sqlserverstorageengine/archive/2015/11/03/openjson-one-of-best-ways-to-select-rows-by-list-of-id.aspx" rel="noreferrer">OPENJSON - one of best ways to select rows by list of ids</a>.</p>

<p>A full worked example below</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> dbo.Tags
  (
     Name  <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
     Count <span class="hljs-type">INT</span>
  )

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> dbo.Tags
<span class="hljs-keyword">VALUES</span>      (<span class="hljs-string">'VB'</span>,<span class="hljs-number">982</span>), (<span class="hljs-string">'ruby'</span>,<span class="hljs-number">1306</span>), (<span class="hljs-string">'rails'</span>,<span class="hljs-number">1478</span>), (<span class="hljs-string">'scruffy'</span>,<span class="hljs-number">1</span>), (<span class="hljs-string">'C#'</span>,<span class="hljs-number">1784</span>)

GO

<span class="hljs-keyword">CREATE</span> PROC dbo.SomeProc
<span class="hljs-variable">@Tags</span> <span class="hljs-type">VARCHAR</span>(MAX)
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> T.<span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span>   dbo.Tags T
<span class="hljs-keyword">WHERE</span>  T.Name <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> J.Value <span class="hljs-keyword">COLLATE</span> Latin1_General_CI_AS
                  <span class="hljs-keyword">FROM</span>   OPENJSON(CONCAT(<span class="hljs-string">'['</span>, <span class="hljs-variable">@Tags</span>, <span class="hljs-string">']'</span>)) J)
<span class="hljs-keyword">ORDER</span>  <span class="hljs-keyword">BY</span> T.Count <span class="hljs-keyword">DESC</span>

GO

<span class="hljs-keyword">EXEC</span> dbo.SomeProc <span class="hljs-variable">@Tags</span> <span class="hljs-operator">=</span> <span class="hljs-string">'"ruby","rails","scruffy","rubyonrails"'</span>

<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> dbo.Tags 
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 27</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I have an answer that doesn't require a UDF, XML
Because IN accepts a select statement
e.g. SELECT * FROM Test where Data IN (SELECT Value FROM TABLE)</p>

<p>You really only need a way to convert the string into a table.</p>

<p>This can be done with a recursive CTE, or a query with a number table (or Master..spt_value)</p>

<p>Here's the CTE version.</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">DECLARE</span> <span class="hljs-variable">@InputString</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">8000</span>) <span class="hljs-operator">=</span> <span class="hljs-string">'ruby,rails,scruffy,rubyonrails'</span>

<span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@InputString</span> <span class="hljs-operator">=</span> <span class="hljs-variable">@InputString</span> <span class="hljs-operator">+</span> <span class="hljs-string">','</span>

;<span class="hljs-keyword">WITH</span> RecursiveCSV(x,y) 
<span class="hljs-keyword">AS</span> 
(
    <span class="hljs-keyword">SELECT</span> 
        x <span class="hljs-operator">=</span> <span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-variable">@InputString</span>,<span class="hljs-number">0</span>,CHARINDEX(<span class="hljs-string">','</span>,<span class="hljs-variable">@InputString</span>,<span class="hljs-number">0</span>)),
        y <span class="hljs-operator">=</span> <span class="hljs-built_in">SUBSTRING</span>(<span class="hljs-variable">@InputString</span>,CHARINDEX(<span class="hljs-string">','</span>,<span class="hljs-variable">@InputString</span>,<span class="hljs-number">0</span>)<span class="hljs-operator">+</span><span class="hljs-number">1</span>,LEN(<span class="hljs-variable">@InputString</span>))
    <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
    <span class="hljs-keyword">SELECT</span> 
        x <span class="hljs-operator">=</span> <span class="hljs-built_in">SUBSTRING</span>(y,<span class="hljs-number">0</span>,CHARINDEX(<span class="hljs-string">','</span>,y,<span class="hljs-number">0</span>)),
        y <span class="hljs-operator">=</span> <span class="hljs-built_in">SUBSTRING</span>(y,CHARINDEX(<span class="hljs-string">','</span>,y,<span class="hljs-number">0</span>)<span class="hljs-operator">+</span><span class="hljs-number">1</span>,LEN(y))
    <span class="hljs-keyword">FROM</span> 
        RecursiveCSV 
    <span class="hljs-keyword">WHERE</span>
        <span class="hljs-built_in">SUBSTRING</span>(y,CHARINDEX(<span class="hljs-string">','</span>,y,<span class="hljs-number">0</span>)<span class="hljs-operator">+</span><span class="hljs-number">1</span>,LEN(y)) <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-string">''</span> <span class="hljs-keyword">OR</span> 
        <span class="hljs-built_in">SUBSTRING</span>(y,<span class="hljs-number">0</span>,CHARINDEX(<span class="hljs-string">','</span>,y,<span class="hljs-number">0</span>)) <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-string">''</span>
)
<span class="hljs-keyword">SELECT</span>
    <span class="hljs-operator">*</span> 
<span class="hljs-keyword">FROM</span> 
    Tags
<span class="hljs-keyword">WHERE</span> 
    Name <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">select</span> x <span class="hljs-keyword">FROM</span> RecursiveCSV)
OPTION (MAXRECURSION <span class="hljs-number">32767</span>);
</code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 28</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>I use a more concise version <a href="https://stackoverflow.com/a/337792/16587">of the top voted answer</a>:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">List<span class="hljs-operator">&lt;</span>SqlParameter<span class="hljs-operator">&gt;</span> parameters <span class="hljs-operator">=</span> tags.Select((s, i) <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">new</span> SqlParameter("@tag" <span class="hljs-operator">+</span> i.ToString(), SqlDbType.NVarChar(<span class="hljs-number">50</span>)) { <span class="hljs-keyword">Value</span> <span class="hljs-operator">=</span> s}).ToList();

var whereCondition <span class="hljs-operator">=</span> string.Format("tags in ({0})", String.Join(",",parameters.Select(s <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> s.ParameterName)));
</code></pre>

<p>It does loop through the tag parameters twice; but that doesn't matter most of the time (it won't be your bottleneck; if it is, unroll the loop).</p>

<p>If you're really interested in performance and don't want to iterate through the loop twice, here's a less beautiful version:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">var parameters <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> List<span class="hljs-operator">&lt;</span>SqlParameter<span class="hljs-operator">&gt;</span>();
var paramNames <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> List<span class="hljs-operator">&lt;</span>string<span class="hljs-operator">&gt;</span>();
<span class="hljs-keyword">for</span> (var i <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i <span class="hljs-operator">&lt;</span> tags.Length; i<span class="hljs-operator">+</span><span class="hljs-operator">+</span>)  
{
    var paramName <span class="hljs-operator">=</span> "@tag" <span class="hljs-operator">+</span> i;

    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>Include size <span class="hljs-keyword">and</span> <span class="hljs-keyword">set</span> <span class="hljs-keyword">value</span> explicitly (<span class="hljs-keyword">not</span> AddWithValue)
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>Because <span class="hljs-keyword">SQL</span> Server may use an implicit conversion if it doesn<span class="hljs-string">'t know
    //the actual size.
    var p = new SqlParameter(paramName, SqlDbType.NVarChar(50) { Value = tags[i]; } 
    paramNames.Add(paramName);
    parameters.Add(p);
}

var inClause = string.Join(",", paramNames);
</span></code></pre>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 29</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>Here is another answer to this problem. </p>

<p>(new version posted on 6/4/13).</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">    private <span class="hljs-keyword">static</span> DataSet GetDataSet(SqlConnectionStringBuilder scsb, string strSql, params object[] pars)
    {
        var ds <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> DataSet();
        <span class="hljs-keyword">using</span> (var sqlConn <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> SqlConnection(scsb.ConnectionString))
        {
            var sqlParameters <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> List<span class="hljs-operator">&lt;</span>SqlParameter<span class="hljs-operator">&gt;</span>();
            var replacementStrings <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> Dictionary<span class="hljs-operator">&lt;</span>string, string<span class="hljs-operator">&gt;</span>();
            if (pars <span class="hljs-operator">!=</span> <span class="hljs-keyword">null</span>)
            {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i <span class="hljs-operator">&lt;</span> pars.Length; i<span class="hljs-operator">+</span><span class="hljs-operator">+</span>)
                {
                    if (pars[i] <span class="hljs-keyword">is</span> IEnumerable<span class="hljs-operator">&lt;</span>object<span class="hljs-operator">&gt;</span>)
                    {
                        List<span class="hljs-operator">&lt;</span>object<span class="hljs-operator">&gt;</span> enumerable <span class="hljs-operator">=</span> (pars[i] <span class="hljs-keyword">as</span> IEnumerable<span class="hljs-operator">&lt;</span>object<span class="hljs-operator">&gt;</span>).ToList();
                        replacementStrings.Add("@" <span class="hljs-operator">+</span> i, String.Join(",", enumerable.Select((<span class="hljs-keyword">value</span>, pos) <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> String.Format("@_{0}_{1}", i, pos))));
                        sqlParameters.AddRange(enumerable.Select((<span class="hljs-keyword">value</span>, pos) <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-keyword">new</span> SqlParameter(String.Format("@_{0}_{1}", i, pos), <span class="hljs-keyword">value</span> ?? DBNull.Value)).ToArray());
                    }
                    <span class="hljs-keyword">else</span>
                    {
                        sqlParameters.Add(<span class="hljs-keyword">new</span> SqlParameter(String.Format("@{0}", i), pars[i] ?? DBNull.Value));
                    }
                }
            }
            strSql <span class="hljs-operator">=</span> replacementStrings.Aggregate(strSql, (<span class="hljs-keyword">current</span>, replacementString) <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> current.Replace(replacementString.Key, replacementString.Value));
            <span class="hljs-keyword">using</span> (var sqlCommand <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> SqlCommand(strSql, sqlConn))
            {
                if (pars <span class="hljs-operator">!=</span> <span class="hljs-keyword">null</span>)
                {
                    sqlCommand.Parameters.AddRange(sqlParameters.ToArray());
                }
                <span class="hljs-keyword">else</span>
                {
                    <span class="hljs-operator">/</span><span class="hljs-operator">/</span>Fail<span class="hljs-operator">-</span>safe, just <span class="hljs-keyword">in</span> <span class="hljs-keyword">case</span> a <span class="hljs-keyword">user</span> intends <span class="hljs-keyword">to</span> pass a single <span class="hljs-keyword">null</span> <span class="hljs-keyword">parameter</span>
                    sqlCommand.Parameters.Add(<span class="hljs-keyword">new</span> SqlParameter("@0", DBNull.Value));
                }
                <span class="hljs-keyword">using</span> (var sqlDataAdapter <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> SqlDataAdapter(sqlCommand))
                {
                    sqlDataAdapter.Fill(ds);
                }
            }
        }
        <span class="hljs-keyword">return</span> ds;
    }
</code></pre>

<p>Cheers.</p>
    </div></div></div></div><div class="flex mt-5 answer items-center justify-center py-5"><div class="rounded-xl border p-10 shadow-md w-9/12 bg-white"><h4 class="text-4xl font-semibold mb-5">Solution 30</h4><div class=" items-center justify-between"><div class=" space-x-4 md:space-x-8">
<p>The only winning move is not to play.</p>

<p>No infinite variability for you.  Only finite variability.</p>

<p>In the SQL you have a clause like this:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql"><span class="hljs-keyword">and</span> ( {<span class="hljs-number">1</span>}<span class="hljs-operator">=</span><span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-keyword">or</span> b.CompanyId <span class="hljs-keyword">in</span> ({<span class="hljs-number">2</span>},{<span class="hljs-number">3</span>},{<span class="hljs-number">4</span>},{<span class="hljs-number">5</span>},{<span class="hljs-number">6</span>}) )
</code></pre>

<p>In the C# code you do something like this:</p>

<pre class="lang-sql s-code-block"><code class="hljs language-sql">  <span class="hljs-type">int</span> origCount <span class="hljs-operator">=</span> idList.Count;
  if (origCount <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span>) {
    throw <span class="hljs-keyword">new</span> Exception("You may only specify up to five originators to filter on.");
  }
  while (idList.Count <span class="hljs-operator">&lt;</span> <span class="hljs-number">5</span>) { idList.Add(<span class="hljs-number">-1</span>); }  <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-number">-1</span> <span class="hljs-keyword">is</span> an impossible <span class="hljs-keyword">value</span>
  <span class="hljs-keyword">return</span> ExecuteQuery<span class="hljs-operator">&lt;</span>PublishDate<span class="hljs-operator">&gt;</span>(getValuesInListSQL, 
               origCount,   
               idList[<span class="hljs-number">0</span>], idList[<span class="hljs-number">1</span>], idList[<span class="hljs-number">2</span>], idList[<span class="hljs-number">3</span>], idList[<span class="hljs-number">4</span>]);
</code></pre>

<p>So basically if the count is 0 then there is no filter and everything goes through.  If the count is higher than 0 the then the value must be in the list, but the list has been padded out to five with impossible values (so that the SQL still makes sense)</p>

<p>Sometimes the lame solution is the only one that actually works.</p>
    </div></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"answer":["\n\u0026lt;p\u0026gt;You can parameterize \u0026lt;em\u0026gt;each\u0026lt;/em\u0026gt; value, so something like:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;string[] tags \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; string[] { \u0026quot;ruby\u0026quot;, \u0026quot;rails\u0026quot;, \u0026quot;scruffy\u0026quot;, \u0026quot;rubyonrails\u0026quot; };\nstring cmdText \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026quot;SELECT * FROM Tags WHERE Name IN ({0})\u0026quot;;\n\nstring[] paramNames \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; tags.Select(\n    (s, i) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026quot;@tag\u0026quot; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; i.ToString()\n).ToArray();\n\nstring inClause \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; string.Join(\u0026quot;, \u0026quot;, paramNames);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; (SqlCommand cmd \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlCommand(string.Format(cmdText, inClause))) {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; i \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt; paramNames.Length; i\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;) {\n       cmd.Parameters.AddWithValue(paramNames[i], tags[i]);\n    }\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Which will give you:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;cmd.CommandText \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026quot;SELECT * FROM Tags WHERE Name IN (@tag0, @tag1, @tag2, @tag3)\u0026quot;\ncmd.Parameters[\u0026quot;@tag0\u0026quot;] \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026quot;ruby\u0026quot;\ncmd.Parameters[\u0026quot;@tag1\u0026quot;] \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026quot;rails\u0026quot;\ncmd.Parameters[\u0026quot;@tag2\u0026quot;] \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026quot;scruffy\u0026quot;\ncmd.Parameters[\u0026quot;@tag3\u0026quot;] \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026quot;rubyonrails\u0026quot;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;No, this is not open to \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/SQL_injection\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;SQL injection\u0026lt;/a\u0026gt;. The only injected text into CommandText is not based on user input. It\u0026apos;s solely based on the hardcoded \u0026quot;@tag\u0026quot; prefix, and the index of an array. The index will \u0026lt;em\u0026gt;always\u0026lt;/em\u0026gt; be an integer, is not user generated, and is safe.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The user inputted values are still stuffed into parameters, so there is no vulnerability there.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Edit:\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;Injection concerns aside, take care to note that constructing the command text to accomodate a variable number of parameters (as above) impede\u0026apos;s SQL server\u0026apos;s ability to take advantage of cached queries. The net result is that you almost certainly lose the value of using parameters in the first place (as opposed to merely inserting the predicate strings into the SQL itself).\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;Not that cached query plans aren\u0026apos;t valuable, but IMO this query isn\u0026apos;t nearly complicated enough to see much benefit from it. While the compilation costs may approach (or even exceed) the execution costs, you\u0026apos;re still talking milliseconds. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;If you have enough RAM, I\u0026apos;d expect SQL\u0026amp;nbsp;Server would probably cache a plan for the common counts of parameters as well. I suppose you could always add five parameters, and let the unspecified tags be NULL - the query plan should be the same, but it seems pretty ugly to me and I\u0026apos;m not sure that it\u0026apos;d worth the micro-optimization (although, on Stack\u0026amp;nbsp;Overflow - it may very well be worth it).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Also, SQL\u0026amp;nbsp;Server 7 and later will \u0026lt;a href=\u0026quot;http://msdn.microsoft.com/en-us/library/aa175264(SQL.80).aspx\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;auto-parameterize queries\u0026lt;/a\u0026gt;, so using parameters isn\u0026apos;t really necessary from a performance standpoint - it is, however, \u0026lt;em\u0026gt;critical\u0026lt;/em\u0026gt; from a security standpoint - especially with user inputted data like this.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Here\u0026apos;s a quick-and-dirty technique I have used:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Tags\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|ruby|rails|scruffy|rubyonrails|\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;LIKE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%|\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; Name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|%\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;So here\u0026apos;s the C# code:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;string[] tags \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; string[] { \u0026quot;ruby\u0026quot;, \u0026quot;rails\u0026quot;, \u0026quot;scruffy\u0026quot;, \u0026quot;rubyonrails\u0026quot; };\nconst string cmdText \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026quot;select * from tags where \u0026apos;|\u0026apos; + @tags + \u0026apos;|\u0026apos; like \u0026apos;%|\u0026apos; + Name + \u0026apos;|%\u0026apos;\u0026quot;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; (SqlCommand cmd \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlCommand(cmdText)) {\n   cmd.Parameters.AddWithValue(\u0026quot;@tags\u0026quot;, string.Join(\u0026quot;|\u0026quot;, tags);\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Two caveats:\u0026lt;/p\u0026gt;\n\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;The performance is terrible. \u0026lt;code\u0026gt;LIKE \u0026quot;%...%\u0026quot;\u0026lt;/code\u0026gt; queries are not indexed.\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Make sure you don\u0026apos;t have any \u0026lt;code\u0026gt;|\u0026lt;/code\u0026gt;, blank, or null tags or this won\u0026apos;t work\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\n\u0026lt;p\u0026gt;There are other ways to accomplish this that some people may consider cleaner, so please keep reading.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;For SQL Server 2008, you can use a \u0026lt;a href=\u0026quot;http://msdn.microsoft.com/en-us/library/bb675163.aspx\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;table valued parameter\u0026lt;/a\u0026gt;. It\u0026apos;s a bit of work, but it is arguably cleaner than \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/337704/parameterizing-a-sql-in-clause#337792\u0026quot;\u0026gt;my other method\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;First, you have to create a type\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; TYPE dbo.TagNamesTableType \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TABLE\u0026lt;/span\u0026gt; ( Name nvarchar(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;50\u0026lt;/span\u0026gt;) )\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Then, your ADO.NET code looks like this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-cs s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-csharp\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt;[] tags = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt;[] { \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;ruby\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;rails\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;scruffy\u0026quot;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;rubyonrails\u0026quot;\u0026lt;/span\u0026gt; };\ncmd.CommandText = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;SELECT Tags.* FROM Tags JOIN @tagNames as P ON Tags.Name = P.Name\u0026quot;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// value must be IEnumerable\u0026amp;lt;SqlDataRecord\u0026amp;gt;\u0026lt;/span\u0026gt;\ncmd.Parameters.AddWithValue(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;@tagNames\u0026quot;\u0026lt;/span\u0026gt;, tags.AsSqlDataRecord(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;Name\u0026quot;\u0026lt;/span\u0026gt;)).SqlDbType = SqlDbType.Structured;\ncmd.Parameters[\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;@tagNames\u0026quot;\u0026lt;/span\u0026gt;].TypeName = \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026quot;dbo.TagNamesTableType\u0026quot;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Extension method for converting IEnumerable\u0026amp;lt;string\u0026amp;gt; to IEnumerable\u0026amp;lt;SqlDataRecord\u0026amp;gt;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-function\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;public\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; IEnumerable\u0026amp;lt;SqlDataRecord\u0026amp;gt; \u0026lt;span class=\u0026quot;hljs-title\u0026quot;\u0026gt;AsSqlDataRecord\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-params\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;this\u0026lt;/span\u0026gt; IEnumerable\u0026amp;lt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt;\u0026amp;gt; values, \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;string\u0026lt;/span\u0026gt; columnName\u0026lt;/span\u0026gt;)\u0026lt;/span\u0026gt; {\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;if\u0026lt;/span\u0026gt; (values == \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt; || !values.Any()) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;// Annoying, but SqlClient wants null instead of 0 rows\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; firstRecord = values.First();\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; metadata= \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlMetaData(columnName, SqlDbType.NVarChar, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;50\u0026lt;/span\u0026gt;); \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;//50 as per SQL Type\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; values.Select(v =\u0026amp;gt; \n    {\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;var\u0026lt;/span\u0026gt; r = \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlDataRecord(metadata);\n       r.SetValues(v);\n       \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; r;\n    });\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Update\u0026lt;/strong\u0026gt;\nAs Per @Doug\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Please try to avoid \u0026lt;code\u0026gt;var metadata = SqlMetaData.InferFromValue(firstRecord, columnName);\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;It\u0026apos;s set first value length, so if first value is 3 characters then its set max length 3 and other records will truncated if more then 3 characters.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;So, please try to use: \u0026lt;code\u0026gt;var metadata= new SqlMetaData(columnName, SqlDbType.NVarChar, maxLen);\u0026lt;/code\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Note: \u0026lt;code\u0026gt;-1\u0026lt;/code\u0026gt; for max length.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The original question was \u0026lt;strong\u0026gt;\u0026quot;How do I parameterize a query ...\u0026quot;\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;This is \u0026lt;strong\u0026gt;not an answer\u0026lt;/strong\u0026gt; to that original question. There are some very good demonstrations of how to do that, in other answers.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;See the \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/337864\u0026quot;\u0026gt;answer from Mark Brackett\u0026lt;/a\u0026gt; for the preferred answer that I (and 231 others) upvoted. The approach given in his answer allows 1) for effective use of bind variables, and 2) for predicates that are sargable.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Selected answer\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I am addressing here the approach given in Joel Spolsky\u0026apos;s answer, the answer \u0026quot;selected\u0026quot; as the right answer.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Joel Spolsky\u0026apos;s approach is clever.  And it works reasonably, it\u0026apos;s going to exhibit predictable behavior and predictable performance, given \u0026quot;normal\u0026quot; values, and with the normative edge cases, such as NULL and the empty string.  And it may be sufficient for a particular application.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;But in terms generalizing this approach, let\u0026apos;s also consider the more obscure corner cases, like when the \u0026lt;code\u0026gt;Name\u0026lt;/code\u0026gt; column contains a wildcard character (as recognized by the LIKE predicate.)  The wildcard character I see most commonly used is \u0026lt;code\u0026gt;%\u0026lt;/code\u0026gt; (a percent sign.). So let\u0026apos;s deal with that here now, and later go on to other cases.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Some problems with % character\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Consider a Name value of \u0026lt;code\u0026gt;\u0026apos;pe%ter\u0026apos;\u0026lt;/code\u0026gt;.  (For the examples here, I use a literal string value in place of the column name.)  A row with a Name value of `\u0026apos;pe%ter\u0026apos; would be returned by a query of the form:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; ...\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|peanut|butter|\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;like\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%|\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;pe%ter\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|%\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;But that same row will \u0026lt;strong\u0026gt;not\u0026lt;/strong\u0026gt; be returned if the order of the search terms is reversed:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; ...\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|butter|peanut|\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;like\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%|\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;pe%ter\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|%\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;The behavior we observe is kind of odd.  Changing the order of the search terms in the list changes the result set.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;It almost goes without saying that we might not want \u0026lt;code\u0026gt;pe%ter\u0026lt;/code\u0026gt; to match peanut butter, no matter how much he likes it.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Obscure corner case\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;(Yes, I will agree that this is an obscure case.  Probably one that is not likely to be tested.  We wouldn\u0026apos;t expect a wildcard in a column value.  We may assume that the application prevents such a value from being stored.  But in my experience, I\u0026apos;ve rarely seen a database constraint that specifically disallowed characters or patterns that would be considered wildcards on the right side of a \u0026lt;code\u0026gt;LIKE\u0026lt;/code\u0026gt; comparison operator.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Patching a hole\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;One approach to patching this hole is to escape the \u0026lt;code\u0026gt;%\u0026lt;/code\u0026gt; wildcard character.  (For anyone not familiar with the escape clause on the operator, here\u0026apos;s a link to the \u0026lt;a href=\u0026quot;http://msdn.microsoft.com/en-us/library/aa933232(SQL.80).aspx\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;SQL Server documentation\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; ...\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|peanut|butter|\u0026apos;\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;like\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%|\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;pe\\%ter\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|%\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;escape\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\\\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;Now we can match the literal %.  Of course, when we have a column name, we\u0026apos;re going to need to dynamically escape the wildcard.  We can use the \u0026lt;code\u0026gt;REPLACE\u0026lt;/code\u0026gt; function to find occurrences of the \u0026lt;code\u0026gt;% \u0026lt;/code\u0026gt;character and insert a backslash character in front of each one, like this:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; ...\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|pe%ter|\u0026apos;\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;like\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%|\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; REPLACE( \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;pe%ter\u0026apos;\u0026lt;/span\u0026gt; ,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\\%\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|%\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;escape\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\\\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;So that solves the problem with the % wildcard.  Almost.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Escape the escape\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;We recognize that our solution has introduced another problem.  The escape character.  We see that we\u0026apos;re also going to need to escape any occurrences of escape character itself.  This time, we use the ! as the escape character:\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; ...\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|pe%t!r|\u0026apos;\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;like\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%|\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; REPLACE(REPLACE( \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;pe%t!r\u0026apos;\u0026lt;/span\u0026gt; ,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;!\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;!!\u0026apos;\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;!%\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|%\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;escape\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;!\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;The underscore too\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Now that we\u0026apos;re on a roll, we can add another \u0026lt;code\u0026gt;REPLACE\u0026lt;/code\u0026gt; handle the underscore wildcard.   And just for fun, this time, we\u0026apos;ll use $ as the escape character.\u0026lt;/p\u0026gt;\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; ...\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|p_%t!r|\u0026apos;\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;like\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%|\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; REPLACE(REPLACE(REPLACE( \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;p_%t!r\u0026apos;\u0026lt;/span\u0026gt; ,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$$\u0026apos;\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$%\u0026apos;\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;_\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$_\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;|%\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;escape\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;$\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;p\u0026gt;I prefer this approach to escaping because it works in Oracle and MySQL as well as SQL Server.  (I usually use the \\ backslash as the escape character, since that\u0026apos;s the character we use in regular expressions. But why be constrained by convention!\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Those pesky brackets\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;SQL Server also allows for wildcard characters to be treated as literals by enclosing them in brackets \u0026lt;code\u0026gt;[]\u0026lt;/code\u0026gt;.  So we\u0026apos;re not done fixing yet, at least for SQL Server.  Since pairs of brackets have special meaning, we\u0026apos;ll need to escape those as well.  If we manage to properly escape the brackets, then at least we won\u0026apos;t have to bother with the hyphen \u0026lt;code\u0026gt;-\u0026lt;/code\u0026gt; and the carat \u0026lt;code\u0026gt;^\u0026lt;/code\u0026gt; within the brackets.  And we can leave any \u0026lt;code\u0026gt;% \u0026lt;/code\u0026gt;and \u0026lt;code\u0026gt;_\u0026lt;/code\u0026gt; characters inside the brackets escaped, since we\u0026apos;ll have basically disabled the special meaning of the brackets.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Finding matching pairs of brackets shouldn\u0026apos;t be that hard.  It\u0026apos;s a little more difficult than handling the occurrences of singleton % and _.  (Note that it\u0026apos;s not sufficient to just escape all occurrences of brackets, because a singleton bracket is considered to be a literal, and doesn\u0026apos;t need to be escaped. The logic is getting a little fuzzier than I can handle without running more test cases.)\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Inline expression gets messy\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;That inline expression in the SQL is getting longer and uglier.  We can probably make it work, but heaven help the poor soul that comes behind and has to decipher it.  As much of a fan I am for inline expressions, I\u0026apos;m inclined not use one here, mainly because I don\u0026apos;t want to have to leave a comment explaining the reason for the mess, and apologizing for it.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;A function where ?\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;Okay, so, if we don\u0026apos;t handle that as an inline expression in the SQL, the closest alternative we have is a user defined function.  And we know that won\u0026apos;t speed things up any (unless we can define an index on it, like we could with Oracle.)  If we\u0026apos;ve got to create a function, we might better do that in the code that calls the SQL statement.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;And that function may have some differences in behavior, dependent on the DBMS and version.  (A shout out to all you Java developers so keen on being able to use any database engine interchangeably.)\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Domain knowledge\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;We may have specialized knowledge of the domain for the column, (that is, the set of allowable values enforced for the column.  We may know \u0026lt;em\u0026gt;a priori\u0026lt;/em\u0026gt; that the values stored in the column will never contain a percent sign, an underscore, or bracket pairs.  In that case, we just include a quick comment that those cases are covered.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;The values stored in the column may allow for % or _ characters, but a constraint may require those values to be escaped, perhaps using a defined character, such that the values are LIKE comparison \u0026quot;safe\u0026quot;.  Again, a quick comment about the allowed set of values, and in particular which character is used as an escape character, and go with Joel Spolsky\u0026apos;s approach.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;But, absent the specialized knowledge and a guarantee, it\u0026apos;s important for us to at least consider handling those obscure corner cases, and consider whether the behavior is reasonable and \u0026quot;per the specification\u0026quot;.\u0026lt;/p\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Other issues recapitulated\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I believe others have already sufficiently pointed out some of the other commonly considered areas of concern:\u0026lt;/p\u0026gt;\n\u0026lt;ul\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/SQL_injection\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;SQL injection\u0026lt;/a\u0026gt; (taking what would appear to be user supplied information, and including that in the SQL text rather than supplying them through bind variables.  Using bind variables isn\u0026apos;t required, it\u0026apos;s just one convenient approach to thwart with SQL injection.  There are other ways to deal with it:\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;optimizer plan using index scan rather than index seeks, possible need for an expression or function for escaping wildcards (possible index on expression or function)\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;p\u0026gt;using literal values in place of bind variables impacts scalability\u0026lt;/p\u0026gt;\n\u0026lt;/li\u0026gt;\n\u0026lt;/ul\u0026gt;\n\u0026lt;hr\u0026gt;\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Conclusion\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;I like Joel Spolsky\u0026apos;s approach.  It\u0026apos;s clever.  And it works.\u0026lt;/p\u0026gt;\n\u0026lt;p\u0026gt;But as soon as I saw it, I immediately saw a potential problem with it, and it\u0026apos;s not my nature to let it slide.  I don\u0026apos;t mean to be critical of the efforts of others.  I know many developers take their work very personally, because they invest so much into it and they care so much about it.  So please understand, this is not a personal attack.  What I\u0026apos;m identifying here is the type of problem that crops up in production rather than testing.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;You can pass the parameter as a string\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;So you have the string \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@tags\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SET\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@tags\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; ruby\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;rails\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;scruffy\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;rubyonrails\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; Tags \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; Name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; item \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; fnSplit(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@tags\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;|\u0026lt;/span\u0026gt;))\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;order\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; Count \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;desc\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Then all you have to do is pass the string as 1 parameter.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Here is the split function I use.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FUNCTION\u0026lt;/span\u0026gt; [dbo].[fnSplit](\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sInputList\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8000\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- List of delimited items\u0026lt;/span\u0026gt;\n  , \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sDelimiter\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8000\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- delimiter that separates items\u0026lt;/span\u0026gt;\n) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;RETURNS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@List\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TABLE\u0026lt;/span\u0026gt; (item \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8000\u0026lt;/span\u0026gt;))\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BEGIN\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sItem\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8000\u0026lt;/span\u0026gt;)\nWHILE CHARINDEX(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sDelimiter\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sInputList\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BEGIN\u0026lt;/span\u0026gt;\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sItem\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;RTRIM(LTRIM(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUBSTRING\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sInputList\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,CHARINDEX(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sDelimiter\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sInputList\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt;))),\n  \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sInputList\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;RTRIM(LTRIM(\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUBSTRING\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sInputList\u0026lt;/span\u0026gt;,CHARINDEX(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sDelimiter\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sInputList\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;LEN(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sDelimiter\u0026lt;/span\u0026gt;),LEN(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sInputList\u0026lt;/span\u0026gt;))))\n\n IF LEN(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sItem\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INTO\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@List\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sItem\u0026lt;/span\u0026gt;\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;END\u0026lt;/span\u0026gt;\n\nIF LEN(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sInputList\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INTO\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@List\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sInputList\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- Put the last item in\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;RETURN\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;END\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I heard Jeff/Joel talk about this on the podcast today (\u0026lt;em\u0026gt;\u0026lt;a href=\u0026quot;http://itc.conversationsnetwork.org/audio/download/ITC.SO-Episode34-2008.12.16.mp3\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;episode 34\u0026lt;/a\u0026gt;\u0026lt;/em\u0026gt;, 2008-12-16 (MP3, 31\u0026amp;nbsp;MB), 1 h 03 min 38 secs - 1 h 06 min 45 secs), and I thought I recalled Stack\u0026amp;nbsp;Overflow was using \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;LINQ\u0026amp;nbsp;to\u0026amp;nbsp;SQL\u0026lt;/a\u0026gt;, but maybe it was ditched. Here\u0026apos;s the same thing in LINQ\u0026amp;nbsp;to\u0026amp;nbsp;SQL.  \u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;var inValues \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; [] { \u0026quot;ruby\u0026quot;,\u0026quot;rails\u0026quot;,\u0026quot;scruffy\u0026quot;,\u0026quot;rubyonrails\u0026quot; };\n\nvar results \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; tag \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; Tags\n              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; inValues.Contains(tag.Name)\n              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; tag;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;That\u0026apos;s it. And, yes, LINQ already looks backwards enough, but the \u0026lt;code\u0026gt;Contains\u0026lt;/code\u0026gt; clause seems extra backwards to me. When I had to do a similar query for a project at work, I naturally tried to do this the wrong way by doing a join between the local array and the SQL Server table, figuring the LINQ\u0026amp;nbsp;to\u0026amp;nbsp;SQL translator would be smart enough to handle the translation somehow. It didn\u0026apos;t, but it did provide an error message that was descriptive and pointed me towards using \u0026lt;em\u0026gt;Contains\u0026lt;/em\u0026gt;.  \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Anyway, if you run this in the highly recommended \u0026lt;a href=\u0026quot;http://www.linqpad.net/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;LINQPad\u0026lt;/a\u0026gt;, and run this query, you can view the actual SQL that the SQL LINQ provider generated. It\u0026apos;ll show you each of the values getting parameterized into an \u0026lt;code\u0026gt;IN\u0026lt;/code\u0026gt; clause.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;If you are calling from .NET, you could use \u0026lt;a href=\u0026quot;https://github.com/StackExchange/Dapper\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Dapper dot net\u0026lt;/a\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;string[] names \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; string[] {\u0026quot;ruby\u0026quot;,\u0026quot;rails\u0026quot;,\u0026quot;scruffy\u0026quot;,\u0026quot;rubyonrails\u0026quot;};\nvar tags \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; dataContext.Query\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;Tags\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;(@\u0026quot;\nselect * from Tags \nwhere Name in @names\norder by Count desc\u0026quot;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; {names});\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Here Dapper does the thinking, so you don\u0026apos;t have to. Something similar is possible with \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;LINQ\u0026amp;nbsp;to\u0026amp;nbsp;SQL\u0026lt;/a\u0026gt;, of course:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;string[] names \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; string[] {\u0026quot;ruby\u0026quot;,\u0026quot;rails\u0026quot;,\u0026quot;scruffy\u0026quot;,\u0026quot;rubyonrails\u0026quot;};\nvar tags \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; tag \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; dataContext.Tags\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; names.Contains(tag.Name)\n           orderby tag.Count descending\n           \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; tag;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In \u0026lt;code\u0026gt;SQL Server 2016+\u0026lt;/code\u0026gt; you could use \u0026lt;a href=\u0026quot;https://msdn.microsoft.com/en-us/library/mt684588.aspx\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;STRING_SPLIT\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; function:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@names\u0026lt;/span\u0026gt; NVARCHAR(MAX) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ruby,rails,scruffy,rubyonrails\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Tags\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; Name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;IN\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;] \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; STRING_SPLIT(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@names\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;))\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ORDER\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; [Count] \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DESC\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;or:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@names\u0026lt;/span\u0026gt; NVARCHAR(MAX) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ruby,rails,scruffy,rubyonrails\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; t.\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Tags t\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;JOIN\u0026lt;/span\u0026gt; STRING_SPLIT(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@names\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;)\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ON\u0026lt;/span\u0026gt; t.Name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; [\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;]\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ORDER\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; [Count] \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DESC\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;a href=\u0026quot;https://data.stackexchange.com/stackoverflow/query/481811\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;LiveDemo\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/337817/5070879\u0026quot;\u0026gt;accepted answer\u0026lt;/a\u0026gt; will of course work and it is one of the way to go, but it is anti-pattern.\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;E. Find rows by list of values\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n  \n  \u0026lt;p\u0026gt;This is replacement for common anti-pattern such as creating a dynamic SQL string in application layer or Transact-SQL, or by using LIKE operator:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; ProductId, Name, Tags\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Product\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,1,2,3,\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;LIKE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%,\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;CAST\u0026lt;/span\u0026gt;(ProductId \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;)) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,%\u0026apos;\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;hr\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;em\u0026gt;Addendum\u0026lt;/em\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;To improve the \u0026lt;code\u0026gt;STRING_SPLIT\u0026lt;/code\u0026gt; table function row estimation, it is a good idea to materialize splitted values as temporary table/table variable:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@names\u0026lt;/span\u0026gt; NVARCHAR(MAX) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ruby,rails,scruffy,rubyonrails,sql\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TABLE\u0026lt;/span\u0026gt; #t(val NVARCHAR(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;120\u0026lt;/span\u0026gt;));\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INTO\u0026lt;/span\u0026gt; #t(val) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; s.[\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;] \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; STRING_SPLIT(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@names\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;) s;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Tags tg\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;JOIN\u0026lt;/span\u0026gt; #t t\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ON\u0026lt;/span\u0026gt; t.val \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; tg.TagName\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ORDER\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; [Count] \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DESC\u0026lt;/span\u0026gt;;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;\u0026lt;a href=\u0026quot;https://data.stackexchange.com/stackoverflow/query/1196908?opt.withExecutionPlan=true#executionPlan\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;SEDE - Live Demo\u0026lt;/a\u0026gt;\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Related: \u0026lt;a href=\u0026quot;https://www.brentozar.com/archive/2020/02/how-to-pass-a-list-of-values-into-a-stored-procedure/\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;How to Pass a List of Values Into a Stored Procedure\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\u0026lt;hr\u0026gt;\n\u0026lt;sup\u0026gt;Original question has requirement \u0026lt;code\u0026gt;SQL Server 2008\u0026lt;/code\u0026gt;. Because this question is often used as duplicate, I\u0026apos;ve added this answer as reference. \u0026lt;/sup\u0026gt;\u0026lt;p\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;This is possibly a half nasty way of doing it, I used it once, was rather effective.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Depending on your goals it might be of use. \u0026lt;/p\u0026gt;\n\n\u0026lt;ol\u0026gt;\n\u0026lt;li\u0026gt;Create a \u0026lt;em\u0026gt;temp table\u0026lt;/em\u0026gt; with one column. \u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;\u0026lt;code\u0026gt;INSERT\u0026lt;/code\u0026gt; each look-up value into that column. \u0026lt;/li\u0026gt;\n\u0026lt;li\u0026gt;Instead of using an \u0026lt;code\u0026gt;IN\u0026lt;/code\u0026gt;, you can then just use your standard \u0026lt;code\u0026gt;JOIN\u0026lt;/code\u0026gt; rules. ( Flexibility++ )\u0026lt;/li\u0026gt;\n\u0026lt;/ol\u0026gt;\n\n\u0026lt;p\u0026gt;This has a bit of added flexibility in what you can do, but it\u0026apos;s more suited for situations where you have a large table to query, with good indexing, and you want to use the parametrized list more than once. Saves having to execute it twice and have all the sanitation done manually.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I never got around to profiling exactly how \u0026lt;em\u0026gt;fast\u0026lt;/em\u0026gt; it was, but in my situation it was needed. \u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;We have function that creates a table variable that you can join to:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ALTER\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FUNCTION\u0026lt;/span\u0026gt; [dbo].[Fn_sqllist_to_table](\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8000\u0026lt;/span\u0026gt;),\n                                           \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@delim\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt;))\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;RETURNS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@listTable\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TABLE\u0026lt;/span\u0026gt;(\n  Position \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;INT\u0026lt;/span\u0026gt;,\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Value\u0026lt;/span\u0026gt;    \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8000\u0026lt;/span\u0026gt;))\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BEGIN\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@myPos\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;INT\u0026lt;/span\u0026gt;\n\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SET\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@myPos\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n\n      WHILE Charindex(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@delim\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BEGIN\u0026lt;/span\u0026gt;\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INTO\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@listTable\u0026lt;/span\u0026gt;\n                        (Position,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Value\u0026lt;/span\u0026gt;)\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;VALUES\u0026lt;/span\u0026gt;     (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@myPos\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;LEFT\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;, Charindex(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@delim\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;))\n\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SET\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@myPos\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@myPos\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;\n\n            IF Charindex(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@delim\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; Len(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;)\n              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INTO\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@listTable\u0026lt;/span\u0026gt;\n                          (Position,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Value\u0026lt;/span\u0026gt;)\n              \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;VALUES\u0026lt;/span\u0026gt;     (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@myPos\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)\n\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SET\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;RIGHT\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;, Len(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt; Charindex(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@delim\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;))\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;END\u0026lt;/span\u0026gt;\n\n      IF Len(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INTO\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@listTable\u0026lt;/span\u0026gt;\n                    (Position,\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Value\u0026lt;/span\u0026gt;)\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;VALUES\u0026lt;/span\u0026gt;     (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@myPos\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;)\n\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;RETURN\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;END\u0026lt;/span\u0026gt; \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;So:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@Name\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8000\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;parameter\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;search\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;values\u0026lt;/span\u0026gt;    \n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; Tags \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; Name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;From\u0026lt;/span\u0026gt; fn_sqllist_to_table(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@Name\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;)))\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;order\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; Count \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;desc\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;This is gross, but if you are guaranteed to have at least one, you could do:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; ...\n       ...\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; tag \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;IN\u0026lt;/span\u0026gt;( \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@tag1\u0026lt;/span\u0026gt;, ISNULL( \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@tag2\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@tag1\u0026lt;/span\u0026gt; ), ISNULL( \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@tag3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@tag1\u0026lt;/span\u0026gt; ), etc. )\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Having IN( \u0026apos;tag1\u0026apos;, \u0026apos;tag2\u0026apos;, \u0026apos;tag1\u0026apos;, \u0026apos;tag1\u0026apos;, \u0026apos;tag1\u0026apos; ) will be easily optimized away by SQL Server. Plus, you get direct index seeks\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I would pass a table type parameter (since it\u0026apos;s \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2008\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;SQL Server 2008\u0026lt;/a\u0026gt;), and do a \u0026lt;code\u0026gt;where exists\u0026lt;/code\u0026gt;, or inner join. You may also use XML, using \u0026lt;code\u0026gt;sp_xml_preparedocument\u0026lt;/code\u0026gt;, and then even index that temporary table.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In my opinion, the best source to solve this problem, is what has been posted on this site:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://weblogs.sqlteam.com/dinakar/archive/2007/03/28/60150.aspx\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Syscomments. Dinakar Nethi\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FUNCTION\u0026lt;/span\u0026gt; dbo.fnParseArray (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@Array\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1000\u0026lt;/span\u0026gt;),\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;CHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;))\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;RETURNS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@T\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Table\u0026lt;/span\u0026gt; (col1 \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;50\u0026lt;/span\u0026gt;))\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BEGIN\u0026lt;/span\u0026gt;\n \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;--DECLARE @T Table (col1 varchar(50))  \u0026lt;/span\u0026gt;\n \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- @Array is the array we wish to parse\u0026lt;/span\u0026gt;\n \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- @Separator is the separator charactor such as a comma\u0026lt;/span\u0026gt;\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt;_position \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;INT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- This is used to locate each separator character\u0026lt;/span\u0026gt;\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;_value \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1000\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- this holds each array value as it is returned\u0026lt;/span\u0026gt;\n \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- For my loop to work I need an extra separator at the end. I always look to the\u0026lt;/span\u0026gt;\n \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- left of the separator character for each array value\u0026lt;/span\u0026gt;\n\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SET\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt;\n\n \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- Loop through the string searching for separtor characters\u0026lt;/span\u0026gt;\n WHILE PATINDEX(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt; \n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BEGIN\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- patindex matches the a pattern against a string\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt;_position \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; PATINDEX(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;)\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;_value \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;LEFT\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt;_position \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- This is where you process the values passed.\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;into\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@T\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;VALUES\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;_value)    \n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- Replace this select statement with your processing\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- @array_value holds the value of this element of the array\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- This replaces what we just processed with and empty string\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; STUFF(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt;_position, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;END\u0026lt;/span\u0026gt;\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;RETURN\u0026lt;/span\u0026gt; \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;END\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Use:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; dbo.fnParseArray(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;a,b,c,d,e,f\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;CREDITS FOR: Dinakar Nethi\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The proper way IMHO is to store the list in a character string (limited in length by what the DBMS support); the only trick is that (in order to simplify processing) I have a separator (a comma in my example) at the beginning and at the end of the string. The idea is to \u0026quot;normalize on the fly\u0026quot;, turning the list into a one-column table that contains one row per value. This allows you to turn\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;in (ct1,ct2, ct3 ... ctn)\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;into an\u0026lt;/p\u0026gt;\n\n\u0026lt;blockquote\u0026gt;\n  \u0026lt;p\u0026gt;in (select ...)\u0026lt;/p\u0026gt;\n\u0026lt;/blockquote\u0026gt;\n\n\u0026lt;p\u0026gt;or (the solution I\u0026apos;d probably prefer) a regular join, if you just add a \u0026quot;distinct\u0026quot; to avoid problems with duplicate values in the list.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Unfortunately, the techniques to slice a string are fairly product-specific.\nHere is the SQL Server version:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;with\u0026lt;/span\u0026gt; qry(n, names) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt;\n       (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; len(list.names) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt; len(replace(list.names, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; n,\n               \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;substring\u0026lt;/span\u0026gt;(list.names, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;, len(list.names)) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; names\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,Doc,Grumpy,Happy,Sneezy,Bashful,Sleepy,Dopey,\u0026apos;\u0026lt;/span\u0026gt; names) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; list\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;union\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; (n \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; n,\n               \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;substring\u0026lt;/span\u0026gt;(names, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;, names), len(names)) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; names\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; qry\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; n \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; n, \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;substring\u0026lt;/span\u0026gt;(names, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, charindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;, names) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;) dwarf\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; qry;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;The Oracle version:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; n, substr(name, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, instr(name, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;) dwarf\n \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; n,\n             substr(val, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; instr(val, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, n)) name\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; rownum \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; n,\n                   list.val\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt;  (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,Doc,Grumpy,Happy,Sneezy,Bashful,Sleepy,Dopey,\u0026apos;\u0026lt;/span\u0026gt; val\n                   \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; dual) list\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;connect\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; level \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt; length(list.val) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt;\n                               length(replace(list.val, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;))));\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;and the MySQL version:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; pivot.n,\n      substring_index(substring_index(list.val, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; pivot.n), \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; n\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;union\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; n\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;union\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; n\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;union\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; n\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;union\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; n\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;union\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;6\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; n\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;union\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;7\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; n\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;union\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; n\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;union\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;9\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; n\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;union\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;all\u0026lt;/span\u0026gt;\n     \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;10\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; n) pivot,    (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,Doc,Grumpy,Happy,Sneezy,Bashful,Sleepy,Dopey,\u0026apos;\u0026lt;/span\u0026gt; val) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; list \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; pivot.n \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;  length(list.val) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt;\n                   length(replace(list.val, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;));\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;(Of course, \u0026quot;pivot\u0026quot; must return as many rows as the maximum number of\nitems we can find in the list)\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;If you\u0026apos;ve got \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2008\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;SQL Server 2008\u0026lt;/a\u0026gt; or later I\u0026apos;d use a \u0026lt;a href=\u0026quot;https://stackoverflow.com/questions/5595353/how-to-pass-table-value-parameters-to-stored-procedure-from-net-code\u0026quot;\u0026gt;Table Valued Parameter\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;If you\u0026apos;re unlucky enough to be stuck on \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2005\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;SQL Server 2005\u0026lt;/a\u0026gt; you could add a \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Common_Language_Runtime\u0026quot; rel=\u0026quot;nofollow noreferrer\u0026quot;\u0026gt;CLR\u0026lt;/a\u0026gt; function like this,\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;[SqlFunction(\n    DataAccessKind.None,\n    IsDeterministic \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;,\n    SystemDataAccess \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; SystemDataAccessKind.None,\n    IsPrecise \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-literal\u0026quot;\u0026gt;true\u0026lt;/span\u0026gt;,\n    FillRowMethodName \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026quot;SplitFillRow\u0026quot;,\n    TableDefinintion \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026quot;s NVARCHAR(MAX)\u0026quot;]\npublic \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; IEnumerable Split(SqlChars seperator, SqlString s)\n{\n    if (s.IsNull)\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; string[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;];\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; s.ToString().Split(seperator.Buffer);\n}\n\npublic \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; void SplitFillRow(object \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;row\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;out\u0026lt;/span\u0026gt; SqlString s)\n{\n    s \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlString(row.ToString());\n}\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Which you could use like this,\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@desiredTags\u0026lt;/span\u0026gt; nvarchar(MAX);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@desiredTags\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ruby,rails,scruffy,rubyonrails\u0026apos;\u0026lt;/span\u0026gt;;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; Tags\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; Name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; [dbo].[Split] (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@desiredTags\u0026lt;/span\u0026gt;)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;order\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; Count \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;desc\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I think this is a case when a static query is just not the way to go. Dynamically build the list for your in clause, escape your single quotes, and dynamically build SQL. In this case you probably won\u0026apos;t see much of a difference with any method due to the small list, but the most efficient method really is to send the SQL exactly as it is written in your post. I think it is a good habit to write it the most efficient way, rather than to do what makes the prettiest code, or consider it bad practice to dynamically build SQL.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I have seen the split functions take longer to execute than the query themselves in many cases where the parameters get large. A stored procedure with table valued parameters in SQL 2008 is the only other option I would consider, although this will probably be slower in your case. TVP will probably only be faster for large lists if you are searching on the primary key of the TVP, because SQL will build a temporary table for the list anyway (if the list is large). You won\u0026apos;t know for sure unless you test it.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I have also seen stored procedures that had 500 parameters with default values of null, and having WHERE Column1 IN (@Param1, @Param2, @Param3, ..., @Param500). This caused SQL to build a temp table, do a sort/distinct, and then do a table scan instead of an index seek. That is essentially what you would be doing by parameterizing that query, although on a small enough scale that it won\u0026apos;t make a noticeable difference. I highly recommend against having NULL in your IN lists, as if that gets changed to a NOT IN it will not act as intended. You could dynamically build the parameter list, but the only obvious thing that you would gain is that the objects would escape the single quotes for you. That approach is also slightly slower on the application end since the objects have to parse the query to find the parameters. It may or may not be faster on SQL, as parameterized queries call sp_prepare, sp_execute for as many times you execute the query, followed by sp_unprepare. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The reuse of execution plans for stored procedures or parameterized queries may give you a performance gain, but it will lock you in to one execution plan determined by the first query that is executed. That may be less than ideal for subsequent queries in many cases. In your case, reuse of execution plans will probably be a plus, but it might not make any difference at all as the example is a really simple query.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Cliffs notes:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;For your case anything you do, be it parameterization with a fixed number of items in the list (null if not used), dynamically building the query with or without parameters, or using stored procedures with table valued parameters will not make much of a difference. However, my general recommendations are as follows:\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Your case/simple queries with few parameters:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Dynamic SQL, maybe with parameters if testing shows better performance.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Queries with reusable execution plans, called multiple times by simply changing the parameters or if the query is complicated:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;SQL with dynamic parameters.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;Queries with large lists:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Stored procedure with table valued parameters. If the list can vary by a large amount use WITH RECOMPILE on the stored procedure, or simply use dynamic SQL without parameters to generate a new execution plan for each query.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;May be we can use XML here:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@x\u0026lt;/span\u0026gt; xml\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@x\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026amp;lt;items\u0026amp;gt;\n    \u0026amp;lt;item myvalue=\u0026quot;29790\u0026quot; /\u0026amp;gt;\n    \u0026amp;lt;item myvalue=\u0026quot;31250\u0026quot; /\u0026amp;gt;\n    \u0026amp;lt;/items\u0026amp;gt;\n    \u0026apos;\u0026lt;/span\u0026gt;;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;With\u0026lt;/span\u0026gt; CTE \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; (\n         \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \n            x.item.value(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;@myvalue[1]\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;decimal\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; myvalue\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@x\u0026lt;/span\u0026gt;.nodes(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;//items/item\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; x(item) )\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; YourTable \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; tableColumnName \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; myvalue \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; cte)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;If we have strings stored inside the IN clause with the comma(,) delimited, we can use the charindex function to get the values. If you use .NET, then you can map with SqlParameters.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;DDL Script:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TABLE\u0026lt;/span\u0026gt; Tags\n    ([ID] \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;, [Name] \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;))\n;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INTO\u0026lt;/span\u0026gt; Tags\n    ([ID], [Name])\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;VALUES\u0026lt;/span\u0026gt;\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ruby\u0026apos;\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;rails\u0026apos;\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;scruffy\u0026apos;\u0026lt;/span\u0026gt;),\n    (\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;rubyonrails\u0026apos;\u0026lt;/span\u0026gt;)\n;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;T-SQL:\u0026lt;/strong\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@Param\u0026lt;/span\u0026gt; nvarchar(max)\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SET\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@Param\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ruby,rails,scruffy,rubyonrails\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Tags\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; CharIndex(Name,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@Param\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;You can use the above statement in your .NET code and map the parameter with SqlParameter.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;a href=\u0026quot;http://sqlfiddle.com/#!3/31994/3\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;Fiddler demo\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;\u0026lt;strong\u0026gt;EDIT:\u0026lt;/strong\u0026gt;\nCreate the table called SelectedTags using the following script.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;DDL Script:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Create\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt; SelectedTags\n(Name nvarchar(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;20\u0026lt;/span\u0026gt;));\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INTO\u0026lt;/span\u0026gt; SelectedTags \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;values\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ruby\u0026apos;\u0026lt;/span\u0026gt;),(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;rails\u0026apos;\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;T-SQL:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt; nvarchar(max)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;coalesce\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;st.Name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; SelectedTags st\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Tags\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; CharIndex(Name,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@Param\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I\u0026apos;d approach this by default with passing a table valued function (that returns a table from a string) to the IN condition.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Here is the code for the UDF \u0026lt;em\u0026gt;(I got it from Stack Overflow somewhere, i can\u0026apos;t find the source right now)\u0026lt;/em\u0026gt;\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FUNCTION\u0026lt;/span\u0026gt; [dbo].[Split] (\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sep\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;char\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;), \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@s\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8000\u0026lt;/span\u0026gt;))\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;RETURNS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;RETURN\u0026lt;/span\u0026gt; (\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WITH\u0026lt;/span\u0026gt; Pieces(pn, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;start\u0026lt;/span\u0026gt;, stop) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; (\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, CHARINDEX(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sep\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@s\u0026lt;/span\u0026gt;)\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;UNION\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ALL\u0026lt;/span\u0026gt;\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; pn \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, stop \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, CHARINDEX(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@sep\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@s\u0026lt;/span\u0026gt;, stop \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Pieces\n      \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; stop \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n    )\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \n      \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUBSTRING\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@s\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;start\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CASE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHEN\u0026lt;/span\u0026gt; stop \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;THEN\u0026lt;/span\u0026gt; stop\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;start\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ELSE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;512\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;END\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; s\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Pieces\n  )\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Once you got this your code would be as simple as this:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; Tags \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; Name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; s \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; dbo.split(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;;\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ruby;rails;scruffy;rubyonrails\u0026apos;\u0026lt;/span\u0026gt;))\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;order\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;by\u0026lt;/span\u0026gt; Count \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;desc\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Unless you have a ridiculously long string, this should work well with the table index.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;If needed you can insert it into a temp table, index it, then run a join...\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;For a variable number of arguments like this the only way I\u0026apos;m aware of is to either generate the SQL explicitly or do something that involves populating a temporary table with the items you want and joining against the temp table.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Another possible solution is instead of passing a variable number of arguments to a stored procedure, pass a single string containing the names you\u0026apos;re after, but make them unique by surrounding them with \u0026apos;\u0026amp;lt;\u0026amp;gt;\u0026apos;. Then use PATINDEX to find the names:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Tags \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; PATINDEX(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%\u0026amp;lt;\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; Name \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026amp;gt;%\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026amp;lt;jo\u0026amp;gt;,\u0026amp;lt;john\u0026amp;gt;,\u0026amp;lt;scruffy\u0026amp;gt;,\u0026amp;lt;rubyonrails\u0026amp;gt;\u0026apos;\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Use the following stored procedure. It uses a custom split function, which can be found \u0026lt;a href=\u0026quot;http://blogs.microsoft.co.il/blogs/itai/archive/2009/02/01/t-sql-split-function.aspx\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;here\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;create\u0026lt;/span\u0026gt; stored \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;procedure\u0026lt;/span\u0026gt; GetSearchMachingTagNames \n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@PipeDelimitedTagNames\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(max), \n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@delimiter\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;char\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;) \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt;  \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;begin\u0026lt;/span\u0026gt;\n         \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; Tags \n         \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; Name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; data \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; [dbo].[Split](\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@PipeDelimitedTagNames\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@delimiter\u0026lt;/span\u0026gt;) \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;end\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Here is another alternative. Just pass a comma-delimited list as a string parameter to the stored procedure and:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;PROCEDURE\u0026lt;/span\u0026gt; [dbo].[sp_myproc]\n    \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@UnitList\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(MAX) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;1,2,3\u0026apos;\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;column\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; ph.UnitID \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; CsvToInt(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@UnitList\u0026lt;/span\u0026gt;))\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;And the function:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Function\u0026lt;/span\u0026gt; [dbo].[CsvToInt] ( \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@Array\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(MAX))\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;returns\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@IntTable\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;table\u0026lt;/span\u0026gt;\n(IntValue \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;begin\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;char\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt;_position \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;declare\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;_value \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(MAX)\n\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;\n\n    while patindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%,%\u0026apos;\u0026lt;/span\u0026gt; , \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;begin\u0026lt;/span\u0026gt;\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt;_position \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; patindex(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;%,%\u0026apos;\u0026lt;/span\u0026gt; , \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;)\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;_value \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;left\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt;_position \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;)\n\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Insert\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@IntTable\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Values\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;Cast\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;_value \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt;))\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; stuff(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@array\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@separator\u0026lt;/span\u0026gt;_position, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;)\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;end\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;end\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/ColdFusion\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;ColdFusion\u0026lt;/a\u0026gt; we just do:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;cfset myvalues \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026quot;ruby|rails|scruffy|rubyonrails\u0026quot;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;cfquery name\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026quot;q\u0026quot;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;from\u0026lt;/span\u0026gt; sometable \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;where\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;values\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;cfqueryparam \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026quot;#myvalues#\u0026quot; list\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026quot;true\u0026quot;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;cfquery\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Here\u0026apos;s a technique that recreates a local table to be used in a query string. Doing it this way eliminates all parsing problems. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The string can be built in any language. In this example I used SQL since that was the original problem I was trying to solve. I needed a clean way to pass in table data on the fly in a string to be executed later.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Using a user defined type is optional. Creating the type is only created once and can be done ahead of time. Otherwise just add a full table type to the declaration in the string. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;The general pattern is easy to extend and can be used for passing more complex tables.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- Create a user defined type for the list.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; TYPE [dbo].[StringList] \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TABLE\u0026lt;/span\u0026gt;(\n    [StringValue] [nvarchar](max) \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NOT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;NULL\u0026lt;/span\u0026gt;\n)\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- Create a sample list using the list table type.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt; [dbo].[StringList]; \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INTO\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;VALUES\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;one\u0026apos;\u0026lt;/span\u0026gt;), (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;two\u0026apos;\u0026lt;/span\u0026gt;), (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;three\u0026apos;\u0026lt;/span\u0026gt;), (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;four\u0026apos;\u0026lt;/span\u0026gt;)\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- Build a string in which we recreate the list so we can pass it to exec\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- This can be done in any language since we\u0026apos;re just building a string.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@str\u0026lt;/span\u0026gt; nvarchar(max);\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SET\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@str\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;DECLARE @list [dbo].[StringList]; INSERT INTO @list VALUES \u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- Add all the values we want to the string. This would be a loop in C++.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@str\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@str\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;(\u0026apos;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; StringValue \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026apos;),\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@list\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- Remove the trailing comma so the query is valid sql.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SET\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@str\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;substring\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@str\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;, len(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@str\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt;)\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- Add a select to test the string.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SET\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@str\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@str\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;; SELECT * FROM @list;\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-comment\u0026quot;\u0026gt;-- Execute the string and see we\u0026apos;ve pass the table correctly.\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;EXEC\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@str\u0026lt;/span\u0026gt;)\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;In SQL Server 2016+ another possibility is to use the \u0026lt;a href=\u0026quot;https://msdn.microsoft.com/en-us/library/dn921879.aspx\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;\u0026lt;code\u0026gt;OPENJSON\u0026lt;/code\u0026gt;\u0026lt;/a\u0026gt; function.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This approach is blogged about in \u0026lt;a href=\u0026quot;http://blogs.msdn.com/b/sqlserverstorageengine/archive/2015/11/03/openjson-one-of-best-ways-to-select-rows-by-list-of-id.aspx\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;OPENJSON - one of best ways to select rows by list of ids\u0026lt;/a\u0026gt;.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;A full worked example below\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TABLE\u0026lt;/span\u0026gt; dbo.Tags\n  (\n     Name  \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;50\u0026lt;/span\u0026gt;),\n     Count \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;INT\u0026lt;/span\u0026gt;\n  )\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INSERT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;INTO\u0026lt;/span\u0026gt; dbo.Tags\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;VALUES\u0026lt;/span\u0026gt;      (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;VB\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;982\u0026lt;/span\u0026gt;), (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ruby\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1306\u0026lt;/span\u0026gt;), (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;rails\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1478\u0026lt;/span\u0026gt;), (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;scruffy\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;), (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;C#\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1784\u0026lt;/span\u0026gt;)\n\nGO\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;CREATE\u0026lt;/span\u0026gt; PROC dbo.SomeProc\n\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@Tags\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;VARCHAR\u0026lt;/span\u0026gt;(MAX)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; T.\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt;\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt;   dbo.Tags T\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt;  T.Name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;IN\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; J.Value \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;COLLATE\u0026lt;/span\u0026gt; Latin1_General_CI_AS\n                  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt;   OPENJSON(CONCAT(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;[\u0026apos;\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@Tags\u0026lt;/span\u0026gt;, \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;]\u0026apos;\u0026lt;/span\u0026gt;)) J)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ORDER\u0026lt;/span\u0026gt;  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; T.Count \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DESC\u0026lt;/span\u0026gt;\n\nGO\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;EXEC\u0026lt;/span\u0026gt; dbo.SomeProc \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@Tags\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026quot;ruby\u0026quot;,\u0026quot;rails\u0026quot;,\u0026quot;scruffy\u0026quot;,\u0026quot;rubyonrails\u0026quot;\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DROP\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;TABLE\u0026lt;/span\u0026gt; dbo.Tags \n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I have an answer that doesn\u0026apos;t require a UDF, XML\nBecause IN accepts a select statement\ne.g. SELECT * FROM Test where Data IN (SELECT Value FROM TABLE)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;You really only need a way to convert the string into a table.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;This can be done with a recursive CTE, or a query with a number table (or Master..spt_value)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Here\u0026apos;s the CTE version.\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DECLARE\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@InputString\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;varchar\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;8000\u0026lt;/span\u0026gt;) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ruby,rails,scruffy,rubyonrails\u0026apos;\u0026lt;/span\u0026gt;\n\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@InputString\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@InputString\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;\n\n;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WITH\u0026lt;/span\u0026gt; RecursiveCSV(x,y) \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;AS\u0026lt;/span\u0026gt; \n(\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \n        x \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUBSTRING\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@InputString\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,CHARINDEX(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@InputString\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)),\n        y \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUBSTRING\u0026lt;/span\u0026gt;(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@InputString\u0026lt;/span\u0026gt;,CHARINDEX(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@InputString\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,LEN(\u0026lt;span class=\u0026quot;hljs-variable\u0026quot;\u0026gt;@InputString\u0026lt;/span\u0026gt;))\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;UNION\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ALL\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \n        x \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUBSTRING\u0026lt;/span\u0026gt;(y,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,CHARINDEX(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,y,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)),\n        y \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUBSTRING\u0026lt;/span\u0026gt;(y,CHARINDEX(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,y,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,LEN(y))\n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \n        RecursiveCSV \n    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt;\n        \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUBSTRING\u0026lt;/span\u0026gt;(y,CHARINDEX(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,y,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;,LEN(y)) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;OR\u0026lt;/span\u0026gt; \n        \u0026lt;span class=\u0026quot;hljs-built_in\u0026quot;\u0026gt;SUBSTRING\u0026lt;/span\u0026gt;(y,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;,CHARINDEX(\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;,\u0026apos;\u0026lt;/span\u0026gt;,y,\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;)) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;\u0026apos;\u0026lt;/span\u0026gt;\n)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt;\n    \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; \n    Tags\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; \n    Name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;IN\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;select\u0026lt;/span\u0026gt; x \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; RecursiveCSV)\nOPTION (MAXRECURSION \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;32767\u0026lt;/span\u0026gt;);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;I use a more concise version \u0026lt;a href=\u0026quot;https://stackoverflow.com/a/337792/16587\u0026quot;\u0026gt;of the top voted answer\u0026lt;/a\u0026gt;:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;List\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;SqlParameter\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; parameters \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; tags.Select((s, i) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlParameter(\u0026quot;@tag\u0026quot; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; i.ToString(), SqlDbType.NVarChar(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;50\u0026lt;/span\u0026gt;)) { \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;Value\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; s}).ToList();\n\nvar whereCondition \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; string.Format(\u0026quot;tags in ({0})\u0026quot;, String.Join(\u0026quot;,\u0026quot;,parameters.Select(s \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; s.ParameterName)));\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;It does loop through the tag parameters twice; but that doesn\u0026apos;t matter most of the time (it won\u0026apos;t be your bottleneck; if it is, unroll the loop).\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;If you\u0026apos;re really interested in performance and don\u0026apos;t want to iterate through the loop twice, here\u0026apos;s a less beautiful version:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;var parameters \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; List\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;SqlParameter\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;();\nvar paramNames \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; List\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;string\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;();\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (var i \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt; tags.Length; i\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;)  \n{\n    var paramName \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026quot;@tag\u0026quot; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; i;\n\n    \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;Include size \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;and\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;set\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt; explicitly (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;not\u0026lt;/span\u0026gt; AddWithValue)\n    \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;Because \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SQL\u0026lt;/span\u0026gt; Server may use an implicit conversion if it doesn\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;t know\n    //the actual size.\n    var p = new SqlParameter(paramName, SqlDbType.NVarChar(50) { Value = tags[i]; } \n    paramNames.Add(paramName);\n    parameters.Add(p);\n}\n\nvar inClause = string.Join(\u0026quot;,\u0026quot;, paramNames);\n\u0026lt;/span\u0026gt;\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n    ","\n\u0026lt;p\u0026gt;Here is another answer to this problem. \u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;(new version posted on 6/4/13).\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;    private \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;static\u0026lt;/span\u0026gt; DataSet GetDataSet(SqlConnectionStringBuilder scsb, string strSql, params object[] pars)\n    {\n        var ds \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; DataSet();\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; (var sqlConn \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlConnection(scsb.ConnectionString))\n        {\n            var sqlParameters \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; List\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;SqlParameter\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;();\n            var replacementStrings \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; Dictionary\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;string, string\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;();\n            if (pars \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;!=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;)\n            {\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;for\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; i \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;; i \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt; pars.Length; i\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt;)\n                {\n                    if (pars[i] \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;is\u0026lt;/span\u0026gt; IEnumerable\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;object\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;)\n                    {\n                        List\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;object\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; enumerable \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; (pars[i] \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;as\u0026lt;/span\u0026gt; IEnumerable\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;object\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;).ToList();\n                        replacementStrings.Add(\u0026quot;@\u0026quot; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;+\u0026lt;/span\u0026gt; i, String.Join(\u0026quot;,\u0026quot;, enumerable.Select((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;, pos) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; String.Format(\u0026quot;@_{0}_{1}\u0026quot;, i, pos))));\n                        sqlParameters.AddRange(enumerable.Select((\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;, pos) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlParameter(String.Format(\u0026quot;@_{0}_{1}\u0026quot;, i, pos), \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt; ?? DBNull.Value)).ToArray());\n                    }\n                    \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt;\n                    {\n                        sqlParameters.Add(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlParameter(String.Format(\u0026quot;@{0}\u0026quot;, i), pars[i] ?? DBNull.Value));\n                    }\n                }\n            }\n            strSql \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; replacementStrings.Aggregate(strSql, (\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;current\u0026lt;/span\u0026gt;, replacementString) \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; current.Replace(replacementString.Key, replacementString.Value));\n            \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; (var sqlCommand \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlCommand(strSql, sqlConn))\n            {\n                if (pars \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;!=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt;)\n                {\n                    sqlCommand.Parameters.AddRange(sqlParameters.ToArray());\n                }\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;else\u0026lt;/span\u0026gt;\n                {\n                    \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;Fail\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;-\u0026lt;/span\u0026gt;safe, just \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;case\u0026lt;/span\u0026gt; a \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;user\u0026lt;/span\u0026gt; intends \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;to\u0026lt;/span\u0026gt; pass a single \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;null\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;parameter\u0026lt;/span\u0026gt;\n                    sqlCommand.Parameters.Add(\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlParameter(\u0026quot;@0\u0026quot;, DBNull.Value));\n                }\n                \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;using\u0026lt;/span\u0026gt; (var sqlDataAdapter \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; SqlDataAdapter(sqlCommand))\n                {\n                    sqlDataAdapter.Fill(ds);\n                }\n            }\n        }\n        \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; ds;\n    }\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;Cheers.\u0026lt;/p\u0026gt;\n    ","\n\u0026lt;p\u0026gt;The only winning move is not to play.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;No infinite variability for you.  Only finite variability.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;In the SQL you have a clause like this:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;and\u0026lt;/span\u0026gt; ( {\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;}\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;or\u0026lt;/span\u0026gt; b.CompanyId \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;in\u0026lt;/span\u0026gt; ({\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;},{\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;},{\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;},{\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;},{\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;6\u0026lt;/span\u0026gt;}) )\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;In the C# code you do something like this:\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;  \u0026lt;span class=\u0026quot;hljs-type\u0026quot;\u0026gt;int\u0026lt;/span\u0026gt; origCount \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;=\u0026lt;/span\u0026gt; idList.Count;\n  if (origCount \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;) {\n    throw \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;new\u0026lt;/span\u0026gt; Exception(\u0026quot;You may only specify up to five originators to filter on.\u0026quot;);\n  }\n  while (idList.Count \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;5\u0026lt;/span\u0026gt;) { idList.Add(\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt;); }  \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt;\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;/\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;-1\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;is\u0026lt;/span\u0026gt; an impossible \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;value\u0026lt;/span\u0026gt;\n  \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;return\u0026lt;/span\u0026gt; ExecuteQuery\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;lt;\u0026lt;/span\u0026gt;PublishDate\u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;\u0026amp;gt;\u0026lt;/span\u0026gt;(getValuesInListSQL, \n               origCount,   \n               idList[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;0\u0026lt;/span\u0026gt;], idList[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;1\u0026lt;/span\u0026gt;], idList[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;2\u0026lt;/span\u0026gt;], idList[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;3\u0026lt;/span\u0026gt;], idList[\u0026lt;span class=\u0026quot;hljs-number\u0026quot;\u0026gt;4\u0026lt;/span\u0026gt;]);\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;So basically if the count is 0 then there is no filter and everything goes through.  If the count is higher than 0 the then the value must be in the list, but the list has been padded out to five with impossible values (so that the SQL still makes sense)\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;Sometimes the lame solution is the only one that actually works.\u0026lt;/p\u0026gt;\n    "],"id":295,"title":"Parameterize an SQL IN clause","content":"\n                \n\u0026lt;p\u0026gt;How do I parameterize a query containing an \u0026lt;code\u0026gt;IN\u0026lt;/code\u0026gt; clause with a variable number of arguments, like this one?\u0026lt;/p\u0026gt;\n\n\u0026lt;pre class=\u0026quot;lang-sql s-code-block\u0026quot;\u0026gt;\u0026lt;code class=\u0026quot;hljs language-sql\u0026quot;\u0026gt;\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;SELECT\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-operator\u0026quot;\u0026gt;*\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;FROM\u0026lt;/span\u0026gt; Tags \n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;WHERE\u0026lt;/span\u0026gt; Name \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;IN\u0026lt;/span\u0026gt; (\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;ruby\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;rails\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;scruffy\u0026apos;\u0026lt;/span\u0026gt;,\u0026lt;span class=\u0026quot;hljs-string\u0026quot;\u0026gt;\u0026apos;rubyonrails\u0026apos;\u0026lt;/span\u0026gt;)\n\u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;ORDER\u0026lt;/span\u0026gt; \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;BY\u0026lt;/span\u0026gt; Count \u0026lt;span class=\u0026quot;hljs-keyword\u0026quot;\u0026gt;DESC\u0026lt;/span\u0026gt;\n\u0026lt;/code\u0026gt;\u0026lt;/pre\u0026gt;\n\n\u0026lt;p\u0026gt;In this query, the number of arguments could be anywhere from 1 to 5.\u0026lt;/p\u0026gt;\n\n\u0026lt;p\u0026gt;I would prefer not to use a dedicated stored procedure for this (or XML), but if there is some elegant way specific to \u0026lt;a href=\u0026quot;http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2008\u0026quot; rel=\u0026quot;noreferrer\u0026quot;\u0026gt;SQL Server 2008\u0026lt;/a\u0026gt;, I am open to that.\u0026lt;/p\u0026gt;\n    ","slug":"parameterize-an-sql-in-clause-1657387536064","postType":"QUESTION","createdAt":"2022-07-09T17:25:36.000Z","updatedAt":"2022-07-09T17:25:36.000Z","tags":[{"id":1782,"name":"sql-server-2008","slug":"sql-server-2008","createdAt":"2022-07-09T17:25:36.000Z","updatedAt":"2022-07-09T17:25:36.000Z","Questions_Tags":{"questionId":295,"tagId":1782}},{"id":1783,"name":"parameters","slug":"parameters","createdAt":"2022-07-09T17:25:36.000Z","updatedAt":"2022-07-09T17:25:36.000Z","Questions_Tags":{"questionId":295,"tagId":1783}}]}},"__N_SSG":true},"page":"/questions/[slug]","query":{"slug":"parameterize-an-sql-in-clause-1657387536064"},"buildId":"6_hwtyf_oFlFS5l_S4CTe","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>